(self.webpackChunkant_design_pro=self.webpackChunkant_design_pro||[]).push([[7567],{46343:function(zr,B,S){"use strict";S.d(B,{zj:function(){return Dt},oI:function(){return $i},ni:function(){return ge},gg:function(){return on}});var ye=S(34155);/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function C(or,me,Ae,Ue){function Le(kt){return kt instanceof Ae?kt:new Ae(function(nr){nr(kt)})}return new(Ae||(Ae=Promise))(function(kt,nr){function _r(H){try{fr(Ue.next(H))}catch(E){nr(E)}}function Lr(H){try{fr(Ue.throw(H))}catch(E){nr(E)}}function fr(H){H.done?kt(H.value):Le(H.value).then(_r,Lr)}fr((Ue=Ue.apply(or,me||[])).next())})}function d(or,me){var Ae={label:0,sent:function(){if(kt[0]&1)throw kt[1];return kt[1]},trys:[],ops:[]},Ue,Le,kt,nr;return nr={next:_r(0),throw:_r(1),return:_r(2)},typeof Symbol=="function"&&(nr[Symbol.iterator]=function(){return this}),nr;function _r(fr){return function(H){return Lr([fr,H])}}function Lr(fr){if(Ue)throw new TypeError("Generator is already executing.");for(;Ae;)try{if(Ue=1,Le&&(kt=fr[0]&2?Le.return:fr[0]?Le.throw||((kt=Le.return)&&kt.call(Le),0):Le.next)&&!(kt=kt.call(Le,fr[1])).done)return kt;switch(Le=0,kt&&(fr=[fr[0]&2,kt.value]),fr[0]){case 0:case 1:kt=fr;break;case 4:return Ae.label++,{value:fr[1],done:!1};case 5:Ae.label++,Le=fr[1],fr=[0];continue;case 7:fr=Ae.ops.pop(),Ae.trys.pop();continue;default:if(kt=Ae.trys,!(kt=kt.length>0&&kt[kt.length-1])&&(fr[0]===6||fr[0]===2)){Ae=0;continue}if(fr[0]===3&&(!kt||fr[1]>kt[0]&&fr[1]<kt[3])){Ae.label=fr[1];break}if(fr[0]===6&&Ae.label<kt[1]){Ae.label=kt[1],kt=fr;break}if(kt&&Ae.label<kt[2]){Ae.label=kt[2],Ae.ops.push(fr);break}kt[2]&&Ae.ops.pop(),Ae.trys.pop();continue}fr=me.call(or,Ae)}catch(H){fr=[6,H],Le=0}finally{Ue=kt=0}if(fr[0]&5)throw fr[1];return{value:fr[0]?fr[1]:void 0,done:!0}}}function de(or,me){var Ae=typeof Symbol=="function"&&or[Symbol.iterator];if(!Ae)return or;var Ue=Ae.call(or),Le,kt=[],nr;try{for(;(me===void 0||me-- >0)&&!(Le=Ue.next()).done;)kt.push(Le.value)}catch(_r){nr={error:_r}}finally{try{Le&&!Le.done&&(Ae=Ue.return)&&Ae.call(Ue)}finally{if(nr)throw nr.error}}return kt}function re(){for(var or=[],me=0;me<arguments.length;me++)or=or.concat(de(arguments[me]));return or}function ie(or){return or&&or.__esModule&&Object.prototype.hasOwnProperty.call(or,"default")?or.default:or}function se(or,me){return me={exports:{}},or(me,me.exports),me.exports}var Be=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=Ae;function Ae(Ue){return Ue&&typeof Ue.length=="number"&&Ue.length>=0&&Ue.length%1==0}or.exports=me.default});ie(Be);var $=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=function(Ae){return function(){for(var Ue=[],Le=arguments.length;Le--;)Ue[Le]=arguments[Le];var kt=Ue.pop();return Ae.call(this,Ue,kt)}},or.exports=me.default});ie($);var Je=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.fallback=Le,me.wrap=kt;var Ae=me.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,Ue=me.hasNextTick=typeof ye=="object"&&typeof ye.nextTick=="function";function Le(_r){setTimeout(_r,0)}function kt(_r){return function(Lr){for(var fr=[],H=arguments.length-1;H-- >0;)fr[H]=arguments[H+1];return _r(function(){return Lr.apply(void 0,fr)})}}var nr;Ae?nr=setImmediate:Ue?nr=ye.nextTick:nr=Le,me.default=kt(nr)});ie(Je);var bt=Je.fallback,Gt=Je.wrap,Ir=Je.hasSetImmediate,Qt=Je.hasNextTick,Yt=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=kt;var Ae=Le($),Ue=Le(Je);function Le(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}function kt(Lr){return(0,ir.isAsync)(Lr)?function(){for(var fr=[],H=arguments.length;H--;)fr[H]=arguments[H];var E=fr.pop(),V=Lr.apply(this,fr);return nr(V,E)}:(0,Ae.default)(function(fr,H){var E;try{E=Lr.apply(this,fr)}catch(V){return H(V)}if(E&&typeof E.then=="function")return nr(E,H);H(null,E)})}function nr(Lr,fr){return Lr.then(function(H){_r(fr,null,H)},function(H){_r(fr,H&&H.message?H:new Error(H))})}function _r(Lr,fr,H){try{Lr(fr,H)}catch(E){(0,Ue.default)(function(V){throw V},E)}}or.exports=me.default});ie(Yt);var ir=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.isAsyncIterable=me.isAsyncGenerator=me.isAsync=void 0;var Ae=Ue(Yt);function Ue(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}function Le(Lr){return Lr[Symbol.toStringTag]==="AsyncFunction"}function kt(Lr){return Lr[Symbol.toStringTag]==="AsyncGenerator"}function nr(Lr){return typeof Lr[Symbol.asyncIterator]=="function"}function _r(Lr){if(typeof Lr!="function")throw new Error("expected a function");return Le(Lr)?(0,Ae.default)(Lr):Lr}me.default=_r,me.isAsync=Le,me.isAsyncGenerator=kt,me.isAsyncIterable=nr});ie(ir);var jt=ir.isAsyncIterable,Tt=ir.isAsyncGenerator,Ct=ir.isAsync,br=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=Ae;function Ae(Ue,Le){if(Le===void 0&&(Le=Ue.length),!Le)throw new Error("arity is undefined");function kt(){for(var nr=this,_r=[],Lr=arguments.length;Lr--;)_r[Lr]=arguments[Lr];return typeof _r[Le-1]=="function"?Ue.apply(this,_r):new Promise(function(fr,H){_r[Le-1]=function(E){for(var V=[],Ze=arguments.length-1;Ze-- >0;)V[Ze]=arguments[Ze+1];if(E)return H(E);fr(V.length>1?V:V[0])},Ue.apply(nr,_r)})}return Object.defineProperty(kt,"name",{configurable:!0,value:"awaitable("+Ue.name+")"}),kt}or.exports=me.default});ie(br);var q=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae=kt(Be),Ue=kt(ir),Le=kt(br);function kt(nr){return nr&&nr.__esModule?nr:{default:nr}}me.default=(0,Le.default)(function(nr,_r,Lr){var fr=(0,Ae.default)(_r)?[]:{};nr(_r,function(H,E,V){(0,Ue.default)(H)(function(Ze){for(var tt,ut=[],wt=arguments.length-1;wt-- >0;)ut[wt]=arguments[wt+1];ut.length<2&&(tt=ut,ut=tt[0]),fr[E]=ut,V(Ze)})},function(H){return Lr(H,fr)})},3),or.exports=me.default});ie(q);var dr=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=Ae;function Ae(Ue){function Le(){for(var kt=[],nr=arguments.length;nr--;)kt[nr]=arguments[nr];if(Ue!==null){var _r=Ue;Ue=null,_r.apply(this,kt)}}return Object.assign(Le,Ue),Le}or.exports=me.default});ie(dr);var Qe=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=function(Ae){return Ae[Symbol.iterator]&&Ae[Symbol.iterator]()},or.exports=me.default});ie(Qe);var $e=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=Lr;var Ae=Le(Be),Ue=Le(Qe);function Le(fr){return fr&&fr.__esModule?fr:{default:fr}}function kt(fr){var H=-1,E=fr.length;return function(){return++H<E?{value:fr[H],key:H}:null}}function nr(fr){var H=-1;return function(){var V=fr.next();return V.done?null:(H++,{value:V.value,key:H})}}function _r(fr){var H=fr?Object.keys(fr):[],E=-1,V=H.length;return function(){var tt=H[++E];return E<V?{value:fr[tt],key:tt}:null}}function Lr(fr){if((0,Ae.default)(fr))return kt(fr);var H=(0,Ue.default)(fr);return H?nr(H):_r(fr)}or.exports=me.default});ie($e);var Rt=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=Ae;function Ae(Ue){return function(){for(var Le=[],kt=arguments.length;kt--;)Le[kt]=arguments[kt];if(Ue===null)throw new Error("Callback was already called.");var nr=Ue;Ue=null,nr.apply(this,Le)}}or.exports=me.default});ie(Rt);var Xe=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae={};me.default=Ae,or.exports=me.default});ie(Xe);var Zt=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=Le;var Ae=Ue(Xe);function Ue(kt){return kt&&kt.__esModule?kt:{default:kt}}function Le(kt,nr,_r,Lr){var fr=!1,H=!1,E=!1,V=0,Ze=0;function tt(){V>=nr||E||fr||(E=!0,kt.next().then(function(K){var Ht=K.value,Tr=K.done;if(!(H||fr)){if(E=!1,Tr){fr=!0,V<=0&&Lr(null);return}V++,_r(Ht,Ze,ut),Ze++,tt()}}).catch(wt))}function ut(K,Ht){if(V-=1,!H){if(K)return wt(K);if(K===!1){fr=!0,H=!0;return}if(Ht===Ae.default||fr&&V<=0)return fr=!0,Lr(null);tt()}}function wt(K){H||(E=!1,fr=!0,Lr(K))}tt()}or.exports=me.default});ie(Zt);var xr=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae=_r(dr),Ue=_r($e),Le=_r(Rt),kt=_r(Zt),nr=_r(Xe);function _r(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}me.default=function(Lr){return function(fr,H,E){if(E=(0,Ae.default)(E),Lr<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!fr)return E(null);if((0,ir.isAsyncGenerator)(fr))return(0,kt.default)(fr,Lr,H,E);if((0,ir.isAsyncIterable)(fr))return(0,kt.default)(fr[Symbol.asyncIterator](),Lr,H,E);var V=(0,Ue.default)(fr),Ze=!1,tt=!1,ut=0,wt=!1;function K(Tr,Or){if(!tt)if(ut-=1,Tr)Ze=!0,E(Tr);else if(Tr===!1)Ze=!0,tt=!0;else{if(Or===nr.default||Ze&&ut<=0)return Ze=!0,E(null);wt||Ht()}}function Ht(){for(wt=!0;ut<Lr&&!Ze;){var Tr=V();if(Tr===null){Ze=!0,ut<=0&&E(null);return}ut+=1,H(Tr.value,Tr.key,(0,Le.default)(K))}wt=!1}Ht()}},or.exports=me.default});ie(xr);var qt=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae=kt(xr),Ue=kt(ir),Le=kt(br);function kt(_r){return _r&&_r.__esModule?_r:{default:_r}}function nr(_r,Lr,fr,H){return(0,Ae.default)(Lr)(_r,(0,Ue.default)(fr),H)}me.default=(0,Le.default)(nr,4),or.exports=me.default});ie(qt);var Xr=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae=Le(qt),Ue=Le(br);function Le(nr){return nr&&nr.__esModule?nr:{default:nr}}function kt(nr,_r,Lr){return(0,Ae.default)(nr,1,_r,Lr)}me.default=(0,Ue.default)(kt,3),or.exports=me.default});ie(Xr);var ce=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=kt;var Ae=Le(q),Ue=Le(Xr);function Le(nr){return nr&&nr.__esModule?nr:{default:nr}}function kt(nr,_r){return(0,Ae.default)(Ue.default,nr,_r)}or.exports=me.default}),Re=ie(ce),ge=function(){function or(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];this.args=[],this.tasks=[]}return or.prototype.call=function(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];return this.args=Ae,Re(this.tasks)},or.prototype.tap=function(me,Ae){var Ue=this;this.tasks.push(function(Le){Ae.apply(void 0,re(Ue.args)),Le(null,me)})},or}(),xt=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae=fr(Be),Ue=fr(Xe),Le=fr(qt),kt=fr(dr),nr=fr(Rt),_r=fr(ir),Lr=fr(br);function fr(Ze){return Ze&&Ze.__esModule?Ze:{default:Ze}}function H(Ze,tt,ut){ut=(0,kt.default)(ut);var wt=0,K=0,Ht=Ze.length,Tr=!1;Ht===0&&ut(null);function Or(Ye,lt){Ye===!1&&(Tr=!0),Tr!==!0&&(Ye?ut(Ye):(++K===Ht||lt===Ue.default)&&ut(null))}for(;wt<Ht;wt++)tt(Ze[wt],wt,(0,nr.default)(Or))}function E(Ze,tt,ut){return(0,Le.default)(Ze,Infinity,tt,ut)}function V(Ze,tt,ut){var wt=(0,Ae.default)(Ze)?H:E;return wt(Ze,(0,_r.default)(tt),ut)}me.default=(0,Lr.default)(V,3),or.exports=me.default});ie(xt);var vt=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0}),me.default=kt;var Ae=Le(xt),Ue=Le(q);function Le(nr){return nr&&nr.__esModule?nr:{default:nr}}function kt(nr,_r){return(0,Ue.default)(Ae.default,nr,_r)}or.exports=me.default}),Nt=ie(vt),Dt=function(){function or(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];this.tasks=[]}return or.prototype.promise=function(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];return Nt(this.tasks)},or.prototype.tapPromise=function(me,Ae){var Ue=this;this.tasks.push(function(Le){return C(Ue,void 0,void 0,function(){return d(this,function(kt){switch(kt.label){case 0:return[4,Ae()];case 1:return kt.sent(),Le(null,me),[2]}})})})},or}(),Ur=se(function(or,me){Object.defineProperty(me,"__esModule",{value:!0});var Ae=nr(dr),Ue=nr(Rt),Le=nr(ir),kt=nr(br);function nr(Lr){return Lr&&Lr.__esModule?Lr:{default:Lr}}function _r(Lr,fr){if(fr=(0,Ae.default)(fr),!Array.isArray(Lr))return fr(new Error("First argument to waterfall must be an array of functions"));if(!Lr.length)return fr();var H=0;function E(Ze){var tt=(0,Le.default)(Lr[H++]);tt.apply(void 0,Ze.concat([(0,Ue.default)(V)]))}function V(Ze){for(var tt=[],ut=arguments.length-1;ut-- >0;)tt[ut]=arguments[ut+1];if(Ze!==!1){if(Ze||H===Lr.length)return fr.apply(void 0,[Ze].concat(tt));E(tt)}}E([])}me.default=(0,kt.default)(_r),or.exports=me.default}),dn=ie(Ur),on=function(){function or(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];this.tasks=[]}return or.prototype.call=function(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];return dn(this.tasks)},or.prototype.tap=function(me,Ae){this.tasks.length===0?this.tasks.push(function(Ue){var Le=Ae();Ue(Le?null:!1,Le)}):this.tasks.push(function(Ue,Le){var kt=Ae();Le(kt?null:!1,me)})},or}(),$i=function(){function or(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];this.tasks=[]}return or.prototype.call=function(){for(var me=arguments,Ae=[],Ue=0;Ue<arguments.length;Ue++)Ae[Ue]=me[Ue];return Re(this.tasks)},or.prototype.tap=function(me,Ae){this.tasks.push(function(Ue){var Le=Ae();Ue(Le,me)})},or}()},58881:function(zr,B,S){"use strict";S.d(B,{nC:function(){return ye.ZP},Hp:function(){return ye.Hp},e7:function(){return ye.e7},yT:function(){return ye.yT},vK:function(){return d.v},BlendType:function(){return re.h},AttributeType:function(){return ie.GC},ScaleTypes:function(){return ie.vY},StyleScaleType:function(){return ie.ee},MapServiceEvent:function(){return $.I},CoordinateSystem:function(){return Je.l},CoordinateUniform:function(){return Je.k},CameraUniform:function(){return Ir.l},SceneEventList:function(){return ir.P},PositionType:function(){return Qe.d},gl:function(){return nr.gl}});var ye=S(12250),C=S(69530),d=S(72302),de=S(76915),re=S(77252),ie=S(31251),se=S(8628),Be=S.n(se);S.o(se,"CameraUniform")&&S.d(B,{CameraUniform:function(){return se.CameraUniform}}),S.o(se,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return se.CityBuildingLayer}}),S.o(se,"CoordinateSystem")&&S.d(B,{CoordinateSystem:function(){return se.CoordinateSystem}}),S.o(se,"CoordinateUniform")&&S.d(B,{CoordinateUniform:function(){return se.CoordinateUniform}}),S.o(se,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return se.HeatmapLayer}}),S.o(se,"ImageLayer")&&S.d(B,{ImageLayer:function(){return se.ImageLayer}}),S.o(se,"LineLayer")&&S.d(B,{LineLayer:function(){return se.LineLayer}}),S.o(se,"MapServiceEvent")&&S.d(B,{MapServiceEvent:function(){return se.MapServiceEvent}}),S.o(se,"Marker")&&S.d(B,{Marker:function(){return se.Marker}}),S.o(se,"PointLayer")&&S.d(B,{PointLayer:function(){return se.PointLayer}}),S.o(se,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return se.PolygonLayer}}),S.o(se,"Popup")&&S.d(B,{Popup:function(){return se.Popup}}),S.o(se,"PositionType")&&S.d(B,{PositionType:function(){return se.PositionType}}),S.o(se,"RasterLayer")&&S.d(B,{RasterLayer:function(){return se.RasterLayer}}),S.o(se,"Scene")&&S.d(B,{Scene:function(){return se.Scene}}),S.o(se,"SceneEventList")&&S.d(B,{SceneEventList:function(){return se.SceneEventList}}),S.o(se,"gl")&&S.d(B,{gl:function(){return se.gl}});var $=S(16606),Je=S(47282),bt=S(41906),Gt=S.n(bt);S.o(bt,"CameraUniform")&&S.d(B,{CameraUniform:function(){return bt.CameraUniform}}),S.o(bt,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return bt.CityBuildingLayer}}),S.o(bt,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return bt.HeatmapLayer}}),S.o(bt,"ImageLayer")&&S.d(B,{ImageLayer:function(){return bt.ImageLayer}}),S.o(bt,"LineLayer")&&S.d(B,{LineLayer:function(){return bt.LineLayer}}),S.o(bt,"Marker")&&S.d(B,{Marker:function(){return bt.Marker}}),S.o(bt,"PointLayer")&&S.d(B,{PointLayer:function(){return bt.PointLayer}}),S.o(bt,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return bt.PolygonLayer}}),S.o(bt,"Popup")&&S.d(B,{Popup:function(){return bt.Popup}}),S.o(bt,"PositionType")&&S.d(B,{PositionType:function(){return bt.PositionType}}),S.o(bt,"RasterLayer")&&S.d(B,{RasterLayer:function(){return bt.RasterLayer}}),S.o(bt,"Scene")&&S.d(B,{Scene:function(){return bt.Scene}}),S.o(bt,"SceneEventList")&&S.d(B,{SceneEventList:function(){return bt.SceneEventList}}),S.o(bt,"gl")&&S.d(B,{gl:function(){return bt.gl}});var Ir=S(4594),Qt=S(1910),Yt=S.n(Qt);S.o(Qt,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return Qt.CityBuildingLayer}}),S.o(Qt,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return Qt.HeatmapLayer}}),S.o(Qt,"ImageLayer")&&S.d(B,{ImageLayer:function(){return Qt.ImageLayer}}),S.o(Qt,"LineLayer")&&S.d(B,{LineLayer:function(){return Qt.LineLayer}}),S.o(Qt,"Marker")&&S.d(B,{Marker:function(){return Qt.Marker}}),S.o(Qt,"PointLayer")&&S.d(B,{PointLayer:function(){return Qt.PointLayer}}),S.o(Qt,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return Qt.PolygonLayer}}),S.o(Qt,"Popup")&&S.d(B,{Popup:function(){return Qt.Popup}}),S.o(Qt,"PositionType")&&S.d(B,{PositionType:function(){return Qt.PositionType}}),S.o(Qt,"RasterLayer")&&S.d(B,{RasterLayer:function(){return Qt.RasterLayer}}),S.o(Qt,"Scene")&&S.d(B,{Scene:function(){return Qt.Scene}}),S.o(Qt,"SceneEventList")&&S.d(B,{SceneEventList:function(){return Qt.SceneEventList}}),S.o(Qt,"gl")&&S.d(B,{gl:function(){return Qt.gl}});var ir=S(19793),jt=S(93102),Tt=S.n(jt);S.o(jt,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return jt.CityBuildingLayer}}),S.o(jt,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return jt.HeatmapLayer}}),S.o(jt,"ImageLayer")&&S.d(B,{ImageLayer:function(){return jt.ImageLayer}}),S.o(jt,"LineLayer")&&S.d(B,{LineLayer:function(){return jt.LineLayer}}),S.o(jt,"Marker")&&S.d(B,{Marker:function(){return jt.Marker}}),S.o(jt,"PointLayer")&&S.d(B,{PointLayer:function(){return jt.PointLayer}}),S.o(jt,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return jt.PolygonLayer}}),S.o(jt,"Popup")&&S.d(B,{Popup:function(){return jt.Popup}}),S.o(jt,"PositionType")&&S.d(B,{PositionType:function(){return jt.PositionType}}),S.o(jt,"RasterLayer")&&S.d(B,{RasterLayer:function(){return jt.RasterLayer}}),S.o(jt,"Scene")&&S.d(B,{Scene:function(){return jt.Scene}}),S.o(jt,"gl")&&S.d(B,{gl:function(){return jt.gl}});var Ct=S(64532),br=S.n(Ct);S.o(Ct,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return Ct.CityBuildingLayer}}),S.o(Ct,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return Ct.HeatmapLayer}}),S.o(Ct,"ImageLayer")&&S.d(B,{ImageLayer:function(){return Ct.ImageLayer}}),S.o(Ct,"LineLayer")&&S.d(B,{LineLayer:function(){return Ct.LineLayer}}),S.o(Ct,"Marker")&&S.d(B,{Marker:function(){return Ct.Marker}}),S.o(Ct,"PointLayer")&&S.d(B,{PointLayer:function(){return Ct.PointLayer}}),S.o(Ct,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return Ct.PolygonLayer}}),S.o(Ct,"Popup")&&S.d(B,{Popup:function(){return Ct.Popup}}),S.o(Ct,"PositionType")&&S.d(B,{PositionType:function(){return Ct.PositionType}}),S.o(Ct,"RasterLayer")&&S.d(B,{RasterLayer:function(){return Ct.RasterLayer}}),S.o(Ct,"Scene")&&S.d(B,{Scene:function(){return Ct.Scene}}),S.o(Ct,"gl")&&S.d(B,{gl:function(){return Ct.gl}});var q=S(2811),dr=S.n(q);S.o(q,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return q.CityBuildingLayer}}),S.o(q,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return q.HeatmapLayer}}),S.o(q,"ImageLayer")&&S.d(B,{ImageLayer:function(){return q.ImageLayer}}),S.o(q,"LineLayer")&&S.d(B,{LineLayer:function(){return q.LineLayer}}),S.o(q,"Marker")&&S.d(B,{Marker:function(){return q.Marker}}),S.o(q,"PointLayer")&&S.d(B,{PointLayer:function(){return q.PointLayer}}),S.o(q,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return q.PolygonLayer}}),S.o(q,"Popup")&&S.d(B,{Popup:function(){return q.Popup}}),S.o(q,"PositionType")&&S.d(B,{PositionType:function(){return q.PositionType}}),S.o(q,"RasterLayer")&&S.d(B,{RasterLayer:function(){return q.RasterLayer}}),S.o(q,"Scene")&&S.d(B,{Scene:function(){return q.Scene}}),S.o(q,"gl")&&S.d(B,{gl:function(){return q.gl}});var Qe=S(66690),$e=S(81732),Rt=S.n($e);S.o($e,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return $e.CityBuildingLayer}}),S.o($e,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return $e.HeatmapLayer}}),S.o($e,"ImageLayer")&&S.d(B,{ImageLayer:function(){return $e.ImageLayer}}),S.o($e,"LineLayer")&&S.d(B,{LineLayer:function(){return $e.LineLayer}}),S.o($e,"Marker")&&S.d(B,{Marker:function(){return $e.Marker}}),S.o($e,"PointLayer")&&S.d(B,{PointLayer:function(){return $e.PointLayer}}),S.o($e,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return $e.PolygonLayer}}),S.o($e,"Popup")&&S.d(B,{Popup:function(){return $e.Popup}}),S.o($e,"RasterLayer")&&S.d(B,{RasterLayer:function(){return $e.RasterLayer}}),S.o($e,"Scene")&&S.d(B,{Scene:function(){return $e.Scene}}),S.o($e,"gl")&&S.d(B,{gl:function(){return $e.gl}});var Xe=S(84007),Zt=S.n(Xe);S.o(Xe,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return Xe.CityBuildingLayer}}),S.o(Xe,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return Xe.HeatmapLayer}}),S.o(Xe,"ImageLayer")&&S.d(B,{ImageLayer:function(){return Xe.ImageLayer}}),S.o(Xe,"LineLayer")&&S.d(B,{LineLayer:function(){return Xe.LineLayer}}),S.o(Xe,"Marker")&&S.d(B,{Marker:function(){return Xe.Marker}}),S.o(Xe,"PointLayer")&&S.d(B,{PointLayer:function(){return Xe.PointLayer}}),S.o(Xe,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return Xe.PolygonLayer}}),S.o(Xe,"Popup")&&S.d(B,{Popup:function(){return Xe.Popup}}),S.o(Xe,"RasterLayer")&&S.d(B,{RasterLayer:function(){return Xe.RasterLayer}}),S.o(Xe,"Scene")&&S.d(B,{Scene:function(){return Xe.Scene}}),S.o(Xe,"gl")&&S.d(B,{gl:function(){return Xe.gl}});var xr=S(89648),qt=S(90919),Xr=S.n(qt);S.o(qt,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return qt.CityBuildingLayer}}),S.o(qt,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return qt.HeatmapLayer}}),S.o(qt,"ImageLayer")&&S.d(B,{ImageLayer:function(){return qt.ImageLayer}}),S.o(qt,"LineLayer")&&S.d(B,{LineLayer:function(){return qt.LineLayer}}),S.o(qt,"Marker")&&S.d(B,{Marker:function(){return qt.Marker}}),S.o(qt,"PointLayer")&&S.d(B,{PointLayer:function(){return qt.PointLayer}}),S.o(qt,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return qt.PolygonLayer}}),S.o(qt,"Popup")&&S.d(B,{Popup:function(){return qt.Popup}}),S.o(qt,"RasterLayer")&&S.d(B,{RasterLayer:function(){return qt.RasterLayer}}),S.o(qt,"Scene")&&S.d(B,{Scene:function(){return qt.Scene}}),S.o(qt,"gl")&&S.d(B,{gl:function(){return qt.gl}});var ce=S(75925),Re=S.n(ce);S.o(ce,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return ce.CityBuildingLayer}}),S.o(ce,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return ce.HeatmapLayer}}),S.o(ce,"ImageLayer")&&S.d(B,{ImageLayer:function(){return ce.ImageLayer}}),S.o(ce,"LineLayer")&&S.d(B,{LineLayer:function(){return ce.LineLayer}}),S.o(ce,"Marker")&&S.d(B,{Marker:function(){return ce.Marker}}),S.o(ce,"PointLayer")&&S.d(B,{PointLayer:function(){return ce.PointLayer}}),S.o(ce,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return ce.PolygonLayer}}),S.o(ce,"Popup")&&S.d(B,{Popup:function(){return ce.Popup}}),S.o(ce,"RasterLayer")&&S.d(B,{RasterLayer:function(){return ce.RasterLayer}}),S.o(ce,"Scene")&&S.d(B,{Scene:function(){return ce.Scene}}),S.o(ce,"gl")&&S.d(B,{gl:function(){return ce.gl}});var ge=S(85040),xt=S.n(ge);S.o(ge,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return ge.CityBuildingLayer}}),S.o(ge,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return ge.HeatmapLayer}}),S.o(ge,"ImageLayer")&&S.d(B,{ImageLayer:function(){return ge.ImageLayer}}),S.o(ge,"LineLayer")&&S.d(B,{LineLayer:function(){return ge.LineLayer}}),S.o(ge,"Marker")&&S.d(B,{Marker:function(){return ge.Marker}}),S.o(ge,"PointLayer")&&S.d(B,{PointLayer:function(){return ge.PointLayer}}),S.o(ge,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return ge.PolygonLayer}}),S.o(ge,"Popup")&&S.d(B,{Popup:function(){return ge.Popup}}),S.o(ge,"RasterLayer")&&S.d(B,{RasterLayer:function(){return ge.RasterLayer}}),S.o(ge,"Scene")&&S.d(B,{Scene:function(){return ge.Scene}}),S.o(ge,"gl")&&S.d(B,{gl:function(){return ge.gl}});var vt=S(8594),Nt=S.n(vt);S.o(vt,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return vt.CityBuildingLayer}}),S.o(vt,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return vt.HeatmapLayer}}),S.o(vt,"ImageLayer")&&S.d(B,{ImageLayer:function(){return vt.ImageLayer}}),S.o(vt,"LineLayer")&&S.d(B,{LineLayer:function(){return vt.LineLayer}}),S.o(vt,"Marker")&&S.d(B,{Marker:function(){return vt.Marker}}),S.o(vt,"PointLayer")&&S.d(B,{PointLayer:function(){return vt.PointLayer}}),S.o(vt,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return vt.PolygonLayer}}),S.o(vt,"Popup")&&S.d(B,{Popup:function(){return vt.Popup}}),S.o(vt,"RasterLayer")&&S.d(B,{RasterLayer:function(){return vt.RasterLayer}}),S.o(vt,"Scene")&&S.d(B,{Scene:function(){return vt.Scene}}),S.o(vt,"gl")&&S.d(B,{gl:function(){return vt.gl}});var Dt=S(67571),Ur=S.n(Dt);S.o(Dt,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return Dt.CityBuildingLayer}}),S.o(Dt,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return Dt.HeatmapLayer}}),S.o(Dt,"ImageLayer")&&S.d(B,{ImageLayer:function(){return Dt.ImageLayer}}),S.o(Dt,"LineLayer")&&S.d(B,{LineLayer:function(){return Dt.LineLayer}}),S.o(Dt,"Marker")&&S.d(B,{Marker:function(){return Dt.Marker}}),S.o(Dt,"PointLayer")&&S.d(B,{PointLayer:function(){return Dt.PointLayer}}),S.o(Dt,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return Dt.PolygonLayer}}),S.o(Dt,"Popup")&&S.d(B,{Popup:function(){return Dt.Popup}}),S.o(Dt,"RasterLayer")&&S.d(B,{RasterLayer:function(){return Dt.RasterLayer}}),S.o(Dt,"Scene")&&S.d(B,{Scene:function(){return Dt.Scene}}),S.o(Dt,"gl")&&S.d(B,{gl:function(){return Dt.gl}});var dn=S(66718),on=S.n(dn);S.o(dn,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return dn.CityBuildingLayer}}),S.o(dn,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return dn.HeatmapLayer}}),S.o(dn,"ImageLayer")&&S.d(B,{ImageLayer:function(){return dn.ImageLayer}}),S.o(dn,"LineLayer")&&S.d(B,{LineLayer:function(){return dn.LineLayer}}),S.o(dn,"Marker")&&S.d(B,{Marker:function(){return dn.Marker}}),S.o(dn,"PointLayer")&&S.d(B,{PointLayer:function(){return dn.PointLayer}}),S.o(dn,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return dn.PolygonLayer}}),S.o(dn,"Popup")&&S.d(B,{Popup:function(){return dn.Popup}}),S.o(dn,"RasterLayer")&&S.d(B,{RasterLayer:function(){return dn.RasterLayer}}),S.o(dn,"Scene")&&S.d(B,{Scene:function(){return dn.Scene}}),S.o(dn,"gl")&&S.d(B,{gl:function(){return dn.gl}});var $i=S(92364),or=S(78010),me=S.n(or);S.o(or,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return or.CityBuildingLayer}}),S.o(or,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return or.HeatmapLayer}}),S.o(or,"ImageLayer")&&S.d(B,{ImageLayer:function(){return or.ImageLayer}}),S.o(or,"LineLayer")&&S.d(B,{LineLayer:function(){return or.LineLayer}}),S.o(or,"Marker")&&S.d(B,{Marker:function(){return or.Marker}}),S.o(or,"PointLayer")&&S.d(B,{PointLayer:function(){return or.PointLayer}}),S.o(or,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return or.PolygonLayer}}),S.o(or,"Popup")&&S.d(B,{Popup:function(){return or.Popup}}),S.o(or,"RasterLayer")&&S.d(B,{RasterLayer:function(){return or.RasterLayer}}),S.o(or,"Scene")&&S.d(B,{Scene:function(){return or.Scene}}),S.o(or,"gl")&&S.d(B,{gl:function(){return or.gl}});var Ae=S(68116),Ue=S.n(Ae);S.o(Ae,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return Ae.CityBuildingLayer}}),S.o(Ae,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return Ae.HeatmapLayer}}),S.o(Ae,"ImageLayer")&&S.d(B,{ImageLayer:function(){return Ae.ImageLayer}}),S.o(Ae,"LineLayer")&&S.d(B,{LineLayer:function(){return Ae.LineLayer}}),S.o(Ae,"Marker")&&S.d(B,{Marker:function(){return Ae.Marker}}),S.o(Ae,"PointLayer")&&S.d(B,{PointLayer:function(){return Ae.PointLayer}}),S.o(Ae,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return Ae.PolygonLayer}}),S.o(Ae,"Popup")&&S.d(B,{Popup:function(){return Ae.Popup}}),S.o(Ae,"RasterLayer")&&S.d(B,{RasterLayer:function(){return Ae.RasterLayer}}),S.o(Ae,"Scene")&&S.d(B,{Scene:function(){return Ae.Scene}}),S.o(Ae,"gl")&&S.d(B,{gl:function(){return Ae.gl}});var Le=S(23067),kt=S.n(Le);S.o(Le,"CityBuildingLayer")&&S.d(B,{CityBuildingLayer:function(){return Le.CityBuildingLayer}}),S.o(Le,"HeatmapLayer")&&S.d(B,{HeatmapLayer:function(){return Le.HeatmapLayer}}),S.o(Le,"ImageLayer")&&S.d(B,{ImageLayer:function(){return Le.ImageLayer}}),S.o(Le,"LineLayer")&&S.d(B,{LineLayer:function(){return Le.LineLayer}}),S.o(Le,"Marker")&&S.d(B,{Marker:function(){return Le.Marker}}),S.o(Le,"PointLayer")&&S.d(B,{PointLayer:function(){return Le.PointLayer}}),S.o(Le,"PolygonLayer")&&S.d(B,{PolygonLayer:function(){return Le.PolygonLayer}}),S.o(Le,"Popup")&&S.d(B,{Popup:function(){return Le.Popup}}),S.o(Le,"RasterLayer")&&S.d(B,{RasterLayer:function(){return Le.RasterLayer}}),S.o(Le,"Scene")&&S.d(B,{Scene:function(){return Le.Scene}}),S.o(Le,"gl")&&S.d(B,{gl:function(){return Le.gl}});var nr=S(7648)},12250:function(zr,B,S){"use strict";S.d(B,{e7:function(){return Ci},Hp:function(){return xi},ZP:function(){return Ei},yT:function(){return Qi}});var ye=S(28660),C=S(26729),d=S.n(C),de=S(86700),re=S(84879),ie=S(72302),se=S(6610),Be=S(5991),$=S(96156),Je=S(6901),bt=S(49296),Gt=S.n(bt);function Ir(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function Qt(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Ir(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Ir(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function Yt(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=ir(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var k=0,oe=function(){};return{s:oe,n:function(){return k>=Q.length?{done:!0}:{done:!1,value:Q[k++]}},e:function(lr){throw lr},f:oe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var we=!0,gt=!1,Mt;return{s:function(){O=O.call(Q)},n:function(){var lr=O.next();return we=lr.done,lr},e:function(lr){gt=!0,Mt=lr},f:function(){try{!we&&O.return!=null&&O.return()}finally{if(gt)throw Mt}}}}function ir(Q,J){if(!!Q){if(typeof Q=="string")return jt(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return jt(Q,J)}}function jt(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,k=new Array(J);O<J;O++)k[O]=Q[O];return k}var Tt=30;function Ct(Q){var J=Q.characterSet,O=Q.getFontWidth,k=Q.fontHeight,oe=Q.buffer,we=Q.maxCanvasWidth,gt=Q.mapping,Mt=gt===void 0?{}:gt,St=Q.xOffset,lr=St===void 0?0:St,Wr=Q.yOffset,Xn=Wr===void 0?0:Wr,Un=0,ci=lr;Array.from(J).forEach(function(jn,aa){if(!Mt[jn]){var da=O(jn,aa);ci+Tt>we&&(ci=0,Un++),Mt[jn]={x:ci,y:Xn+Un*Tt,width:Tt,height:Tt,advance:da},ci+=Tt}});var vi=k+oe*2;return{mapping:Mt,xOffset:ci,yOffset:Xn+Un*vi,canvasHeight:dr(Xn+(Un+1)*vi)}}function br(Q,J,O){var k=0,oe=0,we=0,gt=[],Mt={},St=Yt(Q),lr;try{for(St.s();!(lr=St.n()).done;){var Wr=lr.value;if(!Mt[Wr.id]){var Xn=Wr.size;k+Xn+J>O&&(q(Mt,gt,oe),k=0,oe=we+oe+J,we=0,gt=[]),gt.push({icon:Wr,xOffset:k}),k=k+Xn+J,we=Math.max(we,Xn)}}}catch(ci){St.e(ci)}finally{St.f()}gt.length>0&&q(Mt,gt,oe);var Un=dr(we+oe+J);return{mapping:Mt,canvasHeight:Un}}function q(Q,J,O){var k=Yt(J),oe;try{for(k.s();!(oe=k.n()).done;){var we=oe.value,gt=we.icon,Mt=we.xOffset;Q[gt.id]=Qt(Qt({},gt),{},{x:Mt,y:O,image:gt.image,width:gt.width,height:gt.height})}}catch(St){k.e(St)}finally{k.f()}}function dr(Q){return Math.pow(2,Math.ceil(Math.log2(Q)))}var Qe,$e;function Rt(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=Xe(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var k=0,oe=function(){};return{s:oe,n:function(){return k>=Q.length?{done:!0}:{done:!1,value:Q[k++]}},e:function(lr){throw lr},f:oe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var we=!0,gt=!1,Mt;return{s:function(){O=O.call(Q)},n:function(){var lr=O.next();return we=lr.done,lr},e:function(lr){gt=!0,Mt=lr},f:function(){try{!we&&O.return!=null&&O.return()}finally{if(gt)throw Mt}}}}function Xe(Q,J){if(!!Q){if(typeof Q=="string")return Zt(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return Zt(Q,J)}}function Zt(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,k=new Array(J);O<J;O++)k[O]=Q[O];return k}function xr(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function qt(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?xr(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):xr(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}var Xr=or(),ce="sans-serif",Re="normal",ge=24,xt=3,vt=.25,Nt=8,Dt=1024,Ur=1,dn=1,on=3,$i=null;function or(){for(var Q=[],J=32;J<128;J++)Q.push(String.fromCharCode(J));return Q}function me(Q,J,O,k){Q.font="".concat(k," ").concat(O,"px ").concat(J),Q.fillStyle="black",Q.textBaseline="middle"}function Ae(Q,J){for(var O=0;O<Q.length;O++)J.data[4*O+3]=Q[O]}var Ue=(Qe=(0,de.b2)(),Qe($e=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"fontAtlas",void 0),(0,$.Z)(this,"iconFontMap",void 0),(0,$.Z)(this,"iconFontGlyphs",{}),(0,$.Z)(this,"fontOptions",void 0),(0,$.Z)(this,"key",void 0),(0,$.Z)(this,"cache",new Je.z6(on))}return(0,Be.Z)(Q,[{key:"scale",get:function(){return dn}},{key:"canvas",get:function(){var O=this.cache.get(this.key);return O&&O.data}},{key:"mapping",get:function(){var O=this.cache.get(this.key);return O&&O.mapping}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:ce,fontWeight:Re,characterSet:Xr,fontSize:ge,buffer:xt,sdf:!0,cutoff:vt,radius:Nt,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(O){var k=this;O.forEach(function(oe){k.iconFontGlyphs[oe.name]=oe.unicode})}},{key:"addIconFont",value:function(O,k){this.iconFontMap.set(O,k)}},{key:"getIconFontKey",value:function(O){return this.iconFontMap.get(O)||O}},{key:"getGlyph",value:function(O){return this.iconFontGlyphs[O]?String.fromCharCode(parseInt(this.iconFontGlyphs[O],16)):""}},{key:"setFontOptions",value:function(O){this.fontOptions=qt(qt({},this.fontOptions),O),this.key=this.getKey();var k=this.getNewChars(this.key,this.fontOptions.characterSet),oe=this.cache.get(this.key);if(!(oe&&k.length===0)){var we=this.generateFontAtlas(this.key,k,oe);this.fontAtlas=we,this.cache.set(this.key,we)}}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(O,k,oe){var we=this.fontOptions,gt=we.fontFamily,Mt=we.fontWeight,St=we.fontSize,lr=we.buffer,Wr=we.sdf,Xn=we.radius,Un=we.cutoff,ci=we.iconfont,vi=oe&&oe.data;vi||(vi=document.createElement("canvas"),vi.width=Dt);var jn=vi.getContext("2d");me(jn,gt,St,Mt);var aa=Ct(qt({getFontWidth:function(ju){return jn.measureText(ju).width},fontHeight:St*dn,buffer:lr,characterSet:k,maxCanvasWidth:Dt},oe&&{mapping:oe.mapping,xOffset:oe.xOffset,yOffset:oe.yOffset})),da=aa.mapping,Sa=aa.canvasHeight,vo=aa.xOffset,Ca=aa.yOffset,Bo=jn.getImageData(0,0,vi.width,vi.height);if(vi.height=Sa,jn.putImageData(Bo,0,0),me(jn,gt,St,Mt),Wr){var Za=new(Gt())(St,lr,Xn,Un,gt,Mt),Ui=jn.getImageData(0,0,Za.size,Za.size),ga=Rt(k),io;try{for(ga.s();!(io=ga.n()).done;){var So=io.value;if(ci){var Oi=String.fromCharCode(parseInt(So.replace("&#x","").replace(";",""),16)),co=Za.draw(Oi);Ae(co,Ui)}else Ae(Za.draw(So),Ui);jn.putImageData(Ui,da[So].x,da[So].y)}}catch(Hs){ga.e(Hs)}finally{ga.f()}}else{var Ka=Rt(k),Js;try{for(Ka.s();!(Js=Ka.n()).done;){var Vl=Js.value;jn.fillText(Vl,da[Vl].x,da[Vl].y+St*Ur)}}catch(Hs){Ka.e(Hs)}finally{Ka.f()}}return{xOffset:vo,yOffset:Ca,mapping:da,data:vi,width:vi.width,height:vi.height}}},{key:"getKey",value:function(){return"key";var O,k,oe,we,gt,Mt,St,lr}},{key:"getNewChars",value:function(O,k){var oe=this.cache.get(O);if(!oe)return k;var we=[],gt=oe.mapping,Mt=new Set(Object.keys(gt)),St=new Set(k);return St.forEach(function(lr){Mt.has(lr)||we.push(lr)}),we}}]),Q}())||$e),Le=S(63349),kt=S(10379),nr=S(46070),_r=S(77608),Lr,fr;function H(Q){var J=E();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function E(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var V=3,Ze=1024,tt=64,ut=(Lr=(0,de.b2)(),Lr(fr=function(Q){(0,kt.Z)(O,Q);var J=H(O);function O(){var k;(0,se.Z)(this,O);for(var oe=arguments.length,we=new Array(oe),gt=0;gt<oe;gt++)we[gt]=arguments[gt];return k=J.call.apply(J,[this].concat(we)),(0,$.Z)((0,Le.Z)(k),"canvasHeight",128),(0,$.Z)((0,Le.Z)(k),"texture",void 0),(0,$.Z)((0,Le.Z)(k),"canvas",void 0),(0,$.Z)((0,Le.Z)(k),"iconData",void 0),(0,$.Z)((0,Le.Z)(k),"iconMap",void 0),(0,$.Z)((0,Le.Z)(k),"ctx",void 0),(0,$.Z)((0,Le.Z)(k),"loadingImageCount",0),k}return(0,Be.Z)(O,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(oe,we){var gt=this,Mt=new Image;if(this.loadingImageCount++,this.hasImage(oe))throw new Error("Image Id already exists");this.iconData.push({id:oe,size:tt}),this.updateIconMap(),this.loadImage(we).then(function(St){Mt=St;var lr=gt.iconData.find(function(Wr){return Wr.id===oe});lr&&(lr.image=Mt,lr.width=Mt.width,lr.height=Mt.height),gt.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(oe){return this.iconMap.hasOwnProperty(oe)}},{key:"removeImage",value:function(oe){this.hasImage(oe)&&(this.iconData=this.iconData.filter(function(we){return we.id!==oe}),delete this.iconMap[oe],this.update())}},{key:"destroy",value:function(){this.iconData=[],this.iconMap={}}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var oe=this;this.canvas.width=Ze,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(we){var gt=oe.iconMap[we],Mt=gt.x,St=gt.y,lr=gt.image,Wr=gt.width,Xn=Wr===void 0?64:Wr,Un=gt.height,ci=Un===void 0?64:Un,vi=Math.max(Xn,ci),jn=vi/tt,aa=ci/jn,da=Xn/jn;lr&&oe.ctx.drawImage(lr,Mt+(tt-da)/2,St+(tt-aa)/2,da,aa)})}},{key:"updateIconMap",value:function(){var oe=br(this.iconData,V,Ze),we=oe.mapping,gt=oe.canvasHeight;this.iconMap=we,this.canvasHeight=gt}},{key:"loadImage",value:function(oe){return new Promise(function(we,gt){if(oe instanceof HTMLImageElement){we(oe);return}var Mt=new Image;Mt.crossOrigin="anonymous",Mt.onload=function(){we(Mt)},Mt.onerror=function(){gt(new Error("Could not load image at "+oe))},Mt.src=oe instanceof File?URL.createObjectURL(oe):oe})}}]),O}(C.EventEmitter))||fr),wt=S(28481),K=S(85975),Ht,Tr,Or=(Ht=(0,de.b2)(),Ht(Tr=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"viewport",void 0),(0,$.Z)(this,"overridedViewProjectionMatrix",void 0),(0,$.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,$.Z)(this,"jitteredProjectionMatrix",void 0),(0,$.Z)(this,"viewMatrixInverse",void 0),(0,$.Z)(this,"cameraPosition",void 0)}return(0,Be.Z)(Q,[{key:"init",value:function(){}},{key:"update",value:function(O){this.viewport=O,this.viewMatrixInverse=K.create(),K.invert(this.viewMatrixInverse,O.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var O=this.viewport.getCenter(),k=(0,wt.Z)(O,2),oe=k[0],we=k[1];return[oe,we]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(O,k){return this.viewport.projectFlat(O,k)}},{key:"setViewProjectionMatrix",value:function(O){this.overridedViewProjectionMatrix=O}},{key:"jitterProjectionMatrix",value:function(O,k){var oe=K.fromTranslation(K.create(),[O,k,0]);this.jitteredProjectionMatrix=K.multiply(K.create(),oe,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=K.multiply(K.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),Q}())||Tr),Ye,lt;function At(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=zt(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var k=0,oe=function(){};return{s:oe,n:function(){return k>=Q.length?{done:!0}:{done:!1,value:Q[k++]}},e:function(lr){throw lr},f:oe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var we=!0,gt=!1,Mt;return{s:function(){O=O.call(Q)},n:function(){var lr=O.next();return we=lr.done,lr},e:function(lr){gt=!0,Mt=lr},f:function(){try{!we&&O.return!=null&&O.return()}finally{if(gt)throw Mt}}}}function zt(Q,J){if(!!Q){if(typeof Q=="string")return wr(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return wr(Q,J)}}function wr(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,k=new Array(J);O<J;O++)k[O]=Q[O];return k}var Pr=(Ye=(0,de.b2)(),Ye(lt=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"container",void 0),(0,$.Z)(this,"controlCorners",void 0),(0,$.Z)(this,"controlContainer",void 0),(0,$.Z)(this,"scene",void 0),(0,$.Z)(this,"mapsService",void 0),(0,$.Z)(this,"controls",[]),(0,$.Z)(this,"unAddControls",[])}return(0,Be.Z)(Q,[{key:"init",value:function(O,k){this.container=O.container,this.scene=k,this.mapsService=k.get(ie.v.IMapService),this.initControlPos()}},{key:"addControl",value:function(O,k){var oe=k.get(ie.v.IMapService);oe.map?(O.addTo(this.scene),this.controls.push(O)):this.unAddControls.push(O)}},{key:"getControlByName",value:function(O){return this.controls.find(function(k){return k.controlOption.name===O})}},{key:"removeControl",value:function(O){var k=this.controls.indexOf(O);return k>-1&&this.controls.splice(k,1),O.remove(),this}},{key:"addControls",value:function(){var O=this;this.unAddControls.forEach(function(k){k.addTo(O.scene),O.controls.push(k)}),this.unAddControls=[]}},{key:"destroy",value:function(){var O=At(this.controls),k;try{for(O.s();!(k=O.n()).done;){var oe=k.value;oe.remove()}}catch(we){O.e(we)}finally{O.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var O=this.controlCorners={},k="l7-",oe=this.controlContainer=Je.SO.create("div",k+"control-container",this.container);function we(){var gt=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],Mt=gt.map(function(St){return k+St}).join(" ");O[gt.join("")]=Je.SO.create("div",Mt,oe)}we(["top","left"]),we(["top","right"]),we(["bottom","left"]),we(["bottom","right"]),we(["top","center"]),we(["right","center"]),we(["left","center"]),we(["bottom","center"])}},{key:"clearControlPos",value:function(){for(var O in this.controlCorners)this.controlCorners[O]&&Je.SO.remove(this.controlCorners[O]);this.controlContainer&&Je.SO.remove(this.controlContainer),delete this.controlCorners,delete this.controlContainer}}]),Q}())||lt),er,Jr,Yr=(er=(0,de.b2)(),er(Jr=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"container",void 0),(0,$.Z)(this,"scene",void 0),(0,$.Z)(this,"mapsService",void 0),(0,$.Z)(this,"markers",[]),(0,$.Z)(this,"markerLayers",[]),(0,$.Z)(this,"unAddMarkers",[]),(0,$.Z)(this,"unAddMarkerLayers",[])}return(0,Be.Z)(Q,[{key:"addMarkerLayer",value:function(O){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(O),O.addTo(this.scene)):this.unAddMarkerLayers.push(O)}},{key:"removeMarkerLayer",value:function(O){O.destroy(),this.markerLayers.indexOf(O);var k=this.markerLayers.indexOf(O);k>-1&&this.markerLayers.splice(k,1)}},{key:"addMarker",value:function(O){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(O),O.addTo(this.scene)):this.unAddMarkers.push(O)}},{key:"addMarkers",value:function(){var O=this;this.unAddMarkers.forEach(function(k){k.addTo(O.scene),O.markers.push(k)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var O=this;this.unAddMarkerLayers.forEach(function(k){O.markerLayers.push(k),k.addTo(O.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(O){O.remove(),this.markers.indexOf(O);var k=this.markers.indexOf(O);k>-1&&this.markers.splice(k,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(O){this.scene=O,this.mapsService=O.get(ie.v.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(O){O.remove()}),this.markers=[],this.markerLayers.forEach(function(O){O.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(O){O.destroy()}}]),Q}())||Jr),En,_n,ei=(En=(0,de.b2)(),En(_n=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"scene",void 0),(0,$.Z)(this,"popup",void 0),(0,$.Z)(this,"mapsService",void 0),(0,$.Z)(this,"unAddPopup",void 0)}return(0,Be.Z)(Q,[{key:"removePopup",value:function(O){O.remove()}},{key:"destroy",value:function(){this.popup.remove()}},{key:"addPopup",value:function(O){this.popup&&this.popup.remove(),this.mapsService.map&&this.mapsService.getMarkerContainer()?(O.addTo(this.scene),this.popup=O):this.unAddPopup=O}},{key:"initPopup",value:function(){this.unAddPopup&&(this.addPopup(this.unAddPopup),this.unAddPopup=null)}},{key:"init",value:function(O){this.scene=O,this.mapsService=O.get(ie.v.IMapService)}}]),Q}())||_n),si=S(82492),na=S.n(si),Zi={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo\u6D4B\u8BD5\u5730\u56FEtoken\uFF0C\u5982\u679C\u751F\u4EA7\u73AF\u5883\u4E2D\u4F7F\u7528\u53BB\u5BF9\u5E94\u5730\u56FE\u8BF7\u6CE8\u518CToken",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Pi=Zi,X,ue;function pe(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function F(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?pe(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):pe(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}var ee={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},he={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",selectColor:"blue",enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Te=(X=(0,de.b2)(),X(ue=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"sceneConfigCache",{}),(0,$.Z)(this,"layerConfigCache",{})}return(0,Be.Z)(Q,[{key:"getSceneConfig",value:function(O){return this.sceneConfigCache[O]}},{key:"getSceneWarninfo",value:function(O){return Pi[O]}},{key:"setSceneConfig",value:function(O,k){this.sceneConfigCache[O]=F(F({},ee),k)}},{key:"getLayerConfig",value:function(O){return this.layerConfigCache[O]}},{key:"setLayerConfig",value:function(O,k,oe){this.layerConfigCache[k]=F({},na()({},this.sceneConfigCache[O],he,oe))}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),Q}())||ue),ae=S(55770),Ee=S(3473),mt=S(98333),Sr=Math.PI/180,Wt=512,Ke=4003e4;function Zr(Q){var J=Q.latitude,O=J===void 0?0:J,k=Q.zoom,oe=k===void 0?0:k,we=Q.scale,gt=Q.highPrecision,Mt=gt===void 0?!1:gt,St=Q.flipY,lr=St===void 0?!1:St;we=we!==void 0?we:Math.pow(2,oe);var Wr={},Xn=Wt*we,Un=Math.cos(O*Sr),ci=Xn/360,vi=ci/Un,jn=Xn/Ke/Un;if(Wr.pixelsPerMeter=[jn,-jn,jn],Wr.metersPerPixel=[1/jn,-1/jn,1/jn],Wr.pixelsPerDegree=[ci,-vi,jn],Wr.degreesPerPixel=[1/ci,-1/vi,1/jn],Mt){var aa=Sr*Math.tan(O*Sr)/Un,da=ci*aa/2,Sa=Xn/Ke*aa,vo=Sa/vi*jn;Wr.pixelsPerDegree2=[0,-da,Sa],Wr.pixelsPerMeter2=[vo,0,vo],lr&&(Wr.pixelsPerDegree2[1]=-Wr.pixelsPerDegree2[1],Wr.pixelsPerMeter2[1]=-Wr.pixelsPerMeter2[1])}return lr&&(Wr.pixelsPerMeter[1]=-Wr.pixelsPerMeter[1],Wr.metersPerPixel[1]=-Wr.metersPerPixel[1],Wr.pixelsPerDegree[1]=-Wr.pixelsPerDegree[1],Wr.degreesPerPixel[1]=-Wr.degreesPerPixel[1]),Wr}var kn=S(47282),Rn,ft,vr,et,Dr,In=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],tr=(Rn=(0,de.b2)(),ft=(0,de.f3)(ie.v.ICameraService),Rn(vr=(et=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"needRefresh",!0),(0,ae.Z)(this,"cameraService",Dr,this),(0,$.Z)(this,"coordinateSystem",void 0),(0,$.Z)(this,"viewportCenter",void 0),(0,$.Z)(this,"viewportCenterProjection",void 0),(0,$.Z)(this,"pixelsPerDegree",void 0),(0,$.Z)(this,"pixelsPerDegree2",void 0),(0,$.Z)(this,"pixelsPerMeter",void 0)}return(0,Be.Z)(Q,[{key:"refresh",value:function(){var O=this.cameraService.getZoom(),k=this.cameraService.getZoomScale(),oe=this.cameraService.getCenter(),we=Zr({latitude:oe[1],zoom:O}),gt=we.pixelsPerMeter,Mt=we.pixelsPerDegree;this.viewportCenter=oe,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=gt,this.pixelsPerDegree=Mt,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===kn.l.LNGLAT||this.coordinateSystem===kn.l.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===kn.l.LNGLAT_OFFSET?this.calculateLnglatOffset(oe,O):this.coordinateSystem===kn.l.P20_OFFSET&&this.calculateLnglatOffset(oe,O,k,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(O){this.coordinateSystem=O}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(O,k,oe,we){var gt=Zr({latitude:O[1],zoom:k,scale:oe,flipY:we,highPrecision:!0}),Mt=gt.pixelsPerMeter,St=gt.pixelsPerDegree,lr=gt.pixelsPerDegree2,Wr=this.cameraService.getViewMatrix(),Xn=this.cameraService.getProjectionMatrix(),Un=K.multiply([],Xn,Wr),ci=this.cameraService.projectFlat([Math.fround(O[0]),Math.fround(O[1])],Math.pow(2,k));this.viewportCenterProjection=mt.fF([],[ci[0],ci[1],0,1],Un),Wr=this.cameraService.getViewMatrixUncentered()||Wr,Un=K.multiply([],Xn,Wr),Un=K.multiply([],Un,In),this.cameraService.setViewProjectionMatrix(Un),this.pixelsPerMeter=Mt,this.pixelsPerDegree=St,this.pixelsPerDegree2=lr}}]),Q}(),Dr=(0,Ee.Z)(et.prototype,"cameraService",[ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),et))||vr),Ni=S(50840),ia=S.n(Ni),hi=S(89648),Fi,Wi,yi,ya,La;function _i(Q){var J=Mi();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Mi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Ji={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},to=(Fi=(0,de.b2)(),Wi=(0,de.f3)(ie.v.IMapService),Fi(yi=(ya=function(Q){(0,kt.Z)(O,Q);var J=_i(O);function O(){var k;(0,se.Z)(this,O);for(var oe=arguments.length,we=new Array(oe),gt=0;gt<oe;gt++)we[gt]=arguments[gt];return k=J.call.apply(J,[this].concat(we)),(0,ae.Z)((0,Le.Z)(k),"mapService",La,(0,Le.Z)(k)),(0,$.Z)((0,Le.Z)(k),"hammertime",void 0),(0,$.Z)((0,Le.Z)(k),"lastClickTime",0),(0,$.Z)((0,Le.Z)(k),"lastClickXY",[-1,-1]),(0,$.Z)((0,Le.Z)(k),"clickTimer",void 0),(0,$.Z)((0,Le.Z)(k),"$containter",void 0),(0,$.Z)((0,Le.Z)(k),"onDrag",function(Mt){var St=k.interactionEvent(Mt);St.type=Ji[St.type],k.emit(hi.s.Drag,St)}),(0,$.Z)((0,Le.Z)(k),"onHammer",function(Mt){Mt.srcEvent.stopPropagation();var St=k.interactionEvent(Mt);k.emit(hi.s.Hover,St)}),(0,$.Z)((0,Le.Z)(k),"onTouch",function(Mt){var St=Mt.touches[0];k.onHover({x:St.pageX,y:St.pageY,type:"touch"})}),(0,$.Z)((0,Le.Z)(k),"onHover",function(Mt){var St=Mt.clientX,lr=Mt.clientY,Wr=St,Xn=lr,Un=Mt.type,ci=k.mapService.getMapContainer();if(ci){var vi=ci.getBoundingClientRect(),jn=vi.top,aa=vi.left;Wr=Wr-aa-ci.clientLeft,Xn=Xn-jn-ci.clientTop}var da=k.mapService.containerToLngLat([Wr,Xn]);if(Un==="click"){if("ontouchstart"in document.documentElement)return;k.isDoubleTap(Wr,Xn,da);return}if(Un==="touch"){k.isDoubleTap(Wr,Xn,da);return}Un!=="click"&&Un!=="dblclick"&&k.emit(hi.s.Hover,{x:Wr,y:Xn,lngLat:da,type:Un,target:Mt})}),k}return(0,Be.Z)(O,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(hi.s.Hover)}},{key:"triggerHover",value:function(oe){var we=oe.x,gt=oe.y;this.emit(hi.s.Hover,{x:we,y:gt})}},{key:"triggerSelect",value:function(oe){this.emit(hi.s.Select,{featureId:oe})}},{key:"triggerActive",value:function(oe){this.emit(hi.s.Active,{featureId:oe})}},{key:"addEventListenerOnMap",value:function(){var oe=this.mapService.getMapContainer();if(oe){var we=new(ia()).Manager(oe);we.add(new(ia()).Tap({event:"dblclick",taps:2})),we.add(new(ia()).Tap({event:"click"})),we.add(new(ia()).Pan({threshold:0,pointers:0})),we.add(new(ia()).Press({})),we.on("dblclick click",this.onHammer),we.on("panstart panmove panend pancancel",this.onDrag),oe.addEventListener("mousemove",this.onHover),oe.addEventListener("mousedown",this.onHover,!0),oe.addEventListener("mouseup",this.onHover),oe.addEventListener("contextmenu",this.onHover),this.hammertime=we}}},{key:"removeEventListenerOnMap",value:function(){var oe=this.mapService.getMapContainer();oe&&(oe.removeEventListener("mousemove",this.onHover),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),oe.removeEventListener("mousedown",this.onHover),oe.removeEventListener("mouseup",this.onHover),oe.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(oe){var we=oe.type,gt=oe.pointerType,Mt,St;gt==="touch"?(St=Math.floor(oe.pointers[0].clientY),Mt=Math.floor(oe.pointers[0].clientX)):(St=Math.floor(oe.srcEvent.y),Mt=Math.floor(oe.srcEvent.x));var lr=this.mapService.getMapContainer();if(lr){var Wr=lr.getBoundingClientRect(),Xn=Wr.top,Un=Wr.left;Mt-=Un,St-=Xn}var ci=this.mapService.containerToLngLat([Mt,St]);return{x:Mt,y:St,lngLat:ci,type:we,target:oe.srcEvent}}},{key:"isDoubleTap",value:function(oe,we,gt){var Mt=this,St=new Date().getTime(),lr="click";St-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-oe)<10&&Math.abs(this.lastClickXY[1]-we)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),lr="dblclick",this.emit(hi.s.Hover,{x:oe,y:we,lngLat:gt,type:lr})):(this.lastClickTime=St,this.lastClickXY=[oe,we],this.clickTimer=setTimeout(function(){lr="click",Mt.emit(hi.s.Hover,{x:oe,y:we,lngLat:gt,type:lr})},400))}}]),O}(d()),La=(0,Ee.Z)(ya.prototype,"mapService",[Wi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ya))||yi),jo=S(92137),ja=S(87757),Xi=S.n(ja),du=window.document.documentElement.style,ku=0;function Ba(Q){var J=Q;if(typeof Q=="string"&&(J=document.getElementById(Q)),J){var O=document.createElement("div");return O.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,O.id="l7-scene-".concat(ku++),O.classList.add("l7-scene"),J.appendChild(O),O}return null}function Vo(Q){var J,O,k=!0;return Q==null||(J=Q.target)===null||J===void 0||(O=J.path)===null||O===void 0||O.map(function(oe){if(oe!=null&&oe.classList){var we;oe==null||(we=oe.classList)===null||we===void 0||we.forEach(function(gt){(gt==="l7-marker"||gt==="l7-popup")&&(k=!1)})}}),k}var Yi=S(7648),ro,Jo,xa,Lo,No,Us,_o,Qo,Va,uo,ss;function Co(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function _e(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Co(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Co(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}var De=(ro=(0,de.b2)(),Jo=(0,de.f3)(ie.v.IRendererService),xa=(0,de.f3)(ie.v.IGlobalConfigService),Lo=(0,de.f3)(ie.v.IInteractionService),No=(0,de.f3)(ie.v.ILayerService),ro(Us=(_o=function(){function Q(){var J=this;(0,se.Z)(this,Q),(0,ae.Z)(this,"rendererService",Qo,this),(0,ae.Z)(this,"configService",Va,this),(0,ae.Z)(this,"interactionService",uo,this),(0,ae.Z)(this,"layerService",ss,this),(0,$.Z)(this,"pickingFBO",void 0),(0,$.Z)(this,"width",0),(0,$.Z)(this,"height",0),(0,$.Z)(this,"alreadyInPicking",!1),(0,$.Z)(this,"pickBufferScale",1),(0,$.Z)(this,"pickFromPickingFBO",function(O,k){var oe,we=k.x,gt=k.y,Mt=k.lngLat,St=k.type,lr=k.target,Wr=!1,Xn=J.rendererService,Un=Xn.getViewportSize,ci=Xn.readPixels,vi=Xn.getContainer,jn=vi().getBoundingClientRect(),aa=jn.width,da=jn.height;aa*=Je.SO.DPR,da*=Je.SO.DPR;var Sa=O.getLayerConfig(),vo=Sa.enableHighlight,Ca=Sa.enableSelect,Bo=we*Je.SO.DPR,Za=gt*Je.SO.DPR;if(Bo>aa-1*Je.SO.DPR||Bo<0||Za>da-1*Je.SO.DPR||Za<0)return!1;var Ui;if(Ui=ci({x:Math.floor(Bo/J.pickBufferScale),y:Math.floor((da-(gt+1)*Je.SO.DPR)/J.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:J.pickingFBO}),Ui[0]!==0||Ui[1]!==0||Ui[2]!==0){var ga=(0,Je.W0)(Ui),io=O.getSource().getFeatureById(ga);ga!==O.getCurrentPickId()&&St==="mousemove"&&(St="mouseenter");var So={x:we,y:gt,type:St,lngLat:Mt,featureId:ga,feature:io,target:lr};io&&(Wr=!0,O.setCurrentPickId(ga),J.triggerHoverOnLayer(O,So))}else{var Oi={x:we,y:gt,lngLat:Mt,type:O.getCurrentPickId()!==null&&St==="mousemove"?"mouseout":"un"+St,featureId:null,target:lr,feature:null};J.triggerHoverOnLayer(O,_e(_e({},Oi),{},{type:"unpick"})),J.triggerHoverOnLayer(O,Oi),O.setCurrentPickId(null)}if(vo&&J.highlightPickedFeature(O,Ui),Ca&&St==="click"&&((oe=Ui)===null||oe===void 0?void 0:oe.toString())!==[0,0,0,0].toString()){var co=(0,Je.W0)(Ui);O.getCurrentSelectedId()===null||co!==O.getCurrentSelectedId()?(J.selectFeature(O,Ui),O.setCurrentSelectedId(co)):(J.selectFeature(O,new Uint8Array([0,0,0,0])),O.setCurrentSelectedId(null))}return Wr})}return(0,Be.Z)(Q,[{key:"init",value:function(O){var k=this.rendererService,oe=k.createTexture2D,we=k.createFramebuffer,gt=k.getViewportSize,Mt=k.getContainer,St=Mt().getBoundingClientRect(),lr=St.width,Wr=St.height;lr*=Je.SO.DPR,Wr*=Je.SO.DPR,this.pickBufferScale=this.configService.getSceneConfig(O).pickBufferScale||1,this.pickingFBO=we({color:oe({width:Math.round(lr/this.pickBufferScale),height:Math.round(Wr/this.pickBufferScale),wrapS:Yi.gl.CLAMP_TO_EDGE,wrapT:Yi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var J=(0,jo.Z)(Xi().mark(function k(oe,we,gt){var Mt=this,St,lr,Wr,Xn;return Xi().wrap(function(ci){for(;;)switch(ci.prev=ci.next){case 0:St=this.rendererService,lr=St.useFramebuffer,Wr=St.clear,Xn=St.getContainer,this.resizePickingFBO(),lr(this.pickingFBO,function(){Wr({framebuffer:Mt.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),oe.hooks.beforePickingEncode.call(),oe.renderModels(),oe.hooks.afterPickingEncode.call();var vi=Mt.pickBox(oe,we);gt(vi)});case 3:case"end":return ci.stop()}},k,this)}));function O(k,oe,we){return J.apply(this,arguments)}return O}()},{key:"pickBox",value:function(O,k){var oe=this,we=k.map(function(Oi){var co=Oi<0?0:Oi;return Math.floor(co*Je.SO.DPR/oe.pickBufferScale)}),gt=(0,wt.Z)(we,4),Mt=gt[0],St=gt[1],lr=gt[2],Wr=gt[3],Xn=this.rendererService,Un=Xn.getViewportSize,ci=Xn.readPixels,vi=Xn.getContainer,jn=vi().getBoundingClientRect(),aa=jn.width,da=jn.height;if(aa*=Je.SO.DPR,da*=Je.SO.DPR,Mt>(aa-1)*Je.SO.DPR/this.pickBufferScale||lr<0||St>(da-1)*Je.SO.DPR/this.pickBufferScale||Wr<0)return[];var Sa,vo=Math.min(aa/this.pickBufferScale,lr)-Mt,Ca=Math.min(da/this.pickBufferScale,Wr)-St;Sa=ci({x:Mt,y:Math.floor(da/this.pickBufferScale-(Wr+1)),width:vo,height:Ca,data:new Uint8Array(vo*Ca*4),framebuffer:this.pickingFBO});for(var Bo=[],Za={},Ui=0;Ui<Sa.length/4;Ui=Ui+1){var ga=Sa.slice(Ui*4,Ui*4+4),io=(0,Je.W0)(ga);if(io!==-1&&!Za[io]){var So=O.getSource().getFeatureById(io);Bo.push(So),Za[io]=!0}}return Bo}},{key:"pickingAllLayer",value:function(){var J=(0,jo.Z)(Xi().mark(function k(oe){return Xi().wrap(function(gt){for(;;)switch(gt.prev=gt.next){case 0:if(!(this.alreadyInPicking||this.layerService.alreadyInRendering)){gt.next=2;break}return gt.abrupt("return");case 2:return this.alreadyInPicking=!0,gt.next=5,this.pickingLayers(oe);case 5:this.layerService.renderLayers("picking"),this.alreadyInPicking=!1;case 7:case"end":return gt.stop()}},k,this)}));function O(k){return J.apply(this,arguments)}return O}()},{key:"resizePickingFBO",value:function(){var O=this.rendererService.getContainer,k=O().getBoundingClientRect(),oe=k.width,we=k.height;oe*=Je.SO.DPR,we*=Je.SO.DPR,(this.width!==oe||this.height!==we)&&(this.pickingFBO.resize({width:Math.round(oe/this.pickBufferScale),height:Math.round(we/this.pickBufferScale)}),this.width=oe,this.height=we)}},{key:"pickingLayers",value:function(){var J=(0,jo.Z)(Xi().mark(function k(oe){var we=this,gt,Mt,St,lr,Wr;return Xi().wrap(function(Un){for(;;)switch(Un.prev=Un.next){case 0:gt=this.rendererService,Mt=gt.getViewportSize,St=gt.useFramebuffer,lr=gt.clear,Wr=gt.getContainer,this.resizePickingFBO(),St(this.pickingFBO,function(){var ci=we.layerService.getLayers();ci.filter(function(vi){return vi.needPick(oe.type)}).reverse().some(function(vi){lr({framebuffer:we.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),vi.hooks.beforePickingEncode.call(),vi.renderModels(),vi.hooks.afterPickingEncode.call();var jn=we.pickFromPickingFBO(vi,oe);return jn&&!vi.getLayerConfig().enablePropagation})});case 3:case"end":return Un.stop()}},k,this)}));function O(k){return J.apply(this,arguments)}return O}()},{key:"triggerHoverOnLayer",value:function(O,k){Vo(k)&&O.emit(k.type,k)}},{key:"highlightPickedFeature",value:function(O,k){var oe=(0,wt.Z)(k,3),we=oe[0],gt=oe[1],Mt=oe[2];O.hooks.beforeHighlight.call([we,gt,Mt])}},{key:"selectFeature",value:function(O,k){var oe=(0,wt.Z)(k,3),we=oe[0],gt=oe[1],Mt=oe[2];O.hooks.beforeSelect.call([we,gt,Mt])}}]),Q}(),Qo=(0,Ee.Z)(_o.prototype,"rendererService",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Va=(0,Ee.Z)(_o.prototype,"configService",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uo=(0,Ee.Z)(_o.prototype,"interactionService",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ss=(0,Ee.Z)(_o.prototype,"layerService",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_o))||Us),pt=function(){function Q(){var J=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,se.Z)(this,Q),(0,$.Z)(this,"autoStart",void 0),(0,$.Z)(this,"startTime",0),(0,$.Z)(this,"oldTime",0),(0,$.Z)(this,"running",!1),(0,$.Z)(this,"elapsedTime",0),this.autoStart=J}return(0,Be.Z)(Q,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var O=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var k=(typeof performance=="undefined"?Date:performance).now();O=(k-this.oldTime)/1e3,this.oldTime=k,this.elapsedTime+=O}return O}}]),Q}(),$t,en,ti,Ai,ha,Na,po,us,vu,Au=($t=(0,de.b2)(),en=(0,de.f3)(ie.v.IRendererService),ti=(0,de.f3)(ie.v.IMapService),Ai=(0,de.f3)(ie.v.IGlobalConfigService),$t(ha=(Na=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"clock",new pt),(0,$.Z)(this,"alreadyInRendering",!1),(0,$.Z)(this,"layers",[]),(0,$.Z)(this,"layerRenderID",void 0),(0,$.Z)(this,"sceneInited",!1),(0,$.Z)(this,"animateInstanceCount",0),(0,$.Z)(this,"lastRenderType",void 0),(0,$.Z)(this,"lastPickRenderTime",void 0),(0,ae.Z)(this,"renderService",po,this),(0,ae.Z)(this,"mapService",us,this),(0,ae.Z)(this,"configService",vu,this)}return(0,Be.Z)(Q,[{key:"add",value:function(O){this.sceneInited&&O.init(),this.layers.push(O)}},{key:"initLayers",value:function(){this.sceneInited=!0,this.layers.forEach(function(O){O.inited||O.init()})}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(O){return this.layers.find(function(k){return k.id===O})}},{key:"getLayerByName",value:function(O){return this.layers.find(function(k){return k.name===O})}},{key:"remove",value:function(O){var k=this.layers.indexOf(O);k>-1&&this.layers.splice(k,1),O.emit("remove",null),O.destroy(),this.renderLayers()}},{key:"removeAllLayers",value:function(){this.destroy()}},{key:"renderLayers",value:function(O){!this.renderTest(O)||this.alreadyInRendering||(this.alreadyInRendering=!0,this.clear(),this.updateRenderOrder(),this.layers.filter(function(k){return k.inited}).filter(function(k){return k.isVisible()}).forEach(function(k){k.hooks.beforeRenderData.call(),k.hooks.beforeRender.call(),k.render(),k.hooks.afterRender.call()}),this.alreadyInRendering=!1)}},{key:"updateRenderOrder",value:function(){this.layers.sort(function(O,k){return O.zIndex-k.zIndex})}},{key:"destroy",value:function(){this.layers.forEach(function(O){return O.destroy()}),this.layers=[],this.renderLayers()}},{key:"startAnimate",value:function(){this.animateInstanceCount++==0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount==0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"renderTest",value:function(O){var k=new Date().getTime(),oe=k-this.lastPickRenderTime;if(O==="picking"&&(this.lastPickRenderTime=new Date().getTime()),O)switch(O){case"picking":return this.lastRenderType==="mapRender"||this.lastRenderType==="animate"?(this.lastRenderType="picking",oe>48):(this.lastRenderType="picking",!0);case"animate":return this.lastRenderType==="mapRender"?(this.lastRenderType="animate",!1):(this.lastRenderType="animate",!0);case"mapRender":return this.lastRenderType="mapRender",!0;default:return!0}return!0}},{key:"clear",value:function(){var O=(0,Je.CI)(this.mapService.bgColor);this.renderService.clear({color:O,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers("animate"),this.layerRenderID=requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){cancelAnimationFrame(this.layerRenderID)}}]),Q}(),po=(0,Ee.Z)(Na.prototype,"renderService",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),us=(0,Ee.Z)(Na.prototype,"mapService",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vu=(0,Ee.Z)(Na.prototype,"configService",[Ai],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Na))||ha),Xu=S(81253),Go=S(85061),qo=S(14293),ls=S.n(qo),ys=function(){function Q(J){var O=this;(0,se.Z)(this,Q),(0,$.Z)(this,"name",void 0),(0,$.Z)(this,"type",void 0),(0,$.Z)(this,"scale",void 0),(0,$.Z)(this,"descriptor",void 0),(0,$.Z)(this,"featureBufferLayout",[]),(0,$.Z)(this,"needRescale",!1),(0,$.Z)(this,"needRemapping",!1),(0,$.Z)(this,"needRegenerateVertices",!1),(0,$.Z)(this,"featureRange",{startIndex:0,endIndex:Infinity}),(0,$.Z)(this,"vertexAttribute",void 0),(0,$.Z)(this,"defaultCallback",function(k){if(k.length===0){var oe;return((oe=O.scale)===null||oe===void 0?void 0:oe.defaultValues)||[]}return k.map(function(we,gt){var Mt,St=(Mt=O.scale)===null||Mt===void 0?void 0:Mt.scalers[gt].func,lr=St(we);return lr})}),this.setProps(J)}return(0,Be.Z)(Q,[{key:"setProps",value:function(O){Object.assign(this,O)}},{key:"mapping",value:function(O){var k;if((k=this.scale)!==null&&k!==void 0&&k.callback){var oe,we=(oe=this.scale)===null||oe===void 0?void 0:oe.callback.apply(oe,(0,Go.Z)(O));if(!ls()(we))return[we]}return this.defaultCallback(O)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),Q}(),Ho,Ws,ru,Is,Ta,Ro;function gl(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function U(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?gl(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):gl(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function nl(Q){return new Promise(function(J){return setTimeout(J,Q)})}var Rl=(Ho={},(0,$.Z)(Ho,Yi.gl.FLOAT,4),(0,$.Z)(Ho,Yi.gl.UNSIGNED_BYTE,1),(0,$.Z)(Ho,Yi.gl.UNSIGNED_SHORT,2),Ho),yl=(Ws=(0,de.b2)(),ru=(0,de.f3)(ie.v.IRendererService),Ws(Is=(Ta=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"attributesAndIndices",void 0),(0,ae.Z)(this,"rendererService",Ro,this),(0,$.Z)(this,"attributes",[]),(0,$.Z)(this,"triangulation",void 0),(0,$.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,Be.Z)(Q,[{key:"registerStyleAttribute",value:function(O){var k=this.getLayerStyleAttribute(O.name||"");return k?k.setProps(O):(k=new ys(O),this.attributes.push(k)),k}},{key:"updateStyleAttribute",value:function(O,k,oe){var we=this.getLayerStyleAttribute(O);we||(we=this.registerStyleAttribute(U(U({},k),{},{name:O})));var gt=k.scale;gt&&we&&(we.scale=gt,we.needRescale=!0,we.needRemapping=!0,we.needRegenerateVertices=!0,oe&&oe.featureRange&&(we.featureRange=oe.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(O){return this.attributes.find(function(k){return k.name===O})}},{key:"getLayerAttributeScale",value:function(O){var k,oe=this.getLayerStyleAttribute(O),we=oe==null||(k=oe.scale)===null||k===void 0?void 0:k.scalers;return we&&we[0]?we[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(O,k){var oe=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,we=arguments.length>3?arguments[3]:void 0,gt=this.attributes.find(function(Ca){return Ca.name===O});if(gt&&gt.descriptor){var Mt=gt.descriptor,St=Mt.update,lr=Mt.buffer,Wr=Mt.size,Xn=Wr===void 0?0:Wr,Un=Rl[lr.type||Yi.gl.FLOAT];if(St){var ci=this.featureLayout,vi=ci.elements,jn=ci.sizePerElement,aa=vi.slice(oe,we);if(!aa.length)return;var da=aa[0].offset,Sa=da*Xn*Un,vo=aa.map(function(Ca,Bo){for(var Za=Ca.featureIdx,Ui=Ca.vertices,ga=Ca.normals,io=Ui.length/jn,So=[],Oi=0;Oi<io;Oi++){var co=ga?ga.slice(Oi*3,Oi*3+3):[];So.push.apply(So,(0,Go.Z)(St(k[Za],Za,Ui.slice(Oi*jn,Oi*jn+jn),Bo,co)))}return So}).reduce(function(Ca,Bo){return Ca.push.apply(Ca,(0,Go.Z)(Bo)),Ca},[]);gt.vertexAttribute.updateBuffer({data:vo,offset:Sa})}}}},{key:"createAttributesAndIndices",value:function(O,k,oe){var we=this;this.featureLayout={sizePerElement:0,elements:[]},k&&(this.triangulation=k);var gt=this.attributes.map(function(Sa){return Sa.resetDescriptor(),Sa.descriptor}),Mt=0,St=[],lr=[],Wr=[],Xn=3;O.forEach(function(Sa,vo){var Ca=we.triangulation(Sa,oe),Bo=Ca.indices,Za=Ca.vertices,Ui=Ca.normals,ga=Ca.size;Bo.forEach(function(co){lr.push(co+Mt)}),Xn=ga;var io=Za.length/ga;we.featureLayout.sizePerElement=Xn,we.featureLayout.elements.push({featureIdx:vo,vertices:Za,normals:Ui,offset:Mt}),Mt+=io;for(var So=function(Ka){var Js=(Ui==null?void 0:Ui.slice(Ka*3,Ka*3+3))||[],Vl=Za.slice(Ka*ga,Ka*ga+ga);gt.forEach(function(Hs,ju){if(Hs&&Hs.update){var Vu;(Vu=Hs.buffer.data).push.apply(Vu,(0,Go.Z)(Hs.update(Sa,vo,Vl,Ka,Js)))}})},Oi=0;Oi<io;Oi++)So(Oi)});var Un=this.rendererService,ci=Un.createAttribute,vi=Un.createBuffer,jn=Un.createElements,aa={};gt.forEach(function(Sa,vo){if(Sa){var Ca=Sa.buffer,Bo=Sa.update,Za=Sa.name,Ui=(0,Xu.Z)(Sa,["buffer","update","name"]),ga=ci(U({buffer:vi(Ca)},Ui));aa[Sa.name||""]=ga,we.attributes[vo].vertexAttribute=ga}});var da=jn({data:lr,type:Yi.gl.UNSIGNED_INT,count:lr.length});return this.attributesAndIndices={attributes:aa,elements:da},this.attributesAndIndices}},{key:"clearAllAttributes",value:function(){var O;this.attributes.forEach(function(k){k.vertexAttribute&&k.vertexAttribute.destroy()}),(O=this.attributesAndIndices)===null||O===void 0||O.elements.destroy(),this.attributes=[]}}]),Q}(),Ro=(0,Ee.Z)(Ta.prototype,"rendererService",[ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ta))||Is),il=S(46343),nu=S(67709),Fu=S.n(nu),m,w,N,I,le,Oe,ct,Ft,Ut,Fr,Kr,ni,Ii,bi,pa,Pa,za,Ti,_s,iu,Bu,tc,Yu,rc,mu,gu,Tu,xo,nc,yc,cs,ic,Xs;function sa(Q){var J=_c();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function _c(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var al=(m=(0,de.b2)(),w=(0,de.f3)(ie.v.SceneID),N=(0,de.f3)(ie.v.IIconService),I=(0,de.f3)(ie.v.IFontService),le=(0,de.f3)(ie.v.IControlService),Oe=(0,de.f3)(ie.v.IGlobalConfigService),ct=(0,de.f3)(ie.v.IMapService),Ft=(0,de.f3)(ie.v.ICoordinateSystemService),Ut=(0,de.f3)(ie.v.IRendererService),Fr=(0,de.f3)(ie.v.ILayerService),Kr=(0,de.f3)(ie.v.ICameraService),ni=(0,de.f3)(ie.v.IInteractionService),Ii=(0,de.f3)(ie.v.IPickingService),bi=(0,de.f3)(ie.v.IShaderModuleService),pa=(0,de.f3)(ie.v.IMarkerService),Pa=(0,de.f3)(ie.v.IPopupService),m(za=(Ti=function(Q){(0,kt.Z)(O,Q);var J=sa(O);function O(){var k;return(0,se.Z)(this,O),k=J.call(this),(0,$.Z)((0,Le.Z)(k),"destroyed",!1),(0,$.Z)((0,Le.Z)(k),"loaded",!1),(0,$.Z)((0,Le.Z)(k),"loadFont",!1),(0,$.Z)((0,Le.Z)(k),"fontFamily",""),(0,ae.Z)((0,Le.Z)(k),"id",_s,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"iconService",iu,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"fontService",Bu,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"controlService",tc,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"configService",Yu,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"map",rc,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"coordinateSystemService",mu,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"rendererService",gu,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"layerService",Tu,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"cameraService",xo,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"interactionService",nc,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"pickingService",yc,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"shaderModuleService",cs,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"markerService",ic,(0,Le.Z)(k)),(0,ae.Z)((0,Le.Z)(k),"popupService",Xs,(0,Le.Z)(k)),(0,$.Z)((0,Le.Z)(k),"inited",!1),(0,$.Z)((0,Le.Z)(k),"initPromise",void 0),(0,$.Z)((0,Le.Z)(k),"rendering",!1),(0,$.Z)((0,Le.Z)(k),"$container",void 0),(0,$.Z)((0,Le.Z)(k),"canvas",void 0),(0,$.Z)((0,Le.Z)(k),"markerContainer",void 0),(0,$.Z)((0,Le.Z)(k),"hooks",void 0),(0,$.Z)((0,Le.Z)(k),"handleWindowResized",function(){k.emit("resize"),k.$container&&(k.initContainer(),Je.SO.triggerResize(),k.coordinateSystemService.needRefresh=!0,k.render())}),(0,$.Z)((0,Le.Z)(k),"handleMapCameraChanged",function(oe){k.cameraService.update(oe),k.render("mapRender")}),k.hooks={init:new il.zj},k}return(0,Be.Z)(O,[{key:"init",value:function(oe){var we=this;this.configService.setSceneConfig(this.id,oe),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,jo.Z)(Xi().mark(function gt(){return Xi().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:return St.next=2,new Promise(function(lr){we.map.onCameraChanged(function(Wr){we.cameraService.init(),we.cameraService.update(Wr),we.map.version!=="GAODE2.x"&&lr()}),we.map.version!=="GAODE2.x"?we.map.init():lr()});case 2:if(!(we.map.version==="GAODE2.x"&&we.map.initViewPort)){St.next=6;break}return St.next=5,we.map.init();case 5:we.map.initViewPort();case 6:we.map.onCameraChanged(we.handleMapCameraChanged),we.map.addMarkerContainer(),we.markerService.addMarkers(),we.markerService.addMarkerLayers(),we.popupService.initPopup(),we.interactionService.init(),we.interactionService.on(hi.s.Drag,we.addSceneEvent.bind(we));case 13:case"end":return St.stop()}},gt)}))),this.hooks.init.tapPromise("initRenderer",(0,jo.Z)(Xi().mark(function gt(){var Mt;return Xi().wrap(function(lr){for(;;)switch(lr.prev=lr.next){case 0:if(Mt=Ba(we.configService.getSceneConfig(we.id).id||""),we.$container=Mt,!Mt){lr.next=11;break}return we.canvas=Je.SO.create("canvas","",Mt),we.setCanvas(),lr.next=7,we.rendererService.init(we.canvas,we.configService.getSceneConfig(we.id));case 7:Fu()(we.$container,we.handleWindowResized),window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)").addListener(we.handleWindowResized),lr.next=12;break;case 11:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 12:we.pickingService.init(we.id);case 13:case"end":return lr.stop()}},gt)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(oe){this.layerService.add(oe),this.render()}},{key:"render",value:function(){var k=(0,jo.Z)(Xi().mark(function we(gt){return Xi().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:if(!(this.rendering||this.destroyed)){St.next=2;break}return St.abrupt("return");case 2:if(this.rendering=!0,this.inited){St.next=15;break}return St.next=6,this.initPromise;case 6:if(this.destroyed&&this.destroy(),!(this.loadFont&&document.fonts)){St.next=10;break}return St.next=10,document.fonts.load("24px ".concat(this.fontFamily),"L7text");case 10:this.layerService.initLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0;case 15:this.layerService.renderLayers(gt),this.rendering=!1;case 17:case"end":return St.stop()}},we,this)}));function oe(we){return k.apply(this,arguments)}return oe}()},{key:"addFontFace",value:function(oe,we){this.fontFamily=oe;var gt=document.createElement("style");gt.type="text/css",gt.innerText=`
        @font-face{
            font-family: '`.concat(oe,`';
            src: url('`).concat(we,`') format('woff2'),
            url('`).concat(we,`') format('woff'),
            url('`).concat(we,`') format('truetype');
        }`),document.getElementsByTagName("head")[0].appendChild(gt),this.loadFont=!0}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(oe){var we,gt=(we=this.$container)===null||we===void 0?void 0:we.getElementsByTagName("canvas")[0];this.render();var Mt=oe==="jpg"?gt==null?void 0:gt.toDataURL("image/jpeg"):gt==null?void 0:gt.toDataURL("image/png");return Mt}},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"addMarkerContainer",value:function(){var oe=this.$container.parentElement;oe!==null&&(this.markerContainer=Je.SO.create("div","l7-marker-container",oe))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var oe,we;if(!this.inited){this.destroyed=!0;return}this.emit("destroy"),this.layerService.destroy(),this.rendererService.destroy(),this.map.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),(oe=this.$container)===null||oe===void 0||(we=oe.parentNode)===null||we===void 0||we.removeChild(this.$container),this.removeAllListeners(),this.inited=!1,(0,nu.unbind)(this.$container,this.handleWindowResized),window.matchMedia("screen and (min-resolution: 2dppx)").removeListener(this.handleWindowResized)}},{key:"initContainer",value:function(){var oe,we,gt=Je.SO.DPR,Mt=((oe=this.$container)===null||oe===void 0?void 0:oe.clientWidth)||400,St=((we=this.$container)===null||we===void 0?void 0:we.clientHeight)||300,lr=this.canvas;lr&&(lr.width=Mt*gt,lr.height=St*gt,lr.style.width="".concat(Mt,"px"),lr.style.height="".concat(St,"px")),this.rendererService.viewport({x:0,y:0,width:gt*Mt,height:gt*St})}},{key:"setCanvas",value:function(){var oe,we,gt=Je.SO.DPR,Mt=((oe=this.$container)===null||oe===void 0?void 0:oe.clientWidth)||400,St=((we=this.$container)===null||we===void 0?void 0:we.clientHeight)||300,lr=this.canvas;lr.width=Mt*gt,lr.height=St*gt,lr.style.width="".concat(Mt,"px"),lr.style.height="".concat(St,"px")}},{key:"addSceneEvent",value:function(oe){this.emit(oe.type,oe)}}]),O}(C.EventEmitter),_s=(0,Ee.Z)(Ti.prototype,"id",[w],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iu=(0,Ee.Z)(Ti.prototype,"iconService",[N],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bu=(0,Ee.Z)(Ti.prototype,"fontService",[I],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tc=(0,Ee.Z)(Ti.prototype,"controlService",[le],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Yu=(0,Ee.Z)(Ti.prototype,"configService",[Oe],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rc=(0,Ee.Z)(Ti.prototype,"map",[ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mu=(0,Ee.Z)(Ti.prototype,"coordinateSystemService",[Ft],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gu=(0,Ee.Z)(Ti.prototype,"rendererService",[Ut],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tu=(0,Ee.Z)(Ti.prototype,"layerService",[Fr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xo=(0,Ee.Z)(Ti.prototype,"cameraService",[Kr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nc=(0,Ee.Z)(Ti.prototype,"interactionService",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yc=(0,Ee.Z)(Ti.prototype,"pickingService",[Ii],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cs=(0,Ee.Z)(Ti.prototype,"shaderModuleService",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ic=(0,Ee.Z)(Ti.prototype,"markerService",[pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Xs=(0,Ee.Z)(Ti.prototype,"popupService",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ti))||za),Ga=S(44908),_l=S.n(Ga);function Nu(Q){var J=0;switch(Q){case"vec2":case"ivec2":J=2;break;case"vec3":case"ivec3":J=3;break;case"vec4":case"ivec4":case"mat2":J=4;break;case"mat3":J=9;break;case"mat4":J=16;break;default:}return J}var yu=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function _u(Q){var J={};return Q=Q.replace(yu,function(O,k,oe){var we=oe.split(":"),gt=we[0].trim(),Mt="";switch(we.length>1&&(Mt=we[1].trim()),k){case"bool":Mt=Mt==="true";break;case"float":case"int":Mt=Number(Mt);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":Mt?Mt=Mt.replace("[","").replace("]","").split(",").reduce(function(St,lr){return St.push(Number(lr.trim())),St},[]):Mt=new Array(Nu(k)).fill(0);break;default:}return J[gt]=Mt,"uniform ".concat(k," ").concat(gt,`;
`)}),{content:Q,uniforms:J}}var au,xl;function xu(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function Ys(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?xu(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):xu(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}var Pu="#define PI 3.14159265359",Os=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,ou=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,wo=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}

// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {
//   vec3 lightDir = normalize(light.position - fragPos);
//   // diffuse shading
//   float diff = max(dot(normal, lightDir), 0.0);
//   // specular shading
//   vec3 reflectDir = reflect(-lightDir, normal);
//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);
//   // attenuation
//   float distance = length(light.position - fragPos);
//   float attenuation = 1.0 / (light.constant + light.linear * distance +
//           light.quadratic * (distance * distance));

//   vec3 ambient = light.ambient * u_Ambient;
//   vec3 diffuse = light.diffuse * diff * u_Diffuse;
//   vec3 specular = light.specular * spec * u_Specular;

//   float spotEffect = dot(normalize(light.direction), -lightDir);
//   float spotCosCutoff = cos(light.angle / 180.0 * PI);
//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);
//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);
//   if (spotEffect > spotCosCutoff) {
//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);
//   } else {
//     spotEffect = 0.0;
//   }

//   return ambient + attenuation * (spotEffect * diffuse + specular);
// }

vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {
  //   if (i >= u_NumOfSpotLights) {
  //     break;
  //   }
  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);
  // }
  return weight;
}
`,Ls=`varying vec4 v_PickingResult;
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color) {
  bool selected = bool(v_PickingResult.a);

  if (selected) {
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(resultRGB, color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  return filterPickingColor(filterHighlightColor(color));
}
`,xs=`attribute vec3 a_PickingColor;
varying vec4 v_PickingResult;

uniform vec3 u_PickingColor : [0, 0, 0];
uniform vec4 u_HighlightColor : [0, 0, 0, 0];
uniform float u_PickingStage : 0.0;
uniform float u_PickingThreshold : 1.0;
uniform float u_PickingBuffer: 0.0;

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

bool isVertexPicked(vec3 vertexColor) {
  return
    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&
    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&
    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;
}

void setPickingColor(vec3 pickingColor) {
  // compares only in highlight stage
  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,Rs=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,xc=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)

#define COORDINATE_SYSTEM_LNGLAT 1.0
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0
#define COORDINATE_SYSTEM_P20_OFFSET 6.0
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0

uniform mat4 u_ViewMatrix;
uniform mat4 u_ProjectionMatrix;
uniform mat4 u_ViewProjectionMatrix;
uniform float u_Zoom : 1;
uniform float u_ZoomScale : 1;

uniform float u_CoordinateSystem;
uniform vec2 u_ViewportCenter;
uniform vec4 u_ViewportCenterProjection;
uniform vec3 u_PixelsPerDegree;
uniform vec3 u_PixelsPerDegree2;
uniform vec3 u_PixelsPerMeter;

uniform vec2 u_ViewportSize;
uniform float u_DevicePixelRatio;
uniform float u_FocalDistance;
uniform vec3 u_CameraPosition;

// uniform mat4 u_Mvp;

// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // return vec4(
    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), 
    //   project_scale(position.z), 
    //   position.w);

     return vec4(
      position.xy, 
      project_scale(position.z), 
      position.w);
  }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}

float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom));
  }
  return pixel * -1.;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}`,ac=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,oc=`attribute float a_vertexId;

uniform mat4 u_cellTypeLayout;      // \u63CF\u8FF0\u6570\u636E\u7EB9\u7406 cell \u7ED3\u6784\u7684\u77E9\u9635
uniform sampler2D u_dataTexture;    // \u6570\u636E\u7EB9\u7406

bool hasOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 opacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeOpacity() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeOpacity \u7684\u6570\u636E
  return u_cellTypeLayout[1][1] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStrokeWidth() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 strokeWidth \u7684\u6570\u636E
  return u_cellTypeLayout[1][2] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasStroke() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 stroke \u7684\u6570\u636E
  return u_cellTypeLayout[1][3] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

bool hasOffsets() { // \u5224\u65AD cell \u4E2D\u662F\u5426\u5B58\u5728 offsets \u7684\u6570\u636E
  return u_cellTypeLayout[2][0] > 0.0 && u_cellTypeLayout[3][3] > 0.0;
}

// \u6839\u636E\u5750\u6807\u4F4D\u7F6E\u5148\u662F\u8BA1\u7B97 uv \uFF0C\u7136\u540E\u6839\u636E uv \u4ECE\u6570\u636E\u7EB9\u7406\u4E2D\u53D6\u503C
float pos2value(vec2 pos, float columnWidth, float rowHeight) {
  float u = (pos.r - 1.0) * columnWidth + columnWidth/2.0;
  float v = 1.0 - ((pos.g - 1.0) * rowHeight + rowHeight/2.0);
  return texture2D(u_dataTexture, vec2(u, v)).r;
}

/*
  currentRow \u5F53\u524D\u884C
  currentColumn \u5F53\u524D\u5217
  columnCount \u6709\u591A\u5C11\u5217
  nextStep \u9700\u8981\u8BA1\u7B97\u5F53\u524D cell \u540E\u7684\u7B2C\u51E0\u4E2A cell \uFF08\u5F53\u524D cell \u5219 nextStep = 0\uFF09
*/
vec2 nextPos(float currentRow, float currentColumn, float columnCount, float nextStep) {
  float nextColumn = currentColumn;
  float nextRow = currentRow;
  if(currentColumn + nextStep <= columnCount){
    nextColumn = currentColumn + nextStep;
  } else {
    nextColumn = mod(currentColumn + nextStep, columnCount); // \u4E0D\u4F1A\u51FA\u73B0\u8DE8\u4E24\u884C
    nextRow = currentRow + 1.0;
  }
  return vec2(nextColumn, nextRow);
}

// \u8BA1\u7B97\u5F53\u524D\u5355\u4E2A cell \u7684\u5927\u5C0F
float calCellCount() { 
  //   u_cellTypeLayout
  //   cal_height, WIDTH, 0.0, 0.0, // rowCount columnCount - \u51E0\u884C\u51E0\u5217
  //   1.0, 1.0, 1.0, 0.0, // opacity strokeOpacity strokeWidth stroke - 1.0 \u8868\u793A\u6709\u6570\u636E\u6620\u5C04\u30010.0 \u8868\u793A\u6CA1\u6709
  //   1.0, 0.0, 0.0, 0.0, // offsets
  //   0.0, 0.0, 0.0, 0.0
  
  return  u_cellTypeLayout[1][0] +        // opacity
          u_cellTypeLayout[1][1] +        // strokeOpacity
          u_cellTypeLayout[1][2] +        // strokeWidth
          u_cellTypeLayout[1][3] * 4.0 +  // stroke
          u_cellTypeLayout[2][0] * 2.0;   // offsets
}`,ol=`
// \u8BA1\u7B97 opacity \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasOpacity()) { // \u6570\u636E\u7EB9\u7406\u4E2D\u4E0D\u5B58\u5728 opacity \u7684\u65F6\u5019\u53D6\u9ED8\u8BA4\u503C\uFF08\u7528\u6237\u5728 style \u4E2D\u4F20\u5165\u7684\u662F\u5E38\u91CF\uFF09
    return vec2(u_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureOpacity, textureOffset + 1.0);
  }
}
`,Dl=`
// \u8BA1\u7B97 strokeOpaicty \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeOpacityAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeOpacity()) {
    return vec2(u_stroke_opacity, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeOpacity = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeOpacity, textureOffset + 1.0);
  }
}
`,kl=`
// \u8BA1\u7B97 strokeWidth \u548C\u6807\u793A\u5728 cell \u4E2D\u53D6\u503C\u4F4D\u7F6E\u7684\u504F\u79FB\u91CF textureOffset
vec2 calStrokeWidthAndOffset(float cellCurrentRow, float cellCurrentColumn, float columnCount, float textureOffset, float columnWidth, float rowHeight) {
  if(!hasStrokeWidth()) {
    return vec2(u_stroke_width, textureOffset);
  } else {
    vec2 valuePos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    float textureStrokeWidth = pos2value(valuePos, columnWidth, rowHeight);
    return vec2(textureStrokeWidth, textureOffset + 1.0);
  }
}
`,sc=/precision\s+(high|low|medium)p\s+float/,uc=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,Qc=/#pragma include (["^+"]?["\ "[a-zA-Z_0-9](.*)"]*?)/g,Fl=(au=(0,de.b2)(),au(xl=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"moduleCache",{}),(0,$.Z)(this,"rawContentCache",{})}return(0,Be.Z)(Q,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Pu,fs:Pu}),this.registerModule("decode",{vs:Os,fs:""}),this.registerModule("projection",{vs:xc,fs:""}),this.registerModule("project",{vs:Rs,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:ac}),this.registerModule("lighting",{vs:wo,fs:""}),this.registerModule("light",{vs:ou,fs:""}),this.registerModule("picking",{vs:xs,fs:Ls}),this.registerModule("styleMapping",{vs:oc,fs:""}),this.registerModule("styleMappingCalOpacity",{vs:ol,fs:""}),this.registerModule("styleMappingCalStrokeOpacity",{vs:Dl,fs:""}),this.registerModule("styleMappingCalStrokeWidth",{vs:kl,fs:""})}},{key:"registerModule",value:function(O,k){if(!this.rawContentCache[O]){var oe=k.vs,we=k.fs,gt=k.uniforms,Mt=_u(oe),St=Mt.content,lr=Mt.uniforms,Wr=_u(we),Xn=Wr.content,Un=Wr.uniforms;this.rawContentCache[O]={fs:Xn,uniforms:Ys(Ys(Ys({},lr),Un),gt),vs:St}}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(O){var k=this;if(this.moduleCache[O])return this.moduleCache[O];var oe=this.rawContentCache[O].vs,we=this.rawContentCache[O].fs,gt=this.processModule(oe,[],"vs"),Mt=gt.content,St=gt.includeList,lr=this.processModule(we,[],"fs"),Wr=lr.content,Xn=lr.includeList,Un=Wr,ci=_l()(St.concat(Xn).concat(O)).reduce(function(vi,jn){return Ys(Ys({},vi),k.rawContentCache[jn].uniforms)},{});return sc.test(Wr)||(Un=uc+Wr),this.moduleCache[O]={fs:Un.trim(),uniforms:ci,vs:Mt.trim()},this.moduleCache[O]}},{key:"processModule",value:function(O,k,oe){var we=this,gt=O.replace(Qc,function(Mt,St){var lr=St.split(" "),Wr=lr[0].replace(/"/g,"");if(k.indexOf(Wr)>-1)return"";var Xn=we.rawContentCache[Wr][oe];k.push(Wr);var Un=we.processModule(Xn,k,oe),ci=Un.content;return ci});return{content:gt,includeList:k}}}]),Q}())||xl),Ks=S(66213),sl=S(92364),zu,Ku,bc,lc,Sc,Zu=(zu=(0,de.b2)(),Ku=(0,de.f3)(ie.v.IShaderModuleService),zu(bc=(lc=function(){function Q(){(0,se.Z)(this,Q),(0,ae.Z)(this,"shaderModuleService",Sc,this),(0,$.Z)(this,"rendererService",void 0),(0,$.Z)(this,"cameraService",void 0),(0,$.Z)(this,"mapService",void 0),(0,$.Z)(this,"interactionService",void 0),(0,$.Z)(this,"layerService",void 0),(0,$.Z)(this,"config",void 0)}return(0,Be.Z)(Q,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return sl.G.Normal}},{key:"init",value:function(O,k){this.config=k,this.rendererService=O.getContainer().get(ie.v.IRendererService),this.cameraService=O.getContainer().get(ie.v.ICameraService),this.mapService=O.getContainer().get(ie.v.IMapService),this.interactionService=O.getContainer().get(ie.v.IInteractionService),this.layerService=O.getContainer().get(ie.v.ILayerService)}},{key:"render",value:function(O){}}]),Q}(),Sc=(0,Ee.Z)(lc.prototype,"shaderModuleService",[Ku],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lc))||bc),kc,ul;function lo(Q){var J=Bl();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Bl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var ll=(kc=(0,de.b2)(),kc(ul=function(Q){(0,kt.Z)(O,Q);var J=lo(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(oe,we){(0,Ks.Z)((0,_r.Z)(O.prototype),"init",this).call(this,oe,we)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),O}(Zu))||ul),Ds,ua,Ha,fs,bl;function $u(Q,J){var O=typeof Symbol!="undefined"&&Q[Symbol.iterator]||Q["@@iterator"];if(!O){if(Array.isArray(Q)||(O=Nl(Q))||J&&Q&&typeof Q.length=="number"){O&&(Q=O);var k=0,oe=function(){};return{s:oe,n:function(){return k>=Q.length?{done:!0}:{done:!1,value:Q[k++]}},e:function(lr){throw lr},f:oe}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var we=!0,gt=!1,Mt;return{s:function(){O=O.call(Q)},n:function(){var lr=O.next();return we=lr.done,lr},e:function(lr){gt=!0,Mt=lr},f:function(){try{!we&&O.return!=null&&O.return()}finally{if(gt)throw Mt}}}}function Nl(Q,J){if(!!Q){if(typeof Q=="string")return Fc(Q,J);var O=Object.prototype.toString.call(Q).slice(8,-1);if(O==="Object"&&Q.constructor&&(O=Q.constructor.name),O==="Map"||O==="Set")return Array.from(Q);if(O==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(O))return Fc(Q,J)}}function Fc(Q,J){(J==null||J>Q.length)&&(J=Q.length);for(var O=0,k=new Array(J);O<J;O++)k[O]=Q[O];return k}var gf=(Ds=(0,de.b2)(),ua=(0,de.f3)(ie.v.IPostProcessor),Ds(Ha=(fs=function(){function Q(){(0,se.Z)(this,Q),(0,$.Z)(this,"passes",[]),(0,ae.Z)(this,"postProcessor",bl,this),(0,$.Z)(this,"layer",void 0),(0,$.Z)(this,"renderFlag",void 0),(0,$.Z)(this,"width",0),(0,$.Z)(this,"height",0)}return(0,Be.Z)(Q,[{key:"setLayer",value:function(O){this.layer=O}},{key:"setRenderFlag",value:function(O){this.renderFlag=O}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var J=(0,jo.Z)(Xi().mark(function k(){var oe,we,gt;return Xi().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:oe=$u(this.passes),St.prev=1,oe.s();case 3:if((we=oe.n()).done){St.next=9;break}return gt=we.value,St.next=7,gt.render(this.layer);case 7:St.next=3;break;case 9:St.next=14;break;case 11:St.prev=11,St.t0=St.catch(1),oe.e(St.t0);case 14:return St.prev=14,oe.f(),St.finish(14);case 17:this.layer.renderModels();case 18:case"end":return St.stop()}},k,this,[[1,11,14,17]])}));function O(){return J.apply(this,arguments)}return O}()},{key:"resize",value:function(O,k){(this.width!==O||this.height!==k)&&(this.width=O,this.height=k)}},{key:"add",value:function(O,k){O.getType()===sl.G.PostProcessing?this.postProcessor.add(O,this.layer,k):(O.init(this.layer,k),this.passes.push(O))}},{key:"insert",value:function(O,k,oe){O.init(this.layer,k),this.passes.splice(oe,0,O)}},{key:"destroy",value:function(){this.passes.length=0}}]),Q}(),bl=(0,Ee.Z)(fs.prototype,"postProcessor",[ua],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fs))||Ha),Ju,bo;function Qa(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function Do(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Qa(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Qa(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function bs(Q){var J=Sl();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Sl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var To=(Ju=(0,de.b2)(),Ju(bo=function(Q){(0,kt.Z)(O,Q);var J=bs(O);function O(){var k;(0,se.Z)(this,O);for(var oe=arguments.length,we=new Array(oe),gt=0;gt<oe;gt++)we[gt]=arguments[gt];return k=J.call.apply(J,[this].concat(we)),(0,$.Z)((0,Le.Z)(k),"pickingFBO",void 0),(0,$.Z)((0,Le.Z)(k),"layer",void 0),(0,$.Z)((0,Le.Z)(k),"width",0),(0,$.Z)((0,Le.Z)(k),"height",0),(0,$.Z)((0,Le.Z)(k),"alreadyInRendering",!1),(0,$.Z)((0,Le.Z)(k),"pickFromPickingFBO",function(Mt){var St=Mt.x,lr=Mt.y,Wr=Mt.lngLat,Xn=Mt.type;if(!(!k.layer.isVisible()||!k.layer.needPick(Xn))){var Un=k.rendererService,ci=Un.getViewportSize,vi=Un.readPixels,jn=Un.useFramebuffer,aa=ci(),da=aa.width,Sa=aa.height,vo=k.layer.getLayerConfig(),Ca=vo.enableHighlight,Bo=vo.enableSelect,Za=St*Je.SO.DPR,Ui=lr*Je.SO.DPR;if(!(Za>da||Za<0||Ui>Sa||Ui<0)){var ga;jn(k.pickingFBO,function(){var io;if(ga=vi({x:Math.round(Za),y:Math.round(Sa-(lr+1)*Je.SO.DPR),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:k.pickingFBO}),ga[0]!==0||ga[1]!==0||ga[2]!==0){var So=(0,Je.W0)(ga),Oi=k.layer.getSource().getFeatureById(So),co={x:St,y:lr,type:Xn,lngLat:Wr,featureId:So,feature:Oi};Oi&&(k.layer.setCurrentPickId(So),k.triggerHoverOnLayer(co))}else{var Ka={x:St,y:lr,lngLat:Wr,type:k.layer.getCurrentPickId()===null?"un"+Xn:"mouseout",featureId:null,feature:null};k.triggerHoverOnLayer(Do(Do({},Ka),{},{type:"unpick"})),k.triggerHoverOnLayer(Ka),k.layer.setCurrentPickId(null)}Ca&&k.highlightPickedFeature(ga),Bo&&Xn==="click"&&((io=ga)===null||io===void 0?void 0:io.toString())!==[0,0,0,0].toString()&&k.selectFeature(ga)})}}}),k}return(0,Be.Z)(O,[{key:"getType",value:function(){return sl.G.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(oe,we){(0,Ks.Z)((0,_r.Z)(O.prototype),"init",this).call(this,oe,we),this.layer=oe;var gt=this.rendererService,Mt=gt.createTexture2D,St=gt.createFramebuffer,lr=gt.getViewportSize,Wr=lr(),Xn=Wr.width,Un=Wr.height;this.pickingFBO=St({color:Mt({width:Xn,height:Un,wrapS:Yi.gl.CLAMP_TO_EDGE,wrapT:Yi.gl.CLAMP_TO_EDGE})}),this.interactionService.on(hi.s.Hover,this.pickFromPickingFBO),this.interactionService.on(hi.s.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(hi.s.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(oe){var we=this;if(!this.alreadyInRendering){var gt=this.rendererService,Mt=gt.getViewportSize,St=gt.useFramebuffer,lr=gt.clear,Wr=Mt(),Xn=Wr.width,Un=Wr.height;this.alreadyInRendering=!0,(this.width!==Xn||this.height!==Un)&&(this.pickingFBO.resize({width:Xn,height:Un}),this.width=Xn,this.height=Un),St(this.pickingFBO,function(){lr({framebuffer:we.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var ci=we.layer.multiPassRenderer.getRenderFlag();we.layer.multiPassRenderer.setRenderFlag(!1),oe.hooks.beforePickingEncode.call(),oe.render(),oe.hooks.afterPickingEncode.call(),we.layer.multiPassRenderer.setRenderFlag(ci),we.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(oe){this.layer.emit(oe.type,oe)}},{key:"highlightPickedFeature",value:function(oe){var we=(0,wt.Z)(oe,3),gt=we[0],Mt=we[1],St=we[2];this.layer.hooks.beforeHighlight.call([gt,Mt,St]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(oe){var we=(0,wt.Z)(oe,3),gt=we[0],Mt=we[1],St=we[2];this.layer.hooks.beforeSelect.call([gt,Mt,St]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(oe){var we=oe.featureId,gt=(0,Je.Z6)(we);this.selectFeature(new Uint8Array(gt))}},{key:"highlightFeatureHandle",value:function(oe){var we=oe.featureId,gt=(0,Je.Z6)(we);this.highlightPickedFeature(new Uint8Array(gt))}}]),O}(Zu))||bo),Cn=S(69530),no,Mu;function cl(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function su(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?cl(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):cl(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function ko(Q){var J=cc();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function cc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var xn=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Wa=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ec=(no=(0,de.b2)(),no(Mu=function(Q){(0,kt.Z)(O,Q);var J=ko(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Wa,fs:xn});var oe=this.shaderModuleService.getModule("blur-pass"),we=oe.vs,gt=oe.fs,Mt=oe.uniforms,St=this.rendererService.getViewportSize(),lr=St.width,Wr=St.height;return{vs:we,fs:gt,uniforms:su(su({},Mt),{},{u_ViewportSize:[lr,Wr]})}}},{key:"convertOptionsToUniforms",value:function(oe){var we={};return ls()(oe.blurRadius)||(we.u_BlurDir=[oe.blurRadius,0]),we}}]),O}(Cn.Z))||Mu),js,qa;function Ya(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function zl(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Ya(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Ya(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function bu(Q){var J=ks();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function ks(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Uu=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,Bc=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Zl=(js=(0,de.b2)(),js(qa=function(Q){(0,kt.Z)(O,Q);var J=bu(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Bc,fs:Uu});var oe=this.shaderModuleService.getModule("blur-pass"),we=oe.vs,gt=oe.fs,Mt=oe.uniforms,St=this.rendererService.getViewportSize(),lr=St.width,Wr=St.height;return{vs:we,fs:gt,uniforms:zl(zl({},Mt),{},{u_ViewportSize:[lr,Wr]})}}},{key:"convertOptionsToUniforms",value:function(oe){var we={};return ls()(oe.blurRadius)||(we.u_BlurDir=[0,oe.blurRadius]),we}}]),O}(Cn.Z))||qa),El,fc;function Vs(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function Fs(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Vs(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Vs(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function ea(Q){var J=Iu();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Iu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var $s=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,Ra=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Cl=(El=(0,de.b2)(),El(fc=function(Q){(0,kt.Z)(O,Q);var J=ea(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:Ra,fs:$s});var oe=this.shaderModuleService.getModule("colorhalftone-pass"),we=oe.vs,gt=oe.fs,Mt=oe.uniforms,St=this.rendererService.getViewportSize(),lr=St.width,Wr=St.height;return{vs:we,fs:gt,uniforms:Fs(Fs({},Mt),{},{u_ViewportSize:[lr,Wr]})}}}]),O}(Cn.Z))||fc),Su,uu;function eo(Q){var J=fl();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function fl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var ii=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,qn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Ul=(Su=(0,de.b2)(),Su(uu=function(Q){(0,kt.Z)(O,Q);var J=eo(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:qn,fs:ii}),this.shaderModuleService.getModule("copy-pass")}}]),O}(Cn.Z))||uu),es,Bs;function zo(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function lu(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?zo(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):zo(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function Cc(Q){var J=hc();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function hc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var ta=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,ba=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,qc=(es=(0,de.b2)(),es(Bs=function(Q){(0,kt.Z)(O,Q);var J=Cc(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:ba,fs:ta});var oe=this.shaderModuleService.getModule("hexagonalpixelate-pass"),we=oe.vs,gt=oe.fs,Mt=oe.uniforms,St=this.rendererService.getViewportSize(),lr=St.width,Wr=St.height;return{vs:we,fs:gt,uniforms:lu(lu({},Mt),{},{u_ViewportSize:[lr,Wr]})}}}]),O}(Cn.Z))||Bs),Po,wl;function Gs(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function Ss(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Gs(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Gs(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function hl(Q){var J=Eu();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Eu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var wc=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Ri=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Qu=(Po=(0,de.b2)(),Po(wl=function(Q){(0,kt.Z)(O,Q);var J=hl(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Ri,fs:wc});var oe=this.shaderModuleService.getModule("ink-pass"),we=oe.vs,gt=oe.fs,Mt=oe.uniforms,St=this.rendererService.getViewportSize(),lr=St.width,Wr=St.height;return{vs:we,fs:gt,uniforms:Ss(Ss({},Mt),{},{u_ViewportSize:[lr,Wr]})}}}]),O}(Cn.Z))||wl),Nc,Fo;function Cu(Q){var J=jl();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function jl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var qu=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,cu=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Al=(Nc=(0,de.b2)(),Nc(Fo=function(Q){(0,kt.Z)(O,Q);var J=Cu(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:cu,fs:qu}),this.shaderModuleService.getModule("noise-pass")}}]),O}(Cn.Z))||Fo),Ou,fu;function zc(Q){var J=Lu();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Lu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Ea=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Tl=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,i=(Ou=(0,de.b2)(),Ou(fu=function(Q){(0,kt.Z)(O,Q);var J=zc(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:Ea,fs:Tl}),this.shaderModuleService.getModule("sepia-pass")}}]),O}(Cn.Z))||fu),u,o,h,y,b,T,R=(u=(0,de.b2)(),o=(0,de.f3)(ie.v.IRendererService),h=(0,de.zY)(),u(y=(b=function(){function Q(){(0,se.Z)(this,Q),(0,ae.Z)(this,"rendererService",T,this),(0,$.Z)(this,"passes",[]),(0,$.Z)(this,"readFBO",void 0),(0,$.Z)(this,"writeFBO",void 0)}return(0,Be.Z)(Q,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"render",value:function(){var J=(0,jo.Z)(Xi().mark(function k(oe){var we,gt;return Xi().wrap(function(St){for(;;)switch(St.prev=St.next){case 0:we=0;case 1:if(!(we<this.passes.length)){St.next=10;break}return gt=this.passes[we],gt.setRenderToScreen(this.isLastEnabledPass(we)),St.next=6,gt.render(oe);case 6:we!==this.passes.length-1&&this.swap();case 7:we++,St.next=1;break;case 10:case"end":return St.stop()}},k,this)}));function O(k){return J.apply(this,arguments)}return O}()},{key:"resize",value:function(O,k){this.readFBO.resize({width:O,height:k}),this.writeFBO.resize({width:O,height:k})}},{key:"add",value:function(O,k,oe){O.init(k,oe),this.passes.push(O)}},{key:"insert",value:function(O,k,oe,we){O.init(oe,we),this.passes.splice(k,0,O)}},{key:"getPostProcessingPassByName",value:function(O){return this.passes.find(function(k){return k.getName()===O})}},{key:"init",value:function(){}},{key:"isLastEnabledPass",value:function(O){for(var k=O+1;k<this.passes.length;k++)if(this.passes[k].isEnabled())return!1;return!0}},{key:"swap",value:function(){var O=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=O}}]),Q}(),T=(0,Ee.Z)(b.prototype,"rendererService",[o],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),(0,Ee.Z)(b.prototype,"init",[h],Object.getOwnPropertyDescriptor(b.prototype,"init"),b.prototype),b))||y),j,ne;function be(Q){var J=Ce();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function Ce(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Pe=(j=(0,de.b2)(),j(ne=function(Q){(0,kt.Z)(O,Q);var J=be(O);function O(){return(0,se.Z)(this,O),J.apply(this,arguments)}return(0,Be.Z)(O,[{key:"getType",value:function(){return sl.G.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(oe,we){(0,Ks.Z)((0,_r.Z)(O.prototype),"init",this).call(this,oe,we)}},{key:"render",value:function(oe){var we=this.rendererService,gt=we.useFramebuffer,Mt=we.clear;gt(null,function(){Mt({color:[0,0,0,0],depth:1,stencil:0}),oe.multiPassRenderer.setRenderFlag(!1),oe.render(),oe.multiPassRenderer.setRenderFlag(!0)})}}]),O}(Zu))||ne),He,je,ot,ze,at;function Et(Q,J){var O=Object.keys(Q);if(Object.getOwnPropertySymbols){var k=Object.getOwnPropertySymbols(Q);J&&(k=k.filter(function(oe){return Object.getOwnPropertyDescriptor(Q,oe).enumerable})),O.push.apply(O,k)}return O}function Vt(Q){for(var J=1;J<arguments.length;J++){var O=arguments[J]!=null?arguments[J]:{};J%2?Et(Object(O),!0).forEach(function(k){(0,$.Z)(Q,k,O[k])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Q,Object.getOwnPropertyDescriptors(O)):Et(Object(O)).forEach(function(k){Object.defineProperty(Q,k,Object.getOwnPropertyDescriptor(O,k))})}return Q}function mr(Q){var J=ur();return function(){var k=(0,_r.Z)(Q),oe;if(J){var we=(0,_r.Z)(this).constructor;oe=Reflect.construct(k,arguments,we)}else oe=k.apply(this,arguments);return(0,nr.Z)(this,oe)}}function ur(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(Q){return!1}}var Er=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,jr=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,hn=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function nn(Q,J){for(var O=0,k=1/J,oe=Q;oe>0;)O=O+k*(oe%J),oe=Math.floor(oe/J),k=k/J;return O}var Nn=1,oi=(He=(0,de.b2)(),je=(0,de.f3)(ie.v.IShaderModuleService),He(ot=(ze=function(Q){(0,kt.Z)(O,Q);var J=mr(O);function O(){var k;(0,se.Z)(this,O);for(var oe=arguments.length,we=new Array(oe),gt=0;gt<oe;gt++)we[gt]=arguments[gt];return k=J.call.apply(J,[this].concat(we)),(0,ae.Z)((0,Le.Z)(k),"shaderModuleService",at,(0,Le.Z)(k)),(0,$.Z)((0,Le.Z)(k),"haltonSequence",[]),(0,$.Z)((0,Le.Z)(k),"accumulatingId",0),(0,$.Z)((0,Le.Z)(k),"frame",0),(0,$.Z)((0,Le.Z)(k),"timer",void 0),(0,$.Z)((0,Le.Z)(k),"sampleRenderTarget",void 0),(0,$.Z)((0,Le.Z)(k),"prevRenderTarget",void 0),(0,$.Z)((0,Le.Z)(k),"outputRenderTarget",void 0),(0,$.Z)((0,Le.Z)(k),"copyRenderTarget",void 0),(0,$.Z)((0,Le.Z)(k),"blendModel",void 0),(0,$.Z)((0,Le.Z)(k),"outputModel",void 0),(0,$.Z)((0,Le.Z)(k),"copyModel",void 0),k}return(0,Be.Z)(O,[{key:"getType",value:function(){return sl.G.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(oe,we){(0,Ks.Z)((0,_r.Z)(O.prototype),"init",this).call(this,oe,we);var gt=this.rendererService,Mt=gt.createFramebuffer,St=gt.createTexture2D;this.sampleRenderTarget=Mt({color:St({width:1,height:1,wrapS:Yi.gl.CLAMP_TO_EDGE,wrapT:Yi.gl.CLAMP_TO_EDGE})}),this.prevRenderTarget=Mt({color:St({width:1,height:1,wrapS:Yi.gl.CLAMP_TO_EDGE,wrapT:Yi.gl.CLAMP_TO_EDGE})}),this.outputRenderTarget=Mt({color:St({width:1,height:1,wrapS:Yi.gl.CLAMP_TO_EDGE,wrapT:Yi.gl.CLAMP_TO_EDGE})}),this.copyRenderTarget=Mt({color:St({width:1,height:1,wrapS:Yi.gl.CLAMP_TO_EDGE,wrapT:Yi.gl.CLAMP_TO_EDGE})});for(var lr=0;lr<30;lr++)this.haltonSequence.push([nn(lr,2),nn(lr,3)]);this.blendModel=this.createTriangleModel("blend-pass",Er),this.outputModel=this.createTriangleModel("copy-pass",jr,{blend:{enable:!0,func:{srcRGB:Yi.gl.ONE,dstRGB:Yi.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:Yi.gl.ONE,dstAlpha:Yi.gl.ONE_MINUS_SRC_ALPHA},equation:{rgb:Yi.gl.FUNC_ADD,alpha:Yi.gl.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",jr)}},{key:"render",value:function(oe){var we=this,gt=this.rendererService,Mt=gt.clear,St=gt.getViewportSize,lr=gt.useFramebuffer,Wr=St(),Xn=Wr.width,Un=Wr.height;this.sampleRenderTarget.resize({width:Xn,height:Un}),this.prevRenderTarget.resize({width:Xn,height:Un}),this.outputRenderTarget.resize({width:Xn,height:Un}),this.copyRenderTarget.resize({width:Xn,height:Un}),this.resetFrame(),this.stopAccumulating();var ci=oe.multiPassRenderer.getPostProcessor().getReadFBO();lr(ci,function(){Mt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:ci}),oe.multiPassRenderer.setRenderFlag(!1),oe.render(),oe.multiPassRenderer.setRenderFlag(!0)});var vi=function jn(aa){!we.accumulatingId||aa!==we.accumulatingId||we.isFinished()||(we.doRender(oe),requestAnimationFrame(function(){jn(aa)}))};this.accumulatingId=Nn++,this.timer=window.setTimeout(function(){vi(we.accumulatingId)},50)}},{key:"doRender",value:function(oe){var we=this,gt=this.rendererService,Mt=gt.clear,St=gt.getViewportSize,lr=gt.useFramebuffer,Wr=St(),Xn=Wr.width,Un=Wr.height,ci=oe.getLayerConfig(),vi=ci.jitterScale,jn=vi===void 0?1:vi,aa=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((aa[0]*2-1)/Xn*jn,(aa[1]*2-1)/Un*jn),oe.multiPassRenderer.setRenderFlag(!1),oe.hooks.beforeRender.call(),lr(this.sampleRenderTarget,function(){Mt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:we.sampleRenderTarget}),oe.render()}),oe.hooks.afterRender.call(),oe.multiPassRenderer.setRenderFlag(!0);var da=oe.getLayerConfig();lr(this.outputRenderTarget,function(){we.blendModel.draw({uniforms:{u_opacity:da.opacity||1,u_MixRatio:we.frame===0?1:.9,u_Diffuse1:we.sampleRenderTarget,u_Diffuse2:we.frame===0?oe.multiPassRenderer.getPostProcessor().getReadFBO():we.prevRenderTarget}})}),this.frame===0&&Mt({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(lr(this.copyRenderTarget,function(){we.outputModel.draw({uniforms:{u_Texture:we.outputRenderTarget}})}),lr(oe.multiPassRenderer.getPostProcessor().getReadFBO(),function(){we.copyModel.draw({uniforms:{u_Texture:we.copyRenderTarget}})}),oe.multiPassRenderer.getPostProcessor().render(oe));var Sa=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=Sa,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(oe,we,gt){this.shaderModuleService.registerModule(oe,{vs:hn,fs:we});var Mt=this.shaderModuleService.getModule(oe),St=Mt.vs,lr=Mt.fs,Wr=Mt.uniforms,Xn=this.rendererService,Un=Xn.createAttribute,ci=Xn.createBuffer,vi=Xn.createModel;return vi(Vt({vs:St,fs:lr,attributes:{a_Position:Un({buffer:ci({data:[-4,-4,4,-4,0,4],type:Yi.gl.FLOAT}),size:2})},uniforms:Vt({},Wr),depth:{enable:!1},count:3},gt))}}]),O}(Zu),at=(0,Ee.Z)(ze.prototype,"shaderModuleService",[je],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ze))||ot),ui=new de.W2;ui.bind(ie.v.IGlobalConfigService).to(Te).inSingletonScope(),ui.bind(ie.v.IShaderModuleService).to(Fl).inSingletonScope(),(0,de.GW)((0,de.b2)(),C.EventEmitter),ui.bind(ie.v.IEventEmitter).to(C.EventEmitter);var ai=(0,re.Z)(ui,!1),Qi=function(J){var O=ai.lazyInject(J);return function(k,oe,we){O.call(this,k,oe),we&&(we.initializer=function(){return k[oe]})}},Wn=function(J){var O=ai.lazyMultiInject(J);return function(k,oe,we){O.call(this,k,oe),we&&(we.initializer=function(){return k[oe]})}},Ei=ui,Gi=0;function xi(){var Q=new de.W2;return Q.parent=ui,Q.bind(ie.v.SceneID).toConstantValue("".concat(Gi++)),Q.bind(ie.v.ILayerService).to(Au).inSingletonScope(),Q.bind(ie.v.ISceneService).to(al).inSingletonScope(),Q.bind(ie.v.ICameraService).to(Or).inSingletonScope(),Q.bind(ie.v.ICoordinateSystemService).to(tr).inSingletonScope(),Q.bind(ie.v.IInteractionService).to(to).inSingletonScope(),Q.bind(ie.v.IPickingService).to(De).inSingletonScope(),Q.bind(ie.v.IControlService).to(Pr).inSingletonScope(),Q.bind(ie.v.IMarkerService).to(Yr).inSingletonScope(),Q.bind(ie.v.IIconService).to(ut).inSingletonScope(),Q.bind(ie.v.IFontService).to(Ue).inSingletonScope(),Q.bind(ie.v.IPopupService).to(ei).inSingletonScope(),Q.bind(ie.v.INormalPass).to(ll).whenTargetNamed("clear"),Q.bind(ie.v.INormalPass).to(To).whenTargetNamed("pixelPicking"),Q.bind(ie.v.INormalPass).to(Pe).whenTargetNamed("render"),Q.bind(ie.v.INormalPass).to(oi).whenTargetNamed("taa"),Q.bind(ie.v.IFactoryNormalPass).toFactory(function(J){return function(O){return J.container.getNamed(ie.v.INormalPass,O)}}),Q.bind(ie.v.IPostProcessingPass).to(Ul).whenTargetNamed("copy"),Q.bind(ie.v.IPostProcessingPass).to(Ec).whenTargetNamed("blurH"),Q.bind(ie.v.IPostProcessingPass).to(Zl).whenTargetNamed("blurV"),Q.bind(ie.v.IPostProcessingPass).to(Al).whenTargetNamed("noise"),Q.bind(ie.v.IPostProcessingPass).to(i).whenTargetNamed("sepia"),Q.bind(ie.v.IPostProcessingPass).to(Cl).whenTargetNamed("colorHalftone"),Q.bind(ie.v.IPostProcessingPass).to(qc).whenTargetNamed("hexagonalPixelate"),Q.bind(ie.v.IPostProcessingPass).to(Qu).whenTargetNamed("ink"),Q.bind(ie.v.IFactoryPostProcessingPass).toFactory(function(J){return function(O){var k=J.container.getNamed(ie.v.IPostProcessingPass,O);return k.setName(O),k}}),Q}function Ci(Q){var J=new de.W2;return J.parent=Q,J.bind(ie.v.IStyleAttributeService).to(yl).inSingletonScope(),J.bind(ie.v.IMultiPassRenderer).to(gf).inSingletonScope(),J.bind(ie.v.IPostProcessor).to(R).inSingletonScope(),J}},2811:function(){},64532:function(){},4594:function(zr,B,S){"use strict";S.d(B,{l:function(){return ye}});var ye={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"}},66690:function(zr,B,S){"use strict";S.d(B,{d:function(){return ye}});var ye;(function(C){C.TOPRIGHT="topright",C.TOPLEFT="topleft",C.BOTTOMRIGHT="bottomright",C.BOTTOMLEFT="bottomleft",C.TOPCENTER="topcenter",C.BOTTOMCENTER="bottomcenter",C.LEFTCENTER="leftcenter",C.RIGHTCENTER="rightcenter"})(ye||(ye={}))},81732:function(){},84007:function(){},1910:function(){},47282:function(zr,B,S){"use strict";S.d(B,{l:function(){return ye},k:function(){return C}});var ye;(function(d){d[d.LNGLAT=1]="LNGLAT",d[d.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",d[d.VECTOR_TILE=3]="VECTOR_TILE",d[d.IDENTITY=4]="IDENTITY",d[d.P20=5]="P20",d[d.P20_OFFSET=6]="P20_OFFSET",d[d.METER_OFFSET=7]="METER_OFFSET",d[d.P20_2=8]="P20_2"})(ye||(ye={}));var C={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"}},89648:function(zr,B,S){"use strict";S.d(B,{s:function(){return ye}});var ye;(function(C){C.Hover="hover",C.Click="click",C.Select="select",C.Active="active",C.Drag="drag"})(ye||(ye={}))},90919:function(){},77252:function(zr,B,S){"use strict";S.d(B,{h:function(){return ye}});var ye;(function(C){C.normal="normal",C.additive="additive",C.subtractive="subtractive",C.min="min",C.max="max",C.none="none"})(ye||(ye={}))},31251:function(zr,B,S){"use strict";S.d(B,{vY:function(){return ye},ee:function(){return C},GC:function(){return d}});var ye;(function(de){de.LINEAR="linear",de.POWER="power",de.LOG="log",de.IDENTITY="identity",de.TIME="time",de.QUANTILE="quantile",de.QUANTIZE="quantize",de.THRESHOLD="threshold",de.CAT="cat"})(ye||(ye={}));var C;(function(de){de.CONSTANT="constant",de.VARIABLE="variable"})(C||(C={}));var d;(function(de){de[de.Attribute=0]="Attribute",de[de.InstancedAttribute=1]="InstancedAttribute",de[de.Uniform=2]="Uniform"})(d||(d={}))},16606:function(zr,B,S){"use strict";S.d(B,{I:function(){return ye}});var ye=["mapload"]},75925:function(){},85040:function(){},8594:function(){},67571:function(){},66718:function(){},92364:function(zr,B,S){"use strict";S.d(B,{G:function(){return ye}});var ye;(function(C){C.Normal="normal",C.PostProcessing="post-processing"})(ye||(ye={}))},78010:function(){},41906:function(){},68116:function(){},23067:function(){},7648:function(zr,B,S){"use strict";S.d(B,{gl:function(){return ye}});var ye;(function(C){C[C.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",C[C.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",C[C.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",C[C.POINTS=0]="POINTS",C[C.LINES=1]="LINES",C[C.LINE_LOOP=2]="LINE_LOOP",C[C.LINE_STRIP=3]="LINE_STRIP",C[C.TRIANGLES=4]="TRIANGLES",C[C.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",C[C.TRIANGLE_FAN=6]="TRIANGLE_FAN",C[C.ZERO=0]="ZERO",C[C.ONE=1]="ONE",C[C.SRC_COLOR=768]="SRC_COLOR",C[C.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",C[C.SRC_ALPHA=770]="SRC_ALPHA",C[C.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",C[C.DST_ALPHA=772]="DST_ALPHA",C[C.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",C[C.DST_COLOR=774]="DST_COLOR",C[C.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",C[C.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",C[C.FUNC_ADD=32774]="FUNC_ADD",C[C.BLEND_EQUATION=32777]="BLEND_EQUATION",C[C.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",C[C.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",C[C.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",C[C.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",C[C.MAX_EXT=32776]="MAX_EXT",C[C.MIN_EXT=32775]="MIN_EXT",C[C.BLEND_DST_RGB=32968]="BLEND_DST_RGB",C[C.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",C[C.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",C[C.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",C[C.CONSTANT_COLOR=32769]="CONSTANT_COLOR",C[C.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",C[C.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",C[C.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",C[C.BLEND_COLOR=32773]="BLEND_COLOR",C[C.ARRAY_BUFFER=34962]="ARRAY_BUFFER",C[C.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",C[C.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",C[C.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",C[C.STREAM_DRAW=35040]="STREAM_DRAW",C[C.STATIC_DRAW=35044]="STATIC_DRAW",C[C.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",C[C.BUFFER_SIZE=34660]="BUFFER_SIZE",C[C.BUFFER_USAGE=34661]="BUFFER_USAGE",C[C.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",C[C.FRONT=1028]="FRONT",C[C.BACK=1029]="BACK",C[C.FRONT_AND_BACK=1032]="FRONT_AND_BACK",C[C.CULL_FACE=2884]="CULL_FACE",C[C.BLEND=3042]="BLEND",C[C.DITHER=3024]="DITHER",C[C.STENCIL_TEST=2960]="STENCIL_TEST",C[C.DEPTH_TEST=2929]="DEPTH_TEST",C[C.SCISSOR_TEST=3089]="SCISSOR_TEST",C[C.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",C[C.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",C[C.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",C[C.NO_ERROR=0]="NO_ERROR",C[C.INVALID_ENUM=1280]="INVALID_ENUM",C[C.INVALID_VALUE=1281]="INVALID_VALUE",C[C.INVALID_OPERATION=1282]="INVALID_OPERATION",C[C.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",C[C.CW=2304]="CW",C[C.CCW=2305]="CCW",C[C.LINE_WIDTH=2849]="LINE_WIDTH",C[C.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",C[C.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",C[C.CULL_FACE_MODE=2885]="CULL_FACE_MODE",C[C.FRONT_FACE=2886]="FRONT_FACE",C[C.DEPTH_RANGE=2928]="DEPTH_RANGE",C[C.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",C[C.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",C[C.DEPTH_FUNC=2932]="DEPTH_FUNC",C[C.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",C[C.STENCIL_FUNC=2962]="STENCIL_FUNC",C[C.STENCIL_FAIL=2964]="STENCIL_FAIL",C[C.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",C[C.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",C[C.STENCIL_REF=2967]="STENCIL_REF",C[C.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",C[C.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",C[C.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",C[C.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",C[C.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",C[C.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",C[C.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",C[C.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",C[C.VIEWPORT=2978]="VIEWPORT",C[C.SCISSOR_BOX=3088]="SCISSOR_BOX",C[C.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",C[C.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",C[C.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",C[C.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",C[C.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",C[C.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",C[C.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",C[C.RED_BITS=3410]="RED_BITS",C[C.GREEN_BITS=3411]="GREEN_BITS",C[C.BLUE_BITS=3412]="BLUE_BITS",C[C.ALPHA_BITS=3413]="ALPHA_BITS",C[C.DEPTH_BITS=3414]="DEPTH_BITS",C[C.STENCIL_BITS=3415]="STENCIL_BITS",C[C.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",C[C.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",C[C.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",C[C.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",C[C.SAMPLES=32937]="SAMPLES",C[C.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",C[C.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",C[C.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",C[C.DONT_CARE=4352]="DONT_CARE",C[C.FASTEST=4353]="FASTEST",C[C.NICEST=4354]="NICEST",C[C.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",C[C.BYTE=5120]="BYTE",C[C.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",C[C.SHORT=5122]="SHORT",C[C.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",C[C.INT=5124]="INT",C[C.UNSIGNED_INT=5125]="UNSIGNED_INT",C[C.FLOAT=5126]="FLOAT",C[C.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",C[C.ALPHA=6406]="ALPHA",C[C.RGB=6407]="RGB",C[C.RGBA=6408]="RGBA",C[C.LUMINANCE=6409]="LUMINANCE",C[C.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",C[C.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",C[C.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",C[C.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",C[C.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",C[C.VERTEX_SHADER=35633]="VERTEX_SHADER",C[C.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",C[C.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",C[C.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",C[C.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",C[C.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",C[C.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",C[C.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",C[C.SHADER_TYPE=35663]="SHADER_TYPE",C[C.DELETE_STATUS=35712]="DELETE_STATUS",C[C.LINK_STATUS=35714]="LINK_STATUS",C[C.VALIDATE_STATUS=35715]="VALIDATE_STATUS",C[C.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",C[C.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",C[C.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",C[C.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",C[C.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",C[C.NEVER=512]="NEVER",C[C.LESS=513]="LESS",C[C.EQUAL=514]="EQUAL",C[C.LEQUAL=515]="LEQUAL",C[C.GREATER=516]="GREATER",C[C.NOTEQUAL=517]="NOTEQUAL",C[C.GEQUAL=518]="GEQUAL",C[C.ALWAYS=519]="ALWAYS",C[C.KEEP=7680]="KEEP",C[C.REPLACE=7681]="REPLACE",C[C.INCR=7682]="INCR",C[C.DECR=7683]="DECR",C[C.INVERT=5386]="INVERT",C[C.INCR_WRAP=34055]="INCR_WRAP",C[C.DECR_WRAP=34056]="DECR_WRAP",C[C.VENDOR=7936]="VENDOR",C[C.RENDERER=7937]="RENDERER",C[C.VERSION=7938]="VERSION",C[C.NEAREST=9728]="NEAREST",C[C.LINEAR=9729]="LINEAR",C[C.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",C[C.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",C[C.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",C[C.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",C[C.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",C[C.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",C[C.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",C[C.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",C[C.TEXTURE_2D=3553]="TEXTURE_2D",C[C.TEXTURE=5890]="TEXTURE",C[C.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",C[C.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",C[C.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",C[C.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",C[C.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",C[C.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",C[C.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",C[C.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",C[C.TEXTURE0=33984]="TEXTURE0",C[C.TEXTURE1=33985]="TEXTURE1",C[C.TEXTURE2=33986]="TEXTURE2",C[C.TEXTURE3=33987]="TEXTURE3",C[C.TEXTURE4=33988]="TEXTURE4",C[C.TEXTURE5=33989]="TEXTURE5",C[C.TEXTURE6=33990]="TEXTURE6",C[C.TEXTURE7=33991]="TEXTURE7",C[C.TEXTURE8=33992]="TEXTURE8",C[C.TEXTURE9=33993]="TEXTURE9",C[C.TEXTURE10=33994]="TEXTURE10",C[C.TEXTURE11=33995]="TEXTURE11",C[C.TEXTURE12=33996]="TEXTURE12",C[C.TEXTURE13=33997]="TEXTURE13",C[C.TEXTURE14=33998]="TEXTURE14",C[C.TEXTURE15=33999]="TEXTURE15",C[C.TEXTURE16=34e3]="TEXTURE16",C[C.TEXTURE17=34001]="TEXTURE17",C[C.TEXTURE18=34002]="TEXTURE18",C[C.TEXTURE19=34003]="TEXTURE19",C[C.TEXTURE20=34004]="TEXTURE20",C[C.TEXTURE21=34005]="TEXTURE21",C[C.TEXTURE22=34006]="TEXTURE22",C[C.TEXTURE23=34007]="TEXTURE23",C[C.TEXTURE24=34008]="TEXTURE24",C[C.TEXTURE25=34009]="TEXTURE25",C[C.TEXTURE26=34010]="TEXTURE26",C[C.TEXTURE27=34011]="TEXTURE27",C[C.TEXTURE28=34012]="TEXTURE28",C[C.TEXTURE29=34013]="TEXTURE29",C[C.TEXTURE30=34014]="TEXTURE30",C[C.TEXTURE31=34015]="TEXTURE31",C[C.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",C[C.REPEAT=10497]="REPEAT",C[C.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",C[C.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",C[C.FLOAT_VEC2=35664]="FLOAT_VEC2",C[C.FLOAT_VEC3=35665]="FLOAT_VEC3",C[C.FLOAT_VEC4=35666]="FLOAT_VEC4",C[C.INT_VEC2=35667]="INT_VEC2",C[C.INT_VEC3=35668]="INT_VEC3",C[C.INT_VEC4=35669]="INT_VEC4",C[C.BOOL=35670]="BOOL",C[C.BOOL_VEC2=35671]="BOOL_VEC2",C[C.BOOL_VEC3=35672]="BOOL_VEC3",C[C.BOOL_VEC4=35673]="BOOL_VEC4",C[C.FLOAT_MAT2=35674]="FLOAT_MAT2",C[C.FLOAT_MAT3=35675]="FLOAT_MAT3",C[C.FLOAT_MAT4=35676]="FLOAT_MAT4",C[C.SAMPLER_2D=35678]="SAMPLER_2D",C[C.SAMPLER_CUBE=35680]="SAMPLER_CUBE",C[C.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",C[C.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",C[C.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",C[C.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",C[C.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",C[C.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",C[C.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",C[C.COMPILE_STATUS=35713]="COMPILE_STATUS",C[C.LOW_FLOAT=36336]="LOW_FLOAT",C[C.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",C[C.HIGH_FLOAT=36338]="HIGH_FLOAT",C[C.LOW_INT=36339]="LOW_INT",C[C.MEDIUM_INT=36340]="MEDIUM_INT",C[C.HIGH_INT=36341]="HIGH_INT",C[C.FRAMEBUFFER=36160]="FRAMEBUFFER",C[C.RENDERBUFFER=36161]="RENDERBUFFER",C[C.RGBA4=32854]="RGBA4",C[C.RGB5_A1=32855]="RGB5_A1",C[C.RGB565=36194]="RGB565",C[C.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",C[C.STENCIL_INDEX=6401]="STENCIL_INDEX",C[C.STENCIL_INDEX8=36168]="STENCIL_INDEX8",C[C.DEPTH_STENCIL=34041]="DEPTH_STENCIL",C[C.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",C[C.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",C[C.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",C[C.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",C[C.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",C[C.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",C[C.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",C[C.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",C[C.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",C[C.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",C[C.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",C[C.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",C[C.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",C[C.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",C[C.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",C[C.NONE=0]="NONE",C[C.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",C[C.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",C[C.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",C[C.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",C[C.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",C[C.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",C[C.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",C[C.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",C[C.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",C[C.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",C[C.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",C[C.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",C[C.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL"})(ye||(ye={}))},69530:function(zr,B,S){"use strict";S.d(B,{Z:function(){return Xe}});var ye=S(55770),C=S(6610),d=S(5991),de=S(96156),re=S(3473),ie=S(11700),se=S.n(ie),Be=S(14293),$=S.n(Be),Je=S(68929),bt=S.n(Je),Gt=S(86700),Ir=S(28660),Qt=S.n(Ir),Yt=S(7648),ir=S(72302),jt=S(92364),Tt,Ct,br,q,dr;function Qe(Zt,xr){var qt=Object.keys(Zt);if(Object.getOwnPropertySymbols){var Xr=Object.getOwnPropertySymbols(Zt);xr&&(Xr=Xr.filter(function(ce){return Object.getOwnPropertyDescriptor(Zt,ce).enumerable})),qt.push.apply(qt,Xr)}return qt}function $e(Zt){for(var xr=1;xr<arguments.length;xr++){var qt=arguments[xr]!=null?arguments[xr]:{};xr%2?Qe(Object(qt),!0).forEach(function(Xr){(0,de.Z)(Zt,Xr,qt[Xr])}):Object.getOwnPropertyDescriptors?Object.defineProperties(Zt,Object.getOwnPropertyDescriptors(qt)):Qe(Object(qt)).forEach(function(Xr){Object.defineProperty(Zt,Xr,Object.getOwnPropertyDescriptor(qt,Xr))})}return Zt}var Rt=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Xe=(Tt=(0,Gt.b2)(),Ct=(0,Gt.f3)(ir.v.IShaderModuleService),Tt(br=(q=function(){function Zt(){(0,C.Z)(this,Zt),(0,ye.Z)(this,"shaderModuleService",dr,this),(0,de.Z)(this,"rendererService",void 0),(0,de.Z)(this,"config",void 0),(0,de.Z)(this,"quad",Rt),(0,de.Z)(this,"enabled",!0),(0,de.Z)(this,"renderToScreen",!1),(0,de.Z)(this,"model",void 0),(0,de.Z)(this,"name",void 0),(0,de.Z)(this,"optionsToUpdate",{})}return(0,d.Z)(Zt,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(qt){this.name=qt}},{key:"getType",value:function(){return jt.G.PostProcessing}},{key:"init",value:function(qt,Xr){this.config=Xr,this.rendererService=qt.getContainer().get(ir.v.IRendererService);var ce=this.rendererService,Re=ce.createAttribute,ge=ce.createBuffer,xt=ce.createModel,vt=this.setupShaders(),Nt=vt.vs,Dt=vt.fs,Ur=vt.uniforms;this.model=xt({vs:Nt,fs:Dt,attributes:{a_Position:Re({buffer:ge({data:[-4,-4,4,-4,0,4],type:Yt.gl.FLOAT}),size:2})},uniforms:$e($e({u_Texture:null},Ur),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(qt){var Xr=this,ce=qt.multiPassRenderer.getPostProcessor(),Re=this.rendererService,ge=Re.useFramebuffer,xt=Re.getViewportSize,vt=Re.clear,Nt=xt(),Dt=Nt.width,Ur=Nt.height;ge(this.renderToScreen?null:ce.getWriteFBO(),function(){vt({framebuffer:ce.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0}),Xr.model.draw({uniforms:$e({u_Texture:ce.getReadFBO(),u_ViewportSize:[Dt,Ur]},Xr.convertOptionsToUniforms(Xr.optionsToUpdate))})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(qt){this.enabled=qt}},{key:"setRenderToScreen",value:function(qt){this.renderToScreen=qt}},{key:"updateOptions",value:function(qt){this.optionsToUpdate=$e($e({},this.optionsToUpdate),qt)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(qt){var Xr={};return Object.keys(qt).forEach(function(ce){$()(qt[ce])||(Xr["u_".concat(se()(bt()(ce)))]=qt[ce])}),Xr}}]),Zt}(),dr=(0,re.Z)(q.prototype,"shaderModuleService",[Ct],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),q))||br)},19793:function(zr,B,S){"use strict";S.d(B,{P:function(){return ye}});var ye=["loaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"]},93102:function(){},8628:function(){},72302:function(zr,B,S){"use strict";S.d(B,{v:function(){return ye}});var ye={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")}},76915:function(zr,B,S){"use strict";var ye=S(74691),C=null;function d(Xe){return C.indexOf(Xe)}var de=2,re=4,ie=64,se=128,Be=256,$=512,Je=8192,bt=16384,Gt=32768,Ir=null,Qt=131072,Yt=262144,ir=524288,jt=1048576,Tt=2097152,Ct=4194304,br=8388608,q=16777216,dr=null;function Qe(Xe,Zt){return Xe=_clamp(Math.floor(Xe),0,255),Zt=_clamp(Math.floor(Zt),0,255),256*Xe+Zt}function $e(Xe){var Zt=Xe.color,xr=Xe.radius,qt=Xe.tileX,Xr=Xe.tileY,ce=Xe.shape,Re=Xe.opacity,ge=Xe.stroke,xt=Xe.strokeWidth,vt=Xe.strokeOpacity,Nt=[],Dt=[],Ur=[],dn=[Qe(Zt[0],Zt[1]),Qe(Zt[2],Zt[3])],on=[Qe(ge[0],ge[1]),Qe(ge[2],ge[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function($i){var or=_slicedToArray($i,2),me=or[0],Ae=or[1];Nt.push([].concat(dn,[(me+1)*br+(Ae+1)*Tt+getShapeIndex(ce)*Qt+xr,(qt+512)*ir+(Xr+512)*ie])),Dt.push([].concat(on,[xt,vt])),Ur.push([Re,0,0,0])}),{packedBuffer:Nt,packedBuffer2:Dt,packedBuffer3:Ur}}function Rt(Xe,Zt){if(Xe===0&&!Zt)return 0;if(Xe===1&&Zt)return 4294967295;var xr=Zt?1:0,qt=Math.floor(Xe*127);return qt*dr+xr*q+qt*Qt+xr*Ir+qt*$+xr*Be+qt*de+xr}},4771:function(){},6563:function(zr,B,S){var ye=S(31795);zr.exports=C;function C(Be,$){switch(Be&&Be.type||null){case"FeatureCollection":return Be.features=Be.features.map(d(C,$)),Be;case"GeometryCollection":return Be.geometries=Be.geometries.map(d(C,$)),Be;case"Feature":return Be.geometry=C(Be.geometry,$),Be;case"Polygon":case"MultiPolygon":return de(Be,$);default:return Be}}function d(Be,$){return function(Je){return Be(Je,$)}}function de(Be,$){return Be.type==="Polygon"?Be.coordinates=re(Be.coordinates,$):Be.type==="MultiPolygon"&&(Be.coordinates=Be.coordinates.map(d(re,$))),Be}function re(Be,$){$=!!$,Be[0]=ie(Be[0],$);for(var Je=1;Je<Be.length;Je++)Be[Je]=ie(Be[Je],!$);return Be}function ie(Be,$){return se(Be)===$?Be:Be.reverse()}function se(Be){return ye.ring(Be)>=0}},6901:function(zr,B,S){"use strict";S.d(B,{SO:function(){return ye},z6:function(){return lt},a5:function(){return C},Z:function(){return ut},rQ:function(){return En},bV:function(){return Yr},zi:function(){return _n},ds:function(){return Ye},Ev:function(){return At},oO:function(){return Or},W0:function(){return Pr},Z6:function(){return er},We:function(){return nr},Cl:function(){return Jr},gJ:function(){return Ue},vP:function(){return H},yM:function(){return K},yA:function(){return Tr},CI:function(){return wr}});var ye={};S.r(ye),S.d(ye,{DPR:function(){return $e},addClass:function(){return Ir},create:function(){return bt},empty:function(){return Tt},getClass:function(){return jt},getContainer:function(){return se},getViewPortScale:function(){return Qe},hasClass:function(){return Yt},printCanvas:function(){return dr},remove:function(){return Gt},removeClass:function(){return Qt},setClass:function(){return ir},setTransform:function(){return br},splitWords:function(){return $},triggerResize:function(){return q},trim:function(){return Be}});var C={};S.r(C),S.d(C,{getColumn:function(){return ue},getSatByColumn:function(){return pe},max:function(){return ei},mean:function(){return Zi},min:function(){return si},mode:function(){return Pi},statMap:function(){return X},sum:function(){return na}});function d(F){var ee=131,he=137,Te=0;F+="x";for(var ae=Math.floor(9007199254740991/he),Ee=0;Ee<F.length;Ee++)Te>ae&&(Te=Math.floor(Te/he)),Te=Te*ee+F.charCodeAt(Ee);return Te}function de(F){F=F.toString();for(var ee=5381,he=F.length;he;)ee=ee*33^F.charCodeAt(--he);return ee>>>0}var re=S(28481),ie=window.document.documentElement.style;function se(F){var ee=F;return typeof F=="string"&&(ee=document.getElementById(F)),ee}function Be(F){return F.trim?F.trim():F.replace(/^\s+|\s+$/g,"")}function $(F){return Be(F).split(/\s+/)}function Je(F){if(!ie)return F[0];for(var ee in F)if(F[ee]&&F[ee]in ie)return F[ee];return F[0]}function bt(F,ee,he){var Te=document.createElement(F);return Te.className=ee||"",he&&he.appendChild(Te),Te}function Gt(F){var ee=F.parentNode;ee&&ee.removeChild(F)}function Ir(F,ee){if(F.classList!==void 0)for(var he=$(ee),Te=0,ae=he.length;Te<ae;Te++)F.classList.add(he[Te]);else if(!Yt(F,ee)){var Ee=jt(F);ir(F,(Ee?Ee+" ":"")+ee)}}function Qt(F,ee){F.classList!==void 0?F.classList.remove(ee):ir(F,Be((" "+jt(F)+" ").replace(" "+ee+" "," ")))}function Yt(F,ee){if(F.classList!==void 0)return F.classList.contains(ee);var he=jt(F);return he.length>0&&new RegExp("(^|\\s)"+ee+"(\\s|$)").test(he)}function ir(F,ee){F instanceof HTMLElement?F.className=ee:F.className.baseVal=ee}function jt(F){return F instanceof SVGElement&&(F=F.correspondingElement),F.className.baseVal===void 0?F.className:F.className.baseVal}function Tt(F){for(;F&&F.firstChild;)F.removeChild(F.firstChild)}var Ct=Je(["transform","WebkitTransform"]);function br(F,ee){F.style[Ct]=ee}function q(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var F=window.document.createEvent("UIEvents");F.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(F)}}function dr(F){var ee=["padding: "+(F.height/2-8)+"px "+F.width/2+"px;","line-height: "+F.height+"px;","background-image: url("+F.toDataURL()+");"];console.log(`%c
`,ee.join(""))}function Qe(){var F,ee=document.querySelector('meta[name="viewport"]');if(!ee)return 1;var he=(F=ee.content)===null||F===void 0?void 0:F.split(","),Te=he.find(function(ae){var Ee=ae.split("="),mt=(0,re.Z)(Ee,2),Sr=mt[0],Wt=mt[1];return Sr==="initial-scale"});return Te?Te.split("=")[1]*1:1}var $e=Qe()<1?1:window.devicePixelRatio,Rt=S(6610),Xe=S(5991),Zt=S(63349),xr=S(10379),qt=S(46070),Xr=S(77608),ce=S(14665);function Re(F){return Function.toString.call(F).indexOf("[native code]")!==-1}var ge=S(51814);function xt(F,ee,he){return(0,ge.Z)()?xt=Reflect.construct:xt=function(ae,Ee,mt){var Sr=[null];Sr.push.apply(Sr,Ee);var Wt=Function.bind.apply(ae,Sr),Ke=new Wt;return mt&&(0,ce.Z)(Ke,mt.prototype),Ke},xt.apply(null,arguments)}function vt(F){var ee=typeof Map=="function"?new Map:void 0;return vt=function(Te){if(Te===null||!Re(Te))return Te;if(typeof Te!="function")throw new TypeError("Super expression must either be null or a function");if(typeof ee!="undefined"){if(ee.has(Te))return ee.get(Te);ee.set(Te,ae)}function ae(){return xt(Te,arguments,(0,Xr.Z)(this).constructor)}return ae.prototype=Object.create(Te.prototype,{constructor:{value:ae,enumerable:!1,writable:!0,configurable:!0}}),(0,ce.Z)(ae,Te)},vt(F)}var Nt=S(96156);function Dt(F){var ee=Ur();return function(){var Te=(0,Xr.Z)(F),ae;if(ee){var Ee=(0,Xr.Z)(this).constructor;ae=Reflect.construct(Te,arguments,Ee)}else ae=Te.apply(this,arguments);return(0,qt.Z)(this,ae)}}function Ur(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(F){return!1}}var dn=function(F){(0,xr.Z)(he,F);var ee=Dt(he);function he(Te,ae,Ee){var mt;return(0,Rt.Z)(this,he),mt=ee.call(this,Te),(0,Nt.Z)((0,Zt.Z)(mt),"status",void 0),(0,Nt.Z)((0,Zt.Z)(mt),"url",void 0),mt.status=ae,mt.url=Ee,mt.name=mt.constructor.name,mt.message=Te,mt}return(0,Xe.Z)(he,[{key:"toString",value:function(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}]),he}(vt(Error));function on(F){var ee=new XMLHttpRequest;ee.open("GET",F.url,!0);for(var he in F.headers)F.headers.hasOwnProperty(he)&&ee.setRequestHeader(he,F.headers[he]);return ee.withCredentials=F.credentials==="include",ee}var $i=function(ee,he){var Te=on(ee);return Te.setRequestHeader("Accept","application/json"),Te.onerror=function(){he(new Error(Te.statusText))},Te.onload=function(){if(Te.status>=200&&Te.status<300&&Te.response){var ae;try{ae=JSON.parse(Te.response)}catch(Ee){return he(Ee)}he(null,ae)}else Te.status===401?he(new dn("".concat(Te.statusText),Te.status,ee.url)):he(new dn(Te.statusText,Te.status,ee.url))},Te.send(),Te},or=function(ee,he){var Te=on(ee);return Te.responseType="arraybuffer",Te.onerror=function(){he(new Error(Te.statusText))},Te.onload=function(){var ae=Te.response;if(ae.byteLength===0&&Te.status===200)return he(new Error("http status 200 returned without content."));Te.status>=200&&Te.status<300&&Te.response?he(null,{data:ae,cacheControl:Te.getResponseHeader("Cache-Control"),expires:Te.getResponseHeader("Expires")}):he(new dn(Te.statusText,Te.status,ee.url))},Te.send(),Te};function me(F){var ee=window.document.createElement("a");return ee.href=F,ee.protocol===window.document.location.protocol&&ee.host===window.document.location.host}var Ae="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",Ue=function(ee,he){return or(ee,function(Te,ae){if(Te)he(Te);else if(ae){var Ee=new window.Image;Ee.crossOrigin="anonymous";var mt=window.URL||window.webkitURL;Ee.onload=function(){he(null,Ee),mt.revokeObjectURL(Ee.src)};var Sr=new window.Blob([new Uint8Array(ae.data)],{type:"image/png"});Ee.src=ae.data.byteLength?mt.createObjectURL(Sr):Ae}})},Le=S(40271),kt=2*Math.PI*6378137/2;function nr(F){var ee=[Infinity,Infinity,-Infinity,-Infinity];return F.forEach(function(he){var Te=he.coordinates;_r(ee,Te)}),ee}function _r(F,ee){return Array.isArray(ee[0])?ee.forEach(function(he){_r(F,he)}):(F[0]>ee[0]&&(F[0]=ee[0]),F[1]>ee[1]&&(F[1]=ee[1]),F[2]<ee[0]&&(F[2]=ee[0]),F[3]<ee[1]&&(F[3]=ee[1])),F}function Lr(F,ee){return fr(F,ee)}function fr(F,ee){return Array.isArray(F[0])?F.map(function(he){return fr(he,ee)}):ee(F)}function H(F){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,he=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};F=tt(F,ee);var Te=F[0],ae=F[1],Ee=Te*kt/180,mt=Math.log(Math.tan((90+ae)*Math.PI/360))/(Math.PI/180);return mt=mt*kt/180,he.enable&&(Ee=Number(Ee.toFixed(he.decimal)),mt=Number(mt.toFixed(he.decimal))),F.length===3?[Ee,mt,F[2]]:[Ee,mt]}function E(F){var ee=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,he=F[0],Te=F[1],ae=he/kt*180,Ee=Te/kt*180;return Ee=180/Math.PI*(2*Math.atan(Math.exp(Ee*Math.PI/180))-Math.PI/2),ee!=null&&(ae=Number(ae.toFixed(ee)),Ee=Number(Ee.toFixed(ee))),F.length===3?[ae,Ee,F[2]]:[ae,Ee]}function V(F){if(F==null)throw new Error("lng is required");return(F>180||F<-180)&&(F=F%360,F>180&&(F=-360+F),F<-180&&(F=360+F),F===0&&(F=0)),F}function Ze(F){if(F==null)throw new Error("lat is required");return(F>90||F<-90)&&(F=F%180,F>90&&(F=-180+F),F<-90&&(F=180+F),F===0&&(F=0)),F}function tt(F,ee){if(ee===!1)return F;var he=V(F[0]),Te=Ze(F[1]);return Te>85&&(Te=85),Te<-85&&(Te=-85),F.length===3?[he,Te,F[2]]:[he,Te]}function ut(F){var ee=85.0511287798,he=Math.max(Math.min(ee,F[1]),-ee),Te=256<<20,ae=Math.PI/180,Ee=F[0]*ae,mt=he*ae;mt=Math.log(Math.tan(Math.PI/4+mt/2));var Sr=.5/Math.PI,Wt=.5,Ke=-.5/Math.PI;return ae=.5,Ee=Te*(Sr*Ee+Wt),mt=Te*(Ke*mt+ae),[Math.floor(Ee),Math.floor(mt)]}function wt(F){var ee=.5/Math.PI,he=.5,Te=-.5/Math.PI,ae=.5,Ee=256<<20,mt=_slicedToArray(F,2),Sr=mt[0],Wt=mt[1];Sr=(Sr/Ee-he)/ee,Wt=(Wt/Ee-ae)/Te,Wt=(Math.atan(Math.pow(Math.E,Wt))-Math.PI/4)*2,ae=Math.PI/180;var Ke=Wt/ae,Zr=Sr/ae;return[Zr,Ke]}function K(F,ee,he){var Te=(0,Le.Ht)(ee[1]-F[1]),ae=(0,Le.Ht)(ee[0]-F[0]),Ee=(0,Le.Ht)(F[1]),mt=(0,Le.Ht)(ee[1]),Sr=Math.pow(Math.sin(Te/2),2)+Math.pow(Math.sin(ae/2),2)*Math.cos(Ee)*Math.cos(mt);return(0,Le.DL)(2*Math.atan2(Math.sqrt(Sr),Math.sqrt(1-Sr)),he="meters")}function Ht(F){var ee=Math.PI/180,he=85.0511287798,Te=6378137,ae=Math.max(Math.min(he,F[1]),-he),Ee=Math.sin(ae*ee),mt=Te*F[0]*ee,Sr=Te*Math.log((1+Ee)/(1-Ee))/2;return[mt,Sr]}function Tr(F,ee){var he=Math.abs(F[1][1]-F[0][1])*ee,Te=Math.abs(F[1][0]-F[0][0])*ee;return[[F[0][0]-Te,F[0][1]-he],[F[1][0]+Te,F[1][1]+he]]}function Or(F,ee){return F[0][0]<=ee[0][0]&&F[0][1]<=ee[0][1]&&F[1][0]>=ee[1][0]&&F[1][1]>=ee[1][1]}function Ye(F){return[[F[0],F[1]],[F[2],F[3]]]}var lt=function(){function F(){var ee=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,he=arguments.length>1?arguments[1]:void 0;(0,Rt.Z)(this,F),(0,Nt.Z)(this,"limit",void 0),(0,Nt.Z)(this,"cache",void 0),(0,Nt.Z)(this,"destroy",void 0),(0,Nt.Z)(this,"order",void 0),this.limit=ee,this.destroy=he||this.defaultDestroy,this.order=[],this.clear()}return(0,Xe.Z)(F,[{key:"clear",value:function(){var he=this;this.order.forEach(function(Te){he.delete(Te)}),this.cache={},this.order=[]}},{key:"get",value:function(he){var Te=this.cache[he];return Te&&(this.deleteOrder(he),this.appendOrder(he)),Te}},{key:"set",value:function(he,Te){this.cache[he]?(this.delete(he),this.cache[he]=Te,this.appendOrder(he)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[he]=Te,this.appendOrder(he))}},{key:"delete",value:function(he){var Te=this.cache[he];Te&&(this.deleteCache(he),this.deleteOrder(he),this.destroy(Te,he))}},{key:"deleteCache",value:function(he){delete this.cache[he]}},{key:"deleteOrder",value:function(he){var Te=this.order.findIndex(function(ae){return ae===he});Te>=0&&this.order.splice(Te,1)}},{key:"appendOrder",value:function(he){this.order.push(he)}},{key:"defaultDestroy",value:function(he,Te){return null}}]),F}();function At(F,ee){F.forEach(function(he){!ee[he]||(ee[he]=ee[he].bind(ee))})}var zt=S(2650);function wr(F){var ee=zt.ZP(F),he=[0,0,0,0];return ee!=null&&(he[0]=ee.r/255,he[1]=ee.g/255,he[2]=ee.b/255,he[3]=ee.opacity),he}function Pr(F){var ee=F&&F[0],he=F&&F[1],Te=F&&F[2],ae=ee+he*256+Te*65536-1;return ae}function er(F){return[F+1&255,F+1>>8&255,F+1>>8>>8&255]}function Jr(F){var ee=document.createElement("canvas"),he=ee.getContext("2d");ee.width=256,ee.height=1;for(var Te=he.createLinearGradient(0,0,256,1),ae=null,Ee=F.positions[0],mt=F.positions[F.positions.length-1],Sr=0;Sr<F.colors.length;++Sr){var Wt=(F.positions[Sr]-Ee)/(mt-Ee);Te.addColorStop(Wt,F.colors[Sr])}return he.fillStyle=Te,he.fillRect(0,0,256,1),ae=new Uint8ClampedArray(he.getImageData(0,0,256,1).data),new ImageData(ae,256,1)}var Yr;(function(F){F.CENTER="center",F.TOP="top",F["TOP-LEFT"]="top-left",F["TOP-RIGHT"]="top-right",F.BOTTOM="bottom",F["BOTTOM-LEFT"]="bottom-left",F.LEFT="left",F.RIGHT="right"})(Yr||(Yr={}));var En={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function _n(F,ee,he){var Te=F.classList;for(var ae in En)En.hasOwnProperty(ae)&&Te.remove("l7-".concat(he,"-anchor-").concat(ae));Te.add("l7-".concat(he,"-anchor-").concat(ee))}function ei(F){if(F.length===0)throw new Error("max requires at least one data point");for(var ee=F[0],he=1;he<F.length;he++)F[he]>ee&&(ee=F[he]);return ee*1}function si(F){if(F.length===0)throw new Error("min requires at least one data point");for(var ee=F[0],he=1;he<F.length;he++)F[he]<ee&&(ee=F[he]);return ee*1}function na(F){if(F.length===0)return 0;for(var ee=F[0]*1,he=1;he<F.length;he++)ee+=F[he]*1;return ee}function Zi(F){if(F.length===0)throw new Error("mean requires at least one data point");return na(F)/F.length}function Pi(F){if(F.length===0)throw new Error("mean requires at least one data point");if(F.length<3)return F[0];F.sort();for(var ee=F[0],he=NaN,Te=0,ae=1,Ee=1;Ee<F.length+1;Ee++)F[Ee]!==ee?(ae>Te&&(Te=ae,he=ee),ae=1,ee=F[Ee]):ae++;return he*1}var X={min:si,max:ei,mean:Zi,sum:na,mode:Pi};function ue(F,ee){return F.map(function(he){return he[ee]})}function pe(F,ee){return X[F](ee)}},3473:function(zr,B,S){"use strict";S.d(B,{Z:function(){return ye}});function ye(C,d,de,re,ie){var se={};return Object.keys(re).forEach(function(Be){se[Be]=re[Be]}),se.enumerable=!!se.enumerable,se.configurable=!!se.configurable,("value"in se||se.initializer)&&(se.writable=!0),se=de.slice().reverse().reduce(function(Be,$){return $(C,d,Be)||Be},se),ie&&se.initializer!==void 0&&(se.value=se.initializer?se.initializer.call(ie):void 0,se.initializer=void 0),se.initializer===void 0&&(Object.defineProperty(C,d,se),se=null),se}},66213:function(zr,B,S){"use strict";S.d(B,{Z:function(){return d}});var ye=S(77608);function C(de,re){for(;!Object.prototype.hasOwnProperty.call(de,re)&&(de=(0,ye.Z)(de),de!==null););return de}function d(de,re,ie){return typeof Reflect!="undefined"&&Reflect.get?d=Reflect.get:d=function(Be,$,Je){var bt=C(Be,$);if(!!bt){var Gt=Object.getOwnPropertyDescriptor(bt,$);return Gt.get?Gt.get.call(Je):Gt.value}},d(de,re,ie||de)}},55770:function(zr,B,S){"use strict";S.d(B,{Z:function(){return ye}});function ye(C,d,de,re){!de||Object.defineProperty(C,d,{enumerable:de.enumerable,configurable:de.configurable,writable:de.writable,value:de.initializer?de.initializer.call(re):void 0})}},31795:function(zr,B,S){var ye=S(75752);zr.exports.geometry=C,zr.exports.ring=de;function C(ie){var se=0,Be;switch(ie.type){case"Polygon":return d(ie.coordinates);case"MultiPolygon":for(Be=0;Be<ie.coordinates.length;Be++)se+=d(ie.coordinates[Be]);return se;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Be=0;Be<ie.geometries.length;Be++)se+=C(ie.geometries[Be]);return se}}function d(ie){var se=0;if(ie&&ie.length>0){se+=Math.abs(de(ie[0]));for(var Be=1;Be<ie.length;Be++)se-=Math.abs(de(ie[Be]))}return se}function de(ie){var se,Be,$,Je,bt,Gt,Ir,Qt=0,Yt=ie.length;if(Yt>2){for(Ir=0;Ir<Yt;Ir++)Ir===Yt-2?(Je=Yt-2,bt=Yt-1,Gt=0):Ir===Yt-1?(Je=Yt-1,bt=0,Gt=1):(Je=Ir,bt=Ir+1,Gt=Ir+2),se=ie[Je],Be=ie[bt],$=ie[Gt],Qt+=(re($[0])-re(se[0]))*Math.sin(re(Be[1]));Qt=Qt*ye.RADIUS*ye.RADIUS/2}return Qt}function re(ie){return ie*Math.PI/180}},49296:function(zr){"use strict";zr.exports=S,zr.exports.default=S;var B=1e20;function S(re,ie,se,Be,$,Je){this.fontSize=re||24,this.buffer=ie===void 0?3:ie,this.cutoff=Be||.25,this.fontFamily=$||"sans-serif",this.fontWeight=Je||"normal",this.radius=se||8;var bt=this.size=this.fontSize+this.buffer*2,Gt=bt+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=bt,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(Gt*Gt),this.gridInner=new Float64Array(Gt*Gt),this.f=new Float64Array(Gt),this.z=new Float64Array(Gt+1),this.v=new Uint16Array(Gt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(bt/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ye(re,ie,se,Be,$,Je,bt){Je.fill(B,0,ie*se),bt.fill(0,0,ie*se);for(var Gt=(ie-Be)/2,Ir=0;Ir<$;Ir++)for(var Qt=0;Qt<Be;Qt++){var Yt=(Ir+Gt)*ie+Qt+Gt,ir=re.data[4*(Ir*Be+Qt)+3]/255;if(ir===1)Je[Yt]=0,bt[Yt]=B;else if(ir===0)Je[Yt]=B,bt[Yt]=0;else{var jt=Math.max(0,.5-ir),Tt=Math.max(0,ir-.5);Je[Yt]=jt*jt,bt[Yt]=Tt*Tt}}}function C(re,ie,se,Be,$,Je,bt){for(var Gt=0;Gt<ie*se;Gt++){var Ir=Math.sqrt(Be[Gt])-Math.sqrt($[Gt]);re[Gt]=Math.round(255-255*(Ir/Je+bt))}}S.prototype._draw=function(re,ie){var se=this.ctx.measureText(re),Be=se.width,$=2*this.buffer,Je,bt,Gt,Ir,Qt,Yt,ir,jt;ie&&this.useMetrics?(Qt=Math.floor(se.actualBoundingBoxAscent),jt=this.buffer+Math.ceil(se.actualBoundingBoxAscent),Yt=this.buffer,ir=this.buffer,bt=Math.min(this.size,Math.ceil(se.actualBoundingBoxRight-se.actualBoundingBoxLeft)),Ir=Math.min(this.size-Yt,Math.ceil(se.actualBoundingBoxAscent+se.actualBoundingBoxDescent)),Je=bt+$,Gt=Ir+$,this.ctx.textBaseline="alphabetic"):(Je=bt=this.size,Gt=Ir=this.size,Qt=19*this.fontSize/24,Yt=ir=0,jt=this.middle,this.ctx.textBaseline="middle");var Tt;bt&&Ir&&(this.ctx.clearRect(ir,Yt,bt,Ir),this.ctx.fillText(re,this.buffer,jt),Tt=this.ctx.getImageData(ir,Yt,bt,Ir));var Ct=new Uint8ClampedArray(Je*Gt);return ye(Tt,Je,Gt,bt,Ir,this.gridOuter,this.gridInner),d(this.gridOuter,Je,Gt,this.f,this.v,this.z),d(this.gridInner,Je,Gt,this.f,this.v,this.z),C(Ct,Je,Gt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Ct,metrics:{width:bt,height:Ir,sdfWidth:Je,sdfHeight:Gt,top:Qt,left:0,advance:Be}}},S.prototype.draw=function(re){return this._draw(re,!1).data},S.prototype.drawWithMetrics=function(re){return this._draw(re,!0)};function d(re,ie,se,Be,$,Je){for(var bt=0;bt<ie;bt++)de(re,bt,ie,se,Be,$,Je);for(var Gt=0;Gt<se;Gt++)de(re,Gt*ie,1,ie,Be,$,Je)}function de(re,ie,se,Be,$,Je,bt){var Gt,Ir,Qt,Yt;for(Je[0]=0,bt[0]=-B,bt[1]=B,Gt=0;Gt<Be;Gt++)$[Gt]=re[ie+Gt*se];for(Gt=1,Ir=0,Qt=0;Gt<Be;Gt++){do Yt=Je[Ir],Qt=($[Gt]-$[Yt]+Gt*Gt-Yt*Yt)/(Gt-Yt)/2;while(Qt<=bt[Ir]&&--Ir>-1);Ir++,Je[Ir]=Gt,bt[Ir]=Qt,bt[Ir+1]=B}for(Gt=0,Ir=0;Gt<Be;Gt++){for(;bt[Ir+1]<Gt;)Ir++;Yt=Je[Ir],re[ie+Gt*se]=$[Yt]+(Gt-Yt)*(Gt-Yt)}}},40271:function(zr,B,S){"use strict";S.d(B,{zL:function(){return re},DL:function(){return Ct},Ht:function(){return $e}});var ye=63710088e-1,C={centimeters:ye*100,centimetres:ye*100,degrees:ye/111325,feet:ye*3.28084,inches:ye*39.37,kilometers:ye/1e3,kilometres:ye/1e3,meters:ye,metres:ye,miles:ye/1609.344,millimeters:ye*1e3,millimetres:ye*1e3,nauticalmiles:ye/1852,radians:1,yards:ye*1.0936},d={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/ye,yards:1.0936133},de={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function re(ce,Re,ge){ge===void 0&&(ge={});var xt={type:"Feature"};return(ge.id===0||ge.id)&&(xt.id=ge.id),ge.bbox&&(xt.bbox=ge.bbox),xt.properties=Re||{},xt.geometry=ce,xt}function ie(ce,Re,ge){switch(ge===void 0&&(ge={}),ce){case"Point":return se(Re).geometry;case"LineString":return bt(Re).geometry;case"Polygon":return $(Re).geometry;case"MultiPoint":return Yt(Re).geometry;case"MultiLineString":return Qt(Re).geometry;case"MultiPolygon":return ir(Re).geometry;default:throw new Error(ce+" is invalid")}}function se(ce,Re,ge){if(ge===void 0&&(ge={}),!ce)throw new Error("coordinates is required");if(!Array.isArray(ce))throw new Error("coordinates must be an Array");if(ce.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Zt(ce[0])||!Zt(ce[1]))throw new Error("coordinates must contain numbers");var xt={type:"Point",coordinates:ce};return re(xt,Re,ge)}function Be(ce,Re,ge){return ge===void 0&&(ge={}),Ir(ce.map(function(xt){return se(xt,Re)}),ge)}function $(ce,Re,ge){ge===void 0&&(ge={});for(var xt=0,vt=ce;xt<vt.length;xt++){var Nt=vt[xt];if(Nt.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var Dt=0;Dt<Nt[Nt.length-1].length;Dt++)if(Nt[Nt.length-1][Dt]!==Nt[0][Dt])throw new Error("First and last Position are not equivalent.")}var Ur={type:"Polygon",coordinates:ce};return re(Ur,Re,ge)}function Je(ce,Re,ge){return ge===void 0&&(ge={}),Ir(ce.map(function(xt){return $(xt,Re)}),ge)}function bt(ce,Re,ge){if(ge===void 0&&(ge={}),ce.length<2)throw new Error("coordinates must be an array of two or more positions");var xt={type:"LineString",coordinates:ce};return re(xt,Re,ge)}function Gt(ce,Re,ge){return ge===void 0&&(ge={}),Ir(ce.map(function(xt){return bt(xt,Re)}),ge)}function Ir(ce,Re){Re===void 0&&(Re={});var ge={type:"FeatureCollection"};return Re.id&&(ge.id=Re.id),Re.bbox&&(ge.bbox=Re.bbox),ge.features=ce,ge}function Qt(ce,Re,ge){ge===void 0&&(ge={});var xt={type:"MultiLineString",coordinates:ce};return re(xt,Re,ge)}function Yt(ce,Re,ge){ge===void 0&&(ge={});var xt={type:"MultiPoint",coordinates:ce};return re(xt,Re,ge)}function ir(ce,Re,ge){ge===void 0&&(ge={});var xt={type:"MultiPolygon",coordinates:ce};return re(xt,Re,ge)}function jt(ce,Re,ge){ge===void 0&&(ge={});var xt={type:"GeometryCollection",geometries:ce};return re(xt,Re,ge)}function Tt(ce,Re){if(Re===void 0&&(Re=0),Re&&!(Re>=0))throw new Error("precision must be a positive number");var ge=Math.pow(10,Re||0);return Math.round(ce*ge)/ge}function Ct(ce,Re){Re===void 0&&(Re="kilometers");var ge=C[Re];if(!ge)throw new Error(Re+" units is invalid");return ce*ge}function br(ce,Re){Re===void 0&&(Re="kilometers");var ge=C[Re];if(!ge)throw new Error(Re+" units is invalid");return ce/ge}function q(ce,Re){return Qe(br(ce,Re))}function dr(ce){var Re=ce%360;return Re<0&&(Re+=360),Re}function Qe(ce){var Re=ce%(2*Math.PI);return Re*180/Math.PI}function $e(ce){var Re=ce%360;return Re*Math.PI/180}function Rt(ce,Re,ge){if(Re===void 0&&(Re="kilometers"),ge===void 0&&(ge="kilometers"),!(ce>=0))throw new Error("length must be a positive number");return Ct(br(ce,Re),ge)}function Xe(ce,Re,ge){if(Re===void 0&&(Re="meters"),ge===void 0&&(ge="kilometers"),!(ce>=0))throw new Error("area must be a positive number");var xt=de[Re];if(!xt)throw new Error("invalid original units");var vt=de[ge];if(!vt)throw new Error("invalid final units");return ce/xt*vt}function Zt(ce){return!isNaN(ce)&&ce!==null&&!Array.isArray(ce)}function xr(ce){return!!ce&&ce.constructor===Object}function qt(ce){if(!ce)throw new Error("bbox is required");if(!Array.isArray(ce))throw new Error("bbox must be an Array");if(ce.length!==4&&ce.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");ce.forEach(function(Re){if(!Zt(Re))throw new Error("bbox must only contain numbers")})}function Xr(ce){if(!ce)throw new Error("id is required");if(["string","number"].indexOf(typeof ce)===-1)throw new Error("id must be a number or a string")}},70499:function(zr){zr.exports={activeChart:"activeChart___15gpK",activeChartGrid:"activeChartGrid___3PL4c",activeChartLegend:"activeChartLegend___2Ieyc",dashedLine:"dashedLine___2fgZX",line:"line___2cxqk"}},19134:function(zr){zr.exports={mapChart:"mapChart___4fQJB",pieCard:"pieCard___1ETZj"}},76356:function(zr,B,S){"use strict";S.r(B),S.d(B,{default:function(){return Ry}});var ye=S(58024),C=S(39144),d=S(13062),de=S(71230),re=S(89032),ie=S(15746),se=S(95300),Be=S(7277),$=S(21010),Je=S(71224),bt=S(75362),Gt=S(21349),Ir=S(92077),Qt=S.n(Ir),Yt=S(2824),ir=S(3182),jt=S(69610),Tt=S(54941),Ct=S(81306),br=S(59206),q=S(94043),dr=S.n(q),Qe=S(67294),$e=(0,Qe.createContext)({});function Rt(){return(0,Qe.useContext)($e)}var Xe={},Zt={},xr=function(c){return Zt[c]},qt=function(c,a){Zt[c]=a},Xr=function(c){return Xe[c]},ce=function(c,a){Xe[c]=a},Re={},ge={},xt=34,vt=10,Nt=13;function Dt(n){return new Function("d","return {"+n.map(function(c,a){return JSON.stringify(c)+": d["+a+'] || ""'}).join(",")+"}")}function Ur(n,c){var a=Dt(n);return function(s,l){return c(a(s),l,n)}}function dn(n){var c=Object.create(null),a=[];return n.forEach(function(s){for(var l in s)l in c||a.push(c[l]=l)}),a}function on(n,c){var a=n+"",s=a.length;return s<c?new Array(c-s+1).join(0)+a:a}function $i(n){return n<0?"-"+on(-n,6):n>9999?"+"+on(n,6):on(n,4)}function or(n){var c=n.getUTCHours(),a=n.getUTCMinutes(),s=n.getUTCSeconds(),l=n.getUTCMilliseconds();return isNaN(n)?"Invalid Date":$i(n.getUTCFullYear(),4)+"-"+on(n.getUTCMonth()+1,2)+"-"+on(n.getUTCDate(),2)+(l?"T"+on(c,2)+":"+on(a,2)+":"+on(s,2)+"."+on(l,3)+"Z":s?"T"+on(c,2)+":"+on(a,2)+":"+on(s,2)+"Z":a||c?"T"+on(c,2)+":"+on(a,2)+"Z":"")}function me(n){var c=new RegExp('["'+n+`
\r]`),a=n.charCodeAt(0);function s(G,ve){var Fe,ht,It=l(G,function(pr,Cr){if(Fe)return Fe(pr,Cr-1);ht=pr,Fe=ve?Ur(pr,ve):Dt(pr)});return It.columns=ht||[],It}function l(G,ve){var Fe=[],ht=G.length,It=0,pr=0,Cr,Vr=ht<=0,pn=!1;G.charCodeAt(ht-1)===vt&&--ht,G.charCodeAt(ht-1)===Nt&&--ht;function gn(){if(Vr)return ge;if(pn)return pn=!1,Re;var Yn,Qn=It,Si;if(G.charCodeAt(Qn)===xt){for(;It++<ht&&G.charCodeAt(It)!==xt||G.charCodeAt(++It)===xt;);return(Yn=It)>=ht?Vr=!0:(Si=G.charCodeAt(It++))===vt?pn=!0:Si===Nt&&(pn=!0,G.charCodeAt(It)===vt&&++It),G.slice(Qn+1,Yn-1).replace(/""/g,'"')}for(;It<ht;){if((Si=G.charCodeAt(Yn=It++))===vt)pn=!0;else if(Si===Nt)pn=!0,G.charCodeAt(It)===vt&&++It;else if(Si!==a)continue;return G.slice(Qn,Yn)}return Vr=!0,G.slice(Qn,ht)}for(;(Cr=gn())!==ge;){for(var Dn=[];Cr!==Re&&Cr!==ge;)Dn.push(Cr),Cr=gn();ve&&(Dn=ve(Dn,pr++))==null||Fe.push(Dn)}return Fe}function p(G,ve){return G.map(function(Fe){return ve.map(function(ht){return Y(Fe[ht])}).join(n)})}function _(G,ve){return ve==null&&(ve=dn(G)),[ve.map(Y).join(n)].concat(p(G,ve)).join(`
`)}function A(G,ve){return ve==null&&(ve=dn(G)),p(G,ve).join(`
`)}function M(G){return G.map(L).join(`
`)}function L(G){return G.map(Y).join(n)}function Y(G){return G==null?"":G instanceof Date?or(G):c.test(G+="")?'"'+G.replace(/"/g,'""')+'"':G}return{parse:s,parseRows:l,format:_,formatBody:A,formatRows:M,formatRow:L,formatValue:Y}}var Ae=me(","),Ue=Ae.parse,Le=Ae.parseRows,kt=Ae.format,nr=Ae.formatBody,_r=Ae.formatRows,Lr=Ae.formatRow,fr=Ae.formatValue,H=S(96156),E=S(85061),V=S(6563),Ze=S.n(V);function tt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ut(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?tt(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):tt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function wt(n,c){var a=c.x,s=c.y,l=c.x1,p=c.y1,_=c.coordinates,A=[];return n.forEach(function(M,L){var Y=[];if(a&&s&&(Y=[parseFloat(M[a]),parseFloat(M[s])]),a&&s&&l&&p){var G=[parseFloat(M[a]),parseFloat(M[s])],ve=[parseFloat(M[l]),parseFloat(M[p])];Y=[G,ve]}if(_){var Fe="Polygon";Array.isArray(_[0])||(Fe="Point"),Array.isArray(_[0])&&!Array.isArray(_[0][0])&&(Fe="LineString");var ht={type:Fe,coordinates:(0,E.Z)(M[_])};Ze()(ht,!0),Y=ht.coordinates}var It=ut(ut({},M),{},{_id:L,coordinates:Y});A.push(It)}),{dataArray:A}}var K=[{lng1:100,lat1:30,lng2:130,lat2:30}],Ht={parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}};function Tr(n,c){var a=Ue(n);return wt(a,c)}var Or=S(40271);function Ye(n){if(!n)throw new Error("coord is required");if(!Array.isArray(n)){if(n.type==="Feature"&&n.geometry!==null&&n.geometry.type==="Point")return n.geometry.coordinates;if(n.type==="Point")return n.coordinates}if(Array.isArray(n)&&n.length>=2&&!Array.isArray(n[0])&&!Array.isArray(n[1]))return n;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function lt(n){if(Array.isArray(n))return n;if(n.type==="Feature"){if(n.geometry!==null)return n.geometry.coordinates}else if(n.coordinates)return n.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function At(n){if(n.length>1&&isNumber(n[0])&&isNumber(n[1]))return!0;if(Array.isArray(n[0])&&n[0].length)return At(n[0]);throw new Error("coordinates must only contain numbers")}function zt(n,c,a){if(!c||!a)throw new Error("type and name required");if(!n||n.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.type)}function wr(n,c,a){if(!n)throw new Error("No feature passed");if(!a)throw new Error(".featureOf() requires a name");if(!n||n.type!=="Feature"||!n.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!n.geometry||n.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+n.geometry.type)}function Pr(n,c,a){if(!n)throw new Error("No featureCollection passed");if(!a)throw new Error(".collectionOf() requires a name");if(!n||n.type!=="FeatureCollection")throw new Error("Invalid input to "+a+", FeatureCollection required");for(var s=0,l=n.features;s<l.length;s++){var p=l[s];if(!p||p.type!=="Feature"||!p.geometry)throw new Error("Invalid input to "+a+", Feature with geometry required");if(!p.geometry||p.geometry.type!==c)throw new Error("Invalid input to "+a+": must be a "+c+", given "+p.geometry.type)}}function er(n){return n.type==="Feature"?n.geometry:n}function Jr(n,c){return n.type==="FeatureCollection"?"FeatureCollection":n.type==="GeometryCollection"?"GeometryCollection":n.type==="Feature"&&n.geometry!==null?n.geometry.type:n.type}function Yr(n,c,a){if(n!==null)for(var s,l,p,_,A,M,L,Y=0,G=0,ve,Fe=n.type,ht=Fe==="FeatureCollection",It=Fe==="Feature",pr=ht?n.features.length:1,Cr=0;Cr<pr;Cr++){L=ht?n.features[Cr].geometry:It?n.geometry:n,ve=L?L.type==="GeometryCollection":!1,A=ve?L.geometries.length:1;for(var Vr=0;Vr<A;Vr++){var pn=0,gn=0;if(_=ve?L.geometries[Vr]:L,_!==null){M=_.coordinates;var Dn=_.type;switch(Y=a&&(Dn==="Polygon"||Dn==="MultiPolygon")?1:0,Dn){case null:break;case"Point":if(c(M,G,Cr,pn,gn)===!1)return!1;G++,pn++;break;case"LineString":case"MultiPoint":for(s=0;s<M.length;s++){if(c(M[s],G,Cr,pn,gn)===!1)return!1;G++,Dn==="MultiPoint"&&pn++}Dn==="LineString"&&pn++;break;case"Polygon":case"MultiLineString":for(s=0;s<M.length;s++){for(l=0;l<M[s].length-Y;l++){if(c(M[s][l],G,Cr,pn,gn)===!1)return!1;G++}Dn==="MultiLineString"&&pn++,Dn==="Polygon"&&gn++}Dn==="Polygon"&&pn++;break;case"MultiPolygon":for(s=0;s<M.length;s++){for(gn=0,l=0;l<M[s].length;l++){for(p=0;p<M[s][l].length-Y;p++){if(c(M[s][l][p],G,Cr,pn,gn)===!1)return!1;G++}gn++}pn++}break;case"GeometryCollection":for(s=0;s<_.geometries.length;s++)if(Yr(_.geometries[s],c,a)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function En(n,c,a,s){var l=a;return Yr(n,function(p,_,A,M,L){_===0&&a===void 0?l=p:l=c(l,p,_,A,M,L)},s),l}function _n(n,c){var a;switch(n.type){case"FeatureCollection":for(a=0;a<n.features.length&&c(n.features[a].properties,a)!==!1;a++);break;case"Feature":c(n.properties,0);break}}function ei(n,c,a){var s=a;return _n(n,function(l,p){p===0&&a===void 0?s=l:s=c(s,l,p)}),s}function si(n,c){if(n.type==="Feature")c(n,0);else if(n.type==="FeatureCollection")for(var a=0;a<n.features.length&&c(n.features[a],a)!==!1;a++);}function na(n,c,a){var s=a;return si(n,function(l,p){p===0&&a===void 0?s=l:s=c(s,l,p)}),s}function Zi(n){var c=[];return Yr(n,function(a){c.push(a)}),c}function Pi(n,c){var a,s,l,p,_,A,M,L,Y,G,ve=0,Fe=n.type==="FeatureCollection",ht=n.type==="Feature",It=Fe?n.features.length:1;for(a=0;a<It;a++){for(A=Fe?n.features[a].geometry:ht?n.geometry:n,L=Fe?n.features[a].properties:ht?n.properties:{},Y=Fe?n.features[a].bbox:ht?n.bbox:void 0,G=Fe?n.features[a].id:ht?n.id:void 0,M=A?A.type==="GeometryCollection":!1,_=M?A.geometries.length:1,l=0;l<_;l++){if(p=M?A.geometries[l]:A,p===null){if(c(null,ve,L,Y,G)===!1)return!1;continue}switch(p.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(c(p,ve,L,Y,G)===!1)return!1;break}case"GeometryCollection":{for(s=0;s<p.geometries.length;s++)if(c(p.geometries[s],ve,L,Y,G)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}ve++}}function X(n,c,a){var s=a;return Pi(n,function(l,p,_,A,M){p===0&&a===void 0?s=l:s=c(s,l,p,_,A,M)}),s}function ue(n,c){Pi(n,function(a,s,l,p,_){var A=a===null?null:a.type;switch(A){case null:case"Point":case"LineString":case"Polygon":return c((0,Or.zL)(a,l,{bbox:p,id:_}),s,0)===!1?!1:void 0}var M;switch(A){case"MultiPoint":M="Point";break;case"MultiLineString":M="LineString";break;case"MultiPolygon":M="Polygon";break}for(var L=0;L<a.coordinates.length;L++){var Y=a.coordinates[L],G={type:M,coordinates:Y};if(c((0,Or.zL)(G,l),s,L)===!1)return!1}})}function pe(n,c,a){var s=a;return ue(n,function(l,p,_){p===0&&_===0&&a===void 0?s=l:s=c(s,l,p,_)}),s}function F(n,c){ue(n,function(a,s,l){var p=0;if(!!a.geometry){var _=a.geometry.type;if(!(_==="Point"||_==="MultiPoint")){var A,M=0,L=0,Y=0;if(Yr(a,function(G,ve,Fe,ht,It){if(A===void 0||s>M||ht>L||It>Y){A=G,M=s,L=ht,Y=It,p=0;return}var pr=lineString([A,G],a.properties);if(c(pr,s,l,It,p)===!1)return!1;p++,A=G})===!1)return!1}}})}function ee(n,c,a){var s=a,l=!1;return F(n,function(p,_,A,M,L){l===!1&&a===void 0?s=p:s=c(s,p,_,A,M,L),l=!0}),s}function he(n,c){if(!n)throw new Error("geojson is required");ue(n,function(a,s,l){if(a.geometry!==null){var p=a.geometry.type,_=a.geometry.coordinates;switch(p){case"LineString":if(c(a,s,l,0,0)===!1)return!1;break;case"Polygon":for(var A=0;A<_.length;A++)if(c(lineString(_[A],a.properties),s,l,A)===!1)return!1;break}}})}function Te(n,c,a){var s=a;return he(n,function(l,p,_,A){p===0&&a===void 0?s=l:s=c(s,l,p,_,A)}),s}function ae(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.segmentIndex||0,_=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":_=_||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":case"MultiPoint":return null;case"LineString":return p<0&&(p=M.length+p-1),lineString([M[p],M[p+1]],_,c);case"Polygon":return l<0&&(l=M.length+l),p<0&&(p=M[l].length+p-1),lineString([M[l][p],M[l][p+1]],_,c);case"MultiLineString":return s<0&&(s=M.length+s),p<0&&(p=M[s].length+p-1),lineString([M[s][p],M[s][p+1]],_,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),p<0&&(p=M[s][l].length-p-1),lineString([M[s][l][p],M[s][l][p+1]],_,c)}throw new Error("geojson is invalid")}function Ee(n,c){if(c=c||{},!isObject(c))throw new Error("options is invalid");var a=c.featureIndex||0,s=c.multiFeatureIndex||0,l=c.geometryIndex||0,p=c.coordIndex||0,_=c.properties,A;switch(n.type){case"FeatureCollection":a<0&&(a=n.features.length+a),_=_||n.features[a].properties,A=n.features[a].geometry;break;case"Feature":_=_||n.properties,A=n.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":A=n;break;default:throw new Error("geojson is invalid")}if(A===null)return null;var M=A.coordinates;switch(A.type){case"Point":return point(M,_,c);case"MultiPoint":return s<0&&(s=M.length+s),point(M[s],_,c);case"LineString":return p<0&&(p=M.length+p),point(M[p],_,c);case"Polygon":return l<0&&(l=M.length+l),p<0&&(p=M[l].length+p),point(M[l][p],_,c);case"MultiLineString":return s<0&&(s=M.length+s),p<0&&(p=M[s].length+p),point(M[s][p],_,c);case"MultiPolygon":return s<0&&(s=M.length+s),l<0&&(l=M[s].length+l),p<0&&(p=M[s][l].length-p),point(M[s][l][p],_,c)}throw new Error("geojson is invalid")}function mt(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Sr(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?mt(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):mt(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Wt(n,c){var a=[],s={};if(n.features=n.features.filter(function(p){var _=p.geometry;return p!=null&&_&&_.type&&_.coordinates&&_.coordinates.length>0}),Ze()(n,!0),n.features.length===0)return{dataArray:[],featureKeys:s};var l=0;return ue(n,function(p,_){var A=lt(p),M=_,L=Sr(Sr({},p.properties),{},{coordinates:A,_id:M});a.push(L)}),{dataArray:a,featureKeys:s}}var Ke=S(6901);function Zr(n,c){var a=c.extent,s=a===void 0?[121.168,30.2828,121.384,30.4219]:a,l=new Promise(function(_){kn(n,function(A){_(A)})}),p={images:l,_id:1,dataArray:[{_id:0,coordinates:[[s[0],s[1]],[s[2],s[3]]]}]};return p}function kn(n,c){var a=n,s=[];if(typeof a=="string")(0,Ke.gJ)({url:a},function(_,A){s.push(A),c(s)});else{var l=a.length,p=0;a.forEach(function(_){(0,Ke.gJ)({url:_},function(A,M){p++,s.push(M),p===l&&c(s)})})}return Zr}function Rn(n,c){var a=c.extent,s=c.width,l=c.height,p=c.min,_=c.max,A={_id:1,dataArray:[{_id:1,data:Array.from(n),width:s,height:l,min:p,max:_,coordinates:[[a[0],a[1]],[a[2],a[3]]]}]};return A}var ft=S(6610),vr=S(5991),et=S(63349),Dr=S(10379),In=S(46070),tr=S(77608),Ni=S(30236),ia=S.n(Ni),hi=S(47037),Fi=S.n(hi),Wi=S(23560),yi=S.n(Wi),ya=S(50361),La=S.n(ya),_i=S(46343),Mi=S(26729),Ji=S(69848),to=S.n(Ji);function jo(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function ja(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?jo(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):jo(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Xi(n,c){var a=c.radius,s=a===void 0?40:a,l=c.maxZoom,p=l===void 0?18:l,_=c.minZoom,A=_===void 0?0:_,M=c.zoom,L=M===void 0?2:M;if(n.pointIndex){var Y=n.pointIndex.getClusters(n.extent,Math.floor(L));return n.dataArray=du(Y),n}var G=new(to())({radius:s,minZoom:A,maxZoom:p}),ve={type:"FeatureCollection",features:[]};return ve.features=n.dataArray.map(function(Fe){return{type:"Feature",geometry:{type:"Point",coordinates:Fe.coordinates},properties:ja({},Fe)}}),G.load(ve.features),G}function du(n){return n.map(function(c,a){return ja({coordinates:c.geometry.coordinates,_id:a+1},c.properties)})}function ku(n){if(n.length===0)throw new Error("max requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]>c&&(c=n[a]);return c}function Ba(n){if(n.length===0)throw new Error("min requires at least one data point");for(var c=n[0],a=1;a<n.length;a++)n[a]<c&&(c=n[a]);return c}function Vo(n){if(n.length===0)return 0;for(var c=n[0],a=0,s,l=1;l<n.length;l++)s=c+n[l]*1,Math.abs(c)>=Math.abs(n[l])?a+=c-s+n[l]:a+=n[l]-s+c,c=s;return c+a*1}function Yi(n){if(n.length===0)throw new Error("mean requires at least one data point");return Vo(n)/n.length}var ro={min:Ba,max:ku,mean:Yi,sum:Vo};function Jo(n,c){return n.map(function(a){return a[c]*1})}function xa(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Lo(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?xa(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):xa(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function No(n){var c=Us();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Us(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function _o(n,c){if(Array.isArray(c))return c}var Qo=function(n){(0,Dr.Z)(a,n);var c=No(a);function a(s,l){var p;return(0,ft.Z)(this,a),p=c.call(this),(0,H.Z)((0,et.Z)(p),"data",void 0),(0,H.Z)((0,et.Z)(p),"extent",void 0),(0,H.Z)((0,et.Z)(p),"hooks",{init:new _i.ni}),(0,H.Z)((0,et.Z)(p),"parser",{type:"geojson"}),(0,H.Z)((0,et.Z)(p),"transforms",[]),(0,H.Z)((0,et.Z)(p),"cluster",!1),(0,H.Z)((0,et.Z)(p),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,H.Z)((0,et.Z)(p),"mapService",void 0),(0,H.Z)((0,et.Z)(p),"invalidExtent",!1),(0,H.Z)((0,et.Z)(p),"originData",void 0),(0,H.Z)((0,et.Z)(p),"rawData",void 0),(0,H.Z)((0,et.Z)(p),"cfg",{}),(0,H.Z)((0,et.Z)(p),"clusterIndex",void 0),p.originData=s,p.initCfg(l),p.hooks.init.tap("parser",function(){p.excuteParser()}),p.hooks.init.tap("cluster",function(){p.initCluster()}),p.hooks.init.tap("transform",function(){p.executeTrans()}),p.init(),p}return(0,vr.Z)(a,[{key:"setData",value:function(l,p){this.rawData=l,this.originData=l,this.initCfg(p),this.init(),this.emit("update")}},{key:"getClusters",value:function(l){return this.clusterIndex.getClusters(this.caculClusterExtent(2),l)}},{key:"getClustersLeaves",value:function(l){return this.clusterIndex.getLeaves(l,Infinity)}},{key:"updateClusterData",value:function(l){var p=this,_=this.clusterOptions,A=_.method,M=A===void 0?"sum":A,L=_.field,Y=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(l));this.clusterOptions.zoom=l,Y.forEach(function(G){G.id||(G.properties.point_count=1)}),(L||yi()(M))&&(Y=Y.map(function(G){var ve=G.id;if(ve){var Fe=p.clusterIndex.getLeaves(ve,Infinity),ht=Fe.map(function(Cr){return Cr.properties}),It;if(Fi()(M)&&L){var pr=Jo(ht,L);It=ro[M](pr)}yi()(M)&&(It=M(ht)),G.properties.stat=It}else G.properties.point_count=1;return G})),this.data=xr("geojson")({type:"FeatureCollection",features:Y}),this.executeTrans()}},{key:"getFeatureById",value:function(l){var p=this.parser.type,_=p===void 0?"geojson":p;if(_==="geojson"&&!this.cluster){var A=l<this.originData.features.length?this.originData.features[l]:"null",M=La()(A);if(this.transforms.length!==0){var L=this.data.dataArray.find(function(Y){return Y._id===l});M.properties=L}return M}else return l<this.data.dataArray.length?this.data.dataArray[l]:"null"}},{key:"getFeatureId",value:function(l,p){var _=this.data.dataArray.find(function(A){return A[l]===name});return _==null?void 0:_._id}},{key:"destroy",value:function(){this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null}},{key:"caculClusterExtent",value:function(l){var p=[[-Infinity,-Infinity],[Infinity,Infinity]];return this.invalidExtent||(p=(0,Ke.yA)((0,Ke.ds)(this.extent),l)),p[0].concat(p[1])}},{key:"initCfg",value:function(l){this.cfg=ia()(this.cfg,l,_o);var p=this.cfg;p&&(p.parser&&(this.parser=p.parser),p.transforms&&(this.transforms=p.transforms),this.cluster=p.cluster||!1,p.clusterOptions&&(this.cluster=!0,this.clusterOptions=Lo(Lo({},this.clusterOptions),p.clusterOptions)))}},{key:"excuteParser",value:function(){var l=this.parser,p=l.type||"geojson",_=xr(p);this.data=_(this.originData,l),this.extent=(0,Ke.We)(this.data.dataArray),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3]}},{key:"executeTrans",value:function(){var l=this,p=this.transforms;p.forEach(function(_){var A=_.type,M=Xr(A)(l.data,_);Object.assign(l.data,M)})}},{key:"initCluster",value:function(){if(!!this.cluster){var l=this.clusterOptions||{};this.clusterIndex=Xi(this.data,l)}}},{key:"init",value:function(){this.hooks.init.call(this)}}]),a}(Mi.EventEmitter);function Va(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.filter(a)),n}function uo(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=ss(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return p=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function ss(n,c){if(!!n){if(typeof n=="string")return Co(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Co(n,c)}}function Co(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var _e=6378e3;function De(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,p=l/(2*Math.PI*_e)*(256<<20)/2,_=pt(a,l),A=_.gridHash,M=_.gridOffset,L=Ai(A,M,c);return{yOffset:p,xOffset:p,radius:p,type:"grid",dataArray:L}}function pt(n,c){var a=Infinity,s=-Infinity,l,p=uo(n),_;try{for(p.s();!(_=p.n()).done;){var A=_.value;l=A.coordinates[1],Number.isFinite(l)&&(a=l<a?l:a,s=l>s?l:s)}}catch(pn){p.e(pn)}finally{p.f()}var M=(a+s)/2,L=$t(c,M);if(L.xOffset<=0||L.yOffset<=0)return{gridHash:{},gridOffset:L};var Y={},G=uo(n),ve;try{for(G.s();!(ve=G.n()).done;){var Fe=ve.value,ht=Fe.coordinates[1],It=Fe.coordinates[0];if(Number.isFinite(ht)&&Number.isFinite(It)){var pr=Math.floor((ht+90)/L.yOffset),Cr=Math.floor((It+180)/L.xOffset),Vr="".concat(pr,"-").concat(Cr);Y[Vr]=Y[Vr]||{count:0,points:[]},Y[Vr].count+=1,Y[Vr].points.push(Fe)}}}catch(pn){G.e(pn)}finally{G.f()}return{gridHash:Y,gridOffset:L}}function $t(n,c){var a=en(n),s=ti(c,n);return{yOffset:a,xOffset:s}}function en(n){return n/_e*(180/Math.PI)}function ti(n,c){return c/_e*(180/Math.PI)/Math.cos(n*Math.PI/180)}function Ai(n,c,a){return Object.keys(n).reduce(function(s,l,p){var _=l.split("-"),A=parseInt(_[0],10),M=parseInt(_[1],10),L={};if(a.field&&a.method){var Y=Ke.a5.getColumn(n[l].points,a.field);L[a.method]=Ke.a5.statMap[a.method](Y)}return Object.assign(L,{_id:p,coordinates:(0,Ke.Z)([-180+c.xOffset*(M+.5),-90+c.yOffset*(A+.5)]),rawData:n[l].points,count:n[l].count}),s.push(L),s},[])}var ha=S(28481),Na=Math.PI/3,po=[0,Na,2*Na,3*Na,4*Na,5*Na];function us(n){return n[0]}function vu(n){return n[1]}function Au(){var n=0,c=0,a=1,s=1,l=us,p=vu,_,A,M;function L(G){var ve={},Fe=[],ht,It=G.length;for(ht=0;ht<It;++ht)if(!(isNaN(Cr=+l.call(null,pr=G[ht],ht,G))||isNaN(Vr=+p.call(null,pr,ht,G)))){var pr,Cr,Vr,pn=Math.round(Vr=Vr/M),gn=Math.round(Cr=Cr/A-(pn&1)/2),Dn=Vr-pn;if(Math.abs(Dn)*3>1){var Yn=Cr-gn,Qn=gn+(Cr<gn?-1:1)/2,Si=pn+(Vr<pn?-1:1),qi=Cr-Qn,_a=Vr-Si;Yn*Yn+Dn*Dn>qi*qi+_a*_a&&(gn=Qn+(pn&1?1:-1)/2,pn=Si)}var gi=gn+"-"+pn,Aa=ve[gi];Aa?Aa.push(pr):(Fe.push(Aa=ve[gi]=[pr]),Aa.x=(gn+(pn&1)/2)*A,Aa.y=pn*M)}return Fe}function Y(G){var ve=0,Fe=0;return po.map(function(ht){var It=Math.sin(ht)*G,pr=-Math.cos(ht)*G,Cr=It-ve,Vr=pr-Fe;return ve=It,Fe=pr,[Cr,Vr]})}return L.hexagon=function(G){return"m"+Y(G==null?_:+G).join("l")+"z"},L.centers=function(){for(var G=[],ve=Math.round(c/M),Fe=Math.round(n/A),ht=ve*M;ht<s+_;ht+=M,++ve)for(var It=Fe*A+(ve&1)*A/2;It<a+A/2;It+=A)G.push([It,ht]);return G},L.mesh=function(){var G=Y(_).slice(0,4).join("l");return L.centers().map(function(ve){return"M"+ve+"m"+G}).join("")},L.x=function(G){return arguments.length?(l=G,L):l},L.y=function(G){return arguments.length?(p=G,L):p},L.radius=function(G){return arguments.length?(_=+G,A=_*2*Math.sin(Na),M=_*1.5,L):_},L.size=function(G){return arguments.length?(n=c=0,a=+G[0],s=+G[1],L):[a-n,s-c]},L.extent=function(G){return arguments.length?(n=+G[0][0],c=+G[0][1],a=+G[1][0],s=+G[1][1],L):[[n,c],[a,s]]},L.radius(1)}function Xu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Go(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Xu(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Xu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var qo=6378e3;function ls(n,c){var a=n.dataArray,s=c.size,l=s===void 0?10:s,p=c.method,_=p===void 0?"sum":p,A=l/(2*Math.PI*qo)*(256<<20)/2,M=a.map(function(ve){var Fe=(0,Ke.Z)(ve.coordinates),ht=(0,ha.Z)(Fe,2),It=ht[0],pr=ht[1];return Go(Go({},ve),{},{coordinates:[It,pr]})}),L=Au().radius(A).x(function(ve){return ve.coordinates[0]}).y(function(ve){return ve.coordinates[1]}),Y=L(M),G={dataArray:Y.map(function(ve,Fe){var ht;if(c.field&&_){var It=Ke.a5.getColumn(ve,c.field);ve[_]=Ke.a5.statMap[_](It)}return ht={},(0,H.Z)(ht,c.method,ve[_]),(0,H.Z)(ht,"count",ve.length),(0,H.Z)(ht,"rawData",ve),(0,H.Z)(ht,"coordinates",[ve.x,ve.y]),(0,H.Z)(ht,"_id",Fe),ht}),radius:A,xOffset:A,yOffset:A,type:"hexagon"};return G}function ys(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ho(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ys(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ys(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Ws(n,c){var a=c.sourceField,s=c.targetField,l=c.data,p={};return l.forEach(function(_){p[_[a]]=_}),n.dataArray=n.dataArray.map(function(_){var A=_[s];return Ho(Ho({},_),p[A])}),n}function ru(n,c){var a=c.callback;return a&&(n.dataArray=n.dataArray.map(a)),n}var Is=S(4771),Ta=Qo;qt("geojson",Wt),qt("image",Zr),qt("csv",Tr),qt("json",wt),qt("raster",Rn),ce("cluster",Xi),ce("filter",Va),ce("join",Ws),ce("map",ru),ce("grid",De),ce("hexagon",ls);var Ro=K,gl=Ht,U=S(58881);function nl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Rl(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?nl(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):nl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function yl(n){var c=il();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function il(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var nu=0,Fu=function(n){(0,Dr.Z)(a,n);var c=yl(a);function a(s){var l;return(0,ft.Z)(this,a),l=c.call(this),(0,H.Z)((0,et.Z)(l),"controlOption",void 0),(0,H.Z)((0,et.Z)(l),"container",void 0),(0,H.Z)((0,et.Z)(l),"sceneContainer",void 0),(0,H.Z)((0,et.Z)(l),"mapsService",void 0),(0,H.Z)((0,et.Z)(l),"renderService",void 0),(0,H.Z)((0,et.Z)(l),"layerService",void 0),(0,H.Z)((0,et.Z)(l),"controlService",void 0),(0,H.Z)((0,et.Z)(l),"isShow",void 0),l.controlOption=Rl(Rl({},l.getDefault()),s||{}),l}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{position:U.PositionType.TOPRIGHT,name:"".concat(nu++)}}},{key:"setPosition",value:function(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:U.PositionType.BOTTOMRIGHT,p=this.controlService;return p&&p.removeControl(this),this.controlOption.position=l,p&&p.addControl(this,this.sceneContainer),this}},{key:"addTo",value:function(l){this.mapsService=l.get(U.vK.IMapService),this.renderService=l.get(U.vK.IRendererService),this.layerService=l.get(U.vK.ILayerService),this.controlService=l.get(U.vK.IControlService),this.sceneContainer=l,this.isShow=!0,this.container=this.onAdd();var p=this.container,_=this.controlOption.position,A=this.controlService.controlCorners[_];return Ke.SO.addClass(p,"l7-control"),_.indexOf("bottom")!==-1?A.insertBefore(p,A.firstChild):A.appendChild(p),this}},{key:"onAdd",value:function(){throw new Error("Method not implemented.")}},{key:"onRemove",value:function(){throw new Error("Method not implemented.")}},{key:"hide",value:function(){var l=this.container;Ke.SO.addClass(l,"l7-control-hide"),this.isShow=!1}},{key:"show",value:function(){var l=this.container;Ke.SO.removeClass(l,"l7-control-hide"),this.isShow=!0}},{key:"remove",value:function(){if(!this.mapsService)return this;Ke.SO.remove(this.container),this.onRemove()}},{key:"_refocusOnMap",value:function(l){if(this.mapsService&&l&&l.screenX>0&&l.screenY>0){var p=this.mapsService.getContainer();p!==null&&p.focus()}}}]),a}(Mi.EventEmitter);function m(n){var c=w();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function w(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var N=function(n){(0,Dr.Z)(a,n);var c=m(a);function a(s){var l;return(0,ft.Z)(this,a),l=c.call(this,s),(0,H.Z)((0,et.Z)(l),"layerControlInputs",void 0),(0,H.Z)((0,et.Z)(l),"layers",void 0),(0,H.Z)((0,et.Z)(l),"lastZIndex",void 0),(0,H.Z)((0,et.Z)(l),"handlingClick",void 0),(0,H.Z)((0,et.Z)(l),"layersLink",void 0),(0,H.Z)((0,et.Z)(l),"baseLayersList",void 0),(0,H.Z)((0,et.Z)(l),"separator",void 0),(0,H.Z)((0,et.Z)(l),"overlaysList",void 0),(0,H.Z)((0,et.Z)(l),"form",void 0),l.layerControlInputs=[],l.layers=[],l.lastZIndex=0,l.handlingClick=!1,l.initLayers(),(0,Ke.Ev)(["checkDisabledLayers","onLayerChange","collapse","extend","expand","onInputClick"],(0,et.Z)(l)),l}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{collapsed:!0,position:U.PositionType.TOPRIGHT,autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,name:"layers"}}},{key:"onAdd",value:function(){var l=this;return this.initLayout(),this.update(),this.mapsService.on("zoomend",this.checkDisabledLayers),this.layers.forEach(function(p){p.layer.on("remove",l.onLayerChange),p.layer.on("add",l.onLayerChange)}),this.container}},{key:"addVisualLayer",value:function(l,p){return this.addLayer(l,p,!0),this.mapsService?this.update():this}},{key:"expand",value:function(){var l=this.renderService.getViewportSize(),p=l.height;Ke.SO.addClass(this.container,"l7-control-layers-expanded"),this.form.style.height="null";var _=p-(this.container.offsetTop+50);return _<this.form.clientHeight?(Ke.SO.addClass(this.form,"l7-control-layers-scrollbar"),this.form.style.height=_+"px"):Ke.SO.removeClass(this.form,"l7-control-layers-scrollbar"),this.checkDisabledLayers(),this}},{key:"collapse",value:function(){return Ke.SO.removeClass(this.container,"l7-control-layers-expanded"),this}},{key:"onRemove",value:function(){var l=this;!this.mapsService||(this.mapsService.off("click",this.collapse),this.layers.forEach(function(p){p.layer.off("remove",l.onLayerChange),p.layer.off("add",l.onLayerChange)}))}},{key:"initLayout",value:function(){var l="l7-control-layers",p=this.container=Ke.SO.create("div",l),_=this.controlOption.collapsed;p.setAttribute("aria-haspopup","true");var A=this.form=Ke.SO.create("form",l+"-list");_&&(this.mapsService.on("click",this.collapse),p.addEventListener("mouseenter",this.expand),p.addEventListener("mouseleave",this.collapse)),this.layersLink=Ke.SO.create("a",l+"-toggle",p);var M=this.layersLink;M.title="Layers",_||this.expand(),this.baseLayersList=Ke.SO.create("div",l+"-base",A),this.separator=Ke.SO.create("div",l+"-separator",A),this.overlaysList=Ke.SO.create("div",l+"-overlays",A),p.appendChild(A)}},{key:"initLayers",value:function(){var l=this,p=this.controlOption,_=p.baseLayers,A=_===void 0?{}:_,M=p.overlayers,L=M===void 0?{}:M;Object.keys(A).forEach(function(Y,G){l.addLayer(A[Y],Y,!1)}),Object.keys(L).forEach(function(Y,G){l.addLayer(L[Y],Y,!0)})}},{key:"update",value:function(){if(!this.container)return this;Ke.SO.empty(this.baseLayersList),Ke.SO.empty(this.overlaysList),this.layerControlInputs=[];var l,p,_,A,M=0;for(_=0;_<this.layers.length;_++)A=this.layers[_],this.addItem(A),p=p||A.overlay,l=l||!A.overlay,M+=A.overlay?0:1;return this.controlOption.hideSingleBase&&(l=l&&M>1,this.baseLayersList.style.display=l?"":"none"),this.separator.style.display=p&&l?"":"none",this}},{key:"checkDisabledLayers",value:function(){for(var l=this.layerControlInputs,p,_,A=this.mapsService.getZoom(),M=l.length-1;M>=0;M--)if(p=l[M],_=this.layerService.getLayer(p.layerId),_&&_.inited){var L=_.getMinZoom(),Y=_.getMaxZoom();p.disabled=A<L||A>Y}}},{key:"addLayer",value:function(l,p,_){this.mapsService&&(l.on("add",this.onLayerChange),l.on("remove",this.onLayerChange)),this.layers.push({layer:l,name:p,overlay:_});var A=this.controlOption,M=A.sortLayers,L=A.sortFunction,Y=A.autoZIndex;M&&this.layers.sort(function(G,ve){return L(G.layer,ve.layer,G.name,ve.name)}),Y&&l.setZIndex&&(this.lastZIndex++,l.setZIndex(this.lastZIndex)),this.expandIfNotCollapsed()}},{key:"expandIfNotCollapsed",value:function(){return this.mapsService&&!this.controlOption.collapsed&&this.expand(),this}},{key:"onLayerChange",value:function(l){this.handlingClick||this.update();var p=this.layerService.getLayer(l.target.layerId),_=p!=null&&p.overlay?l.type==="add"?"overlayadd":"overlayremove":l.type==="add"?"baselayerchange":null;_&&this.emit(_,p)}},{key:"createRadioElement",value:function(l,p){var _='<input type="radio" class="l7-control-layers-selector" name="'+l+'"'+(p?' checked="checked"':"")+"/>",A=document.createElement("div");return A.innerHTML=_,A.firstChild}},{key:"addItem",value:function(l){var p=document.createElement("label"),_=this.layerService.getLayer(l.layer.id),A=_&&_.inited&&l.layer.isVisible(),M;l.overlay?(M=document.createElement("input"),M.type="checkbox",M.className="l7-control-layers-selector",M.defaultChecked=A):M=this.createRadioElement("l7-base-layers",A),this.layerControlInputs.push(M),M.layerId=l.layer.id,M.addEventListener("click",this.onInputClick);var L=document.createElement("span");L.innerHTML=" "+l.name;var Y=document.createElement("div");p.appendChild(Y),Y.appendChild(M),Y.appendChild(L);var G=l.overlay?this.overlaysList:this.baseLayersList;return G.appendChild(p),this.checkDisabledLayers(),p}},{key:"onInputClick",value:function(){var l=this.layerControlInputs,p,_,A=[],M=[];this.handlingClick=!0;for(var L=l.length-1;L>=0;L--)p=l[L],_=this.layerService.getLayer(p.layerId),p.checked?A.push(_):p.checked||M.push(_);M.forEach(function(Y){Y.hide()}),A.forEach(function(Y){Y.show()}),this.handlingClick=!1}}]),a}(Fu);function I(n){var c=le();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function le(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Oe=function(n){(0,Dr.Z)(a,n);var c=I(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{position:U.PositionType.BOTTOMLEFT,name:"logo"}}},{key:"onAdd",value:function(){var l="l7-control-logo",p=Ke.SO.create("div",l),_=Ke.SO.create("a","l7-ctrl-logo");return _.target="_blank",_.rel="noopener nofollow",_.href="https://antv.alipay.com/l7",_.setAttribute("aria-label","AntV logo"),_.setAttribute("rel","noopener nofollow"),p.appendChild(_),p}},{key:"onRemove",value:function(){return null}}]),a}(Fu);function ct(n){var c=Ft();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Ft(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ut=function(n){(0,Dr.Z)(a,n);var c=ct(a);function a(s){var l;return(0,ft.Z)(this,a),l=c.call(this,s),(0,H.Z)((0,et.Z)(l),"mScale",void 0),(0,H.Z)((0,et.Z)(l),"iScale",void 0),(0,Ke.Ev)(["update"],(0,et.Z)(l)),l}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{position:U.PositionType.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,name:"scale"}}},{key:"onAdd",value:function(){var l="l7-control-scale",p=Ke.SO.create("div",l);this.addScales(l+"-line",p);var _=this.controlOption.updateWhenIdle;return this.mapsService.on(_?"moveend":"mapmove",this.update),this.mapsService.on(_?"zoomend":"zoomchange",this.update),this.update(),p}},{key:"onRemove",value:function(){var l=this.controlOption.updateWhenIdle;this.mapsService.off(l?"zoomend":"zoomchange",this.update),this.mapsService.off(l?"moveend":"mapmove",this.update)}},{key:"update",value:function(){var l=this.mapsService,p=this.controlOption.maxWidth,_=l.getSize()[1]/2,A=l.containerToLngLat([0,_]),M=l.containerToLngLat([p,_]),L=(0,Ke.yM)([A.lng,A.lat],[M.lng,M.lat]);this.updateScales(L)}},{key:"updateScales",value:function(l){var p=this.controlOption,_=p.metric,A=p.imperial;_&&l&&this.updateMetric(l),A&&l&&this.updateImperial(l)}},{key:"updateMetric",value:function(l){var p=this.getRoundNum(l),_=p<1e3?p+" m":p/1e3+" km";this.updateScale(this.mScale,_,p/l)}},{key:"updateImperial",value:function(l){var p=l*3.2808399,_,A,M;p>5280?(_=p/5280,A=this.getRoundNum(_),this.updateScale(this.iScale,A+" mi",A/_)):(M=this.getRoundNum(p),this.updateScale(this.iScale,M+" ft",M/p))}},{key:"updateScale",value:function(l,p,_){var A=this.controlOption.maxWidth;l.style.width=Math.round(A*_)+"px",l.innerHTML=p}},{key:"getRoundNum",value:function(l){var p=Math.pow(10,(Math.floor(l)+"").length-1),_=l/p;return _=_>=10?10:_>=5?5:_>=3?3:_>=2?2:1,p*_}},{key:"addScales",value:function(l,p){var _=this.controlOption,A=_.metric,M=_.imperial;A&&(this.mScale=Ke.SO.create("div",l,p)),M&&(this.iScale=Ke.SO.create("div",l,p))}}]),a}(Fu);function Fr(n){var c=Kr();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Kr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ni=function(n){(0,Dr.Z)(a,n);var c=Fr(a);function a(s){var l;return(0,ft.Z)(this,a),l=c.call(this,s),(0,H.Z)((0,et.Z)(l),"disabled",void 0),(0,H.Z)((0,et.Z)(l),"zoomInButton",void 0),(0,H.Z)((0,et.Z)(l),"zoomOutButton",void 0),(0,Ke.Ev)(["updateDisabled","zoomIn","zoomOut"],(0,et.Z)(l)),l}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{position:U.PositionType.TOPLEFT,zoomInText:"+",zoomInTitle:"Zoom in",zoomOutText:"&#x2212;",zoomOutTitle:"Zoom out",name:"zoom"}}},{key:"onAdd",value:function(){var l="l7-control-zoom",p=Ke.SO.create("div",l+" l7-bar");return this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,l+"-in",p,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,l+"-out",p,this.zoomOut),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),this.updateDisabled(),p}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"zoomIn",value:function(){!this.disabled&&this.mapsService.getZoom()<this.mapsService.getMaxZoom()&&this.mapsService.zoomIn()}},{key:"zoomOut",value:function(){!this.disabled&&this.mapsService.getZoom()>this.mapsService.getMinZoom()&&this.mapsService.zoomOut()}},{key:"createButton",value:function(l,p,_,A,M){var L=Ke.SO.create("a",_,A);return L.innerHTML=l,L.title=p,L.href="javascript:void(0)",L.addEventListener("click",M),L}},{key:"updateDisabled",value:function(){var l=this.mapsService,p="l7-disabled";Ke.SO.removeClass(this.zoomInButton,p),Ke.SO.removeClass(this.zoomOutButton,p),(this.disabled||l.getZoom()<=l.getMinZoom())&&Ke.SO.addClass(this.zoomOutButton,p),(this.disabled||l.getZoom()>=l.getMaxZoom())&&Ke.SO.addClass(this.zoomInButton,p)}}]),a}(Fu);function Ii(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function bi(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Ii(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Ii(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function pa(n){var c=Pa();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Pa(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var za=function(n){(0,Dr.Z)(a,n);var c=pa(a);function a(s){var l;return(0,ft.Z)(this,a),l=c.call(this),(0,H.Z)((0,et.Z)(l),"markerOption",void 0),(0,H.Z)((0,et.Z)(l),"defaultMarker",void 0),(0,H.Z)((0,et.Z)(l),"popup",void 0),(0,H.Z)((0,et.Z)(l),"mapsService",void 0),(0,H.Z)((0,et.Z)(l),"sceneSerive",void 0),(0,H.Z)((0,et.Z)(l),"lngLat",void 0),(0,H.Z)((0,et.Z)(l),"scene",void 0),(0,H.Z)((0,et.Z)(l),"added",!1),(0,H.Z)((0,et.Z)(l),"eventHandle",function(p){l.emit(p.type,{target:p,data:l.markerOption.extData,lngLat:l.lngLat})}),l.markerOption=bi(bi({},l.getDefault()),s),(0,Ke.Ev)(["update","onMove","onUp","addDragHandler","onMapClick"],(0,et.Z)(l)),l.init(),l}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{element:void 0,anchor:Ke.bV.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(l){this.scene=l,this.mapsService=l.get(U.vK.IMapService),this.sceneSerive=l.get(U.vK.ISceneService);var p=this.markerOption,_=p.element,A=p.draggable;return this.mapsService.getMarkerContainer().appendChild(_),this.registerMarkerEvent(_),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("mousedown",this.addDragHandler),this.mapsService.off("touchstart",this.addDragHandler),this.mapsService.off("mouseup",this.onUp),this.mapsService.off("touchend",this.onUp)),this.unRegisterMarkerEvent(),this.removeAllListeners();var l=this.markerOption.element;return l&&Ke.SO.remove(l),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(l){var p=this;if(!this.added)return this.once("added",function(){p.setElement(l)}),this;var _=this.markerOption.element;return _&&Ke.SO.remove(_),this.markerOption.element=l,this.init(),this.mapsService.getMarkerContainer().appendChild(l),this.registerMarkerEvent(l),this.update(),this}},{key:"openPopup",value:function(){var l=this;if(!this.added)return this.once("added",function(){l.openPopup()}),this;var p=this.popup;return p?(p.isOpen()||p.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var l=this;this.added||this.once("added",function(){l.closePopup()});var p=this.popup;return p&&p.remove(),this}},{key:"setPopup",value:function(l){return this.popup=l,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var l=this.popup;if(l)l.isOpen()?l.remove():l.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(l){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(l){this.markerOption.extData=l}},{key:"update",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,_=l.anchor;this.updatePosition(),Ke.SO.setTransform(p,"".concat(Ke.rQ[_]))}}},{key:"onMapClick",value:function(l){var p=this.markerOption.element;this.popup&&p&&this.togglePopup()}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.markerOption,p=l.element,_=l.offsets,A=this.lngLat,M=A.lng,L=A.lat,Y=this.mapsService.getBounds(),G=this.mapsService.lngLatToContainer([M,L]);if(p){p.style.display="block";var ve=this.mapsService.getContainer(),Fe=0,ht=0;if(ve&&(Fe=ve.scrollWidth,ht=ve.scrollHeight),Math.abs(Y[0][0])>180||Math.abs(Y[1][0])>180){if(G.x>Fe){var It=this.mapsService.lngLatToContainer([M-360,L]);G.x=It.x}if(G.x<0){var pr=this.mapsService.lngLatToContainer([M+360,L]);G.x=pr.x}}(G.x>Fe||G.x<0||G.y>ht||G.y<0)&&(p.style.display="none"),p.style.left=G.x+_[0]+"px",p.style.top=G.y-_[1]+"px"}}}},{key:"init",value:function(){var l=this,p=this.markerOption.element,_=this.markerOption,A=_.color,M=_.anchor;if(!p){this.defaultMarker=!0,p=Ke.SO.create("div"),this.markerOption.element=p;var L=document.createElementNS("http://www.w3.org/2000/svg","svg");L.setAttributeNS(null,"display","block"),L.setAttributeNS(null,"height","48px"),L.setAttributeNS(null,"width","48px"),L.setAttributeNS(null,"viewBox","0 0 1024 1024");var Y=document.createElementNS("http://www.w3.org/2000/svg","path");Y.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),Y.setAttributeNS(null,"fill",A),L.appendChild(Y),p.appendChild(L)}Ke.SO.addClass(p,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(G){var ve,Fe,ht=((ve=l.markerOption)===null||ve===void 0?void 0:ve.style)&&((Fe=l.markerOption)===null||Fe===void 0?void 0:Fe.style[G]);p&&(p.style[G]=ht)}),p.addEventListener("click",function(G){l.onMapClick(G)}),p.addEventListener("click",this.eventHandle),(0,Ke.zi)(p,M,"marker")}},{key:"registerMarkerEvent",value:function(l){l.addEventListener("mousemove",this.eventHandle),l.addEventListener("click",this.eventHandle),l.addEventListener("mousedown",this.eventHandle),l.addEventListener("mouseup",this.eventHandle),l.addEventListener("dblclick",this.eventHandle),l.addEventListener("contextmenu",this.eventHandle),l.addEventListener("mouseover",this.eventHandle),l.addEventListener("mouseout",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var l=this.getElement();l.removeEventListener("mousemove",this.eventHandle),l.removeEventListener("click",this.eventHandle),l.removeEventListener("mousedown",this.eventHandle),l.removeEventListener("mouseup",this.eventHandle),l.removeEventListener("dblclick",this.eventHandle),l.removeEventListener("contextmenu",this.eventHandle),l.removeEventListener("mouseover",this.eventHandle),l.removeEventListener("mouseout",this.eventHandle)}},{key:"addDragHandler",value:function(l){throw new Error("Method not implemented.")}},{key:"onUp",value:function(l){throw new Error("Method not implemented.")}}]),a}(Mi.EventEmitter),Ti=S(82492),_s=S.n(Ti);function iu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Bu(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?iu(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):iu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function tc(n){var c=Yu();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Yu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var rc=function(n){(0,Dr.Z)(a,n);var c=tc(a);function a(s){var l,p;return(0,ft.Z)(this,a),p=c.call(this),(0,H.Z)((0,et.Z)(p),"markers",[]),(0,H.Z)((0,et.Z)(p),"markerLayerOption",void 0),(0,H.Z)((0,et.Z)(p),"clusterIndex",void 0),(0,H.Z)((0,et.Z)(p),"points",[]),(0,H.Z)((0,et.Z)(p),"clusterMarkers",[]),(0,H.Z)((0,et.Z)(p),"mapsService",void 0),(0,H.Z)((0,et.Z)(p),"scene",void 0),(0,H.Z)((0,et.Z)(p),"zoom",void 0),(0,H.Z)((0,et.Z)(p),"bbox",void 0),p.markerLayerOption=_s()(p.getDefault(),s),(0,Ke.Ev)(["update"],(0,et.Z)(p)),p.zoom=((l=p.markerLayerOption.clusterOption)===null||l===void 0?void 0:l.zoom)||-99,p}return(0,vr.Z)(a,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(l){return this.scene=l,this.mapsService=l.get(U.vK.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.addMarkers(),this}},{key:"addMarker",value:function(l){var p=this.markerLayerOption.cluster;p&&this.addPoint(l,this.markers.length),this.markers.push(l)}},{key:"removeMarker",value:function(l){this.markers.indexOf(l);var p=this.markers.indexOf(l);p>-1&&this.markers.splice(p,1)}},{key:"hide",value:function(){this.markers.map(function(l){l.getElement().style.opacity="0"})}},{key:"show",value:function(){this.markers.map(function(l){l.getElement().style.opacity="1"})}},{key:"getMarkers",value:function(){var l=this.markerLayerOption.cluster;return l?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var l=this;this.getMarkers().forEach(function(p){p.addTo(l.scene)})}},{key:"clear",value:function(){this.markers.forEach(function(l){l.remove()}),this.clusterMarkers.forEach(function(l){l.remove()}),this.mapsService.off("camerachange",this.update),this.markers=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"addPoint",value:function(l,p){var _=l.getLnglat(),A=_.lng,M=_.lat,L={geometry:{type:"Point",coordinates:[A,M]},properties:Bu(Bu({},l.getExtData()),{},{marker_id:p})};this.points.push(L)}},{key:"initCluster",value:function(){if(!!this.markerLayerOption.cluster){var l=this.markerLayerOption.clusterOption,p=l.radius,_=l.minZoom,A=_===void 0?0:_,M=l.maxZoom;this.clusterIndex=new(to())({radius:p,minZoom:A,maxZoom:M}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(l,p){var _=this,A=l[0].concat(l[1]),M=this.clusterIndex.getClusters(A,p);this.clusterMarkers.forEach(function(L){L.remove()}),this.clusterMarkers=[],M.forEach(function(L){var Y,G=_.markerLayerOption.clusterOption,ve=G.field,Fe=G.method;if(L.properties&&(Y=L.properties)!==null&&Y!==void 0&&Y.cluster_id){var ht,It=_.getLeaves((ht=L.properties)===null||ht===void 0?void 0:ht.cluster_id);if(L.properties.clusterData=It,ve&&Fe){var pr=It==null?void 0:It.map(function(Dn){var Yn=(0,H.Z)({},ve,Dn.properties[ve]);return Yn}),Cr=Ke.a5.getColumn(pr,ve),Vr=Ke.a5.getSatByColumn(Fe,Cr),pn="point_"+Fe;L.properties[pn]=Vr.toFixed(2)}}var gn=_.clusterMarker(L);_.clusterMarkers.push(gn),gn.addTo(_.scene)})}},{key:"getLeaves",value:function(l){var p=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Infinity,_=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0;return l?this.clusterIndex.getLeaves(l,p,_):null}},{key:"clusterMarker",value:function(l){var p=this.markerLayerOption.clusterOption,_=p,A=_.element,M=A===void 0?this.generateElement.bind(this):A,L=new za({element:M(l)}).setLnglat({lng:l.geometry.coordinates[0],lat:l.geometry.coordinates[1]});return L}},{key:"normalMarker",value:function(l){var p=l.properties.marker_id;return this.markers[p]}},{key:"update",value:function(){var l=this.mapsService.getZoom(),p=this.mapsService.getBounds();(!this.bbox||Math.abs(l-this.zoom)>=1||!(0,Ke.oO)(this.bbox,p))&&(this.bbox=(0,Ke.yA)(p,.5),this.zoom=Math.floor(l),this.getClusterMarker(this.bbox,this.zoom))}},{key:"generateElement",value:function(l){var p=Ke.SO.create("div","l7-marker-cluster"),_=Ke.SO.create("div","",p),A=Ke.SO.create("span","",_),M=this.markerLayerOption.clusterOption,L=M.field,Y=M.method;l.properties.point_count=l.properties.point_count||1;var G=L&&Y?l.properties["point_"+Y]||l.properties[L]:l.properties.point_count;return A.textContent=G,p}}]),a}(Mi.EventEmitter);function mu(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function gu(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?mu(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):mu(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Tu(n){var c=xo();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function xo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var nc=function(n){(0,Dr.Z)(a,n);var c=Tu(a);function a(s){var l;return(0,ft.Z)(this,a),l=c.call(this),(0,H.Z)((0,et.Z)(l),"popupOption",void 0),(0,H.Z)((0,et.Z)(l),"mapsService",void 0),(0,H.Z)((0,et.Z)(l),"sceneSerive",void 0),(0,H.Z)((0,et.Z)(l),"lngLat",void 0),(0,H.Z)((0,et.Z)(l),"content",void 0),(0,H.Z)((0,et.Z)(l),"closeButton",void 0),(0,H.Z)((0,et.Z)(l),"timeoutInstance",void 0),(0,H.Z)((0,et.Z)(l),"container",void 0),(0,H.Z)((0,et.Z)(l),"tip",void 0),(0,H.Z)((0,et.Z)(l),"scene",void 0),l.popupOption=gu(gu({},l.getdefault()),s),(0,Ke.Ev)(["update","onClickClose","remove"],(0,et.Z)(l)),l}return(0,vr.Z)(a,[{key:"addTo",value:function(l){var p=this;return this.mapsService=l.get(U.vK.IMapService),this.sceneSerive=l.get(U.vK.ISceneService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=l,this.update(),this.popupOption.closeOnClick&&(this.timeoutInstance=setTimeout(function(){p.mapsService.on("click",p.onClickClose)},30)),this.emit("open"),this}},{key:"close",value:function(){this.remove()}},{key:"open",value:function(){this.addTo(this.scene)}},{key:"setHTML",value:function(l){var p=window.document.createDocumentFragment(),_=window.document.createElement("body"),A;for(_.innerHTML=l;A=_.firstChild,!!A;)p.appendChild(A);return this.setDOMContent(p)}},{key:"setLnglat",value:function(l){return this.lngLat=l,Array.isArray(l)&&(this.lngLat={lng:l[0],lat:l[1]}),this.mapsService&&(this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setText",value:function(l){return this.setDOMContent(window.document.createTextNode(l))}},{key:"setMaxWidth",value:function(l){return this.popupOption.maxWidth=l,this.update(),this}},{key:"setDOMContent",value:function(l){return this.createContent(),this.content.appendChild(l),this.update(),this}},{key:"remove",value:function(){return this.content&&this.removeDom(this.content),this.container&&(this.removeDom(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("click",this.onClickClose),delete this.mapsService),clearTimeout(this.timeoutInstance),this.emit("close"),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"createContent",value:function(){this.content&&Ke.SO.remove(this.content),this.content=Ke.SO.create("div","l7-popup-content",this.container),this.popupOption.closeButton&&(this.closeButton=Ke.SO.create("button","l7-popup-close-button",this.content),this.popupOption.closeButtonOffsets&&(this.closeButton.style.right=this.popupOption.closeButtonOffsets[0]+"px",this.closeButton.style.top=this.popupOption.closeButtonOffsets[1]+"px"),this.closeButton.setAttribute("aria-label","Close popup"),this.closeButton.innerHTML="&#215;",this.closeButton.addEventListener("click",this.onClickClose))}},{key:"creatDom",value:function(l,p,_){var A=window.document.createElement(l);return p!==void 0&&(A.className=p),_&&_.appendChild(A),A}},{key:"removeDom",value:function(l){l.parentNode&&l.parentNode.removeChild(l)}},{key:"getdefault",value:function(){return{closeButton:!0,closeOnClick:!0,maxWidth:"240px",offsets:[0,0],anchor:Ke.bV.BOTTOM,className:"",stopPropagation:!0}}},{key:"onClickClose",value:function(l){l.stopPropagation&&l.stopPropagation(),this.remove()}},{key:"update",value:function(){var l=this,p=this.lngLat,_=this.popupOption,A=_.className,M=_.maxWidth,L=_.anchor;if(!(!this.mapsService||!p||!this.content)){var Y=this.mapsService.getMarkerContainer();if(!this.container&&Y){this.container=this.creatDom("div","l7-popup",Y),this.tip=this.creatDom("div","l7-popup-tip",this.container),this.container.appendChild(this.content),A&&A.split(" ").forEach(function(ve){return l.container.classList.add(ve)});var G=this.popupOption.stopPropagation;G&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(ve){l.container.addEventListener(ve,function(Fe){Fe.stopPropagation()})})}M&&this.container.style.maxWidth!==M&&(this.container.style.maxWidth=M),this.updatePosition(),Ke.SO.setTransform(this.container,"".concat(Ke.rQ[L])),(0,Ke.zi)(this.container,L,"popup")}}},{key:"updatePosition",value:function(){if(!!this.mapsService){var l=this.lngLat,p=l.lng,_=l.lat,A=this.popupOption.offsets,M=this.mapsService.lngLatToContainer([p,_]);this.container.style.left=M.x+A[0]+"px",this.container.style.top=M.y-A[1]+"px"}}}]),a}(Mi.EventEmitter);function yc(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}yc(`.l7-marker-container {
  width: 100%;
  height: 100%;
  overflow: hidden;
  position: absolute;
}

.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}

.l7-marker-cluster {
  background-clip: padding-box;
  border-radius: 20px;
  background-color: rgba(181, 226, 140, 0.6);
  width: 40px;
  height: 40px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-left: 5px;
  margin-top: 5px;
  text-align: center;
  border-radius: 15px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  background-color: rgba(110, 204, 57, 0.6);
}
.l7-marker-cluster span {
  line-height: 30px;
}

.l7-popup-anchor-bottom,
.l7-popup-anchor-bottom-left,
.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 5px;
}
.l7-popup-anchor-top,
.l7-popup-anchor-top-left,
.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}

.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
  z-index: 5;
}
.l7-popup-tip {
  width: 0;
  height: 0;
  border: 10px solid transparent;
  z-index: 1;
}
.l7-popup-anchor-top .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-left: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}

.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-bottom: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-bottom: none;
  border-left: none;
  border-top-color: #fff;
}

.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-bottom: none;
  border-right: none;
  border-top-color: #fff;
}

.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-left: none;
  border-right-color: #fff;
}

.l7-popup-anchor-right .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}

.l7-popup-close-button {
  position: absolute;
  right: 0;
  top: 0;
  border: 0;
  padding: 0;
  font-size: 25px;
  line-height: 20px;
  border-radius: 0 3px 0 0;
  cursor: pointer;
  background-color: transparent;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}

.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}

.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}

.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}

.l7-popup-track-pointer {
  display: none;
}

.l7-popup-track-pointer * {
  pointer-events: none;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}

.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}

.l7-map:active .l7-popup-track-pointer {
  display: none;
}

.l7-popup-close-button:hover {
  background-color: rgba(0, 0, 0, 0.05);
}

.l7-popup-content {
  position: relative;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  padding: 10px 10px 15px;
  pointer-events: auto;
}

/* general toolbar styles */

.l7-bar {
  -webkit-box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
          box-shadow: 0 1px 5px rgba(0, 0, 0, 0.65);
  border-radius: 4px;
}
.l7-bar a,
.l7-bar a:hover {
  background-color: #fff;
  width: 30px;
  height: 30px;
  font-size: 20px;
  display: block;
  text-align: center;
  text-decoration: none;
  color: #8e9dab;
}
.l7-bar a,
.l7-control-layers-toggle {
  background-position: 50% 50%;
  background-repeat: no-repeat;
  display: block;
}
.l7-bar a:hover {
  background-color: #f4f4f4;
}
.l7-bar a:first-child {
  border-top-left-radius: 2px;
  border-top-right-radius: 2px;
}
.l7-bar a:last-child {
  border-bottom-left-radius: 2px;
  border-bottom-right-radius: 2px;
  border-bottom: none;
}
.l7-bar a.l7-disabled {
  cursor: default;
  background-color: #f4f4f4;
  color: #bbb;
}

/* control positioning */

.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-hide {
  display: none;
}
.l7-control {
  position: relative;
  z-index: 800;
  pointer-events: visiblePainted; /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control {
  float: left;
  clear: both;
}
.l7-top,
.l7-bottom {
  position: absolute;
  z-index: 1000;
  pointer-events: none;
}
.l7-top {
  top: 0;
}
.l7-right {
  right: 0;
}
.l7-bottom {
  bottom: 0;
}
.l7-left {
  left: 0;
}
.l7-center {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-bottom.l7-center,
.l7-top.l7-center {
  width: 100%;
}
.l7-right.l7-center,
.l7-left.l7-center {
  height: 100%;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}

.l7-top.l7-center,
.l7-left.l7-center {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}

.l7-bottom.l7-center,
.l7-right.l7-center {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}

.l7-center .l7-control {
  margin-right: 10px;
  margin-bottom: 10px;
}

.l7-control {
  float: left;
  clear: both;
}
.l7-right .l7-control {
  float: right;
}
.l7-top .l7-control {
  margin-top: 10px;
}
.l7-bottom .l7-control {
  margin-bottom: 10px;
}
.l7-left .l7-control {
  margin-left: 10px;
}
.l7-right .l7-control {
  margin-right: 10px;
}

/* attribution and scale controls */

.l7-control-container .l7-control-attribution {
  background: #fff;
  background: rgba(255, 255, 255, 0.7);
  margin: 0;
}
.l7-control-attribution,
.l7-control-scale-line {
  padding: 0 5px;
  color: #333;
}
.l7-control-attribution a {
  text-decoration: none;
}
.l7-control-attribution a:hover {
  text-decoration: underline;
}
.l7-container .l7-control-attribution,
.l7-container .l7-control-scale {
  font-size: 11px;
  padding: 5px 5px 2px 5px;
  background: rgba(255, 255, 255, 0.7);
}
.l7-left .l7-control-scale {
  margin-left: 5px;
}
.l7-bottom .l7-control-scale {
  margin-bottom: 5px;
}
.l7-control-scale-line {
  border: 2px solid #000;
  border-top: none;
  color: #000;
  line-height: 1.1;
  padding: 2px 5px 1px;
  font-size: 11px;
  white-space: nowrap;
  overflow: hidden;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;

  background: #fff;
}
.l7-control-scale-line:not(:first-child) {
  border-top: 2px solid #777;
  border-bottom: none;
  margin-top: -2px;
}
.l7-control-scale-line:not(:first-child):not(:last-child) {
  border-bottom: 2px solid #777;
}

.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  border: 2px solid rgba(0, 0, 0, 0.2);
  background-clip: padding-box;
}
/*logo */

.l7-ctrl-logo {
  background-size: 100% 100%;
  width: 89px;
  height: 16px;
  margin: 0 0 -3px -3px;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  background-repeat: no-repeat;
  cursor: pointer;
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAALIAAAAgCAYAAAHBIxK2AAAABGdBTUEAALGPC/xhBQAAIJZJREFUeAHtfAl8Tkf3/9z7PNmDRFbZSawhQcRSaqva1xCqpataqrT2UkuUUiqlaKtafe1VS1pUiypB0dIgIkpKRPZIELI/2/zO98akN48nltL3838//84nNzNzzpkzc+eee+bMOXMfxijNaMJ7LOrGO/HdYfZ8fb12gD2JJINJdR8WNHVQnRtSn7hilpz0u2DMKaEcFhZmhdzLNbiPyNVlwPxcm4Qh93Fr0gO4Ol5hfqiz6Q14G+QzGpYzQ9nXrUl7X/fgbrXdG3skX7m26+bNW2fQqJ5XmCs6RQKd6EQwB0zgtKgsvCidGF+N8wV/SBLqSKnXzx2WKIHw1xNxq2xtrKsBXqgrbePt1rivJFmloa5OoD129NcVQwa9Phxwaflw3ifvHCus1YIVjW7fwEF66dIhdYO/XV7Qk+9HY/5F7RA+w0G5TdRxq7gw10FBPWwA+3r9jpkYGcoJ5/7YiFxMiYCjLspsekOeCiJ1AhJJNER+8rfTX/j4BNcUMNCLMmhF+wC3cE9RZmMd/0IQjeTtGdwJjURD5EajsRQN1EwEHjAkUVce2LLhnKf8xGId3ZhkX4uxmj7MMKqJz0ZmMr3MJNZBmphV8WDBOCCgo+2QiE7DF3005wvU75e8vMLs4+P3HwwN7do5MzOu2NcjpPHRX/csCqjt2wvtxEAy8xJ3o+7j3jjkcurpn2xtrT0EPiS0oQPKSOfi/ygqL9H/qNbls8EXuer4+65xUa149QnBvGYFgapAN21EZ+pnuH3rrrnKdNA/zCRmjoqGzu36RoL21q38BLAAjRgo6iir63g1QAOcOoU27DAgwKtpPzVMKU+qBWIuve3Jx0zw4j/eQ0CASeNnjUi5mrYH72ZxUfFV0emJ479/BvrM9KxDAgZZEjziTp1d8+pL415sEdJloIAhF7QCZmnQoCkuLkkXNPfkozU8b4wVb30P4i4ADNQ41P08mtSBogHc27Vx70CPEHeUgRNwgUOuTqBR8wwODraGSIkrKipKxqVuI300mntri1jz9OOs0IHeHUdvms2t0iG+vn5nxmnan5QeUff6GGWttpidSjvGbCSZJdAAGTMwtjWSH2G5XrOp3oEv9wuWxqdeUPchZkW8OGqcedmcdujgUcMOH/zltmgL2YW2Fu22fbMz6q2xM+IEvmvHiCGyRq7AK3QLe959+T6v46co0uVBisLk0/9SqIIhcnQiVBPqULJ4dPVd2ypLg6Dx8wxuhAGDHrCOHTtqUfZ2b6KsYYIOuUiXL1/dKW4SMJRxkbbpG9nv5ecVutlt+PSoNvw7VPg8V4X5wqf4YQVp9g+NDQZDITr2cm/8lNIGlbvp+edGD/946eqJqOKmoBJRhjyjrclk0qlZAqeumw8YOEwE6ILdgh0raN9pcHeWx9n3mViPh9IKnlmBVBWI4bfoePDAEcOGPz9WWUDBzMe1cUdft5CnUfb2DvFR8rsz2avrkOdmT18wJisz5zDaqthVWjwAtzRgtBF9VbSdVofXIPWmB2CCouYqUBUFH59QbwwEqg0XykAi96/VuCEetRrm59msEfA+nqEtAUeqNEt324JGJEsDxpMi26gnaCpUxqJk6bahkGFp3akrZO8IBurcVGponpGW+VOdQP++uIAznzE1/cBBvRRZTc+OP0miUBJ78OiyxNxE6uX+KSP3vDIZuEE/z9BgWZZtHHj1oxZbkS6uJFNqIn+SWSy1AubjFtLd171xoHrQooyFQJRB7+0eHBrk2cxNtBW5mgYwoYNFXg5r7CvoFXWxajQ3mjiTc84wVkB2kTWt5NYk3lZ02SCvzphDDVrNZOY2p3mdA0wrhQoGSm5ig6SRyTsqwSxUaMKk+t4tXJIy4/IsoP82yNu7pYusKwk2WdslZmScvGHOyNs1tJ5GNrjVaeT2W2xsLCnuv5J6woQq/QtbXoLCMJqYtbWj208pKbGK4aamgWJR19XlCvpFEdxn6SDOl0byAjXB/cp8rlM/PteZ83k1T92PTuAw0Ly8GychmosWLB/v7xFSW+AeJQ/0auyLiYFEBgQ0dYKdDRsJfFOvpe0V76fgCVrgkNQTao63hAONr2vjFtAFltoTTFLzB415Al7RFdNipHRviWlLbzCHhZ05HxfEy9e7T/zX8FV+XLk+96e8Tl0xOJZfOpjdKp4kzboZXgGrouDj1rTunHnTQl1caoZ/unLNlKnTx32sNxobR0ZGakQTDCY8tEtEkG+LfihDg+NC2ccjpBXoyMTqVaLjTaFLduxe219XqH+67HYGKU5D0pbN30X5+vl0a9m6mZOPTxvFUIayPRAbM1RpS1uztp0a/SD6e9hcYlKVqgi7QEg/DAyRsAUsKSlNLyvT56Bs8e2Ias4LZzfnfEowJyOOVocZDs9jt8YnMDvUZzblZ+jis1rwtqg/KMHgwEThCUOCUS64U/An6iiL9oIGcFjwqMOQQB0JdTyEXd/tfR/1rMzsWCrPBxwPCxJMfJMELVYq0KO+fNkXk6CHRV/qXPSLXA0XZejpqiRZ0IgcY7hzu+AS2TB3quInaNnU2vzSlNqcT/fhHSqAVJgawAunEXxCPU4W9MMlcRN0ryZMAl2XcOHm6YlnYgMAToIOuxks+YBBErGrAa0YtKDDDkeYAaBFErjSUl2uKOfm5v1GE9y1nOLe/4IO+b3YchfKw0wy3lZ6m2arxyr4KV4RURH54qtS/fGufEMZZ7Hja/Ko0ptsgYML0+kKGM+4wbTbmGQUtPfLMfBrWWc3gIZenX4aJmUp9OQdqunk4nv2QmzMus0rO730wtj0qu2DqnuQjCYbrOjYrINq5JuRe/CKQp3QtRMweivm0yur+FBQf9xk6WFQX99Tvw2GDO0390jssWXW1vKf6n4q7Dc1EOXledJwQxF7RV/EomQbptMXssJlNyT5YSe4dq1m/s907eik1WprNKjdur9sW/1AWt7535Ur6/zvN2/lpcds/37eM892mEgTXGHuHD1y4qLRYK0YvrJsMly5knKu0tg0csmObbvfC2/ZbETK9bOnW4TU7xtGEw0a2geZbKysz/Xu9txQvV6fX6VOrMTw/hVsdF8b/tbGgX1feqF1m7Bq5hda+/o+pVgXm9Ztmzk0ctTBlMyEi/fnaoZ9g3HH1xmv5GgwI/m3+oAZUOzkj4fx7rQBt7qdxnhJDiuj/YlBe9dG1pLNbF9D8c2dem2xVMA3NQhjBk6WMyVaelmZVaL0+vmcB/Tz/zVa+8lIPlWW2SLMQh559ZSNCE2sbCq/FBuLyrrbLJVHsYZMr/sdfpiKJOv1pOxtyISp0tQRtHXqhNWQZffSy5d/LBOwJ5H71mrcAnzSSA2Z84ObJPlCbiujSZubkRefZI5X61hL5pavbzMvY4kuTCuzm6nXE4+Ztwf/lBRmcW1zcSkwxsXF6bWmEnbQSPJsoqWMZumwUqYC7QCVi3Y6tMmnCZdYDItiJezj0v3MaLJmRmXX58w0zKJ3w3ww2IwE+fk7JSUll9b2Crl4NfPcJXOav1OH7fyfdSs6cS7zl18Y65GRd36Pmk/S+dwex0/tHTN54pxNJ0/I2tTsM5WccqDFQgn9rW4nyphg4J95ut9gZis7p6Ym3BI4L9eQ+sS/ntrbLXDIE8/fLKaHVP7goyN5whKyKKMHcsWboSasqsznORfSRYEaz3v29uZt4JiDxMC8QVJLjzntg+ow+dBe7BhRJ1MwQ/AVkRbwQbBj7OtTXgVu49qt79LDrW/OX4yrqjEJ/OIPVrwlfM2CB/rW6XQ3wd9SgjsM41SsC9pLt+H0AptK2fdRjFdYHHwdhY0QOsL1VZDimkIHfLLD8xThcmCF+p3SjOxc0WlV+Zervm2x68dN/QQ+MLC2DVSHqOOVw6ZFXDRgCXjUBQ1y7Py+3bO+HyQLO0bArGV2auRrkxRv1orPPgjXF6XVARxJz0vCPvz4vbkoT50899yTenvAD0ljLx0L8Gr2Et4C9XXnTkEiecNKv/xiU/q1nHNXlQmN2iYVlpWwL0qLmSR3ZNFgQCpCogXuLDMa45WrTH8AcCVpTL8Q7ChbVDhAgO6XmwwGj7AWoa9lZ+UcBt3ufZvn6Ar0bUSbP/+42cJQ7NhbNjj3ybpW2p0G3LtP966DUIYk0TbZDr4Kk9Ho7lXLw1+0g6qo6Wtz8+f9sfmARQzqPZNWiCCBJ/NLtrOz9SkoKPxDlmT1SiJIHiuH6oAeF5e1o9XRGjWqa6pXrxbcqlm3YY7Wtifu6WDeU1xHF59an1cDki9wm8nnU7h3AV0fergDNrsln0+BtKUoP0yizYJr/57DhuJ1wnY5/mziepTVr6e3R0hrsbPLyck7BrxIZO/eAi2uuwE4I3Aok5rIAtzPPbjtxQuXtgCOOtQTwkqrPvlqMmBd2vcfDGeSpfGCXrS7H96SujCnBy+oj6LComSoEoGvUA0A6EvZ8DLaO9nYsUOoSzNy57Oi4mJyBu2SpuRcj2rGvZievUsRgleBf5gk6cpabd62egFoaYtr6NFl8DaUoz96LzTAq0kDlNWppLhE2UTg9Tuf8MdG2sw4DRjQU9H7e3b/FE2vomLoU3nJjm92rYSEwoXZuX3EJvDZsWtdz/+sjGlqMJqCXx/90jzALlz4syQl5awi7aj/EwnxPfC1srJy7ti232Sb6jZHRT+VJvm909I3pjKWayxjYdODeLkO1hnC2OLC/mhQWsJO6UvInCtjHQWDB+XKK2tvF3Dq5JkvVR4t/tzwiHk6namuefunwruvEq9ft86RW4Ef9sqQcK2WXRkzYtKBgtsFGYCNHjHpt3enzd+cnpvwo8pHbKQd2Wg9M3qDhjz9tqd+O7tao2XZqP+TKf8Ga3vyzP630EdGRpY+OTnutuiv0iQDqDOxVgaaSDLpjqMuResukoXHpwTw7jT5XnQlfHBBOgPcgxIiEqu+jG4NuoYN63a4mHzio0vJvy7Blhcwa2srWW0NAFZVgh0uaTSKj0LQYFERZVmy+WP1Z2uno25vZyd/tX5FO5T79x72faoF+xm4J5m4geLOPl7PHPvl1CeyLF1T875nkpdckq7qdOwIqY4aEz35i+XEXCYJ30MXs7dnSghSzaSqMunN2n36dZsBfG7uzYt3r0vpaVm/AHbkxJ4xJYWpD80PbapK6bmnL8+dvURRJXsPbXu5W49OU6n/ItA/zEapKr4PA8fC7OVVS1EXgwe8sq9Nh4aJ6nYWdyrFmayLvQsrIwleF8n4Jk9ntlCvo00gZ6ujE6UHBujQAZw2ZY52Cv8fvj/wwahXJu6VGFdu2sh4rdTs+M6+fl7dSAI+kTS0yfkbCWEndbhJIzPdjRu3TgcGBijqbcHc6Km21iz+b7C22KTEaGxFi1slHDyLsrGgKHr5kvYCsW3btkpeynskGYSrmaQnvTufLubhyL6WDGwK0zH9ypvSKMHoQXmuoaztz0diJoHu9VfePp6el3BYeOGstVYJ0Ys/VSR81OjhPmQqKAvbg3hqZNOd9PTsZNAt/3Rhi+5dW/cmy6SzaGfv7HS817NDlUUWsFWfrU9LzkxMFfjHyadMe3MZ7HPzCwJjMnK/8JbNI6rib1GSQfxpoTT7TRs+mYzLSJJoWkTYsKqYWIIbTNzWuaZTA0iWOT4l+2zKxx99fpXCUKxXv+5hn6/akP7n5eRztbw9O5rToi7cnx5+0rWIvi/uSU4/M2BgZJ/ZAwb2KiO9HynaXLp0rIAkTZeff/tc7MFju2Qm0T7r8RPcnJa43MjL1+PtocUif8SrE2ZkpWWX0Tmbex4q5q/KNFLLO8mcHSTXRc7nRsmzSkILCOzWsJkAypLjBXE4U+mdtmSCGclC+AEbC8US0Wh+u5Jz7jraIWREYfRGuJG064n7AAvxCHHIMxorpLcac4q9lHesYjLRb06qrgtZMoVpuecqzCi0tZRg2wq4pXEiKCDwlnIRMMD9WFvrjGqrwhK9RRj5kp+bwLgS37NI8C/wgTOgSPLyV7ibxoa9Rp7kV8nrVo1E3qSjJSr/CuNlBUxHTswSZmLFkhWTtLSGUqSEjO7yXEN1DZW1FBuQrQllxzK5FVuTc5HtnnOIwlRf1X6Waa1GM24KoNGQT69SkpiGFtIyYwwrMK1jb1+9/U9bApV6/7fyxGYAwewzZ1IdiosNBvF2PzHmD8FIWfcoKPIV7ZZ7Q8rImmJGPWPpR0jqdMxEAs5IgEkWCUm6mf6YRITIOXIFUC6heCvIyguhPIR5s1PE9TYrMixlWkM9ZqRwC2jLkywKSm4tPc005KKeOxe+qb+oKhE9fAUOvLLi0ubYH6AVNpoaLU++lnWezs8/OLbw8D09GUp8HkB7wHCEEwVHjBkOxqvX7x906kgOzMvn89qZWLm7SbSXmXwnqLHLMdVmWKAq5eolSY2wtDyp8aIcFNSqekl+Uftjhy5IbduGV0tKulrCdMEGrcRupeYm/iLoLOXkMpJqe4fUN+hZHRM3keQ9Wip3IGiSEIupmLjooXwByeoUA2daCrSw4nx2Kucye86qhJUq7MUKSznt+SqSHcq0KAqY1okZxqySrlcQUIEvJ7e+RDocW2JdmR3T8K0UT2lOwk1viKQnh2oUuaIqrFt120ct4ySGwaALHDPuVb8ZM9+OxjlFOh95oGXzrsvpxk2e/jb7ERB6VL6PQw9hS79427lUqzOOGBGZj5i64IcPYUp1paHDXxzs+UH07NUCvnrVumlzZ334h0ajuZqWc+68gKtz+Bq//CSmq4kbrRL/PDbPyalGKPDJySm7n27V+wtJywozshMPqduYl4Ugw/oHDm455A8ryDjEhp3CkV+/HxEYGKC0/XDRyreXLVmVbKeyE8HTPOE0DNmONhS3Gu0f4NPTHP+gOj7JGRwx4icYzRU7kUlfSzMW9+PJJMTLS03MztqahXs1YuuK8tmAqFgp70FM74eXxpeHTvhkR3eKY2wic6K5YmRoWBE51UdI825tuV/7h8Uh1qQzFAf26vusy8zZE1eKdt6+Xl1ooovbt+795fVUXRuC03rzzyecisZBYwoCsvETRgbcupFfunrl1mwSHtIW7EpqduKF5My4VBIG9w3rt7L+g3qtggsRI3t91IvzNq7d/sKVK1drk8bOtaSZ16zc3pw0sdV332/sLYSYzofd7tdj+H/Aw1O2/S0DhX8wlWvFv7eI0jpJqs1gs33brv09ej6TT7wqFKulIbt7utalw5RKxJwO4+yCEGMDFdjILbFCkNFw6k7py0XP8qu0Fm8nl4UTcW1nY81ORHXjPaL2SZcFcxq2xNbUXsSstB0oiCbA5TkWCCMvYQbda9KotCuVkCbTQGYyNCFb3ESh72wmayOlRbePV6L5m5UAOh+sK8wNh4tzxaeLF99lY6KjunGuri7h0BZf/GfZBfhQfDyaNEnPSUgw70o5bm8yuZrDUcdSTXftYL4EaiT5tobZJqXknsq+p52e+wB28vT+cfQyPYtyxOA+nw/oPXwPyiKl5ibE+Xs06UJb9x/OJB4OdXd3aUMmkPX2XWsnNAvu8EGZJDWhZfi62izyouPDRh2v9cabr/iGt2o6UvCa9c7CqfQFo0Gy0ZyJyyg/uiZw/0SuNocelX9qbvwv8F5+suxzv6VLPo211J6EvRZWnCXL5jUb+sKAoaDBh5SYKzyT1JxzRzAvlQQZRNN+kn6Oepq3JXn8gar+JKZBRPQbffnSJ+qEpAgdCTjnt/UbGCt7jkq+lbZwVmQqGPlcaVJWhRBHPcXd6ciG29xDbOecNtIGCm3VkKJLnqiy0JfcbIvxxx7fOc7Gxkpx6G3ZEDNn1rsLEy5cOb6GIkIuPXt3eef5FwaO3LxpByNteTM9Pb7yGO7az7+fPTBR+Km2bIyZPWPa/Pi1m1b0b0FONnt7Oz/0g0Su6oLLSVd+GP/G9G9154uLtZL2lsnGPo6XFjyDB0wx33JCC/8NBoavKQKBogB8noskH89jxs5dOw78MC7h5/VkUjiSQD+1fvPKDi8+/+ZhX0/lawzl5bv70jZ1dHTQTJ0xfr5gv+/HQ4vXr/smC/GC9Ixz6QL+T+aPo5ExrvT0E/BwX7I0RoR9TSajFebgmWc7TgINjk6OG/POKVnLctKzE06SECtNK2+67nKLOipdIEEOp7jI73QKg+lKWE3aDB56N5wPuUvCpInpCazEEM7yS86wQloh7tBVXFLEbpa8REL8fjkdl2Y158NItDOp/XnZimXM/ZW3lJY+WSH2dwttRt5o+6+3r+6C4A/6Tkq6EjNp4uz44pIS05wZi94V4164ZNYSN1cXKyz54hyowFnK+0X0GJGccXpneKuwQRcvJB3YvXPfAgSX6CPVeBK2avUb1huy79COLecuHp1Dx5fgU+wCId70zapnhNdZaGPwb9mq2SgBRx45uK87p1Xgjh3NjrV0FmHm92YtnirGggfYp09XV5PRFIBNIeDGohstke/9edtrCNmifC0l/YdXXxz3Cxy76dfPVz4DC4L/sYQvkhFh+HT1h62EEP+45+dFEGJ8xp6enXhSfUsWBRkEM45KubIDe5qE+DsE9XSlNM2lbMv0YP4OxaJIzsm+ePd6DivMb8vu6GKYviyJFRq7Se/d+hq4KMa104PZLBLgDXRiRkPhbU5h7s03PNgx4J9UCvBsGqDnBh/YoO07PDUefEtLyzK7tI9Yh80dQtTr1m7JPHL4+HLg6GxB9f2Hy0M1CNtg5wx4VUnWaO1bNn12YJBfizf69hr+5Zujpqx5PnLUp43rtZvVtFHHCBFAdHFxDlu28v1w8JEljf6FIaN/FseJ8DGe4I9wvYAj37Z113XZVnsaZxUyM8+nkYJJw5Gjn386/JFos3Tl+3NQ1nMpDB/aGbmpxkfL329Wu46fcqiD7je7U9u+n0M72jr5nhDt/ldzH7fgIJOJ+0+aNjaw34AeihI6ezph7YiX3zpGk3sjI/fsWfN7q1KQQUibvNIF51kECfMysmuNlFPUjy2sHchWvhzAyXNM9aWshDTsQOmD0vrShwWKkI704vZFddkXRDuXhJgsELKYS9n7CxKkF1b8KNFr8WQS3Gw6g74JztRNeefNDwXXyeNnzSIBI88gl40GpkRyhg4aeeD69RvKQ8aSHbNrfS+Exvy8yn9OQ7Q1z2kCd+D8BDZnGdcTTqTmJCTjRKgky3nQntezc0+JNl7etRT7WqM1XcOuX9ZoKnlvBB1yrdb6CmhwqU2cjNzEs/A2vPj82Nj0tMz9oLWzt/Pfd3DbYNjntJmr06x5Ywf6ZEIRbuBHvz5lWplOp7jrnvRxZPD/byZ8IE0u3IZ16wbaTpw8Zgn6pjBiQq9uQ2Po6/SyjJwEiy/qfQW5/AYkvviyNIEEcgIFqstweou07GgXA4sZ6cxrlNP89X9MDe7sILM9JK4v60CrYyUlejZy0Z/SrL+oHr8EB7w4q7hr78ZZcLMJritXL16jXr5FGZsoQdOqTfNRM2ZNrGvU81pVfXUGWnoZlN2seqOl8PgH/dFWtm4noF07te33KX0GmIv+GjdpOIzs4SCUN2xZ9Q5lyrPbuuW7uT/tPXjLykq6bMmzAfr/pVQs3WmG8W785rMRlCkr//w50eWrKWPx9zyHuzenvZs/MItOl1a85cGvajjbpJNYdYpd97C3YkfH2fGeK0qkdDCg3x4JoI3fXknH6hMNRnFLx9igZTnSwQd28IgExw9fpO9PTVbQVOR6CkFzslvP0pI/+36scLwRp+9A88a4Vxbt2bV3WHz8hUb0uzm3yn9i4H6tVbgHmCQqykcuptBX2/6uYXFk37d4+413pn62Jvo/YPLm+Nfmt+/QZouzs5PiL066dHnrhHEz4xB8QLDnkTv6hxuQtyWAPESKXV9VV5JReyM193QWBNTXlT4Y4boaeGF9fL26og3cbF9vjsmRtdqcq9nxVX6R9NCCDKYf50jfv+3EO5gYHYbjzItATZg1OzVG5t3IFrWmjeGPpL9cCQ8HXYpGw3rQB38XUX2SCd8ilOmMrouXzAmBpgJvsnUNg/u/shBlnMC2dD7Wzy24HTaAzVuFxtSrFxhBk6fd+u1X8+rXaT2Jlcmt6ZzVHQMYPKEk0SecYEVnd/WCpZNzjZoKjII28FrgvK9tDftjly//dkfQIL+WF5dF9nDyrl37WLeYZ+b3j+g5kzaX9s2aN3kV+OLC4iud2vXfiMMqdYJdfk2NBfT/jfTc0P49unXrVKXQiVEWFhUXvT12xgHaK+jpxf3doNH7IUjWf0DPZwXNvh8OHkFZMsiKshRw8/yRBBmNl+VLZ0fb8ZayzH4krdyEnpQnudbiKRxMAbry9Y5gJwnfOzpfUpZF804fp46dOwlxvY5dnnZ64aVIRbOC39ovN8/GAW9ZsrpoSYhBU82dnczPkbpiI5iUcrK1ra2Nl2M1x7oHf/lueOd2/TeYmEnxAID2iSSDdQbZVp6ff7J214IPZ3YnnnLdunUiyNSJuMvfSC/fi8eOnepAp6EOnss5Rydc/kp0EDORfuXOZeyoqSeDmzSIQVtg8Q3K4IGvzkSZW9vd87sdgP+3Ejw05n3hFxroMgffU6f7KBs4uM8fy5euTjFKRkf6ks4FRJ61PJojL7hTePH99z5Kwsuael3R2gBbTPcMwiKVBeBkxh0KtGw7mQ/dhbeUynihvrU2sKEr2JPb1Km7h238a+ylp4zc6IRNXsdObV3JTswqKCw0kUeCNmLxiWp68zLOBpTeLm5LGydt377dXJycnazhewUd/K/YLZPmk8aOf80/LSW96Ntvf8jFRGodXA5iyRf88Es5xQZda0GbkZZVtGP77ntocaKXlRW3wQOv5ugot+vUyqluUGB18CGT5hZ+jwuOfRx0FbzVOcLQaz7Z0Q6eCsDRHzayiodCI58URwXVbR6l/Lghavw6hYGZsDr/rYSNLSKQcfS7AwiOSGWF4eJewRAmRVAD59MPOjPytwUZncAN5yyzhVacDSFlbDJIbO1qkzQXuP9Gql+/bTXj7WLbUq1t4V3H+kN3q5zWOnq5Jn05Jdm6GvMTExPJnC9PCDgYC2/X1Mp6o38j1xv3m0Q1LT5wu985DghlzGcxdqUaKzvSRpLJXtaFhdUpND8mLsZhKQcPuhSTxRL+UWFCkM3bPexZC/N2/9b/nYF/Z+AxZuD/AA8zEhkTLyOGAAAAAElFTkSuQmCC');
}

/* layers control */

.l7-control-layers {
  -webkit-box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
          box-shadow: 0 1px 8px rgba(0, 0, 0, 0.4);
  background: #fff;
  border-radius: 2px;
}
.l7-control-layers-toggle {
  background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAkCAYAAAGf7Ah0AAAABGdBTUEAALGPC/xhBQAABzdJREFUWAnVV3lslEUUn/l2F0tpwdAih1HEqCReDcphNCo1EkgFkXa5PNpuC0Fo2e7Wgko8KiaKWrvbK5672xYFpNtiRRuNiY0aURA14BGviBcVlaKltVa6+42/N9v5Mrtt05rwj/PHzjt+8743b+a9N8vYwKgMNlUQyemnMtAkaJajvb3dToQSGp8e6boopkr4VYgEMYwO0vhCTfMVzBcMf8bx086YyODcuM80zTqp9IWat+7evW8sMdIxIqqCLa6oiAaJpuEtcBqcc2HEWMZ0JclgZR/Nchf++ubrzKjJSguXS4tVjXvPjfb3/UAAacGTn/MOMb7QnjNpNqP/bKZ50Ai0tqYmCi0n4zbM+W+lBc7JBOa+QPhDwcTsxJXE2+32edKCL9h8hRDmRzpIOWydAylhrcMfDN+ugBRKSdP3KwPhsFJIPth02FISIYQwYsDYcVfWhy/Bon4JgumffMGmiGTwQ0B/sHml4q2ZFAD3WQIQVhx0IdFw8B189lolN+w8w5PnjPmlhJgtA8/vfn3iye7u3yGzDljDxZEG4097Cp3rSSjBtMHunp6vFR+HHoIxmbgTe1xHKssDHecLNFUjMzbqMs5ZlHF7ute17M84+TMHDzr+OvR9JwKdCms9yRkzJq6bPTsWXh05QOPUN+PUHyPWMPhm6UHd7vaUohWZPSRE8OqxpTyibQa/qcTlbEP0vwF7AWUAT3JM9dy69FfSNza+MU4awNE8iQtXSkJuGLleV852ov2h5jkwVof0mUs8aO4LhTuYYFOAjExId0wcFIPahpaLTkWiX9ECfHG/sLNi1i8+HODfgLFFRI96+INNi0cNTgTS1obKQh03aAuk9DeELzcj4pACYivvwvXrFK/PcQZiQWo+hmidpYMUjQC7EOB6xdNsGfAHwk/RDdOVw9Dm+NTUSWtWLDohDVQ37JkbiUT2DwMeVswZP+gtdM4x3HnLDhjcGM2XLWOISaenIGee9MCSgqgMht/H/q/SZYk0qviV3oKcj5XcioESyOoqIseFYDYloxnAGm/hcrcuk3JV2XBMl+pKqn6mENux11+w12m6jpqMMFn7rPPTHdwfCm8yTfG4tMaNu+GepPUFiqbM7T105ARSPQU+dY/LOC/N2gI65WEkyWUEtjmSppfkLvlRLaQ5VnZFDtGGzbheNRROKZmbu/AvUvh3tE4Wff2/0IUC+y2q+4VVoXBW1BSvkR7Rb8BW84lWJQBdlGozcs7GLy3Nd35OSqTxBqtfgkc1+sPjcqbDgEl6xK0dH5lv545LOCVL1/F+3CoY4eyY1+WcBiC2KYEHQBd5XDkyndE17xCm2Ug6BLcSwb3LigE1AlOYu6TS4HUwVEw0Df1osfBnLDwnpiFDCQPuvQ73Fkqxg8/hEVYLXt66MXbbzOK8bKre1hhkgDT0RDja3fEHytwZxCMLH0YWPkD0fxqjqUZDejDSV3z1LbexqPkEPJxKWLqtKOGbvPnZL460NlE/KgfkIZiRrfjShsQcG2QQDUwwXjcuZcID61Ys6ErUJ/LDOiCfLUzUjVQdEg0O4jn/ABEq0iuIjrEcwE0x/KGWNbjPj4BO00Gni0ZOoIPzLR5X9vMqqaQDqDzzENra4V5zp8sBZQcROYjsLvYUOPdbEVBKeiZ193QjCmwtZCM+ldS6EWYTH3wuNSV1i+pFCj/IAaWgGUfBq0N78qPM3DZcp9TxcTQeyzZm3ON2LatXpSlOP8BIB6qDLddHmHnFrBlpNZmZmdZbNXEB9XsRlZXFennqGHzoXW5DaId4iSoc/Q365EjnRjszPnYXZL9NDWUtGsqzCjAw7xprTypbn7fkaILcYqkInzzeX06C8emO8sKlS7stZQLxVMPes/+O9FVAvEpXob+utY6gZmfrtMjf/RUI+2odhF7wJbq+Gzf3zTj5CAwyaoEwozVoCzN1KKK00z7WUbZx9dIOklsO6CAZpu87i5gpHoJ8gtLh9vZixSO2KckV7qysf5Sc5uq2tjOix3rL0FW3IJuSNV0XM/iDs85LqxvqeKUD8n3LxUobt5WVuLJlS9IM4O9i09VRwWtxLWfpcix+hXjs8mZdjn19YuOiuKRgufzXqOuqQi2r8O+yAk/tl2Q/RMW7ETe8UdX1GJhHDM5qjDHJ5e7bs07qBp7ZsTe9t6/vUXykkLKEdLFbLgLJSUn3rrt1yXEdX/1C23jzVG+5Keg/B5r2wJD9g/NcaUAJq4MvXxxl/TWoATcoGc0Av4eUKnIXZlsvXpLHO0CS2KgOtGQgdeuwqWuUjGbUgrdszLHRXXDLF0oe54AS0kyPnc5Iz/2CmV7EeIzSwcjvsHQPXkUhld/kCP6Xu+DRNjg/SWHh+SnODF+aPeVh9XCydAPEsA4kAqsCzcuiTPiw7+maTj6SwGsVk/9gY9xbUpizR8MNS47aAd0C7s35CG8VdrxYyjl/FcdUgo73nY77X9D/Au9RDMh+aBoVAAAAAElFTkSuQmCC');
  width: 30px;
  height: 30px;
  background-size: 20px 20px;
}

.l7-touch .l7-control-layers-toggle {
  width: 44px;
  height: 44px;
}
.l7-control-layers .l7-control-layers-list,
.l7-control-layers-expanded .l7-control-layers-toggle {
  display: none;
}
.l7-control-layers-expanded .l7-control-layers-list {
  display: block;
  position: relative;
}
.l7-control-layers-expanded {
  padding: 6px 10px 6px 6px;
  color: #59626b;
  background: #fff;
}
.l7-control-layers-scrollbar {
  overflow-y: scroll;
  overflow-x: hidden;
  padding-right: 5px;
}
.l7-control-layers-selector {
  margin-top: 2px;
  position: relative;
  top: 1px;
}
.l7-control-layers label {
  display: block;
  padding: 8px;
}
.l7-control-layers label input[type='radio'],
.l7-control-layers label input[type='checkbox'] {
  width: 14px;
  height: 14px;
  margin: 0;
}
.l7-control-layers-separator {
  height: 0;
  border-top: 1px solid #d8d8d8;
  margin: 5px -10px 5px -6px;
}
.mapboxgl-ctrl-logo {
  display: none !important;
}
.amap-logo {
  display: none !important;
}
`);var cs=S(92137),ic=S(87757),Xs=S.n(ic),sa=S(86700),_c=S(88307),al=S.n(_c),Ga=S(28660),_l=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"attribute",void 0),(0,H.Z)(this,"buffer",void 0);var s=a.buffer,l=a.offset,p=a.stride,_=a.normalized,A=a.size,M=a.divisor;this.buffer=s,this.attribute={buffer:s.get(),offset:l||0,stride:p||0,normalized:_||!1,divisor:M||0},A&&(this.attribute.size=A)}return(0,vr.Z)(n,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(a){this.buffer.subData(a)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),n}(),Nu,yu,_u,au,xl,xu,Ys,Pu,Os,ou,wo,Ls,xs,Rs,xc=(Nu={},(0,H.Z)(Nu,U.gl.POINTS,"points"),(0,H.Z)(Nu,U.gl.LINES,"lines"),(0,H.Z)(Nu,U.gl.LINE_LOOP,"line loop"),(0,H.Z)(Nu,U.gl.LINE_STRIP,"line strip"),(0,H.Z)(Nu,U.gl.TRIANGLES,"triangles"),(0,H.Z)(Nu,U.gl.TRIANGLE_FAN,"triangle fan"),(0,H.Z)(Nu,U.gl.TRIANGLE_STRIP,"triangle strip"),Nu),ac=(yu={},(0,H.Z)(yu,U.gl.STATIC_DRAW,"static"),(0,H.Z)(yu,U.gl.DYNAMIC_DRAW,"dynamic"),(0,H.Z)(yu,U.gl.STREAM_DRAW,"stream"),yu),oc=(_u={},(0,H.Z)(_u,U.gl.BYTE,"int8"),(0,H.Z)(_u,U.gl.UNSIGNED_INT,"int16"),(0,H.Z)(_u,U.gl.INT,"int32"),(0,H.Z)(_u,U.gl.UNSIGNED_BYTE,"uint8"),(0,H.Z)(_u,U.gl.UNSIGNED_SHORT,"uint16"),(0,H.Z)(_u,U.gl.UNSIGNED_INT,"uint32"),(0,H.Z)(_u,U.gl.FLOAT,"float"),_u),ol=(au={},(0,H.Z)(au,U.gl.ALPHA,"alpha"),(0,H.Z)(au,U.gl.LUMINANCE,"luminance"),(0,H.Z)(au,U.gl.LUMINANCE_ALPHA,"luminance alpha"),(0,H.Z)(au,U.gl.RGB,"rgb"),(0,H.Z)(au,U.gl.RGBA,"rgba"),(0,H.Z)(au,U.gl.RGBA4,"rgba4"),(0,H.Z)(au,U.gl.RGB5_A1,"rgb5 a1"),(0,H.Z)(au,U.gl.RGB565,"rgb565"),(0,H.Z)(au,U.gl.DEPTH_COMPONENT,"depth"),(0,H.Z)(au,U.gl.DEPTH_STENCIL,"depth stencil"),au),Dl=(xl={},(0,H.Z)(xl,U.gl.DONT_CARE,"dont care"),(0,H.Z)(xl,U.gl.NICEST,"nice"),(0,H.Z)(xl,U.gl.FASTEST,"fast"),xl),kl=(xu={},(0,H.Z)(xu,U.gl.NEAREST,"nearest"),(0,H.Z)(xu,U.gl.LINEAR,"linear"),(0,H.Z)(xu,U.gl.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,H.Z)(xu,U.gl.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,H.Z)(xu,U.gl.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,H.Z)(xu,U.gl.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),xu),sc=(Ys={},(0,H.Z)(Ys,U.gl.REPEAT,"repeat"),(0,H.Z)(Ys,U.gl.CLAMP_TO_EDGE,"clamp"),(0,H.Z)(Ys,U.gl.MIRRORED_REPEAT,"mirror"),Ys),uc=(Pu={},(0,H.Z)(Pu,U.gl.NONE,"none"),(0,H.Z)(Pu,U.gl.BROWSER_DEFAULT_WEBGL,"browser"),Pu),Qc=(Os={},(0,H.Z)(Os,U.gl.NEVER,"never"),(0,H.Z)(Os,U.gl.ALWAYS,"always"),(0,H.Z)(Os,U.gl.LESS,"less"),(0,H.Z)(Os,U.gl.LEQUAL,"lequal"),(0,H.Z)(Os,U.gl.GREATER,"greater"),(0,H.Z)(Os,U.gl.GEQUAL,"gequal"),(0,H.Z)(Os,U.gl.EQUAL,"equal"),(0,H.Z)(Os,U.gl.NOTEQUAL,"notequal"),Os),Fl=(ou={},(0,H.Z)(ou,U.gl.FUNC_ADD,"add"),(0,H.Z)(ou,U.gl.MIN_EXT,"min"),(0,H.Z)(ou,U.gl.MAX_EXT,"max"),(0,H.Z)(ou,U.gl.FUNC_SUBTRACT,"subtract"),(0,H.Z)(ou,U.gl.FUNC_REVERSE_SUBTRACT,"reverse subtract"),ou),Ks=(wo={},(0,H.Z)(wo,U.gl.ZERO,"zero"),(0,H.Z)(wo,U.gl.ONE,"one"),(0,H.Z)(wo,U.gl.SRC_COLOR,"src color"),(0,H.Z)(wo,U.gl.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,H.Z)(wo,U.gl.SRC_ALPHA,"src alpha"),(0,H.Z)(wo,U.gl.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,H.Z)(wo,U.gl.DST_COLOR,"dst color"),(0,H.Z)(wo,U.gl.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,H.Z)(wo,U.gl.DST_ALPHA,"dst alpha"),(0,H.Z)(wo,U.gl.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,H.Z)(wo,U.gl.CONSTANT_COLOR,"constant color"),(0,H.Z)(wo,U.gl.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,H.Z)(wo,U.gl.CONSTANT_ALPHA,"constant alpha"),(0,H.Z)(wo,U.gl.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,H.Z)(wo,U.gl.SRC_ALPHA_SATURATE,"src alpha saturate"),wo),sl=(Ls={},(0,H.Z)(Ls,U.gl.NEVER,"never"),(0,H.Z)(Ls,U.gl.ALWAYS,"always"),(0,H.Z)(Ls,U.gl.LESS,"less"),(0,H.Z)(Ls,U.gl.LEQUAL,"lequal"),(0,H.Z)(Ls,U.gl.GREATER,"greater"),(0,H.Z)(Ls,U.gl.GEQUAL,"gequal"),(0,H.Z)(Ls,U.gl.EQUAL,"equal"),(0,H.Z)(Ls,U.gl.NOTEQUAL,"notequal"),Ls),zu=(xs={},(0,H.Z)(xs,U.gl.ZERO,"zero"),(0,H.Z)(xs,U.gl.KEEP,"keep"),(0,H.Z)(xs,U.gl.REPLACE,"replace"),(0,H.Z)(xs,U.gl.INVERT,"invert"),(0,H.Z)(xs,U.gl.INCR,"increment"),(0,H.Z)(xs,U.gl.DECR,"decrement"),(0,H.Z)(xs,U.gl.INCR_WRAP,"increment wrap"),(0,H.Z)(xs,U.gl.DECR_WRAP,"decrement wrap"),xs),Ku=(Rs={},(0,H.Z)(Rs,U.gl.FRONT,"front"),(0,H.Z)(Rs,U.gl.BACK,"back"),Rs),bc=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"buffer",void 0);var s=a.data,l=a.usage,p=a.type;this.buffer=c.buffer({data:s,usage:ac[l||U.gl.STATIC_DRAW],type:oc[p||U.gl.UNSIGNED_BYTE]})}return(0,vr.Z)(n,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(a){var s=a.data,l=a.offset;this.buffer.subdata(s,l)}}]),n}(),lc=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"elements",void 0);var s=a.data,l=a.usage,p=a.type,_=a.count;this.elements=c.elements({data:s,usage:ac[l||U.gl.STATIC_DRAW],type:oc[p||U.gl.UNSIGNED_BYTE],count:_})}return(0,vr.Z)(n,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(a){var s=a.data;this.elements.subdata(s)}},{key:"destroy",value:function(){}}]),n}(),Sc=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"framebuffer",void 0);var s=a.width,l=a.height,p=a.color,_=a.colors,A=a.depth,M=a.stencil,L={width:s,height:l};Array.isArray(_)&&(L.colors=_.map(function(Y){return Y.get()})),p&&typeof p!="boolean"&&(L.color=p.get()),this.framebuffer=c.framebuffer(L)}return(0,vr.Z)(n,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.framebuffer.resize(s,l)}}]),n}(),Zu=S(90484),kc=S(36719),ul=S.n(kc),lo=S(68630),Bl=S.n(lo);function ll(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ds(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ll(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ll(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var ua=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"reGl",void 0),(0,H.Z)(this,"destroyed",!1),(0,H.Z)(this,"drawCommand",void 0),(0,H.Z)(this,"drawParams",void 0),(0,H.Z)(this,"options",void 0),(0,H.Z)(this,"uniforms",{}),this.reGl=c;var s=a.vs,l=a.fs,p=a.attributes,_=a.uniforms,A=a.primitive,M=a.count,L=a.elements,Y=a.depth,G=a.blend,ve=a.stencil,Fe=a.cull,ht=a.instances,It={};this.options=a,_&&(this.uniforms=this.extractUniforms(_),Object.keys(_).forEach(function(Vr){It[Vr]=c.prop(Vr)}));var pr={};Object.keys(p).forEach(function(Vr){pr[Vr]=p[Vr].get()});var Cr={attributes:pr,frag:l,uniforms:It,vert:s,primitive:xc[A===void 0?U.gl.TRIANGLES:A]};ht&&(Cr.instances=ht),M&&(Cr.count=M),L&&(Cr.elements=L.get()),this.initDepthDrawParams({depth:Y},Cr),this.initBlendDrawParams({blend:G},Cr),this.initStencilDrawParams({stencil:ve},Cr),this.initCullDrawParams({cull:Fe},Cr),this.drawCommand=c(Cr),this.drawParams=Cr}return(0,vr.Z)(n,[{key:"addUniforms",value:function(a){this.uniforms=Ds(Ds({},this.uniforms),this.extractUniforms(a))}},{key:"draw",value:function(a){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var s=Ds(Ds({},this.uniforms),this.extractUniforms(a.uniforms||{})),l={};Object.keys(s).forEach(function(p){var _=(0,Zu.Z)(s[p]);_==="boolean"||_==="number"||Array.isArray(s[p])||s[p].BYTES_PER_ELEMENT?l[p]=s[p]:l[p]=s[p].get()}),this.drawCommand(l)}}},{key:"destroy",value:function(){this.drawParams.elements.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(a){a.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(a,s){var l=a.depth;l&&(s.depth={enable:l.enable===void 0?!0:!!l.enable,mask:l.mask===void 0?!0:!!l.mask,func:Qc[l.func||U.gl.LESS],range:l.range||[0,1]})}},{key:"initBlendDrawParams",value:function(a,s){var l=a.blend;if(l){var p=l.enable,_=l.func,A=l.equation,M=l.color,L=M===void 0?[0,0,0,0]:M;s.blend={enable:!!p,func:{srcRGB:Ks[_&&_.srcRGB||U.gl.SRC_ALPHA],srcAlpha:Ks[_&&_.srcAlpha||U.gl.SRC_ALPHA],dstRGB:Ks[_&&_.dstRGB||U.gl.ONE_MINUS_SRC_ALPHA],dstAlpha:Ks[_&&_.dstAlpha||U.gl.ONE_MINUS_SRC_ALPHA]},equation:{rgb:Fl[A&&A.rgb||U.gl.FUNC_ADD],alpha:Fl[A&&A.alpha||U.gl.FUNC_ADD]},color:L}}}},{key:"initStencilDrawParams",value:function(a,s){var l=a.stencil;if(l){var p=l.enable,_=l.mask,A=_===void 0?-1:_,M=l.func,L=M===void 0?{cmp:U.gl.ALWAYS,ref:0,mask:-1}:M,Y=l.opFront,G=Y===void 0?{fail:U.gl.KEEP,zfail:U.gl.KEEP,zpass:U.gl.KEEP}:Y,ve=l.opBack,Fe=ve===void 0?{fail:U.gl.KEEP,zfail:U.gl.KEEP,zpass:U.gl.KEEP}:ve;s.stencil={enable:!!p,mask:A,func:Ds(Ds({},L),{},{cmp:sl[L.cmp]}),opFront:{fail:zu[G.fail],zfail:zu[G.zfail],zpass:zu[G.zpass]},opBack:{fail:zu[Fe.fail],zfail:zu[Fe.zfail],zpass:zu[Fe.zpass]}}}}},{key:"initCullDrawParams",value:function(a,s){var l=a.cull;if(l){var p=l.enable,_=l.face,A=_===void 0?U.gl.BACK:_;s.cull={enable:!!p,face:Ku[A]}}}},{key:"extractUniforms",value:function(a){var s=this,l={};return Object.keys(a).forEach(function(p){s.extractUniformsRecursively(p,a[p],l,"")}),l}},{key:"extractUniformsRecursively",value:function(a,s,l,p){var _=this;if(s===null||typeof s=="number"||typeof s=="boolean"||Array.isArray(s)&&typeof s[0]=="number"||ul()(s)||s===""||"resize"in s){l["".concat(p&&p+".").concat(a)]=s;return}Bl()(s)&&Object.keys(s).forEach(function(A){_.extractUniformsRecursively(A,s[A],l,"".concat(p&&p+".").concat(a))}),Array.isArray(s)&&s.forEach(function(A,M){Object.keys(A).forEach(function(L){_.extractUniformsRecursively(L,A[L],l,"".concat(p&&p+".").concat(a,"[").concat(M,"]"))})})}}]),n}(),Ha=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"texture",void 0),(0,H.Z)(this,"width",void 0),(0,H.Z)(this,"height",void 0);var s=a.data,l=a.type,p=l===void 0?U.gl.UNSIGNED_BYTE:l,_=a.width,A=a.height,M=a.flipY,L=M===void 0?!1:M,Y=a.format,G=Y===void 0?U.gl.RGBA:Y,ve=a.mipmap,Fe=ve===void 0?!1:ve,ht=a.wrapS,It=ht===void 0?U.gl.CLAMP_TO_EDGE:ht,pr=a.wrapT,Cr=pr===void 0?U.gl.CLAMP_TO_EDGE:pr,Vr=a.aniso,pn=Vr===void 0?0:Vr,gn=a.alignment,Dn=gn===void 0?1:gn,Yn=a.premultiplyAlpha,Qn=Yn===void 0?!1:Yn,Si=a.mag,qi=Si===void 0?U.gl.NEAREST:Si,_a=a.min,gi=_a===void 0?U.gl.NEAREST:_a,Aa=a.colorSpace,Xa=Aa===void 0?U.gl.BROWSER_DEFAULT_WEBGL:Aa;this.width=_,this.height=A;var pu={width:_,height:A,type:oc[p],format:ol[G],wrapS:sc[It],wrapT:sc[Cr],mag:kl[qi],min:kl[gi],alignment:Dn,flipY:L,colorSpace:uc[Xa],premultiplyAlpha:Qn,aniso:pn};s&&(pu.data=s),typeof Fe=="number"?pu.mipmap=Dl[Fe]:typeof Fe=="boolean"&&(pu.mipmap=Fe),this.texture=c.texture(pu)}return(0,vr.Z)(n,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(a)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(a){var s=a.width,l=a.height;this.texture.resize(s,l),this.width=s,this.height=l}},{key:"destroy",value:function(){this.texture.destroy()}}]),n}(),fs,bl,$u=(fs=(0,sa.b2)(),fs(bl=function(){function n(){var c=this;(0,ft.Z)(this,n),(0,H.Z)(this,"extensionObject",void 0),(0,H.Z)(this,"gl",void 0),(0,H.Z)(this,"$container",void 0),(0,H.Z)(this,"canvas",void 0),(0,H.Z)(this,"width",void 0),(0,H.Z)(this,"height",void 0),(0,H.Z)(this,"isDirty",void 0),(0,H.Z)(this,"createModel",function(a){return new ua(c.gl,a)}),(0,H.Z)(this,"createAttribute",function(a){return new _l(c.gl,a)}),(0,H.Z)(this,"createBuffer",function(a){return new bc(c.gl,a)}),(0,H.Z)(this,"createElements",function(a){return new lc(c.gl,a)}),(0,H.Z)(this,"createTexture2D",function(a){return new Ha(c.gl,a)}),(0,H.Z)(this,"createFramebuffer",function(a){return new Sc(c.gl,a)}),(0,H.Z)(this,"useFramebuffer",function(a,s){c.gl({framebuffer:a?a.get():null})(s)}),(0,H.Z)(this,"clear",function(a){var s=a.color,l=a.depth,p=a.stencil,_=a.framebuffer,A=_===void 0?null:_,M={color:s,depth:l,stencil:p};M.framebuffer=A===null?A:A.get(),c.gl.clear(M)}),(0,H.Z)(this,"viewport",function(a){var s=a.x,l=a.y,p=a.width,_=a.height;c.gl._gl.viewport(s,l,p,_),c.width=p,c.height=_,c.gl._refresh()}),(0,H.Z)(this,"readPixels",function(a){var s=a.framebuffer,l=a.x,p=a.y,_=a.width,A=a.height,M={x:l,y:p,width:_,height:A};return s&&(M.framebuffer=s.get()),c.gl.read(M)}),(0,H.Z)(this,"getViewportSize",function(){return{width:c.gl._gl.drawingBufferWidth,height:c.gl._gl.drawingBufferHeight}}),(0,H.Z)(this,"getContainer",function(){var a;return(a=c.canvas)===null||a===void 0?void 0:a.parentElement}),(0,H.Z)(this,"getCanvas",function(){return c.canvas}),(0,H.Z)(this,"getGLContext",function(){return c.gl._gl}),(0,H.Z)(this,"destroy",function(){c.gl.destroy()})}return(0,vr.Z)(n,[{key:"init",value:function(){var c=(0,cs.Z)(Xs().mark(function s(l,p){var _=this;return Xs().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return this.canvas=l,M.next=3,new Promise(function(L,Y){al()({canvas:_.canvas,attributes:{alpha:!0,antialias:p.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:p.preserveDrawingBuffer},extensions:["OES_element_index_uint","OES_standard_derivatives","angle_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture"],profile:!0,onDone:function(ve,Fe){(ve||!Fe)&&Y(ve),L(Fe)}})});case 3:this.gl=M.sent,this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 5:case"end":return M.stop()}},s,this)}));function a(s,l){return c.apply(this,arguments)}return a}()},{key:"testExtension",value:function(a){return!!this.getGLContext().getExtension(a)}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var a=this.getGLContext();a.disable(a.CULL_FACE)}},{key:"setDirty",value:function(a){this.isDirty=a}},{key:"getDirty",value:function(){return this.isDirty}}]),n}())||bl);function Nl(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Fc(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Nl(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Nl(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var gf=function(){function n(c){(0,ft.Z)(this,n),(0,H.Z)(this,"sceneService",void 0),(0,H.Z)(this,"mapService",void 0),(0,H.Z)(this,"controlService",void 0),(0,H.Z)(this,"layerService",void 0),(0,H.Z)(this,"iconService",void 0),(0,H.Z)(this,"markerService",void 0),(0,H.Z)(this,"popupService",void 0),(0,H.Z)(this,"fontService",void 0),(0,H.Z)(this,"interactionService",void 0),(0,H.Z)(this,"container",void 0);var a=c.id,s=c.map,l=(0,U.Hp)();this.container=l,s.setContainer(l,a),l.bind(U.vK.IRendererService).to($u).inSingletonScope(),this.sceneService=l.get(U.vK.ISceneService),this.mapService=l.get(U.vK.IMapService),this.iconService=l.get(U.vK.IIconService),this.fontService=l.get(U.vK.IFontService),this.controlService=l.get(U.vK.IControlService),this.layerService=l.get(U.vK.ILayerService),this.markerService=l.get(U.vK.IMarkerService),this.interactionService=l.get(U.vK.IInteractionService),this.popupService=l.get(U.vK.IPopupService),this.initComponent(a),this.sceneService.init(c),this.initControl()}return(0,vr.Z)(n,[{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"exportPng",value:function(a){return this.sceneService.exportPng(a)}},{key:"exportMap",value:function(a){return this.sceneService.exportPng(a)}},{key:"registerRenderService",value:function(a){var s=this;if(this.sceneService.loaded){var l=new a(this);l.init()}else this.on("loaded",function(){var p=new a(s);p.init()})}},{key:"map",get:function(){return this.mapService.map}},{key:"setBgColor",value:function(a){this.mapService.setBgColor(a)}},{key:"addLayer",value:function(a){var s=(0,U.e7)(this.container);a.setContainer(s),this.sceneService.addLayer(a)}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(a){return this.layerService.getLayer(a)}},{key:"getLayerByName",value:function(a){return this.layerService.getLayerByName(a)}},{key:"removeLayer",value:function(a){this.layerService.remove(a)}},{key:"removeAllLayer",value:function(){this.layerService.removeAllLayers()}},{key:"render",value:function(){this.sceneService.render()}},{key:"addIconFont",value:function(a,s){this.fontService.addIconFont(a,s)}},{key:"addIconFonts",value:function(a){var s=this;a.forEach(function(l){var p=(0,ha.Z)(l,2),_=p[0],A=p[1];s.fontService.addIconFont(_,A)})}},{key:"addFontFace",value:function(a,s){this.sceneService.addFontFace(a,s)}},{key:"addImage",value:function(a,s){this.iconService.addImage(a,s)}},{key:"hasImage",value:function(a){return this.iconService.hasImage(a)}},{key:"removeImage",value:function(a){this.iconService.removeImage(a)}},{key:"addIconFontGlyphs",value:function(a,s){this.fontService.addIconGlyphs(s)}},{key:"addControl",value:function(a){this.controlService.addControl(a,this.container)}},{key:"removeControl",value:function(a){this.controlService.removeControl(a)}},{key:"getControlByName",value:function(a){return this.controlService.getControlByName(a)}},{key:"addMarker",value:function(a){this.markerService.addMarker(a)}},{key:"addMarkerLayer",value:function(a){this.markerService.addMarkerLayer(a)}},{key:"removeMarkerLayer",value:function(a){this.markerService.removeMarkerLayer(a)}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(a){this.popupService.addPopup(a)}},{key:"on",value:function(a,s){U.SceneEventList.indexOf(a)===-1?this.mapService.on(a,s):this.sceneService.on(a,s)}},{key:"once",value:function(a,s){U.SceneEventList.indexOf(a)===-1?this.mapService.once(a,s):this.sceneService.once(a,s)}},{key:"off",value:function(a,s){U.SceneEventList.indexOf(a)===-1?this.mapService.off(a,s):this.sceneService.off(a,s)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(a){return this.mapService.getCenter(a)}},{key:"setCenter",value:function(a,s){return this.mapService.setCenter(a,s)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(a){return this.mapService.setPitch(a)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(a){this.mapService.setRotation(a)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(a){this.mapService.panTo(a)}},{key:"panBy",value:function(a,s){this.mapService.panBy(a,s)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(a){this.mapService.setZoom(a)}},{key:"fitBounds",value:function(a,s){var l=this.sceneService.getSceneConfig(),p=l.fitBoundsOptions,_=l.animate;this.mapService.fitBounds(a,s||Fc(Fc({},p),{},{animate:_}))}},{key:"setZoomAndCenter",value:function(a,s){this.mapService.setZoomAndCenter(a,s)}},{key:"setMapStyle",value:function(a){this.mapService.setMapStyle(a)}},{key:"setMapStatus",value:function(a){this.mapService.setMapStatus(a)}},{key:"pixelToLngLat",value:function(a){return this.mapService.pixelToLngLat(a)}},{key:"lngLatToPixel",value:function(a){return this.mapService.lngLatToPixel(a)}},{key:"containerToLngLat",value:function(a){return this.mapService.containerToLngLat(a)}},{key:"lngLatToContainer",value:function(a){return this.mapService.lngLatToContainer(a)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(a,s){this.container.bind(U.vK.IPostProcessingPass).to(a).whenTargetNamed(s)}},{key:"initComponent",value:function(a){this.controlService.init({container:Ke.SO.getContainer(a)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var a=this.sceneService.getSceneConfig(),s=a.logoVisible,l=a.logoPosition;s&&this.addControl(new Oe({position:l}))}}]),n}(),Ju=S(81253),bo=S(55770),Qa=S(3473),Do=S(13218),bs=S.n(Do),Sl,To,Cn,no,Mu;function cl(n){return n.map(function(c){return typeof c=="string"&&(c=[c,{}]),c})}var su=(Sl=(0,sa.b2)(),To=(0,sa.f3)(U.vK.IGlobalConfigService),Sl(Cn=(no=function(){function n(){(0,ft.Z)(this,n),(0,bo.Z)(this,"configService",Mu,this),(0,H.Z)(this,"enabled",void 0)}return(0,vr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.rendererService,_=s.postProcessingPassFactory,A=s.normalPassFactory;a.hooks.init.tap("MultiPassRendererPlugin",function(){var M=a.getLayerConfig(),L=M.enableMultiPassRenderer,Y=M.passes,G=Y===void 0?[]:Y;l.enabled=!!L&&a.getLayerConfig().enableMultiPassRenderer!==!1,l.enabled&&(a.multiPassRenderer=l.createMultiPassRenderer(a,G,_,A),a.multiPassRenderer.setRenderFlag(!0))}),a.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){})}},{key:"createMultiPassRenderer",value:function(a,s,l,p){var _=a.multiPassRenderer,A=a.getLayerConfig(),M=A.enablePicking,L=A.enableTAA;return M&&_.add(p("pixelPicking")),_}}]),n}(),Mu=(0,Qa.Z)(no.prototype,"configService",[To],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),no))||Cn),ko,cc=(ko={},(0,H.Z)(ko,U.BlendType.additive,{enable:!0,func:{srcRGB:U.gl.ONE,dstRGB:U.gl.ONE,srcAlpha:1,dstAlpha:1}}),(0,H.Z)(ko,U.BlendType.none,{enable:!1}),(0,H.Z)(ko,U.BlendType.normal,{enable:!0,func:{srcRGB:U.gl.SRC_ALPHA,dstRGB:U.gl.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,H.Z)(ko,U.BlendType.subtractive,{enable:!0,func:{srcRGB:U.gl.ONE,dstRGB:U.gl.ONE,srcAlpha:U.gl.ZERO,dstAlpha:U.gl.ONE_MINUS_SRC_COLOR},equation:{rgb:U.gl.FUNC_SUBTRACT,alpha:U.gl.FUNC_SUBTRACT}}),(0,H.Z)(ko,U.BlendType.max,{enable:!0,func:{srcRGB:U.gl.ONE,dstRGB:U.gl.ONE},equation:{rgb:U.gl.MAX_EXT}}),(0,H.Z)(ko,U.BlendType.min,{enable:!0,func:{srcRGB:U.gl.ONE,dstRGB:U.gl.ONE},equation:{rgb:U.gl.MIN_EXT}}),ko),xn=S(81763),Wa=S.n(xn),Ec=S(1469),js=S.n(Ec),qa=1024;function Ya(n,c,a,s,l){c.updateStyleAttribute(n,a,s,l)}function zl(n,c){n.opacity&&bu("opacity",c,n.opacity),n.strokeWidth&&bu("strokeWidth",c,n.strokeWidth),n.strokeOpacity&&bu("strokeOpacity",c,n.strokeOpacity),n.stroke&&Uu("stroke",c,n.stroke),n.offsets&&ks("offsets",c,n.offsets),n.textOffset&&ks("textOffset",c,n.textOffset)}function bu(n,c,a){Fi()(a)?Ya(n,c,a,function(s){return s}):Wa()(a)?Ya(n,c,[a],void 0):js()(a)&&a.length===2?Fi()(a[0])&&yi()(a[1])||Fi()(a[0])&&js()(a[1])&&Wa()(a[1][0])&&Wa()(a[1][1])?Ya(n,c,a[0],a[1]):Ya(n,c,[1],void 0):Ya(n,c,[1],void 0)}function ks(n,c,a){Fi()(a)?Ya(n,c,a,function(s){return s}):js()(a)&&a.length===2&&Fi()(a[0])&&yi()(a[1])?Ya(n,c,a[0],a[1]):js()(a)&&a.length===2&&Wa()(a[0])&&Wa()(a[1])?Ya(n,c,a,void 0):Ya(n,c,[0,0],void 0)}function Uu(n,c,a){Fi()(a)?Ya(n,c,a,void 0):js()(a)&&a.length===2&&(Fi()(a[0])&&yi()(a[1])||Fi()(a[0])&&js()(a[1])&&a[1].length>0)?Ya(n,c,a[0],a[1]):Ya(n,c,"#fff",void 0)}var Bc,Zl,El,fc,Vs;function Fs(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=ea(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return p=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function ea(n,c){if(!!n){if(typeof n=="string")return Iu(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Iu(n,c)}}function Iu(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function $s(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ra(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?$s(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):$s(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Cl(n){var c=Su();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Su(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var uu=0,eo=(Bc=(0,U.yT)(U.vK.IGlobalConfigService),Zl=(0,U.yT)(U.vK.IShaderModuleService),El=function(n){(0,Dr.Z)(a,n);var c=Cl(a);function a(){var s,l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,ft.Z)(this,a),s=c.call(this),(0,H.Z)((0,et.Z)(s),"id","".concat(uu++)),(0,H.Z)((0,et.Z)(s),"name","".concat(uu)),(0,H.Z)((0,et.Z)(s),"type",void 0),(0,H.Z)((0,et.Z)(s),"visible",!0),(0,H.Z)((0,et.Z)(s),"zIndex",0),(0,H.Z)((0,et.Z)(s),"minZoom",void 0),(0,H.Z)((0,et.Z)(s),"maxZoom",void 0),(0,H.Z)((0,et.Z)(s),"inited",!1),(0,H.Z)((0,et.Z)(s),"layerModelNeedUpdate",!1),(0,H.Z)((0,et.Z)(s),"pickedFeatureID",null),(0,H.Z)((0,et.Z)(s),"selectedFeatureID",null),(0,H.Z)((0,et.Z)(s),"styleNeedUpdate",!1),(0,H.Z)((0,et.Z)(s),"rendering",void 0),(0,H.Z)((0,et.Z)(s),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,H.Z)((0,et.Z)(s),"hooks",{init:new _i.oI,afterInit:new _i.oI,beforeRender:new _i.oI,beforeRenderData:new _i.gg,afterRender:new _i.ni,beforePickingEncode:new _i.ni,afterPickingEncode:new _i.ni,beforeHighlight:new _i.ni(["pickedColor"]),afterHighlight:new _i.ni,beforeSelect:new _i.ni(["pickedColor"]),afterSelect:new _i.ni,beforeDestroy:new _i.ni,afterDestroy:new _i.ni}),(0,H.Z)((0,et.Z)(s),"models",[]),(0,H.Z)((0,et.Z)(s),"multiPassRenderer",void 0),(0,H.Z)((0,et.Z)(s),"plugins",void 0),(0,H.Z)((0,et.Z)(s),"sourceOption",void 0),(0,H.Z)((0,et.Z)(s),"layerModel",void 0),(0,bo.Z)((0,et.Z)(s),"configService",fc,(0,et.Z)(s)),(0,bo.Z)((0,et.Z)(s),"shaderModuleService",Vs,(0,et.Z)(s)),(0,H.Z)((0,et.Z)(s),"cameraService",void 0),(0,H.Z)((0,et.Z)(s),"coordinateService",void 0),(0,H.Z)((0,et.Z)(s),"iconService",void 0),(0,H.Z)((0,et.Z)(s),"fontService",void 0),(0,H.Z)((0,et.Z)(s),"pickingService",void 0),(0,H.Z)((0,et.Z)(s),"rendererService",void 0),(0,H.Z)((0,et.Z)(s),"layerService",void 0),(0,H.Z)((0,et.Z)(s),"interactionService",void 0),(0,H.Z)((0,et.Z)(s),"mapService",void 0),(0,H.Z)((0,et.Z)(s),"styleAttributeService",void 0),(0,H.Z)((0,et.Z)(s),"layerSource",void 0),(0,H.Z)((0,et.Z)(s),"postProcessingPassFactory",void 0),(0,H.Z)((0,et.Z)(s),"normalPassFactory",void 0),(0,H.Z)((0,et.Z)(s),"animateOptions",{enable:!1}),(0,H.Z)((0,et.Z)(s),"container",void 0),(0,H.Z)((0,et.Z)(s),"encodedData",void 0),(0,H.Z)((0,et.Z)(s),"configSchema",void 0),(0,H.Z)((0,et.Z)(s),"currentPickId",null),(0,H.Z)((0,et.Z)(s),"rawConfig",void 0),(0,H.Z)((0,et.Z)(s),"needUpdateConfig",void 0),(0,H.Z)((0,et.Z)(s),"pendingStyleAttributes",[]),(0,H.Z)((0,et.Z)(s),"scaleOptions",{}),(0,H.Z)((0,et.Z)(s),"animateStartTime",void 0),(0,H.Z)((0,et.Z)(s),"aniamateStatus",!1),(0,H.Z)((0,et.Z)(s),"sourceEvent",function(){s.dataState.dataSourceNeedUpdate=!0;var p=s.getLayerConfig(),_=p.autoFit,A=p.fitBoundsOptions;_&&s.fitBounds(A),s.emit("dataUpdate"),s.reRender()}),s.name=l.name||s.id,s.zIndex=l.zIndex||0,s.rawConfig=l,s}return(0,vr.Z)(a,[{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(l){if(!this.inited)this.needUpdateConfig=Ra(Ra({},this.needUpdateConfig),l);else{var p=this.container.get(U.vK.SceneID);zl(l,this),this.configService.setLayerConfig(p,this.id,Ra(Ra(Ra({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),l)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(l){this.container=l}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(l){return this.plugins.push(l),this}},{key:"init",value:function(){var l=this,p=this.container.get(U.vK.SceneID),_=this.rawConfig.enableMultiPassRenderer,A=_===void 0?!1:_;this.configService.setLayerConfig(p,this.id,{enableMultiPassRenderer:A}),this.iconService=this.container.get(U.vK.IIconService),this.fontService=this.container.get(U.vK.IFontService),this.rendererService=this.container.get(U.vK.IRendererService),this.layerService=this.container.get(U.vK.ILayerService),this.interactionService=this.container.get(U.vK.IInteractionService),this.pickingService=this.container.get(U.vK.IPickingService),this.mapService=this.container.get(U.vK.IMapService),this.cameraService=this.container.get(U.vK.ICameraService),this.coordinateService=this.container.get(U.vK.ICoordinateSystemService),this.postProcessingPassFactory=this.container.get(U.vK.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(U.vK.IFactoryNormalPass),this.styleAttributeService=this.container.get(U.vK.IStyleAttributeService),this.multiPassRenderer=this.container.get(U.vK.IMultiPassRenderer),this.multiPassRenderer.setLayer(this),this.pendingStyleAttributes.forEach(function(G){var ve=G.attributeName,Fe=G.attributeField,ht=G.attributeValues,It=G.updateOptions;l.styleAttributeService.updateStyleAttribute(ve,{scale:Ra({field:Fe},l.splitValuesAndCallbackInAttribute(ht,l.getLayerConfig()[ve]))},It)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(U.vK.ILayerPlugin);var M=Fs(this.plugins),L;try{for(M.s();!(L=M.n()).done;){var Y=L.value;Y.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}}catch(G){M.e(G)}finally{M.f()}return this.hooks.init.call(),this.hooks.afterInit.call(),this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this}},{key:"prepareBuildModel",value:function(){this.inited=!0,this.updateLayerConfig(Ra(Ra({},this.getDefaultConfig()),this.rawConfig));var l=this.getLayerConfig(),p=l.animateOption;p!=null&&p.enable&&(this.layerService.startAnimate(),this.aniamateStatus=!0)}},{key:"color",value:function(l,p,_){return this.updateStyleAttribute("color",l,p,_),this}},{key:"texture",value:function(l,p,_){return this.updateStyleAttribute("texture",l,p,_),this}},{key:"rotate",value:function(l,p,_){return this.updateStyleAttribute("rotate",l,p,_),this}},{key:"size",value:function(l,p,_){return this.updateStyleAttribute("size",l,p,_),this}},{key:"filter",value:function(l,p,_){return this.updateStyleAttribute("filter",l,p,_),this}},{key:"shape",value:function(l,p,_){return this.updateStyleAttribute("shape",l,p,_),this}},{key:"label",value:function(l,p,_){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:l,attributeValues:p,updateOptions:_}),this}},{key:"animate",value:function(l){var p={};return bs()(l)?(p.enable=!0,p=Ra(Ra({},p),l)):p.enable=l,this.updateLayerConfig({animateOption:p}),this}},{key:"source",value:function(l,p){return l!=null&&l.data?(this.setSource(l),this):(this.sourceOption={data:l,options:p},this)}},{key:"setData",value:function(l,p){var _=this;return this.inited?this.layerSource.setData(l,p):this.on("inited",function(){_.layerSource.setData(l,p)}),this}},{key:"style",value:function(l){var p=this,_=l.passes,A=(0,Ju.Z)(l,["passes"]);return _&&cl(_).forEach(function(M){var L=p.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(M[0]);L&&L.updateOptions(M[1])}),this.rawConfig=Ra(Ra({},this.rawConfig),A),this.container&&(this.updateLayerConfig(this.rawConfig),this.styleNeedUpdate=!0),this}},{key:"scale",value:function(l,p){return bs()(l)?this.scaleOptions=Ra(Ra({},this.scaleOptions),l):this.scaleOptions[l]=p,this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.renderLayers(),this.rendering=!1}},{key:"render",value:function(){return this.getEncodedData().length!==0&&this.renderModels(),this}},{key:"active",value:function(l){var p={};return p.enableHighlight=bs()(l)?!0:l,bs()(l)?(p.enableHighlight=!0,l.color&&(p.highlightColor=l.color)):p.enableHighlight=!!l,this.updateLayerConfig(p),this}},{key:"setActive",value:function(l,p){var _=this;if(bs()(l)){var A=l.x,M=A===void 0?0:A,L=l.y,Y=L===void 0?0:L;this.updateLayerConfig({highlightColor:bs()(p)?p.color:this.getLayerConfig().highlightColor}),this.pick({x:M,y:Y})}else this.updateLayerConfig({pickedFeatureID:l,highlightColor:bs()(p)?p.color:this.getLayerConfig().highlightColor}),this.hooks.beforeSelect.call((0,Ke.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"select",value:function(l){var p={};return p.enableSelect=bs()(l)?!0:l,bs()(l)?(p.enableSelect=!0,l.color&&(p.selectColor=l.color)):p.enableSelect=!!l,this.updateLayerConfig(p),this}},{key:"setSelect",value:function(l,p){var _=this;if(bs()(l)){var A=l.x,M=A===void 0?0:A,L=l.y,Y=L===void 0?0:L;this.updateLayerConfig({selectColor:bs()(p)?p.color:this.getLayerConfig().selectColor}),this.pick({x:M,y:Y})}else this.updateLayerConfig({pickedFeatureID:l,selectColor:bs()(p)?p.color:this.getLayerConfig().selectColor}),this.hooks.beforeSelect.call((0,Ke.Z6)(l)).then(function(){setTimeout(function(){_.reRender()},1)})}},{key:"setBlend",value:function(l){this.updateLayerConfig({blend:l}),this.layerModelNeedUpdate=!0,this.reRender()}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"setIndex",value:function(l){return this.zIndex=l,this.layerService.updateRenderOrder(),this}},{key:"setCurrentPickId",value:function(l){this.currentPickId=l}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(l){this.selectedFeatureID=l}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var l=this.mapService.getZoom(),p=this.getLayerConfig(),_=p.visible,A=p.minZoom,M=A===void 0?-Infinity:A,L=p.maxZoom,Y=L===void 0?Infinity:L;return!!_&&l>=M&&l<=Y}},{key:"setMinZoom",value:function(l){return this.updateLayerConfig({minZoom:l}),this}},{key:"getMinZoom",value:function(){var l=this.getLayerConfig(),p=l.minZoom;return p}},{key:"getMaxZoom",value:function(){var l=this.getLayerConfig(),p=l.maxZoom;return p}},{key:"get",value:function(l){var p=this.getLayerConfig();return p[l]}},{key:"setMaxZoom",value:function(l){return this.updateLayerConfig({maxZoom:l}),this}},{key:"fitBounds",value:function(l){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var p=this.getSource(),_=p.extent,A=_.some(function(M){return Math.abs(M)===Infinity});return A?this:(this.mapService.fitBounds([[_[0],_[1]],[_[2],_[3]]],l),this)}},{key:"destroy",value:function(){this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),this.multiPassRenderer.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),this.emit("remove",{target:this,type:"remove"}),this.removeAllListeners()}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){this.models.forEach(function(l){return l.destroy()}),this.layerModel.clearModels()}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(l){return l.needRescale||l.needRemapping||l.needRegenerateVertices}).length}},{key:"setSource",value:function(l){if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=l,this.inited&&this.layerSource.cluster){var p=this.mapService.getZoom();this.layerSource.updateClusterData(p)}this.layerSource.on("update",this.sourceEvent)}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(l){this.encodedData=l}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getLegendItems",value:function(l){var p=this.styleAttributeService.getLayerAttributeScale(l);if(p){if(p.ticks){var _=p.ticks().map(function(M){return(0,H.Z)({value:M},l,p(M))});return _}else if(p.invertExtent){var A=p.range().map(function(M){return(0,H.Z)({value:p.invertExtent(M)},l,M)});return A}}else return[]}},{key:"pick",value:function(l){var p=l.x,_=l.y;this.interactionService.triggerHover({x:p,y:_})}},{key:"boxSelect",value:function(l,p){this.pickingService.boxPickLayer(this,l,p)}},{key:"buildLayerModel",value:function(l){var p=l.moduleName,_=l.vertexShader,A=l.fragmentShader,M=l.triangulation,L=l.segmentNumber,Y=(0,Ju.Z)(l,["moduleName","vertexShader","fragmentShader","triangulation","segmentNumber"]);this.shaderModuleService.registerModule(p,{vs:_,fs:A});var G=this.shaderModuleService.getModule(p),ve=G.vs,Fe=G.fs,ht=G.uniforms,It=this.rendererService.createModel,pr=this.styleAttributeService.createAttributesAndIndices(this.encodedData,M,L),Cr=pr.attributes,Vr=pr.elements;return It(Ra({attributes:Cr,uniforms:ht,fs:Fe,vs:ve,elements:Vr,blend:cc[U.BlendType.normal]},Y))}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.aniamateStatus&&(this.layerService.stopAnimate(),this.aniamateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(l){var p=this.getLayerConfig(),_=p.enableHighlight,A=_===void 0?!0:_,M=p.enableSelect,L=M===void 0?!0:M,Y=this.eventNames().indexOf(l)!==-1||this.eventNames().indexOf("un"+l)!==-1;return(l==="click"||l==="dblclick")&&L&&(Y=!0),l==="mousemove"&&(A||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(Y=!0),this.isVisible()&&Y}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"rebuildModels",value:function(){throw new Error("Method not implemented.")}},{key:"renderModels",value:function(){var l=this;return this.getEncodedData().length>0&&(this.layerModelNeedUpdate&&this.layerModel&&(this.models=this.layerModel.buildModels(),this.hooks.beforeRender.call(),this.layerModelNeedUpdate=!1),this.models.forEach(function(p){p.draw({uniforms:l.layerModel.getUninforms()})})),this}},{key:"updateStyleAttribute",value:function(l,p,_,A){this.inited?this.styleAttributeService.updateStyleAttribute(l,{scale:Ra({field:p},this.splitValuesAndCallbackInAttribute(_,this.getLayerConfig()[p]))},A):this.pendingStyleAttributes.push({attributeName:l,attributeField:p,attributeValues:_,updateOptions:A})}},{key:"setEarthTime",value:function(l){console.warn("empty fn")}},{key:"getConfigSchema",value:function(){throw new Error("Method not implemented.")}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"reRender",value:function(){this.inited&&this.layerService.renderLayers()}},{key:"splitValuesAndCallbackInAttribute",value:function(l,p){return{values:yi()(l)?void 0:l||p,callback:yi()(l)?l:void 0}}}]),a}(Mi.EventEmitter),fc=(0,Qa.Z)(El.prototype,"configService",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Vs=(0,Qa.Z)(El.prototype,"shaderModuleService",[Zl],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),El),fl=S(18446),ii=S.n(fl),qn=S(2650),Ul,es,Bs,zo,lu;function Cc(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=hc(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return p=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function hc(n,c){if(!!n){if(typeof n=="string")return ta(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ta(n,c)}}function ta(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var ba=(Ul=(0,U.yT)(U.vK.IGlobalConfigService),es=(0,U.yT)(U.vK.IShaderModuleService),Bs=function(){function n(c){(0,ft.Z)(this,n),(0,H.Z)(this,"triangulation",void 0),(0,H.Z)(this,"createTexture2D",void 0),(0,H.Z)(this,"layer",void 0),(0,H.Z)(this,"dataTexture",void 0),(0,H.Z)(this,"DATA_TEXTURE_WIDTH",void 0),(0,H.Z)(this,"rowCount",void 0),(0,H.Z)(this,"cacheStyleProperties",void 0),(0,H.Z)(this,"cellLength",void 0),(0,H.Z)(this,"cellProperties",void 0),(0,H.Z)(this,"cellTypeLayout",void 0),(0,H.Z)(this,"stylePropertyesExist",void 0),(0,H.Z)(this,"dataTextureTest",void 0),(0,bo.Z)(this,"configService",zo,this),(0,bo.Z)(this,"shaderModuleService",lu,this),(0,H.Z)(this,"rendererService",void 0),(0,H.Z)(this,"iconService",void 0),(0,H.Z)(this,"fontService",void 0),(0,H.Z)(this,"styleAttributeService",void 0),(0,H.Z)(this,"mapService",void 0),(0,H.Z)(this,"cameraService",void 0),(0,H.Z)(this,"layerService",void 0),this.layer=c,this.rendererService=c.getContainer().get(U.vK.IRendererService),this.styleAttributeService=c.getContainer().get(U.vK.IStyleAttributeService),this.mapService=c.getContainer().get(U.vK.IMapService),this.iconService=c.getContainer().get(U.vK.IIconService),this.fontService=c.getContainer().get(U.vK.IFontService),this.cameraService=c.getContainer().get(U.vK.ICameraService),this.layerService=c.getContainer().get(U.vK.ILayerService),this.registerBuiltinAttributes(),this.startModelAnimate();var a=this.rendererService.createTexture2D;this.createTexture2D=a,this.DATA_TEXTURE_WIDTH=1024,this.rowCount=1,this.cellLength=0,this.cellProperties=[],this.cacheStyleProperties={opacity:void 0,strokeOpacity:void 0,strokeWidth:void 0,stroke:void 0,offsets:void 0},this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0},this.dataTextureTest=this.layerService.getOESTextureFloat(),this.dataTextureTest||(this.dataTexture=this.createTexture2D({data:new ImageData(1,1).data,mag:U.gl.NEAREST,min:U.gl.NEAREST,width:1,height:1}))}return(0,vr.Z)(n,[{key:"clearLastCalRes",value:function(){this.cellProperties=[],this.cellLength=0,this.stylePropertyesExist={hasOpacity:0,hasStrokeOpacity:0,hasStrokeWidth:0,hasStroke:0,hasOffsets:0}}},{key:"getCellTypeLayout",value:function(){return this.dataTextureTest?[this.rowCount,this.DATA_TEXTURE_WIDTH,0,0,this.stylePropertyesExist.hasOpacity,this.stylePropertyesExist.hasStrokeOpacity,this.stylePropertyesExist.hasStrokeWidth,this.stylePropertyesExist.hasStroke,this.stylePropertyesExist.hasOffsets,0,0,0,0,0,0,1]:[1,1,0,0,0,0,0,0,0,0,0,0,0,0,0,-1]}},{key:"dataTextureNeedUpdate",value:function(a){var s=!1;return ii()(a.opacity,this.cacheStyleProperties.opacity)||(s=!0,this.cacheStyleProperties.opacity=a.opacity),ii()(a.strokeOpacity,this.cacheStyleProperties.strokeOpacity)||(s=!0,this.cacheStyleProperties.strokeOpacity=a.strokeOpacity),ii()(a.strokeWidth,this.cacheStyleProperties.strokeWidth)||(s=!0,this.cacheStyleProperties.strokeWidth=a.strokeWidth),ii()(a.stroke,this.cacheStyleProperties.stroke)||(s=!0,this.cacheStyleProperties.stroke=a.stroke),ii()(a.offsets,this.cacheStyleProperties.offsets)||(s=!0,this.cacheStyleProperties.offsets=a.offsets),this.dataTexture===void 0&&(s=!0),s}},{key:"judgeStyleAttributes",value:function(a){this.clearLastCalRes(),a.opacity!==void 0&&!Wa()(a.opacity)&&(this.cellProperties.push({attr:"opacity",count:1}),this.stylePropertyesExist.hasOpacity=1,this.cellLength+=1),a.strokeOpacity!==void 0&&!Wa()(a.strokeOpacity)&&(this.cellProperties.push({attr:"strokeOpacity",count:1}),this.stylePropertyesExist.hasStrokeOpacity=1,this.cellLength+=1),a.strokeWidth!==void 0&&!Wa()(a.strokeWidth)&&(this.cellProperties.push({attr:"strokeWidth",count:1}),this.stylePropertyesExist.hasStrokeWidth=1,this.cellLength+=1),a.stroke!==void 0&&!this.isStaticColor(a.stroke)&&(this.cellProperties.push({attr:"stroke",count:4}),this.stylePropertyesExist.hasStroke=1,this.cellLength+=4),a.offsets!==void 0&&!this.isOffsetStatic(a.offsets)&&(this.cellProperties.push({attr:"offsets",count:2}),this.stylePropertyesExist.hasOffsets=1,this.cellLength+=2)}},{key:"isStaticColor",value:function(a){return Fi()(a)?!!(0,qn.ZP)(a):!1}},{key:"getStrokeColor",value:function(a){if(this.isStaticColor(a)){var s=(0,Ke.CI)(a);return s[0]=s[0]?s[0]:0,s[1]=s[1]?s[1]:0,s[2]=s[2]?s[2]:0,s[3]=s[3]?s[3]:0,s}else return[0,0,0,0]}},{key:"isOffsetStatic",value:function(a){return!!(js()(a)&&a.length===2&&Wa()(a[0])&&Wa()(a[1]))}},{key:"patchMod",value:function(a,s){for(var l=0;l<s;l++)a.push(-1)}},{key:"patchData",value:function(a,s,l){var p=Cc(l),_;try{for(p.s();!(_=p.n()).done;){var A=_.value,M=A.attr,L=A.count,Y=s[M];Y?M==="stroke"?a.push.apply(a,(0,E.Z)((0,Ke.CI)(Y))):M==="offsets"?this.isOffsetStatic(Y)?a.push(-Y[0],Y[1]):a.push(0,0):a.push(Wa()(Y)?Y:1):this.patchMod(a,L)}}catch(G){p.e(G)}finally{p.f()}}},{key:"calDataFrame",value:function(a,s,l){for(var p=s.length,_=Math.ceil(p*a/this.DATA_TEXTURE_WIDTH),A=_*this.DATA_TEXTURE_WIDTH,M=[],L=0;L<p;L++){var Y=s[L];this.patchData(M,Y,l)}for(var G=M.length;G<A;G++)M.push(-1);return{data:M,width:this.DATA_TEXTURE_WIDTH,height:_}}},{key:"getBlend",value:function(){var a=this.layer.getLayerConfig(),s=a.blend,l=s===void 0?"normal":s;return cc[U.BlendType[l]]}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){return!1}},{key:"buildModels",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){throw new Error("Method not implemented.")}},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(a){return[a.enable?0:1,a.duration||4,a.interval||.2,a.trailLength||.1]}},{key:"startModelAnimate",value:function(){var a=this.layer.getLayerConfig(),s=a.animateOption;s.enable&&this.layer.setAnimateStartTime()}}]),n}(),zo=(0,Qa.Z)(Bs.prototype,"configService",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lu=(0,Qa.Z)(Bs.prototype,"shaderModuleService",[es],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Bs),qc=S(9187),Po=S.n(qc),wl=100,Gs=36,Ss=40;function hl(n){return n/180*Math.acos(-1)}function Eu(n){var c=hl(n[0])+Math.PI/2,a=hl(n[1]),s=wl+Math.random()*.4,l=s*Math.cos(a)*Math.cos(c),p=s*Math.cos(a)*Math.sin(c),_=s*Math.sin(a);return[p,_,l]}function wc(n,c){var a=mat4.create(),s=mat4.create(),l=vec3.fromValues(0,1,0),p=vec3.fromValues(0,0,0);c=c||{},n=typeof n!="undefined"?n:1;for(var _=typeof c.segments!="undefined"?c.segments:32,A=2+_,M=2*A,L=[],Y=[],G=[],ve=[],Fe=[],ht=[],It=0;It<=A;It++){for(var pr=It/A,Cr=pr*Math.PI,Vr=0;Vr<=M;Vr++){var pn=Vr/M,gn=pn*Math.PI*2;mat4.identity(s),mat4.rotateZ(s,s,-Cr),mat4.identity(a),mat4.rotateY(a,a,gn),vec3.transformMat4(p,l,s),vec3.transformMat4(p,p,a),vec3.scale(p,p,-n),G.push(p.slice()),ve.push.apply(ve,_toConsumableArray(p.slice())),vec3.normalize(p,p),Fe.push.apply(Fe,_toConsumableArray(p.slice())),ht.push([pn,1-pr]),ve.push(pn,1-pr)}if(It>0)for(var Dn=G.length,Yn=Dn-2*(M+1);Yn+M+2<Dn;Yn++)L.push([Yn,Yn+1,Yn+M+1]),Y.push(Yn,Yn+1,Yn+M+1),L.push([Yn+M+1,Yn+1,Yn+M+2]),Y.push(Yn+M+1,Yn+1,Yn+M+2)}return{cells:L,positions:G,uvs:ht,positionsArr:ve,indicesArr:Y,normalArr:Fe}}var Ri=S(31437),Qu=Ri.create(),Nc=Ri.create(),Fo=Ri.create(),Cu=Ri.create(),jl=Ri.create();function qu(n,c,a,s,l){Ri.add(n,a,s),Ri.normalize(n,n),c=Ri.fromValues(-n[1],n[0]);var p=Ri.fromValues(-a[1],a[0]);return[l/Ri.dot(c,p),c]}function cu(n,c){return Ri.set(n,-c[1],c[0])}function Al(n,c,a){return Ri.sub(n,c,a),Ri.normalize(n,n),n}function Ou(n,c){return n[0]===c[0]&&n[1]===c[1]}function fu(n){for(var c=new Map,a=0;a<n.length;a++){var s=n[0].toString()+"-"+n[1].toString();c.get(s)?(n.splice(a,1),a++):c.set(s,s)}return n}var zc=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,ft.Z)(this,n),(0,H.Z)(this,"complex",void 0),(0,H.Z)(this,"join",void 0),(0,H.Z)(this,"cap",void 0),(0,H.Z)(this,"miterLimit",void 0),(0,H.Z)(this,"thickness",void 0),(0,H.Z)(this,"normal",void 0),(0,H.Z)(this,"lastFlip",-1),(0,H.Z)(this,"miter",Ri.fromValues(0,0)),(0,H.Z)(this,"started",!1),(0,H.Z)(this,"dash",!1),(0,H.Z)(this,"totalDistance",0),this.join=c.join||"miter",this.cap=c.cap||"butt",this.miterLimit=c.miterLimit||10,this.thickness=c.thickness||1,this.dash=c.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0}}return(0,vr.Z)(n,[{key:"extrude_gaode2",value:function(a,s){var l=this.complex;if(a.length<=1)return l;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var p=a.length,_=l.startIndex,A=1;A<p;A++){var M=a[A-1],L=s[A-1],Y=a[A],G=s[A],ve=A<a.length-1?a[A+1]:null,Fe=A<s.length-1?s[A+1]:null,ht=this.segment_gaode2(l,_,M,Y,ve,L,G,Fe);_+=ht}if(this.dash)for(var It=0;It<l.positions.length/6;It++)l.positions[It*6+5]=this.totalDistance;return l.startIndex=l.positions.length/6,l}},{key:"extrude",value:function(a){var s=this.complex;if(a.length<=1)return s;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var l=a.length,p=s.startIndex,_=1;_<l;_++){var A=a[_-1],M=a[_],L=_<a.length-1?a[_+1]:null,Y=this.segment(s,p,A,M,L);p+=Y}if(this.dash)for(var G=0;G<s.positions.length/6;G++)s.positions[G*6+5]=this.totalDistance;return s.startIndex=s.positions.length/6,s}},{key:"segment_gaode2",value:function(a,s,l,p,_,A,M,L){var Y=0,G=a.indices,ve=a.positions,Fe=a.normals,ht=this.cap==="square",It=this.join==="bevel",pr=(0,Ke.Z)([M[0],M[1]]),Cr=(0,Ke.Z)([A[0],A[1]]);Al(Fo,p,l);var Vr=0;if(this.dash&&(Vr=this.lineSegmentDistance(pr,Cr),this.totalDistance+=Vr),this.normal||(this.normal=Ri.create(),cu(this.normal,Fo)),!this.started)if(this.started=!0,ht){var pn=Ri.create(),gn=Ri.create();Ri.add(pn,this.normal,Fo),Ri.add(gn,this.normal,Fo),Fe.push(gn[0],gn[1],0),Fe.push(pn[0],pn[1],0),ve.push(l[0],l[1],0,this.totalDistance-Vr,-this.thickness,0),ve.push(l[0],l[1],0,this.totalDistance-Vr,this.thickness,0)}else this.extrusions(ve,Fe,l,this.normal,this.thickness,this.totalDistance-Vr);if(G.push(s+0,s+1,s+2),_){Ou(p,_)&&Ri.add(_,p,Ri.normalize(_,Ri.subtract(_,p,l))),Al(Cu,_,p);var Qn=qu(jl,Ri.create(),Fo,Cu,this.thickness),Si=(0,ha.Z)(Qn,2),qi=Si[0],_a=Si[1],gi=Ri.dot(jl,this.normal)<0?-1:1,Aa=It;if(!Aa&&this.join==="miter"){var Xa=qi;Xa>this.miterLimit&&(Aa=!0)}Aa?(Fe.push(this.normal[0],this.normal[1],0),Fe.push(_a[0],_a[1],0),ve.push(p[0],p[1],0,this.totalDistance,-this.thickness*gi,0),ve.push(p[0],p[1],0,this.totalDistance,this.thickness*gi,0),G.push.apply(G,(0,E.Z)(this.lastFlip!==-gi?[s,s+2,s+3]:[s+2,s+1,s+3])),G.push(s+2,s+3,s+4),cu(Qu,Cu),Ri.copy(this.normal,Qu),Fe.push(this.normal[0],this.normal[1],0),ve.push(p[0],p[1],0,this.totalDistance,-this.thickness*gi,0),Y+=3):(this.extrusions(ve,Fe,p,_a,qi,this.totalDistance),G.push.apply(G,(0,E.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),gi=-1,Ri.copy(this.normal,_a),Y+=2),this.lastFlip=gi}else{if(cu(this.normal,Fo),ht){var Dn=Ri.create(),Yn=Ri.create();Ri.sub(Yn,Fo,this.normal),Ri.add(Dn,Fo,this.normal),Fe.push(Yn[0],Yn[1],0),Fe.push(Dn[0],Dn[1],0),ve.push(p[0],p[1],0,this.totalDistance,this.thickness,0),ve.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(ve,Fe,p,this.normal,this.thickness,this.totalDistance);G.push.apply(G,(0,E.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),Y+=2}return Y}},{key:"segment",value:function(a,s,l,p,_){var A=0,M=a.indices,L=a.positions,Y=a.normals,G=this.cap==="square",ve=this.join==="bevel",Fe=(0,Ke.Z)([p[0],p[1]]),ht=(0,Ke.Z)([l[0],l[1]]);Al(Fo,Fe,ht);var It=0;if(this.dash&&(It=this.lineSegmentDistance(Fe,ht),this.totalDistance+=It),this.normal||(this.normal=Ri.create(),cu(this.normal,Fo)),!this.started)if(this.started=!0,G){var pr=Ri.create(),Cr=Ri.create();Ri.add(pr,this.normal,Fo),Ri.add(Cr,this.normal,Fo),Y.push(Cr[0],Cr[1],0),Y.push(pr[0],pr[1],0),L.push(l[0],l[1],0,this.totalDistance-It,-this.thickness,0),L.push(l[0],l[1],0,this.totalDistance-It,this.thickness,0)}else this.extrusions(L,Y,l,this.normal,this.thickness,this.totalDistance-It);if(M.push(s+0,s+1,s+2),_){var gn=(0,Ke.Z)([_[0],_[1]]);Ou(Fe,gn)&&Ri.add(gn,Fe,Ri.normalize(gn,Ri.subtract(gn,Fe,ht))),Al(Cu,gn,Fe);var Dn=qu(jl,Ri.create(),Fo,Cu,this.thickness),Yn=(0,ha.Z)(Dn,2),Qn=Yn[0],Si=Yn[1],qi=Ri.dot(jl,this.normal)<0?-1:1,_a=ve;if(!_a&&this.join==="miter"){var gi=Qn;gi>this.miterLimit&&(_a=!0)}_a?(Y.push(this.normal[0],this.normal[1],0),Y.push(Si[0],Si[1],0),L.push(p[0],p[1],0,this.totalDistance,-this.thickness*qi,0),L.push(p[0],p[1],0,this.totalDistance,this.thickness*qi,0),M.push.apply(M,(0,E.Z)(this.lastFlip!==-qi?[s,s+2,s+3]:[s+2,s+1,s+3])),M.push(s+2,s+3,s+4),cu(Qu,Cu),Ri.copy(this.normal,Qu),Y.push(this.normal[0],this.normal[1],0),L.push(p[0],p[1],0,this.totalDistance,-this.thickness*qi,0),A+=3):(this.extrusions(L,Y,p,Si,Qn,this.totalDistance),M.push.apply(M,(0,E.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),qi=-1,Ri.copy(this.normal,Si),A+=2),this.lastFlip=qi}else{if(cu(this.normal,Fo),G){var Vr=Ri.create(),pn=Ri.create();Ri.sub(pn,Fo,this.normal),Ri.add(Vr,Fo,this.normal),Y.push(pn[0],pn[1],0),Y.push(Vr[0],Vr[1],0),L.push(p[0],p[1],0,this.totalDistance,this.thickness,0),L.push(p[0],p[1],0,this.totalDistance,this.thickness,0)}else this.extrusions(L,Y,p,this.normal,this.thickness,this.totalDistance);M.push.apply(M,(0,E.Z)(this.lastFlip===1?[s,s+2,s+3]:[s+2,s+1,s+3])),A+=2}return A}},{key:"extrusions",value:function(a,s,l,p,_,A){s.push(p[0],p[1],0),s.push(p[0],p[1],0),a.push(l[0],l[1],0,A,-_,0),a.push(l[0],l[1],0,A,_,0)}},{key:"lineSegmentDistance",value:function(a,s){var l=s[0]-a[0],p=s[1]-a[1];return Math.sqrt(l*l+p*p)}}]),n}();function Lu(n){if(Wa()(n[0]))return n;if(Wa()(n[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(Wa()(n[0][0][0])){var c=n,a=0,s=0,l=0;return c.forEach(function(p){p.forEach(function(_){a+=_[0],s+=_[1],l++})}),[a/l,s/l,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}var Ea=S(77160);function Tl(n){var c=n[0][0],a=n[0][n[0].length-1];c[0]===a[0]&&c[1]===a[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var s=n[0].length,l=Po().flatten(n),p=l.vertices,_=l.dimensions,A=[],M=[],L=0;L<p.length/_;L++)_===2?A.push(p[L*2],p[L*2+1],1):A.push(p[L*3],p[L*3+1],1);var Y=Po()(l.vertices,l.holes,l.dimensions);M.push.apply(M,(0,E.Z)(Y));for(var G=function(ht){var It=l.vertices.slice(ht*_,(ht+1)*_),pr=l.vertices.slice((ht+1)*_,(ht+2)*_);pr.length===0&&(pr=l.vertices.slice(0,_));var Cr=A.length/3;A.push(It[0],It[1],1,pr[0],pr[1],1,It[0],It[1],0,pr[0],pr[1],0),M.push.apply(M,(0,E.Z)([0,2,1,2,3,1].map(function(Vr){return Vr+Cr})))},ve=0;ve<s;ve++)G(ve);return{positions:A,index:M}}function i(n){var c=Po().flatten(n),a=Po()(c.vertices,c.holes,c.dimensions);return{positions:c.vertices,index:a}}function u(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,a=n[0][0],s=n[0][n[0].length-1];a[0]===s[0]&&a[1]===s[1]&&(n[0]=n[0].slice(0,n[0].length-1));for(var l=n[0].length,p=Po().flatten(n),_=p.vertices,A=p.dimensions,M=[],L=[],Y=[],G=0;G<_.length/A;G++)A===2?M.push(_[G*2],_[G*2+1],1,-1,-1):M.push(_[G*3],_[G*3+1],1,-1,-1),Y.push(0,0,1);var ve=Po()(p.vertices,p.holes,p.dimensions);L.push.apply(L,(0,E.Z)(ve));for(var Fe=function(pr){var Cr=p.vertices.slice(pr*A,(pr+1)*A),Vr=p.vertices.slice((pr+1)*A,(pr+2)*A);Vr.length===0&&(Vr=p.vertices.slice(0,A));var pn=M.length/5;M.push(Cr[0],Cr[1],1,0,0,Vr[0],Vr[1],1,.1,0,Cr[0],Cr[1],0,0,.8,Vr[0],Vr[1],0,.1,.8);var gn=o([Vr[0],Vr[1],1],[Cr[0],Cr[1],0],[Cr[0],Cr[1],1],c);Y.push.apply(Y,(0,E.Z)(gn).concat((0,E.Z)(gn),(0,E.Z)(gn),(0,E.Z)(gn))),L.push.apply(L,(0,E.Z)([1,2,0,3,2,1].map(function(Dn){return Dn+pn})))},ht=0;ht<l;ht++)Fe(ht);return{positions:M,index:L,normals:Y}}function o(n,c,a){var s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=Ea.create(),p=Ea.create(),_=Ea.create();s&&(n=(0,Ke.vP)(n),c=(0,Ke.vP)(c),a=(0,Ke.vP)(a));var A=Ea.fromValues.apply(Ea,(0,E.Z)(n)),M=Ea.fromValues.apply(Ea,(0,E.Z)(c)),L=Ea.fromValues.apply(Ea,(0,E.Z)(a));Ea.sub(l,L,M),Ea.sub(p,A,M),Ea.cross(_,l,p);var Y=Ea.create();return Ea.normalize(Y,_),Y}var h,y;(function(n){n.CYLINDER="cylinder",n.SQUARECOLUMN="squareColumn",n.TRIANGLECOLUMN="triangleColumn",n.HEXAGONCOLUMN="hexagonColumn",n.PENTAGONCOLUMN="pentagonColumn"})(y||(y={}));var b;(function(n){n.CIRCLE="circle",n.SQUARE="square",n.TRIANGLE="triangle",n.HEXAGON="hexagon",n.PENTAGON="pentagon"})(b||(b={}));function T(n){for(var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,a=Math.PI*2/n,s=[],l=0;l<n;l++)s.push(a*l+c*Math.PI/12);var p=s.map(function(_){var A=Math.sin(_+Math.PI/4),M=Math.cos(_+Math.PI/4);return[A,M,0]});return p}function R(){return T(30)}function j(){return T(4)}function ne(){return T(3)}function be(){return T(6,1)}function Ce(){return T(5)}var Pe=(h={},(0,H.Z)(h,b.CIRCLE,R),(0,H.Z)(h,b.HEXAGON,be),(0,H.Z)(h,b.TRIANGLE,ne),(0,H.Z)(h,b.SQUARE,j),(0,H.Z)(h,b.PENTAGON,Ce),(0,H.Z)(h,y.CYLINDER,R),(0,H.Z)(h,y.HEXAGONCOLUMN,be),(0,H.Z)(h,y.TRIANGLECOLUMN,ne),(0,H.Z)(h,y.SQUARECOLUMN,j),(0,H.Z)(h,y.PENTAGONCOLUMN,Ce),h),He={};function je(n){var c=Lu(n.coordinates);return{vertices:[].concat((0,E.Z)(c),(0,E.Z)(c),(0,E.Z)(c),(0,E.Z)(c)),indices:[0,1,2,2,3,0],size:c.length}}function ot(n){var c=Lu(n.coordinates),a=Eu(c);return{vertices:[].concat((0,E.Z)(a),(0,E.Z)(a),(0,E.Z)(a),(0,E.Z)(a)),indices:[0,1,2,2,3,0],size:a.length}}function ze(n){var c=n.shape,a=nn(c,!1),s=a.positions,l=a.index,p=a.normals;return{vertices:s,indices:l,normals:p,size:5}}function at(n){var c=Lu(n.coordinates);return{vertices:(0,E.Z)(c),indices:[0],size:c.length}}function Et(n){var c=n.coordinates,a=n.originCoordinates,s=n.version,l=new zc({dash:!0,join:"bevel"});if(s==="GAODE2.x"){var p=c;Array.isArray(p[0][0])||(p=[c]);var _=a;Array.isArray(_[0][0])||(_=[a]);for(var A=0;A<p.length;A++){var M=p[A],L=_[A];l.extrude_gaode2(M,L)}}else{var Y=c;Array.isArray(Y[0][0])||(Y=[c]),Y.forEach(function(ve){l.extrude(ve)})}var G=l.complex;return{vertices:G.positions,indices:G.indices,normals:G.normals,size:6}}function Vt(n){var c=n.coordinates,a=Po().flatten(c),s=a.vertices,l=a.dimensions,p=a.holes;return{indices:Po()(s,p,l),vertices:s,size:l}}function mr(n){var c=n.coordinates,a=u(c,!0),s=a.positions,l=a.index,p=a.normals;return{vertices:s,indices:l,normals:p,size:5}}function ur(n){var c=n.shape,a=ai(c),s=a.positions,l=a.index;return{vertices:s,indices:l,size:3}}function Er(n){var c=n.coordinates,a=[].concat((0,E.Z)(c[0]),[0,0,1,c[1][0],c[0][1],0,1,1],(0,E.Z)(c[1]),[0,1,0],(0,E.Z)(c[0]),[0,0,1],(0,E.Z)(c[1]),[0,1,0,c[0][0],c[1][1],0,0,0]),s=[0,1,2,3,4,5];return{vertices:a,indices:s,size:5}}function jr(n,c){for(var a=c||30,s=n.coordinates,l=[],p=[],_=function(L){l.push(L,1,L,s[0][0],s[0][1],s[1][0],s[1][1],L,-1,L,s[0][0],s[0][1],s[1][0],s[1][1]),L!==a-1&&p.push.apply(p,(0,E.Z)([0,1,2,1,3,2].map(function(Y){return L*2+Y})))},A=0;A<a;A++)_(A);return{vertices:l,indices:p,size:7}}function hn(n){var c=n.coordinates;c.length===2&&c.push(0);var a=n.size,s=Qi(-1,1),l=Qi(1,1),p=Qi(-1,-1),_=Qi(1,-1),A=[].concat((0,E.Z)(c),(0,E.Z)(s),(0,E.Z)(c),(0,E.Z)(p),(0,E.Z)(c),(0,E.Z)(_),(0,E.Z)(c),(0,E.Z)(l)),M=[0,1,2,3,0,2];return{vertices:A,indices:M,size:5}}function nn(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(He&&He[n])return He[n];var a=Pe[n]?Pe[n]():Pe.cylinder(),s=u([a],c);return He[n]=s,s}function Nn(n,c){for(var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,s=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,l=new Float32Array(n.length/a*3),p,_,A,M=vec3.create(),L=vec3.create(),Y=vec3.create(),G=0,ve=c.length;G<ve;G+=3){p=c[G+0]*3,_=c[G+1]*3,A=c[G+2]*3;var Fe=[n[p],n[p+1]],ht=[n[_],n[_+1]],It=[n[A],n[A+1]];s&&(Fe=lngLatToMeters(Fe),ht=lngLatToMeters(ht),It=lngLatToMeters(It));var pr=Fe,Cr=_slicedToArray(pr,2),Vr=Cr[0],pn=Cr[1],gn=vec3.fromValues(Vr,pn,n[p+2]),Dn=ht,Yn=_slicedToArray(Dn,2),Qn=Yn[0],Si=Yn[1],qi=vec3.fromValues(Qn,Si,n[_+2]),_a=It,gi=_slicedToArray(_a,2),Aa=gi[0],Xa=gi[1],pu=vec3.fromValues(Aa,Xa,n[A+2]);vec3.sub(M,pu,qi),vec3.sub(L,gn,qi),vec3.cross(Y,M,L),l[p]+=M[0],l[p+1]+=M[1],l[p+2]+=M[2],l[_]+=M[0],l[_+1]+=M[1],l[_+2]+=M[2],l[A]+=M[0],l[A+1]+=M[1],l[A+2]+=M[2]}return oi(l),l}function oi(n){for(var c=0,a=n.length;c<a;c+=3){var s=vec3.fromValues(n[c],n[c+1],n[c+2]),l=vec3.create();vec3.normalize(l,s),n.set(l,c)}}function ui(n){var c=n[0][0],a=n[0][n[0].length-1];return c[0]===a[0]&&c[1]===a[1]}function ai(n){var c=["cylinder","triangleColumn","hexagonColumn","squareColumn"],a=Pe[n]?Pe[n]():Pe.circle(),s=c.indexOf(n)===-1?i([a]):Tl([a]);return s}function Qi(n,c){var a=(n+1)/2,s=(c+1)/2;return[a,s]}function Wn(){var n=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function Ei(){var n=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),c=n.positionsArr,a=n.indicesArr,s=n.normalArr;return{vertices:c,indices:a,size:5,normals:s}}function Gi(n){var c=xi();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function xi(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ci=`uniform float u_opacity: 1.0;
uniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
uniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
uniform float u_near : 0;
uniform float u_far : 1;
varying vec4 v_Color;
varying vec2 v_texCoord;
uniform float u_Zoom : 1;
uniform float u_time;

#pragma include "picking"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  gl_FragColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       gl_FragColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        gl_FragColor = vec4(foggedColor,1.0);
  }
  gl_FragColor.a *= u_opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Q=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;

attribute vec2 a_Uv;
varying vec2 v_texCoord;

varying vec4 v_Color;
uniform mat4 u_Mvp;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);
   v_texCoord = a_Uv;
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,J=function(n){(0,Dr.Z)(a,n);var c=Gi(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,A=l.baseColor,M=A===void 0?"rgb(16,16,16)":A,L=l.brightColor,Y=L===void 0?"rgb(255,176,38)":L,G=l.windowColor,ve=G===void 0?"rgb(30,60,89)":G,Fe=l.time,ht=Fe===void 0?0:Fe;return{u_opacity:_,u_baseColor:(0,Ke.CI)(M),u_brightColor:(0,Ke.CI)(Y),u_windowColor:(0,Ke.CI)(ve),u_time:this.layer.getLayerAnimateTime()||ht}}},{key:"initModels",value:function(){return this.startModelAnimate(),[this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Q,fragmentShader:Ci,triangulation:mr})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:U.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(p,_,A,M,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.size,Y=L===void 0?10:L;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(p,_,A,M){var L=p.size;return[A[3],A[4]]}}})}}]),a}(ba);function O(n){var c=k();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function k(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var oe=function(n){(0,Dr.Z)(a,n);var c=O(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","PolygonLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){this.layerModel=new J(this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"setLight",value:function(l){this.updateLayerConfig({time:l})}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){return"citybuilding"}}]),a}(eo);function we(n){var c=gt();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function gt(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Mt=`precision highp float;\r
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807\r
attribute vec3 a_Position;\r
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807\r
attribute vec3 a_Pos;\r
attribute float a_Size;\r
attribute vec4 a_Color;\r
uniform vec2 u_radius;\r
uniform float u_coverage: 0.9;\r
uniform float u_angle: 0;\r
uniform mat4 u_ModelMatrix;\r
uniform mat4 u_Mvp;\r
varying vec4 v_color;\r
\r
uniform vec2 u_SceneCenterMKT;\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,St=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,lr=function(n){(0,Dr.Z)(a,n);var c=we(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,A=l.angle;return{u_opacity:p||1,u_coverage:_||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"gridheatmap",vertexShader:Mt,fragmentShader:St,triangulation:ur,depth:{enable:!1},primitive:U.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:U.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(p,_){var A=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[A[0],A[1],0]}}})}}]),a}(ba);function Wr(n){var c=Xn();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Xn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Un=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;

attribute vec3 a_Normal;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
  // vec2 lnglat = (a_Pos.xy + offset); 
  // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
  // gl_Position = project_common_position_to_clipspace(project_pos);
  // float lightWeight = calc_lighting(project_pos);
  // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 lnglat = (a_Pos.xy + offset); 
    // vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));

    // float lightWeight = calc_lighting(project_pos);
    // v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    // gl_Position = u_Mvp * vec4(lnglat , a_Position.z * a_Size, 1.0);
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,ci=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,vi=function(n){(0,Dr.Z)(a,n);var c=Wr(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,A=l.angle;return{u_opacity:p||1,u_coverage:_||1,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"grid3dheatmap",vertexShader:Un,fragmentShader:ci,triangulation:ze,depth:{enable:!0},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.size;return Array.isArray(L)?[L[0]]:[L]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:U.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(p,_,A,M,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:U.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(p,_){var A=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[A[0],A[1],0]}}})}}]),a}(ba),jn=S(85975);function aa(n,c){for(var a=[],s=[],l=[],p=n+1,_=c+1,A=n/2,M=c/2,L=0;L<_;L++)for(var Y=L-M,G=0;G<p;G++){var ve=G-A;s.push(ve/A,-Y/M,0),l.push(G/n),l.push(1-L/c)}for(var Fe=0;Fe<c;Fe++)for(var ht=0;ht<n;ht++){var It=ht+p*Fe,pr=ht+p*(Fe+1),Cr=ht+1+p*(Fe+1),Vr=ht+1+p*Fe;a.push(It,pr,Vr),a.push(pr,Cr,Vr)}return{vertices:s,indices:a,uvs:l}}var da,Sa;function vo(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ca(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?vo(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):vo(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function Bo(n){var c=Za();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Za(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Ui=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
   
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,ga=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
uniform mat4 u_ModelMatrix;
uniform mat4 u_InverseViewProjectionMatrix;
uniform mat4 u_ViewProjectionMatrixUncentered;
varying float v_intensity;


vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}
#pragma include "projection"
void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture2D(u_texture, v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,io=`uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_opacity;
varying vec2 v_texCoord;
varying float v_intensity;

void main(){
     float intensity = texture2D(u_texture, v_texCoord).r;
    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));
    gl_FragColor =color;
    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;

}
`,So=`precision highp float;
uniform float u_intensity;
varying float v_weight;
varying vec2 v_extrude;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    gl_FragColor = vec4(val, 1., 1., 1.);
}
`,Oi=`precision highp float;
attribute vec3 a_Position;
attribute float a_Size;
attribute vec2 a_Dir;
uniform float u_intensity;
uniform float u_radius;
varying vec2 v_extrude;
varying float v_weight;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 3.0;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,co=`precision highp float;
attribute vec3 a_Position;
attribute vec2 a_Uv;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
varying float v_intensity;
void main() {
  v_texCoord = a_Uv;
  v_intensity = texture2D(u_texture, v_texCoord).r;
  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,Ka=(da=(0,sa.b2)(),da(Sa=function(n){(0,Dr.Z)(a,n);var c=Bo(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"colorTexture",void 0),(0,H.Z)((0,et.Z)(s),"heatmapFramerBuffer",void 0),(0,H.Z)((0,et.Z)(s),"intensityModel",void 0),(0,H.Z)((0,et.Z)(s),"colorModel",void 0),(0,H.Z)((0,et.Z)(s),"shapeType",void 0),s}return(0,vr.Z)(a,[{key:"render",value:function(){var l=this,p=this.rendererService,_=p.clear,A=p.useFramebuffer;A(this.heatmapFramerBuffer,function(){_({color:[0,0,0,0],depth:1,stencil:0,framebuffer:l.heatmapFramerBuffer}),l.drawIntensityMode()}),this.layer.styleNeedUpdate&&this.updateColorTexture(),this.shapeType==="heatmap"?this.drawColorMode():this.draw3DHeatMap()}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var l,p=this.rendererService,_=p.createFramebuffer,A=p.clear,M=p.getViewportSize,L=p.createTexture2D,Y=p.useFramebuffer,G=this.styleAttributeService.getLayerStyleAttribute("shape"),ve=(G==null||(l=G.scale)===null||l===void 0?void 0:l.field)||"heatmap";this.shapeType=ve,this.intensityModel=this.buildHeatMapIntensity(),this.colorModel=ve==="heatmap"?this.buildHeatmapColor():this.build3dHeatMap();var Fe=this.layer.getLayerConfig(),ht=Fe.rampColors,It=(0,Ke.Cl)(ht),pr=M(),Cr=pr.width,Vr=pr.height;return this.heatmapFramerBuffer=_({color:L({width:Math.floor(Cr/4),height:Math.floor(Vr/4),wrapS:U.gl.CLAMP_TO_EDGE,wrapT:U.gl.CLAMP_TO_EDGE,min:U.gl.LINEAR,mag:U.gl.LINEAR}),depth:!1}),this.updateColorTexture(),[this.intensityModel,this.colorModel]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:U.AttributeType.Attribute,descriptor:{name:"a_Dir",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(p,_,A,M){return[A[3],A[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.size,Y=L===void 0?1:L;return[Y]}}})}},{key:"buildHeatMapIntensity",value:function(){return this.layer.buildLayerModel({moduleName:"heatmapintensity",vertexShader:Oi,fragmentShader:So,triangulation:hn,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:U.gl.ONE,srcAlpha:1,dstRGB:U.gl.ONE,dstAlpha:1}}})}},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:co,fs:io});var l=this.shaderModuleService.getModule("heatmapColor"),p=l.vs,_=l.fs,A=l.uniforms,M=this.rendererService,L=M.createAttribute,Y=M.createElements,G=M.createBuffer,ve=M.createModel;return ve({vs:p,fs:_,attributes:{a_Position:L({buffer:G({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:U.gl.FLOAT}),size:3}),a_Uv:L({buffer:G({data:[0,1,1,1,0,0,1,0],type:U.gl.FLOAT}),size:2})},uniforms:Ca({},A),depth:{enable:!1},blend:this.getBlend(),count:6,elements:Y({data:[0,2,1,2,3,1],type:U.gl.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.intensity,A=_===void 0?10:_,M=l.radius,L=M===void 0?5:M;this.intensityModel.draw({uniforms:{u_opacity:p||1,u_radius:L,u_intensity:A}})}},{key:"drawColorMode",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer}})}},{key:"draw3DHeatMap",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=jn.create();jn.invert(_,this.cameraService.getViewProjectionMatrixUncentered()),this.colorModel.draw({uniforms:{u_opacity:p||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,E.Z)(_)}})}},{key:"build3dHeatMap",value:function(){var l=this.rendererService.getViewportSize,p=l(),_=p.width,A=p.height,M=aa(_/4,A/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:ga,fs:Ui});var L=this.shaderModuleService.getModule("heatmap3dColor"),Y=L.vs,G=L.fs,ve=L.uniforms,Fe=this.rendererService,ht=Fe.createAttribute,It=Fe.createElements,pr=Fe.createBuffer,Cr=Fe.createModel;return Cr({vs:Y,fs:G,attributes:{a_Position:ht({buffer:pr({data:M.vertices,type:U.gl.FLOAT}),size:3}),a_Uv:ht({buffer:pr({data:M.uvs,type:U.gl.FLOAT}),size:2})},primitive:U.gl.TRIANGLES,uniforms:Ca({},ve),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:U.gl.SRC_ALPHA,srcAlpha:1,dstRGB:U.gl.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:It({data:M.indices,type:U.gl.UNSIGNED_INT,count:M.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var l=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var p=this.layer.getLayerConfig(),_=p.rampColors,A=(0,Ke.Cl)(_);this.colorTexture=l({data:new Uint8Array(A.data),width:A.width,height:A.height,wrapS:U.gl.CLAMP_TO_EDGE,wrapT:U.gl.CLAMP_TO_EDGE,min:U.gl.NEAREST,mag:U.gl.NEAREST,flipY:!1})}}]),a}(ba))||Sa);function Js(n){var c=Vl();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Vl(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Hs=`precision highp float;
varying vec4 v_color;
uniform float u_opacity: 1;

#pragma include "picking"

void main() {
  gl_FragColor = v_color;
  gl_FragColor.a *= u_opacity;

  gl_FragColor = filterColor(gl_FragColor);
}
`,ju=`precision highp float;
// \u591A\u8FB9\u5F62\u9876\u70B9\u5750\u6807
attribute vec3 a_Position;
// \u591A\u8FB9\u5F62\u7ECF\u7EAC\u5EA6\u5750\u6807
attribute vec3 a_Pos;
attribute float a_Size;
attribute vec4 a_Color;
uniform vec2 u_radius;
uniform float u_coverage: 0.9;
uniform float u_angle: 0;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform vec2 u_SceneCenterMKT;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_SceneCenterMKT;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,Vu=function(n){(0,Dr.Z)(a,n);var c=Js(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.coverage,A=l.angle;return{u_opacity:p||1,u_coverage:_||.9,u_angle:A||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"hexagonheatmap",vertexShader:ju,fragmentShader:Hs,triangulation:ur,depth:{enable:!1},primitive:U.gl.TRIANGLES,blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:U.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(p,_){var A=p.version==="GAODE2.x"?p.originCoordinates:p.coordinates;return[A[0],A[1],0]}}})}}]),a}(ba),Gl={heatmap:Ka,heatmap3d:Ka,grid:lr,grid3d:vi,hexagon:Vu},pl=Gl;function Hl(n){var c=pc();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function pc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var el=function(n){(0,Dr.Z)(a,n);var c=Hl(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","HeatMapLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new pl[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"renderModels",value:function(){var l=this,p=this.getModelType();return p==="heatmap"?(this.layerModel&&this.layerModel.render(),this):(this.layerModelNeedUpdate&&(this.models=this.layerModel.buildModels(),this.layerModelNeedUpdate=!1),this.models.forEach(function(_){return _.draw({uniforms:l.layerModel.getUninforms()})}),this)}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=this.getLayerConfig(),A=_.shape3d,M=this.getSource(),L=M.data.type,Y=(p==null||(l=p.scale)===null||l===void 0?void 0:l.field)||"heatmap";return Y==="heatmap"||Y==="heatmap3d"?"heatmap":L==="hexagon"?(A==null?void 0:A.indexOf(Y))===-1?"hexagon":"grid3d":L==="grid"?(A==null?void 0:A.indexOf(Y))===-1?"grid":"grid3d":"heatmap"}}]),a}(eo);function hs(n){var c=Ff();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Ff(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var yf=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
varying vec2 v_texCoord;
void main() {
  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));
  gl_FragColor = color;
  gl_FragColor.a *= u_opacity;
}
`,_f=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,ah=function(n){(0,Dr.Z)(a,n);var c=hs(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture}}},{key:"initModels",value:function(){var l=this,p=this.layer.getSource(),_=this.rendererService.createTexture2D;return this.texture=_({height:0,width:0}),p.data.images.then(function(A){l.texture=_({data:A[0],width:A[0].width,height:A[0].height}),l.layerService.renderLayers()}),[this.layer.buildLayerModel({moduleName:"RasterImage",vertexShader:_f,fragmentShader:yf,triangulation:Er,primitive:U.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(p,_,A,M){return[A[3],A[4]]}}})}}]),a}(ba),oh={image:ah},ef=oh;function Ac(n){var c=gp();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function gp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Bf=function(n){(0,Dr.Z)(a,n);var c=Ac(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","ImageLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new ef[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={image:{}};return p[l]}},{key:"getModelType",value:function(){return"image"}}]),a}(eo);function sh(n){var c=dc();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function dc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var tf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

uniform float segmentNumber;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_segmentIndex = v_dataset.r;   // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  float d_distance_ratio = v_dataset.b; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u6BD4\u4F8B

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }
  
  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float d_texCount = v_dataset.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = 1.0 - fract(arcRadio * d_texCount + animateSpeed);

    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }
    float v = v_dataset.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
    // gl_FragColor = vec4(1.0 - fract(arcRadio * 20000.0), 0.0, 0.0, 1.0);
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
    // gl_FragColor = filterColor(texture2D(u_texture, uv));
    
  } else {
     gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(gl_FragColor);
}`,yp=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform float u_lineDir: 1.0;
varying vec4 v_dash_array;

uniform float u_thetaOffset: 0.314;
uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - \u7528\u4E8E\u5408\u5E76\u5355\u4E2A\u7684 varying \u53D8\u91CF

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = u_thetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}
vec2 interpolate (vec2 source, vec2 target, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  if(u_line_type == LineTypeDash) {
      d_distance_ratio = segmentIndex / segmentNumber;

      vec2 s = source;
      vec2 t = target;
      
      if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        s = unProjCustomCoord(source);
        t = unProjCustomCoord(target);
      }
      float total_Distance = pixelDistance(s, t) / 2.0 * PI;
      // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
      v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  
  if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_dataset.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  //unProjCustomCoord
  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_dataset.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_dataset.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_dataset.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,rf={solid:0,dash:1},uh=function(n){(0,Dr.Z)(a,n);var c=sh(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:U.gl.NEAREST,min:U.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,Y=l.lineType,G=Y===void 0?"solid":Y,ve=l.dashArray,Fe=ve===void 0?[10,5]:ve,ht=l.forward,It=ht===void 0?!0:ht,pr=l.lineTexture,Cr=pr===void 0?!1:pr,Vr=l.iconStep,pn=Vr===void 0?100:Vr,gn=l.segmentNumber,Dn=gn===void 0?30:gn,Yn=l.thetaOffset,Qn=Yn===void 0?.314:Yn;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Si=this.layer.getEncodedData(),qi=this.calDataFrame(this.cellLength,Si,this.cellProperties),_a=qi.data,gi=qi.width,Aa=qi.height;this.rowCount=Aa,this.dataTexture=this.cellLength>0&&_a.length>0?this.createTexture2D({flipY:!0,data:_a,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:gi,height:Aa}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}Fe.length===2&&Fe.push(0,0);var Xa=0,pu=[0,0,0,0],kf=[0,0,0,0];return _&&A&&(pu=(0,Ke.CI)(_),kf=(0,Ke.CI)(A),Xa=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:Qn,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(p)?p:1,u_textureBlend:L==="normal"?0:1,segmentNumber:Dn,u_line_type:rf[G||"solid"],u_dash_array:Fe,u_blur:.9,u_lineDir:It?1:-1,u_texture:this.texture,u_line_texture:Cr?1:0,u_icon_step:pn,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Xa,u_sourceColor:pu,u_targetColor:kf}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),p=l.segmentNumber,_=p===void 0?30:p;return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:yp,fragmentShader:tf,triangulation:jr,depth:{enable:!1},blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(_,A,M,L){var Y=_.size,G=Y===void 0?1:Y;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:U.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:4,update:function(_,A,M,L){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(_,A,M,L){var Y=l.iconService.getIconMap(),G=_.texture,ve=Y[G]||{x:0,y:0},Fe=ve.x,ht=ve.y;return[Fe,ht]}}})}}]),a}(ba);function _p(n){var c=xp();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function xp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Nh=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying vec4 v_color;

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
varying float v_segmentIndex;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, v_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);

      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      gl_FragColor.a *= alpha;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float u = fract(arcRadio * count - animateSpeed * count);
 
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          gl_FragColor = filterColor(pattern);
        }
    }

  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,bp=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute vec4 a_Color;
attribute float a_Size;

uniform float u_globel;
uniform float u_globel_radius;
uniform float u_global_height: 10;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;
varying float v_segmentIndex;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // TODO: + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // TODO: \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_aimate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_dataset.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel(u_icon_step);
    v_dataset.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }
  

  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));
  }

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,lh={solid:0,dash:1},Sp=function(n){(0,Dr.Z)(a,n);var c=_p(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:U.gl.NEAREST,min:U.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,Y=l.lineType,G=Y===void 0?"solid":Y,ve=l.dashArray,Fe=ve===void 0?[10,5]:ve,ht=l.lineTexture,It=ht===void 0?!1:ht,pr=l.iconStep,Cr=pr===void 0?100:pr,Vr=l.segmentNumber,pn=Vr===void 0?30:Vr,gn=l.globalArcHeight,Dn=gn===void 0?10:gn;Fe.length===2&&Fe.push(0,0);var Yn=0,Qn=[0,0,0,0],Si=[0,0,0,0];if(_&&A&&(Qn=(0,Ke.CI)(_),Si=(0,Ke.CI)(A),Yn=1),this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var qi=this.layer.getEncodedData(),_a=this.calDataFrame(this.cellLength,qi,this.cellProperties),gi=_a.data,Aa=_a.width,Xa=_a.height;this.rowCount=Xa,this.dataTexture=this.cellLength>0&&gi.length>0?this.createTexture2D({flipY:!0,data:gi,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:Aa,height:Xa}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:wl,u_global_height:Dn,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(p)?p:1,u_textureBlend:L==="normal"?0:1,segmentNumber:pn,u_line_type:lh[G]||0,u_dash_array:Fe,u_texture:this.texture,u_line_texture:It?1:0,u_icon_step:Cr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Yn,u_sourceColor:Qn,u_targetColor:Si}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var l=this.layer.getLayerConfig(),p=l.segmentNumber,_=p===void 0?30:p;return[this.layer.buildLayerModel({moduleName:"arc3Dline",vertexShader:bp,fragmentShader:Nh,triangulation:jr,blend:this.getBlend(),segmentNumber:_})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(_,A,M,L){var Y=_.size,G=Y===void 0?1:Y;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:U.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:4,update:function(_,A,M,L){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(_,A,M,L){var Y=l.iconService.getIconMap(),G=_.texture,ve=Y[G]||{x:0,y:0},Fe=ve.x,ht=ve.y;return[Fe,ht]}}})}}]),a}(ba);function nf(n){var c=Ep();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Ep(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var ts=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform float u_opacity;
uniform float u_textureBlend;
uniform float u_blur : 0.9;
uniform float u_line_type: 0.0;
// varying vec2 v_normal;
varying vec4 v_dash_array;
varying float v_distance_ratio;
varying vec4 v_color;

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

uniform float u_line_texture: 0.0;
uniform sampler2D u_texture;
uniform vec2 u_textSize;
uniform float segmentNumber;

varying vec4 v_dataset; // \u6570\u636E\u96C6

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

varying mat4 styleMappingMat;

#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0;
  float d_segmentIndex = v_dataset.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  gl_FragColor.a *= opacity;
  if(u_line_type == LineTypeDash) {
   float flag = 0.;
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
      float alpha =1.0 - fract( mod(1.0- smoothstep(0.0, 1.0, v_distance_ratio), u_aimate.z)* (1.0/ u_aimate.z) + u_time / u_aimate.y);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_dataset.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_aimate.x == Animate) {
      u = gl_FragColor.a/opacity;
    }

    float v = v_dataset.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture2D(u_texture, uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,Nf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec4 a_Instance;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float segmentNumber;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
varying vec4 v_color;
// varying vec2 v_normal;

varying float v_distance_ratio;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
varying vec4 v_dash_array;

uniform float u_icon_step: 100;
uniform float u_line_texture: 0.0;

varying vec4 v_dataset; // \u6570\u636E\u96C6

attribute vec2 a_iconMapUV;
varying vec2 v_iconMapUV;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
    vec2 x = mix(source, target, ratio);
    vec2 center = mix(source, target, 0.5);
    float dSourceCenter = distance(source, center);
    float dXCenter = distance(x, center);
    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
     float vertex_height = paraboloid(source, target, segmentRatio);

    return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
    );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*8.0;
    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba);
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
  if(u_aimate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_dataset.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_dataset.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_dataset.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));
  }
  setPickingColor(a_PickingColor);
}

`,zh={solid:0,dash:1},zf=function(n){(0,Dr.Z)(a,n);var c=nf(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:U.gl.NEAREST,min:U.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,Y=l.lineType,G=Y===void 0?"solid":Y,ve=l.dashArray,Fe=ve===void 0?[10,5]:ve,ht=l.lineTexture,It=ht===void 0?!1:ht,pr=l.iconStep,Cr=pr===void 0?100:pr,Vr=l.segmentNumber,pn=Vr===void 0?30:Vr;Fe.length===2&&Fe.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var gn=0,Dn=[0,0,0,0],Yn=[0,0,0,0];if(_&&A&&(Dn=(0,Ke.CI)(_),Yn=(0,Ke.CI)(A),gn=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Qn=this.layer.getEncodedData(),Si=this.calDataFrame(this.cellLength,Qn,this.cellProperties),qi=Si.data,_a=Si.width,gi=Si.height;this.rowCount=gi,this.dataTexture=this.cellLength>0&&qi.length>0?this.createTexture2D({flipY:!0,data:qi,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:_a,height:gi}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(p)?p:1,u_textureBlend:L==="normal"?0:1,segmentNumber:pn,u_line_type:zh[G]||0,u_dash_array:Fe,u_texture:this.texture,u_line_texture:It?1:0,u_icon_step:Cr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:gn,u_sourceColor:Dn,u_targetColor:Yn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"arc2dline",vertexShader:Nf,fragmentShader:ts,triangulation:jr,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(_,A,M,L){var Y=_.size,G=Y===void 0?1:Y;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:U.AttributeType.Attribute,descriptor:{name:"a_Instance",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:4,update:function(_,A,M,L){return[M[3],M[4],M[5],M[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(_,A,M,L){var Y=l.iconService.getIconMap(),G=_.texture,ve=Y[G]||{x:0,y:0},Fe=ve.x,ht=ve.y;return[Fe,ht]}}})}}]),a}(ba);function Zf(n){var c=Zc();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Zc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var xf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
uniform float u_blur : 0.99;
uniform float u_line_type: 0.0;
uniform float u_opacity : 1.0;
uniform float u_textureBlend;
varying vec4 v_color;
varying vec2 v_normal;

// line texture
uniform float u_line_texture;
uniform sampler2D u_texture;
uniform vec2 u_textSize;

// dash
uniform float u_dash_offset : 0.0;
uniform float u_dash_ratio : 0.1;
varying vec4 v_dash_array;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV

varying vec2 v_iconMapUV;

uniform float u_linearColor: 0;
uniform vec4 u_sourceColor;
uniform vec4 u_targetColor;

#pragma include "picking"

uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ]; // \u63A7\u5236\u8FD0\u52A8

varying mat4 styleMappingMat;
// [animate, duration, interval, trailLength],
void main() {
  float opacity = styleMappingMat[0][0];
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    gl_FragColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     gl_FragColor = v_color;
  }

  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  gl_FragColor.a *= opacity; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_aimate.x == Animate) {
      animateSpeed = u_time / u_aimate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_aimate.z)* (1.0/ u_aimate.z) + animateSpeed);
      alpha = (alpha + u_aimate.w -1.0) / u_aimate.w;
      alpha = smoothstep(0., 1., alpha);
      gl_FragColor.a *= alpha;
  }
 // dash line
  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    gl_FragColor.a *=flag;
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, vec2(u, v)));
    // gl_FragColor = filterColor(gl_FragColor + texture2D(u_texture, uv));
     vec4 pattern = texture2D(u_texture, uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      gl_FragColor = filterColor(gl_FragColor + pattern);
    } else { // replace
        pattern.a *= opacity;
        if(gl_FragColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        gl_FragColor = filterColor(pattern);
    }
  } else {
    gl_FragColor = filterColor(gl_FragColor);
  }
  // gl_FragColor = filterColor(vec4(1.0, 0.0, 0.0, 1.0));
 
  // if(rV < r || rV > 1.0 - r) {
  //   gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);
  // } 
  // if(v > 0.9) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // } else if(v < 0.1) {
  //   gl_FragColor = vec4(0.17647, 0.43921568, 0.2, 1.0);
  // }

  // gl_FragColor = filterColor(gl_FragColor);
}
`,bf=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0

attribute float a_Miter;
attribute vec4 a_Color;
attribute vec2 a_Size;
attribute vec3 a_Normal;
attribute vec3 a_Position;

attribute vec2 a_iconMapUV;

// dash line
attribute float a_Total_Distance;
attribute float a_Distance;

uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_line_type: 0.0;
uniform vec4 u_dash_array: [10.0, 5., 0, 0];
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];
uniform float u_icon_step: 100;

#pragma include "projection"
#pragma include "picking"

varying vec4 v_color;
varying vec4 v_dash_array;
varying vec2 v_normal;

varying vec4 v_dataset; // \u6570\u636E\u96C6 - distance_ratio/distance/pixelLen/texV
// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
varying vec2 v_iconMapUV;
uniform float u_linearColor: 0;

uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_line_type == LineTypeDash) {
    d_distance_ratio = a_Distance / a_Total_Distance;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  }
  if(u_aimate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }
  v_normal = vec2(reverse_offset_normal(a_Normal) * sign(a_Miter));


  v_color = a_Color;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);

  vec2 offset = project_pixel(size.xy);

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset.r = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset.g = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset.b = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset.a = texV;             // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y, 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, a_Size.y / 8.0, 1.0)); // \u989D\u5916\u9664 8.0 \u662F\u4E3A\u4E86\u548Cgaode1.x\u7684\u9AD8\u5EA6\u517C\u5BB9
  } else {
    float lineHeight = a_Size.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      lineHeight = lineHeight*2.0/pow(2.0, 20.0 - u_Zoom);
    }
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,Tc={solid:0,dash:1},af=function(n){(0,Dr.Z)(a,n);var c=Zf(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.render();return}s.texture=A({data:s.iconService.getCanvas(),mag:U.gl.NEAREST,min:U.gl.NEAREST,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.sourceColor,A=l.targetColor,M=l.textureBlend,L=M===void 0?"normal":M,Y=l.lineType,G=Y===void 0?"solid":Y,ve=l.dashArray,Fe=ve===void 0?[10,5,0,0]:ve,ht=l.lineTexture,It=ht===void 0?!1:ht,pr=l.iconStep,Cr=pr===void 0?100:pr;Fe.length===2&&Fe.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var Vr=0,pn=[0,0,0,0],gn=[0,0,0,0];if(_&&A&&(pn=(0,Ke.CI)(_),gn=(0,Ke.CI)(A),Vr=1),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p})){this.judgeStyleAttributes({opacity:p});var Dn=this.layer.getEncodedData(),Yn=this.calDataFrame(this.cellLength,Dn,this.cellProperties),Qn=Yn.data,Si=Yn.width,qi=Yn.height;this.rowCount=qi,this.dataTexture=this.cellLength>0&&Qn.length>0?this.createTexture2D({flipY:!0,data:Qn,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:Si,height:qi}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(p)?p:1,u_textureBlend:L==="normal"?0:1,u_line_type:Tc[G],u_dash_array:Fe,u_texture:this.texture,u_line_texture:It?1:0,u_icon_step:Cr,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:Vr,u_sourceColor:pn,u_targetColor:gn}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"line",vertexShader:bf,fragmentShader:xf,triangulation:Et,primitive:U.gl.TRIANGLES,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"registerBuiltinAttributes",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.lineType,A=_===void 0?"solid":_;this.styleAttributeService.registerStyleAttribute({name:"distance",type:U.AttributeType.Attribute,descriptor:{name:"a_Distance",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(L,Y,G,ve){return[G[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:U.AttributeType.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(L,Y,G,ve){return[G[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(L,Y,G,ve){var Fe=L.size,ht=Fe===void 0?1:Fe;return Array.isArray(ht)?[ht[0],ht[1]]:[ht,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:U.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(L,Y,G,ve,Fe){return Fe}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:U.AttributeType.Attribute,descriptor:{name:"a_Miter",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(L,Y,G,ve){return[G[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(L,Y,G,ve){var Fe=l.iconService.getIconMap(),ht=L.texture,It=Fe[ht]||{x:0,y:0},pr=It.x,Cr=It.y;return[pr,Cr]}}})}},{key:"loadImage",value:function(l){return new Promise(function(p,_){if(l instanceof HTMLImageElement){p(l);return}var A=new Image;A.crossOrigin="anonymous",A.onload=function(){p(A)},A.onerror=function(){_(new Error("Could not load image at "+l))},A.src=l instanceof File?URL.createObjectURL(l):l})}}]),a}(ba),of={arc:uh,arc3d:Sp,greatcircle:zf,line:af},Uf=of;function Pc(n){var c=ch();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function ch(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var sf=function(n){(0,Dr.Z)(a,n);var c=Pc(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","LineLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Uf[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={line:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"}};return p[l]}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return _||"line"}}]),a}(eo);function jf(n){var c=uf();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function uf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Uc=`varying vec4 v_color;
uniform float u_opacity: 1.0;

#pragma include "picking"

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Ru=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec3 a_Position;
attribute vec3 a_Pos;
attribute vec4 a_Color;
attribute vec3 a_Size;
attribute vec3 a_Normal;

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
varying vec4 v_color;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  vec2 offset = project_pixel(size.xy);

  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  vec4 pos = vec4(project_pos.xy + offset, project_pixel(size.z), 1.0);

  float lightWeight = calc_lighting(pos);
  v_color =vec4(a_Color.rgb * lightWeight, a_Color.w);

  // gl_Position = project_common_position_to_clipspace(pos);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * pos;
  } else {
    gl_Position = project_common_position_to_clipspace(pos);
  }
  
  if(u_globel > 0.0) {
    // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
    //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
    float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
    float xRadian = getXRadian(a_Pos.y, r);
    float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 mx = mat4(
      1,0,0,0,  
      0,xcos,-xsin,0,  
      0,xsin,xcos,0,  
      0,0,0,1);

    //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
    float yRadian = getYRadian(a_Pos.x, a_Pos.z);
    float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
    float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
    mat4 my = mat4(
      ycos,0,-ysin,0,  
      0,1,0,0,  
      ysin,0,ycos,0,  
      0,0,0,1);

    gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  }

  setPickingColor(a_PickingColor);
}
`,lf=function(n){(0,Dr.Z)(a,n);var c=jf(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),L=M.data,Y=M.width,G=M.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:Y,height:G}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointExtrude2",vertexShader:Ru,fragmentShader:Uc,triangulation:ze,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(_,A,M,L){var Y=_.size;if(Y){var G=[];return Array.isArray(Y)&&(G=Y.length===2?[Y[0],Y[0],Y[1]]:Y),Array.isArray(Y)||(G=[Y,Y,Y]),G}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:U.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(_,A,M,L,Y){return Y}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:U.AttributeType.Attribute,descriptor:{name:"a_Pos",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(_,A){var M=Lu(_.coordinates);return l?Eu([M[0],M[1]]):[M[0],M[1],0]}}})}}]),a}(ba);function Sf(n){var c=Ef();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Ef(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var fh=`#define Animate 0.0

uniform float u_globel;
uniform float u_blur : 0;
// uniform float u_stroke_width : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;
uniform float u_time;
uniform vec4 u_aimate: [ 0, 2., 1.0, 0.2 ];

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  int shape = int(floor(v_data.w + 0.5));

 
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  float opacity = styleMappingMat[0][0];
  float stroke_opacity = styleMappingMat[0][1];
  float strokeWidth = styleMappingMat[0][2];
  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;

  lowp float antialiasblur = v_data.z;
  float antialiased_blur = -max(u_blur, antialiasblur);
  // float r = v_radius / (v_radius + u_stroke_width);
  float r = v_radius / (v_radius + strokeWidth);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(u_globel > 0.0) {
    // TODO: \u5730\u7403\u6A21\u5F0F\u4E0B\u907F\u514D\u591A\u4F59\u7247\u5143\u7ED8\u5236\uFF0C\u540C\u65F6\u4E5F\u80FD\u907F\u514D\u6709\u7528\u7247\u5143\u5728\u900F\u660E\u4E14\u91CD\u53E0\u7684\u60C5\u51B5\u4E0B\u65E0\u6CD5\u5199\u5165
    // \u4ED8\u51FA\u7684\u4EE3\u4EF7\u662F\u8FB9\u7F18\u4F1A\u6709\u4E00\u4E9B\u952F\u9F7F
    if(outer_df > antialiased_blur + 0.018) discard;
  }
  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);
  
 
  // float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
  //   antialiased_blur,
  //   0.0,
  //   inner_df
  // );
   float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );
  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), strokeColor * stroke_opacity, color_t);

  gl_FragColor.a = gl_FragColor.a * opacity_t;
  if(u_aimate.x == Animate) {
    float d = length(v_data.xy);
    float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_aimate.z - u_aimate.y * u_time)), 0.0, 1.0);
    gl_FragColor = vec4(gl_FragColor.xyz, intensity);
  }

  gl_FragColor = filterColor(gl_FragColor);

  

}
`,cf=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Extrude;
attribute float a_Size;
attribute float a_Shape;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_globel;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_data;
varying vec4 v_color;
varying float v_radius;

uniform float u_opacity : 1;
uniform float u_stroke_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
uniform vec2 u_offsets;

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  float newSize = setPickingSize(a_Size);

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 strokeOpacityAndOffset = calStrokeOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][1] = strokeOpacityAndOffset.r;
  textureOffset = strokeOpacityAndOffset.g;

  vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // TODO: billboard
  // anti-alias
  float antialiasblur = 1.0 / u_DevicePixelRatio / (newSize + u_stroke_width);

  // construct point coords
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  // vec2 offset = project_pixel(extrude * (newSize + u_stroke_width) + u_offsets);
  vec2 offset = project_pixel(extrude.xy * (newSize + u_stroke_width) + textrueOffsets);
  vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(project_pos.xy + offset, 0.0, 1.0);
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));
  }

  if(u_globel > 0.0) {
    gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1, 1.0);
  }
 
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,tl=function(n){(0,Dr.Z)(a,n);var c=Sf(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,A=l.strokeOpacity,M=A===void 0?1:A,L=l.strokeWidth,Y=L===void 0?0:L,G=l.stroke,ve=G===void 0?"rgba(0,0,0,0)":G,Fe=l.offsets,ht=Fe===void 0?[0,0]:Fe;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeOpacity:M,strokeWidth:Y,stroke:ve,offsets:ht})){this.judgeStyleAttributes({opacity:_,strokeOpacity:M,strokeWidth:Y,stroke:ve,offsets:ht});var It=this.layer.getEncodedData(),pr=this.calDataFrame(this.cellLength,It,this.cellProperties),Cr=pr.data,Vr=pr.width,pn=pr.height;this.rowCount=pn,this.dataTexture=this.cellLength>0&&Cr.length>0?this.createTexture2D({flipY:!0,data:Cr,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:Vr,height:pn}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_globel:this.mapService.version==="GLOBEL"?1:0,u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(_)?_:1,u_stroke_opacity:Wa()(M)?M:1,u_stroke_width:Wa()(Y)?Y:0,u_stroke_color:this.getStrokeColor(ve),u_offsets:this.isOffsetStatic(ht)?ht:[0,0]}}},{key:"getAnimateUniforms",value:function(){var l=this.layer.getLayerConfig(),p=l.animateOption;return{u_aimate:this.animateOption2Array(p),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),je)}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){var l=this.mapService.version==="GLOBEL";return[this.layer.buildLayerModel({moduleName:"pointfill",vertexShader:cf,fragmentShader:fh,triangulation:l?ot:je,depth:{enable:l},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"animateOption2Array",value:function(l){return[l.enable?0:1,l.speed||1,l.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var l=this,p=this.mapService.version==="GLOBEL";this.styleAttributeService.registerStyleAttribute({name:"extrude",type:U.AttributeType.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(A,M,L,Y){var G;if(p){var ve=(0,ha.Z)(L,3),Fe=ve[0],ht=ve[1],It=ve[2],pr=Ea.fromValues(0,0,1),Cr=Ea.fromValues(Fe,0,It),Vr=Fe>=0?Ea.angle(pr,Cr):Math.PI*2-Ea.angle(pr,Cr),pn=Math.PI*2-Math.asin(ht/100),gn=jn.create();jn.rotateY(gn,gn,Vr),jn.rotateX(gn,gn,pn);var Dn=Ea.fromValues(1,1,0);Ea.transformMat4(Dn,Dn,gn),Ea.normalize(Dn,Dn);var Yn=Ea.fromValues(-1,1,0);Ea.transformMat4(Yn,Yn,gn),Ea.normalize(Yn,Yn);var Qn=Ea.fromValues(-1,-1,0);Ea.transformMat4(Qn,Qn,gn),Ea.normalize(Qn,Qn);var Si=Ea.fromValues(1,-1,0);Ea.transformMat4(Si,Si,gn),Ea.normalize(Si,Si),G=[].concat((0,E.Z)(Dn),(0,E.Z)(Yn),(0,E.Z)(Qn),(0,E.Z)(Si))}else G=[1,1,0,-1,1,0,-1,-1,0,1,-1,0];var qi=Y%4*3;return[G[qi],G[qi+1],G[qi+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(A,M,L,Y){var G=A.size,ve=G===void 0?5:G;return Array.isArray(ve)?[ve[0]]:[ve]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:U.AttributeType.Attribute,descriptor:{name:"a_Shape",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(A,M,L,Y){var G=A.shape,ve=G===void 0?2:G,Fe=l.layer.getLayerConfig().shape2d,ht=Fe.indexOf(ve);return[ht]}}})}}]),a}(ba);function Zh(n){var c=hh();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function hh(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Uh=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,jh=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,Cp=function(n){(0,Dr.Z)(a,n);var c=Zh(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity;return{u_opacity:p||1,u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128]}}},{key:"initModels",value:function(){var l=this;return this.initIconFontGlyphs(),this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",function(){l.updateTexture(),l.layer.render()}),[this.layer.buildLayerModel({moduleName:"pointiconImage",vertexShader:jh,fragmentShader:Uh,triangulation:at,primitive:U.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(_,A,M,L){var Y=_.size;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(_,A,M,L){var Y=l.fontService.mapping,G=_.shape,ve=l.fontService.getGlyph(G),Fe=Y[ve],ht=Fe.x,It=Fe.y;return[ht,It]}}})}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.texture=l({data:p,mag:U.gl.LINEAR,min:U.gl.LINEAR,width:p.width,height:p.height})}},{key:"initIconFontGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.fontWeight,A=_===void 0?"normal":_,M=p.fontFamily,L=M===void 0?"sans-serif":M,Y=this.layer.getEncodedData(),G=[];Y.forEach(function(ve){var Fe=ve.shape,ht=Fe===void 0?"":Fe;ht=ht.toString();var It=l.fontService.getGlyph(ht);G.indexOf(It)===-1&&G.push(It)}),this.fontService.setFontOptions({characterSet:G,fontWeight:A,fontFamily:L,fontSize:48})}}]),a}(ba);function Mc(n){var c=jc();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function jc(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Vh=`
uniform sampler2D u_texture;
varying vec4 v_color;
varying vec2 v_uv;
uniform vec2 u_textSize;
uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main(){
      float opacity = styleMappingMat[0][0];
      vec2 pos= v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
      vec4 textureColor=texture2D(u_texture,pos);
      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
            gl_FragColor= textureColor;
      }else {
            gl_FragColor= step(0.01, textureColor.z) * v_color;
      }
      // gl_FragColor.a =gl_FragColor.a * u_opacity;
      gl_FragColor.a =gl_FragColor.a * opacity;
      gl_FragColor = filterColor(gl_FragColor);
}
`,Vf=`precision highp float;
attribute vec3 a_Position;
attribute vec4 a_Color;
attribute vec2 a_Uv;
attribute float a_Size;
varying vec4 v_color;
varying vec2 v_uv;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
uniform float u_stroke_width : 1;
uniform vec2 u_offsets;

uniform float u_opacity : 1;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   v_color = a_Color;
   v_uv = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  //  vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);

  //  gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0);
    } else {
      gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy + offset),project_pos.z, 1.0));
    }
   gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;

  setPickingColor(a_PickingColor);

}
`,ff=function(n){(0,Dr.Z)(a,n);var c=Mc(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"updateTexture",function(){var A=s.rendererService.createTexture2D;if(s.texture){s.texture.update({data:s.iconService.getCanvas()}),s.layer.renderLayers();return}s.texture=A({data:s.iconService.getCanvas(),mag:U.gl.LINEAR,min:U.gl.LINEAR,premultiplyAlpha:!1,width:1024,height:s.iconService.canvasHeight||128})}),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=l.offsets,A=_===void 0?[0,0]:_;if(this.rendererService.getDirty()&&this.texture.bind(),this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:p,offsets:A})){this.judgeStyleAttributes({opacity:p,offsets:A});var M=this.layer.getEncodedData(),L=this.calDataFrame(this.cellLength,M,this.cellProperties),Y=L.data,G=L.width,ve=L.height;this.rowCount=ve,this.dataTexture=this.cellLength>0&&Y.length>0?this.createTexture2D({flipY:!0,data:Y,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:G,height:ve}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:Wa()(p)?p:1,u_offsets:this.isOffsetStatic(A)?A:[0,0]}}},{key:"initModels",value:function(){return this.registerBuiltinAttributes(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),this.buildModels()}},{key:"clearModels",value:function(){var l,p;(l=this.texture)===null||l===void 0||l.destroy(),(p=this.dataTexture)===null||p===void 0||p.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:Vf,fragmentShader:Vh,triangulation:at,primitive:U.gl.POINTS,depth:{enable:!1},blend:this.getBlend()})]}},{key:"registerBuiltinAttributes",value:function(){var l=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(_,A,M,L){var Y=_.size,G=Y===void 0?5:Y;return Array.isArray(G)?[G[0]]:[G]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(_,A,M,L){var Y=l.iconService.getIconMap(),G=_.shape,ve=Y[G]||{x:0,y:0},Fe=ve.x,ht=ve.y;return[Fe,ht]}}})}}]),a}(ba);function dl(n){var c=wp();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function wp(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Wl=`
uniform float u_opacity : 1;
uniform vec2 u_offsets;
varying vec4 v_color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  float opacity = styleMappingMat[0][0];

  gl_FragColor = v_color;
  // gl_FragColor.a =gl_FragColor.a * u_opacity;
  gl_FragColor.a =gl_FragColor.a * opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Gh=`
attribute vec3 a_Position;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute float a_Size;
attribute vec4 a_Color;
varying vec4 v_color;

uniform float u_opacity : 1;
uniform vec2 u_offsets;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = a_Color;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

  vec2 textrueOffsets = vec2(0.0, 0.0);
  if(hasOffsets()) {
    vec2 valueXPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.r = pos2value(valueXPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;

    vec2 valueYPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    textrueOffsets.g = pos2value(valueYPos, columnWidth, rowHeight); // x
    textureOffset += 1.0;
  } else {
    textrueOffsets = u_offsets;
  }

  // cal style mapping
  
  // vec2 offset = project_pixel(u_offsets);
  vec2 offset = project_pixel(textrueOffsets);
  // vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
  // gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\\
  // 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // vec2 offset = project_pixel((u_offsets));
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    // vec2 offset = project_pixel(u_offsets);
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function Xl(n){var c=n.coordinates;return{vertices:(0,E.Z)(c),indices:[0],size:c.length}}var Yl=function(n){(0,Dr.Z)(a,n);var c=dl(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,A=l.offsets,M=A===void 0?[0,0]:A;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,offsets:M})){this.judgeStyleAttributes({opacity:_,offsets:M});var L=this.layer.getEncodedData(),Y=this.calDataFrame(this.cellLength,L,this.cellProperties),G=Y.data,ve=Y.width,Fe=Y.height;this.rowCount=Fe,this.dataTexture=this.cellLength>0&&G.length>0?this.createTexture2D({flipY:!0,data:G,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:ve,height:Fe}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(_)?_:1,u_offsets:this.isOffsetStatic(M)?M:[0,0]}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"normalpoint",vertexShader:Gh,fragmentShader:Wl,triangulation:Xl,depth:{enable:!1},primitive:U.gl.POINTS,blend:this.getBlend()})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.size,Y=L===void 0?1:L;return Array.isArray(Y)?[Y[0]]:[Y]}}})}},{key:"defaultStyleOptions",value:function(){return{blend:U.BlendType.additive}}}]),a}(ba),hf=S(98333);function ph(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=Gf(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return p=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function Gf(n,c){if(!!n){if(typeof n=="string")return dh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return dh(n,c)}}function dh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}var Es=function(){function n(c,a,s){(0,ft.Z)(this,n),(0,H.Z)(this,"boxCells",[]),(0,H.Z)(this,"xCellCount",void 0),(0,H.Z)(this,"yCellCount",void 0),(0,H.Z)(this,"boxKeys",void 0),(0,H.Z)(this,"bboxes",void 0),(0,H.Z)(this,"width",void 0),(0,H.Z)(this,"height",void 0),(0,H.Z)(this,"xScale",void 0),(0,H.Z)(this,"yScale",void 0),(0,H.Z)(this,"boxUid",void 0);var l=this.boxCells;this.xCellCount=Math.ceil(c/s),this.yCellCount=Math.ceil(a/s);for(var p=0;p<this.xCellCount*this.yCellCount;p++)l.push([]);this.boxKeys=[],this.bboxes=[],this.width=c,this.height=a,this.xScale=this.xCellCount/c,this.yScale=this.yCellCount/a,this.boxUid=0}return(0,vr.Z)(n,[{key:"insert",value:function(a,s,l,p,_){this.forEachCell(s,l,p,_,this.insertBoxCell,this.boxUid++),this.boxKeys.push(a),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(_)}},{key:"query",value:function(a,s,l,p,_){return this.queryHitTest(a,s,l,p,!1,_)}},{key:"hitTest",value:function(a,s,l,p,_){return this.queryHitTest(a,s,l,p,!0,_)}},{key:"insertBoxCell",value:function(a,s,l,p,_,A){this.boxCells[_].push(A)}},{key:"queryHitTest",value:function(a,s,l,p,_,A){if(l<0||a>this.width||p<0||s>this.height)return _?!1:[];var M=[];if(a<=0&&s<=0&&this.width<=l&&this.height<=p){if(_)return!0;for(var L=0;L<this.boxKeys.length;L++)M.push({key:this.boxKeys[L],x1:this.bboxes[L*4],y1:this.bboxes[L*4+1],x2:this.bboxes[L*4+2],y2:this.bboxes[L*4+3]});return A?M.filter(A):M}var Y={hitTest:_,seenUids:{box:{},circle:{}}};return this.forEachCell(a,s,l,p,this.queryCell,M,Y,A),_?M.length>0:M}},{key:"queryCell",value:function(a,s,l,p,_,A,M,L){var Y=M.seenUids,G=this.boxCells[_];if(G!==null){var ve=this.bboxes,Fe=ph(G),ht;try{for(Fe.s();!(ht=Fe.n()).done;){var It=ht.value;if(!Y.box[It]){Y.box[It]=!0;var pr=It*4;if(a<=ve[pr+2]&&s<=ve[pr+3]&&l>=ve[pr+0]&&p>=ve[pr+1]&&(!L||L(this.boxKeys[It]))){if(M.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[It],x1:ve[pr],y1:ve[pr+1],x2:ve[pr+2],y2:ve[pr+3]})}}}}catch(Cr){Fe.e(Cr)}finally{Fe.f()}}return!1}},{key:"forEachCell",value:function(a,s,l,p,_,A,M,L){for(var Y=this.convertToXCellCoord(a),G=this.convertToYCellCoord(s),ve=this.convertToXCellCoord(l),Fe=this.convertToYCellCoord(p),ht=Y;ht<=ve;ht++)for(var It=G;It<=Fe;It++){var pr=this.xCellCount*It+ht;if(_.call(this,a,s,l,p,pr,A,M,L))return}}},{key:"convertToXCellCoord",value:function(a){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(a*this.xScale)))}},{key:"convertToYCellCoord",value:function(a){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(a*this.yScale)))}}]),n}(),Wo=Es,ps=function(){function n(c,a){(0,ft.Z)(this,n),(0,H.Z)(this,"width",void 0),(0,H.Z)(this,"height",void 0),(0,H.Z)(this,"grid",void 0),(0,H.Z)(this,"viewportPadding",100),(0,H.Z)(this,"screenRightBoundary",void 0),(0,H.Z)(this,"screenBottomBoundary",void 0),(0,H.Z)(this,"gridRightBoundary",void 0),(0,H.Z)(this,"gridBottomBoundary",void 0),this.width=c,this.height=a,this.viewportPadding=Math.max(c,a),this.grid=new Wo(c+this.viewportPadding,a+this.viewportPadding,25),this.screenRightBoundary=c+this.viewportPadding,this.screenBottomBoundary=a+this.viewportPadding,this.gridRightBoundary=c+2*this.viewportPadding,this.gridBottomBoundary=a+2*this.viewportPadding}return(0,vr.Z)(n,[{key:"placeCollisionBox",value:function(a){var s=a.x1+a.anchorPointX+this.viewportPadding,l=a.y1+a.anchorPointY+this.viewportPadding,p=a.x2+a.anchorPointX+this.viewportPadding,_=a.y2+a.anchorPointY+this.viewportPadding;return!this.isInsideGrid(s,l,p,_)||this.grid.hitTest(s,l,p,_)?{box:[]}:{box:[s,l,p,_]}}},{key:"insertCollisionBox",value:function(a,s){var l={featureIndex:s};this.grid.insert(l,a[0],a[1],a[2],a[3])}},{key:"project",value:function(a,s,l){var p=hf.al(s,l,0,1),_=hf.Ue(),A=jn.fromValues.apply(jn,(0,E.Z)(a));return hf.fF(_,p,A),{x:(_[0]/_[3]+1)/2*this.width+this.viewportPadding,y:(-_[1]/_[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(a,s,l,p){return l>=0&&a<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}}]),n}();function wu(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=vh(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return p=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function vh(n,c){if(!!n){if(typeof n=="string")return Hh(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hh(n,c)}}function Hh(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function mh(n){var c=.5,a=.5;switch(n){case"right":case"top-right":case"bottom-right":c=1;break;case"left":case"top-left":case"bottom-left":c=0;break;default:c=.5}switch(n){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0;break;default:a=.5}return{horizontalAlign:c,verticalAlign:a}}function Wh(n,c,a,s,l){if(!!l){var p=n[s],_=p.glyph;if(_)for(var A=c[_].advance*p.scale,M=(n[s].x+A)*l,L=a;L<=s;L++)n[L].x-=M}}function Xh(n,c,a,s,l,p,_){var A=(c-a)*l,M=(-s*_+.5)*p,L=wu(n),Y;try{for(L.s();!(Y=L.n()).done;){var G=Y.value;G.x+=A,G.y+=M}}catch(ve){L.e(ve)}finally{L.f()}}function Yh(n,c,a,s,l,p,_){var A=-8,M=0,L=A,Y=0,G=n.positionedGlyphs,ve=p==="right"?1:p==="left"?0:.5,Fe=G.length;a.forEach(function(Vr){if(Vr.split("").forEach(function(gn){var Dn=c[gn],Yn=0;Dn&&(G.push({glyph:gn,x:M,y:L+Yn,vertical:!1,scale:1,metrics:Dn}),M+=Dn.advance+_)}),G.length!==Fe){var pn=M-_;Y=Math.max(pn,Y),Wh(G,c,Fe,G.length-1,ve)}M=0,L+=s});var ht=mh(l),It=ht.horizontalAlign,pr=ht.verticalAlign;Xh(G,ve,It,pr,Y,s,a.length);var Cr=L-A;n.top+=-pr*Cr,n.bottom=n.top+Cr,n.left+=-It*Y,n.right=n.left+Y}function Kh(n,c,a,s,l,p,_){var A=-8,M=0,L=A,Y=0,G=n.positionedGlyphs,ve=p==="right"?1:p==="left"?0:.5,Fe=G.length;a.forEach(function(Vr){var pn=c[Vr],gn=0;if(pn&&(G.push({glyph:Vr,x:M,y:L+gn,vertical:!1,scale:1,metrics:pn}),M+=pn.advance+_),G.length!==Fe){var Dn=M-_;Y=Math.max(Dn,Y),Wh(G,c,Fe,G.length-1,ve)}M=0,L+=s});var ht=mh(l),It=ht.horizontalAlign,pr=ht.verticalAlign;Xh(G,ve,It,pr,Y,s,a.length);var Cr=L-A;n.top+=-pr*Cr,n.bottom=n.top+Cr,n.left+=-It*Y,n.right=n.left+Y}function Ap(n,c,a,s,l,p){var _=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],A=arguments.length>7?arguments[7]:void 0,M=n.split(`
`),L=[],Y={positionedGlyphs:L,top:_[1],bottom:_[1],left:_[0],right:_[0],lineCount:M.length,text:n};return A?Kh(Y,c,M,a,s,l,p):Yh(Y,c,M,a,s,l,p),L.length?Y:!1}function Tp(n){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],a=arguments.length>2?arguments[2]:void 0,s=n.positionedGlyphs,l=s===void 0?[]:s,p=[],_=wu(l),A;try{for(_.s();!(A=_.n()).done;){var M=A.value,L=M.metrics,Y=4,G=L.advance*M.scale/2,ve=a?[M.x+G,M.y]:[0,0],Fe=a?[0,0]:[M.x+G+c[0],M.y+c[1]],ht=(0-Y)*M.scale-G+Fe[0],It=(0-Y)*M.scale+Fe[1],pr=ht+L.width*M.scale,Cr=It+L.height*M.scale,Vr={x:ht,y:It},pn={x:pr,y:It},gn={x:ht,y:Cr},Dn={x:pr,y:Cr};p.push({tl:Vr,tr:pn,bl:gn,br:Dn,tex:L,glyphOffset:ve})}}catch(Yn){_.e(Yn)}finally{_.f()}return p}function Cf(n,c){var a=typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(!a){if(Array.isArray(n)||(a=$h(n))||c&&n&&typeof n.length=="number"){a&&(n=a);var s=0,l=function(){};return{s:l,n:function(){return s>=n.length?{done:!0}:{done:!1,value:n[s++]}},e:function(L){throw L},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var p=!0,_=!1,A;return{s:function(){a=a.call(n)},n:function(){var L=a.next();return p=L.done,L},e:function(L){_=!0,A=L},f:function(){try{!p&&a.return!=null&&a.return()}finally{if(_)throw A}}}}function $h(n,c){if(!!n){if(typeof n=="string")return Hf(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Hf(n,c)}}function Hf(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function wf(n){var c=ao();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function ao(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var gh=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0
uniform sampler2D u_sdf_map;
uniform float u_gamma_scale : 0.5;
// uniform float u_font_size : 24.0;
uniform float u_opacity : 1.0;
uniform vec4 u_stroke_color : [0, 0, 0, 1];
uniform float u_stroke_width : 2.0;
uniform float u_halo_blur : 0.5;
uniform float u_DevicePixelRatio;

varying vec4 v_color;
varying vec2 v_uv;
varying float v_gamma_scale;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"
void main() {
  // get style data mapping
  float opacity = styleMappingMat[0][0];
  float strokeWidth = styleMappingMat[0][2];
  vec4 textrueStroke = vec4(
    styleMappingMat[1][0],
    styleMappingMat[1][1],
    styleMappingMat[1][2],
    styleMappingMat[1][3]
  );

  // get sdf from atlas
  float dist = texture2D(u_sdf_map, v_uv).a;

  // float fontScale = u_font_size / FONT_SIZE;

  // lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  lowp float buff = (6.0 - strokeWidth / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);
  // gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), vec4(u_stroke_color.rgb, u_stroke_color.a * u_opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor = mix(vec4(v_color.rgb, v_color.a * opacity), vec4(textrueStroke.rgb, textrueStroke.a * opacity), smoothstep(0., 0.5, 1. - dist));
  gl_FragColor.a= gl_FragColor.a * alpha;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Kl=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0
attribute vec3 a_Position;
attribute vec2 a_tex;
attribute vec2 a_textOffsets;
attribute vec4 a_Color;
attribute float a_Size;
attribute float a_Rotate;

uniform vec2 u_sdf_map_size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec2 v_uv;
varying float v_gamma_scale;
varying vec4 v_color;
varying float v_fontScale;

varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

uniform float u_opacity : 1;
uniform float u_stroke_width : 2;
uniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"
#pragma include "styleMappingCalStrokeWidth"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
   styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;

   vec2 strokeWidthAndOffset = calStrokeWidthAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][2] = strokeWidthAndOffset.r;
  textureOffset = strokeWidthAndOffset.g;

  vec4 textrueStroke = vec4(-1.0, -1.0, -1.0, -1.0);
  if(hasStroke()) {
    vec2 valueRPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][0] = pos2value(valueRPos, columnWidth, rowHeight); // R
    textureOffset += 1.0;

    vec2 valueGPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][1] = pos2value(valueGPos, columnWidth, rowHeight); // G
    textureOffset += 1.0;

    vec2 valueBPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][2] = pos2value(valueBPos, columnWidth, rowHeight); // B
    textureOffset += 1.0;

    vec2 valueAPos = nextPos(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset);
    styleMappingMat[1][3] = pos2value(valueAPos, columnWidth, rowHeight); // A
    textureOffset += 1.0;
  } else {
    if(u_stroke_color == vec4(0.0)) {
      styleMappingMat[1][0] = v_color.r;
      styleMappingMat[1][1] = v_color.g;
      styleMappingMat[1][2] = v_color.b;
      styleMappingMat[1][3] = v_color.a;
    } else {
      styleMappingMat[1][0] = u_stroke_color.r;
      styleMappingMat[1][1] = u_stroke_color.g;
      styleMappingMat[1][2] = u_stroke_color.b;
      styleMappingMat[1][3] = u_stroke_color.a;
    }
  }
  
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = a_Color;
  v_uv = a_tex / u_sdf_map_size;

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  highp float angle_sin = sin(a_Rotate);
  highp float angle_cos = cos(a_Rotate);
  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  vec4 projected_position;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
   projected_position  = u_Mvp * (vec4(a_Position.xyz, 1.0));
  } else { // else
   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`;function Ic(n){var c=this,a=n.id,s=[],l=[];if(!c.glyphInfoMap||!c.glyphInfoMap[a])return{vertices:[],indices:[],size:7};var p=c.glyphInfoMap[a].centroid,_=p.length===2?[p[0],p[1],0]:p;return c.glyphInfoMap[a].glyphQuads.forEach(function(A,M){s.push.apply(s,(0,E.Z)(_).concat([A.tex.x,A.tex.y+A.tex.height,A.tl.x,A.tl.y],(0,E.Z)(_),[A.tex.x+A.tex.width,A.tex.y+A.tex.height,A.tr.x,A.tr.y],(0,E.Z)(_),[A.tex.x+A.tex.width,A.tex.y,A.br.x,A.br.y],(0,E.Z)(_),[A.tex.x,A.tex.y,A.bl.x,A.bl.y])),l.push(0+M*4,1+M*4,2+M*4,2+M*4,3+M*4,0+M*4)}),{vertices:s,indices:l,size:7}}var yh=function(n){(0,Dr.Z)(a,n);var c=wf(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"glyphInfo",void 0),(0,H.Z)((0,et.Z)(s),"glyphInfoMap",{}),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"currentZoom",-1),(0,H.Z)((0,et.Z)(s),"extent",void 0),(0,H.Z)((0,et.Z)(s),"textureHeight",0),(0,H.Z)((0,et.Z)(s),"textCount",0),(0,H.Z)((0,et.Z)(s),"preTextStyle",{}),(0,H.Z)((0,et.Z)(s),"buildModels",function(){return s.initGlyph(),s.updateTexture(),s.filterGlyphs(),s.reBuildModel(),[s.layer.buildLayerModel({moduleName:"pointText",vertexShader:Kl,fragmentShader:gh,triangulation:Ic.bind((0,et.Z)(s)),depth:{enable:!1},blend:s.getBlend()})]}),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,A=l.stroke,M=A===void 0?"#fff":A,L=l.strokeWidth,Y=L===void 0?0:L,G=l.textAnchor,ve=G===void 0?"center":G,Fe=l.textAllowOverlap,ht=Fe===void 0?!1:Fe,It=l.halo,pr=It===void 0?.5:It,Cr=l.gamma,Vr=Cr===void 0?2:Cr,pn=this.fontService,gn=pn.canvas,Dn=pn.mapping;if(Object.keys(Dn).length!==this.textCount&&(this.updateTexture(),this.textCount=Object.keys(Dn).length),this.preTextStyle={textAnchor:ve,textAllowOverlap:ht},this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_,strokeWidth:Y,stroke:M})){this.judgeStyleAttributes({opacity:_,strokeWidth:Y,stroke:M});var Yn=this.layer.getEncodedData(),Qn=this.calDataFrame(this.cellLength,Yn,this.cellProperties),Si=Qn.data,qi=Qn.width,_a=Qn.height;this.rowCount=_a,this.dataTexture=this.cellLength>0&&Si.length>0?this.createTexture2D({flipY:!0,data:Si,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:qi,height:_a}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(_)?_:1,u_stroke_width:Wa()(Y)?Y:0,u_stroke_color:this.getStrokeColor(M),u_sdf_map:this.texture,u_halo_blur:pr,u_gamma_scale:Vr,u_sdf_map_size:[gn.width,gn.height]}}},{key:"initModels",value:function(){this.layer.on("remapping",this.buildModels),this.extent=this.textExtent();var l=this.layer.getLayerConfig(),p=l.textAnchor,_=p===void 0?"center":p,A=l.textAllowOverlap,M=A===void 0?!0:A;return this.preTextStyle={textAnchor:_,textAllowOverlap:M},this.buildModels()}},{key:"needUpdate",value:function(){var l=this.layer.getLayerConfig(),p=l.textAllowOverlap,_=p===void 0?!1:p,A=this.mapService.getZoom(),M=this.mapService.getBounds(),L=(0,Ke.oO)(this.extent,M);return!_&&(Math.abs(this.currentZoom-A)>1||!L)||_!==this.preTextStyle.textAllowOverlap?(this.reBuildModel(),!0):!1}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy(),this.layer.off("remapping",this.buildModels)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:U.AttributeType.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.rotate,Y=L===void 0?0:L;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:U.AttributeType.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(p,_,A,M){return[A[5],A[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.size,Y=L===void 0?12:L;return Array.isArray(Y)?[Y[0]]:[Y]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:U.AttributeType.Attribute,descriptor:{name:"a_tex",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(p,_,A,M){return[A[3],A[4]]}}})}},{key:"textExtent",value:function(){var l=this.mapService.getBounds();return(0,Ke.yA)(l,.5)}},{key:"initTextFont",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,_=p===void 0?"400":p,A=l.fontFamily,M=A===void 0?"sans-serif":A,L=this.layer.getEncodedData(),Y=[];L.forEach(function(G){var ve=G.shape,Fe=ve===void 0?"":ve;Fe=Fe.toString();var ht=Cf(Fe),It;try{for(ht.s();!(It=ht.n()).done;){var pr=It.value;Y.indexOf(pr)===-1&&Y.push(pr)}}catch(Cr){ht.e(Cr)}finally{ht.f()}}),this.fontService.setFontOptions({characterSet:Y,fontWeight:_,fontFamily:M,iconfont:!1})}},{key:"initIconFontTex",value:function(){var l=this.layer.getLayerConfig(),p=l.fontWeight,_=p===void 0?"400":p,A=l.fontFamily,M=A===void 0?"sans-serif":A,L=this.layer.getEncodedData(),Y=[];L.forEach(function(G){var ve=G.shape,Fe=ve===void 0?"":ve;Fe=Fe.toString(),Y.indexOf(Fe)===-1&&Y.push(Fe)}),this.fontService.setFontOptions({characterSet:Y,fontWeight:_,fontFamily:M,iconfont:!0})}},{key:"generateGlyphLayout",value:function(l){var p=this,_=this.fontService.mapping,A=this.layer.getLayerConfig(),M=A.spacing,L=M===void 0?2:M,Y=A.textAnchor,G=Y===void 0?"center":Y,ve=this.layer.getEncodedData();this.glyphInfo=ve.map(function(Fe){var ht=Fe.shape,It=ht===void 0?"":ht,pr=Fe.id,Cr=Fe.size,Vr=Cr===void 0?1:Cr,pn=Fe.textOffset,gn=pn===void 0?[0,0]:pn,Dn=Ap(It.toString(),_,Vr,G,"center",L,gn,l),Yn=Tp(Dn,gn,!1);return Fe.shaping=Dn,Fe.glyphQuads=Yn,Fe.centroid=Lu(Fe.coordinates),Fe.originCentroid=Fe.version==="GAODE2.x"?Lu(Fe.originCoordinates):Fe.originCentroid=Fe.centroid,p.glyphInfoMap[pr]={shaping:Dn,glyphQuads:Yn,centroid:Lu(Fe.coordinates)},Fe})}},{key:"filterGlyphs",value:function(){var l=this,p=this.layer.getLayerConfig(),_=p.padding,A=_===void 0?[4,4]:_,M=p.textAllowOverlap,L=M===void 0?!1:M;if(!L){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var Y=this.rendererService.getViewportSize(),G=Y.width,ve=Y.height,Fe=new ps(G,ve),ht=this.glyphInfo.filter(function(It){var pr=It.shaping,Cr=It.id,Vr=Cr===void 0?0:Cr,pn=It.version==="GAODE2.x"?It.originCentroid:It.centroid,gn=It.size,Dn=gn/24,Yn=l.mapService.lngLatToContainer(pn),Qn=Fe.placeCollisionBox({x1:pr.left*Dn-A[0],x2:pr.right*Dn+A[0],y1:pr.top*Dn-A[1],y2:pr.bottom*Dn+A[1],anchorPointX:Yn.x,anchorPointY:Yn.y}),Si=Qn.box;return Si&&Si.length?(Fe.insertCollisionBox(Si,Vr),!0):!1});ht.forEach(function(It){l.glyphInfoMap[It.id]=It})}}},{key:"initGlyph",value:function(){var l=this.layer.getLayerConfig(),p=l.iconfont,_=p===void 0?!1:p;_?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(_)}},{key:"updateTexture",value:function(){var l=this.rendererService.createTexture2D,p=this.fontService.canvas;this.textureHeight=p.height,this.texture&&this.texture.destroy(),this.texture=l({data:p,mag:U.gl.LINEAR,min:U.gl.LINEAR,width:p.width,height:p.height})}},{key:"reBuildModel",value:function(){this.filterGlyphs(),this.layer.models=[this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Kl,fragmentShader:gh,triangulation:Ic.bind(this),depth:{enable:!1},blend:this.getBlend()})]}}]),a}(ba),z={fill:tl,image:ff,normal:Yl,extrude:lf,text:yh,icon:Cp},Ie=z;function qe(n){var c=ar();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function ar(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Br=function(n){(0,Dr.Z)(a,n);var c=qe(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","PointLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new Ie[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={normal:{blend:"additive"},fill:{blend:"normal"},extrude:{},image:{},icon:{},text:{blend:"normal"}};return p[l]}},{key:"getModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),_=p.shape2d,A=p.shape3d,M=this.iconService.getIconMap(),L=l.find(function(G){return G.hasOwnProperty("shape")});if(L){var Y=L.shape;return Y==="dot"?"normal":(_==null?void 0:_.indexOf(Y))!==-1?"fill":(A==null?void 0:A.indexOf(Y))!==-1?"extrude":M.hasOwnProperty(Y)?"image":this.fontService.getGlyph(Y)!==""?"icon":"text"}else return"normal"}}]),a}(eo);function rr(n){var c=Mr();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Mr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Gr=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E
#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,$r=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,tn=function(n){(0,Dr.Z)(a,n);var c=rr(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),L=M.data,Y=M.width,G=M.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:Y,height:G}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygonExtrude",vertexShader:$r,fragmentShader:Gr,triangulation:mr})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:U.AttributeType.Attribute,descriptor:{name:"a_Normal",buffer:{usage:U.gl.STATIC_DRAW,data:[],type:U.gl.FLOAT},size:3,update:function(p,_,A,M,L){return L}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:U.AttributeType.Attribute,descriptor:{name:"a_Size",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(p,_,A,M){var L=p.size,Y=L===void 0?10:L;return Array.isArray(Y)?[Y[0]]:[Y]}}})}}]),a}(ba);function rn(n){var c=sn();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function sn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var yn=`uniform float u_opacity: 1.0;
varying vec4 v_Color;
varying mat4 styleMappingMat; // \u4F20\u9012\u4ECE\u7247\u5143\u4E2D\u4F20\u9012\u7684\u6620\u5C04\u6570\u636E

#pragma include "picking"

void main() {
  float opacity = styleMappingMat[0][0];
  gl_FragColor = v_Color;
  // gl_FragColor.a *= u_opacity;
  gl_FragColor.a *= opacity;
  gl_FragColor = filterColor(gl_FragColor);
}
`,Qr=`attribute vec4 a_Color;
attribute vec3 a_Position;
attribute vec3 a_Normal;
attribute float a_Size;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;

varying vec4 v_Color;
uniform float u_opacity: 1.0;
varying mat4 styleMappingMat; // \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143

#pragma include "styleMapping"
#pragma include "styleMappingCalOpacity"

#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
styleMappingMat = mat4(
    0.0, 0.0, 0.0, 0.0, // opacity - strokeOpacity - strokeWidth - empty
    0.0, 0.0, 0.0, 0.0, // strokeR - strokeG - strokeB - strokeA
    0.0, 0.0, 0.0, 0.0, // offsets[0] - offsets[1]
    0.0, 0.0, 0.0, 0.0
  );

  float rowCount = u_cellTypeLayout[0][0];    // \u5F53\u524D\u7684\u6570\u636E\u7EB9\u7406\u6709\u51E0\u884C
  float columnCount = u_cellTypeLayout[0][1]; // \u5F53\u770B\u5230\u6570\u636E\u7EB9\u7406\u6709\u51E0\u5217
  float columnWidth = 1.0/columnCount;  // \u5217\u5BBD
  float rowHeight = 1.0/rowCount;       // \u884C\u9AD8
  float cellCount = calCellCount(); // opacity - strokeOpacity - strokeWidth - stroke - offsets
  float id = a_vertexId; // \u7B2Cn\u4E2A\u9876\u70B9
  float cellCurrentRow = floor(id * cellCount / columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u884C
  float cellCurrentColumn = mod(id * cellCount, columnCount) + 1.0; // \u8D77\u59CB\u70B9\u5728\u7B2C\u51E0\u5217
  
  // cell \u56FA\u5B9A\u987A\u5E8F opacity -> strokeOpacity -> strokeWidth -> stroke ... 
  // \u6309\u987A\u5E8F\u4ECE cell \u4E2D\u53D6\u503C\u3001\u82E5\u6CA1\u6709\u5219\u81EA\u52A8\u5F80\u4E0B\u53D6\u503C
  float textureOffset = 0.0; // \u5728 cell \u4E2D\u53D6\u503C\u7684\u504F\u79FB\u91CF

  vec2 opacityAndOffset = calOpacityAndOffset(cellCurrentRow, cellCurrentColumn, columnCount, textureOffset, columnWidth, rowHeight);
  styleMappingMat[0][0] = opacityAndOffset.r;
  textureOffset = opacityAndOffset.g;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_Color = a_Color;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  setPickingColor(a_PickingColor);
}

`,un=function(n){(0,Dr.Z)(a,n);var c=rn(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p;if(this.dataTextureTest&&this.dataTextureNeedUpdate({opacity:_})){this.judgeStyleAttributes({opacity:_});var A=this.layer.getEncodedData(),M=this.calDataFrame(this.cellLength,A,this.cellProperties),L=M.data,Y=M.width,G=M.height;this.rowCount=G,this.dataTexture=this.cellLength>0&&L.length>0?this.createTexture2D({flipY:!0,data:L,format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:Y,height:G}):this.createTexture2D({flipY:!0,data:[1],format:U.gl.LUMINANCE,type:U.gl.FLOAT,width:1,height:1})}return{u_dataTexture:this.dataTexture,u_cellTypeLayout:this.getCellTypeLayout(),u_opacity:Wa()(_)?_:1}}},{key:"initModels",value:function(){return this.buildModels()}},{key:"buildModels",value:function(){return[this.layer.buildLayerModel({moduleName:"polygon",vertexShader:Qr,fragmentShader:yn,triangulation:Vt,blend:this.getBlend(),depth:{enable:!1}})]}},{key:"clearModels",value:function(){var l;(l=this.dataTexture)===null||l===void 0||l.destroy()}},{key:"registerBuiltinAttributes",value:function(){}}]),a}(ba),Bt={fill:un,line:af,extrude:tn,text:yh,point_fill:tl,point_image:ff,point_normal:Yl,point_extrude:lf},gr=Bt;function qr(n){var c=Ln();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function Ln(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Rr=function(n){(0,Dr.Z)(a,n);var c=qr(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","PolygonLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new gr[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getModelType",value:function(){var l,p=this.styleAttributeService.getLayerStyleAttribute("shape"),_=p==null||(l=p.scale)===null||l===void 0?void 0:l.field;return _==="fill"?"fill":_==="extrude"?"extrude":_==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var l=this.getEncodedData(),p=this.getLayerConfig(),_=p.shape2d,A=p.shape3d,M=this.iconService.getIconMap(),L=l.find(function(G){return G.hasOwnProperty("shape")});if(L){var Y=L.shape;return Y==="dot"?"point_normal":(_==null?void 0:_.indexOf(Y))!==-1?"point_fill":(A==null?void 0:A.indexOf(Y))!==-1?"point_extrude":M.hasOwnProperty(Y)?"point_image":"text"}else return"fill"}}]),a}(eo);function wn(n){var c=cn();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function cn(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var pi=`precision mediump float;
uniform float u_opacity: 1.0;
uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;
uniform float u_min;
uniform float u_max;
uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
varying vec2 v_texCoord;

void main() {

  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;
  if (value == u_noDataValue)
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))
    gl_FragColor = vec4(0, 0, 0, 0);
  else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);
    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));
    gl_FragColor = color;
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
  }


}
`,kr=`precision highp float;
uniform mat4 u_ModelMatrix;
uniform mat4 u_Mvp;
attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));
   } else {
      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));
   }
}
`,Ar=function(n){(0,Dr.Z)(a,n);var c=wn(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"texture",void 0),(0,H.Z)((0,et.Z)(s),"colorTexture",void 0),s}return(0,vr.Z)(a,[{key:"getUninforms",value:function(){var l=this.layer.getLayerConfig(),p=l.opacity,_=p===void 0?1:p,A=l.clampLow,M=A===void 0?!0:A,L=l.clampHigh,Y=L===void 0?!0:L,G=l.noDataValue,ve=G===void 0?-9999999:G,Fe=l.domain,ht=Fe===void 0?[0,1]:Fe;return this.updateColorTexure(),{u_opacity:_||1,u_texture:this.texture,u_domain:ht,u_clampLow:M,u_clampHigh:typeof Y!="undefined"?Y:M,u_noDataValue:ve,u_colorTexture:this.colorTexture}}},{key:"initModels",value:function(){var l=this.layer.getSource(),p=this.rendererService.createTexture2D,_=l.data.dataArray[0];this.texture=p({data:_.data,width:_.width,height:_.height,format:U.gl.LUMINANCE,type:U.gl.FLOAT});var A=this.layer.getLayerConfig(),M=A.rampColors,L=(0,Ke.Cl)(M);return this.colorTexture=p({data:L.data,width:L.width,height:L.height,flipY:!1}),[this.layer.buildLayerModel({moduleName:"RasterImageData",vertexShader:kr,fragmentShader:pi,triangulation:Er,primitive:U.gl.TRIANGLES,depth:{enable:!1},blend:this.getBlend()})]}},{key:"buildModels",value:function(){return this.initModels()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:U.AttributeType.Attribute,descriptor:{name:"a_Uv",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:2,update:function(p,_,A,M){return[A[3],A[4]]}}})}},{key:"updateColorTexure",value:function(){var l=this.rendererService.createTexture2D,p=this.layer.getLayerConfig(),_=p.rampColors,A=(0,Ke.Cl)(_);this.colorTexture=l({data:A.data,width:A.width,height:A.height,flipY:!1})}}]),a}(ba),Kn={raster:Ar,raster3d:Ar},bn=Kn;function an(n){var c=An();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function An(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}var Tn=function(n){(0,Dr.Z)(a,n);var c=an(a);function a(){var s;(0,ft.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),(0,H.Z)((0,et.Z)(s),"type","RasterLayer"),s}return(0,vr.Z)(a,[{key:"buildModels",value:function(){var l=this.getModelType();this.layerModel=new bn[l](this),this.models=this.layerModel.initModels()}},{key:"rebuildModels",value:function(){this.models=this.layerModel.buildModels()}},{key:"getConfigSchema",value:function(){return{properties:{opacity:{type:"number",minimum:0,maximum:1}}}}},{key:"getDefaultConfig",value:function(){var l=this.getModelType(),p={raster:{},raster3d:{}};return p[l]}},{key:"getModelType",value:function(){return"raster"}}]),a}(eo),ji,Bi,Mn,Pn,wi,Di,la,Mo,Io;function ca(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Ns(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?ca(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):ca(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var mo=(ji=(0,sa.b2)(),Bi=(0,sa.f3)(U.vK.IGlobalConfigService),Mn=(0,sa.f3)(U.vK.IMapService),Pn=(0,sa.f3)(U.vK.IFontService),ji(wi=(Di=function(){function n(){(0,ft.Z)(this,n),(0,bo.Z)(this,"configService",la,this),(0,bo.Z)(this,"mapService",Mo,this),(0,bo.Z)(this,"fontService",Io,this)}return(0,vr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("DataMappingPlugin",function(){l.generateMaping(a,{styleAttributeService:p})}),a.hooks.beforeRenderData.tap("DataMappingPlugin",function(){return a.dataState.dataMappingNeedUpdate=!1,l.generateMaping(a,{styleAttributeService:p}),!0}),a.hooks.beforeRender.tap("DataMappingPlugin",function(){if(!a.layerModelNeedUpdate){var _=p.getLayerStyleAttributes()||[],A=p.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,L=_.filter(function(G){return G.needRemapping}),Y=M;A!=null&&A.needRemapping&&A!==null&&A!==void 0&&A.scale&&(Y=M.filter(function(G){return l.applyAttributeMapping(A,G)[0]})),L.length&&(A!=null&&A.needRemapping?(a.setEncodedData(l.mapping(_,Y)),A.needRemapping=!1):a.setEncodedData(l.mapping(L,Y,a.getEncodedData())),a.emit("remapping",null))}})}},{key:"generateMaping",value:function(a,s){var l=this,p=s.styleAttributeService,_=p.getLayerStyleAttributes()||[],A=p.getLayerStyleAttribute("filter"),M=a.getSource().data.dataArray,L=M;A!=null&&A.scale&&(L=M.filter(function(Y){return l.applyAttributeMapping(A,Y)[0]})),a.setEncodedData(this.mapping(_,L))}},{key:"mapping",value:function(a,s,l){var p=this,_=s.map(function(A,M){var L=l?l[M]:{},Y=Ns({id:A._id,coordinates:A.coordinates},L);return a.filter(function(G){return G.scale!==void 0}).forEach(function(G){var ve=p.applyAttributeMapping(G,A);G.needRemapping=!1,G.name==="color"&&(ve=ve.map(function(Fe){return(0,Ke.CI)(Fe)})),Y[G.name]=Array.isArray(ve)&&ve.length===1?ve[0]:ve,G.name==="shape"&&(Y.shape=p.fontService.getIconFontKey(Y[G.name]))}),Y});return _.length>0&&this.mapService.version==="GAODE2.x"&&(typeof _[0].coordinates[0]=="number"?_.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=La()(A.coordinates),A.coordinates=p.mapService.lngLatToCoord(A.coordinates)}):_.filter(function(A){return!A.originCoordinates}).map(function(A){A.version="GAODE2.x",A.originCoordinates=La()(A.coordinates),A.coordinates=p.mapService.lngLatToCoords(A.coordinates)})),_}},{key:"applyAttributeMapping",value:function(a,s){var l;if(!a.scale)return[];var p=(a==null||(l=a.scale)===null||l===void 0?void 0:l.scalers)||[],_=[];return p.forEach(function(A){var M,L=A.field;(s.hasOwnProperty(L)||((M=a.scale)===null||M===void 0?void 0:M.type)==="variable")&&_.push(s[L])}),a.mapping?a.mapping(_):[]}}]),n}(),la=(0,Qa.Z)(Di.prototype,"configService",[Bi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Mo=(0,Qa.Z)(Di.prototype,"mapService",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Io=(0,Qa.Z)(Di.prototype,"fontService",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Di))||wi),ds,Xo,Cs=(ds=(0,sa.b2)(),ds(Xo=function(){function n(){(0,ft.Z)(this,n),(0,H.Z)(this,"mapService",void 0)}return(0,vr.Z)(n,[{key:"apply",value:function(a){var s=this;this.mapService=a.getContainer().get(U.vK.IMapService),a.hooks.init.tap("DataSourcePlugin",function(){var l=a.getSource();if(!l){var p=a.sourceOption||{data:Ro,options:gl},_=p.data,A=p.options;a.setSource(new Ta(_,A))}s.updateClusterData(a)}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){var l=s.updateClusterData(a),p=a.dataState.dataSourceNeedUpdate;return a.dataState.dataSourceNeedUpdate=!1,l||p})}},{key:"updateClusterData",value:function(a){var s=a.getSource(),l=s.cluster,p=s.clusterOptions,_=p.zoom,A=_===void 0?0:_,M=p.maxZoom,L=M===void 0?16:M,Y=this.mapService.getZoom()-1,G=a.dataState.dataSourceNeedUpdate;return l&&(G||Math.abs(A-Y)>1)&&L>A?(s.updateClusterData(Math.floor(Y)),!0):!1}}]),n}())||Xo),zs=S(44908),ws=S.n(zs),Yo=S(14293),Hi=S.n(Yo);function Ko(n,c){return n<c?-1:n>c?1:n>=c?0:NaN}function Ma(n){return n.length===1&&(n=Zo(n)),{left:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)<0?s=p+1:l=p}return s},right:function(c,a,s,l){for(s==null&&(s=0),l==null&&(l=c.length);s<l;){var p=s+l>>>1;n(c[p],a)>0?l=p:s=p+1}return s}}}function Zo(n){return function(c,a){return Ko(n(c),a)}}var Li=Ma(Ko),va=Li.right,fo=Li.left,go=va;function Pl(n,c){var a=n.length,s=-1,l,p,_;if(c==null){for(;++s<a;)if((l=n[s])!=null&&l>=l)for(p=_=l;++s<a;)(l=n[s])!=null&&(p>l&&(p=l),_<l&&(_=l))}else for(;++s<a;)if((l=c(n[s],s,n))!=null&&l>=l)for(p=_=l;++s<a;)(l=c(n[s],s,n))!=null&&(p>l&&(p=l),_<l&&(_=l));return[p,_]}var Ge=Array.prototype,cr=Ge.slice,Jt=Ge.map,Fn=Math.sqrt(50),fa=Math.sqrt(10),ke=Math.sqrt(2);function Se(n,c,a){var s,l=-1,p,_,A;if(c=+c,n=+n,a=+a,n===c&&a>0)return[n];if((s=c<n)&&(p=n,n=c,c=p),(A=it(n,c,a))===0||!isFinite(A))return[];if(A>0)for(n=Math.ceil(n/A),c=Math.floor(c/A),_=new Array(p=Math.ceil(c-n+1));++l<p;)_[l]=(n+l)*A;else for(n=Math.floor(n*A),c=Math.ceil(c*A),_=new Array(p=Math.ceil(n-c+1));++l<p;)_[l]=(n-l)/A;return s&&_.reverse(),_}function it(n,c,a){var s=(c-n)/Math.max(0,a),l=Math.floor(Math.log(s)/Math.LN10),p=s/Math.pow(10,l);return l>=0?(p>=Fn?10:p>=fa?5:p>=ke?2:1)*Math.pow(10,l):-Math.pow(10,-l)/(p>=Fn?10:p>=fa?5:p>=ke?2:1)}function Ot(n,c,a){var s=Math.abs(c-n)/Math.max(0,a),l=Math.pow(10,Math.floor(Math.log(s)/Math.LN10)),p=s/l;return p>=Fn?l*=10:p>=fa?l*=5:p>=ke&&(l*=2),c<n?-l:l}function sr(){var n=identity,c=extent,a=sturges;function s(l){var p,_=l.length,A,M=new Array(_);for(p=0;p<_;++p)M[p]=n(l[p],p,l);var L=c(M),Y=L[0],G=L[1],ve=a(M,Y,G);Array.isArray(ve)||(ve=tickStep(Y,G,ve),ve=range(Math.ceil(Y/ve)*ve,G,ve));for(var Fe=ve.length;ve[0]<=Y;)ve.shift(),--Fe;for(;ve[Fe-1]>G;)ve.pop(),--Fe;var ht=new Array(Fe+1),It;for(p=0;p<=Fe;++p)It=ht[p]=[],It.x0=p>0?ve[p-1]:Y,It.x1=p<Fe?ve[p]:G;for(p=0;p<_;++p)A=M[p],Y<=A&&A<=G&&ht[bisect(ve,A,0,Fe)].push(l[p]);return ht}return s.value=function(l){return arguments.length?(n=typeof l=="function"?l:constant(l),s):n},s.domain=function(l){return arguments.length?(c=typeof l=="function"?l:constant([l[0],l[1]]),s):c},s.thresholds=function(l){return arguments.length?(a=typeof l=="function"?l:Array.isArray(l)?constant(slice.call(l)):constant(l),s):a},s}function _t(n,c,a){return n=map.call(n,number).sort(ascending),Math.ceil((a-c)/(2*(quantile(n,.75)-quantile(n,.25))*Math.pow(n.length,-1/3)))}function dt(n){return n===null?NaN:+n}function st(n,c,a){if(a==null&&(a=dt),!!(s=n.length)){if((c=+c)<=0||s<2)return+a(n[0],0,n);if(c>=1)return+a(n[s-1],s-1,n);var s,l=(s-1)*c,p=Math.floor(l),_=+a(n[p],p,n),A=+a(n[p+1],p+1,n);return _+(A-_)*(l-p)}}var Me="$";function nt(){}nt.prototype=Ne.prototype={constructor:nt,has:function(n){return Me+n in this},get:function(n){return this[Me+n]},set:function(n,c){return this[Me+n]=c,this},remove:function(n){var c=Me+n;return c in this&&delete this[c]},clear:function(){for(var n in this)n[0]===Me&&delete this[n]},keys:function(){var n=[];for(var c in this)c[0]===Me&&n.push(c.slice(1));return n},values:function(){var n=[];for(var c in this)c[0]===Me&&n.push(this[c]);return n},entries:function(){var n=[];for(var c in this)c[0]===Me&&n.push({key:c.slice(1),value:this[c]});return n},size:function(){var n=0;for(var c in this)c[0]===Me&&++n;return n},empty:function(){for(var n in this)if(n[0]===Me)return!1;return!0},each:function(n){for(var c in this)c[0]===Me&&n(this[c],c.slice(1),this)}};function Ne(n,c){var a=new nt;if(n instanceof nt)n.each(function(A,M){a.set(M,A)});else if(Array.isArray(n)){var s=-1,l=n.length,p;if(c==null)for(;++s<l;)a.set(s,n[s]);else for(;++s<l;)a.set(c(p=n[s],s,n),p)}else if(n)for(var _ in n)a.set(_,n[_]);return a}var Lt=Ne;function Kt(){var n=[],c=[],a,s,l;function p(A,M,L,Y){if(M>=n.length)return a!=null&&A.sort(a),s!=null?s(A):A;for(var G=-1,ve=A.length,Fe=n[M++],ht,It,pr=map(),Cr,Vr=L();++G<ve;)(Cr=pr.get(ht=Fe(It=A[G])+""))?Cr.push(It):pr.set(ht,[It]);return pr.each(function(pn,gn){Y(Vr,gn,p(pn,M,L,Y))}),Vr}function _(A,M){if(++M>n.length)return A;var L,Y=c[M-1];return s!=null&&M>=n.length?L=A.entries():(L=[],A.each(function(G,ve){L.push({key:ve,values:_(G,M)})})),Y!=null?L.sort(function(G,ve){return Y(G.key,ve.key)}):L}return l={object:function(A){return p(A,0,Hr,mn)},map:function(A){return p(A,0,vn,On)},entries:function(A){return _(p(A,0,vn,On),0)},key:function(A){return n.push(A),l},sortKeys:function(A){return c[n.length-1]=A,l},sortValues:function(A){return a=A,l},rollup:function(A){return s=A,l}}}function Hr(){return{}}function mn(n,c,a){n[c]=a}function vn(){return map()}function On(n,c,a){n.set(c,a)}function fn(){}var zn=Lt.prototype;fn.prototype=Bn.prototype={constructor:fn,has:zn.has,add:function(n){return n+="",this[Me+n]=n,this},remove:zn.remove,clear:zn.clear,values:zn.keys,size:zn.size,empty:zn.empty,each:zn.each};function Bn(n,c){var a=new fn;if(n instanceof fn)n.each(function(p){a.add(p)});else if(n){var s=-1,l=n.length;if(c==null)for(;++s<l;)a.add(n[s]);else for(;++s<l;)a.add(c(n[s],s,n))}return a}var Jn=null,$n=Array.prototype,Vn=$n.map,li=$n.slice;function Ia(n,c){switch(arguments.length){case 0:break;case 1:this.range(n);break;default:this.range(c).domain(n);break}return this}function rs(n,c){switch(arguments.length){case 0:break;case 1:this.interpolator(n);break;default:this.interpolator(c).domain(n);break}return this}var Ml={name:"implicit"};function $a(){var n=Lt(),c=[],a=[],s=Ml;function l(p){var _=p+"",A=n.get(_);if(!A){if(s!==Ml)return s;n.set(_,A=c.push(p))}return a[(A-1)%a.length]}return l.domain=function(p){if(!arguments.length)return c.slice();c=[],n=Lt();for(var _=-1,A=p.length,M,L;++_<A;)n.has(L=(M=p[_])+"")||n.set(L,c.push(M));return l},l.range=function(p){return arguments.length?(a=li.call(p),l):a.slice()},l.unknown=function(p){return arguments.length?(s=p,l):s},l.copy=function(){return $a(c,a).unknown(s)},Ia.apply(l,arguments),l}function Da(){var n=ordinal().unknown(void 0),c=n.domain,a=n.range,s=[0,1],l,p,_=!1,A=0,M=0,L=.5;delete n.unknown;function Y(){var G=c().length,ve=s[1]<s[0],Fe=s[ve-0],ht=s[1-ve];l=(ht-Fe)/Math.max(1,G-A+M*2),_&&(l=Math.floor(l)),Fe+=(ht-Fe-l*(G-A))*L,p=l*(1-A),_&&(Fe=Math.round(Fe),p=Math.round(p));var It=sequence(G).map(function(pr){return Fe+l*pr});return a(ve?It.reverse():It)}return n.domain=function(G){return arguments.length?(c(G),Y()):c()},n.range=function(G){return arguments.length?(s=[+G[0],+G[1]],Y()):s.slice()},n.rangeRound=function(G){return s=[+G[0],+G[1]],_=!0,Y()},n.bandwidth=function(){return p},n.step=function(){return l},n.round=function(G){return arguments.length?(_=!!G,Y()):_},n.padding=function(G){return arguments.length?(A=Math.min(1,M=+G),Y()):A},n.paddingInner=function(G){return arguments.length?(A=Math.min(1,G),Y()):A},n.paddingOuter=function(G){return arguments.length?(M=+G,Y()):M},n.align=function(G){return arguments.length?(L=Math.max(0,Math.min(1,G)),Y()):L},n.copy=function(){return Da(c(),s).round(_).paddingInner(A).paddingOuter(M).align(L)},initRange.apply(Y(),arguments)}function Qs(n){var c=n.copy;return n.padding=n.paddingOuter,delete n.paddingInner,delete n.paddingOuter,n.copy=function(){return Qs(c())},n}function $l(){return Qs(Da.apply(null,arguments).paddingInner(1))}var rl=S(26257),_h=S(73626);function vl(n,c){return n=+n,c=+c,function(a){return Math.round(n*(1-a)+c*a)}}function Wf(n){return function(){return n}}function Vc(n){return+n}var pf=[0,1];function Il(n){return n}function ns(n,c){return(c-=n=+n)?function(a){return(a-n)/c}:Wf(isNaN(c)?NaN:.5)}function Xf(n){var c=n[0],a=n[n.length-1],s;return c>a&&(s=c,c=a,a=s),function(l){return Math.max(c,Math.min(a,l))}}function Gc(n,c,a){var s=n[0],l=n[1],p=c[0],_=c[1];return l<s?(s=ns(l,s),p=a(_,p)):(s=ns(s,l),p=a(p,_)),function(A){return p(s(A))}}function Jh(n,c,a){var s=Math.min(n.length,c.length)-1,l=new Array(s),p=new Array(s),_=-1;for(n[s]<n[0]&&(n=n.slice().reverse(),c=c.slice().reverse());++_<s;)l[_]=ns(n[_],n[_+1]),p[_]=a(c[_],c[_+1]);return function(A){var M=go(n,A,1,s)-1;return p[M](l[M](A))}}function Af(n,c){return c.domain(n.domain()).range(n.range()).interpolate(n.interpolate()).clamp(n.clamp()).unknown(n.unknown())}function xh(){var n=pf,c=pf,a=rl.Z,s,l,p,_=Il,A,M,L;function Y(){return A=Math.min(n.length,c.length)>2?Jh:Gc,M=L=null,G}function G(ve){return isNaN(ve=+ve)?p:(M||(M=A(n.map(s),c,a)))(s(_(ve)))}return G.invert=function(ve){return _(l((L||(L=A(c,n.map(s),_h.Z)))(ve)))},G.domain=function(ve){return arguments.length?(n=Vn.call(ve,Vc),_===Il||(_=Xf(n)),Y()):n.slice()},G.range=function(ve){return arguments.length?(c=li.call(ve),Y()):c.slice()},G.rangeRound=function(ve){return c=li.call(ve),a=vl,Y()},G.clamp=function(ve){return arguments.length?(_=ve?Xf(n):Il,G):_!==Il},G.interpolate=function(ve){return arguments.length?(a=ve,Y()):a},G.unknown=function(ve){return arguments.length?(p=ve,G):p},function(ve,Fe){return s=ve,l=Fe,Y()}}function Tf(n,c){return xh()(n,c)}var Hc=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function bh(n){if(!(c=Hc.exec(n)))throw new Error("invalid format: "+n);var c;return new Qh({fill:c[1],align:c[2],sign:c[3],symbol:c[4],zero:c[5],width:c[6],comma:c[7],precision:c[8]&&c[8].slice(1),trim:c[9],type:c[10]})}bh.prototype=Qh.prototype;function Qh(n){this.fill=n.fill===void 0?" ":n.fill+"",this.align=n.align===void 0?">":n.align+"",this.sign=n.sign===void 0?"-":n.sign+"",this.symbol=n.symbol===void 0?"":n.symbol+"",this.zero=!!n.zero,this.width=n.width===void 0?void 0:+n.width,this.comma=!!n.comma,this.precision=n.precision===void 0?void 0:+n.precision,this.trim=!!n.trim,this.type=n.type===void 0?"":n.type+""}Qh.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Pd(n){return Math.abs(n=Math.round(n))>=1e21?n.toLocaleString("en").replace(/,/g,""):n.toString(10)}function vs(n,c){if((a=(n=c?n.toExponential(c-1):n.toExponential()).indexOf("e"))<0)return null;var a,s=n.slice(0,a);return[s.length>1?s[0]+s.slice(2):s,+n.slice(a+1)]}function Ol(n){return n=vs(Math.abs(n)),n?n[1]:NaN}function Yp(n,c){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(Ol(c)/3)))*3-Ol(Math.abs(n)))}function e(n,c){return function(a,s){for(var l=a.length,p=[],_=0,A=n[0],M=0;l>0&&A>0&&(M+A+1>s&&(A=Math.max(1,s-M)),p.push(a.substring(l-=A,l+A)),!((M+=A+1)>s));)A=n[_=(_+1)%n.length];return p.reverse().join(c)}}function t(n){return function(c){return c.replace(/[0-9]/g,function(a){return n[+a]})}}function r(n){e:for(var c=n.length,a=1,s=-1,l;a<c;++a)switch(n[a]){case".":s=l=a;break;case"0":s===0&&(s=a),l=a;break;default:if(!+n[a])break e;s>0&&(s=0);break}return s>0?n.slice(0,s)+n.slice(l+1):n}var f;function v(n,c){var a=vs(n,c);if(!a)return n+"";var s=a[0],l=a[1],p=l-(f=Math.max(-8,Math.min(8,Math.floor(l/3)))*3)+1,_=s.length;return p===_?s:p>_?s+new Array(p-_+1).join("0"):p>0?s.slice(0,p)+"."+s.slice(p):"0."+new Array(1-p).join("0")+vs(n,Math.max(0,c+p-1))[0]}function g(n,c){var a=vs(n,c);if(!a)return n+"";var s=a[0],l=a[1];return l<0?"0."+new Array(-l).join("0")+s:s.length>l+1?s.slice(0,l+1)+"."+s.slice(l+1):s+new Array(l-s.length+2).join("0")}var x={"%":function(n,c){return(n*100).toFixed(c)},b:function(n){return Math.round(n).toString(2)},c:function(n){return n+""},d:Pd,e:function(n,c){return n.toExponential(c)},f:function(n,c){return n.toFixed(c)},g:function(n,c){return n.toPrecision(c)},o:function(n){return Math.round(n).toString(8)},p:function(n,c){return g(n*100,c)},r:g,s:v,X:function(n){return Math.round(n).toString(16).toUpperCase()},x:function(n){return Math.round(n).toString(16)}};function P(n){return n}var D=Array.prototype.map,Z=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function W(n){var c=n.grouping===void 0||n.thousands===void 0?P:e(D.call(n.grouping,Number),n.thousands+""),a=n.currency===void 0?"":n.currency[0]+"",s=n.currency===void 0?"":n.currency[1]+"",l=n.decimal===void 0?".":n.decimal+"",p=n.numerals===void 0?P:t(D.call(n.numerals,String)),_=n.percent===void 0?"%":n.percent+"",A=n.minus===void 0?"-":n.minus+"",M=n.nan===void 0?"NaN":n.nan+"";function L(G){G=bh(G);var ve=G.fill,Fe=G.align,ht=G.sign,It=G.symbol,pr=G.zero,Cr=G.width,Vr=G.comma,pn=G.precision,gn=G.trim,Dn=G.type;Dn==="n"?(Vr=!0,Dn="g"):x[Dn]||(pn===void 0&&(pn=12),gn=!0,Dn="g"),(pr||ve==="0"&&Fe==="=")&&(pr=!0,ve="0",Fe="=");var Yn=It==="$"?a:It==="#"&&/[boxX]/.test(Dn)?"0"+Dn.toLowerCase():"",Qn=It==="$"?s:/[%p]/.test(Dn)?_:"",Si=x[Dn],qi=/[defgprs%]/.test(Dn);pn=pn===void 0?6:/[gprs]/.test(Dn)?Math.max(1,Math.min(21,pn)):Math.max(0,Math.min(20,pn));function _a(gi){var Aa=Yn,Xa=Qn,pu,kf,dp;if(Dn==="c")Xa=Si(gi)+Xa,gi="";else{gi=+gi;var vp=gi<0||1/gi<0;if(gi=isNaN(gi)?M:Si(Math.abs(gi),pn),gn&&(gi=r(gi)),vp&&+gi==0&&ht!=="+"&&(vp=!1),Aa=(vp?ht==="("?ht:A:ht==="-"||ht==="("?"":ht)+Aa,Xa=(Dn==="s"?Z[8+f/3]:"")+Xa+(vp&&ht==="("?")":""),qi){for(pu=-1,kf=gi.length;++pu<kf;)if(dp=gi.charCodeAt(pu),48>dp||dp>57){Xa=(dp===46?l+gi.slice(pu+1):gi.slice(pu))+Xa,gi=gi.slice(0,pu);break}}}Vr&&!pr&&(gi=c(gi,Infinity));var mp=Aa.length+gi.length+Xa.length,Jc=mp<Cr?new Array(Cr-mp+1).join(ve):"";switch(Vr&&pr&&(gi=c(Jc+gi,Jc.length?Cr-Xa.length:Infinity),Jc=""),Fe){case"<":gi=Aa+gi+Xa+Jc;break;case"=":gi=Aa+Jc+gi+Xa;break;case"^":gi=Jc.slice(0,mp=Jc.length>>1)+Aa+gi+Xa+Jc.slice(mp);break;default:gi=Jc+Aa+gi+Xa;break}return p(gi)}return _a.toString=function(){return G+""},_a}function Y(G,ve){var Fe=L((G=bh(G),G.type="f",G)),ht=Math.max(-8,Math.min(8,Math.floor(Ol(ve)/3)))*3,It=Math.pow(10,-ht),pr=Z[8+ht/3];return function(Cr){return Fe(It*Cr)+pr}}return{format:L,formatPrefix:Y}}var te,fe,xe;Ve({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function Ve(n){return te=W(n),fe=te.format,xe=te.formatPrefix,te}function We(n,c){return n=Math.abs(n),c=Math.abs(c)-n,Math.max(0,Ol(c)-Ol(n))+1}function yt(n){return Math.max(0,-Ol(Math.abs(n)))}function rt(n,c,a,s){var l=Ot(n,c,a),p;switch(s=bh(s==null?",f":s),s.type){case"s":{var _=Math.max(Math.abs(n),Math.abs(c));return s.precision==null&&!isNaN(p=Yp(l,_))&&(s.precision=p),xe(s,_)}case"":case"e":case"g":case"p":case"r":{s.precision==null&&!isNaN(p=We(l,Math.max(Math.abs(n),Math.abs(c))))&&(s.precision=p-(s.type==="e"));break}case"f":case"%":{s.precision==null&&!isNaN(p=yt(l))&&(s.precision=p-(s.type==="%")*2);break}}return fe(s)}function Pt(n){var c=n.domain;return n.ticks=function(a){var s=c();return Se(s[0],s[s.length-1],a==null?10:a)},n.tickFormat=function(a,s){var l=c();return rt(l[0],l[l.length-1],a==null?10:a,s)},n.nice=function(a){a==null&&(a=10);var s=c(),l=0,p=s.length-1,_=s[l],A=s[p],M;return A<_&&(M=_,_=A,A=M,M=l,l=p,p=M),M=it(_,A,a),M>0?(_=Math.floor(_/M)*M,A=Math.ceil(A/M)*M,M=it(_,A,a)):M<0&&(_=Math.ceil(_*M)/M,A=Math.floor(A*M)/M,M=it(_,A,a)),M>0?(s[l]=Math.floor(_/M)*M,s[p]=Math.ceil(A/M)*M,c(s)):M<0&&(s[l]=Math.ceil(_*M)/M,s[p]=Math.floor(A*M)/M,c(s)),n},n}function Xt(){var n=Tf(Il,Il);return n.copy=function(){return Af(n,Xt())},Ia.apply(n,arguments),Pt(n)}function hr(n){var c;function a(s){return isNaN(s=+s)?c:s}return a.invert=a,a.domain=a.range=function(s){return arguments.length?(n=Vn.call(s,Vc),a):n.slice()},a.unknown=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return hr(n).unknown(c)},n=arguments.length?Vn.call(n,Vc):[0,1],Pt(a)}function yr(n,c){n=n.slice();var a=0,s=n.length-1,l=n[a],p=n[s],_;return p<l&&(_=a,a=s,s=_,_=l,l=p,p=_),n[a]=c.floor(l),n[s]=c.ceil(p),n}function Nr(n){return Math.log(n)}function ln(n){return Math.exp(n)}function Sn(n){return-Math.log(-n)}function fi(n){return-Math.exp(-n)}function Zn(n){return isFinite(n)?+("1e"+n):n<0?0:n}function di(n){return n===10?Zn:n===Math.E?Math.exp:function(c){return Math.pow(n,c)}}function Gn(n){return n===Math.E?Math.log:n===10&&Math.log10||n===2&&Math.log2||(n=Math.log(n),function(c){return Math.log(c)/n})}function ra(n){return function(c){return-n(-c)}}function ki(n){var c=n(Nr,ln),a=c.domain,s=10,l,p;function _(){return l=Gn(s),p=di(s),a()[0]<0?(l=ra(l),p=ra(p),n(Sn,fi)):n(Nr,ln),c}return c.base=function(A){return arguments.length?(s=+A,_()):s},c.domain=function(A){return arguments.length?(a(A),_()):a()},c.ticks=function(A){var M=a(),L=M[0],Y=M[M.length-1],G;(G=Y<L)&&(ve=L,L=Y,Y=ve);var ve=l(L),Fe=l(Y),ht,It,pr,Cr=A==null?10:+A,Vr=[];if(!(s%1)&&Fe-ve<Cr){if(ve=Math.round(ve)-1,Fe=Math.round(Fe)+1,L>0){for(;ve<Fe;++ve)for(It=1,ht=p(ve);It<s;++It)if(pr=ht*It,!(pr<L)){if(pr>Y)break;Vr.push(pr)}}else for(;ve<Fe;++ve)for(It=s-1,ht=p(ve);It>=1;--It)if(pr=ht*It,!(pr<L)){if(pr>Y)break;Vr.push(pr)}}else Vr=Se(ve,Fe,Math.min(Fe-ve,Cr)).map(p);return G?Vr.reverse():Vr},c.tickFormat=function(A,M){if(M==null&&(M=s===10?".0e":","),typeof M!="function"&&(M=fe(M)),A===Infinity)return M;A==null&&(A=10);var L=Math.max(1,s*A/c.ticks().length);return function(Y){var G=Y/p(Math.round(l(Y)));return G*s<s-.5&&(G*=s),G<=L?M(Y):""}},c.nice=function(){return a(yr(a(),{floor:function(A){return p(Math.floor(l(A)))},ceil:function(A){return p(Math.ceil(l(A)))}}))},c}function ri(){var n=ki(xh()).domain([1,10]);return n.copy=function(){return Af(n,ri()).base(n.base())},Ia.apply(n,arguments),n}function ma(n){return function(c){return Math.sign(c)*Math.log1p(Math.abs(c/n))}}function Ki(n){return function(c){return Math.sign(c)*Math.expm1(Math.abs(c))*n}}function wa(n){var c=1,a=n(ma(c),Ki(c));return a.constant=function(s){return arguments.length?n(ma(c=+s),Ki(c)):c},linearish(a)}function mi(){var n=wa(transformer());return n.copy=function(){return copy(n,mi()).constant(n.constant())},initRange.apply(n,arguments)}function ka(n){return function(c){return c<0?-Math.pow(-c,n):Math.pow(c,n)}}function Oo(n){return n<0?-Math.sqrt(-n):Math.sqrt(n)}function $o(n){return n<0?-n*n:n*n}function Uo(n){var c=n(Il,Il),a=1;function s(){return a===1?n(Il,Il):a===.5?n(Oo,$o):n(ka(a),ka(1/a))}return c.exponent=function(l){return arguments.length?(a=+l,s()):a},Pt(c)}function Eo(){var n=Uo(xh());return n.copy=function(){return Af(n,Eo()).exponent(n.exponent())},Ia.apply(n,arguments),n}function is(){return Eo.apply(null,arguments).exponent(.5)}function As(){var n=[],c=[],a=[],s;function l(){var _=0,A=Math.max(1,c.length);for(a=new Array(A-1);++_<A;)a[_-1]=st(n,_/A);return p}function p(_){return isNaN(_=+_)?s:c[go(a,_)]}return p.invertExtent=function(_){var A=c.indexOf(_);return A<0?[NaN,NaN]:[A>0?a[A-1]:n[0],A<a.length?a[A]:n[n.length-1]]},p.domain=function(_){if(!arguments.length)return n.slice();n=[];for(var A=0,M=_.length,L;A<M;++A)L=_[A],L!=null&&!isNaN(L=+L)&&n.push(L);return n.sort(Ko),l()},p.range=function(_){return arguments.length?(c=li.call(_),l()):c.slice()},p.unknown=function(_){return arguments.length?(s=_,p):s},p.quantiles=function(){return a.slice()},p.copy=function(){return As().domain(n).range(c).unknown(s)},Ia.apply(p,arguments)}function Ts(){var n=0,c=1,a=1,s=[.5],l=[0,1],p;function _(M){return M<=M?l[go(s,M,0,a)]:p}function A(){var M=-1;for(s=new Array(a);++M<a;)s[M]=((M+1)*c-(M-a)*n)/(a+1);return _}return _.domain=function(M){return arguments.length?(n=+M[0],c=+M[1],A()):[n,c]},_.range=function(M){return arguments.length?(a=(l=li.call(M)).length-1,A()):l.slice()},_.invertExtent=function(M){var L=l.indexOf(M);return L<0?[NaN,NaN]:L<1?[n,s[0]]:L>=a?[s[a-1],c]:[s[L-1],s[L]]},_.unknown=function(M){return arguments.length&&(p=M),_},_.thresholds=function(){return s.slice()},_.copy=function(){return Ts().domain([n,c]).range(l).unknown(p)},Ia.apply(Pt(_),arguments)}function hu(){var n=[.5],c=[0,1],a,s=1;function l(p){return p<=p?c[go(n,p,0,s)]:a}return l.domain=function(p){return arguments.length?(n=li.call(p),s=Math.min(n.length,c.length-1),l):n.slice()},l.range=function(p){return arguments.length?(c=li.call(p),s=Math.min(n.length,c.length-1),l):c.slice()},l.invertExtent=function(p){var _=c.indexOf(p);return[n[_-1],n[_]]},l.unknown=function(p){return arguments.length?(a=p,l):a},l.copy=function(){return hu().domain(n).range(c).unknown(a)},Ia.apply(l,arguments)}var Ps=new Date,qs=new Date;function Ua(n,c,a,s){function l(p){return n(p=arguments.length===0?new Date:new Date(+p)),p}return l.floor=function(p){return n(p=new Date(+p)),p},l.ceil=function(p){return n(p=new Date(p-1)),c(p,1),n(p),p},l.round=function(p){var _=l(p),A=l.ceil(p);return p-_<A-p?_:A},l.offset=function(p,_){return c(p=new Date(+p),_==null?1:Math.floor(_)),p},l.range=function(p,_,A){var M=[],L;if(p=l.ceil(p),A=A==null?1:Math.floor(A),!(p<_)||!(A>0))return M;do M.push(L=new Date(+p)),c(p,A),n(p);while(L<p&&p<_);return M},l.filter=function(p){return Ua(function(_){if(_>=_)for(;n(_),!p(_);)_.setTime(_-1)},function(_,A){if(_>=_)if(A<0)for(;++A<=0;)for(;c(_,-1),!p(_););else for(;--A>=0;)for(;c(_,1),!p(_););})},a&&(l.count=function(p,_){return Ps.setTime(+p),qs.setTime(+_),n(Ps),n(qs),Math.floor(a(Ps,qs))},l.every=function(p){return p=Math.floor(p),!isFinite(p)||!(p>0)?null:p>1?l.filter(s?function(_){return s(_)%p==0}:function(_){return l.count(0,_)%p==0}):l}),l}var Ms=Ua(function(n){n.setMonth(0,1),n.setHours(0,0,0,0)},function(n,c){n.setFullYear(n.getFullYear()+c)},function(n,c){return c.getFullYear()-n.getFullYear()},function(n){return n.getFullYear()});Ms.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:Ua(function(c){c.setFullYear(Math.floor(c.getFullYear()/n)*n),c.setMonth(0,1),c.setHours(0,0,0,0)},function(c,a){c.setFullYear(c.getFullYear()+a*n)})};var oa=Ms,yo=Ms.range,Ja=Ua(function(n){n.setDate(1),n.setHours(0,0,0,0)},function(n,c){n.setMonth(n.getMonth()+c)},function(n,c){return c.getMonth()-n.getMonth()+(c.getFullYear()-n.getFullYear())*12},function(n){return n.getMonth()}),Oa=Ja,Gu=Ja.range,Zs=1e3,oo=6e4,as=36e5,eu=864e5,Fa=6048e5;function Hu(n){return Ua(function(c){c.setDate(c.getDate()-(c.getDay()+7-n)%7),c.setHours(0,0,0,0)},function(c,a){c.setDate(c.getDate()+a*7)},function(c,a){return(a-c-(a.getTimezoneOffset()-c.getTimezoneOffset())*oo)/Fa})}var Wu=Hu(0),Ll=Hu(1),os=Hu(2),Oc=Hu(3),Du=Hu(4),Yf=Hu(5),Pf=Hu(6),Sh=Wu.range,df=Ll.range,Eh=os.range,Pp=Oc.range,Ch=Du.range,qh=Yf.range,Mp=Pf.range,wh=Ua(function(n){n.setHours(0,0,0,0)},function(n,c){n.setDate(n.getDate()+c)},function(n,c){return(c-n-(c.getTimezoneOffset()-n.getTimezoneOffset())*oo)/eu},function(n){return n.getDate()-1}),vc=wh,ep=wh.range,Mf=Ua(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*Zs-n.getMinutes()*oo)},function(n,c){n.setTime(+n+c*as)},function(n,c){return(c-n)/as},function(n){return n.getHours()}),vf=Mf,Ah=Mf.range,Th=Ua(function(n){n.setTime(n-n.getMilliseconds()-n.getSeconds()*Zs)},function(n,c){n.setTime(+n+c*oo)},function(n,c){return(c-n)/oo},function(n){return n.getMinutes()}),tp=Th,rp=Th.range,Kf=Ua(function(n){n.setTime(n-n.getMilliseconds())},function(n,c){n.setTime(+n+c*Zs)},function(n,c){return(c-n)/Zs},function(n){return n.getUTCSeconds()}),np=Kf,ip=Kf.range,mf=Ua(function(){},function(n,c){n.setTime(+n+c)},function(n,c){return c-n});mf.every=function(n){return n=Math.floor(n),!isFinite(n)||!(n>0)?null:n>1?Ua(function(c){c.setTime(Math.floor(c/n)*n)},function(c,a){c.setTime(+c+a*n)},function(c,a){return(a-c)/n}):mf};var Ph=mf,Ip=mf.range;function Jl(n){return Ua(function(c){c.setUTCDate(c.getUTCDate()-(c.getUTCDay()+7-n)%7),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCDate(c.getUTCDate()+a*7)},function(c,a){return(a-c)/Fa})}var Mh=Jl(0),Wc=Jl(1),Ih=Jl(2),If=Jl(3),Lc=Jl(4),$f=Jl(5),Op=Jl(6),Md=Mh.range,Kp=Wc.range,Id=Ih.range,$p=If.range,Yd=Lc.range,ap=$f.range,ms=Op.range,Ql=Ua(function(n){n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCDate(n.getUTCDate()+c)},function(n,c){return(c-n)/eu},function(n){return n.getUTCDate()-1}),Jp=Ql,Of=Ql.range,Oh=Ua(function(n){n.setUTCMonth(0,1),n.setUTCHours(0,0,0,0)},function(n,c){n.setUTCFullYear(n.getUTCFullYear()+c)},function(n,c){return c.getUTCFullYear()-n.getUTCFullYear()},function(n){return n.getUTCFullYear()});Oh.every=function(n){return!isFinite(n=Math.floor(n))||!(n>0)?null:Ua(function(c){c.setUTCFullYear(Math.floor(c.getUTCFullYear()/n)*n),c.setUTCMonth(0,1),c.setUTCHours(0,0,0,0)},function(c,a){c.setUTCFullYear(c.getUTCFullYear()+a*n)})};var Jf=Oh,Lp=Oh.range;function ql(n){if(0<=n.y&&n.y<100){var c=new Date(-1,n.m,n.d,n.H,n.M,n.S,n.L);return c.setFullYear(n.y),c}return new Date(n.y,n.m,n.d,n.H,n.M,n.S,n.L)}function Qf(n){if(0<=n.y&&n.y<100){var c=new Date(Date.UTC(-1,n.m,n.d,n.H,n.M,n.S,n.L));return c.setUTCFullYear(n.y),c}return new Date(Date.UTC(n.y,n.m,n.d,n.H,n.M,n.S,n.L))}function Xc(n,c,a){return{y:n,m:c,d:a,H:0,M:0,S:0,L:0}}function op(n){var c=n.dateTime,a=n.date,s=n.time,l=n.periods,p=n.days,_=n.shortDays,A=n.months,M=n.shortMonths,L=qf(l),Y=eh(l),G=qf(p),ve=eh(p),Fe=qf(_),ht=eh(_),It=qf(A),pr=eh(A),Cr=qf(M),Vr=eh(M),pn={a:vp,A:mp,b:Jc,B:Dy,c:null,d:up,e:up,f:ud,g:Dd,G:Fd,H:Bp,I:sd,j:Np,L:zp,m:Zp,M:ld,p:ky,q:Fy,Q:Jd,s:Qd,S:Dh,u:cd,U:lp,V:hd,w:Od,W:Ld,x:null,X:null,y:Rd,Y:kd,Z:Bd,"%":$d},gn={a:By,A:Ny,b:zy,B:Zy,c:null,d:pd,e:pd,f:vd,g:Hm,G:Xm,H:Dc,I:cp,j:dd,L:ih,m:Fm,M:Bm,p:Uy,q:jy,Q:Jd,s:Qd,S:Nm,u:zm,U:Zm,V:Um,w:jm,W:Vm,x:null,X:null,y:Gm,Y:Wm,Z:Ym,"%":$d},Dn={a:_a,A:gi,b:Aa,B:Xa,c:pu,d:Rf,e:Rf,f:kp,g:Rp,G:rd,H:Dp,I:Dp,j:nh,L:ad,m:rh,M:nd,p:qi,q:th,Q:Yc,s:od,S:id,u:ml,U:sp,V:td,w:ed,W:Rc,x:kf,X:dp,y:Rp,Y:rd,Z:Lf,"%":Fp};pn.x=Yn(a,pn),pn.X=Yn(s,pn),pn.c=Yn(c,pn),gn.x=Yn(a,gn),gn.X=Yn(s,gn),gn.c=Yn(c,gn);function Yn(zi,so){return function(Ao){var Hn=[],ec=-1,gs=0,mc=zi.length,gc,Bh,km;for(Ao instanceof Date||(Ao=new Date(+Ao));++ec<mc;)zi.charCodeAt(ec)===37&&(Hn.push(zi.slice(gs,ec)),(Bh=Lh[gc=zi.charAt(++ec)])!=null?gc=zi.charAt(++ec):Bh=gc==="e"?" ":"0",(km=so[gc])&&(gc=km(Ao,Bh)),Hn.push(gc),gs=ec+1);return Hn.push(zi.slice(gs,ec)),Hn.join("")}}function Qn(zi,so){return function(Ao){var Hn=Xc(1900,void 0,1),ec=Si(Hn,zi,Ao+="",0),gs,mc;if(ec!=Ao.length)return null;if("Q"in Hn)return new Date(Hn.Q);if("s"in Hn)return new Date(Hn.s*1e3+("L"in Hn?Hn.L:0));if(so&&!("Z"in Hn)&&(Hn.Z=0),"p"in Hn&&(Hn.H=Hn.H%12+Hn.p*12),Hn.m===void 0&&(Hn.m="q"in Hn?Hn.q:0),"V"in Hn){if(Hn.V<1||Hn.V>53)return null;"w"in Hn||(Hn.w=1),"Z"in Hn?(gs=Qf(Xc(Hn.y,0,1)),mc=gs.getUTCDay(),gs=mc>4||mc===0?Wc.ceil(gs):Wc(gs),gs=Jp.offset(gs,(Hn.V-1)*7),Hn.y=gs.getUTCFullYear(),Hn.m=gs.getUTCMonth(),Hn.d=gs.getUTCDate()+(Hn.w+6)%7):(gs=ql(Xc(Hn.y,0,1)),mc=gs.getDay(),gs=mc>4||mc===0?Ll.ceil(gs):Ll(gs),gs=vc.offset(gs,(Hn.V-1)*7),Hn.y=gs.getFullYear(),Hn.m=gs.getMonth(),Hn.d=gs.getDate()+(Hn.w+6)%7)}else("W"in Hn||"U"in Hn)&&("w"in Hn||(Hn.w="u"in Hn?Hn.u%7:"W"in Hn?1:0),mc="Z"in Hn?Qf(Xc(Hn.y,0,1)).getUTCDay():ql(Xc(Hn.y,0,1)).getDay(),Hn.m=0,Hn.d="W"in Hn?(Hn.w+6)%7+Hn.W*7-(mc+5)%7:Hn.w+Hn.U*7-(mc+6)%7);return"Z"in Hn?(Hn.H+=Hn.Z/100|0,Hn.M+=Hn.Z%100,Qf(Hn)):ql(Hn)}}function Si(zi,so,Ao,Hn){for(var ec=0,gs=so.length,mc=Ao.length,gc,Bh;ec<gs;){if(Hn>=mc)return-1;if(gc=so.charCodeAt(ec++),gc===37){if(gc=so.charAt(ec++),Bh=Dn[gc in Lh?so.charAt(ec++):gc],!Bh||(Hn=Bh(zi,Ao,Hn))<0)return-1}else if(gc!=Ao.charCodeAt(Hn++))return-1}return Hn}function qi(zi,so,Ao){var Hn=L.exec(so.slice(Ao));return Hn?(zi.p=Y[Hn[0].toLowerCase()],Ao+Hn[0].length):-1}function _a(zi,so,Ao){var Hn=Fe.exec(so.slice(Ao));return Hn?(zi.w=ht[Hn[0].toLowerCase()],Ao+Hn[0].length):-1}function gi(zi,so,Ao){var Hn=G.exec(so.slice(Ao));return Hn?(zi.w=ve[Hn[0].toLowerCase()],Ao+Hn[0].length):-1}function Aa(zi,so,Ao){var Hn=Cr.exec(so.slice(Ao));return Hn?(zi.m=Vr[Hn[0].toLowerCase()],Ao+Hn[0].length):-1}function Xa(zi,so,Ao){var Hn=It.exec(so.slice(Ao));return Hn?(zi.m=pr[Hn[0].toLowerCase()],Ao+Hn[0].length):-1}function pu(zi,so,Ao){return Si(zi,c,so,Ao)}function kf(zi,so,Ao){return Si(zi,a,so,Ao)}function dp(zi,so,Ao){return Si(zi,s,so,Ao)}function vp(zi){return _[zi.getDay()]}function mp(zi){return p[zi.getDay()]}function Jc(zi){return M[zi.getMonth()]}function Dy(zi){return A[zi.getMonth()]}function ky(zi){return l[+(zi.getHours()>=12)]}function Fy(zi){return 1+~~(zi.getMonth()/3)}function By(zi){return _[zi.getUTCDay()]}function Ny(zi){return p[zi.getUTCDay()]}function zy(zi){return M[zi.getUTCMonth()]}function Zy(zi){return A[zi.getUTCMonth()]}function Uy(zi){return l[+(zi.getUTCHours()>=12)]}function jy(zi){return 1+~~(zi.getUTCMonth()/3)}return{format:function(zi){var so=Yn(zi+="",pn);return so.toString=function(){return zi},so},parse:function(zi){var so=Qn(zi+="",!1);return so.toString=function(){return zi},so},utcFormat:function(zi){var so=Yn(zi+="",gn);return so.toString=function(){return zi},so},utcParse:function(zi){var so=Qn(zi+="",!0);return so.toString=function(){return zi},so}}}var Lh={"-":"",_:" ","0":"0"},tu=/^\s*\d+/,Qp=/^%/,Rh=/[\\^$*+?|[\]().{}]/g;function ho(n,c,a){var s=n<0?"-":"",l=(s?-n:n)+"",p=l.length;return s+(p<a?new Array(a-p+1).join(c)+l:l)}function qp(n){return n.replace(Rh,"\\$&")}function qf(n){return new RegExp("^(?:"+n.map(qp).join("|")+")","i")}function eh(n){for(var c={},a=-1,s=n.length;++a<s;)c[n[a].toLowerCase()]=a;return c}function ed(n,c,a){var s=tu.exec(c.slice(a,a+1));return s?(n.w=+s[0],a+s[0].length):-1}function ml(n,c,a){var s=tu.exec(c.slice(a,a+1));return s?(n.u=+s[0],a+s[0].length):-1}function sp(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.U=+s[0],a+s[0].length):-1}function td(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.V=+s[0],a+s[0].length):-1}function Rc(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.W=+s[0],a+s[0].length):-1}function rd(n,c,a){var s=tu.exec(c.slice(a,a+4));return s?(n.y=+s[0],a+s[0].length):-1}function Rp(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.y=+s[0]+(+s[0]>68?1900:2e3),a+s[0].length):-1}function Lf(n,c,a){var s=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(c.slice(a,a+6));return s?(n.Z=s[1]?0:-(s[2]+(s[3]||"00")),a+s[0].length):-1}function th(n,c,a){var s=tu.exec(c.slice(a,a+1));return s?(n.q=s[0]*3-3,a+s[0].length):-1}function rh(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.m=s[0]-1,a+s[0].length):-1}function Rf(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.d=+s[0],a+s[0].length):-1}function nh(n,c,a){var s=tu.exec(c.slice(a,a+3));return s?(n.m=0,n.d=+s[0],a+s[0].length):-1}function Dp(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.H=+s[0],a+s[0].length):-1}function nd(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.M=+s[0],a+s[0].length):-1}function id(n,c,a){var s=tu.exec(c.slice(a,a+2));return s?(n.S=+s[0],a+s[0].length):-1}function ad(n,c,a){var s=tu.exec(c.slice(a,a+3));return s?(n.L=+s[0],a+s[0].length):-1}function kp(n,c,a){var s=tu.exec(c.slice(a,a+6));return s?(n.L=Math.floor(s[0]/1e3),a+s[0].length):-1}function Fp(n,c,a){var s=Qp.exec(c.slice(a,a+1));return s?a+s[0].length:-1}function Yc(n,c,a){var s=tu.exec(c.slice(a));return s?(n.Q=+s[0],a+s[0].length):-1}function od(n,c,a){var s=tu.exec(c.slice(a));return s?(n.s=+s[0],a+s[0].length):-1}function up(n,c){return ho(n.getDate(),c,2)}function Bp(n,c){return ho(n.getHours(),c,2)}function sd(n,c){return ho(n.getHours()%12||12,c,2)}function Np(n,c){return ho(1+vc.count(oa(n),n),c,3)}function zp(n,c){return ho(n.getMilliseconds(),c,3)}function ud(n,c){return zp(n,c)+"000"}function Zp(n,c){return ho(n.getMonth()+1,c,2)}function ld(n,c){return ho(n.getMinutes(),c,2)}function Dh(n,c){return ho(n.getSeconds(),c,2)}function cd(n){var c=n.getDay();return c===0?7:c}function lp(n,c){return ho(Wu.count(oa(n)-1,n),c,2)}function fd(n){var c=n.getDay();return c>=4||c===0?Du(n):Du.ceil(n)}function hd(n,c){return n=fd(n),ho(Du.count(oa(n),n)+(oa(n).getDay()===4),c,2)}function Od(n){return n.getDay()}function Ld(n,c){return ho(Ll.count(oa(n)-1,n),c,2)}function Rd(n,c){return ho(n.getFullYear()%100,c,2)}function Dd(n,c){return n=fd(n),ho(n.getFullYear()%100,c,2)}function kd(n,c){return ho(n.getFullYear()%1e4,c,4)}function Fd(n,c){var a=n.getDay();return n=a>=4||a===0?Du(n):Du.ceil(n),ho(n.getFullYear()%1e4,c,4)}function Bd(n){var c=n.getTimezoneOffset();return(c>0?"-":(c*=-1,"+"))+ho(c/60|0,"0",2)+ho(c%60,"0",2)}function pd(n,c){return ho(n.getUTCDate(),c,2)}function Dc(n,c){return ho(n.getUTCHours(),c,2)}function cp(n,c){return ho(n.getUTCHours()%12||12,c,2)}function dd(n,c){return ho(1+Jp.count(Jf(n),n),c,3)}function ih(n,c){return ho(n.getUTCMilliseconds(),c,3)}function vd(n,c){return ih(n,c)+"000"}function Fm(n,c){return ho(n.getUTCMonth()+1,c,2)}function Bm(n,c){return ho(n.getUTCMinutes(),c,2)}function Nm(n,c){return ho(n.getUTCSeconds(),c,2)}function zm(n){var c=n.getUTCDay();return c===0?7:c}function Zm(n,c){return ho(Mh.count(Jf(n)-1,n),c,2)}function Kd(n){var c=n.getUTCDay();return c>=4||c===0?Lc(n):Lc.ceil(n)}function Um(n,c){return n=Kd(n),ho(Lc.count(Jf(n),n)+(Jf(n).getUTCDay()===4),c,2)}function jm(n){return n.getUTCDay()}function Vm(n,c){return ho(Wc.count(Jf(n)-1,n),c,2)}function Gm(n,c){return ho(n.getUTCFullYear()%100,c,2)}function Hm(n,c){return n=Kd(n),ho(n.getUTCFullYear()%100,c,2)}function Wm(n,c){return ho(n.getUTCFullYear()%1e4,c,4)}function Xm(n,c){var a=n.getUTCDay();return n=a>=4||a===0?Lc(n):Lc.ceil(n),ho(n.getUTCFullYear()%1e4,c,4)}function Ym(){return"+0000"}function $d(){return"%"}function Jd(n){return+n}function Qd(n){return Math.floor(+n/1e3)}var fp,qd,Km,$m,Jm;Qm({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function Qm(n){return fp=op(n),qd=fp.format,Km=fp.parse,$m=fp.utcFormat,Jm=fp.utcParse,fp}var Up=1e3,jp=Up*60,Vp=jp*60,Gp=Vp*24,qm=Gp*7,ev=Gp*30,Nd=Gp*365;function e0(n){return new Date(n)}function t0(n){return n instanceof Date?+n:+new Date(+n)}function tv(n,c,a,s,l,p,_,A,M){var L=Tf(Il,Il),Y=L.invert,G=L.domain,ve=M(".%L"),Fe=M(":%S"),ht=M("%I:%M"),It=M("%I %p"),pr=M("%a %d"),Cr=M("%b %d"),Vr=M("%B"),pn=M("%Y"),gn=[[_,1,Up],[_,5,5*Up],[_,15,15*Up],[_,30,30*Up],[p,1,jp],[p,5,5*jp],[p,15,15*jp],[p,30,30*jp],[l,1,Vp],[l,3,3*Vp],[l,6,6*Vp],[l,12,12*Vp],[s,1,Gp],[s,2,2*Gp],[a,1,qm],[c,1,ev],[c,3,3*ev],[n,1,Nd]];function Dn(Qn){return(_(Qn)<Qn?ve:p(Qn)<Qn?Fe:l(Qn)<Qn?ht:s(Qn)<Qn?It:c(Qn)<Qn?a(Qn)<Qn?pr:Cr:n(Qn)<Qn?Vr:pn)(Qn)}function Yn(Qn,Si,qi,_a){if(Qn==null&&(Qn=10),typeof Qn=="number"){var gi=Math.abs(qi-Si)/Qn,Aa=Ma(function(Xa){return Xa[2]}).right(gn,gi);Aa===gn.length?(_a=Ot(Si/Nd,qi/Nd,Qn),Qn=n):Aa?(Aa=gn[gi/gn[Aa-1][2]<gn[Aa][2]/gi?Aa-1:Aa],_a=Aa[1],Qn=Aa[0]):(_a=Math.max(Ot(Si,qi,Qn),1),Qn=A)}return _a==null?Qn:Qn.every(_a)}return L.invert=function(Qn){return new Date(Y(Qn))},L.domain=function(Qn){return arguments.length?G(Vn.call(Qn,t0)):G().map(e0)},L.ticks=function(Qn,Si){var qi=G(),_a=qi[0],gi=qi[qi.length-1],Aa=gi<_a,Xa;return Aa&&(Xa=_a,_a=gi,gi=Xa),Xa=Yn(Qn,_a,gi,Si),Xa=Xa?Xa.range(_a,gi+1):[],Aa?Xa.reverse():Xa},L.tickFormat=function(Qn,Si){return Si==null?Dn:M(Si)},L.nice=function(Qn,Si){var qi=G();return(Qn=Yn(Qn,qi[0],qi[qi.length-1],Si))?G(yr(qi,Qn)):L},L.copy=function(){return Af(L,tv(n,c,a,s,l,p,_,A,M))},L}function r0(){return Ia.apply(tv(oa,Oa,Wu,vc,vf,tp,np,Ph,qd).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function Vy(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function md(){var n=0,c=1,a,s,l,p,_=identity,A=!1,M;function L(Y){return isNaN(Y=+Y)?M:_(l===0?.5:(Y=(p(Y)-a)*l,A?Math.max(0,Math.min(1,Y)):Y))}return L.domain=function(Y){return arguments.length?(a=p(n=+Y[0]),s=p(c=+Y[1]),l=a===s?0:1/(s-a),L):[n,c]},L.clamp=function(Y){return arguments.length?(A=!!Y,L):A},L.interpolator=function(Y){return arguments.length?(_=Y,L):_},L.unknown=function(Y){return arguments.length?(M=Y,L):M},function(Y){return p=Y,a=Y(n),s=Y(c),l=a===s?0:1/(s-a),L}}function gd(n,c){return c.domain(n.domain()).interpolator(n.interpolator()).clamp(n.clamp()).unknown(n.unknown())}function n0(){var n=linearish(md()(identity));return n.copy=function(){return gd(n,n0())},initInterpolator.apply(n,arguments)}function i0(){var n=loggish(md()).domain([1,10]);return n.copy=function(){return gd(n,i0()).base(n.base())},initInterpolator.apply(n,arguments)}function a0(){var n=symlogish(md());return n.copy=function(){return gd(n,a0()).constant(n.constant())},initInterpolator.apply(n,arguments)}function rv(){var n=powish(md());return n.copy=function(){return gd(n,rv()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function Gy(){return rv.apply(null,arguments).exponent(.5)}function o0(){var n=[],c=identity;function a(s){if(!isNaN(s=+s))return c((bisect(n,s)-1)/(n.length-1))}return a.domain=function(s){if(!arguments.length)return n.slice();n=[];for(var l=0,p=s.length,_;l<p;++l)_=s[l],_!=null&&!isNaN(_=+_)&&n.push(_);return n.sort(ascending),a},a.interpolator=function(s){return arguments.length?(c=s,a):c},a.copy=function(){return o0(c).domain(n)},initInterpolator.apply(a,arguments)}function yd(){var n=0,c=.5,a=1,s,l,p,_,A,M=identity,L,Y=!1,G;function ve(Fe){return isNaN(Fe=+Fe)?G:(Fe=.5+((Fe=+L(Fe))-l)*(Fe<l?_:A),M(Y?Math.max(0,Math.min(1,Fe)):Fe))}return ve.domain=function(Fe){return arguments.length?(s=L(n=+Fe[0]),l=L(c=+Fe[1]),p=L(a=+Fe[2]),_=s===l?0:.5/(l-s),A=l===p?0:.5/(p-l),ve):[n,c,a]},ve.clamp=function(Fe){return arguments.length?(Y=!!Fe,ve):Y},ve.interpolator=function(Fe){return arguments.length?(M=Fe,ve):M},ve.unknown=function(Fe){return arguments.length?(G=Fe,ve):G},function(Fe){return L=Fe,s=Fe(n),l=Fe(c),p=Fe(a),_=s===l?0:.5/(l-s),A=l===p?0:.5/(p-l),ve}}function s0(){var n=linearish(yd()(identity));return n.copy=function(){return copy(n,s0())},initInterpolator.apply(n,arguments)}function u0(){var n=loggish(yd()).domain([.1,1,10]);return n.copy=function(){return copy(n,u0()).base(n.base())},initInterpolator.apply(n,arguments)}function l0(){var n=symlogish(yd());return n.copy=function(){return copy(n,l0()).constant(n.constant())},initInterpolator.apply(n,arguments)}function nv(){var n=powish(yd());return n.copy=function(){return copy(n,nv()).exponent(n.exponent())},initInterpolator.apply(n,arguments)}function Hy(){return nv.apply(null,arguments).exponent(.5)}var Kc,iv,av,ov,zd,sv,c0=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,f0=(Kc={},(0,H.Z)(Kc,U.ScaleTypes.LINEAR,Xt),(0,H.Z)(Kc,U.ScaleTypes.POWER,Eo),(0,H.Z)(Kc,U.ScaleTypes.LOG,ri),(0,H.Z)(Kc,U.ScaleTypes.IDENTITY,hr),(0,H.Z)(Kc,U.ScaleTypes.TIME,r0),(0,H.Z)(Kc,U.ScaleTypes.QUANTILE,As),(0,H.Z)(Kc,U.ScaleTypes.QUANTIZE,Ts),(0,H.Z)(Kc,U.ScaleTypes.THRESHOLD,hu),(0,H.Z)(Kc,U.ScaleTypes.CAT,$a),Kc),h0=(iv=(0,sa.b2)(),av=(0,sa.f3)(U.vK.IGlobalConfigService),iv(ov=(zd=function(){function n(){(0,ft.Z)(this,n),(0,bo.Z)(this,"configService",sv,this),(0,H.Z)(this,"scaleCache",{}),(0,H.Z)(this,"scaleOptions",{})}return(0,vr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes(),A=a.getSource().data.dataArray;A.length!==0&&l.caculateScalesForAttributes(_||[],A)}),a.hooks.beforeRenderData.tap("FeatureScalePlugin",function(){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes(),A=a.getSource().data.dataArray;return l.caculateScalesForAttributes(_||[],A),a.layerModelNeedUpdate=!0,!0}),a.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!a.layerModelNeedUpdate){l.scaleOptions=a.getScaleOptions();var _=p.getLayerStyleAttributes();if(_){var A=a.getSource().data.dataArray;if(A.length===0)return;var M=_.filter(function(L){return L.needRescale});M.length&&l.caculateScalesForAttributes(M,A)}}})}},{key:"isNumber",value:function(a){return!isNaN(parseFloat(a))&&isFinite(a)}},{key:"caculateScalesForAttributes",value:function(a,s){var l=this;this.scaleCache={},a.forEach(function(p){if(p.scale){var _=p.scale,A=p.name;_.names=l.parseFields(p.scale.field||[]);var M=[];_.names.forEach(function(L){M.push(l.getOrCreateScale(L,p,s))}),M.some(function(L){return L.type===U.StyleScaleType.VARIABLE})?(_.type=U.StyleScaleType.VARIABLE,M.forEach(function(L){if(!_.callback){var Y;if(_.values&&_.values!=="text"){var G;if(((G=L.option)===null||G===void 0?void 0:G.type)==="linear"&&_.values.length>2){var ve=L.scale.ticks(_.values.length);A==="color"&&L.scale.domain(ve)}L.scale.range(_.values)}else((Y=L.option)===null||Y===void 0?void 0:Y.type)==="cat"&&L.scale.range(L.option.domain)}})):(_.type=U.StyleScaleType.CONSTANT,_.defaultValues=M.map(function(L,Y){return L.scale(_.names[Y])})),_.scalers=M.map(function(L){return{field:L.field,func:L.scale,option:L.option}}),p.needRescale=!1}})}},{key:"getOrCreateScale",value:function(a,s,l){var p,_=[a,s.name].join("_"),A=(p=s.scale)===null||p===void 0?void 0:p.values,M=this.createScale(a,s.name,A,l);return M}},{key:"parseFields",value:function(a){return Array.isArray(a)?a:Fi()(a)?a.split("*"):[a]}},{key:"createScale",value:function(a,s,l,p){var _,A,M=this.scaleOptions[s]&&((_=this.scaleOptions[s])===null||_===void 0?void 0:_.field)===a?this.scaleOptions[s]:this.scaleOptions[a],L={field:a,scale:void 0,type:U.StyleScaleType.VARIABLE,option:M};if(!p||!p.length)return M&&M.type?L.scale=this.createDefaultScale(M):(L.scale=$a([a]),L.type=U.StyleScaleType.CONSTANT),L;var Y=(A=p.find(function(Fe){return!Hi()(Fe[a])}))===null||A===void 0?void 0:A[a];if(this.isNumber(a)||Hi()(Y)&&!M)L.scale=$a([a]),L.type=U.StyleScaleType.CONSTANT;else{var G=M&&M.type||this.getDefaultType(Y);l==="text"&&(G=U.ScaleTypes.CAT);var ve=this.createDefaultScaleConfig(G,a,p);Object.assign(ve,M),L.scale=this.createDefaultScale(ve),L.option=ve}return L}},{key:"getDefaultType",value:function(a){var s=U.ScaleTypes.LINEAR;return typeof a=="string"&&(s=c0.test(a)?U.ScaleTypes.TIME:U.ScaleTypes.CAT),s}},{key:"createDefaultScaleConfig",value:function(a,s,l){var p={type:a},_=(l==null?void 0:l.map(function(A){return A[s]}))||[];return a!==U.ScaleTypes.CAT&&a!==U.ScaleTypes.QUANTILE?p.domain=Pl(_):a===U.ScaleTypes.CAT?p.domain=ws()(_):a===U.ScaleTypes.QUANTILE&&(p.domain=_),p}},{key:"createDefaultScale",value:function(a){var s=a.type,l=a.domain,p=f0[s]();return l&&p.domain(l),p}}]),n}(),sv=(0,Qa.Z)(zd.prototype,"configService",[av],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zd))||ov),uv,lv,cv,fv,_d,hv,pv;function dv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function p0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?dv(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):dv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var d0=(uv=(0,sa.b2)(),lv=(0,sa.f3)(U.vK.ICameraService),cv=(0,sa.f3)(U.vK.IRendererService),uv(fv=(_d=function(){function n(){(0,ft.Z)(this,n),(0,bo.Z)(this,"cameraService",hv,this),(0,bo.Z)(this,"rendererService",pv,this)}return(0,vr.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){a.models.forEach(function(s){s.addUniforms(p0({},a.layerModel.getAnimateUniforms()))})})}}]),n}(),hv=(0,Qa.Z)(_d.prototype,"cameraService",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pv=(0,Qa.Z)(_d.prototype,"rendererService",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d))||fv),vv,mv,v0=(vv=(0,sa.b2)(),vv(mv=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a){a.hooks.init.tap("LayerModelPlugin",function(){a.prepareBuildModel(),a.buildModels(),a.styleNeedUpdate=!1}),a.hooks.beforeRenderData.tap("DataSourcePlugin",function(){return a.prepareBuildModel(),a.clearModels(),a.buildModels(),a.layerModelNeedUpdate=!1,!1})}}]),n}())||mv),gv,yv,m0=(gv=(0,sa.b2)(),gv(yv=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a){a.hooks.afterInit.tap("LayerStylePlugin",function(){a.updateLayerConfig({});var s=a.getLayerConfig(),l=s.autoFit,p=s.fitBoundsOptions;l&&setTimeout(function(){a.fitBounds(p)},100)})}}]),n}())||yv),_v,xv;function bv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Hp(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?bv(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):bv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var Sv={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},g0={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},y0={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},_0={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5},Wy=null;function x0(n){var c={u_DirectionalLights:new Array(3).fill(Hp({},y0)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill(Hp({},_0)),u_NumOfSpotLights:0};return(!n||!n.length)&&(n=[g0]),n.forEach(function(a,s){var l=a.type,p=l===void 0?"directional":l,_=(0,Ju.Z)(a,["type"]),A=Sv[p].lights,M=Sv[p].num,L=c[M];c[A][L]=Hp(Hp({},c[A][L]),_),c[M]++}),c}var b0=(_v=(0,sa.b2)(),_v(xv=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("LightingPlugin",function(){var s=a.getLayerConfig(),l=s.enableLighting;l&&a.models.forEach(function(p){return p.addUniforms(Hp({},x0()))})})}}]),n}())||xv),Ev,Cv,xd={NONE:0,ENCODE:1,HIGHLIGHT:2},S0=(Ev=(0,sa.b2)(),Ev(Cv=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a,s){var l=s.rendererService,p=s.styleAttributeService;a.hooks.init.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),A=_.enablePicking;p.registerStyleAttribute({name:"pickingColor",type:U.AttributeType.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:U.gl.FLOAT},size:3,update:function(L,Y){var G=L.id;return A?(0,Ke.Z6)(G):[0,0,0]}}})}),a.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),A=_.enablePicking;A&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:xd.ENCODE})})}),a.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var _=a.getLayerConfig(),A=_.enablePicking;A&&a.isVisible()&&a.models.forEach(function(M){return M.addUniforms({u_PickingStage:xd.HIGHLIGHT})})}),a.hooks.beforeHighlight.tap("PixelPickingPlugin",function(_){var A=a.getLayerConfig(),M=A.highlightColor,L=typeof M=="string"?(0,Ke.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Ke.W0)(new Uint8Array(_))}),a.models.forEach(function(Y){return Y.addUniforms({u_PickingStage:xd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:L.map(function(G){return G*255})})})}),a.hooks.beforeSelect.tap("PixelPickingPlugin",function(_){var A=a.getLayerConfig(),M=A.selectColor,L=typeof M=="string"?(0,Ke.CI)(M):M||[1,0,0,1];a.updateLayerConfig({pickedFeatureID:(0,Ke.W0)(new Uint8Array(_))}),a.models.forEach(function(Y){return Y.addUniforms({u_PickingStage:xd.HIGHLIGHT,u_PickingColor:_,u_HighlightColor:L.map(function(G){return G*255})})})})}}]),n}())||Cv),wv,Av,E0=(wv=(0,sa.b2)(),wv(Av=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("RegisterStyleAttributePlugin",function(){l.registerBuiltinAttributes(p)})}},{key:"registerBuiltinAttributes",value:function(a){a.registerStyleAttribute({name:"position",type:U.AttributeType.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:U.gl.FLOAT},size:3,update:function(l,p,_){return _.length===2?[_[0],_[1],0]:[_[0],_[1],_[2]]}}}),a.registerStyleAttribute({name:"filter",type:U.AttributeType.Attribute,descriptor:{name:"filter",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(l,p){var _=l.filter;return _?[1]:[0]}}}),a.registerStyleAttribute({name:"color",type:U.AttributeType.Attribute,descriptor:{name:"a_Color",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:4,update:function(l,p){var _=l.color;return!_||!_.length?[1,1,1,1]:_}}}),a.registerStyleAttribute({name:"vertexId",type:U.AttributeType.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:U.gl.DYNAMIC_DRAW,data:[],type:U.gl.FLOAT},size:1,update:function(l,p,_,A){return[p]}}})}}]),n}())||Av),Tv,Pv,Mv,Iv,Ov,Lv,hp,Rv,Dv,kv,Fv,C0=(Tv=(0,sa.b2)(),Pv=(0,sa.f3)(U.vK.ICameraService),Mv=(0,sa.f3)(U.vK.ICoordinateSystemService),Iv=(0,sa.f3)(U.vK.IRendererService),Ov=(0,sa.f3)(U.vK.IMapService),Tv(Lv=(hp=function(){function n(){(0,ft.Z)(this,n),(0,bo.Z)(this,"cameraService",Rv,this),(0,bo.Z)(this,"coordinateSystemService",Dv,this),(0,bo.Z)(this,"rendererService",kv,this),(0,bo.Z)(this,"mapService",Fv,this)}return(0,vr.Z)(n,[{key:"apply",value:function(a){var s=this,l=this.mapService.version,p=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],_=[0,0];a.hooks.beforeRender.tap("ShaderUniformPlugin",function(){s.coordinateSystemService.refresh(),l==="GAODE2.x"&&(p=s.mapService.map.customCoords.getMVPMatrix(),_=s.mapService.getCustomCoordCenter());var A=s.rendererService.getViewportSize(),M=A.width,L=A.height;a.models.forEach(function(Y){var G;Y.addUniforms((G={},(0,H.Z)(G,U.CameraUniform.ProjectionMatrix,s.cameraService.getProjectionMatrix()),(0,H.Z)(G,U.CameraUniform.ViewMatrix,s.cameraService.getViewMatrix()),(0,H.Z)(G,U.CameraUniform.ViewProjectionMatrix,s.cameraService.getViewProjectionMatrix()),(0,H.Z)(G,U.CameraUniform.Zoom,s.cameraService.getZoom()),(0,H.Z)(G,U.CameraUniform.ZoomScale,s.cameraService.getZoomScale()),(0,H.Z)(G,U.CameraUniform.FocalDistance,s.cameraService.getFocalDistance()),(0,H.Z)(G,U.CameraUniform.CameraPosition,s.cameraService.getCameraPosition()),(0,H.Z)(G,U.CoordinateUniform.CoordinateSystem,s.coordinateSystemService.getCoordinateSystem()),(0,H.Z)(G,U.CoordinateUniform.ViewportCenter,s.coordinateSystemService.getViewportCenter()),(0,H.Z)(G,U.CoordinateUniform.ViewportCenterProjection,s.coordinateSystemService.getViewportCenterProjection()),(0,H.Z)(G,U.CoordinateUniform.PixelsPerDegree,s.coordinateSystemService.getPixelsPerDegree()),(0,H.Z)(G,U.CoordinateUniform.PixelsPerDegree2,s.coordinateSystemService.getPixelsPerDegree2()),(0,H.Z)(G,U.CoordinateUniform.PixelsPerMeter,s.coordinateSystemService.getPixelsPerMeter()),(0,H.Z)(G,U.CoordinateUniform.Mvp,p),(0,H.Z)(G,"u_SceneCenterMKT",_),(0,H.Z)(G,"u_ViewportSize",[M,L]),(0,H.Z)(G,"u_DevicePixelRatio",window.devicePixelRatio),(0,H.Z)(G,"u_ModelMatrix",s.cameraService.getModelMatrix()),(0,H.Z)(G,"u_PickingBuffer",a.getLayerConfig().pickingBuffer||0),G))})})}}]),n}(),Rv=(0,Qa.Z)(hp.prototype,"cameraService",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv=(0,Qa.Z)(hp.prototype,"coordinateSystemService",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kv=(0,Qa.Z)(hp.prototype,"rendererService",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv=(0,Qa.Z)(hp.prototype,"mapService",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hp))||Lv),Bv,Nv,w0=(Bv=(0,sa.b2)(),Bv(Nv=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a){a.hooks.beforeRender.tap("UpdateModelPlugin",function(){a.layerModel&&a.layerModel.needUpdate()})}}]),n}())||Nv),zv,Zv,A0=(zv=(0,sa.b2)(),zv(Zv=function(){function n(){(0,ft.Z)(this,n)}return(0,vr.Z)(n,[{key:"apply",value:function(a,s){var l=this,p=s.styleAttributeService;a.hooks.init.tap("UpdateStyleAttributePlugin",function(){l.initStyleAttribute(a,{styleAttributeService:p})}),a.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){a.layerModelNeedUpdate||l.updateStyleAtrribute(a,{styleAttributeService:p})})}},{key:"updateStyleAtrribute",value:function(a,s){var l=s.styleAttributeService,p=l.getLayerStyleAttributes()||[],_=l.getLayerStyleAttribute("filter"),A=l.getLayerStyleAttribute("shape");if(_&&_.needRegenerateVertices||A&&A.needRegenerateVertices){a.layerModelNeedUpdate=!0,p.forEach(function(M){return M.needRegenerateVertices=!1});return}p.filter(function(M){return M.needRegenerateVertices}).forEach(function(M){l.updateAttributeByFeatureRange(M.name,a.getEncodedData(),M.featureRange.startIndex,M.featureRange.endIndex),M.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(a,s){var l=s.styleAttributeService,p=l.getLayerStyleAttributes()||[];p.filter(function(_){return _.needRegenerateVertices}).forEach(function(_){l.updateAttributeByFeatureRange(_.name,a.getEncodedData(),_.featureRange.startIndex,_.featureRange.endIndex),_.needRegenerateVertices=!1})}}]),n}())||Zv);U.nC.bind(U.vK.ILayerPlugin).to(Cs).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(E0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(h0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(mo).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(m0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(A0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(w0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(su).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(C0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(d0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(b0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(S0).inRequestScope(),U.nC.bind(U.vK.ILayerPlugin).to(v0).inRequestScope();var Xy="2.5.35";function Uv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Yy(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Uv(Object(a),!0).forEach(function(s){T0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Uv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function T0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function Ky(n,c){return O0(n)||I0(n,c)||M0(n,c)||P0()}function P0(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function M0(n,c){if(!!n){if(typeof n=="string")return jv(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return jv(n,c)}}function jv(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function I0(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function O0(n){if(Array.isArray(n))return n}var $y=null,Jy=null,Vv,Zd,Gv;function Hv(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Wv(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Hv(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Hv(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}var L0=(Vv=(0,U.yT)(U.vK.IGlobalConfigService),Zd=function(){function n(c){(0,ft.Z)(this,n),(0,bo.Z)(this,"configService",Gv,this),(0,H.Z)(this,"config",void 0),this.config=c}return(0,vr.Z)(n,[{key:"setContainer",value:function(a,s){a.bind(U.vK.MapConfig).toConstantValue(Wv(Wv({},this.config),{},{id:s})),a.bind(U.vK.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),n}(),Gv=(0,Qa.Z)(Zd.prototype,"configService",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zd),R0=S(6158),D0=S.n(R0),Ud;(function(n){n["GAODE1.x"]="GAODE1.x",n["GAODE2.x"]="GAODE2.x",n.MAPBOX="MAPBOX",n.L7MAP="L7MAP",n.GLOBEL="GLOBEL"})(Ud||(Ud={}));function Wp(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function bd(n,c){var a=hf.fF([],c,n);return hf.bA(a,a,1/a[3]),a}function Qy(n,c){var a=n%c;return a<0?c+a:a}function qy(n,c,a){return a*c+(1-a)*n}function kh(n,c){if(!n)throw new Error(c||"viewport-mercator-project: assertion failed.")}var $c=Math.PI,Xv=$c/4,Df=$c/180,Yv=180/$c,jd=512,Vd=4003e4,k0=1.5;function Kv(n){return Math.pow(2,n)}function F0(n){return Math.log2(n)}function Sd(n,c){var a=(0,ha.Z)(n,2),s=a[0],l=a[1];kh(Number.isFinite(s)&&Number.isFinite(c)),kh(Number.isFinite(l)&&l>=-90&&l<=90,"invalid latitude"),c*=jd;var p=s*Df,_=l*Df,A=c*(p+$c)/(2*$c),M=c*($c-Math.log(Math.tan(Xv+_*.5)))/(2*$c);return[A,M]}function Gd(n,c){var a=(0,ha.Z)(n,2),s=a[0],l=a[1];c*=jd;var p=s/c*(2*$c)-$c,_=2*(Math.atan(Math.exp($c-l/c*(2*$c)))-Xv);return[p*Yv,_*Yv]}function e1(n){var c=n.latitude;assert(Number.isFinite(c));var a=Math.cos(c*Df);return F0(Vd*a)-9}function $v(n){var c=n.latitude,a=n.longitude,s=n.zoom,l=n.scale,p=n.highPrecision,_=p===void 0?!1:p;l=l!==void 0?l:Kv(s),kh(Number.isFinite(c)&&Number.isFinite(a)&&Number.isFinite(l));var A={},M=jd*l,L=Math.cos(c*Df),Y=M/360,G=Y/L,ve=M/Vd/L;if(A.pixelsPerMeter=[ve,-ve,ve],A.metersPerPixel=[1/ve,-1/ve,1/ve],A.pixelsPerDegree=[Y,-G,ve],A.degreesPerPixel=[1/Y,-1/G,1/ve],_){var Fe=Df*Math.tan(c*Df)/L,ht=Y*Fe/2,It=M/Vd*Fe,pr=It/G*ve;A.pixelsPerDegree2=[0,-ht,It],A.pixelsPerMeter2=[pr,0,pr]}return A}function t1(n,c){var a=_slicedToArray(n,3),s=a[0],l=a[1],p=a[2],_=_slicedToArray(c,3),A=_[0],M=_[1],L=_[2],Y=1,G=$v({longitude:s,latitude:l,scale:Y,highPrecision:!0}),ve=G.pixelsPerMeter,Fe=G.pixelsPerMeter2,ht=Sd(n,Y);ht[0]+=A*(ve[0]+Fe[0]*M),ht[1]+=M*(ve[1]+Fe[1]*M);var It=Gd(ht,Y),pr=(p||0)+(L||0);return Number.isFinite(p)||Number.isFinite(L)?[It[0],It[1],pr]:It}function B0(n){var c=n.height,a=n.pitch,s=n.bearing,l=n.altitude,p=n.center,_=p===void 0?null:p,A=n.flipY,M=A===void 0?!1:A,L=Wp();return jn.translate(L,L,[0,0,-l]),jn.scale(L,L,[1,1,1/c]),jn.rotateX(L,L,-a*Df),jn.rotateZ(L,L,s*Df),M&&jn.scale(L,L,[1,-1,1]),_&&jn.translate(L,L,Ea.negate([],_)),L}function N0(n){var c=n.width,a=n.height,s=n.altitude,l=s===void 0?k0:s,p=n.pitch,_=p===void 0?0:p,A=n.nearZMultiplier,M=A===void 0?1:A,L=n.farZMultiplier,Y=L===void 0?1:L,G=_*Df,ve=Math.atan(.5/l),Fe=Math.sin(ve)*l/Math.sin(Math.PI/2-G-ve),ht=Math.cos(Math.PI/2-G)*Fe+l;return{fov:2*Math.atan(a/2/l),aspect:c/a,focalDistance:l,near:M,far:ht*Y}}function z0(n){var c=n.width,a=n.height,s=n.pitch,l=n.altitude,p=n.nearZMultiplier,_=n.farZMultiplier,A=N0({width:c,height:a,altitude:l,pitch:s,nearZMultiplier:p,farZMultiplier:_}),M=A.fov,L=A.aspect,Y=A.near,G=A.far,ve=jn.perspective([],M,L,Y,G);return ve}function Z0(n,c){var a=(0,ha.Z)(n,3),s=a[0],l=a[1],p=a[2],_=p===void 0?0:p;return kh(Number.isFinite(s)&&Number.isFinite(l)&&Number.isFinite(_)),bd(c,[s,l,_,1])}function Jv(n,c){var a=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,s=(0,ha.Z)(n,3),l=s[0],p=s[1],_=s[2];if(kh(Number.isFinite(l)&&Number.isFinite(p),"invalid pixel coordinate"),Number.isFinite(_)){var A=bd(c,[l,p,_,1]);return A}var M=bd(c,[l,p,0,1]),L=bd(c,[l,p,1,1]),Y=M[2],G=L[2],ve=Y===G?0:((a||0)-Y)/(G-Y);return Ri.lerp([],M,L,ve)}var Qv=Wp(),U0=function(){function n(){var c=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=c.width,s=c.height,l=c.viewMatrix,p=l===void 0?Qv:l,_=c.projectionMatrix,A=_===void 0?Qv:_;(0,ft.Z)(this,n),this.width=a||1,this.height=s||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=p,this.projectionMatrix=A;var M=Wp();jn.multiply(M,M,this.projectionMatrix),jn.multiply(M,M,this.viewMatrix),this.viewProjectionMatrix=M;var L=Wp();jn.scale(L,L,[this.width/2,-this.height/2,1]),jn.translate(L,L,[1,-1,0]),jn.multiply(L,L,this.viewProjectionMatrix);var Y=jn.invert(Wp(),L);if(!Y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=L,this.pixelUnprojectionMatrix=Y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,vr.Z)(n,[{key:"equals",value:function(a){return a instanceof n?a.width===this.width&&a.height===this.height&&jn.equals(a.projectionMatrix,this.projectionMatrix)&&jn.equals(a.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,_=this.projectPosition(a),A=Z0(_,this.pixelProjectionMatrix),M=(0,ha.Z)(A,2),L=M[0],Y=M[1],G=p?Y:this.height-Y;return a.length===2?[L,G]:[L,G,A[2]]}},{key:"unproject",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},l=s.topLeft,p=l===void 0?!0:l,_=s.targetZ,A=(0,ha.Z)(a,3),M=A[0],L=A[1],Y=A[2],G=p?L:this.height-L,ve=_&&_*this.pixelsPerMeter,Fe=Jv([M,G,Y],this.pixelUnprojectionMatrix,ve),ht=this.unprojectPosition(Fe),It=(0,ha.Z)(ht,3),pr=It[0],Cr=It[1],Vr=It[2];return Number.isFinite(Y)?[pr,Cr,Vr]:Number.isFinite(_)?[pr,Cr,_]:[pr,Cr]}},{key:"projectPosition",value:function(a){var s=this.projectFlat(a),l=(0,ha.Z)(s,2),p=l[0],_=l[1],A=(a[2]||0)*this.pixelsPerMeter;return[p,_,A]}},{key:"unprojectPosition",value:function(a){var s=this.unprojectFlat(a),l=(0,ha.Z)(s,2),p=l[0],_=l[1],A=(a[2]||0)/this.pixelsPerMeter;return[p,_,A]}},{key:"projectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}},{key:"unprojectFlat",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return a}}]),n}();function j0(n){var c=n.width,a=n.height,s=n.bounds,l=n.minExtent,p=l===void 0?0:l,_=n.maxZoom,A=_===void 0?24:_,M=n.padding,L=M===void 0?0:M,Y=n.offset,G=Y===void 0?[0,0]:Y,ve=(0,ha.Z)(s,2),Fe=(0,ha.Z)(ve[0],2),ht=Fe[0],It=Fe[1],pr=(0,ha.Z)(ve[1],2),Cr=pr[0],Vr=pr[1];if(Number.isFinite(L)){var pn=L;L={top:pn,bottom:pn,left:pn,right:pn}}else kh(Number.isFinite(L.top)&&Number.isFinite(L.bottom)&&Number.isFinite(L.left)&&Number.isFinite(L.right));var gn=new qv({width:c,height:a,longitude:0,latitude:0,zoom:0}),Dn=gn.project([ht,Vr]),Yn=gn.project([Cr,It]),Qn=[Math.max(Math.abs(Yn[0]-Dn[0]),p),Math.max(Math.abs(Yn[1]-Dn[1]),p)],Si=[c-L.left-L.right-Math.abs(G[0])*2,a-L.top-L.bottom-Math.abs(G[1])*2];kh(Si[0]>0&&Si[1]>0);var qi=Si[0]/Qn[0],_a=Si[1]/Qn[1],gi=(L.right-L.left)/2/qi,Aa=(L.bottom-L.top)/2/_a,Xa=[(Yn[0]+Dn[0])/2+gi,(Yn[1]+Dn[1])/2+Aa],pu=gn.unproject(Xa),kf=gn.zoom+Math.log2(Math.abs(Math.min(qi,_a)));return{longitude:pu[0],latitude:pu[1],zoom:Math.min(kf,A)}}var qv=function(n){(0,Dr.Z)(c,n);function c(){var a,s=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},l=s.width,p=s.height,_=s.latitude,A=_===void 0?0:_,M=s.longitude,L=M===void 0?0:M,Y=s.zoom,G=Y===void 0?0:Y,ve=s.pitch,Fe=ve===void 0?0:ve,ht=s.bearing,It=ht===void 0?0:ht,pr=s.altitude,Cr=pr===void 0?1.5:pr,Vr=s.nearZMultiplier,pn=s.farZMultiplier;(0,ft.Z)(this,c),l=l||1,p=p||1;var gn=Kv(G);Cr=Math.max(.75,Cr);var Dn=Sd([L,A],gn);Dn[2]=0;var Yn=z0({width:l,height:p,pitch:Fe,bearing:It,altitude:Cr,nearZMultiplier:Vr||1/p,farZMultiplier:pn||1.01}),Qn=B0({height:p,center:Dn,pitch:Fe,bearing:It,altitude:Cr,flipY:!0});return a=(0,In.Z)(this,(0,tr.Z)(c).call(this,{width:l,height:p,viewMatrix:Qn,projectionMatrix:Yn})),a.latitude=A,a.longitude=L,a.zoom=G,a.pitch=Fe,a.bearing=It,a.altitude=Cr,a.scale=gn,a.center=Dn,a.pixelsPerMeter=$v((0,et.Z)((0,et.Z)(a))).pixelsPerMeter[2],Object.freeze((0,et.Z)((0,et.Z)(a))),a}return(0,vr.Z)(c,[{key:"projectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Sd(s,l)}},{key:"unprojectFlat",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return Gd(s,l)}},{key:"getMapCenterByLngLatPosition",value:function(s){var l=s.lngLat,p=s.pos,_=Jv(p,this.pixelUnprojectionMatrix),A=Sd(l,this.scale),M=Ri.add([],A,Ri.negate([],_)),L=Ri.add([],this.center,M);return Gd(L,this.scale)}},{key:"getLocationAtPoint",value:function(s){var l=s.lngLat,p=s.pos;return this.getMapCenterByLngLatPosition({lngLat:l,pos:p})}},{key:"fitBounds",value:function(s){var l=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},p=this.width,_=this.height,A=j0(Object.assign({width:p,height:_,bounds:s},l)),M=A.longitude,L=A.latitude,Y=A.zoom;return new c({width:p,height:_,longitude:M,latitude:L,zoom:Y})}}]),c}(U0),V0=function(){function n(){(0,ft.Z)(this,n),(0,H.Z)(this,"viewport",void 0)}return(0,vr.Z)(n,[{key:"syncWithMapCamera",value:function(a){var s=a.center,l=a.zoom,p=a.pitch,_=a.bearing,A=a.viewportHeight,M=a.viewportWidth;this.viewport=new qv({width:M,height:A,longitude:s&&s[0],latitude:s&&s[1],zoom:l,pitch:p,bearing:_})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(a,s){return this.viewport.projectFlat(a,s)}}]),n}(),em={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},tm,rm,nm,im,am,om,pp,sm,um,lm,cm;function fm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function G0(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?fm(Object(a),!0).forEach(function(s){(0,H.Z)(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):fm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function H0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}H0(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=D0();var hm={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},W0=0,X0=12,pm="pk.eyJ1IjoibHp4dWUiLCJhIjoiY2tvaWZuM2s4MWZuYjJ1dHI5ZGduYTlrdiJ9.DQCfMRbZzx0VSwecQ69McA",Y0=(tm=(0,sa.b2)(),rm=(0,sa.f3)(U.vK.MapConfig),nm=(0,sa.f3)(U.vK.IGlobalConfigService),im=(0,sa.f3)(U.vK.ICoordinateSystemService),am=(0,sa.f3)(U.vK.IEventEmitter),tm(om=(pp=function(){function n(){var c=this;(0,ft.Z)(this,n),(0,H.Z)(this,"version",Ud.MAPBOX),(0,H.Z)(this,"map",void 0),(0,H.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),(0,bo.Z)(this,"config",sm,this),(0,bo.Z)(this,"configService",um,this),(0,bo.Z)(this,"coordinateSystemService",lm,this),(0,bo.Z)(this,"eventEmitter",cm,this),(0,H.Z)(this,"viewport",void 0),(0,H.Z)(this,"markerContainer",void 0),(0,H.Z)(this,"cameraChangedCallback",void 0),(0,H.Z)(this,"$mapContainer",void 0),(0,H.Z)(this,"handleCameraChanged",function(){var a=c.map.getCenter().wrap(),s=a.lat,l=a.lng;c.viewport.syncWithMapCamera({bearing:c.map.getBearing(),center:[l,s],viewportHeight:c.map.transform.height,pitch:c.map.getPitch(),viewportWidth:c.map.transform.width,zoom:c.map.getZoom(),cameraHeight:0});var p=c.config.offsetZoom,_=p===void 0?X0:p;c.viewport.getZoom()>_?c.coordinateSystemService.setCoordinateSystem(U.CoordinateSystem.LNGLAT_OFFSET):c.coordinateSystemService.setCoordinateSystem(U.CoordinateSystem.LNGLAT),c.cameraChangedCallback(c.viewport)})}return(0,vr.Z)(n,[{key:"setBgColor",value:function(a){this.bgColor=a}},{key:"addMarkerContainer",value:function(){var a=this.map.getCanvasContainer();this.markerContainer=Ke.SO.create("div","l7-marker-container",a),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(a,s){U.MapServiceEvent.indexOf(a)!==-1?this.eventEmitter.on(a,s):this.map.on(hm[a]||a,s)}},{key:"off",value:function(a,s){this.map.off(hm[a]||a,s)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var a=this.map.transform;return[a.width,a.height]}},{key:"getType",value:function(){return"mapbox"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(a){return this.map.setZoom(a)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(a){this.map.setCenter(a)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(a){this.map.setBearing(a)}},{key:"zoomIn",value:function(a,s){this.map.zoomIn(a,s)}},{key:"zoomOut",value:function(a,s){this.map.zoomOut(a,s)}},{key:"setPitch",value:function(a){return this.map.setPitch(a)}},{key:"panTo",value:function(a){this.map.panTo(a)}},{key:"panBy",value:function(a,s){this.panTo([a,s])}},{key:"fitBounds",value:function(a,s){this.map.fitBounds(a,s)}},{key:"setMaxZoom",value:function(a){this.map.setMaxZoom(a)}},{key:"setMinZoom",value:function(a){this.map.setMinZoom(a)}},{key:"setMapStatus",value:function(a){a.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),a.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),a.dragEnable===!1&&this.map.dragPan.disable(),a.dragEnable===!0&&this.map.dragPan.enable(),a.rotateEnable===!1&&this.map.dragRotate.disable(),a.rotateEnable===!0&&this.map.dragRotate.enable(),a.keyboardEnable===!1&&this.map.keyboard.disable(),a.keyboardEnable===!0&&this.map.keyboard.enable(),a.zoomEnable===!1&&this.map.scrollZoom.disable(),a.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(a,s){this.map.flyTo({zoom:a,center:s})}},{key:"setMapStyle",value:function(a){this.map.setStyle(this.getMapStyle(a))}},{key:"pixelToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToPixel",value:function(a){return this.map.project(a)}},{key:"containerToLngLat",value:function(a){return this.map.unproject(a)}},{key:"lngLatToContainer",value:function(a){return this.map.project(a)}},{key:"lngLatToCoord",value:function(a){var s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},l=this.lngLatToMercator(a,0),p=l.x,_=l.y;return[p-s.x,_-s.y]}},{key:"lngLatToMercator",value:function(a,s){var l=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),p=l.x,_=p===void 0?0:p,A=l.y,M=A===void 0?0:A,L=l.z,Y=L===void 0?0:L;return{x:_,y:M,z:Y}}},{key:"getModelMatrix",value:function(a,s,l){var p=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],_=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},A=window.mapboxgl.MercatorCoordinate.fromLngLat(a,s),M=A.meterInMercatorCoordinateUnits(),L=jn.create();return jn.translate(L,L,Ea.fromValues(A.x-_.x,A.y-_.y,A.z||0-_.z)),jn.scale(L,L,Ea.fromValues(M*p[0],-M*p[1],M*p[2])),jn.rotateX(L,L,l[0]),jn.rotateY(L,L,l[1]),jn.rotateZ(L,L,l[2]),L}},{key:"init",value:function(){var c=(0,cs.Z)(Xs().mark(function s(){var l,p,_,A,M,L,Y,G,ve,Fe,ht,It,pr;return Xs().wrap(function(Vr){for(;;)switch(Vr.prev=Vr.next){case 0:l=this.config,p=l.id,_=p===void 0?"map":p,A=l.attributionControl,M=A===void 0?!1:A,L=l.style,Y=L===void 0?"light":L,G=l.token,ve=G===void 0?pm:G,Fe=l.rotation,ht=Fe===void 0?0:Fe,It=l.mapInstance,pr=(0,Ju.Z)(l,["id","attributionControl","style","token","rotation","mapInstance"]),this.viewport=new V0,!It&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),ve===pm&&Y!=="blank"&&!window.mapboxgl.accessToken&&!It&&console.warn(this.configService.getSceneWarninfo("MapToken")),!It&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=ve),It?(this.map=It,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatAmapContainer(_),this.map=new window.mapboxgl.Map(G0({container:this.$mapContainer,style:this.getMapStyle(Y),attributionControl:M,bearing:ht},pr))),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return Vr.stop()}},s,this)}));function a(){return c.apply(this,arguments)}return a}()},{key:"destroy",value:function(){var a,s;(a=this.$mapContainer)===null||a===void 0||(s=a.parentNode)===null||s===void 0||s.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(a){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];(s=this.eventEmitter).emit.apply(s,[a].concat(p))}},{key:"once",value:function(a){for(var s,l=arguments.length,p=new Array(l>1?l-1:0),_=1;_<l;_++)p[_-1]=arguments[_];(s=this.eventEmitter).once.apply(s,[a].concat(p))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(a){var s=this.map.getCanvas(),l=a==="jpg"?s==null?void 0:s.toDataURL("image/jpeg"):s==null?void 0:s.toDataURL("image/png");return l}},{key:"onCameraChanged",value:function(a){this.cameraChangedCallback=a}},{key:"creatAmapContainer",value:function(a){var s=a;typeof a=="string"&&(s=document.getElementById(a));var l=document.createElement("div");return l.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,l.id="l7_mapbox_div"+W0++,s.appendChild(l),l}},{key:"getMapStyle",value:function(a){return typeof a!="string"?a:em[a]?em[a]:a}}]),n}(),sm=(0,Qa.Z)(pp.prototype,"config",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=(0,Qa.Z)(pp.prototype,"configService",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=(0,Qa.Z)(pp.prototype,"coordinateSystemService",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=(0,Qa.Z)(pp.prototype,"eventEmitter",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pp))||om);function K0(n){var c=$0();return function(){var s=(0,tr.Z)(n),l;if(c){var p=(0,tr.Z)(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return(0,In.Z)(this,l)}}function $0(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function J0(n,c){if(c||(c=document),!!c){var a=c.head||c.getElementsByTagName("head")[0];if(!a){a=c.createElement("head");var s=c.body||c.getElementsByTagName("body")[0];s?s.parentNode.insertBefore(a,s):c.documentElement.appendChild(a)}var l=c.createElement("style");return l.type="text/css",l.styleSheet?l.styleSheet.cssText=n:l.appendChild(c.createTextNode(n)),a.appendChild(l),l}}J0(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var Q0=function(n){(0,Dr.Z)(a,n);var c=K0(a);function a(){return(0,ft.Z)(this,a),c.apply(this,arguments)}return(0,vr.Z)(a,[{key:"getServiceConstructor",value:function(){return Y0}}]),a}(L0);function dm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function vm(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?dm(Object(a),!0).forEach(function(s){q0(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):dm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function q0(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function eg(n,c){return ig(n)||ng(n,c)||rg(n,c)||tg()}function tg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function rg(n,c){if(!!n){if(typeof n=="string")return mm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return mm(n,c)}}function mm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function ng(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function ig(n){if(Array.isArray(n))return n}var ag=Qe.memo(function(n){var c=n.style,a=n.className,s=n.map,l=n.option,p=n.onSceneLoaded,_=(0,Qe.createRef)(),A=(0,Qe.useState)(),M=eg(A,2),L=M[0],Y=M[1];return(0,Qe.useEffect)(function(){var G=new gf(vm(vm({id:_.current},l),{},{map:new Q0(s)}));return G.on("loaded",function(){Y(G),p&&p(G)}),function(){G.destroy()}},[]),(0,Qe.useEffect)(function(){L&&s.style&&L.setMapStyle(s.style)},[JSON.stringify(s.style)]),(0,Qe.useEffect)(function(){L&&s.zoom&&L.setZoom(s.zoom)},[s.zoom]),(0,Qe.useEffect)(function(){L&&s.center&&L.setCenter(s.center)},[JSON.stringify(s.center)]),(0,Qe.useEffect)(function(){L&&s.pitch!==void 0&&L.setPitch(s.pitch||0)},[s.pitch]),(0,Qe.useEffect)(function(){L&&s.rotation&&L.setRotation(s.rotation)},[s.rotation]),Qe.createElement($e.Provider,{value:L},(0,Qe.createElement)("div",{ref:_,style:c,className:a},L&&n.children))}),og=ag;function gm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function r1(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?gm(Object(a),!0).forEach(function(s){sg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):gm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function sg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function n1(n,c){return fg(n)||cg(n,c)||lg(n,c)||ug()}function ug(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function lg(n,c){if(!!n){if(typeof n=="string")return ym(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return ym(n,c)}}function ym(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function cg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function fg(n){if(Array.isArray(n))return n}var i1=null,a1=null;function _m(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function o1(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?_m(Object(a),!0).forEach(function(s){hg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):_m(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function hg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function s1(n,c){return mg(n)||vg(n,c)||dg(n,c)||pg()}function pg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function dg(n,c){if(!!n){if(typeof n=="string")return xm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return xm(n,c)}}function xm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function vg(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function mg(n){if(Array.isArray(n))return n}var u1=null,l1=null;function c1(n,c){return xg(n)||_g(n,c)||yg(n,c)||gg()}function gg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function yg(n,c){if(!!n){if(typeof n=="string")return bm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return bm(n,c)}}function bm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function _g(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function xg(n){if(Array.isArray(n))return n}var f1=null,h1=null;function Sm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function p1(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Sm(Object(a),!0).forEach(function(s){bg(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Sm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function bg(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function d1(n,c){if(n==null)return{};var a=Sg(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function Sg(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var v1=null,Em=S(73935);function Eg(n,c){return Tg(n)||Ag(n,c)||wg(n,c)||Cg()}function Cg(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wg(n,c){if(!!n){if(typeof n=="string")return Cm(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Cm(n,c)}}function Cm(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function Ag(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function Tg(n){if(Array.isArray(n))return n}var Pg=Qe.useEffect,Mg=Qe.useState;function m1(n){var c=n.className,a=n.style,s=n.children,l=n.position,p=useSceneValue(),_=Mg(function(){return document.createElement("div")}),A=Eg(_,1),M=A[0];return Pg(function(){var L=new Control({position:l});return L.onAdd=function(){if(c&&(M.className=c),a){var Y=Object.keys(a).map(function(G){return"".concat(G,":").concat(a[G])}).join(";");M.style.cssText=Y}return M},p.addControl(L),function(){p.removeControl(L)}},[]),createPortal(s,M)}var wm=(0,Qe.createContext)({});function g1(){return useContext(wm)}var Ig=Qe.useEffect,Og=Qe.memo(function(c){var a=c.layer,s=c.active;return Ig(function(){a.active(s.option)},[JSON.stringify(s)]),null}),Lg=Qe.useEffect,Rg=Qe.memo(function(c){var a=c.layer,s=c.animate;return Lg(function(){a.animate(s)},[JSON.stringify(s)]),null}),Dg=Qe.useEffect,kg=Qe.memo(function(c){var a=c.layer,s=c.color;return Dg(function(){s.field?a.color(s.field,s.values):a.color(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Fg=Qe.useEffect,Bg=Qe.memo(function(c){var a=c.layer,s=c.filter;return Fg(function(){s.field&&a.filter(s.field,s.values)},[s.field,s.values,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Ng=Qe.useEffect,zg=Qe.memo(function(c){var a=c.layer,s=c.scale;return Ng(function(){a.scale(s.values)},[s.values]),null}),Zg=Qe.useEffect,Ug=Qe.memo(function(c){var a=c.layer,s=c.select;return Zg(function(){a.select(s.option)},[JSON.stringify(s)]),null}),jg=Qe.useEffect,Vg=Qe.memo(function(c){var a=c.layer,s=c.shape;return jg(function(){s.field?a.shape(s.field,s.values):a.shape(s.values)},[s.field,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Gg=Qe.useEffect,Hg=Qe.memo(function(c){var a=c.layer,s=c.size;return Gg(function(){s.field?a.size(s.field,s.values):a.size(s.values)},[s.field,s.scale,JSON.stringify(s.values),JSON.stringify(s.options)]),null}),Wg=["data"];function Xg(n,c){if(n==null)return{};var a=Yg(n,c),s,l;if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);for(l=0;l<p.length;l++)s=p[l],!(c.indexOf(s)>=0)&&(!Object.prototype.propertyIsEnumerable.call(n,s)||(a[s]=n[s]))}return a}function Yg(n,c){if(n==null)return{};var a={},s=Object.keys(n),l,p;for(p=0;p<s.length;p++)l=s[p],!(c.indexOf(l)>=0)&&(a[l]=n[l]);return a}var Kg=Qe.useEffect,$g=Qe.memo(function(c){var a=c.layer,s=c.source,l=s.data,p=Xg(s,Wg);return Kg(function(){a.inited?a.setData(l,p):a.source(l,p),p.autoFit&&a.fitBounds(p&&p.fitBoundsOptions)},[l,JSON.stringify(p)]),null}),Jg=Qe.useEffect,Qg=Qe.memo(function(c){var a=c.layer,s=c.style;return Jg(function(){a.style(s)},Object.keys(s).map(function(l){return s[l]})),null});function qg(n,c){return ny(n)||ry(n,c)||ty(n,c)||ey()}function ey(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function ty(n,c){if(!!n){if(typeof n=="string")return Am(n,c);var a=Object.prototype.toString.call(n).slice(8,-1);if(a==="Object"&&n.constructor&&(a=n.constructor.name),a==="Map"||a==="Set")return Array.from(n);if(a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return Am(n,c)}}function Am(n,c){(c==null||c>n.length)&&(c=n.length);for(var a=0,s=new Array(c);a<c;a++)s[a]=n[a];return s}function ry(n,c){var a=n==null?null:typeof Symbol!="undefined"&&n[Symbol.iterator]||n["@@iterator"];if(a!=null){var s=[],l=!0,p=!1,_,A;try{for(a=a.call(n);!(l=(_=a.next()).done)&&(s.push(_.value),!(c&&s.length===c));l=!0);}catch(M){p=!0,A=M}finally{try{!l&&a.return!=null&&a.return()}finally{if(p)throw A}}return s}}function ny(n){if(Array.isArray(n))return n}var Xp=Qe.useEffect,iy=Qe.useState;function Tm(n,c){var a=c.source,s=c.color,l=c.shape,p=c.style,_=c.size,A=c.scale,M=c.active,L=c.select,Y=c.filter,G=c.animate,ve=c.options,Fe=c.onLayerLoaded,ht=Rt(),It=iy(function(){var Vr;switch(n){case"polygonLayer":Vr=new Rr(ve);break;case"lineLayer":Vr=new sf(ve);break;case"pointLayer":Vr=new Br(ve);break;case"heatmapLayer":Vr=new el(ve);break;case"rasterLayer":Vr=new Tn(ve);break;case"imageLayer":Vr=new Bf(ve);break;case"citybuildingLayer":Vr=new oe(ve);break;default:Vr=new Rr(ve)}return Vr.on("inited",function(){Fe&&Fe(Vr,ht)}),Vr}),pr=qg(It,1),Cr=pr[0];return Xp(function(){return ht.addLayer(Cr),function(){ht.removeLayer(Cr)}},[]),Xp(function(){Cr.inited&&ve&&Cr.updateLayerConfig(ve)},[ve==null?void 0:ve.minZoom,ve==null?void 0:ve.maxZoom,ve==null?void 0:ve.visible]),Xp(function(){Cr.inited&&(ve==null?void 0:ve.zIndex)&&Cr.setIndex(ve.zIndex)},[ve==null?void 0:ve.zIndex]),Xp(function(){Cr.inited&&(ve==null?void 0:ve.blend)&&Cr.setBlend(ve.blend)},[ve==null?void 0:ve.blend]),Xp(function(){ht.render()}),Qe.createElement(wm.Provider,{value:Cr},Qe.createElement($g,{layer:Cr,source:a}),A&&Qe.createElement(zg,{layer:Cr,scale:A}),s&&Qe.createElement(kg,{layer:Cr,color:s}),_&&Qe.createElement(Hg,{layer:Cr,size:_}),l&&Qe.createElement(Vg,{layer:Cr,shape:l}),p&&Qe.createElement(Qg,{layer:Cr,style:p}),M&&Qe.createElement(Og,{layer:Cr,active:M}),L&&Qe.createElement(Ug,{layer:Cr,select:L}),Y&&Qe.createElement(Bg,{layer:Cr,filter:Y}),G&&Qe.createElement(Rg,{layer:Cr,animate:G}),c.children)}var y1=null,_1=null,Pm=Qe.memo(function(c){return Tm("pointLayer",c)}),ay=Qe.memo(function(c){return Tm("heatmapLayer",c)}),x1=null,b1=null,S1=null,E1=Qe.useEffect,C1=null,w1=null;function Ed(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ed=function(a){return typeof a}:Ed=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ed(n)}function Mm(n,c){var a=Object.keys(n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(n);c&&(s=s.filter(function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable})),a.push.apply(a,s)}return a}function Cd(n){for(var c=1;c<arguments.length;c++){var a=arguments[c]!=null?arguments[c]:{};c%2?Mm(Object(a),!0).forEach(function(s){oy(n,s,a[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(a)):Mm(Object(a)).forEach(function(s){Object.defineProperty(n,s,Object.getOwnPropertyDescriptor(a,s))})}return n}function oy(n,c,a){return c in n?Object.defineProperty(n,c,{value:a,enumerable:!0,configurable:!0,writable:!0}):n[c]=a,n}function sy(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Im(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function uy(n,c,a){return c&&Im(n.prototype,c),a&&Im(n,a),n}function ly(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Hd(n,c)}function Hd(n,c){return Hd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Hd(n,c)}function cy(n){var c=py();return function(){var s=wd(n),l;if(c){var p=wd(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return fy(this,l)}}function fy(n,c){if(c&&(Ed(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return hy(n)}function hy(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function py(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function wd(n){return wd=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},wd(n)}var A1=function(n){ly(a,n);var c=cy(a);function a(s){var l;return sy(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.popup=void 0,l.el=document.createElement("div"),l}return uy(a,[{key:"componentDidMount",value:function(){var l,p=this.props,_=p.lnglat,A=p.children,M=p.option,L=p.lngLat,Y=new nc(Cd(Cd({},M),{},{stopPropagation:(l=this.props.option)===null||l===void 0?void 0:l.stopPropagation}));_&&Y.setLnglat(_),L&&Y.setLnglat(L),A&&Y.setDOMContent(this.el),this.popup=Y,this.scene.addPopup(Y)}},{key:"componentDidUpdate",value:function(l){var p,_,A,M,L,Y,G=Array.isArray(l.lnglat)?l.lnglat:[l==null||(p=l.lnglat)===null||p===void 0?void 0:p.lng,l==null||(_=l.lnglat)===null||_===void 0?void 0:_.lat],ve=Array.isArray(this.props.lnglat)?this.props.lnglat:[(A=this.props)===null||A===void 0||(M=A.lnglat)===null||M===void 0?void 0:M.lng,(L=this.props)===null||L===void 0||(Y=L.lnglat)===null||Y===void 0?void 0:Y.lat],Fe=G.toString()!==ve.toString();if(Fe){var ht;this.popup.remove(),this.popup=new nc(Cd(Cd({},this.props.option),{},{stopPropagation:(ht=this.props.option)===null||ht===void 0?void 0:ht.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setDOMContent(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var l=this;return Qe.createElement($e.Consumer,{},function(p){return p&&(l.scene=p),(0,Em.createPortal)(l.props.children,l.el)})}}]),a}(Qe.PureComponent);function Ad(n){return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Ad=function(a){return typeof a}:Ad=function(a){return a&&typeof Symbol=="function"&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},Ad(n)}function dy(n,c){if(!(n instanceof c))throw new TypeError("Cannot call a class as a function")}function Om(n,c){for(var a=0;a<c.length;a++){var s=c[a];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(n,s.key,s)}}function vy(n,c,a){return c&&Om(n.prototype,c),a&&Om(n,a),n}function gy(n,c){if(typeof c!="function"&&c!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(c&&c.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),c&&Wd(n,c)}function Wd(n,c){return Wd=Object.setPrototypeOf||function(s,l){return s.__proto__=l,s},Wd(n,c)}function yy(n){var c=by();return function(){var s=Td(n),l;if(c){var p=Td(this).constructor;l=Reflect.construct(s,arguments,p)}else l=s.apply(this,arguments);return _y(this,l)}}function _y(n,c){if(c&&(Ad(c)==="object"||typeof c=="function"))return c;if(c!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return xy(n)}function xy(n){if(n===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return n}function by(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(n){return!1}}function Td(n){return Td=Object.setPrototypeOf?Object.getPrototypeOf:function(a){return a.__proto__||Object.getPrototypeOf(a)},Td(n)}var T1=function(n){gy(a,n);var c=yy(a);function a(s){var l;return dy(this,a),l=c.call(this,s),l.el=void 0,l.scene=void 0,l.marker=void 0,l.el=document.createElement("div"),l}return vy(a,[{key:"componentDidMount",value:function(){var l=this.props,p=l.lnglat,_=l.children,A=l.option,M=l.onMarkerLoaded,L=new za(A);p&&L.setLnglat(p),_&&L.setElement(this.el),this.marker=L,M&&M(L),this.scene.addMarker(L)}},{key:"componentDidUpdate",value:function(l){var p,_=(l==null?void 0:l.lnglat.toString())!==((p=this.props)===null||p===void 0?void 0:p.lnglat.toString());_&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var l=this;return Qe.createElement($e.Consumer,{},function(p){return p&&(l.scene=p),(0,Em.createPortal)(l.props.children,l.el)})}}]),a}(Qe.PureComponent),P1=Qe.useEffect,M1=null,I1=null,O1=Qe.useEffect,L1=null,Sy=S(83832),Vi=S(85893),Ey=["#eff3ff","#c6dbef","#9ecae1","#6baed6","#4292c6","#2171b5","#084594"],Cy=function(n){(0,Ct.Z)(a,n);var c=(0,br.Z)(a);function a(){var s;(0,jt.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),s.state={data:null,grid:null,loading:!1},s}return(0,Tt.Z)(a,[{key:"componentDidMount",value:function(){var s=(0,ir.Z)(dr().mark(function p(){var _,A,M,L;return dr().wrap(function(G){for(;;)switch(G.prev=G.next){case 0:return G.next=2,Promise.all([fetch("https://gw.alipayobjects.com/os/bmw-prod/c5dba875-b6ea-4e88-b778-66a862906c93.json").then(function(ve){return ve.json()}),fetch("https://gw.alipayobjects.com/os/bmw-prod/8990e8b4-c58e-419b-afb9-8ea3daff2dd1.json").then(function(ve){return ve.json()})]);case 2:_=G.sent,A=(0,Yt.Z)(_,2),M=A[0],L=A[1],this.setState({data:M,grid:L,loading:!0});case 7:case"end":return G.stop()}},p,this)}));function l(){return s.apply(this,arguments)}return l}()},{key:"render",value:function(){var l=this.state,p=l.data,_=l.grid,A=l.loading;return A===!1?(0,Vi.jsx)(Sy.Z,{}):(0,Vi.jsxs)(og,{map:{center:[110.19382669582967,50.258134],pitch:0,style:"blank",zoom:1},style:{position:"relative",width:"100%",height:"452px"},children:[_&&(0,Vi.jsx)(ay,{source:{data:_,transforms:[{type:"hexagon",size:8e5,field:"capacity",method:"sum"}]},color:{values:"#ddd"},shape:{values:"hexagon"},style:{coverage:.7,opacity:.8}},"1"),p&&[(0,Vi.jsx)(Pm,{options:{autoFit:!0},source:{data:p},scale:{values:{color:{field:"cum_conf",type:"quantile"},size:{field:"cum_conf",type:"log"}}},color:{field:"cum_conf",values:Ey},shape:{values:"circle"},active:{option:{color:"#0c2c84"}},size:{field:"cum_conf",values:[0,30]},style:{opacity:.8}},"2"),(0,Vi.jsx)(Pm,{source:{data:p},color:{values:"#fff"},shape:{field:"Short_Name_ZH",values:"text"},filter:{field:"cum_conf",values:function(L){return L>2e3}},size:{values:12},style:{opacity:1,strokeOpacity:1,strokeWidth:0}},"5")]]})}}]),a}(Qe.Component),Lm=S(86582),wy=S(70499),Fh=S.n(wy);function Ay(n){return n*1<10?"0".concat(n):n}function Rm(){for(var n=[],c=0;c<24;c+=1)n.push({x:"".concat(Ay(c),":00"),y:Math.floor(Math.random()*200)+c*50});return n}var Ty=function(n){(0,Ct.Z)(a,n);var c=(0,br.Z)(a);function a(){var s;(0,jt.Z)(this,a);for(var l=arguments.length,p=new Array(l),_=0;_<l;_++)p[_]=arguments[_];return s=c.call.apply(c,[this].concat(p)),s.state={activeData:Rm()},s.timer=void 0,s.requestRef=void 0,s.loopData=function(){s.requestRef=requestAnimationFrame(function(){s.timer=window.setTimeout(function(){s.setState({activeData:Rm()},function(){s.loopData()})},1e3)})},s}return(0,Tt.Z)(a,[{key:"componentDidMount",value:function(){this.loopData()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.timer),this.requestRef&&cancelAnimationFrame(this.requestRef)}},{key:"render",value:function(){var l=this.state.activeData,p=l===void 0?[]:l;return(0,Vi.jsxs)("div",{className:Fh().activeChart,children:[(0,Vi.jsx)(Be.Z,{title:"Target Forecase",value:"Will"}),(0,Vi.jsx)("div",{style:{marginTop:32},children:(0,Vi.jsx)(Je.m,{data:p,xField:"x",forceFit:!0,yField:"y",height:84})}),p&&(0,Vi.jsxs)("div",{children:[(0,Vi.jsxs)("div",{className:Fh().activeChartGrid,children:[(0,Vi.jsxs)("p",{children:[(0,Lm.Z)(p).sort()[p.length-1].y+200," \u5104\u5186"]}),(0,Vi.jsxs)("p",{children:[(0,Lm.Z)(p).sort()[Math.floor(p.length/2)].y," \u5104\u5186"]})]}),(0,Vi.jsx)("div",{className:Fh().dashedLine,children:(0,Vi.jsx)("div",{className:Fh().line})}),(0,Vi.jsx)("div",{className:Fh().dashedLine,children:(0,Vi.jsx)("div",{className:Fh().line})})]}),p&&(0,Vi.jsxs)("div",{className:Fh().activeChartLegend,children:[(0,Vi.jsx)("span",{children:"00:00"}),(0,Vi.jsx)("span",{children:p[Math.floor(p.length/2)].x}),(0,Vi.jsx)("span",{children:p[p.length-1].x})]})]})}}]),a}(Qe.Component);function Py(){return Xd.apply(this,arguments)}function Xd(){return Xd=(0,ir.Z)(dr().mark(function n(){return dr().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",(0,$.WY)("/api/tags"));case 1:case"end":return a.stop()}},n)})),Xd.apply(this,arguments)}var My=S(19134),Dm=S.n(My),Iy=Be.Z.Countdown,Oy=Date.now()+1e3*60*60*24*2+1e3*30,Ly=function(){var c=(0,$.QT)(Py),a=c.loading,s=c.data,l=((s==null?void 0:s.list)||[]).map(function(p){return{id:+Date.now(),word:p.name,weight:p.value}});return(0,Vi.jsx)(bt.ZP,{breadcrumbRender:!1,children:(0,Vi.jsx)(Gt.Z,{children:(0,Vi.jsxs)(Vi.Fragment,{children:[(0,Vi.jsxs)(de.Z,{gutter:24,children:[(0,Vi.jsx)(ie.Z,{xl:18,lg:24,md:24,sm:24,xs:24,style:{marginBottom:24},children:(0,Vi.jsxs)(C.Z,{title:"Real-Time Trading",bordered:!1,children:[(0,Vi.jsxs)(de.Z,{children:[(0,Vi.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,Vi.jsx)(Be.Z,{title:"Today",suffix:"\u5186",value:Qt()(124543233).format("0,0")})}),(0,Vi.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,Vi.jsx)(Be.Z,{title:"Completion Rate",value:"92%"})}),(0,Vi.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,Vi.jsx)(Iy,{title:"Remaining Time",value:Oy,format:"HH:mm:ss:SSS"})}),(0,Vi.jsx)(ie.Z,{md:6,sm:12,xs:24,children:(0,Vi.jsx)(Be.Z,{title:"Second Volumn",suffix:"\u5186",value:Qt()(234).format("0,0")})})]}),(0,Vi.jsx)("div",{className:Dm().mapChart,children:(0,Vi.jsx)(Cy,{})})]})}),(0,Vi.jsxs)(ie.Z,{xl:6,lg:24,md:24,sm:24,xs:24,children:[(0,Vi.jsx)(C.Z,{title:"Promotion Forecast",style:{marginBottom:24},bordered:!1,children:(0,Vi.jsx)(Ty,{})}),(0,Vi.jsx)(C.Z,{title:"coupon",style:{marginBottom:24},bodyStyle:{textAlign:"center"},bordered:!1,children:(0,Vi.jsx)(Je.aC,{height:180,min:0,max:100,forceFit:!0,value:87,range:[0,25,50,75,100],statistic:{visible:!0,text:"High",color:"#30bf78"}})})]})]}),(0,Vi.jsxs)(de.Z,{gutter:24,children:[(0,Vi.jsx)(ie.Z,{xl:12,lg:24,sm:24,xs:24,style:{marginBottom:24},children:(0,Vi.jsx)(C.Z,{title:"Category Percentage",bordered:!1,className:Dm().pieCard,children:(0,Vi.jsxs)(de.Z,{style:{padding:"16px 0"},children:[(0,Vi.jsx)(ie.Z,{span:8,children:(0,Vi.jsx)(Je.TZ,{forceFit:!0,height:128,percent:.28})}),(0,Vi.jsx)(ie.Z,{span:8,children:(0,Vi.jsx)(Je.TZ,{color:"#5DDECF",forceFit:!0,height:128,percent:.22})}),(0,Vi.jsx)(ie.Z,{span:8,children:(0,Vi.jsx)(Je.TZ,{color:"#2FC25B",forceFit:!0,height:128,percent:.32})})]})})}),(0,Vi.jsx)(ie.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,Vi.jsx)(C.Z,{title:"Popular Keywords",loading:a,bordered:!1,bodyStyle:{overflow:"hidden"},children:(0,Vi.jsx)(Je.kB,{data:l,forceFit:!0,height:162,wordStyle:{fontSize:[10,20]},shape:"triangle"})})}),(0,Vi.jsx)(ie.Z,{xl:6,lg:12,sm:24,xs:24,style:{marginBottom:24},children:(0,Vi.jsx)(C.Z,{title:"Resource",bodyStyle:{textAlign:"center",fontSize:0},bordered:!1,children:(0,Vi.jsx)(Je.Kj,{height:161,min:0,max:1e4,value:5639,forceFit:!0,padding:[0,0,0,0],statistic:{formatter:function(_){return"".concat((100*_/1e4).toFixed(1),"%")}}})})})]})]})})})},Ry=Ly},9187:function(zr){"use strict";zr.exports=B,zr.exports.default=B;function B(ce,Re,ge){ge=ge||2;var xt=Re&&Re.length,vt=xt?Re[0]*ge:ce.length,Nt=S(ce,0,vt,ge,!0),Dt=[];if(!Nt||Nt.next===Nt.prev)return Dt;var Ur,dn,on,$i,or,me,Ae;if(xt&&(Nt=se(ce,Re,Nt,ge)),ce.length>80*ge){Ur=on=ce[0],dn=$i=ce[1];for(var Ue=ge;Ue<vt;Ue+=ge)or=ce[Ue],me=ce[Ue+1],or<Ur&&(Ur=or),me<dn&&(dn=me),or>on&&(on=or),me>$i&&($i=me);Ae=Math.max(on-Ur,$i-dn),Ae=Ae!==0?1/Ae:0}return C(Nt,Dt,ge,Ur,dn,Ae),Dt}function S(ce,Re,ge,xt,vt){var Nt,Dt;if(vt===Xr(ce,Re,ge,xt)>0)for(Nt=Re;Nt<ge;Nt+=xt)Dt=Zt(Nt,ce[Nt],ce[Nt+1],Dt);else for(Nt=ge-xt;Nt>=Re;Nt-=xt)Dt=Zt(Nt,ce[Nt],ce[Nt+1],Dt);return Dt&&Ct(Dt,Dt.next)&&(xr(Dt),Dt=Dt.next),Dt}function ye(ce,Re){if(!ce)return ce;Re||(Re=ce);var ge=ce,xt;do if(xt=!1,!ge.steiner&&(Ct(ge,ge.next)||Tt(ge.prev,ge,ge.next)===0)){if(xr(ge),ge=Re=ge.prev,ge===ge.next)break;xt=!0}else ge=ge.next;while(xt||ge!==Re);return Re}function C(ce,Re,ge,xt,vt,Nt,Dt){if(!!ce){!Dt&&Nt&&Gt(ce,xt,vt,Nt);for(var Ur=ce,dn,on;ce.prev!==ce.next;){if(dn=ce.prev,on=ce.next,Nt?de(ce,xt,vt,Nt):d(ce)){Re.push(dn.i/ge),Re.push(ce.i/ge),Re.push(on.i/ge),xr(ce),ce=on.next,Ur=on.next;continue}if(ce=on,ce===Ur){Dt?Dt===1?(ce=re(ye(ce),Re,ge),C(ce,Re,ge,xt,vt,Nt,2)):Dt===2&&ie(ce,Re,ge,xt,vt,Nt):C(ye(ce),Re,ge,xt,vt,Nt,1);break}}}}function d(ce){var Re=ce.prev,ge=ce,xt=ce.next;if(Tt(Re,ge,xt)>=0)return!1;for(var vt=ce.next.next;vt!==ce.prev;){if(ir(Re.x,Re.y,ge.x,ge.y,xt.x,xt.y,vt.x,vt.y)&&Tt(vt.prev,vt,vt.next)>=0)return!1;vt=vt.next}return!0}function de(ce,Re,ge,xt){var vt=ce.prev,Nt=ce,Dt=ce.next;if(Tt(vt,Nt,Dt)>=0)return!1;for(var Ur=vt.x<Nt.x?vt.x<Dt.x?vt.x:Dt.x:Nt.x<Dt.x?Nt.x:Dt.x,dn=vt.y<Nt.y?vt.y<Dt.y?vt.y:Dt.y:Nt.y<Dt.y?Nt.y:Dt.y,on=vt.x>Nt.x?vt.x>Dt.x?vt.x:Dt.x:Nt.x>Dt.x?Nt.x:Dt.x,$i=vt.y>Nt.y?vt.y>Dt.y?vt.y:Dt.y:Nt.y>Dt.y?Nt.y:Dt.y,or=Qt(Ur,dn,Re,ge,xt),me=Qt(on,$i,Re,ge,xt),Ae=ce.prevZ,Ue=ce.nextZ;Ae&&Ae.z>=or&&Ue&&Ue.z<=me;){if(Ae!==ce.prev&&Ae!==ce.next&&ir(vt.x,vt.y,Nt.x,Nt.y,Dt.x,Dt.y,Ae.x,Ae.y)&&Tt(Ae.prev,Ae,Ae.next)>=0||(Ae=Ae.prevZ,Ue!==ce.prev&&Ue!==ce.next&&ir(vt.x,vt.y,Nt.x,Nt.y,Dt.x,Dt.y,Ue.x,Ue.y)&&Tt(Ue.prev,Ue,Ue.next)>=0))return!1;Ue=Ue.nextZ}for(;Ae&&Ae.z>=or;){if(Ae!==ce.prev&&Ae!==ce.next&&ir(vt.x,vt.y,Nt.x,Nt.y,Dt.x,Dt.y,Ae.x,Ae.y)&&Tt(Ae.prev,Ae,Ae.next)>=0)return!1;Ae=Ae.prevZ}for(;Ue&&Ue.z<=me;){if(Ue!==ce.prev&&Ue!==ce.next&&ir(vt.x,vt.y,Nt.x,Nt.y,Dt.x,Dt.y,Ue.x,Ue.y)&&Tt(Ue.prev,Ue,Ue.next)>=0)return!1;Ue=Ue.nextZ}return!0}function re(ce,Re,ge){var xt=ce;do{var vt=xt.prev,Nt=xt.next.next;!Ct(vt,Nt)&&br(vt,xt,xt.next,Nt)&&$e(vt,Nt)&&$e(Nt,vt)&&(Re.push(vt.i/ge),Re.push(xt.i/ge),Re.push(Nt.i/ge),xr(xt),xr(xt.next),xt=ce=Nt),xt=xt.next}while(xt!==ce);return ye(xt)}function ie(ce,Re,ge,xt,vt,Nt){var Dt=ce;do{for(var Ur=Dt.next.next;Ur!==Dt.prev;){if(Dt.i!==Ur.i&&jt(Dt,Ur)){var dn=Xe(Dt,Ur);Dt=ye(Dt,Dt.next),dn=ye(dn,dn.next),C(Dt,Re,ge,xt,vt,Nt),C(dn,Re,ge,xt,vt,Nt);return}Ur=Ur.next}Dt=Dt.next}while(Dt!==ce)}function se(ce,Re,ge,xt){var vt=[],Nt,Dt,Ur,dn,on;for(Nt=0,Dt=Re.length;Nt<Dt;Nt++)Ur=Re[Nt]*xt,dn=Nt<Dt-1?Re[Nt+1]*xt:ce.length,on=S(ce,Ur,dn,xt,!1),on===on.next&&(on.steiner=!0),vt.push(Yt(on));for(vt.sort(Be),Nt=0;Nt<vt.length;Nt++)ge=$(vt[Nt],ge),ge=ye(ge,ge.next);return ge}function Be(ce,Re){return ce.x-Re.x}function $(ce,Re){var ge=Je(ce,Re);if(!ge)return Re;var xt=Xe(ge,ce),vt=ye(ge,ge.next);return ye(xt,xt.next),Re===ge?vt:Re}function Je(ce,Re){var ge=Re,xt=ce.x,vt=ce.y,Nt=-Infinity,Dt;do{if(vt<=ge.y&&vt>=ge.next.y&&ge.next.y!==ge.y){var Ur=ge.x+(vt-ge.y)*(ge.next.x-ge.x)/(ge.next.y-ge.y);if(Ur<=xt&&Ur>Nt){if(Nt=Ur,Ur===xt){if(vt===ge.y)return ge;if(vt===ge.next.y)return ge.next}Dt=ge.x<ge.next.x?ge:ge.next}}ge=ge.next}while(ge!==Re);if(!Dt)return null;if(xt===Nt)return Dt;var dn=Dt,on=Dt.x,$i=Dt.y,or=Infinity,me;ge=Dt;do xt>=ge.x&&ge.x>=on&&xt!==ge.x&&ir(vt<$i?xt:Nt,vt,on,$i,vt<$i?Nt:xt,vt,ge.x,ge.y)&&(me=Math.abs(vt-ge.y)/(xt-ge.x),$e(ge,ce)&&(me<or||me===or&&(ge.x>Dt.x||ge.x===Dt.x&&bt(Dt,ge)))&&(Dt=ge,or=me)),ge=ge.next;while(ge!==dn);return Dt}function bt(ce,Re){return Tt(ce.prev,ce,Re.prev)<0&&Tt(Re.next,ce,ce.next)<0}function Gt(ce,Re,ge,xt){var vt=ce;do vt.z===null&&(vt.z=Qt(vt.x,vt.y,Re,ge,xt)),vt.prevZ=vt.prev,vt.nextZ=vt.next,vt=vt.next;while(vt!==ce);vt.prevZ.nextZ=null,vt.prevZ=null,Ir(vt)}function Ir(ce){var Re,ge,xt,vt,Nt,Dt,Ur,dn,on=1;do{for(ge=ce,ce=null,Nt=null,Dt=0;ge;){for(Dt++,xt=ge,Ur=0,Re=0;Re<on&&(Ur++,xt=xt.nextZ,!!xt);Re++);for(dn=on;Ur>0||dn>0&&xt;)Ur!==0&&(dn===0||!xt||ge.z<=xt.z)?(vt=ge,ge=ge.nextZ,Ur--):(vt=xt,xt=xt.nextZ,dn--),Nt?Nt.nextZ=vt:ce=vt,vt.prevZ=Nt,Nt=vt;ge=xt}Nt.nextZ=null,on*=2}while(Dt>1);return ce}function Qt(ce,Re,ge,xt,vt){return ce=32767*(ce-ge)*vt,Re=32767*(Re-xt)*vt,ce=(ce|ce<<8)&16711935,ce=(ce|ce<<4)&252645135,ce=(ce|ce<<2)&858993459,ce=(ce|ce<<1)&1431655765,Re=(Re|Re<<8)&16711935,Re=(Re|Re<<4)&252645135,Re=(Re|Re<<2)&858993459,Re=(Re|Re<<1)&1431655765,ce|Re<<1}function Yt(ce){var Re=ce,ge=ce;do(Re.x<ge.x||Re.x===ge.x&&Re.y<ge.y)&&(ge=Re),Re=Re.next;while(Re!==ce);return ge}function ir(ce,Re,ge,xt,vt,Nt,Dt,Ur){return(vt-Dt)*(Re-Ur)-(ce-Dt)*(Nt-Ur)>=0&&(ce-Dt)*(xt-Ur)-(ge-Dt)*(Re-Ur)>=0&&(ge-Dt)*(Nt-Ur)-(vt-Dt)*(xt-Ur)>=0}function jt(ce,Re){return ce.next.i!==Re.i&&ce.prev.i!==Re.i&&!Qe(ce,Re)&&($e(ce,Re)&&$e(Re,ce)&&Rt(ce,Re)&&(Tt(ce.prev,ce,Re.prev)||Tt(ce,Re.prev,Re))||Ct(ce,Re)&&Tt(ce.prev,ce,ce.next)>0&&Tt(Re.prev,Re,Re.next)>0)}function Tt(ce,Re,ge){return(Re.y-ce.y)*(ge.x-Re.x)-(Re.x-ce.x)*(ge.y-Re.y)}function Ct(ce,Re){return ce.x===Re.x&&ce.y===Re.y}function br(ce,Re,ge,xt){var vt=dr(Tt(ce,Re,ge)),Nt=dr(Tt(ce,Re,xt)),Dt=dr(Tt(ge,xt,ce)),Ur=dr(Tt(ge,xt,Re));return!!(vt!==Nt&&Dt!==Ur||vt===0&&q(ce,ge,Re)||Nt===0&&q(ce,xt,Re)||Dt===0&&q(ge,ce,xt)||Ur===0&&q(ge,Re,xt))}function q(ce,Re,ge){return Re.x<=Math.max(ce.x,ge.x)&&Re.x>=Math.min(ce.x,ge.x)&&Re.y<=Math.max(ce.y,ge.y)&&Re.y>=Math.min(ce.y,ge.y)}function dr(ce){return ce>0?1:ce<0?-1:0}function Qe(ce,Re){var ge=ce;do{if(ge.i!==ce.i&&ge.next.i!==ce.i&&ge.i!==Re.i&&ge.next.i!==Re.i&&br(ge,ge.next,ce,Re))return!0;ge=ge.next}while(ge!==ce);return!1}function $e(ce,Re){return Tt(ce.prev,ce,ce.next)<0?Tt(ce,Re,ce.next)>=0&&Tt(ce,ce.prev,Re)>=0:Tt(ce,Re,ce.prev)<0||Tt(ce,ce.next,Re)<0}function Rt(ce,Re){var ge=ce,xt=!1,vt=(ce.x+Re.x)/2,Nt=(ce.y+Re.y)/2;do ge.y>Nt!=ge.next.y>Nt&&ge.next.y!==ge.y&&vt<(ge.next.x-ge.x)*(Nt-ge.y)/(ge.next.y-ge.y)+ge.x&&(xt=!xt),ge=ge.next;while(ge!==ce);return xt}function Xe(ce,Re){var ge=new qt(ce.i,ce.x,ce.y),xt=new qt(Re.i,Re.x,Re.y),vt=ce.next,Nt=Re.prev;return ce.next=Re,Re.prev=ce,ge.next=vt,vt.prev=ge,xt.next=ge,ge.prev=xt,Nt.next=xt,xt.prev=Nt,xt}function Zt(ce,Re,ge,xt){var vt=new qt(ce,Re,ge);return xt?(vt.next=xt.next,vt.prev=xt,xt.next.prev=vt,xt.next=vt):(vt.prev=vt,vt.next=vt),vt}function xr(ce){ce.next.prev=ce.prev,ce.prev.next=ce.next,ce.prevZ&&(ce.prevZ.nextZ=ce.nextZ),ce.nextZ&&(ce.nextZ.prevZ=ce.prevZ)}function qt(ce,Re,ge){this.i=ce,this.x=Re,this.y=ge,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}B.deviation=function(ce,Re,ge,xt){var vt=Re&&Re.length,Nt=vt?Re[0]*ge:ce.length,Dt=Math.abs(Xr(ce,0,Nt,ge));if(vt)for(var Ur=0,dn=Re.length;Ur<dn;Ur++){var on=Re[Ur]*ge,$i=Ur<dn-1?Re[Ur+1]*ge:ce.length;Dt-=Math.abs(Xr(ce,on,$i,ge))}var or=0;for(Ur=0;Ur<xt.length;Ur+=3){var me=xt[Ur]*ge,Ae=xt[Ur+1]*ge,Ue=xt[Ur+2]*ge;or+=Math.abs((ce[me]-ce[Ue])*(ce[Ae+1]-ce[me+1])-(ce[me]-ce[Ae])*(ce[Ue+1]-ce[me+1]))}return Dt===0&&or===0?0:Math.abs((or-Dt)/Dt)};function Xr(ce,Re,ge,xt){for(var vt=0,Nt=Re,Dt=ge-xt;Nt<ge;Nt+=xt)vt+=(ce[Dt]-ce[Nt])*(ce[Nt+1]+ce[Dt+1]),Dt=Nt;return vt}B.flatten=function(ce){for(var Re=ce[0][0].length,ge={vertices:[],holes:[],dimensions:Re},xt=0,vt=0;vt<ce.length;vt++){for(var Nt=0;Nt<ce[vt].length;Nt++)for(var Dt=0;Dt<Re;Dt++)ge.vertices.push(ce[vt][Nt][Dt]);vt>0&&(xt+=ce[vt-1].length,ge.holes.push(xt))}return ge}},67709:function(zr){function B(ye){var C=ye.target||ye.srcElement;C.__resizeRAF__&&cancelAnimationFrame(C.__resizeRAF__),C.__resizeRAF__=requestAnimationFrame(function(){var d=C.__resizeTrigger__,de=d&&d.__resizeListeners__;de&&de.forEach(function(re){re.call(d,ye)})})}var S=function(C,d){var de=this,re=de.document,ie,se=re.attachEvent;typeof navigator!="undefined"&&(ie=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Be(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",B)}if(!C.__resizeListeners__)if(C.__resizeListeners__=[],se)C.__resizeTrigger__=C,C.attachEvent("onresize",B);else{getComputedStyle(C).position==="static"&&(C.style.position="relative");var $=C.__resizeTrigger__=re.createElement("object");$.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),$.setAttribute("class","resize-sensor"),$.setAttribute("tabindex","-1"),$.setAttribute("title",""),$.__resizeElement__=C,$.onload=Be,$.type="text/html",ie&&C.appendChild($),$.data="about:blank",ie||C.appendChild($)}C.__resizeListeners__.push(d)};zr.exports=typeof window=="undefined"?S:S.bind(window),zr.exports.unbind=function(ye,C){var d=document.attachEvent,de=ye.__resizeListeners__||[];if(C){var re=de.indexOf(C);re!==-1&&de.splice(re,1)}else de=ye.__resizeListeners__=[];if(!de.length){if(d)ye.detachEvent("onresize",B);else if(ye.__resizeTrigger__){var ie=ye.__resizeTrigger__.contentDocument,se=ie&&ie.defaultView;se&&(se.removeEventListener("resize",B),delete se.__resizeTrigger__),ye.__resizeTrigger__=!ye.removeChild(ye.__resizeTrigger__)}delete ye.__resizeListeners__}}},26729:function(zr){"use strict";var B=Object.prototype.hasOwnProperty,S="~";function ye(){}Object.create&&(ye.prototype=Object.create(null),new ye().__proto__||(S=!1));function C(ie,se,Be){this.fn=ie,this.context=se,this.once=Be||!1}function d(ie,se,Be,$,Je){if(typeof Be!="function")throw new TypeError("The listener must be a function");var bt=new C(Be,$||ie,Je),Gt=S?S+se:se;return ie._events[Gt]?ie._events[Gt].fn?ie._events[Gt]=[ie._events[Gt],bt]:ie._events[Gt].push(bt):(ie._events[Gt]=bt,ie._eventsCount++),ie}function de(ie,se){--ie._eventsCount==0?ie._events=new ye:delete ie._events[se]}function re(){this._events=new ye,this._eventsCount=0}re.prototype.eventNames=function(){var se=[],Be,$;if(this._eventsCount===0)return se;for($ in Be=this._events)B.call(Be,$)&&se.push(S?$.slice(1):$);return Object.getOwnPropertySymbols?se.concat(Object.getOwnPropertySymbols(Be)):se},re.prototype.listeners=function(se){var Be=S?S+se:se,$=this._events[Be];if(!$)return[];if($.fn)return[$.fn];for(var Je=0,bt=$.length,Gt=new Array(bt);Je<bt;Je++)Gt[Je]=$[Je].fn;return Gt},re.prototype.listenerCount=function(se){var Be=S?S+se:se,$=this._events[Be];return $?$.fn?1:$.length:0},re.prototype.emit=function(se,Be,$,Je,bt,Gt){var Ir=S?S+se:se;if(!this._events[Ir])return!1;var Qt=this._events[Ir],Yt=arguments.length,ir,jt;if(Qt.fn){switch(Qt.once&&this.removeListener(se,Qt.fn,void 0,!0),Yt){case 1:return Qt.fn.call(Qt.context),!0;case 2:return Qt.fn.call(Qt.context,Be),!0;case 3:return Qt.fn.call(Qt.context,Be,$),!0;case 4:return Qt.fn.call(Qt.context,Be,$,Je),!0;case 5:return Qt.fn.call(Qt.context,Be,$,Je,bt),!0;case 6:return Qt.fn.call(Qt.context,Be,$,Je,bt,Gt),!0}for(jt=1,ir=new Array(Yt-1);jt<Yt;jt++)ir[jt-1]=arguments[jt];Qt.fn.apply(Qt.context,ir)}else{var Tt=Qt.length,Ct;for(jt=0;jt<Tt;jt++)switch(Qt[jt].once&&this.removeListener(se,Qt[jt].fn,void 0,!0),Yt){case 1:Qt[jt].fn.call(Qt[jt].context);break;case 2:Qt[jt].fn.call(Qt[jt].context,Be);break;case 3:Qt[jt].fn.call(Qt[jt].context,Be,$);break;case 4:Qt[jt].fn.call(Qt[jt].context,Be,$,Je);break;default:if(!ir)for(Ct=1,ir=new Array(Yt-1);Ct<Yt;Ct++)ir[Ct-1]=arguments[Ct];Qt[jt].fn.apply(Qt[jt].context,ir)}}return!0},re.prototype.on=function(se,Be,$){return d(this,se,Be,$,!1)},re.prototype.once=function(se,Be,$){return d(this,se,Be,$,!0)},re.prototype.removeListener=function(se,Be,$,Je){var bt=S?S+se:se;if(!this._events[bt])return this;if(!Be)return de(this,bt),this;var Gt=this._events[bt];if(Gt.fn)Gt.fn===Be&&(!Je||Gt.once)&&(!$||Gt.context===$)&&de(this,bt);else{for(var Ir=0,Qt=[],Yt=Gt.length;Ir<Yt;Ir++)(Gt[Ir].fn!==Be||Je&&!Gt[Ir].once||$&&Gt[Ir].context!==$)&&Qt.push(Gt[Ir]);Qt.length?this._events[bt]=Qt.length===1?Qt[0]:Qt:de(this,bt)}return this},re.prototype.removeAllListeners=function(se){var Be;return se?(Be=S?S+se:se,this._events[Be]&&de(this,Be)):(this._events=new ye,this._eventsCount=0),this},re.prototype.off=re.prototype.removeListener,re.prototype.addListener=re.prototype.on,re.prefixed=S,re.EventEmitter=re,zr.exports=re},85975:function(zr,B,S){"use strict";S.r(B),S.d(B,{create:function(){return C},clone:function(){return d},copy:function(){return de},fromValues:function(){return re},set:function(){return ie},identity:function(){return se},transpose:function(){return Be},invert:function(){return $},adjoint:function(){return Je},determinant:function(){return bt},multiply:function(){return Gt},translate:function(){return Ir},scale:function(){return Qt},rotate:function(){return Yt},rotateX:function(){return ir},rotateY:function(){return jt},rotateZ:function(){return Tt},fromTranslation:function(){return Ct},fromScaling:function(){return br},fromRotation:function(){return q},fromXRotation:function(){return dr},fromYRotation:function(){return Qe},fromZRotation:function(){return $e},fromRotationTranslation:function(){return Rt},fromQuat2:function(){return Xe},getTranslation:function(){return Zt},getScaling:function(){return xr},getRotation:function(){return qt},fromRotationTranslationScale:function(){return Xr},fromRotationTranslationScaleOrigin:function(){return ce},fromQuat:function(){return Re},frustum:function(){return ge},perspectiveNO:function(){return xt},perspective:function(){return vt},perspectiveZO:function(){return Nt},perspectiveFromFieldOfView:function(){return Dt},orthoNO:function(){return Ur},ortho:function(){return dn},orthoZO:function(){return on},lookAt:function(){return $i},targetTo:function(){return or},str:function(){return me},frob:function(){return Ae},add:function(){return Ue},subtract:function(){return Le},multiplyScalar:function(){return kt},multiplyScalarAndAdd:function(){return nr},exactEquals:function(){return _r},equals:function(){return Lr},mul:function(){return fr},sub:function(){return H}});var ye=S(49685);function C(){var E=new ye.WT(16);return ye.WT!=Float32Array&&(E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=0,E[12]=0,E[13]=0,E[14]=0),E[0]=1,E[5]=1,E[10]=1,E[15]=1,E}function d(E){var V=new ye.WT(16);return V[0]=E[0],V[1]=E[1],V[2]=E[2],V[3]=E[3],V[4]=E[4],V[5]=E[5],V[6]=E[6],V[7]=E[7],V[8]=E[8],V[9]=E[9],V[10]=E[10],V[11]=E[11],V[12]=E[12],V[13]=E[13],V[14]=E[14],V[15]=E[15],V}function de(E,V){return E[0]=V[0],E[1]=V[1],E[2]=V[2],E[3]=V[3],E[4]=V[4],E[5]=V[5],E[6]=V[6],E[7]=V[7],E[8]=V[8],E[9]=V[9],E[10]=V[10],E[11]=V[11],E[12]=V[12],E[13]=V[13],E[14]=V[14],E[15]=V[15],E}function re(E,V,Ze,tt,ut,wt,K,Ht,Tr,Or,Ye,lt,At,zt,wr,Pr){var er=new ye.WT(16);return er[0]=E,er[1]=V,er[2]=Ze,er[3]=tt,er[4]=ut,er[5]=wt,er[6]=K,er[7]=Ht,er[8]=Tr,er[9]=Or,er[10]=Ye,er[11]=lt,er[12]=At,er[13]=zt,er[14]=wr,er[15]=Pr,er}function ie(E,V,Ze,tt,ut,wt,K,Ht,Tr,Or,Ye,lt,At,zt,wr,Pr,er){return E[0]=V,E[1]=Ze,E[2]=tt,E[3]=ut,E[4]=wt,E[5]=K,E[6]=Ht,E[7]=Tr,E[8]=Or,E[9]=Ye,E[10]=lt,E[11]=At,E[12]=zt,E[13]=wr,E[14]=Pr,E[15]=er,E}function se(E){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Be(E,V){if(E===V){var Ze=V[1],tt=V[2],ut=V[3],wt=V[6],K=V[7],Ht=V[11];E[1]=V[4],E[2]=V[8],E[3]=V[12],E[4]=Ze,E[6]=V[9],E[7]=V[13],E[8]=tt,E[9]=wt,E[11]=V[14],E[12]=ut,E[13]=K,E[14]=Ht}else E[0]=V[0],E[1]=V[4],E[2]=V[8],E[3]=V[12],E[4]=V[1],E[5]=V[5],E[6]=V[9],E[7]=V[13],E[8]=V[2],E[9]=V[6],E[10]=V[10],E[11]=V[14],E[12]=V[3],E[13]=V[7],E[14]=V[11],E[15]=V[15];return E}function $(E,V){var Ze=V[0],tt=V[1],ut=V[2],wt=V[3],K=V[4],Ht=V[5],Tr=V[6],Or=V[7],Ye=V[8],lt=V[9],At=V[10],zt=V[11],wr=V[12],Pr=V[13],er=V[14],Jr=V[15],Yr=Ze*Ht-tt*K,En=Ze*Tr-ut*K,_n=Ze*Or-wt*K,ei=tt*Tr-ut*Ht,si=tt*Or-wt*Ht,na=ut*Or-wt*Tr,Zi=Ye*Pr-lt*wr,Pi=Ye*er-At*wr,X=Ye*Jr-zt*wr,ue=lt*er-At*Pr,pe=lt*Jr-zt*Pr,F=At*Jr-zt*er,ee=Yr*F-En*pe+_n*ue+ei*X-si*Pi+na*Zi;return ee?(ee=1/ee,E[0]=(Ht*F-Tr*pe+Or*ue)*ee,E[1]=(ut*pe-tt*F-wt*ue)*ee,E[2]=(Pr*na-er*si+Jr*ei)*ee,E[3]=(At*si-lt*na-zt*ei)*ee,E[4]=(Tr*X-K*F-Or*Pi)*ee,E[5]=(Ze*F-ut*X+wt*Pi)*ee,E[6]=(er*_n-wr*na-Jr*En)*ee,E[7]=(Ye*na-At*_n+zt*En)*ee,E[8]=(K*pe-Ht*X+Or*Zi)*ee,E[9]=(tt*X-Ze*pe-wt*Zi)*ee,E[10]=(wr*si-Pr*_n+Jr*Yr)*ee,E[11]=(lt*_n-Ye*si-zt*Yr)*ee,E[12]=(Ht*Pi-K*ue-Tr*Zi)*ee,E[13]=(Ze*ue-tt*Pi+ut*Zi)*ee,E[14]=(Pr*En-wr*ei-er*Yr)*ee,E[15]=(Ye*ei-lt*En+At*Yr)*ee,E):null}function Je(E,V){var Ze=V[0],tt=V[1],ut=V[2],wt=V[3],K=V[4],Ht=V[5],Tr=V[6],Or=V[7],Ye=V[8],lt=V[9],At=V[10],zt=V[11],wr=V[12],Pr=V[13],er=V[14],Jr=V[15];return E[0]=Ht*(At*Jr-zt*er)-lt*(Tr*Jr-Or*er)+Pr*(Tr*zt-Or*At),E[1]=-(tt*(At*Jr-zt*er)-lt*(ut*Jr-wt*er)+Pr*(ut*zt-wt*At)),E[2]=tt*(Tr*Jr-Or*er)-Ht*(ut*Jr-wt*er)+Pr*(ut*Or-wt*Tr),E[3]=-(tt*(Tr*zt-Or*At)-Ht*(ut*zt-wt*At)+lt*(ut*Or-wt*Tr)),E[4]=-(K*(At*Jr-zt*er)-Ye*(Tr*Jr-Or*er)+wr*(Tr*zt-Or*At)),E[5]=Ze*(At*Jr-zt*er)-Ye*(ut*Jr-wt*er)+wr*(ut*zt-wt*At),E[6]=-(Ze*(Tr*Jr-Or*er)-K*(ut*Jr-wt*er)+wr*(ut*Or-wt*Tr)),E[7]=Ze*(Tr*zt-Or*At)-K*(ut*zt-wt*At)+Ye*(ut*Or-wt*Tr),E[8]=K*(lt*Jr-zt*Pr)-Ye*(Ht*Jr-Or*Pr)+wr*(Ht*zt-Or*lt),E[9]=-(Ze*(lt*Jr-zt*Pr)-Ye*(tt*Jr-wt*Pr)+wr*(tt*zt-wt*lt)),E[10]=Ze*(Ht*Jr-Or*Pr)-K*(tt*Jr-wt*Pr)+wr*(tt*Or-wt*Ht),E[11]=-(Ze*(Ht*zt-Or*lt)-K*(tt*zt-wt*lt)+Ye*(tt*Or-wt*Ht)),E[12]=-(K*(lt*er-At*Pr)-Ye*(Ht*er-Tr*Pr)+wr*(Ht*At-Tr*lt)),E[13]=Ze*(lt*er-At*Pr)-Ye*(tt*er-ut*Pr)+wr*(tt*At-ut*lt),E[14]=-(Ze*(Ht*er-Tr*Pr)-K*(tt*er-ut*Pr)+wr*(tt*Tr-ut*Ht)),E[15]=Ze*(Ht*At-Tr*lt)-K*(tt*At-ut*lt)+Ye*(tt*Tr-ut*Ht),E}function bt(E){var V=E[0],Ze=E[1],tt=E[2],ut=E[3],wt=E[4],K=E[5],Ht=E[6],Tr=E[7],Or=E[8],Ye=E[9],lt=E[10],At=E[11],zt=E[12],wr=E[13],Pr=E[14],er=E[15],Jr=V*K-Ze*wt,Yr=V*Ht-tt*wt,En=V*Tr-ut*wt,_n=Ze*Ht-tt*K,ei=Ze*Tr-ut*K,si=tt*Tr-ut*Ht,na=Or*wr-Ye*zt,Zi=Or*Pr-lt*zt,Pi=Or*er-At*zt,X=Ye*Pr-lt*wr,ue=Ye*er-At*wr,pe=lt*er-At*Pr;return Jr*pe-Yr*ue+En*X+_n*Pi-ei*Zi+si*na}function Gt(E,V,Ze){var tt=V[0],ut=V[1],wt=V[2],K=V[3],Ht=V[4],Tr=V[5],Or=V[6],Ye=V[7],lt=V[8],At=V[9],zt=V[10],wr=V[11],Pr=V[12],er=V[13],Jr=V[14],Yr=V[15],En=Ze[0],_n=Ze[1],ei=Ze[2],si=Ze[3];return E[0]=En*tt+_n*Ht+ei*lt+si*Pr,E[1]=En*ut+_n*Tr+ei*At+si*er,E[2]=En*wt+_n*Or+ei*zt+si*Jr,E[3]=En*K+_n*Ye+ei*wr+si*Yr,En=Ze[4],_n=Ze[5],ei=Ze[6],si=Ze[7],E[4]=En*tt+_n*Ht+ei*lt+si*Pr,E[5]=En*ut+_n*Tr+ei*At+si*er,E[6]=En*wt+_n*Or+ei*zt+si*Jr,E[7]=En*K+_n*Ye+ei*wr+si*Yr,En=Ze[8],_n=Ze[9],ei=Ze[10],si=Ze[11],E[8]=En*tt+_n*Ht+ei*lt+si*Pr,E[9]=En*ut+_n*Tr+ei*At+si*er,E[10]=En*wt+_n*Or+ei*zt+si*Jr,E[11]=En*K+_n*Ye+ei*wr+si*Yr,En=Ze[12],_n=Ze[13],ei=Ze[14],si=Ze[15],E[12]=En*tt+_n*Ht+ei*lt+si*Pr,E[13]=En*ut+_n*Tr+ei*At+si*er,E[14]=En*wt+_n*Or+ei*zt+si*Jr,E[15]=En*K+_n*Ye+ei*wr+si*Yr,E}function Ir(E,V,Ze){var tt=Ze[0],ut=Ze[1],wt=Ze[2],K,Ht,Tr,Or,Ye,lt,At,zt,wr,Pr,er,Jr;return V===E?(E[12]=V[0]*tt+V[4]*ut+V[8]*wt+V[12],E[13]=V[1]*tt+V[5]*ut+V[9]*wt+V[13],E[14]=V[2]*tt+V[6]*ut+V[10]*wt+V[14],E[15]=V[3]*tt+V[7]*ut+V[11]*wt+V[15]):(K=V[0],Ht=V[1],Tr=V[2],Or=V[3],Ye=V[4],lt=V[5],At=V[6],zt=V[7],wr=V[8],Pr=V[9],er=V[10],Jr=V[11],E[0]=K,E[1]=Ht,E[2]=Tr,E[3]=Or,E[4]=Ye,E[5]=lt,E[6]=At,E[7]=zt,E[8]=wr,E[9]=Pr,E[10]=er,E[11]=Jr,E[12]=K*tt+Ye*ut+wr*wt+V[12],E[13]=Ht*tt+lt*ut+Pr*wt+V[13],E[14]=Tr*tt+At*ut+er*wt+V[14],E[15]=Or*tt+zt*ut+Jr*wt+V[15]),E}function Qt(E,V,Ze){var tt=Ze[0],ut=Ze[1],wt=Ze[2];return E[0]=V[0]*tt,E[1]=V[1]*tt,E[2]=V[2]*tt,E[3]=V[3]*tt,E[4]=V[4]*ut,E[5]=V[5]*ut,E[6]=V[6]*ut,E[7]=V[7]*ut,E[8]=V[8]*wt,E[9]=V[9]*wt,E[10]=V[10]*wt,E[11]=V[11]*wt,E[12]=V[12],E[13]=V[13],E[14]=V[14],E[15]=V[15],E}function Yt(E,V,Ze,tt){var ut=tt[0],wt=tt[1],K=tt[2],Ht=Math.hypot(ut,wt,K),Tr,Or,Ye,lt,At,zt,wr,Pr,er,Jr,Yr,En,_n,ei,si,na,Zi,Pi,X,ue,pe,F,ee,he;return Ht<ye.Ib?null:(Ht=1/Ht,ut*=Ht,wt*=Ht,K*=Ht,Tr=Math.sin(Ze),Or=Math.cos(Ze),Ye=1-Or,lt=V[0],At=V[1],zt=V[2],wr=V[3],Pr=V[4],er=V[5],Jr=V[6],Yr=V[7],En=V[8],_n=V[9],ei=V[10],si=V[11],na=ut*ut*Ye+Or,Zi=wt*ut*Ye+K*Tr,Pi=K*ut*Ye-wt*Tr,X=ut*wt*Ye-K*Tr,ue=wt*wt*Ye+Or,pe=K*wt*Ye+ut*Tr,F=ut*K*Ye+wt*Tr,ee=wt*K*Ye-ut*Tr,he=K*K*Ye+Or,E[0]=lt*na+Pr*Zi+En*Pi,E[1]=At*na+er*Zi+_n*Pi,E[2]=zt*na+Jr*Zi+ei*Pi,E[3]=wr*na+Yr*Zi+si*Pi,E[4]=lt*X+Pr*ue+En*pe,E[5]=At*X+er*ue+_n*pe,E[6]=zt*X+Jr*ue+ei*pe,E[7]=wr*X+Yr*ue+si*pe,E[8]=lt*F+Pr*ee+En*he,E[9]=At*F+er*ee+_n*he,E[10]=zt*F+Jr*ee+ei*he,E[11]=wr*F+Yr*ee+si*he,V!==E&&(E[12]=V[12],E[13]=V[13],E[14]=V[14],E[15]=V[15]),E)}function ir(E,V,Ze){var tt=Math.sin(Ze),ut=Math.cos(Ze),wt=V[4],K=V[5],Ht=V[6],Tr=V[7],Or=V[8],Ye=V[9],lt=V[10],At=V[11];return V!==E&&(E[0]=V[0],E[1]=V[1],E[2]=V[2],E[3]=V[3],E[12]=V[12],E[13]=V[13],E[14]=V[14],E[15]=V[15]),E[4]=wt*ut+Or*tt,E[5]=K*ut+Ye*tt,E[6]=Ht*ut+lt*tt,E[7]=Tr*ut+At*tt,E[8]=Or*ut-wt*tt,E[9]=Ye*ut-K*tt,E[10]=lt*ut-Ht*tt,E[11]=At*ut-Tr*tt,E}function jt(E,V,Ze){var tt=Math.sin(Ze),ut=Math.cos(Ze),wt=V[0],K=V[1],Ht=V[2],Tr=V[3],Or=V[8],Ye=V[9],lt=V[10],At=V[11];return V!==E&&(E[4]=V[4],E[5]=V[5],E[6]=V[6],E[7]=V[7],E[12]=V[12],E[13]=V[13],E[14]=V[14],E[15]=V[15]),E[0]=wt*ut-Or*tt,E[1]=K*ut-Ye*tt,E[2]=Ht*ut-lt*tt,E[3]=Tr*ut-At*tt,E[8]=wt*tt+Or*ut,E[9]=K*tt+Ye*ut,E[10]=Ht*tt+lt*ut,E[11]=Tr*tt+At*ut,E}function Tt(E,V,Ze){var tt=Math.sin(Ze),ut=Math.cos(Ze),wt=V[0],K=V[1],Ht=V[2],Tr=V[3],Or=V[4],Ye=V[5],lt=V[6],At=V[7];return V!==E&&(E[8]=V[8],E[9]=V[9],E[10]=V[10],E[11]=V[11],E[12]=V[12],E[13]=V[13],E[14]=V[14],E[15]=V[15]),E[0]=wt*ut+Or*tt,E[1]=K*ut+Ye*tt,E[2]=Ht*ut+lt*tt,E[3]=Tr*ut+At*tt,E[4]=Or*ut-wt*tt,E[5]=Ye*ut-K*tt,E[6]=lt*ut-Ht*tt,E[7]=At*ut-Tr*tt,E}function Ct(E,V){return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=V[0],E[13]=V[1],E[14]=V[2],E[15]=1,E}function br(E,V){return E[0]=V[0],E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=V[1],E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=V[2],E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function q(E,V,Ze){var tt=Ze[0],ut=Ze[1],wt=Ze[2],K=Math.hypot(tt,ut,wt),Ht,Tr,Or;return K<ye.Ib?null:(K=1/K,tt*=K,ut*=K,wt*=K,Ht=Math.sin(V),Tr=Math.cos(V),Or=1-Tr,E[0]=tt*tt*Or+Tr,E[1]=ut*tt*Or+wt*Ht,E[2]=wt*tt*Or-ut*Ht,E[3]=0,E[4]=tt*ut*Or-wt*Ht,E[5]=ut*ut*Or+Tr,E[6]=wt*ut*Or+tt*Ht,E[7]=0,E[8]=tt*wt*Or+ut*Ht,E[9]=ut*wt*Or-tt*Ht,E[10]=wt*wt*Or+Tr,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E)}function dr(E,V){var Ze=Math.sin(V),tt=Math.cos(V);return E[0]=1,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=tt,E[6]=Ze,E[7]=0,E[8]=0,E[9]=-Ze,E[10]=tt,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Qe(E,V){var Ze=Math.sin(V),tt=Math.cos(V);return E[0]=tt,E[1]=0,E[2]=-Ze,E[3]=0,E[4]=0,E[5]=1,E[6]=0,E[7]=0,E[8]=Ze,E[9]=0,E[10]=tt,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function $e(E,V){var Ze=Math.sin(V),tt=Math.cos(V);return E[0]=tt,E[1]=Ze,E[2]=0,E[3]=0,E[4]=-Ze,E[5]=tt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=1,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function Rt(E,V,Ze){var tt=V[0],ut=V[1],wt=V[2],K=V[3],Ht=tt+tt,Tr=ut+ut,Or=wt+wt,Ye=tt*Ht,lt=tt*Tr,At=tt*Or,zt=ut*Tr,wr=ut*Or,Pr=wt*Or,er=K*Ht,Jr=K*Tr,Yr=K*Or;return E[0]=1-(zt+Pr),E[1]=lt+Yr,E[2]=At-Jr,E[3]=0,E[4]=lt-Yr,E[5]=1-(Ye+Pr),E[6]=wr+er,E[7]=0,E[8]=At+Jr,E[9]=wr-er,E[10]=1-(Ye+zt),E[11]=0,E[12]=Ze[0],E[13]=Ze[1],E[14]=Ze[2],E[15]=1,E}function Xe(E,V){var Ze=new ye.WT(3),tt=-V[0],ut=-V[1],wt=-V[2],K=V[3],Ht=V[4],Tr=V[5],Or=V[6],Ye=V[7],lt=tt*tt+ut*ut+wt*wt+K*K;return lt>0?(Ze[0]=(Ht*K+Ye*tt+Tr*wt-Or*ut)*2/lt,Ze[1]=(Tr*K+Ye*ut+Or*tt-Ht*wt)*2/lt,Ze[2]=(Or*K+Ye*wt+Ht*ut-Tr*tt)*2/lt):(Ze[0]=(Ht*K+Ye*tt+Tr*wt-Or*ut)*2,Ze[1]=(Tr*K+Ye*ut+Or*tt-Ht*wt)*2,Ze[2]=(Or*K+Ye*wt+Ht*ut-Tr*tt)*2),Rt(E,V,Ze),E}function Zt(E,V){return E[0]=V[12],E[1]=V[13],E[2]=V[14],E}function xr(E,V){var Ze=V[0],tt=V[1],ut=V[2],wt=V[4],K=V[5],Ht=V[6],Tr=V[8],Or=V[9],Ye=V[10];return E[0]=Math.hypot(Ze,tt,ut),E[1]=Math.hypot(wt,K,Ht),E[2]=Math.hypot(Tr,Or,Ye),E}function qt(E,V){var Ze=new ye.WT(3);xr(Ze,V);var tt=1/Ze[0],ut=1/Ze[1],wt=1/Ze[2],K=V[0]*tt,Ht=V[1]*ut,Tr=V[2]*wt,Or=V[4]*tt,Ye=V[5]*ut,lt=V[6]*wt,At=V[8]*tt,zt=V[9]*ut,wr=V[10]*wt,Pr=K+Ye+wr,er=0;return Pr>0?(er=Math.sqrt(Pr+1)*2,E[3]=.25*er,E[0]=(lt-zt)/er,E[1]=(At-Tr)/er,E[2]=(Ht-Or)/er):K>Ye&&K>wr?(er=Math.sqrt(1+K-Ye-wr)*2,E[3]=(lt-zt)/er,E[0]=.25*er,E[1]=(Ht+Or)/er,E[2]=(At+Tr)/er):Ye>wr?(er=Math.sqrt(1+Ye-K-wr)*2,E[3]=(At-Tr)/er,E[0]=(Ht+Or)/er,E[1]=.25*er,E[2]=(lt+zt)/er):(er=Math.sqrt(1+wr-K-Ye)*2,E[3]=(Ht-Or)/er,E[0]=(At+Tr)/er,E[1]=(lt+zt)/er,E[2]=.25*er),E}function Xr(E,V,Ze,tt){var ut=V[0],wt=V[1],K=V[2],Ht=V[3],Tr=ut+ut,Or=wt+wt,Ye=K+K,lt=ut*Tr,At=ut*Or,zt=ut*Ye,wr=wt*Or,Pr=wt*Ye,er=K*Ye,Jr=Ht*Tr,Yr=Ht*Or,En=Ht*Ye,_n=tt[0],ei=tt[1],si=tt[2];return E[0]=(1-(wr+er))*_n,E[1]=(At+En)*_n,E[2]=(zt-Yr)*_n,E[3]=0,E[4]=(At-En)*ei,E[5]=(1-(lt+er))*ei,E[6]=(Pr+Jr)*ei,E[7]=0,E[8]=(zt+Yr)*si,E[9]=(Pr-Jr)*si,E[10]=(1-(lt+wr))*si,E[11]=0,E[12]=Ze[0],E[13]=Ze[1],E[14]=Ze[2],E[15]=1,E}function ce(E,V,Ze,tt,ut){var wt=V[0],K=V[1],Ht=V[2],Tr=V[3],Or=wt+wt,Ye=K+K,lt=Ht+Ht,At=wt*Or,zt=wt*Ye,wr=wt*lt,Pr=K*Ye,er=K*lt,Jr=Ht*lt,Yr=Tr*Or,En=Tr*Ye,_n=Tr*lt,ei=tt[0],si=tt[1],na=tt[2],Zi=ut[0],Pi=ut[1],X=ut[2],ue=(1-(Pr+Jr))*ei,pe=(zt+_n)*ei,F=(wr-En)*ei,ee=(zt-_n)*si,he=(1-(At+Jr))*si,Te=(er+Yr)*si,ae=(wr+En)*na,Ee=(er-Yr)*na,mt=(1-(At+Pr))*na;return E[0]=ue,E[1]=pe,E[2]=F,E[3]=0,E[4]=ee,E[5]=he,E[6]=Te,E[7]=0,E[8]=ae,E[9]=Ee,E[10]=mt,E[11]=0,E[12]=Ze[0]+Zi-(ue*Zi+ee*Pi+ae*X),E[13]=Ze[1]+Pi-(pe*Zi+he*Pi+Ee*X),E[14]=Ze[2]+X-(F*Zi+Te*Pi+mt*X),E[15]=1,E}function Re(E,V){var Ze=V[0],tt=V[1],ut=V[2],wt=V[3],K=Ze+Ze,Ht=tt+tt,Tr=ut+ut,Or=Ze*K,Ye=tt*K,lt=tt*Ht,At=ut*K,zt=ut*Ht,wr=ut*Tr,Pr=wt*K,er=wt*Ht,Jr=wt*Tr;return E[0]=1-lt-wr,E[1]=Ye+Jr,E[2]=At-er,E[3]=0,E[4]=Ye-Jr,E[5]=1-Or-wr,E[6]=zt+Pr,E[7]=0,E[8]=At+er,E[9]=zt-Pr,E[10]=1-Or-lt,E[11]=0,E[12]=0,E[13]=0,E[14]=0,E[15]=1,E}function ge(E,V,Ze,tt,ut,wt,K){var Ht=1/(Ze-V),Tr=1/(ut-tt),Or=1/(wt-K);return E[0]=wt*2*Ht,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=wt*2*Tr,E[6]=0,E[7]=0,E[8]=(Ze+V)*Ht,E[9]=(ut+tt)*Tr,E[10]=(K+wt)*Or,E[11]=-1,E[12]=0,E[13]=0,E[14]=K*wt*2*Or,E[15]=0,E}function xt(E,V,Ze,tt,ut){var wt=1/Math.tan(V/2),K;return E[0]=wt/Ze,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=wt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,ut!=null&&ut!==Infinity?(K=1/(tt-ut),E[10]=(ut+tt)*K,E[14]=2*ut*tt*K):(E[10]=-1,E[14]=-2*tt),E}var vt=xt;function Nt(E,V,Ze,tt,ut){var wt=1/Math.tan(V/2),K;return E[0]=wt/Ze,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=wt,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[11]=-1,E[12]=0,E[13]=0,E[15]=0,ut!=null&&ut!==Infinity?(K=1/(tt-ut),E[10]=ut*K,E[14]=ut*tt*K):(E[10]=-1,E[14]=-tt),E}function Dt(E,V,Ze,tt){var ut=Math.tan(V.upDegrees*Math.PI/180),wt=Math.tan(V.downDegrees*Math.PI/180),K=Math.tan(V.leftDegrees*Math.PI/180),Ht=Math.tan(V.rightDegrees*Math.PI/180),Tr=2/(K+Ht),Or=2/(ut+wt);return E[0]=Tr,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=Or,E[6]=0,E[7]=0,E[8]=-((K-Ht)*Tr*.5),E[9]=(ut-wt)*Or*.5,E[10]=tt/(Ze-tt),E[11]=-1,E[12]=0,E[13]=0,E[14]=tt*Ze/(Ze-tt),E[15]=0,E}function Ur(E,V,Ze,tt,ut,wt,K){var Ht=1/(V-Ze),Tr=1/(tt-ut),Or=1/(wt-K);return E[0]=-2*Ht,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=-2*Tr,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=2*Or,E[11]=0,E[12]=(V+Ze)*Ht,E[13]=(ut+tt)*Tr,E[14]=(K+wt)*Or,E[15]=1,E}var dn=Ur;function on(E,V,Ze,tt,ut,wt,K){var Ht=1/(V-Ze),Tr=1/(tt-ut),Or=1/(wt-K);return E[0]=-2*Ht,E[1]=0,E[2]=0,E[3]=0,E[4]=0,E[5]=-2*Tr,E[6]=0,E[7]=0,E[8]=0,E[9]=0,E[10]=Or,E[11]=0,E[12]=(V+Ze)*Ht,E[13]=(ut+tt)*Tr,E[14]=wt*Or,E[15]=1,E}function $i(E,V,Ze,tt){var ut,wt,K,Ht,Tr,Or,Ye,lt,At,zt,wr=V[0],Pr=V[1],er=V[2],Jr=tt[0],Yr=tt[1],En=tt[2],_n=Ze[0],ei=Ze[1],si=Ze[2];return Math.abs(wr-_n)<ye.Ib&&Math.abs(Pr-ei)<ye.Ib&&Math.abs(er-si)<ye.Ib?se(E):(Ye=wr-_n,lt=Pr-ei,At=er-si,zt=1/Math.hypot(Ye,lt,At),Ye*=zt,lt*=zt,At*=zt,ut=Yr*At-En*lt,wt=En*Ye-Jr*At,K=Jr*lt-Yr*Ye,zt=Math.hypot(ut,wt,K),zt?(zt=1/zt,ut*=zt,wt*=zt,K*=zt):(ut=0,wt=0,K=0),Ht=lt*K-At*wt,Tr=At*ut-Ye*K,Or=Ye*wt-lt*ut,zt=Math.hypot(Ht,Tr,Or),zt?(zt=1/zt,Ht*=zt,Tr*=zt,Or*=zt):(Ht=0,Tr=0,Or=0),E[0]=ut,E[1]=Ht,E[2]=Ye,E[3]=0,E[4]=wt,E[5]=Tr,E[6]=lt,E[7]=0,E[8]=K,E[9]=Or,E[10]=At,E[11]=0,E[12]=-(ut*wr+wt*Pr+K*er),E[13]=-(Ht*wr+Tr*Pr+Or*er),E[14]=-(Ye*wr+lt*Pr+At*er),E[15]=1,E)}function or(E,V,Ze,tt){var ut=V[0],wt=V[1],K=V[2],Ht=tt[0],Tr=tt[1],Or=tt[2],Ye=ut-Ze[0],lt=wt-Ze[1],At=K-Ze[2],zt=Ye*Ye+lt*lt+At*At;zt>0&&(zt=1/Math.sqrt(zt),Ye*=zt,lt*=zt,At*=zt);var wr=Tr*At-Or*lt,Pr=Or*Ye-Ht*At,er=Ht*lt-Tr*Ye;return zt=wr*wr+Pr*Pr+er*er,zt>0&&(zt=1/Math.sqrt(zt),wr*=zt,Pr*=zt,er*=zt),E[0]=wr,E[1]=Pr,E[2]=er,E[3]=0,E[4]=lt*er-At*Pr,E[5]=At*wr-Ye*er,E[6]=Ye*Pr-lt*wr,E[7]=0,E[8]=Ye,E[9]=lt,E[10]=At,E[11]=0,E[12]=ut,E[13]=wt,E[14]=K,E[15]=1,E}function me(E){return"mat4("+E[0]+", "+E[1]+", "+E[2]+", "+E[3]+", "+E[4]+", "+E[5]+", "+E[6]+", "+E[7]+", "+E[8]+", "+E[9]+", "+E[10]+", "+E[11]+", "+E[12]+", "+E[13]+", "+E[14]+", "+E[15]+")"}function Ae(E){return Math.hypot(E[0],E[1],E[2],E[3],E[4],E[5],E[6],E[7],E[8],E[9],E[10],E[11],E[12],E[13],E[14],E[15])}function Ue(E,V,Ze){return E[0]=V[0]+Ze[0],E[1]=V[1]+Ze[1],E[2]=V[2]+Ze[2],E[3]=V[3]+Ze[3],E[4]=V[4]+Ze[4],E[5]=V[5]+Ze[5],E[6]=V[6]+Ze[6],E[7]=V[7]+Ze[7],E[8]=V[8]+Ze[8],E[9]=V[9]+Ze[9],E[10]=V[10]+Ze[10],E[11]=V[11]+Ze[11],E[12]=V[12]+Ze[12],E[13]=V[13]+Ze[13],E[14]=V[14]+Ze[14],E[15]=V[15]+Ze[15],E}function Le(E,V,Ze){return E[0]=V[0]-Ze[0],E[1]=V[1]-Ze[1],E[2]=V[2]-Ze[2],E[3]=V[3]-Ze[3],E[4]=V[4]-Ze[4],E[5]=V[5]-Ze[5],E[6]=V[6]-Ze[6],E[7]=V[7]-Ze[7],E[8]=V[8]-Ze[8],E[9]=V[9]-Ze[9],E[10]=V[10]-Ze[10],E[11]=V[11]-Ze[11],E[12]=V[12]-Ze[12],E[13]=V[13]-Ze[13],E[14]=V[14]-Ze[14],E[15]=V[15]-Ze[15],E}function kt(E,V,Ze){return E[0]=V[0]*Ze,E[1]=V[1]*Ze,E[2]=V[2]*Ze,E[3]=V[3]*Ze,E[4]=V[4]*Ze,E[5]=V[5]*Ze,E[6]=V[6]*Ze,E[7]=V[7]*Ze,E[8]=V[8]*Ze,E[9]=V[9]*Ze,E[10]=V[10]*Ze,E[11]=V[11]*Ze,E[12]=V[12]*Ze,E[13]=V[13]*Ze,E[14]=V[14]*Ze,E[15]=V[15]*Ze,E}function nr(E,V,Ze,tt){return E[0]=V[0]+Ze[0]*tt,E[1]=V[1]+Ze[1]*tt,E[2]=V[2]+Ze[2]*tt,E[3]=V[3]+Ze[3]*tt,E[4]=V[4]+Ze[4]*tt,E[5]=V[5]+Ze[5]*tt,E[6]=V[6]+Ze[6]*tt,E[7]=V[7]+Ze[7]*tt,E[8]=V[8]+Ze[8]*tt,E[9]=V[9]+Ze[9]*tt,E[10]=V[10]+Ze[10]*tt,E[11]=V[11]+Ze[11]*tt,E[12]=V[12]+Ze[12]*tt,E[13]=V[13]+Ze[13]*tt,E[14]=V[14]+Ze[14]*tt,E[15]=V[15]+Ze[15]*tt,E}function _r(E,V){return E[0]===V[0]&&E[1]===V[1]&&E[2]===V[2]&&E[3]===V[3]&&E[4]===V[4]&&E[5]===V[5]&&E[6]===V[6]&&E[7]===V[7]&&E[8]===V[8]&&E[9]===V[9]&&E[10]===V[10]&&E[11]===V[11]&&E[12]===V[12]&&E[13]===V[13]&&E[14]===V[14]&&E[15]===V[15]}function Lr(E,V){var Ze=E[0],tt=E[1],ut=E[2],wt=E[3],K=E[4],Ht=E[5],Tr=E[6],Or=E[7],Ye=E[8],lt=E[9],At=E[10],zt=E[11],wr=E[12],Pr=E[13],er=E[14],Jr=E[15],Yr=V[0],En=V[1],_n=V[2],ei=V[3],si=V[4],na=V[5],Zi=V[6],Pi=V[7],X=V[8],ue=V[9],pe=V[10],F=V[11],ee=V[12],he=V[13],Te=V[14],ae=V[15];return Math.abs(Ze-Yr)<=ye.Ib*Math.max(1,Math.abs(Ze),Math.abs(Yr))&&Math.abs(tt-En)<=ye.Ib*Math.max(1,Math.abs(tt),Math.abs(En))&&Math.abs(ut-_n)<=ye.Ib*Math.max(1,Math.abs(ut),Math.abs(_n))&&Math.abs(wt-ei)<=ye.Ib*Math.max(1,Math.abs(wt),Math.abs(ei))&&Math.abs(K-si)<=ye.Ib*Math.max(1,Math.abs(K),Math.abs(si))&&Math.abs(Ht-na)<=ye.Ib*Math.max(1,Math.abs(Ht),Math.abs(na))&&Math.abs(Tr-Zi)<=ye.Ib*Math.max(1,Math.abs(Tr),Math.abs(Zi))&&Math.abs(Or-Pi)<=ye.Ib*Math.max(1,Math.abs(Or),Math.abs(Pi))&&Math.abs(Ye-X)<=ye.Ib*Math.max(1,Math.abs(Ye),Math.abs(X))&&Math.abs(lt-ue)<=ye.Ib*Math.max(1,Math.abs(lt),Math.abs(ue))&&Math.abs(At-pe)<=ye.Ib*Math.max(1,Math.abs(At),Math.abs(pe))&&Math.abs(zt-F)<=ye.Ib*Math.max(1,Math.abs(zt),Math.abs(F))&&Math.abs(wr-ee)<=ye.Ib*Math.max(1,Math.abs(wr),Math.abs(ee))&&Math.abs(Pr-he)<=ye.Ib*Math.max(1,Math.abs(Pr),Math.abs(he))&&Math.abs(er-Te)<=ye.Ib*Math.max(1,Math.abs(er),Math.abs(Te))&&Math.abs(Jr-ae)<=ye.Ib*Math.max(1,Math.abs(Jr),Math.abs(ae))}var fr=Gt,H=Le},98333:function(zr,B,S){"use strict";S.d(B,{Ue:function(){return C},al:function(){return de},bA:function(){return ir},fF:function(){return qt}});var ye=S(49685);function C(){var me=new ye.WT(4);return ye.WT!=Float32Array&&(me[0]=0,me[1]=0,me[2]=0,me[3]=0),me}function d(me){var Ae=new glMatrix.ARRAY_TYPE(4);return Ae[0]=me[0],Ae[1]=me[1],Ae[2]=me[2],Ae[3]=me[3],Ae}function de(me,Ae,Ue,Le){var kt=new ye.WT(4);return kt[0]=me,kt[1]=Ae,kt[2]=Ue,kt[3]=Le,kt}function re(me,Ae){return me[0]=Ae[0],me[1]=Ae[1],me[2]=Ae[2],me[3]=Ae[3],me}function ie(me,Ae,Ue,Le,kt){return me[0]=Ae,me[1]=Ue,me[2]=Le,me[3]=kt,me}function se(me,Ae,Ue){return me[0]=Ae[0]+Ue[0],me[1]=Ae[1]+Ue[1],me[2]=Ae[2]+Ue[2],me[3]=Ae[3]+Ue[3],me}function Be(me,Ae,Ue){return me[0]=Ae[0]-Ue[0],me[1]=Ae[1]-Ue[1],me[2]=Ae[2]-Ue[2],me[3]=Ae[3]-Ue[3],me}function $(me,Ae,Ue){return me[0]=Ae[0]*Ue[0],me[1]=Ae[1]*Ue[1],me[2]=Ae[2]*Ue[2],me[3]=Ae[3]*Ue[3],me}function Je(me,Ae,Ue){return me[0]=Ae[0]/Ue[0],me[1]=Ae[1]/Ue[1],me[2]=Ae[2]/Ue[2],me[3]=Ae[3]/Ue[3],me}function bt(me,Ae){return me[0]=Math.ceil(Ae[0]),me[1]=Math.ceil(Ae[1]),me[2]=Math.ceil(Ae[2]),me[3]=Math.ceil(Ae[3]),me}function Gt(me,Ae){return me[0]=Math.floor(Ae[0]),me[1]=Math.floor(Ae[1]),me[2]=Math.floor(Ae[2]),me[3]=Math.floor(Ae[3]),me}function Ir(me,Ae,Ue){return me[0]=Math.min(Ae[0],Ue[0]),me[1]=Math.min(Ae[1],Ue[1]),me[2]=Math.min(Ae[2],Ue[2]),me[3]=Math.min(Ae[3],Ue[3]),me}function Qt(me,Ae,Ue){return me[0]=Math.max(Ae[0],Ue[0]),me[1]=Math.max(Ae[1],Ue[1]),me[2]=Math.max(Ae[2],Ue[2]),me[3]=Math.max(Ae[3],Ue[3]),me}function Yt(me,Ae){return me[0]=Math.round(Ae[0]),me[1]=Math.round(Ae[1]),me[2]=Math.round(Ae[2]),me[3]=Math.round(Ae[3]),me}function ir(me,Ae,Ue){return me[0]=Ae[0]*Ue,me[1]=Ae[1]*Ue,me[2]=Ae[2]*Ue,me[3]=Ae[3]*Ue,me}function jt(me,Ae,Ue,Le){return me[0]=Ae[0]+Ue[0]*Le,me[1]=Ae[1]+Ue[1]*Le,me[2]=Ae[2]+Ue[2]*Le,me[3]=Ae[3]+Ue[3]*Le,me}function Tt(me,Ae){var Ue=Ae[0]-me[0],Le=Ae[1]-me[1],kt=Ae[2]-me[2],nr=Ae[3]-me[3];return Math.hypot(Ue,Le,kt,nr)}function Ct(me,Ae){var Ue=Ae[0]-me[0],Le=Ae[1]-me[1],kt=Ae[2]-me[2],nr=Ae[3]-me[3];return Ue*Ue+Le*Le+kt*kt+nr*nr}function br(me){var Ae=me[0],Ue=me[1],Le=me[2],kt=me[3];return Math.hypot(Ae,Ue,Le,kt)}function q(me){var Ae=me[0],Ue=me[1],Le=me[2],kt=me[3];return Ae*Ae+Ue*Ue+Le*Le+kt*kt}function dr(me,Ae){return me[0]=-Ae[0],me[1]=-Ae[1],me[2]=-Ae[2],me[3]=-Ae[3],me}function Qe(me,Ae){return me[0]=1/Ae[0],me[1]=1/Ae[1],me[2]=1/Ae[2],me[3]=1/Ae[3],me}function $e(me,Ae){var Ue=Ae[0],Le=Ae[1],kt=Ae[2],nr=Ae[3],_r=Ue*Ue+Le*Le+kt*kt+nr*nr;return _r>0&&(_r=1/Math.sqrt(_r)),me[0]=Ue*_r,me[1]=Le*_r,me[2]=kt*_r,me[3]=nr*_r,me}function Rt(me,Ae){return me[0]*Ae[0]+me[1]*Ae[1]+me[2]*Ae[2]+me[3]*Ae[3]}function Xe(me,Ae,Ue,Le){var kt=Ue[0]*Le[1]-Ue[1]*Le[0],nr=Ue[0]*Le[2]-Ue[2]*Le[0],_r=Ue[0]*Le[3]-Ue[3]*Le[0],Lr=Ue[1]*Le[2]-Ue[2]*Le[1],fr=Ue[1]*Le[3]-Ue[3]*Le[1],H=Ue[2]*Le[3]-Ue[3]*Le[2],E=Ae[0],V=Ae[1],Ze=Ae[2],tt=Ae[3];return me[0]=V*H-Ze*fr+tt*Lr,me[1]=-(E*H)+Ze*_r-tt*nr,me[2]=E*fr-V*_r+tt*kt,me[3]=-(E*Lr)+V*nr-Ze*kt,me}function Zt(me,Ae,Ue,Le){var kt=Ae[0],nr=Ae[1],_r=Ae[2],Lr=Ae[3];return me[0]=kt+Le*(Ue[0]-kt),me[1]=nr+Le*(Ue[1]-nr),me[2]=_r+Le*(Ue[2]-_r),me[3]=Lr+Le*(Ue[3]-Lr),me}function xr(me,Ae){Ae=Ae||1;var Ue,Le,kt,nr,_r,Lr;do Ue=glMatrix.RANDOM()*2-1,Le=glMatrix.RANDOM()*2-1,_r=Ue*Ue+Le*Le;while(_r>=1);do kt=glMatrix.RANDOM()*2-1,nr=glMatrix.RANDOM()*2-1,Lr=kt*kt+nr*nr;while(Lr>=1);var fr=Math.sqrt((1-_r)/Lr);return me[0]=Ae*Ue,me[1]=Ae*Le,me[2]=Ae*kt*fr,me[3]=Ae*nr*fr,me}function qt(me,Ae,Ue){var Le=Ae[0],kt=Ae[1],nr=Ae[2],_r=Ae[3];return me[0]=Ue[0]*Le+Ue[4]*kt+Ue[8]*nr+Ue[12]*_r,me[1]=Ue[1]*Le+Ue[5]*kt+Ue[9]*nr+Ue[13]*_r,me[2]=Ue[2]*Le+Ue[6]*kt+Ue[10]*nr+Ue[14]*_r,me[3]=Ue[3]*Le+Ue[7]*kt+Ue[11]*nr+Ue[15]*_r,me}function Xr(me,Ae,Ue){var Le=Ae[0],kt=Ae[1],nr=Ae[2],_r=Ue[0],Lr=Ue[1],fr=Ue[2],H=Ue[3],E=H*Le+Lr*nr-fr*kt,V=H*kt+fr*Le-_r*nr,Ze=H*nr+_r*kt-Lr*Le,tt=-_r*Le-Lr*kt-fr*nr;return me[0]=E*H+tt*-_r+V*-fr-Ze*-Lr,me[1]=V*H+tt*-Lr+Ze*-_r-E*-fr,me[2]=Ze*H+tt*-fr+E*-Lr-V*-_r,me[3]=Ae[3],me}function ce(me){return me[0]=0,me[1]=0,me[2]=0,me[3]=0,me}function Re(me){return"vec4("+me[0]+", "+me[1]+", "+me[2]+", "+me[3]+")"}function ge(me,Ae){return me[0]===Ae[0]&&me[1]===Ae[1]&&me[2]===Ae[2]&&me[3]===Ae[3]}function xt(me,Ae){var Ue=me[0],Le=me[1],kt=me[2],nr=me[3],_r=Ae[0],Lr=Ae[1],fr=Ae[2],H=Ae[3];return Math.abs(Ue-_r)<=glMatrix.EPSILON*Math.max(1,Math.abs(Ue),Math.abs(_r))&&Math.abs(Le-Lr)<=glMatrix.EPSILON*Math.max(1,Math.abs(Le),Math.abs(Lr))&&Math.abs(kt-fr)<=glMatrix.EPSILON*Math.max(1,Math.abs(kt),Math.abs(fr))&&Math.abs(nr-H)<=glMatrix.EPSILON*Math.max(1,Math.abs(nr),Math.abs(H))}var vt=null,Nt=null,Dt=null,Ur=null,dn=null,on=null,$i=null,or=function(){var me=C();return function(Ae,Ue,Le,kt,nr,_r){var Lr,fr;for(Ue||(Ue=4),Le||(Le=0),kt?fr=Math.min(kt*Ue+Le,Ae.length):fr=Ae.length,Lr=Le;Lr<fr;Lr+=Ue)me[0]=Ae[Lr],me[1]=Ae[Lr+1],me[2]=Ae[Lr+2],me[3]=Ae[Lr+3],nr(me,me,_r),Ae[Lr]=me[0],Ae[Lr+1]=me[1],Ae[Lr+2]=me[2],Ae[Lr+3]=me[3];return Ae}}()},50840:function(zr,B,S){var ye;/*! Hammer.JS - v2.0.7 - 2016-04-22
* http://hammerjs.github.io/
*
* Copyright (c) 2016 Jorik Tangelder;
* Licensed under the MIT license */(function(C,d,de,re){"use strict";var ie=["","webkit","Moz","MS","ms","o"],se=d.createElement("div"),Be="function",$=Math.round,Je=Math.abs,bt=Date.now;function Gt(_e,De,pt){return setTimeout(br(_e,pt),De)}function Ir(_e,De,pt){return Array.isArray(_e)?(Qt(_e,pt[De],pt),!0):!1}function Qt(_e,De,pt){var $t;if(!!_e)if(_e.forEach)_e.forEach(De,pt);else if(_e.length!==re)for($t=0;$t<_e.length;)De.call(pt,_e[$t],$t,_e),$t++;else for($t in _e)_e.hasOwnProperty($t)&&De.call(pt,_e[$t],$t,_e)}function Yt(_e,De,pt){var $t="DEPRECATED METHOD: "+De+`
`+pt+` AT 
`;return function(){var en=new Error("get-stack-trace"),ti=en&&en.stack?en.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ai=C.console&&(C.console.warn||C.console.log);return Ai&&Ai.call(C.console,$t,ti),_e.apply(this,arguments)}}var ir;typeof Object.assign!="function"?ir=function(De){if(De===re||De===null)throw new TypeError("Cannot convert undefined or null to object");for(var pt=Object(De),$t=1;$t<arguments.length;$t++){var en=arguments[$t];if(en!==re&&en!==null)for(var ti in en)en.hasOwnProperty(ti)&&(pt[ti]=en[ti])}return pt}:ir=Object.assign;var jt=Yt(function(De,pt,$t){for(var en=Object.keys(pt),ti=0;ti<en.length;)(!$t||$t&&De[en[ti]]===re)&&(De[en[ti]]=pt[en[ti]]),ti++;return De},"extend","Use `assign`."),Tt=Yt(function(De,pt){return jt(De,pt,!0)},"merge","Use `assign`.");function Ct(_e,De,pt){var $t=De.prototype,en;en=_e.prototype=Object.create($t),en.constructor=_e,en._super=$t,pt&&ir(en,pt)}function br(_e,De){return function(){return _e.apply(De,arguments)}}function q(_e,De){return typeof _e==Be?_e.apply(De&&De[0]||re,De):_e}function dr(_e,De){return _e===re?De:_e}function Qe(_e,De,pt){Qt(Zt(De),function($t){_e.addEventListener($t,pt,!1)})}function $e(_e,De,pt){Qt(Zt(De),function($t){_e.removeEventListener($t,pt,!1)})}function Rt(_e,De){for(;_e;){if(_e==De)return!0;_e=_e.parentNode}return!1}function Xe(_e,De){return _e.indexOf(De)>-1}function Zt(_e){return _e.trim().split(/\s+/g)}function xr(_e,De,pt){if(_e.indexOf&&!pt)return _e.indexOf(De);for(var $t=0;$t<_e.length;){if(pt&&_e[$t][pt]==De||!pt&&_e[$t]===De)return $t;$t++}return-1}function qt(_e){return Array.prototype.slice.call(_e,0)}function Xr(_e,De,pt){for(var $t=[],en=[],ti=0;ti<_e.length;){var Ai=De?_e[ti][De]:_e[ti];xr(en,Ai)<0&&$t.push(_e[ti]),en[ti]=Ai,ti++}return pt&&(De?$t=$t.sort(function(Na,po){return Na[De]>po[De]}):$t=$t.sort()),$t}function ce(_e,De){for(var pt,$t,en=De[0].toUpperCase()+De.slice(1),ti=0;ti<ie.length;){if(pt=ie[ti],$t=pt?pt+en:De,$t in _e)return $t;ti++}return re}var Re=1;function ge(){return Re++}function xt(_e){var De=_e.ownerDocument||_e;return De.defaultView||De.parentWindow||C}var vt=/mobile|tablet|ip(ad|hone|od)|android/i,Nt="ontouchstart"in C,Dt=ce(C,"PointerEvent")!==re,Ur=Nt&&vt.test(navigator.userAgent),dn="touch",on="pen",$i="mouse",or="kinect",me=25,Ae=1,Ue=2,Le=4,kt=8,nr=1,_r=2,Lr=4,fr=8,H=16,E=_r|Lr,V=fr|H,Ze=E|V,tt=["x","y"],ut=["clientX","clientY"];function wt(_e,De){var pt=this;this.manager=_e,this.callback=De,this.element=_e.element,this.target=_e.options.inputTarget,this.domHandler=function($t){q(_e.options.enable,[_e])&&pt.handler($t)},this.init()}wt.prototype={handler:function(){},init:function(){this.evEl&&Qe(this.element,this.evEl,this.domHandler),this.evTarget&&Qe(this.target,this.evTarget,this.domHandler),this.evWin&&Qe(xt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&$e(this.element,this.evEl,this.domHandler),this.evTarget&&$e(this.target,this.evTarget,this.domHandler),this.evWin&&$e(xt(this.element),this.evWin,this.domHandler)}};function K(_e){var De,pt=_e.options.inputClass;return pt?De=pt:Dt?De=ue:Ur?De=mt:Nt?De=Zr:De=si,new De(_e,Ht)}function Ht(_e,De,pt){var $t=pt.pointers.length,en=pt.changedPointers.length,ti=De&Ae&&$t-en==0,Ai=De&(Le|kt)&&$t-en==0;pt.isFirst=!!ti,pt.isFinal=!!Ai,ti&&(_e.session={}),pt.eventType=De,Tr(_e,pt),_e.emit("hammer.input",pt),_e.recognize(pt),_e.session.prevInput=pt}function Tr(_e,De){var pt=_e.session,$t=De.pointers,en=$t.length;pt.firstInput||(pt.firstInput=lt(De)),en>1&&!pt.firstMultiple?pt.firstMultiple=lt(De):en===1&&(pt.firstMultiple=!1);var ti=pt.firstInput,Ai=pt.firstMultiple,ha=Ai?Ai.center:ti.center,Na=De.center=At($t);De.timeStamp=bt(),De.deltaTime=De.timeStamp-ti.timeStamp,De.angle=er(ha,Na),De.distance=Pr(ha,Na),Or(pt,De),De.offsetDirection=wr(De.deltaX,De.deltaY);var po=zt(De.deltaTime,De.deltaX,De.deltaY);De.overallVelocityX=po.x,De.overallVelocityY=po.y,De.overallVelocity=Je(po.x)>Je(po.y)?po.x:po.y,De.scale=Ai?Yr(Ai.pointers,$t):1,De.rotation=Ai?Jr(Ai.pointers,$t):0,De.maxPointers=pt.prevInput?De.pointers.length>pt.prevInput.maxPointers?De.pointers.length:pt.prevInput.maxPointers:De.pointers.length,Ye(pt,De);var us=_e.element;Rt(De.srcEvent.target,us)&&(us=De.srcEvent.target),De.target=us}function Or(_e,De){var pt=De.center,$t=_e.offsetDelta||{},en=_e.prevDelta||{},ti=_e.prevInput||{};(De.eventType===Ae||ti.eventType===Le)&&(en=_e.prevDelta={x:ti.deltaX||0,y:ti.deltaY||0},$t=_e.offsetDelta={x:pt.x,y:pt.y}),De.deltaX=en.x+(pt.x-$t.x),De.deltaY=en.y+(pt.y-$t.y)}function Ye(_e,De){var pt=_e.lastInterval||De,$t=De.timeStamp-pt.timeStamp,en,ti,Ai,ha;if(De.eventType!=kt&&($t>me||pt.velocity===re)){var Na=De.deltaX-pt.deltaX,po=De.deltaY-pt.deltaY,us=zt($t,Na,po);ti=us.x,Ai=us.y,en=Je(us.x)>Je(us.y)?us.x:us.y,ha=wr(Na,po),_e.lastInterval=De}else en=pt.velocity,ti=pt.velocityX,Ai=pt.velocityY,ha=pt.direction;De.velocity=en,De.velocityX=ti,De.velocityY=Ai,De.direction=ha}function lt(_e){for(var De=[],pt=0;pt<_e.pointers.length;)De[pt]={clientX:$(_e.pointers[pt].clientX),clientY:$(_e.pointers[pt].clientY)},pt++;return{timeStamp:bt(),pointers:De,center:At(De),deltaX:_e.deltaX,deltaY:_e.deltaY}}function At(_e){var De=_e.length;if(De===1)return{x:$(_e[0].clientX),y:$(_e[0].clientY)};for(var pt=0,$t=0,en=0;en<De;)pt+=_e[en].clientX,$t+=_e[en].clientY,en++;return{x:$(pt/De),y:$($t/De)}}function zt(_e,De,pt){return{x:De/_e||0,y:pt/_e||0}}function wr(_e,De){return _e===De?nr:Je(_e)>=Je(De)?_e<0?_r:Lr:De<0?fr:H}function Pr(_e,De,pt){pt||(pt=tt);var $t=De[pt[0]]-_e[pt[0]],en=De[pt[1]]-_e[pt[1]];return Math.sqrt($t*$t+en*en)}function er(_e,De,pt){pt||(pt=tt);var $t=De[pt[0]]-_e[pt[0]],en=De[pt[1]]-_e[pt[1]];return Math.atan2(en,$t)*180/Math.PI}function Jr(_e,De){return er(De[1],De[0],ut)+er(_e[1],_e[0],ut)}function Yr(_e,De){return Pr(De[0],De[1],ut)/Pr(_e[0],_e[1],ut)}var En={mousedown:Ae,mousemove:Ue,mouseup:Le},_n="mousedown",ei="mousemove mouseup";function si(){this.evEl=_n,this.evWin=ei,this.pressed=!1,wt.apply(this,arguments)}Ct(si,wt,{handler:function(De){var pt=En[De.type];pt&Ae&&De.button===0&&(this.pressed=!0),pt&Ue&&De.which!==1&&(pt=Le),!!this.pressed&&(pt&Le&&(this.pressed=!1),this.callback(this.manager,pt,{pointers:[De],changedPointers:[De],pointerType:$i,srcEvent:De}))}});var na={pointerdown:Ae,pointermove:Ue,pointerup:Le,pointercancel:kt,pointerout:kt},Zi={2:dn,3:on,4:$i,5:or},Pi="pointerdown",X="pointermove pointerup pointercancel";C.MSPointerEvent&&!C.PointerEvent&&(Pi="MSPointerDown",X="MSPointerMove MSPointerUp MSPointerCancel");function ue(){this.evEl=Pi,this.evWin=X,wt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Ct(ue,wt,{handler:function(De){var pt=this.store,$t=!1,en=De.type.toLowerCase().replace("ms",""),ti=na[en],Ai=Zi[De.pointerType]||De.pointerType,ha=Ai==dn,Na=xr(pt,De.pointerId,"pointerId");ti&Ae&&(De.button===0||ha)?Na<0&&(pt.push(De),Na=pt.length-1):ti&(Le|kt)&&($t=!0),!(Na<0)&&(pt[Na]=De,this.callback(this.manager,ti,{pointers:pt,changedPointers:[De],pointerType:Ai,srcEvent:De}),$t&&pt.splice(Na,1))}});var pe={touchstart:Ae,touchmove:Ue,touchend:Le,touchcancel:kt},F="touchstart",ee="touchstart touchmove touchend touchcancel";function he(){this.evTarget=F,this.evWin=ee,this.started=!1,wt.apply(this,arguments)}Ct(he,wt,{handler:function(De){var pt=pe[De.type];if(pt===Ae&&(this.started=!0),!!this.started){var $t=Te.call(this,De,pt);pt&(Le|kt)&&$t[0].length-$t[1].length==0&&(this.started=!1),this.callback(this.manager,pt,{pointers:$t[0],changedPointers:$t[1],pointerType:dn,srcEvent:De})}}});function Te(_e,De){var pt=qt(_e.touches),$t=qt(_e.changedTouches);return De&(Le|kt)&&(pt=Xr(pt.concat($t),"identifier",!0)),[pt,$t]}var ae={touchstart:Ae,touchmove:Ue,touchend:Le,touchcancel:kt},Ee="touchstart touchmove touchend touchcancel";function mt(){this.evTarget=Ee,this.targetIds={},wt.apply(this,arguments)}Ct(mt,wt,{handler:function(De){var pt=ae[De.type],$t=Sr.call(this,De,pt);!$t||this.callback(this.manager,pt,{pointers:$t[0],changedPointers:$t[1],pointerType:dn,srcEvent:De})}});function Sr(_e,De){var pt=qt(_e.touches),$t=this.targetIds;if(De&(Ae|Ue)&&pt.length===1)return $t[pt[0].identifier]=!0,[pt,pt];var en,ti,Ai=qt(_e.changedTouches),ha=[],Na=this.target;if(ti=pt.filter(function(po){return Rt(po.target,Na)}),De===Ae)for(en=0;en<ti.length;)$t[ti[en].identifier]=!0,en++;for(en=0;en<Ai.length;)$t[Ai[en].identifier]&&ha.push(Ai[en]),De&(Le|kt)&&delete $t[Ai[en].identifier],en++;if(!!ha.length)return[Xr(ti.concat(ha),"identifier",!0),ha]}var Wt=2500,Ke=25;function Zr(){wt.apply(this,arguments);var _e=br(this.handler,this);this.touch=new mt(this.manager,_e),this.mouse=new si(this.manager,_e),this.primaryTouch=null,this.lastTouches=[]}Ct(Zr,wt,{handler:function(De,pt,$t){var en=$t.pointerType==dn,ti=$t.pointerType==$i;if(!(ti&&$t.sourceCapabilities&&$t.sourceCapabilities.firesTouchEvents)){if(en)kn.call(this,pt,$t);else if(ti&&ft.call(this,$t))return;this.callback(De,pt,$t)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function kn(_e,De){_e&Ae?(this.primaryTouch=De.changedPointers[0].identifier,Rn.call(this,De)):_e&(Le|kt)&&Rn.call(this,De)}function Rn(_e){var De=_e.changedPointers[0];if(De.identifier===this.primaryTouch){var pt={x:De.clientX,y:De.clientY};this.lastTouches.push(pt);var $t=this.lastTouches,en=function(){var ti=$t.indexOf(pt);ti>-1&&$t.splice(ti,1)};setTimeout(en,Wt)}}function ft(_e){for(var De=_e.srcEvent.clientX,pt=_e.srcEvent.clientY,$t=0;$t<this.lastTouches.length;$t++){var en=this.lastTouches[$t],ti=Math.abs(De-en.x),Ai=Math.abs(pt-en.y);if(ti<=Ke&&Ai<=Ke)return!0}return!1}var vr=ce(se.style,"touchAction"),et=vr!==re,Dr="compute",In="auto",tr="manipulation",Ni="none",ia="pan-x",hi="pan-y",Fi=ya();function Wi(_e,De){this.manager=_e,this.set(De)}Wi.prototype={set:function(_e){_e==Dr&&(_e=this.compute()),et&&this.manager.element.style&&Fi[_e]&&(this.manager.element.style[vr]=_e),this.actions=_e.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var _e=[];return Qt(this.manager.recognizers,function(De){q(De.options.enable,[De])&&(_e=_e.concat(De.getTouchAction()))}),yi(_e.join(" "))},preventDefaults:function(_e){var De=_e.srcEvent,pt=_e.offsetDirection;if(this.manager.session.prevented){De.preventDefault();return}var $t=this.actions,en=Xe($t,Ni)&&!Fi[Ni],ti=Xe($t,hi)&&!Fi[hi],Ai=Xe($t,ia)&&!Fi[ia];if(en){var ha=_e.pointers.length===1,Na=_e.distance<2,po=_e.deltaTime<250;if(ha&&Na&&po)return}if(!(Ai&&ti)&&(en||ti&&pt&E||Ai&&pt&V))return this.preventSrc(De)},preventSrc:function(_e){this.manager.session.prevented=!0,_e.preventDefault()}};function yi(_e){if(Xe(_e,Ni))return Ni;var De=Xe(_e,ia),pt=Xe(_e,hi);return De&&pt?Ni:De||pt?De?ia:hi:Xe(_e,tr)?tr:In}function ya(){if(!et)return!1;var _e={},De=C.CSS&&C.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(pt){_e[pt]=De?C.CSS.supports("touch-action",pt):!0}),_e}var La=1,_i=2,Mi=4,Ji=8,to=Ji,jo=16,ja=32;function Xi(_e){this.options=ir({},this.defaults,_e||{}),this.id=ge(),this.manager=null,this.options.enable=dr(this.options.enable,!0),this.state=La,this.simultaneous={},this.requireFail=[]}Xi.prototype={defaults:{},set:function(_e){return ir(this.options,_e),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(_e){if(Ir(_e,"recognizeWith",this))return this;var De=this.simultaneous;return _e=Ba(_e,this),De[_e.id]||(De[_e.id]=_e,_e.recognizeWith(this)),this},dropRecognizeWith:function(_e){return Ir(_e,"dropRecognizeWith",this)?this:(_e=Ba(_e,this),delete this.simultaneous[_e.id],this)},requireFailure:function(_e){if(Ir(_e,"requireFailure",this))return this;var De=this.requireFail;return _e=Ba(_e,this),xr(De,_e)===-1&&(De.push(_e),_e.requireFailure(this)),this},dropRequireFailure:function(_e){if(Ir(_e,"dropRequireFailure",this))return this;_e=Ba(_e,this);var De=xr(this.requireFail,_e);return De>-1&&this.requireFail.splice(De,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(_e){return!!this.simultaneous[_e.id]},emit:function(_e){var De=this,pt=this.state;function $t(en){De.manager.emit(en,_e)}pt<Ji&&$t(De.options.event+du(pt)),$t(De.options.event),_e.additionalEvent&&$t(_e.additionalEvent),pt>=Ji&&$t(De.options.event+du(pt))},tryEmit:function(_e){if(this.canEmit())return this.emit(_e);this.state=ja},canEmit:function(){for(var _e=0;_e<this.requireFail.length;){if(!(this.requireFail[_e].state&(ja|La)))return!1;_e++}return!0},recognize:function(_e){var De=ir({},_e);if(!q(this.options.enable,[this,De])){this.reset(),this.state=ja;return}this.state&(to|jo|ja)&&(this.state=La),this.state=this.process(De),this.state&(_i|Mi|Ji|jo)&&this.tryEmit(De)},process:function(_e){},getTouchAction:function(){},reset:function(){}};function du(_e){return _e&jo?"cancel":_e&Ji?"end":_e&Mi?"move":_e&_i?"start":""}function ku(_e){return _e==H?"down":_e==fr?"up":_e==_r?"left":_e==Lr?"right":""}function Ba(_e,De){var pt=De.manager;return pt?pt.get(_e):_e}function Vo(){Xi.apply(this,arguments)}Ct(Vo,Xi,{defaults:{pointers:1},attrTest:function(_e){var De=this.options.pointers;return De===0||_e.pointers.length===De},process:function(_e){var De=this.state,pt=_e.eventType,$t=De&(_i|Mi),en=this.attrTest(_e);return $t&&(pt&kt||!en)?De|jo:$t||en?pt&Le?De|Ji:De&_i?De|Mi:_i:ja}});function Yi(){Vo.apply(this,arguments),this.pX=null,this.pY=null}Ct(Yi,Vo,{defaults:{event:"pan",threshold:10,pointers:1,direction:Ze},getTouchAction:function(){var _e=this.options.direction,De=[];return _e&E&&De.push(hi),_e&V&&De.push(ia),De},directionTest:function(_e){var De=this.options,pt=!0,$t=_e.distance,en=_e.direction,ti=_e.deltaX,Ai=_e.deltaY;return en&De.direction||(De.direction&E?(en=ti===0?nr:ti<0?_r:Lr,pt=ti!=this.pX,$t=Math.abs(_e.deltaX)):(en=Ai===0?nr:Ai<0?fr:H,pt=Ai!=this.pY,$t=Math.abs(_e.deltaY))),_e.direction=en,pt&&$t>De.threshold&&en&De.direction},attrTest:function(_e){return Vo.prototype.attrTest.call(this,_e)&&(this.state&_i||!(this.state&_i)&&this.directionTest(_e))},emit:function(_e){this.pX=_e.deltaX,this.pY=_e.deltaY;var De=ku(_e.direction);De&&(_e.additionalEvent=this.options.event+De),this._super.emit.call(this,_e)}});function ro(){Vo.apply(this,arguments)}Ct(ro,Vo,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(_e){return this._super.attrTest.call(this,_e)&&(Math.abs(_e.scale-1)>this.options.threshold||this.state&_i)},emit:function(_e){if(_e.scale!==1){var De=_e.scale<1?"in":"out";_e.additionalEvent=this.options.event+De}this._super.emit.call(this,_e)}});function Jo(){Xi.apply(this,arguments),this._timer=null,this._input=null}Ct(Jo,Xi,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[In]},process:function(_e){var De=this.options,pt=_e.pointers.length===De.pointers,$t=_e.distance<De.threshold,en=_e.deltaTime>De.time;if(this._input=_e,!$t||!pt||_e.eventType&(Le|kt)&&!en)this.reset();else if(_e.eventType&Ae)this.reset(),this._timer=Gt(function(){this.state=to,this.tryEmit()},De.time,this);else if(_e.eventType&Le)return to;return ja},reset:function(){clearTimeout(this._timer)},emit:function(_e){this.state===to&&(_e&&_e.eventType&Le?this.manager.emit(this.options.event+"up",_e):(this._input.timeStamp=bt(),this.manager.emit(this.options.event,this._input)))}});function xa(){Vo.apply(this,arguments)}Ct(xa,Vo,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[Ni]},attrTest:function(_e){return this._super.attrTest.call(this,_e)&&(Math.abs(_e.rotation)>this.options.threshold||this.state&_i)}});function Lo(){Vo.apply(this,arguments)}Ct(Lo,Vo,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:E|V,pointers:1},getTouchAction:function(){return Yi.prototype.getTouchAction.call(this)},attrTest:function(_e){var De=this.options.direction,pt;return De&(E|V)?pt=_e.overallVelocity:De&E?pt=_e.overallVelocityX:De&V&&(pt=_e.overallVelocityY),this._super.attrTest.call(this,_e)&&De&_e.offsetDirection&&_e.distance>this.options.threshold&&_e.maxPointers==this.options.pointers&&Je(pt)>this.options.velocity&&_e.eventType&Le},emit:function(_e){var De=ku(_e.offsetDirection);De&&this.manager.emit(this.options.event+De,_e),this.manager.emit(this.options.event,_e)}});function No(){Xi.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Ct(No,Xi,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[tr]},process:function(_e){var De=this.options,pt=_e.pointers.length===De.pointers,$t=_e.distance<De.threshold,en=_e.deltaTime<De.time;if(this.reset(),_e.eventType&Ae&&this.count===0)return this.failTimeout();if($t&&en&&pt){if(_e.eventType!=Le)return this.failTimeout();var ti=this.pTime?_e.timeStamp-this.pTime<De.interval:!0,Ai=!this.pCenter||Pr(this.pCenter,_e.center)<De.posThreshold;this.pTime=_e.timeStamp,this.pCenter=_e.center,!Ai||!ti?this.count=1:this.count+=1,this._input=_e;var ha=this.count%De.taps;if(ha===0)return this.hasRequireFailures()?(this._timer=Gt(function(){this.state=to,this.tryEmit()},De.interval,this),_i):to}return ja},failTimeout:function(){return this._timer=Gt(function(){this.state=ja},this.options.interval,this),ja},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==to&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Us(_e,De){return De=De||{},De.recognizers=dr(De.recognizers,Us.defaults.preset),new Va(_e,De)}Us.VERSION="2.0.7",Us.defaults={domEvents:!1,touchAction:Dr,enable:!0,inputTarget:null,inputClass:null,preset:[[xa,{enable:!1}],[ro,{enable:!1},["rotate"]],[Lo,{direction:E}],[Yi,{direction:E},["swipe"]],[No],[No,{event:"doubletap",taps:2},["tap"]],[Jo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var _o=1,Qo=2;function Va(_e,De){this.options=ir({},Us.defaults,De||{}),this.options.inputTarget=this.options.inputTarget||_e,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=_e,this.input=K(this),this.touchAction=new Wi(this,this.options.touchAction),uo(this,!0),Qt(this.options.recognizers,function(pt){var $t=this.add(new pt[0](pt[1]));pt[2]&&$t.recognizeWith(pt[2]),pt[3]&&$t.requireFailure(pt[3])},this)}Va.prototype={set:function(_e){return ir(this.options,_e),_e.touchAction&&this.touchAction.update(),_e.inputTarget&&(this.input.destroy(),this.input.target=_e.inputTarget,this.input.init()),this},stop:function(_e){this.session.stopped=_e?Qo:_o},recognize:function(_e){var De=this.session;if(!De.stopped){this.touchAction.preventDefaults(_e);var pt,$t=this.recognizers,en=De.curRecognizer;(!en||en&&en.state&to)&&(en=De.curRecognizer=null);for(var ti=0;ti<$t.length;)pt=$t[ti],De.stopped!==Qo&&(!en||pt==en||pt.canRecognizeWith(en))?pt.recognize(_e):pt.reset(),!en&&pt.state&(_i|Mi|Ji)&&(en=De.curRecognizer=pt),ti++}},get:function(_e){if(_e instanceof Xi)return _e;for(var De=this.recognizers,pt=0;pt<De.length;pt++)if(De[pt].options.event==_e)return De[pt];return null},add:function(_e){if(Ir(_e,"add",this))return this;var De=this.get(_e.options.event);return De&&this.remove(De),this.recognizers.push(_e),_e.manager=this,this.touchAction.update(),_e},remove:function(_e){if(Ir(_e,"remove",this))return this;if(_e=this.get(_e),_e){var De=this.recognizers,pt=xr(De,_e);pt!==-1&&(De.splice(pt,1),this.touchAction.update())}return this},on:function(_e,De){if(_e!==re&&De!==re){var pt=this.handlers;return Qt(Zt(_e),function($t){pt[$t]=pt[$t]||[],pt[$t].push(De)}),this}},off:function(_e,De){if(_e!==re){var pt=this.handlers;return Qt(Zt(_e),function($t){De?pt[$t]&&pt[$t].splice(xr(pt[$t],De),1):delete pt[$t]}),this}},emit:function(_e,De){this.options.domEvents&&ss(_e,De);var pt=this.handlers[_e]&&this.handlers[_e].slice();if(!(!pt||!pt.length)){De.type=_e,De.preventDefault=function(){De.srcEvent.preventDefault()};for(var $t=0;$t<pt.length;)pt[$t](De),$t++}},destroy:function(){this.element&&uo(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function uo(_e,De){var pt=_e.element;if(!!pt.style){var $t;Qt(_e.options.cssProps,function(en,ti){$t=ce(pt.style,ti),De?(_e.oldCssProps[$t]=pt.style[$t],pt.style[$t]=en):pt.style[$t]=_e.oldCssProps[$t]||""}),De||(_e.oldCssProps={})}}function ss(_e,De){var pt=d.createEvent("Event");pt.initEvent(_e,!0,!0),pt.gesture=De,De.target.dispatchEvent(pt)}ir(Us,{INPUT_START:Ae,INPUT_MOVE:Ue,INPUT_END:Le,INPUT_CANCEL:kt,STATE_POSSIBLE:La,STATE_BEGAN:_i,STATE_CHANGED:Mi,STATE_ENDED:Ji,STATE_RECOGNIZED:to,STATE_CANCELLED:jo,STATE_FAILED:ja,DIRECTION_NONE:nr,DIRECTION_LEFT:_r,DIRECTION_RIGHT:Lr,DIRECTION_UP:fr,DIRECTION_DOWN:H,DIRECTION_HORIZONTAL:E,DIRECTION_VERTICAL:V,DIRECTION_ALL:Ze,Manager:Va,Input:wt,TouchAction:Wi,TouchInput:mt,MouseInput:si,PointerEventInput:ue,TouchMouseInput:Zr,SingleTouchInput:he,Recognizer:Xi,AttrRecognizer:Vo,Tap:No,Pan:Yi,Swipe:Lo,Pinch:ro,Rotate:xa,Press:Jo,on:Qe,off:$e,each:Qt,merge:Tt,extend:jt,assign:ir,inherit:Ct,bindFn:br,prefixed:ce});var Co=typeof C!="undefined"?C:typeof self!="undefined"?self:{};Co.Hammer=Us,ye=function(){return Us}.call(B,S,B,zr),ye!==re&&(zr.exports=ye)})(window,document,"Hammer")},7375:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0});var S=Symbol.for("INJECTION");function ye(ie,se,Be,$){function Je(){return $&&!Reflect.hasMetadata(S,this,se)&&Reflect.defineMetadata(S,Be(),this,se),Reflect.hasMetadata(S,this,se)?Reflect.getMetadata(S,this,se):Be()}function bt(Gt){Reflect.defineMetadata(S,Gt,this,se)}Object.defineProperty(ie,se,{configurable:!0,enumerable:!0,get:Je,set:bt})}function C(ie,se){return function(Be){return function($,Je){var bt=function(){return ie.get(Be)};ye($,Je,bt,se)}}}B.makePropertyInjectDecorator=C;function d(ie,se){return function(Be,$){return function(Je,bt){var Gt=function(){return ie.getNamed(Be,$)};ye(Je,bt,Gt,se)}}}B.makePropertyInjectNamedDecorator=d;function de(ie,se){return function(Be,$,Je){return function(bt,Gt){var Ir=function(){return ie.getTagged(Be,$,Je)};ye(bt,Gt,Ir,se)}}}B.makePropertyInjectTaggedDecorator=de;function re(ie,se){return function(Be){return function($,Je){var bt=function(){return ie.getAll(Be)};ye($,Je,bt,se)}}}B.makePropertyMultiInjectDecorator=re},84879:function(zr,B,S){"use strict";var ye;ye={value:!0};var C=S(7375);function d(de,re){re===void 0&&(re=!0);var ie=C.makePropertyInjectDecorator(de,re),se=C.makePropertyInjectNamedDecorator(de,re),Be=C.makePropertyInjectTaggedDecorator(de,re),$=C.makePropertyMultiInjectDecorator(de,re);return{lazyInject:ie,lazyInjectNamed:se,lazyInjectTagged:Be,lazyMultiInject:$}}B.Z=d},99934:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.tagProperty=B.tagParameter=B.decorate=void 0;var ye=S(16674),C=S(6867);function d($,Je,bt,Gt){var Ir=C.TAGGED;re(Ir,$,Je,Gt,bt)}B.tagParameter=d;function de($,Je,bt){var Gt=C.TAGGED_PROP;re(Gt,$.constructor,Je,bt)}B.tagProperty=de;function re($,Je,bt,Gt,Ir){var Qt={},Yt=typeof Ir=="number",ir=Ir!==void 0&&Yt?Ir.toString():bt;if(Yt&&bt!==void 0)throw new Error(ye.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata($,Je)&&(Qt=Reflect.getMetadata($,Je));var jt=Qt[ir];if(!Array.isArray(jt))jt=[];else for(var Tt=0,Ct=jt;Tt<Ct.length;Tt++){var br=Ct[Tt];if(br.key===Gt.key)throw new Error(ye.DUPLICATED_METADATA+" "+br.key.toString())}jt.push(Gt),Qt[ir]=jt,Reflect.defineMetadata($,Qt,Je)}function ie($,Je){Reflect.decorate($,Je)}function se($,Je){return function(bt,Gt){Je(bt,Gt,$)}}function Be($,Je,bt){typeof bt=="number"?ie([se(bt,$)],Je):typeof bt=="string"?Reflect.decorate([$],Je,bt):ie([$],Je)}B.decorate=Be},5744:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.inject=B.LazyServiceIdentifer=void 0;var ye=S(16674),C=S(6867),d=S(47738),de=S(99934),re=function(){function se(Be){this._cb=Be}return se.prototype.unwrap=function(){return this._cb()},se}();B.LazyServiceIdentifer=re;function ie(se){return function(Be,$,Je){if(se===void 0)throw new Error(ye.UNDEFINED_INJECT_ANNOTATION(Be.name));var bt=new d.Metadata(C.INJECT_TAG,se);typeof Je=="number"?de.tagParameter(Be,$,Je,bt):de.tagProperty(Be,$,bt)}}B.inject=ie},64315:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.injectable=void 0;var ye=S(16674),C=S(6867);function d(){return function(de){if(Reflect.hasOwnMetadata(C.PARAM_TYPES,de))throw new Error(ye.DUPLICATED_INJECTABLE_DECORATOR);var re=Reflect.getMetadata(C.DESIGN_PARAM_TYPES,de)||[];return Reflect.defineMetadata(C.PARAM_TYPES,re,de),de}}B.injectable=d},71693:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.multiInject=void 0;var ye=S(6867),C=S(47738),d=S(99934);function de(re){return function(ie,se,Be){var $=new C.Metadata(ye.MULTI_INJECT_TAG,re);typeof Be=="number"?d.tagParameter(ie,se,Be,$):d.tagProperty(ie,se,$)}}B.multiInject=de},38085:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.named=void 0;var ye=S(6867),C=S(47738),d=S(99934);function de(re){return function(ie,se,Be){var $=new C.Metadata(ye.NAMED_TAG,re);typeof Be=="number"?d.tagParameter(ie,se,Be,$):d.tagProperty(ie,se,$)}}B.named=de},6515:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.optional=void 0;var ye=S(6867),C=S(47738),d=S(99934);function de(){return function(re,ie,se){var Be=new C.Metadata(ye.OPTIONAL_TAG,!0);typeof se=="number"?d.tagParameter(re,ie,se,Be):d.tagProperty(re,ie,Be)}}B.optional=de},7014:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.postConstruct=void 0;var ye=S(16674),C=S(6867),d=S(47738);function de(){return function(re,ie,se){var Be=new d.Metadata(C.POST_CONSTRUCT,ie);if(Reflect.hasOwnMetadata(C.POST_CONSTRUCT,re.constructor))throw new Error(ye.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(C.POST_CONSTRUCT,Be,re.constructor)}}B.postConstruct=de},32052:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.tagged=void 0;var ye=S(47738),C=S(99934);function d(de,re){return function(ie,se,Be){var $=new ye.Metadata(de,re);typeof Be=="number"?C.tagParameter(ie,se,Be,$):C.tagProperty(ie,se,$)}}B.tagged=d},55638:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.targetName=void 0;var ye=S(6867),C=S(47738),d=S(99934);function de(re){return function(ie,se,Be){var $=new C.Metadata(ye.NAME_TAG,re);d.tagParameter(ie,se,Be,$)}}B.targetName=de},86757:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.unmanaged=void 0;var ye=S(6867),C=S(47738),d=S(99934);function de(){return function(re,ie,se){var Be=new C.Metadata(ye.UNMANAGED_TAG,!0);d.tagParameter(re,ie,se,Be)}}B.unmanaged=de},44290:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Binding=void 0;var ye=S(28421),C=S(37791),d=function(){function de(re,ie){this.id=C.id(),this.activated=!1,this.serviceIdentifier=re,this.scope=ie,this.type=ye.BindingTypeEnum.Invalid,this.constraint=function(se){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return de.prototype.clone=function(){var re=new de(this.serviceIdentifier,this.scope);return re.activated=re.scope===ye.BindingScopeEnum.Singleton?this.activated:!1,re.implementationType=this.implementationType,re.dynamicValue=this.dynamicValue,re.scope=this.scope,re.type=this.type,re.factory=this.factory,re.provider=this.provider,re.constraint=this.constraint,re.onActivation=this.onActivation,re.cache=this.cache,re},de}();B.Binding=d},23184:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingCount=void 0;var S={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};B.BindingCount=S},16674:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.STACK_OVERFLOW=B.CIRCULAR_DEPENDENCY_IN_FACTORY=B.POST_CONSTRUCT_ERROR=B.MULTIPLE_POST_CONSTRUCT_METHODS=B.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=B.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=B.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=B.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=B.ARGUMENTS_LENGTH_MISMATCH=B.INVALID_DECORATOR_OPERATION=B.INVALID_TO_SELF_VALUE=B.INVALID_FUNCTION_BINDING=B.INVALID_MIDDLEWARE_RETURN=B.NO_MORE_SNAPSHOTS_AVAILABLE=B.INVALID_BINDING_TYPE=B.NOT_IMPLEMENTED=B.CIRCULAR_DEPENDENCY=B.UNDEFINED_INJECT_ANNOTATION=B.MISSING_INJECT_ANNOTATION=B.MISSING_INJECTABLE_ANNOTATION=B.NOT_REGISTERED=B.CANNOT_UNBIND=B.AMBIGUOUS_MATCH=B.KEY_NOT_FOUND=B.NULL_ARGUMENT=B.DUPLICATED_METADATA=B.DUPLICATED_INJECTABLE_DECORATOR=void 0,B.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",B.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",B.NULL_ARGUMENT="NULL argument",B.KEY_NOT_FOUND="Key Not Found",B.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",B.CANNOT_UNBIND="Could not unbind serviceIdentifier:",B.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",B.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",B.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var S=function(de){return"@inject called with undefined this could mean that the class "+de+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};B.UNDEFINED_INJECT_ANNOTATION=S,B.CIRCULAR_DEPENDENCY="Circular dependency found:",B.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",B.INVALID_BINDING_TYPE="Invalid binding type:",B.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",B.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",B.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",B.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",B.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ye=function(){for(var de=[],re=0;re<arguments.length;re++)de[re]=arguments[re];return"The number of constructor arguments in the derived class "+(de[0]+" must be >= than the number of constructor arguments of its base class.")};B.ARGUMENTS_LENGTH_MISMATCH=ye,B.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",B.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",B.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",B.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",B.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var C=function(){for(var de=[],re=0;re<arguments.length;re++)de[re]=arguments[re];return"@postConstruct error in class "+de[0]+": "+de[1]};B.POST_CONSTRUCT_ERROR=C;var d=function(){for(var de=[],re=0;re<arguments.length;re++)de[re]=arguments[re];return"It looks like there is a circular dependency "+("in one of the '"+de[0]+"' bindings. Please investigate bindings with")+("service identifier '"+de[1]+"'.")};B.CIRCULAR_DEPENDENCY_IN_FACTORY=d,B.STACK_OVERFLOW="Maximum call stack size exceeded"},28421:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.TargetTypeEnum=B.BindingTypeEnum=B.BindingScopeEnum=void 0;var S={Request:"Request",Singleton:"Singleton",Transient:"Transient"};B.BindingScopeEnum=S;var ye={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};B.BindingTypeEnum=ye;var C={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};B.TargetTypeEnum=C},6867:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.NON_CUSTOM_TAG_KEYS=B.POST_CONSTRUCT=B.DESIGN_PARAM_TYPES=B.PARAM_TYPES=B.TAGGED_PROP=B.TAGGED=B.MULTI_INJECT_TAG=B.INJECT_TAG=B.OPTIONAL_TAG=B.UNMANAGED_TAG=B.NAME_TAG=B.NAMED_TAG=void 0,B.NAMED_TAG="named",B.NAME_TAG="name",B.UNMANAGED_TAG="unmanaged",B.OPTIONAL_TAG="optional",B.INJECT_TAG="inject",B.MULTI_INJECT_TAG="multi_inject",B.TAGGED="inversify:tagged",B.TAGGED_PROP="inversify:tagged_props",B.PARAM_TYPES="inversify:paramtypes",B.DESIGN_PARAM_TYPES="design:paramtypes",B.POST_CONSTRUCT="post_construct";function S(){return[B.INJECT_TAG,B.MULTI_INJECT_TAG,B.NAME_TAG,B.UNMANAGED_TAG,B.NAMED_TAG,B.OPTIONAL_TAG]}B.NON_CUSTOM_TAG_KEYS=S()},51389:function(zr,B,S){"use strict";var ye=this&&this.__awaiter||function(jt,Tt,Ct,br){function q(dr){return dr instanceof Ct?dr:new Ct(function(Qe){Qe(dr)})}return new(Ct||(Ct=Promise))(function(dr,Qe){function $e(Zt){try{Xe(br.next(Zt))}catch(xr){Qe(xr)}}function Rt(Zt){try{Xe(br.throw(Zt))}catch(xr){Qe(xr)}}function Xe(Zt){Zt.done?dr(Zt.value):q(Zt.value).then($e,Rt)}Xe((br=br.apply(jt,Tt||[])).next())})},C=this&&this.__generator||function(jt,Tt){var Ct={label:0,sent:function(){if(dr[0]&1)throw dr[1];return dr[1]},trys:[],ops:[]},br,q,dr,Qe;return Qe={next:$e(0),throw:$e(1),return:$e(2)},typeof Symbol=="function"&&(Qe[Symbol.iterator]=function(){return this}),Qe;function $e(Xe){return function(Zt){return Rt([Xe,Zt])}}function Rt(Xe){if(br)throw new TypeError("Generator is already executing.");for(;Ct;)try{if(br=1,q&&(dr=Xe[0]&2?q.return:Xe[0]?q.throw||((dr=q.return)&&dr.call(q),0):q.next)&&!(dr=dr.call(q,Xe[1])).done)return dr;switch(q=0,dr&&(Xe=[Xe[0]&2,dr.value]),Xe[0]){case 0:case 1:dr=Xe;break;case 4:return Ct.label++,{value:Xe[1],done:!1};case 5:Ct.label++,q=Xe[1],Xe=[0];continue;case 7:Xe=Ct.ops.pop(),Ct.trys.pop();continue;default:if(dr=Ct.trys,!(dr=dr.length>0&&dr[dr.length-1])&&(Xe[0]===6||Xe[0]===2)){Ct=0;continue}if(Xe[0]===3&&(!dr||Xe[1]>dr[0]&&Xe[1]<dr[3])){Ct.label=Xe[1];break}if(Xe[0]===6&&Ct.label<dr[1]){Ct.label=dr[1],dr=Xe;break}if(dr&&Ct.label<dr[2]){Ct.label=dr[2],Ct.ops.push(Xe);break}dr[2]&&Ct.ops.pop(),Ct.trys.pop();continue}Xe=Tt.call(jt,Ct)}catch(Zt){Xe=[6,Zt],q=0}finally{br=dr=0}if(Xe[0]&5)throw Xe[1];return{value:Xe[0]?Xe[1]:void 0,done:!0}}},d=this&&this.__spreadArray||function(jt,Tt){for(var Ct=0,br=Tt.length,q=jt.length;Ct<br;Ct++,q++)jt[q]=Tt[Ct];return jt};Object.defineProperty(B,"__esModule",{value:!0}),B.Container=void 0;var de=S(44290),re=S(16674),ie=S(28421),se=S(6867),Be=S(51377),$=S(86311),Je=S(31927),bt=S(15451),Gt=S(37791),Ir=S(55800),Qt=S(85700),Yt=S(80175),ir=function(){function jt(Tt){this._appliedMiddleware=[];var Ct=Tt||{};if(typeof Ct!="object")throw new Error(""+re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Ct.defaultScope===void 0)Ct.defaultScope=ie.BindingScopeEnum.Transient;else if(Ct.defaultScope!==ie.BindingScopeEnum.Singleton&&Ct.defaultScope!==ie.BindingScopeEnum.Transient&&Ct.defaultScope!==ie.BindingScopeEnum.Request)throw new Error(""+re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Ct.autoBindInjectable===void 0)Ct.autoBindInjectable=!1;else if(typeof Ct.autoBindInjectable!="boolean")throw new Error(""+re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Ct.skipBaseClassChecks===void 0)Ct.skipBaseClassChecks=!1;else if(typeof Ct.skipBaseClassChecks!="boolean")throw new Error(""+re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Ct.autoBindInjectable,defaultScope:Ct.defaultScope,skipBaseClassChecks:Ct.skipBaseClassChecks},this.id=Gt.id(),this._bindingDictionary=new Yt.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Be.MetadataReader}return jt.merge=function(Tt,Ct){for(var br=[],q=2;q<arguments.length;q++)br[q-2]=arguments[q];var dr=new jt,Qe=d([Tt,Ct],br).map(function(Xe){return $.getBindingDictionary(Xe)}),$e=$.getBindingDictionary(dr);function Rt(Xe,Zt){Xe.traverse(function(xr,qt){qt.forEach(function(Xr){Zt.add(Xr.serviceIdentifier,Xr.clone())})})}return Qe.forEach(function(Xe){Rt(Xe,$e)}),dr},jt.prototype.load=function(){for(var Tt=[],Ct=0;Ct<arguments.length;Ct++)Tt[Ct]=arguments[Ct];for(var br=this._getContainerModuleHelpersFactory(),q=0,dr=Tt;q<dr.length;q++){var Qe=dr[q],$e=br(Qe.id);Qe.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)}},jt.prototype.loadAsync=function(){for(var Tt=[],Ct=0;Ct<arguments.length;Ct++)Tt[Ct]=arguments[Ct];return ye(this,void 0,void 0,function(){var br,q,dr,Qe,$e;return C(this,function(Rt){switch(Rt.label){case 0:br=this._getContainerModuleHelpersFactory(),q=0,dr=Tt,Rt.label=1;case 1:return q<dr.length?(Qe=dr[q],$e=br(Qe.id),[4,Qe.registry($e.bindFunction,$e.unbindFunction,$e.isboundFunction,$e.rebindFunction)]):[3,4];case 2:Rt.sent(),Rt.label=3;case 3:return q++,[3,1];case 4:return[2]}})})},jt.prototype.unload=function(){for(var Tt=this,Ct=[],br=0;br<arguments.length;br++)Ct[br]=arguments[br];var q=function(dr){return function(Qe){return Qe.moduleId===dr}};Ct.forEach(function(dr){var Qe=q(dr.id);Tt._bindingDictionary.removeByCondition(Qe)})},jt.prototype.bind=function(Tt){var Ct=this.options.defaultScope||ie.BindingScopeEnum.Transient,br=new de.Binding(Tt,Ct);return this._bindingDictionary.add(Tt,br),new bt.BindingToSyntax(br)},jt.prototype.rebind=function(Tt){return this.unbind(Tt),this.bind(Tt)},jt.prototype.unbind=function(Tt){try{this._bindingDictionary.remove(Tt)}catch(Ct){throw new Error(re.CANNOT_UNBIND+" "+Ir.getServiceIdentifierAsString(Tt))}},jt.prototype.unbindAll=function(){this._bindingDictionary=new Yt.Lookup},jt.prototype.isBound=function(Tt){var Ct=this._bindingDictionary.hasKey(Tt);return!Ct&&this.parent&&(Ct=this.parent.isBound(Tt)),Ct},jt.prototype.isBoundNamed=function(Tt,Ct){return this.isBoundTagged(Tt,se.NAMED_TAG,Ct)},jt.prototype.isBoundTagged=function(Tt,Ct,br){var q=!1;if(this._bindingDictionary.hasKey(Tt)){var dr=this._bindingDictionary.get(Tt),Qe=$.createMockRequest(this,Tt,Ct,br);q=dr.some(function($e){return $e.constraint(Qe)})}return!q&&this.parent&&(q=this.parent.isBoundTagged(Tt,Ct,br)),q},jt.prototype.snapshot=function(){this._snapshots.push(Qt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},jt.prototype.restore=function(){var Tt=this._snapshots.pop();if(Tt===void 0)throw new Error(re.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=Tt.bindings,this._middleware=Tt.middleware},jt.prototype.createChild=function(Tt){var Ct=new jt(Tt||this.options);return Ct.parent=this,Ct},jt.prototype.applyMiddleware=function(){for(var Tt=[],Ct=0;Ct<arguments.length;Ct++)Tt[Ct]=arguments[Ct];this._appliedMiddleware=this._appliedMiddleware.concat(Tt);var br=this._middleware?this._middleware:this._planAndResolve();this._middleware=Tt.reduce(function(q,dr){return dr(q)},br)},jt.prototype.applyCustomMetadataReader=function(Tt){this._metadataReader=Tt},jt.prototype.get=function(Tt){return this._get(!1,!1,ie.TargetTypeEnum.Variable,Tt)},jt.prototype.getTagged=function(Tt,Ct,br){return this._get(!1,!1,ie.TargetTypeEnum.Variable,Tt,Ct,br)},jt.prototype.getNamed=function(Tt,Ct){return this.getTagged(Tt,se.NAMED_TAG,Ct)},jt.prototype.getAll=function(Tt){return this._get(!0,!0,ie.TargetTypeEnum.Variable,Tt)},jt.prototype.getAllTagged=function(Tt,Ct,br){return this._get(!1,!0,ie.TargetTypeEnum.Variable,Tt,Ct,br)},jt.prototype.getAllNamed=function(Tt,Ct){return this.getAllTagged(Tt,se.NAMED_TAG,Ct)},jt.prototype.resolve=function(Tt){var Ct=this.createChild();return Ct.bind(Tt).toSelf(),this._appliedMiddleware.forEach(function(br){Ct.applyMiddleware(br)}),Ct.get(Tt)},jt.prototype._getContainerModuleHelpersFactory=function(){var Tt=this,Ct=function($e,Rt){$e._binding.moduleId=Rt},br=function($e){return function(Rt){var Xe=Tt.bind.bind(Tt),Zt=Xe(Rt);return Ct(Zt,$e),Zt}},q=function($e){return function(Rt){var Xe=Tt.unbind.bind(Tt);Xe(Rt)}},dr=function($e){return function(Rt){var Xe=Tt.isBound.bind(Tt);return Xe(Rt)}},Qe=function($e){return function(Rt){var Xe=Tt.rebind.bind(Tt),Zt=Xe(Rt);return Ct(Zt,$e),Zt}};return function($e){return{bindFunction:br($e),isboundFunction:dr($e),rebindFunction:Qe($e),unbindFunction:q($e)}}},jt.prototype._get=function(Tt,Ct,br,q,dr,Qe){var $e=null,Rt={avoidConstraints:Tt,contextInterceptor:function(Xe){return Xe},isMultiInject:Ct,key:dr,serviceIdentifier:q,targetType:br,value:Qe};if(this._middleware){if($e=this._middleware(Rt),$e==null)throw new Error(re.INVALID_MIDDLEWARE_RETURN)}else $e=this._planAndResolve()(Rt);return $e},jt.prototype._planAndResolve=function(){var Tt=this;return function(Ct){var br=$.plan(Tt._metadataReader,Tt,Ct.isMultiInject,Ct.targetType,Ct.serviceIdentifier,Ct.key,Ct.value,Ct.avoidConstraints);br=Ct.contextInterceptor(br);var q=Je.resolve(br);return q}},jt}();B.Container=ir},33244:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.AsyncContainerModule=B.ContainerModule=void 0;var ye=S(37791),C=function(){function de(re){this.id=ye.id(),this.registry=re}return de}();B.ContainerModule=C;var d=function(){function de(re){this.id=ye.id(),this.registry=re}return de}();B.AsyncContainerModule=d},85700:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.ContainerSnapshot=void 0;var S=function(){function ye(){}return ye.of=function(C,d){var de=new ye;return de.bindings=C,de.middleware=d,de},ye}();B.ContainerSnapshot=S},80175:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Lookup=void 0;var ye=S(16674),C=function(){function d(){this._map=new Map}return d.prototype.getMap=function(){return this._map},d.prototype.add=function(de,re){if(de==null)throw new Error(ye.NULL_ARGUMENT);if(re==null)throw new Error(ye.NULL_ARGUMENT);var ie=this._map.get(de);ie!==void 0?(ie.push(re),this._map.set(de,ie)):this._map.set(de,[re])},d.prototype.get=function(de){if(de==null)throw new Error(ye.NULL_ARGUMENT);var re=this._map.get(de);if(re!==void 0)return re;throw new Error(ye.KEY_NOT_FOUND)},d.prototype.remove=function(de){if(de==null)throw new Error(ye.NULL_ARGUMENT);if(!this._map.delete(de))throw new Error(ye.KEY_NOT_FOUND)},d.prototype.removeByCondition=function(de){var re=this;this._map.forEach(function(ie,se){var Be=ie.filter(function($){return!de($)});Be.length>0?re._map.set(se,Be):re._map.delete(se)})},d.prototype.hasKey=function(de){if(de==null)throw new Error(ye.NULL_ARGUMENT);return this._map.has(de)},d.prototype.clone=function(){var de=new d;return this._map.forEach(function(re,ie){re.forEach(function(se){return de.add(ie,se.clone())})}),de},d.prototype.traverse=function(de){this._map.forEach(function(re,ie){de(ie,re)})},d}();B.Lookup=C},86700:function(zr,B,S){"use strict";var ye;ye={value:!0},ye=ye=ye=ye=ye=ye=B.GW=ye=ye=B.zY=ye=ye=ye=ye=ye=B.f3=ye=ye=B.b2=ye=ye=ye=ye=ye=B.W2=ye=void 0;var C=S(6867);ye=C;var d=S(51389);Object.defineProperty(B,"W2",{enumerable:!0,get:function(){return d.Container}});var de=S(28421);ye={enumerable:!0,get:function(){return de.BindingScopeEnum}},ye={enumerable:!0,get:function(){return de.BindingTypeEnum}},ye={enumerable:!0,get:function(){return de.TargetTypeEnum}};var re=S(33244);ye={enumerable:!0,get:function(){return re.AsyncContainerModule}},ye={enumerable:!0,get:function(){return re.ContainerModule}};var ie=S(64315);Object.defineProperty(B,"b2",{enumerable:!0,get:function(){return ie.injectable}});var se=S(32052);ye={enumerable:!0,get:function(){return se.tagged}};var Be=S(38085);ye={enumerable:!0,get:function(){return Be.named}};var $=S(5744);Object.defineProperty(B,"f3",{enumerable:!0,get:function(){return $.inject}}),ye={enumerable:!0,get:function(){return $.LazyServiceIdentifer}};var Je=S(6515);ye={enumerable:!0,get:function(){return Je.optional}};var bt=S(86757);ye={enumerable:!0,get:function(){return bt.unmanaged}};var Gt=S(71693);ye={enumerable:!0,get:function(){return Gt.multiInject}};var Ir=S(55638);ye={enumerable:!0,get:function(){return Ir.targetName}};var Qt=S(7014);Object.defineProperty(B,"zY",{enumerable:!0,get:function(){return Qt.postConstruct}});var Yt=S(51377);ye={enumerable:!0,get:function(){return Yt.MetadataReader}};var ir=S(37791);ye={enumerable:!0,get:function(){return ir.id}};var jt=S(99934);Object.defineProperty(B,"GW",{enumerable:!0,get:function(){return jt.decorate}});var Tt=S(80758);ye={enumerable:!0,get:function(){return Tt.traverseAncerstors}},ye={enumerable:!0,get:function(){return Tt.taggedConstraint}},ye={enumerable:!0,get:function(){return Tt.namedConstraint}},ye={enumerable:!0,get:function(){return Tt.typeConstraint}};var Ct=S(55800);ye={enumerable:!0,get:function(){return Ct.getServiceIdentifierAsString}};var br=S(70600);ye={enumerable:!0,get:function(){return br.multiBindToService}}},95228:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Context=void 0;var ye=S(37791),C=function(){function d(de){this.id=ye.id(),this.container=de}return d.prototype.addPlan=function(de){this.plan=de},d.prototype.setCurrentRequest=function(de){this.currentRequest=de},d}();B.Context=C},47738:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Metadata=void 0;var ye=S(6867),C=function(){function d(de,re){this.key=de,this.value=re}return d.prototype.toString=function(){return this.key===ye.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},d}();B.Metadata=C},51377:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.MetadataReader=void 0;var ye=S(6867),C=function(){function d(){}return d.prototype.getConstructorMetadata=function(de){var re=Reflect.getMetadata(ye.PARAM_TYPES,de),ie=Reflect.getMetadata(ye.TAGGED,de);return{compilerGeneratedMetadata:re,userGeneratedMetadata:ie||{}}},d.prototype.getPropertiesMetadata=function(de){var re=Reflect.getMetadata(ye.TAGGED_PROP,de)||[];return re},d}();B.MetadataReader=C},55314:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Plan=void 0;var S=function(){function ye(C,d){this.parentContext=C,this.rootRequest=d}return ye}();B.Plan=S},86311:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.getBindingDictionary=B.createMockRequest=B.plan=void 0;var ye=S(23184),C=S(16674),d=S(28421),de=S(6867),re=S(85265),ie=S(55800),se=S(95228),Be=S(47738),$=S(55314),Je=S(6e3),bt=S(6748),Gt=S(18924);function Ir(q){return q._bindingDictionary}B.getBindingDictionary=Ir;function Qt(q,dr,Qe,$e,Rt,Xe){var Zt=q?de.MULTI_INJECT_TAG:de.INJECT_TAG,xr=new Be.Metadata(Zt,Qe),qt=new Gt.Target(dr,$e,Qe,xr);if(Rt!==void 0){var Xr=new Be.Metadata(Rt,Xe);qt.metadata.push(Xr)}return qt}function Yt(q,dr,Qe,$e,Rt){var Xe=Tt(Qe.container,Rt.serviceIdentifier),Zt=[];return Xe.length===ye.BindingCount.NoBindingsAvailable&&Qe.container.options.autoBindInjectable&&typeof Rt.serviceIdentifier=="function"&&q.getConstructorMetadata(Rt.serviceIdentifier).compilerGeneratedMetadata&&(Qe.container.bind(Rt.serviceIdentifier).toSelf(),Xe=Tt(Qe.container,Rt.serviceIdentifier)),dr?Zt=Xe:Zt=Xe.filter(function(xr){var qt=new bt.Request(xr.serviceIdentifier,Qe,$e,xr,Rt);return xr.constraint(qt)}),ir(Rt.serviceIdentifier,Zt,Rt,Qe.container),Zt}function ir(q,dr,Qe,$e){switch(dr.length){case ye.BindingCount.NoBindingsAvailable:if(Qe.isOptional())return dr;var Rt=ie.getServiceIdentifierAsString(q),Xe=C.NOT_REGISTERED;throw Xe+=ie.listMetadataForTarget(Rt,Qe),Xe+=ie.listRegisteredBindingsForServiceIdentifier($e,Rt,Tt),new Error(Xe);case ye.BindingCount.OnlyOneBindingAvailable:if(!Qe.isArray())return dr;case ye.BindingCount.MultipleBindingsAvailable:default:if(Qe.isArray())return dr;var Rt=ie.getServiceIdentifierAsString(q),Xe=C.AMBIGUOUS_MATCH+" "+Rt;throw Xe+=ie.listRegisteredBindingsForServiceIdentifier($e,Rt,Tt),new Error(Xe)}}function jt(q,dr,Qe,$e,Rt,Xe){var Zt,xr;if(Rt===null){Zt=Yt(q,dr,$e,null,Xe),xr=new bt.Request(Qe,$e,null,Zt,Xe);var qt=new $.Plan($e,xr);$e.addPlan(qt)}else Zt=Yt(q,dr,$e,Rt,Xe),xr=Rt.addChildRequest(Xe.serviceIdentifier,Zt,Xe);Zt.forEach(function(Xr){var ce=null;if(Xe.isArray())ce=xr.addChildRequest(Xr.serviceIdentifier,Xr,Xe);else{if(Xr.cache)return;ce=xr}if(Xr.type===d.BindingTypeEnum.Instance&&Xr.implementationType!==null){var Re=Je.getDependencies(q,Xr.implementationType);if(!$e.container.options.skipBaseClassChecks){var ge=Je.getBaseClassDependencyCount(q,Xr.implementationType);if(Re.length<ge){var xt=C.ARGUMENTS_LENGTH_MISMATCH(Je.getFunctionName(Xr.implementationType));throw new Error(xt)}}Re.forEach(function(vt){jt(q,!1,vt.serviceIdentifier,$e,ce,vt)})}})}function Tt(q,dr){var Qe=[],$e=Ir(q);return $e.hasKey(dr)?Qe=$e.get(dr):q.parent!==null&&(Qe=Tt(q.parent,dr)),Qe}function Ct(q,dr,Qe,$e,Rt,Xe,Zt,xr){xr===void 0&&(xr=!1);var qt=new se.Context(dr),Xr=Qt(Qe,$e,Rt,"",Xe,Zt);try{return jt(q,xr,Rt,qt,null,Xr),qt}catch(ce){throw re.isStackOverflowExeption(ce)&&qt.plan&&ie.circularDependencyToException(qt.plan.rootRequest),ce}}B.plan=Ct;function br(q,dr,Qe,$e){var Rt=new Gt.Target(d.TargetTypeEnum.Variable,"",dr,new Be.Metadata(Qe,$e)),Xe=new se.Context(q),Zt=new bt.Request(dr,Xe,null,[],Rt);return Zt}B.createMockRequest=br},88460:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.QueryableString=void 0;var S=function(){function ye(C){this.str=C}return ye.prototype.startsWith=function(C){return this.str.indexOf(C)===0},ye.prototype.endsWith=function(C){var d="",de=C.split("").reverse().join("");return d=this.str.split("").reverse().join(""),this.startsWith.call({str:d},de)},ye.prototype.contains=function(C){return this.str.indexOf(C)!==-1},ye.prototype.equals=function(C){return this.str===C},ye.prototype.value=function(){return this.str},ye}();B.QueryableString=S},6e3:function(zr,B,S){"use strict";var ye=this&&this.__spreadArray||function(Yt,ir){for(var jt=0,Tt=ir.length,Ct=Yt.length;jt<Tt;jt++,Ct++)Yt[Ct]=ir[jt];return Yt};Object.defineProperty(B,"__esModule",{value:!0}),B.getFunctionName=B.getBaseClassDependencyCount=B.getDependencies=void 0;var C=S(5744),d=S(16674),de=S(28421),re=S(6867),ie=S(55800);Object.defineProperty(B,"getFunctionName",{enumerable:!0,get:function(){return ie.getFunctionName}});var se=S(18924);function Be(Yt,ir){var jt=ie.getFunctionName(ir),Tt=$(Yt,jt,ir,!1);return Tt}B.getDependencies=Be;function $(Yt,ir,jt,Tt){var Ct=Yt.getConstructorMetadata(jt),br=Ct.compilerGeneratedMetadata;if(br===void 0){var q=d.MISSING_INJECTABLE_ANNOTATION+" "+ir+".";throw new Error(q)}var dr=Ct.userGeneratedMetadata,Qe=Object.keys(dr),$e=jt.length===0&&Qe.length>0,Rt=Qe.length>jt.length,Xe=$e||Rt?Qe.length:jt.length,Zt=bt(Tt,ir,br,dr,Xe),xr=Gt(Yt,jt),qt=ye(ye([],Zt),xr);return qt}function Je(Yt,ir,jt,Tt,Ct){var br=Ct[Yt.toString()]||[],q=Qt(br),dr=q.unmanaged!==!0,Qe=Tt[Yt],$e=q.inject||q.multiInject;if(Qe=$e||Qe,Qe instanceof C.LazyServiceIdentifer&&(Qe=Qe.unwrap()),dr){var Rt=Qe===Object,Xe=Qe===Function,Zt=Qe===void 0,xr=Rt||Xe||Zt;if(!ir&&xr){var qt=d.MISSING_INJECT_ANNOTATION+" argument "+Yt+" in class "+jt+".";throw new Error(qt)}var Xr=new se.Target(de.TargetTypeEnum.ConstructorArgument,q.targetName,Qe);return Xr.metadata=br,Xr}return null}function bt(Yt,ir,jt,Tt,Ct){for(var br=[],q=0;q<Ct;q++){var dr=q,Qe=Je(dr,Yt,ir,jt,Tt);Qe!==null&&br.push(Qe)}return br}function Gt(Yt,ir){for(var jt=Yt.getPropertiesMetadata(ir),Tt=[],Ct=Object.keys(jt),br=0,q=Ct;br<q.length;br++){var dr=q[br],Qe=jt[dr],$e=Qt(jt[dr]),Rt=$e.targetName||dr,Xe=$e.inject||$e.multiInject,Zt=new se.Target(de.TargetTypeEnum.ClassProperty,Rt,Xe);Zt.metadata=Qe,Tt.push(Zt)}var xr=Object.getPrototypeOf(ir.prototype).constructor;if(xr!==Object){var qt=Gt(Yt,xr);Tt=ye(ye([],Tt),qt)}return Tt}function Ir(Yt,ir){var jt=Object.getPrototypeOf(ir.prototype).constructor;if(jt!==Object){var Tt=ie.getFunctionName(jt),Ct=$(Yt,Tt,jt,!0),br=Ct.map(function(Qe){return Qe.metadata.filter(function($e){return $e.key===re.UNMANAGED_TAG})}),q=[].concat.apply([],br).length,dr=Ct.length-q;return dr>0?dr:Ir(Yt,jt)}else return 0}B.getBaseClassDependencyCount=Ir;function Qt(Yt){var ir={};return Yt.forEach(function(jt){ir[jt.key.toString()]=jt.value}),{inject:ir[re.INJECT_TAG],multiInject:ir[re.MULTI_INJECT_TAG],targetName:ir[re.NAME_TAG],unmanaged:ir[re.UNMANAGED_TAG]}}},6748:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Request=void 0;var ye=S(37791),C=function(){function d(de,re,ie,se,Be){this.id=ye.id(),this.serviceIdentifier=de,this.parentContext=re,this.parentRequest=ie,this.target=Be,this.childRequests=[],this.bindings=Array.isArray(se)?se:[se],this.requestScope=ie===null?new Map:null}return d.prototype.addChildRequest=function(de,re,ie){var se=new d(de,this.parentContext,this,re,ie);return this.childRequests.push(se),se},d}();B.Request=C},18924:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.Target=void 0;var ye=S(6867),C=S(37791),d=S(47738),de=S(88460),re=function(){function ie(se,Be,$,Je){this.id=C.id(),this.type=se,this.serviceIdentifier=$,this.name=new de.QueryableString(Be||""),this.metadata=new Array;var bt=null;typeof Je=="string"?bt=new d.Metadata(ye.NAMED_TAG,Je):Je instanceof d.Metadata&&(bt=Je),bt!==null&&this.metadata.push(bt)}return ie.prototype.hasTag=function(se){for(var Be=0,$=this.metadata;Be<$.length;Be++){var Je=$[Be];if(Je.key===se)return!0}return!1},ie.prototype.isArray=function(){return this.hasTag(ye.MULTI_INJECT_TAG)},ie.prototype.matchesArray=function(se){return this.matchesTag(ye.MULTI_INJECT_TAG)(se)},ie.prototype.isNamed=function(){return this.hasTag(ye.NAMED_TAG)},ie.prototype.isTagged=function(){return this.metadata.some(function(se){return ye.NON_CUSTOM_TAG_KEYS.every(function(Be){return se.key!==Be})})},ie.prototype.isOptional=function(){return this.matchesTag(ye.OPTIONAL_TAG)(!0)},ie.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(se){return se.key===ye.NAMED_TAG})[0]:null},ie.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(se){return ye.NON_CUSTOM_TAG_KEYS.every(function(Be){return se.key!==Be})}):null},ie.prototype.matchesNamedTag=function(se){return this.matchesTag(ye.NAMED_TAG)(se)},ie.prototype.matchesTag=function(se){var Be=this;return function($){for(var Je=0,bt=Be.metadata;Je<bt.length;Je++){var Gt=bt[Je];if(Gt.key===se&&Gt.value===$)return!0}return!1}},ie}();B.Target=re},52279:function(zr,B,S){"use strict";var ye=this&&this.__spreadArray||function($,Je){for(var bt=0,Gt=Je.length,Ir=$.length;bt<Gt;bt++,Ir++)$[Ir]=Je[bt];return $};Object.defineProperty(B,"__esModule",{value:!0}),B.resolveInstance=void 0;var C=S(16674),d=S(28421),de=S(6867);function re($,Je,bt){var Gt=Je.filter(function(Qt){return Qt.target!==null&&Qt.target.type===d.TargetTypeEnum.ClassProperty}),Ir=Gt.map(bt);return Gt.forEach(function(Qt,Yt){var ir="";ir=Qt.target.name.value();var jt=Ir[Yt];$[ir]=jt}),$}function ie($,Je){return new($.bind.apply($,ye([void 0],Je)))}function se($,Je){if(Reflect.hasMetadata(de.POST_CONSTRUCT,$)){var bt=Reflect.getMetadata(de.POST_CONSTRUCT,$);try{Je[bt.value]()}catch(Gt){throw new Error(C.POST_CONSTRUCT_ERROR($.name,Gt.message))}}}function Be($,Je,bt){var Gt=null;if(Je.length>0){var Ir=Je.filter(function(Yt){return Yt.target!==null&&Yt.target.type===d.TargetTypeEnum.ConstructorArgument}),Qt=Ir.map(bt);Gt=ie($,Qt),Gt=re(Gt,Je,bt)}else Gt=new $;return se($,Gt),Gt}B.resolveInstance=Be},31927:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.resolve=void 0;var ye=S(16674),C=S(28421),d=S(85265),de=S(55800),re=S(52279),ie=function($,Je,bt){try{return bt()}catch(Gt){throw d.isStackOverflowExeption(Gt)?new Error(ye.CIRCULAR_DEPENDENCY_IN_FACTORY($,Je.toString())):Gt}},se=function($){return function(Je){Je.parentContext.setCurrentRequest(Je);var bt=Je.bindings,Gt=Je.childRequests,Ir=Je.target&&Je.target.isArray(),Qt=!Je.parentRequest||!Je.parentRequest.target||!Je.target||!Je.parentRequest.target.matchesArray(Je.target.serviceIdentifier);if(Ir&&Qt)return Gt.map(function(br){var q=se($);return q(br)});var Yt=null;if(Je.target.isOptional()&&bt.length===0)return;var ir=bt[0],jt=ir.scope===C.BindingScopeEnum.Singleton,Tt=ir.scope===C.BindingScopeEnum.Request;if(jt&&ir.activated)return ir.cache;if(Tt&&$!==null&&$.has(ir.id))return $.get(ir.id);if(ir.type===C.BindingTypeEnum.ConstantValue)Yt=ir.cache,ir.activated=!0;else if(ir.type===C.BindingTypeEnum.Function)Yt=ir.cache,ir.activated=!0;else if(ir.type===C.BindingTypeEnum.Constructor)Yt=ir.implementationType;else if(ir.type===C.BindingTypeEnum.DynamicValue&&ir.dynamicValue!==null)Yt=ie("toDynamicValue",ir.serviceIdentifier,function(){return ir.dynamicValue(Je.parentContext)});else if(ir.type===C.BindingTypeEnum.Factory&&ir.factory!==null)Yt=ie("toFactory",ir.serviceIdentifier,function(){return ir.factory(Je.parentContext)});else if(ir.type===C.BindingTypeEnum.Provider&&ir.provider!==null)Yt=ie("toProvider",ir.serviceIdentifier,function(){return ir.provider(Je.parentContext)});else if(ir.type===C.BindingTypeEnum.Instance&&ir.implementationType!==null)Yt=re.resolveInstance(ir.implementationType,Gt,se($));else{var Ct=de.getServiceIdentifierAsString(Je.serviceIdentifier);throw new Error(ye.INVALID_BINDING_TYPE+" "+Ct)}return typeof ir.onActivation=="function"&&(Yt=ir.onActivation(Je.parentContext,Yt)),jt&&(ir.cache=Yt,ir.activated=!0),Tt&&$!==null&&!$.has(ir.id)&&$.set(ir.id,Yt),Yt}};function Be($){var Je=se($.plan.rootRequest.requestScope);return Je($.plan.rootRequest)}B.resolve=Be},83366:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingInSyntax=void 0;var ye=S(28421),C=S(71325),d=function(){function de(re){this._binding=re}return de.prototype.inRequestScope=function(){return this._binding.scope=ye.BindingScopeEnum.Request,new C.BindingWhenOnSyntax(this._binding)},de.prototype.inSingletonScope=function(){return this._binding.scope=ye.BindingScopeEnum.Singleton,new C.BindingWhenOnSyntax(this._binding)},de.prototype.inTransientScope=function(){return this._binding.scope=ye.BindingScopeEnum.Transient,new C.BindingWhenOnSyntax(this._binding)},de}();B.BindingInSyntax=d},74889:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingInWhenOnSyntax=void 0;var ye=S(83366),C=S(51811),d=S(98370),de=function(){function re(ie){this._binding=ie,this._bindingWhenSyntax=new d.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new C.BindingOnSyntax(this._binding),this._bindingInSyntax=new ye.BindingInSyntax(ie)}return re.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},re.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},re.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},re.prototype.when=function(ie){return this._bindingWhenSyntax.when(ie)},re.prototype.whenTargetNamed=function(ie){return this._bindingWhenSyntax.whenTargetNamed(ie)},re.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},re.prototype.whenTargetTagged=function(ie,se){return this._bindingWhenSyntax.whenTargetTagged(ie,se)},re.prototype.whenInjectedInto=function(ie){return this._bindingWhenSyntax.whenInjectedInto(ie)},re.prototype.whenParentNamed=function(ie){return this._bindingWhenSyntax.whenParentNamed(ie)},re.prototype.whenParentTagged=function(ie,se){return this._bindingWhenSyntax.whenParentTagged(ie,se)},re.prototype.whenAnyAncestorIs=function(ie){return this._bindingWhenSyntax.whenAnyAncestorIs(ie)},re.prototype.whenNoAncestorIs=function(ie){return this._bindingWhenSyntax.whenNoAncestorIs(ie)},re.prototype.whenAnyAncestorNamed=function(ie){return this._bindingWhenSyntax.whenAnyAncestorNamed(ie)},re.prototype.whenAnyAncestorTagged=function(ie,se){return this._bindingWhenSyntax.whenAnyAncestorTagged(ie,se)},re.prototype.whenNoAncestorNamed=function(ie){return this._bindingWhenSyntax.whenNoAncestorNamed(ie)},re.prototype.whenNoAncestorTagged=function(ie,se){return this._bindingWhenSyntax.whenNoAncestorTagged(ie,se)},re.prototype.whenAnyAncestorMatches=function(ie){return this._bindingWhenSyntax.whenAnyAncestorMatches(ie)},re.prototype.whenNoAncestorMatches=function(ie){return this._bindingWhenSyntax.whenNoAncestorMatches(ie)},re.prototype.onActivation=function(ie){return this._bindingOnSyntax.onActivation(ie)},re}();B.BindingInWhenOnSyntax=de},51811:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingOnSyntax=void 0;var ye=S(98370),C=function(){function d(de){this._binding=de}return d.prototype.onActivation=function(de){return this._binding.onActivation=de,new ye.BindingWhenSyntax(this._binding)},d}();B.BindingOnSyntax=C},15451:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingToSyntax=void 0;var ye=S(16674),C=S(28421),d=S(74889),de=S(71325),re=function(){function ie(se){this._binding=se}return ie.prototype.to=function(se){return this._binding.type=C.BindingTypeEnum.Instance,this._binding.implementationType=se,new d.BindingInWhenOnSyntax(this._binding)},ie.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ye.INVALID_TO_SELF_VALUE);var se=this._binding.serviceIdentifier;return this.to(se)},ie.prototype.toConstantValue=function(se){return this._binding.type=C.BindingTypeEnum.ConstantValue,this._binding.cache=se,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=C.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ie.prototype.toDynamicValue=function(se){return this._binding.type=C.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=se,this._binding.implementationType=null,new d.BindingInWhenOnSyntax(this._binding)},ie.prototype.toConstructor=function(se){return this._binding.type=C.BindingTypeEnum.Constructor,this._binding.implementationType=se,this._binding.scope=C.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ie.prototype.toFactory=function(se){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=se,this._binding.scope=C.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ie.prototype.toFunction=function(se){if(typeof se!="function")throw new Error(ye.INVALID_FUNCTION_BINDING);var Be=this.toConstantValue(se);return this._binding.type=C.BindingTypeEnum.Function,this._binding.scope=C.BindingScopeEnum.Singleton,Be},ie.prototype.toAutoFactory=function(se){return this._binding.type=C.BindingTypeEnum.Factory,this._binding.factory=function(Be){var $=function(){return Be.container.get(se)};return $},this._binding.scope=C.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ie.prototype.toProvider=function(se){return this._binding.type=C.BindingTypeEnum.Provider,this._binding.provider=se,this._binding.scope=C.BindingScopeEnum.Singleton,new de.BindingWhenOnSyntax(this._binding)},ie.prototype.toService=function(se){this.toDynamicValue(function(Be){return Be.container.get(se)})},ie}();B.BindingToSyntax=re},71325:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingWhenOnSyntax=void 0;var ye=S(51811),C=S(98370),d=function(){function de(re){this._binding=re,this._bindingWhenSyntax=new C.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ye.BindingOnSyntax(this._binding)}return de.prototype.when=function(re){return this._bindingWhenSyntax.when(re)},de.prototype.whenTargetNamed=function(re){return this._bindingWhenSyntax.whenTargetNamed(re)},de.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},de.prototype.whenTargetTagged=function(re,ie){return this._bindingWhenSyntax.whenTargetTagged(re,ie)},de.prototype.whenInjectedInto=function(re){return this._bindingWhenSyntax.whenInjectedInto(re)},de.prototype.whenParentNamed=function(re){return this._bindingWhenSyntax.whenParentNamed(re)},de.prototype.whenParentTagged=function(re,ie){return this._bindingWhenSyntax.whenParentTagged(re,ie)},de.prototype.whenAnyAncestorIs=function(re){return this._bindingWhenSyntax.whenAnyAncestorIs(re)},de.prototype.whenNoAncestorIs=function(re){return this._bindingWhenSyntax.whenNoAncestorIs(re)},de.prototype.whenAnyAncestorNamed=function(re){return this._bindingWhenSyntax.whenAnyAncestorNamed(re)},de.prototype.whenAnyAncestorTagged=function(re,ie){return this._bindingWhenSyntax.whenAnyAncestorTagged(re,ie)},de.prototype.whenNoAncestorNamed=function(re){return this._bindingWhenSyntax.whenNoAncestorNamed(re)},de.prototype.whenNoAncestorTagged=function(re,ie){return this._bindingWhenSyntax.whenNoAncestorTagged(re,ie)},de.prototype.whenAnyAncestorMatches=function(re){return this._bindingWhenSyntax.whenAnyAncestorMatches(re)},de.prototype.whenNoAncestorMatches=function(re){return this._bindingWhenSyntax.whenNoAncestorMatches(re)},de.prototype.onActivation=function(re){return this._bindingOnSyntax.onActivation(re)},de}();B.BindingWhenOnSyntax=d},98370:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.BindingWhenSyntax=void 0;var ye=S(51811),C=S(80758),d=function(){function de(re){this._binding=re}return de.prototype.when=function(re){return this._binding.constraint=re,new ye.BindingOnSyntax(this._binding)},de.prototype.whenTargetNamed=function(re){return this._binding.constraint=C.namedConstraint(re),new ye.BindingOnSyntax(this._binding)},de.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(re){var ie=re.target!==null&&!re.target.isNamed()&&!re.target.isTagged();return ie},new ye.BindingOnSyntax(this._binding)},de.prototype.whenTargetTagged=function(re,ie){return this._binding.constraint=C.taggedConstraint(re)(ie),new ye.BindingOnSyntax(this._binding)},de.prototype.whenInjectedInto=function(re){return this._binding.constraint=function(ie){return C.typeConstraint(re)(ie.parentRequest)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenParentNamed=function(re){return this._binding.constraint=function(ie){return C.namedConstraint(re)(ie.parentRequest)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenParentTagged=function(re,ie){return this._binding.constraint=function(se){return C.taggedConstraint(re)(ie)(se.parentRequest)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorIs=function(re){return this._binding.constraint=function(ie){return C.traverseAncerstors(ie,C.typeConstraint(re))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorIs=function(re){return this._binding.constraint=function(ie){return!C.traverseAncerstors(ie,C.typeConstraint(re))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorNamed=function(re){return this._binding.constraint=function(ie){return C.traverseAncerstors(ie,C.namedConstraint(re))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorNamed=function(re){return this._binding.constraint=function(ie){return!C.traverseAncerstors(ie,C.namedConstraint(re))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorTagged=function(re,ie){return this._binding.constraint=function(se){return C.traverseAncerstors(se,C.taggedConstraint(re)(ie))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorTagged=function(re,ie){return this._binding.constraint=function(se){return!C.traverseAncerstors(se,C.taggedConstraint(re)(ie))},new ye.BindingOnSyntax(this._binding)},de.prototype.whenAnyAncestorMatches=function(re){return this._binding.constraint=function(ie){return C.traverseAncerstors(ie,re)},new ye.BindingOnSyntax(this._binding)},de.prototype.whenNoAncestorMatches=function(re){return this._binding.constraint=function(ie){return!C.traverseAncerstors(ie,re)},new ye.BindingOnSyntax(this._binding)},de}();B.BindingWhenSyntax=d},80758:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.typeConstraint=B.namedConstraint=B.taggedConstraint=B.traverseAncerstors=void 0;var ye=S(6867),C=S(47738),d=function(se,Be){var $=se.parentRequest;return $!==null?Be($)?!0:d($,Be):!1};B.traverseAncerstors=d;var de=function(se){return function(Be){var $=function(Je){return Je!==null&&Je.target!==null&&Je.target.matchesTag(se)(Be)};return $.metaData=new C.Metadata(se,Be),$}};B.taggedConstraint=de;var re=de(ye.NAMED_TAG);B.namedConstraint=re;var ie=function(se){return function(Be){var $=null;if(Be!==null)if($=Be.bindings[0],typeof se=="string"){var Je=$.serviceIdentifier;return Je===se}else{var bt=Be.bindings[0].implementationType;return se===bt}return!1}};B.typeConstraint=ie},70600:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.multiBindToService=void 0;var S=function(ye){return function(C){return function(){for(var d=[],de=0;de<arguments.length;de++)d[de]=arguments[de];return d.forEach(function(re){return ye.bind(re).toService(C)})}}};B.multiBindToService=S},85265:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.isStackOverflowExeption=void 0;var ye=S(16674);function C(d){return d instanceof RangeError||d.message===ye.STACK_OVERFLOW}B.isStackOverflowExeption=C},37791:function(zr,B){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.id=void 0;var S=0;function ye(){return S++}B.id=ye},55800:function(zr,B,S){"use strict";Object.defineProperty(B,"__esModule",{value:!0}),B.circularDependencyToException=B.listMetadataForTarget=B.listRegisteredBindingsForServiceIdentifier=B.getServiceIdentifierAsString=B.getFunctionName=void 0;var ye=S(16674);function C($){if(typeof $=="function"){var Je=$;return Je.name}else{if(typeof $=="symbol")return $.toString();var Je=$;return Je}}B.getServiceIdentifierAsString=C;function d($,Je,bt){var Gt="",Ir=bt($,Je);return Ir.length!==0&&(Gt=`
Registered bindings:`,Ir.forEach(function(Qt){var Yt="Object";Qt.implementationType!==null&&(Yt=Be(Qt.implementationType)),Gt=Gt+`
 `+Yt,Qt.constraint.metaData&&(Gt=Gt+" - "+Qt.constraint.metaData)})),Gt}B.listRegisteredBindingsForServiceIdentifier=d;function de($,Je){return $.parentRequest===null?!1:$.parentRequest.serviceIdentifier===Je?!0:de($.parentRequest,Je)}function re($){function Je(Gt,Ir){Ir===void 0&&(Ir=[]);var Qt=C(Gt.serviceIdentifier);return Ir.push(Qt),Gt.parentRequest!==null?Je(Gt.parentRequest,Ir):Ir}var bt=Je($);return bt.reverse().join(" --> ")}function ie($){$.childRequests.forEach(function(Je){if(de(Je,Je.serviceIdentifier)){var bt=re(Je);throw new Error(ye.CIRCULAR_DEPENDENCY+" "+bt)}else ie(Je)})}B.circularDependencyToException=ie;function se($,Je){if(Je.isTagged()||Je.isNamed()){var bt="",Gt=Je.getNamedTag(),Ir=Je.getCustomTags();return Gt!==null&&(bt+=Gt.toString()+`
`),Ir!==null&&Ir.forEach(function(Qt){bt+=Qt.toString()+`
`})," "+$+`
 `+$+" - "+bt}else return" "+$}B.listMetadataForTarget=se;function Be($){if($.name)return $.name;var Je=$.toString(),bt=Je.match(/^function\s*([^\s(]+)/);return bt?bt[1]:"Anonymous function: "+Je}B.getFunctionName=Be},18857:function(zr,B,S){"use strict";S.r(B),S.d(B,{Function:function(){return nu},Interpreter:function(){return Ro},default:function(){return Fu},evaluate:function(){return il},vm:function(){return ye}});var ye={};S.r(ye),S.d(ye,{Script:function(){return yl},compileFunction:function(){return U},createContext:function(){return gl},runInContext:function(){return nl},runInNewContext:function(){return Rl}});var C={3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"},d="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",de={5:d,"5module":d+" export import",6:d+" const class extends export import super"},re=/^in(stanceof)?$/,ie="\xAA\xB5\xBA\xC0-\xD6\xD8-\xF6\xF8-\u02C1\u02C6-\u02D1\u02E0-\u02E4\u02EC\u02EE\u0370-\u0374\u0376\u0377\u037A-\u037D\u037F\u0386\u0388-\u038A\u038C\u038E-\u03A1\u03A3-\u03F5\u03F7-\u0481\u048A-\u052F\u0531-\u0556\u0559\u0560-\u0588\u05D0-\u05EA\u05EF-\u05F2\u0620-\u064A\u066E\u066F\u0671-\u06D3\u06D5\u06E5\u06E6\u06EE\u06EF\u06FA-\u06FC\u06FF\u0710\u0712-\u072F\u074D-\u07A5\u07B1\u07CA-\u07EA\u07F4\u07F5\u07FA\u0800-\u0815\u081A\u0824\u0828\u0840-\u0858\u0860-\u086A\u08A0-\u08B4\u08B6-\u08C7\u0904-\u0939\u093D\u0950\u0958-\u0961\u0971-\u0980\u0985-\u098C\u098F\u0990\u0993-\u09A8\u09AA-\u09B0\u09B2\u09B6-\u09B9\u09BD\u09CE\u09DC\u09DD\u09DF-\u09E1\u09F0\u09F1\u09FC\u0A05-\u0A0A\u0A0F\u0A10\u0A13-\u0A28\u0A2A-\u0A30\u0A32\u0A33\u0A35\u0A36\u0A38\u0A39\u0A59-\u0A5C\u0A5E\u0A72-\u0A74\u0A85-\u0A8D\u0A8F-\u0A91\u0A93-\u0AA8\u0AAA-\u0AB0\u0AB2\u0AB3\u0AB5-\u0AB9\u0ABD\u0AD0\u0AE0\u0AE1\u0AF9\u0B05-\u0B0C\u0B0F\u0B10\u0B13-\u0B28\u0B2A-\u0B30\u0B32\u0B33\u0B35-\u0B39\u0B3D\u0B5C\u0B5D\u0B5F-\u0B61\u0B71\u0B83\u0B85-\u0B8A\u0B8E-\u0B90\u0B92-\u0B95\u0B99\u0B9A\u0B9C\u0B9E\u0B9F\u0BA3\u0BA4\u0BA8-\u0BAA\u0BAE-\u0BB9\u0BD0\u0C05-\u0C0C\u0C0E-\u0C10\u0C12-\u0C28\u0C2A-\u0C39\u0C3D\u0C58-\u0C5A\u0C60\u0C61\u0C80\u0C85-\u0C8C\u0C8E-\u0C90\u0C92-\u0CA8\u0CAA-\u0CB3\u0CB5-\u0CB9\u0CBD\u0CDE\u0CE0\u0CE1\u0CF1\u0CF2\u0D04-\u0D0C\u0D0E-\u0D10\u0D12-\u0D3A\u0D3D\u0D4E\u0D54-\u0D56\u0D5F-\u0D61\u0D7A-\u0D7F\u0D85-\u0D96\u0D9A-\u0DB1\u0DB3-\u0DBB\u0DBD\u0DC0-\u0DC6\u0E01-\u0E30\u0E32\u0E33\u0E40-\u0E46\u0E81\u0E82\u0E84\u0E86-\u0E8A\u0E8C-\u0EA3\u0EA5\u0EA7-\u0EB0\u0EB2\u0EB3\u0EBD\u0EC0-\u0EC4\u0EC6\u0EDC-\u0EDF\u0F00\u0F40-\u0F47\u0F49-\u0F6C\u0F88-\u0F8C\u1000-\u102A\u103F\u1050-\u1055\u105A-\u105D\u1061\u1065\u1066\u106E-\u1070\u1075-\u1081\u108E\u10A0-\u10C5\u10C7\u10CD\u10D0-\u10FA\u10FC-\u1248\u124A-\u124D\u1250-\u1256\u1258\u125A-\u125D\u1260-\u1288\u128A-\u128D\u1290-\u12B0\u12B2-\u12B5\u12B8-\u12BE\u12C0\u12C2-\u12C5\u12C8-\u12D6\u12D8-\u1310\u1312-\u1315\u1318-\u135A\u1380-\u138F\u13A0-\u13F5\u13F8-\u13FD\u1401-\u166C\u166F-\u167F\u1681-\u169A\u16A0-\u16EA\u16EE-\u16F8\u1700-\u170C\u170E-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176C\u176E-\u1770\u1780-\u17B3\u17D7\u17DC\u1820-\u1878\u1880-\u18A8\u18AA\u18B0-\u18F5\u1900-\u191E\u1950-\u196D\u1970-\u1974\u1980-\u19AB\u19B0-\u19C9\u1A00-\u1A16\u1A20-\u1A54\u1AA7\u1B05-\u1B33\u1B45-\u1B4B\u1B83-\u1BA0\u1BAE\u1BAF\u1BBA-\u1BE5\u1C00-\u1C23\u1C4D-\u1C4F\u1C5A-\u1C7D\u1C80-\u1C88\u1C90-\u1CBA\u1CBD-\u1CBF\u1CE9-\u1CEC\u1CEE-\u1CF3\u1CF5\u1CF6\u1CFA\u1D00-\u1DBF\u1E00-\u1F15\u1F18-\u1F1D\u1F20-\u1F45\u1F48-\u1F4D\u1F50-\u1F57\u1F59\u1F5B\u1F5D\u1F5F-\u1F7D\u1F80-\u1FB4\u1FB6-\u1FBC\u1FBE\u1FC2-\u1FC4\u1FC6-\u1FCC\u1FD0-\u1FD3\u1FD6-\u1FDB\u1FE0-\u1FEC\u1FF2-\u1FF4\u1FF6-\u1FFC\u2071\u207F\u2090-\u209C\u2102\u2107\u210A-\u2113\u2115\u2118-\u211D\u2124\u2126\u2128\u212A-\u2139\u213C-\u213F\u2145-\u2149\u214E\u2160-\u2188\u2C00-\u2C2E\u2C30-\u2C5E\u2C60-\u2CE4\u2CEB-\u2CEE\u2CF2\u2CF3\u2D00-\u2D25\u2D27\u2D2D\u2D30-\u2D67\u2D6F\u2D80-\u2D96\u2DA0-\u2DA6\u2DA8-\u2DAE\u2DB0-\u2DB6\u2DB8-\u2DBE\u2DC0-\u2DC6\u2DC8-\u2DCE\u2DD0-\u2DD6\u2DD8-\u2DDE\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303C\u3041-\u3096\u309B-\u309F\u30A1-\u30FA\u30FC-\u30FF\u3105-\u312F\u3131-\u318E\u31A0-\u31BF\u31F0-\u31FF\u3400-\u4DBF\u4E00-\u9FFC\uA000-\uA48C\uA4D0-\uA4FD\uA500-\uA60C\uA610-\uA61F\uA62A\uA62B\uA640-\uA66E\uA67F-\uA69D\uA6A0-\uA6EF\uA717-\uA71F\uA722-\uA788\uA78B-\uA7BF\uA7C2-\uA7CA\uA7F5-\uA801\uA803-\uA805\uA807-\uA80A\uA80C-\uA822\uA840-\uA873\uA882-\uA8B3\uA8F2-\uA8F7\uA8FB\uA8FD\uA8FE\uA90A-\uA925\uA930-\uA946\uA960-\uA97C\uA984-\uA9B2\uA9CF\uA9E0-\uA9E4\uA9E6-\uA9EF\uA9FA-\uA9FE\uAA00-\uAA28\uAA40-\uAA42\uAA44-\uAA4B\uAA60-\uAA76\uAA7A\uAA7E-\uAAAF\uAAB1\uAAB5\uAAB6\uAAB9-\uAABD\uAAC0\uAAC2\uAADB-\uAADD\uAAE0-\uAAEA\uAAF2-\uAAF4\uAB01-\uAB06\uAB09-\uAB0E\uAB11-\uAB16\uAB20-\uAB26\uAB28-\uAB2E\uAB30-\uAB5A\uAB5C-\uAB69\uAB70-\uABE2\uAC00-\uD7A3\uD7B0-\uD7C6\uD7CB-\uD7FB\uF900-\uFA6D\uFA70-\uFAD9\uFB00-\uFB06\uFB13-\uFB17\uFB1D\uFB1F-\uFB28\uFB2A-\uFB36\uFB38-\uFB3C\uFB3E\uFB40\uFB41\uFB43\uFB44\uFB46-\uFBB1\uFBD3-\uFD3D\uFD50-\uFD8F\uFD92-\uFDC7\uFDF0-\uFDFB\uFE70-\uFE74\uFE76-\uFEFC\uFF21-\uFF3A\uFF41-\uFF5A\uFF66-\uFFBE\uFFC2-\uFFC7\uFFCA-\uFFCF\uFFD2-\uFFD7\uFFDA-\uFFDC",se="\u200C\u200D\xB7\u0300-\u036F\u0387\u0483-\u0487\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u0669\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u06F0-\u06F9\u0711\u0730-\u074A\u07A6-\u07B0\u07C0-\u07C9\u07EB-\u07F3\u07FD\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08D3-\u08E1\u08E3-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0966-\u096F\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u09E6-\u09EF\u09FE\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A66-\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0AE6-\u0AEF\u0AFA-\u0AFF\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B55-\u0B57\u0B62\u0B63\u0B66-\u0B6F\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0BE6-\u0BEF\u0C00-\u0C04\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C66-\u0C6F\u0C81-\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0CE6-\u0CEF\u0D00-\u0D03\u0D3B\u0D3C\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D66-\u0D6F\u0D81-\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DE6-\u0DEF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0E50-\u0E59\u0EB1\u0EB4-\u0EBC\u0EC8-\u0ECD\u0ED0-\u0ED9\u0F18\u0F19\u0F20-\u0F29\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1040-\u1049\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F-\u109D\u135D-\u135F\u1369-\u1371\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u17E0-\u17E9\u180B-\u180D\u1810-\u1819\u18A9\u1920-\u192B\u1930-\u193B\u1946-\u194F\u19D0-\u19DA\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F-\u1A89\u1A90-\u1A99\u1AB0-\u1ABD\u1ABF\u1AC0\u1B00-\u1B04\u1B34-\u1B44\u1B50-\u1B59\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BB0-\u1BB9\u1BE6-\u1BF3\u1C24-\u1C37\u1C40-\u1C49\u1C50-\u1C59\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF4\u1CF7-\u1CF9\u1DC0-\u1DF9\u1DFB-\u1DFF\u203F\u2040\u2054\u20D0-\u20DC\u20E1\u20E5-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA620-\uA629\uA66F\uA674-\uA67D\uA69E\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA82C\uA880\uA881\uA8B4-\uA8C5\uA8D0-\uA8D9\uA8E0-\uA8F1\uA8FF-\uA909\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uA9D0-\uA9D9\uA9E5\uA9F0-\uA9F9\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA50-\uAA59\uAA7B-\uAA7D\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uABF0-\uABF9\uFB1E\uFE00-\uFE0F\uFE20-\uFE2F\uFE33\uFE34\uFE4D-\uFE4F\uFF10-\uFF19\uFF3F",Be=new RegExp("["+ie+"]"),$=new RegExp("["+ie+se+"]");ie=se=null;var Je=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],bt=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function Gt(m,w){for(var N=65536,I=0;I<w.length;I+=2){if(N+=w[I],N>m)return!1;if(N+=w[I+1],N>=m)return!0}}function Ir(m,w){return m<65?m===36:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&Be.test(String.fromCharCode(m)):w===!1?!1:Gt(m,Je)}function Qt(m,w){return m<48?m===36:m<58?!0:m<65?!1:m<91?!0:m<97?m===95:m<123?!0:m<=65535?m>=170&&$.test(String.fromCharCode(m)):w===!1?!1:Gt(m,Je)||Gt(m,bt)}var Yt=function(w,N){N===void 0&&(N={}),this.label=w,this.keyword=N.keyword,this.beforeExpr=!!N.beforeExpr,this.startsExpr=!!N.startsExpr,this.isLoop=!!N.isLoop,this.isAssign=!!N.isAssign,this.prefix=!!N.prefix,this.postfix=!!N.postfix,this.binop=N.binop||null,this.updateContext=null};function ir(m,w){return new Yt(m,{beforeExpr:!0,binop:w})}var jt={beforeExpr:!0},Tt={startsExpr:!0},Ct={};function br(m,w){return w===void 0&&(w={}),w.keyword=m,Ct[m]=new Yt(m,w)}var q={num:new Yt("num",Tt),regexp:new Yt("regexp",Tt),string:new Yt("string",Tt),name:new Yt("name",Tt),eof:new Yt("eof"),bracketL:new Yt("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new Yt("]"),braceL:new Yt("{",{beforeExpr:!0,startsExpr:!0}),braceR:new Yt("}"),parenL:new Yt("(",{beforeExpr:!0,startsExpr:!0}),parenR:new Yt(")"),comma:new Yt(",",jt),semi:new Yt(";",jt),colon:new Yt(":",jt),dot:new Yt("."),question:new Yt("?",jt),questionDot:new Yt("?."),arrow:new Yt("=>",jt),template:new Yt("template"),invalidTemplate:new Yt("invalidTemplate"),ellipsis:new Yt("...",jt),backQuote:new Yt("`",Tt),dollarBraceL:new Yt("${",{beforeExpr:!0,startsExpr:!0}),eq:new Yt("=",{beforeExpr:!0,isAssign:!0}),assign:new Yt("_=",{beforeExpr:!0,isAssign:!0}),incDec:new Yt("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new Yt("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:ir("||",1),logicalAND:ir("&&",2),bitwiseOR:ir("|",3),bitwiseXOR:ir("^",4),bitwiseAND:ir("&",5),equality:ir("==/!=/===/!==",6),relational:ir("</>/<=/>=",7),bitShift:ir("<</>>/>>>",8),plusMin:new Yt("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:ir("%",10),star:ir("*",10),slash:ir("/",10),starstar:new Yt("**",{beforeExpr:!0}),coalesce:ir("??",1),_break:br("break"),_case:br("case",jt),_catch:br("catch"),_continue:br("continue"),_debugger:br("debugger"),_default:br("default",jt),_do:br("do",{isLoop:!0,beforeExpr:!0}),_else:br("else",jt),_finally:br("finally"),_for:br("for",{isLoop:!0}),_function:br("function",Tt),_if:br("if"),_return:br("return",jt),_switch:br("switch"),_throw:br("throw",jt),_try:br("try"),_var:br("var"),_const:br("const"),_while:br("while",{isLoop:!0}),_with:br("with"),_new:br("new",{beforeExpr:!0,startsExpr:!0}),_this:br("this",Tt),_super:br("super",Tt),_class:br("class",Tt),_extends:br("extends",jt),_export:br("export"),_import:br("import",Tt),_null:br("null",Tt),_true:br("true",Tt),_false:br("false",Tt),_in:br("in",{beforeExpr:!0,binop:7}),_instanceof:br("instanceof",{beforeExpr:!0,binop:7}),_typeof:br("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:br("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:br("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},dr=/\r\n?|\n|\u2028|\u2029/,Qe=new RegExp(dr.source,"g");function $e(m,w){return m===10||m===13||!w&&(m===8232||m===8233)}var Rt=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,Xe=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,Zt=Object.prototype,xr=Zt.hasOwnProperty,qt=Zt.toString;function Xr(m,w){return xr.call(m,w)}var ce=Array.isArray||function(m){return qt.call(m)==="[object Array]"};function Re(m){return new RegExp("^(?:"+m.replace(/ /g,"|")+")$")}var ge=function(w,N){this.line=w,this.column=N};ge.prototype.offset=function(w){return new ge(this.line,this.column+w)};var xt=function(w,N,I){this.start=N,this.end=I,w.sourceFile!==null&&(this.source=w.sourceFile)};function vt(m,w){for(var N=1,I=0;;){Qe.lastIndex=I;var le=Qe.exec(m);if(le&&le.index<w)++N,I=le.index+le[0].length;else return new ge(N,w-I)}}var Nt={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function Dt(m){var w={};for(var N in Nt)w[N]=m&&Xr(m,N)?m[N]:Nt[N];if(w.ecmaVersion>=2015&&(w.ecmaVersion-=2009),w.allowReserved==null&&(w.allowReserved=w.ecmaVersion<5),ce(w.onToken)){var I=w.onToken;w.onToken=function(le){return I.push(le)}}return ce(w.onComment)&&(w.onComment=Ur(w,w.onComment)),w}function Ur(m,w){return function(N,I,le,Oe,ct,Ft){var Ut={type:N?"Block":"Line",value:I,start:le,end:Oe};m.locations&&(Ut.loc=new xt(this,ct,Ft)),m.ranges&&(Ut.range=[le,Oe]),w.push(Ut)}}var dn=1,on=2,$i=dn|on,or=4,me=8,Ae=16,Ue=32,Le=64,kt=128;function nr(m,w){return on|(m?or:0)|(w?me:0)}var _r=0,Lr=1,fr=2,H=3,E=4,V=5,Ze=function(w,N,I){this.options=w=Dt(w),this.sourceFile=w.sourceFile,this.keywords=Re(de[w.ecmaVersion>=6?6:w.sourceType==="module"?"5module":5]);var le="";if(w.allowReserved!==!0){for(var Oe=w.ecmaVersion;!(le=C[Oe]);Oe--);w.sourceType==="module"&&(le+=" await")}this.reservedWords=Re(le);var ct=(le?le+" ":"")+C.strict;this.reservedWordsStrict=Re(ct),this.reservedWordsStrictBind=Re(ct+" "+C.strictBind),this.input=String(N),this.containsEsc=!1,I?(this.pos=I,this.lineStart=this.input.lastIndexOf(`
`,I-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(dr).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=q.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule=w.sourceType==="module",this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},this.pos===0&&w.allowHashBang&&this.input.slice(0,2)==="#!"&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(dn),this.regexpState=null},tt={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};Ze.prototype.parse=function(){var w=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(w)},tt.inFunction.get=function(){return(this.currentVarScope().flags&on)>0},tt.inGenerator.get=function(){return(this.currentVarScope().flags&me)>0},tt.inAsync.get=function(){return(this.currentVarScope().flags&or)>0},tt.allowSuper.get=function(){return(this.currentThisScope().flags&Le)>0},tt.allowDirectSuper.get=function(){return(this.currentThisScope().flags&kt)>0},tt.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},Ze.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&on)>0},Ze.extend=function(){for(var w=[],N=arguments.length;N--;)w[N]=arguments[N];for(var I=this,le=0;le<w.length;le++)I=w[le](I);return I},Ze.parse=function(w,N){return new this(N,w).parse()},Ze.parseExpressionAt=function(w,N,I){var le=new this(I,w,N);return le.nextToken(),le.parseExpression()},Ze.tokenizer=function(w,N){return new this(N,w)},Object.defineProperties(Ze.prototype,tt);var ut=Ze.prototype,wt=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;ut.strictDirective=function(m){for(;;){Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length;var w=wt.exec(this.input.slice(m));if(!w)return!1;if((w[1]||w[2])==="use strict"){Xe.lastIndex=m+w[0].length;var N=Xe.exec(this.input),I=N.index+N[0].length,le=this.input.charAt(I);return le===";"||le==="}"||dr.test(N[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(le)||le==="!"&&this.input.charAt(I+1)==="=")}m+=w[0].length,Xe.lastIndex=m,m+=Xe.exec(this.input)[0].length,this.input[m]===";"&&m++}},ut.eat=function(m){return this.type===m?(this.next(),!0):!1},ut.isContextual=function(m){return this.type===q.name&&this.value===m&&!this.containsEsc},ut.eatContextual=function(m){return this.isContextual(m)?(this.next(),!0):!1},ut.expectContextual=function(m){this.eatContextual(m)||this.unexpected()},ut.canInsertSemicolon=function(){return this.type===q.eof||this.type===q.braceR||dr.test(this.input.slice(this.lastTokEnd,this.start))},ut.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},ut.semicolon=function(){!this.eat(q.semi)&&!this.insertSemicolon()&&this.unexpected()},ut.afterTrailingComma=function(m,w){if(this.type===m)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),w||this.next(),!0},ut.expect=function(m){this.eat(m)||this.unexpected()},ut.unexpected=function(m){this.raise(m!=null?m:this.start,"Unexpected token")};function K(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}ut.checkPatternErrors=function(m,w){if(!!m){m.trailingComma>-1&&this.raiseRecoverable(m.trailingComma,"Comma is not permitted after the rest element");var N=w?m.parenthesizedAssign:m.parenthesizedBind;N>-1&&this.raiseRecoverable(N,"Parenthesized pattern")}},ut.checkExpressionErrors=function(m,w){if(!m)return!1;var N=m.shorthandAssign,I=m.doubleProto;if(!w)return N>=0||I>=0;N>=0&&this.raise(N,"Shorthand property assignments are valid only in destructuring patterns"),I>=0&&this.raiseRecoverable(I,"Redefinition of __proto__ property")},ut.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},ut.isSimpleAssignTarget=function(m){return m.type==="ParenthesizedExpression"?this.isSimpleAssignTarget(m.expression):m.type==="Identifier"||m.type==="MemberExpression"};var Ht=Ze.prototype;Ht.parseTopLevel=function(m){var w={};for(m.body||(m.body=[]);this.type!==q.eof;){var N=this.parseStatement(null,!0,w);m.body.push(N)}if(this.inModule)for(var I=0,le=Object.keys(this.undefinedExports);I<le.length;I+=1){var Oe=le[I];this.raiseRecoverable(this.undefinedExports[Oe].start,"Export '"+Oe+"' is not defined")}return this.adaptDirectivePrologue(m.body),this.next(),m.sourceType=this.options.sourceType,this.finishNode(m,"Program")};var Tr={kind:"loop"},Or={kind:"switch"};Ht.isLet=function(m){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;Xe.lastIndex=this.pos;var w=Xe.exec(this.input),N=this.pos+w[0].length,I=this.input.charCodeAt(N);if(I===91)return!0;if(m)return!1;if(I===123)return!0;if(Ir(I,!0)){for(var le=N+1;Qt(this.input.charCodeAt(le),!0);)++le;var Oe=this.input.slice(N,le);if(!re.test(Oe))return!0}return!1},Ht.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;Xe.lastIndex=this.pos;var m=Xe.exec(this.input),w=this.pos+m[0].length;return!dr.test(this.input.slice(this.pos,w))&&this.input.slice(w,w+8)==="function"&&(w+8===this.input.length||!Qt(this.input.charAt(w+8)))},Ht.parseStatement=function(m,w,N){var I=this.type,le=this.startNode(),Oe;switch(this.isLet(m)&&(I=q._var,Oe="let"),I){case q._break:case q._continue:return this.parseBreakContinueStatement(le,I.keyword);case q._debugger:return this.parseDebuggerStatement(le);case q._do:return this.parseDoStatement(le);case q._for:return this.parseForStatement(le);case q._function:return m&&(this.strict||m!=="if"&&m!=="label")&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(le,!1,!m);case q._class:return m&&this.unexpected(),this.parseClass(le,!0);case q._if:return this.parseIfStatement(le);case q._return:return this.parseReturnStatement(le);case q._switch:return this.parseSwitchStatement(le);case q._throw:return this.parseThrowStatement(le);case q._try:return this.parseTryStatement(le);case q._const:case q._var:return Oe=Oe||this.value,m&&Oe!=="var"&&this.unexpected(),this.parseVarStatement(le,Oe);case q._while:return this.parseWhileStatement(le);case q._with:return this.parseWithStatement(le);case q.braceL:return this.parseBlock(!0,le);case q.semi:return this.parseEmptyStatement(le);case q._export:case q._import:if(this.options.ecmaVersion>10&&I===q._import){Xe.lastIndex=this.pos;var ct=Xe.exec(this.input),Ft=this.pos+ct[0].length,Ut=this.input.charCodeAt(Ft);if(Ut===40||Ut===46)return this.parseExpressionStatement(le,this.parseExpression())}return this.options.allowImportExportEverywhere||(w||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),I===q._import?this.parseImport(le):this.parseExport(le,N);default:if(this.isAsyncFunction())return m&&this.unexpected(),this.next(),this.parseFunctionStatement(le,!0,!m);var Fr=this.value,Kr=this.parseExpression();return I===q.name&&Kr.type==="Identifier"&&this.eat(q.colon)?this.parseLabeledStatement(le,Fr,Kr,m):this.parseExpressionStatement(le,Kr)}},Ht.parseBreakContinueStatement=function(m,w){var N=w==="break";this.next(),this.eat(q.semi)||this.insertSemicolon()?m.label=null:this.type!==q.name?this.unexpected():(m.label=this.parseIdent(),this.semicolon());for(var I=0;I<this.labels.length;++I){var le=this.labels[I];if((m.label==null||le.name===m.label.name)&&(le.kind!=null&&(N||le.kind==="loop")||m.label&&N))break}return I===this.labels.length&&this.raise(m.start,"Unsyntactic "+w),this.finishNode(m,N?"BreakStatement":"ContinueStatement")},Ht.parseDebuggerStatement=function(m){return this.next(),this.semicolon(),this.finishNode(m,"DebuggerStatement")},Ht.parseDoStatement=function(m){return this.next(),this.labels.push(Tr),m.body=this.parseStatement("do"),this.labels.pop(),this.expect(q._while),m.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(q.semi):this.semicolon(),this.finishNode(m,"DoWhileStatement")},Ht.parseForStatement=function(m){this.next();var w=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(Tr),this.enterScope(0),this.expect(q.parenL),this.type===q.semi)return w>-1&&this.unexpected(w),this.parseFor(m,null);var N=this.isLet();if(this.type===q._var||this.type===q._const||N){var I=this.startNode(),le=N?"let":this.value;return this.next(),this.parseVar(I,!0,le),this.finishNode(I,"VariableDeclaration"),(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&I.declarations.length===1?(this.options.ecmaVersion>=9&&(this.type===q._in?w>-1&&this.unexpected(w):m.await=w>-1),this.parseForIn(m,I)):(w>-1&&this.unexpected(w),this.parseFor(m,I))}var Oe=new K,ct=this.parseExpression(!0,Oe);return this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===q._in?w>-1&&this.unexpected(w):m.await=w>-1),this.toAssignable(ct,!1,Oe),this.checkLVal(ct),this.parseForIn(m,ct)):(this.checkExpressionErrors(Oe,!0),w>-1&&this.unexpected(w),this.parseFor(m,ct))},Ht.parseFunctionStatement=function(m,w,N){return this.next(),this.parseFunction(m,lt|(N?0:At),!1,w)},Ht.parseIfStatement=function(m){return this.next(),m.test=this.parseParenExpression(),m.consequent=this.parseStatement("if"),m.alternate=this.eat(q._else)?this.parseStatement("if"):null,this.finishNode(m,"IfStatement")},Ht.parseReturnStatement=function(m){return!this.inFunction&&!this.options.allowReturnOutsideFunction&&this.raise(this.start,"'return' outside of function"),this.next(),this.eat(q.semi)||this.insertSemicolon()?m.argument=null:(m.argument=this.parseExpression(),this.semicolon()),this.finishNode(m,"ReturnStatement")},Ht.parseSwitchStatement=function(m){this.next(),m.discriminant=this.parseParenExpression(),m.cases=[],this.expect(q.braceL),this.labels.push(Or),this.enterScope(0);for(var w,N=!1;this.type!==q.braceR;)if(this.type===q._case||this.type===q._default){var I=this.type===q._case;w&&this.finishNode(w,"SwitchCase"),m.cases.push(w=this.startNode()),w.consequent=[],this.next(),I?w.test=this.parseExpression():(N&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),N=!0,w.test=null),this.expect(q.colon)}else w||this.unexpected(),w.consequent.push(this.parseStatement(null));return this.exitScope(),w&&this.finishNode(w,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(m,"SwitchStatement")},Ht.parseThrowStatement=function(m){return this.next(),dr.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),m.argument=this.parseExpression(),this.semicolon(),this.finishNode(m,"ThrowStatement")};var Ye=[];Ht.parseTryStatement=function(m){if(this.next(),m.block=this.parseBlock(),m.handler=null,this.type===q._catch){var w=this.startNode();if(this.next(),this.eat(q.parenL)){w.param=this.parseBindingAtom();var N=w.param.type==="Identifier";this.enterScope(N?Ue:0),this.checkLVal(w.param,N?E:fr),this.expect(q.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),w.param=null,this.enterScope(0);w.body=this.parseBlock(!1),this.exitScope(),m.handler=this.finishNode(w,"CatchClause")}return m.finalizer=this.eat(q._finally)?this.parseBlock():null,!m.handler&&!m.finalizer&&this.raise(m.start,"Missing catch or finally clause"),this.finishNode(m,"TryStatement")},Ht.parseVarStatement=function(m,w){return this.next(),this.parseVar(m,!1,w),this.semicolon(),this.finishNode(m,"VariableDeclaration")},Ht.parseWhileStatement=function(m){return this.next(),m.test=this.parseParenExpression(),this.labels.push(Tr),m.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(m,"WhileStatement")},Ht.parseWithStatement=function(m){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),m.object=this.parseParenExpression(),m.body=this.parseStatement("with"),this.finishNode(m,"WithStatement")},Ht.parseEmptyStatement=function(m){return this.next(),this.finishNode(m,"EmptyStatement")},Ht.parseLabeledStatement=function(m,w,N,I){for(var le=0,Oe=this.labels;le<Oe.length;le+=1){var ct=Oe[le];ct.name===w&&this.raise(N.start,"Label '"+w+"' is already declared")}for(var Ft=this.type.isLoop?"loop":this.type===q._switch?"switch":null,Ut=this.labels.length-1;Ut>=0;Ut--){var Fr=this.labels[Ut];if(Fr.statementStart===m.start)Fr.statementStart=this.start,Fr.kind=Ft;else break}return this.labels.push({name:w,kind:Ft,statementStart:this.start}),m.body=this.parseStatement(I?I.indexOf("label")===-1?I+"label":I:"label"),this.labels.pop(),m.label=N,this.finishNode(m,"LabeledStatement")},Ht.parseExpressionStatement=function(m,w){return m.expression=w,this.semicolon(),this.finishNode(m,"ExpressionStatement")},Ht.parseBlock=function(m,w,N){for(m===void 0&&(m=!0),w===void 0&&(w=this.startNode()),w.body=[],this.expect(q.braceL),m&&this.enterScope(0);this.type!==q.braceR;){var I=this.parseStatement(null);w.body.push(I)}return N&&(this.strict=!1),this.next(),m&&this.exitScope(),this.finishNode(w,"BlockStatement")},Ht.parseFor=function(m,w){return m.init=w,this.expect(q.semi),m.test=this.type===q.semi?null:this.parseExpression(),this.expect(q.semi),m.update=this.type===q.parenR?null:this.parseExpression(),this.expect(q.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,"ForStatement")},Ht.parseForIn=function(m,w){var N=this.type===q._in;return this.next(),w.type==="VariableDeclaration"&&w.declarations[0].init!=null&&(!N||this.options.ecmaVersion<8||this.strict||w.kind!=="var"||w.declarations[0].id.type!=="Identifier")?this.raise(w.start,(N?"for-in":"for-of")+" loop variable declaration may not have an initializer"):w.type==="AssignmentPattern"&&this.raise(w.start,"Invalid left-hand side in for-loop"),m.left=w,m.right=N?this.parseExpression():this.parseMaybeAssign(),this.expect(q.parenR),m.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(m,N?"ForInStatement":"ForOfStatement")},Ht.parseVar=function(m,w,N){for(m.declarations=[],m.kind=N;;){var I=this.startNode();if(this.parseVarId(I,N),this.eat(q.eq)?I.init=this.parseMaybeAssign(w):N==="const"&&!(this.type===q._in||this.options.ecmaVersion>=6&&this.isContextual("of"))?this.unexpected():I.id.type!=="Identifier"&&!(w&&(this.type===q._in||this.isContextual("of")))?this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):I.init=null,m.declarations.push(this.finishNode(I,"VariableDeclarator")),!this.eat(q.comma))break}return m},Ht.parseVarId=function(m,w){m.id=this.parseBindingAtom(),this.checkLVal(m.id,w==="var"?Lr:fr,!1)};var lt=1,At=2,zt=4;Ht.parseFunction=function(m,w,N,I){this.initFunction(m),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!I)&&(this.type===q.star&&w&At&&this.unexpected(),m.generator=this.eat(q.star)),this.options.ecmaVersion>=8&&(m.async=!!I),w&lt&&(m.id=w&zt&&this.type!==q.name?null:this.parseIdent(),m.id&&!(w&At)&&this.checkLVal(m.id,this.strict||m.generator||m.async?this.treatFunctionsAsVar?Lr:fr:H));var le=this.yieldPos,Oe=this.awaitPos,ct=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(nr(m.async,m.generator)),w&lt||(m.id=this.type===q.name?this.parseIdent():null),this.parseFunctionParams(m),this.parseFunctionBody(m,N,!1),this.yieldPos=le,this.awaitPos=Oe,this.awaitIdentPos=ct,this.finishNode(m,w&lt?"FunctionDeclaration":"FunctionExpression")},Ht.parseFunctionParams=function(m){this.expect(q.parenL),m.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},Ht.parseClass=function(m,w){this.next();var N=this.strict;this.strict=!0,this.parseClassId(m,w),this.parseClassSuper(m);var I=this.startNode(),le=!1;for(I.body=[],this.expect(q.braceL);this.type!==q.braceR;){var Oe=this.parseClassElement(m.superClass!==null);Oe&&(I.body.push(Oe),Oe.type==="MethodDefinition"&&Oe.kind==="constructor"&&(le&&this.raise(Oe.start,"Duplicate constructor in the same class"),le=!0))}return this.strict=N,this.next(),m.body=this.finishNode(I,"ClassBody"),this.finishNode(m,w?"ClassDeclaration":"ClassExpression")},Ht.parseClassElement=function(m){var w=this;if(this.eat(q.semi))return null;var N=this.startNode(),I=function(Ut,Fr){Fr===void 0&&(Fr=!1);var Kr=w.start,ni=w.startLoc;return w.eatContextual(Ut)?w.type!==q.parenL&&(!Fr||!w.canInsertSemicolon())?!0:(N.key&&w.unexpected(),N.computed=!1,N.key=w.startNodeAt(Kr,ni),N.key.name=Ut,w.finishNode(N.key,"Identifier"),!1):!1};N.kind="method",N.static=I("static");var le=this.eat(q.star),Oe=!1;le||(this.options.ecmaVersion>=8&&I("async",!0)?(Oe=!0,le=this.options.ecmaVersion>=9&&this.eat(q.star)):I("get")?N.kind="get":I("set")&&(N.kind="set")),N.key||this.parsePropertyName(N);var ct=N.key,Ft=!1;return!N.computed&&!N.static&&(ct.type==="Identifier"&&ct.name==="constructor"||ct.type==="Literal"&&ct.value==="constructor")?(N.kind!=="method"&&this.raise(ct.start,"Constructor can't have get/set modifier"),le&&this.raise(ct.start,"Constructor can't be a generator"),Oe&&this.raise(ct.start,"Constructor can't be an async method"),N.kind="constructor",Ft=m):N.static&&ct.type==="Identifier"&&ct.name==="prototype"&&this.raise(ct.start,"Classes may not have a static property named prototype"),this.parseClassMethod(N,le,Oe,Ft),N.kind==="get"&&N.value.params.length!==0&&this.raiseRecoverable(N.value.start,"getter should have no params"),N.kind==="set"&&N.value.params.length!==1&&this.raiseRecoverable(N.value.start,"setter should have exactly one param"),N.kind==="set"&&N.value.params[0].type==="RestElement"&&this.raiseRecoverable(N.value.params[0].start,"Setter cannot use rest params"),N},Ht.parseClassMethod=function(m,w,N,I){return m.value=this.parseMethod(w,N,I),this.finishNode(m,"MethodDefinition")},Ht.parseClassId=function(m,w){this.type===q.name?(m.id=this.parseIdent(),w&&this.checkLVal(m.id,fr,!1)):(w===!0&&this.unexpected(),m.id=null)},Ht.parseClassSuper=function(m){m.superClass=this.eat(q._extends)?this.parseExprSubscripts():null},Ht.parseExport=function(m,w){if(this.next(),this.eat(q.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(m.exported=this.parseIdent(!0),this.checkExport(w,m.exported.name,this.lastTokStart)):m.exported=null),this.expectContextual("from"),this.type!==q.string&&this.unexpected(),m.source=this.parseExprAtom(),this.semicolon(),this.finishNode(m,"ExportAllDeclaration");if(this.eat(q._default)){this.checkExport(w,"default",this.lastTokStart);var N;if(this.type===q._function||(N=this.isAsyncFunction())){var I=this.startNode();this.next(),N&&this.next(),m.declaration=this.parseFunction(I,lt|zt,!1,N)}else if(this.type===q._class){var le=this.startNode();m.declaration=this.parseClass(le,"nullableID")}else m.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(m,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())m.declaration=this.parseStatement(null),m.declaration.type==="VariableDeclaration"?this.checkVariableExport(w,m.declaration.declarations):this.checkExport(w,m.declaration.id.name,m.declaration.id.start),m.specifiers=[],m.source=null;else{if(m.declaration=null,m.specifiers=this.parseExportSpecifiers(w),this.eatContextual("from"))this.type!==q.string&&this.unexpected(),m.source=this.parseExprAtom();else{for(var Oe=0,ct=m.specifiers;Oe<ct.length;Oe+=1){var Ft=ct[Oe];this.checkUnreserved(Ft.local),this.checkLocalExport(Ft.local)}m.source=null}this.semicolon()}return this.finishNode(m,"ExportNamedDeclaration")},Ht.checkExport=function(m,w,N){!m||(Xr(m,w)&&this.raiseRecoverable(N,"Duplicate export '"+w+"'"),m[w]=!0)},Ht.checkPatternExport=function(m,w){var N=w.type;if(N==="Identifier")this.checkExport(m,w.name,w.start);else if(N==="ObjectPattern")for(var I=0,le=w.properties;I<le.length;I+=1){var Oe=le[I];this.checkPatternExport(m,Oe)}else if(N==="ArrayPattern")for(var ct=0,Ft=w.elements;ct<Ft.length;ct+=1){var Ut=Ft[ct];Ut&&this.checkPatternExport(m,Ut)}else N==="Property"?this.checkPatternExport(m,w.value):N==="AssignmentPattern"?this.checkPatternExport(m,w.left):N==="RestElement"?this.checkPatternExport(m,w.argument):N==="ParenthesizedExpression"&&this.checkPatternExport(m,w.expression)},Ht.checkVariableExport=function(m,w){if(!!m)for(var N=0,I=w;N<I.length;N+=1){var le=I[N];this.checkPatternExport(m,le.id)}},Ht.shouldParseExportStatement=function(){return this.type.keyword==="var"||this.type.keyword==="const"||this.type.keyword==="class"||this.type.keyword==="function"||this.isLet()||this.isAsyncFunction()},Ht.parseExportSpecifiers=function(m){var w=[],N=!0;for(this.expect(q.braceL);!this.eat(q.braceR);){if(N)N=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var I=this.startNode();I.local=this.parseIdent(!0),I.exported=this.eatContextual("as")?this.parseIdent(!0):I.local,this.checkExport(m,I.exported.name,I.exported.start),w.push(this.finishNode(I,"ExportSpecifier"))}return w},Ht.parseImport=function(m){return this.next(),this.type===q.string?(m.specifiers=Ye,m.source=this.parseExprAtom()):(m.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),m.source=this.type===q.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(m,"ImportDeclaration")},Ht.parseImportSpecifiers=function(){var m=[],w=!0;if(this.type===q.name){var N=this.startNode();if(N.local=this.parseIdent(),this.checkLVal(N.local,fr),m.push(this.finishNode(N,"ImportDefaultSpecifier")),!this.eat(q.comma))return m}if(this.type===q.star){var I=this.startNode();return this.next(),this.expectContextual("as"),I.local=this.parseIdent(),this.checkLVal(I.local,fr),m.push(this.finishNode(I,"ImportNamespaceSpecifier")),m}for(this.expect(q.braceL);!this.eat(q.braceR);){if(w)w=!1;else if(this.expect(q.comma),this.afterTrailingComma(q.braceR))break;var le=this.startNode();le.imported=this.parseIdent(!0),this.eatContextual("as")?le.local=this.parseIdent():(this.checkUnreserved(le.imported),le.local=le.imported),this.checkLVal(le.local,fr),m.push(this.finishNode(le,"ImportSpecifier"))}return m},Ht.adaptDirectivePrologue=function(m){for(var w=0;w<m.length&&this.isDirectiveCandidate(m[w]);++w)m[w].directive=m[w].expression.raw.slice(1,-1)},Ht.isDirectiveCandidate=function(m){return m.type==="ExpressionStatement"&&m.expression.type==="Literal"&&typeof m.expression.value=="string"&&(this.input[m.start]==='"'||this.input[m.start]==="'")};var wr=Ze.prototype;wr.toAssignable=function(m,w,N){if(this.options.ecmaVersion>=6&&m)switch(m.type){case"Identifier":this.inAsync&&m.name==="await"&&this.raise(m.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":m.type="ObjectPattern",N&&this.checkPatternErrors(N,!0);for(var I=0,le=m.properties;I<le.length;I+=1){var Oe=le[I];this.toAssignable(Oe,w),Oe.type==="RestElement"&&(Oe.argument.type==="ArrayPattern"||Oe.argument.type==="ObjectPattern")&&this.raise(Oe.argument.start,"Unexpected token")}break;case"Property":m.kind!=="init"&&this.raise(m.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(m.value,w);break;case"ArrayExpression":m.type="ArrayPattern",N&&this.checkPatternErrors(N,!0),this.toAssignableList(m.elements,w);break;case"SpreadElement":m.type="RestElement",this.toAssignable(m.argument,w),m.argument.type==="AssignmentPattern"&&this.raise(m.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":m.operator!=="="&&this.raise(m.left.end,"Only '=' operator can be used for specifying default value."),m.type="AssignmentPattern",delete m.operator,this.toAssignable(m.left,w);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(m.expression,w,N);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!w)break;default:this.raise(m.start,"Assigning to rvalue")}else N&&this.checkPatternErrors(N,!0);return m},wr.toAssignableList=function(m,w){for(var N=m.length,I=0;I<N;I++){var le=m[I];le&&this.toAssignable(le,w)}if(N){var Oe=m[N-1];this.options.ecmaVersion===6&&w&&Oe&&Oe.type==="RestElement"&&Oe.argument.type!=="Identifier"&&this.unexpected(Oe.argument.start)}return m},wr.parseSpread=function(m){var w=this.startNode();return this.next(),w.argument=this.parseMaybeAssign(!1,m),this.finishNode(w,"SpreadElement")},wr.parseRestBinding=function(){var m=this.startNode();return this.next(),this.options.ecmaVersion===6&&this.type!==q.name&&this.unexpected(),m.argument=this.parseBindingAtom(),this.finishNode(m,"RestElement")},wr.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case q.bracketL:var m=this.startNode();return this.next(),m.elements=this.parseBindingList(q.bracketR,!0,!0),this.finishNode(m,"ArrayPattern");case q.braceL:return this.parseObj(!0)}return this.parseIdent()},wr.parseBindingList=function(m,w,N){for(var I=[],le=!0;!this.eat(m);)if(le?le=!1:this.expect(q.comma),w&&this.type===q.comma)I.push(null);else{if(N&&this.afterTrailingComma(m))break;if(this.type===q.ellipsis){var Oe=this.parseRestBinding();this.parseBindingListItem(Oe),I.push(Oe),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(m);break}else{var ct=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(ct),I.push(ct)}}return I},wr.parseBindingListItem=function(m){return m},wr.parseMaybeDefault=function(m,w,N){if(N=N||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(q.eq))return N;var I=this.startNodeAt(m,w);return I.left=N,I.right=this.parseMaybeAssign(),this.finishNode(I,"AssignmentPattern")},wr.checkLVal=function(m,w,N){switch(w===void 0&&(w=_r),m.type){case"Identifier":w===fr&&m.name==="let"&&this.raiseRecoverable(m.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(m.name)&&this.raiseRecoverable(m.start,(w?"Binding ":"Assigning to ")+m.name+" in strict mode"),N&&(Xr(N,m.name)&&this.raiseRecoverable(m.start,"Argument name clash"),N[m.name]=!0),w!==_r&&w!==V&&this.declareName(m.name,w,m.start);break;case"ChainExpression":this.raiseRecoverable(m.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":w&&this.raiseRecoverable(m.start,"Binding member expression");break;case"ObjectPattern":for(var I=0,le=m.properties;I<le.length;I+=1){var Oe=le[I];this.checkLVal(Oe,w,N)}break;case"Property":this.checkLVal(m.value,w,N);break;case"ArrayPattern":for(var ct=0,Ft=m.elements;ct<Ft.length;ct+=1){var Ut=Ft[ct];Ut&&this.checkLVal(Ut,w,N)}break;case"AssignmentPattern":this.checkLVal(m.left,w,N);break;case"RestElement":this.checkLVal(m.argument,w,N);break;case"ParenthesizedExpression":this.checkLVal(m.expression,w,N);break;default:this.raise(m.start,(w?"Binding":"Assigning to")+" rvalue")}};var Pr=Ze.prototype;Pr.checkPropClash=function(m,w,N){if(!(this.options.ecmaVersion>=9&&m.type==="SpreadElement")&&!(this.options.ecmaVersion>=6&&(m.computed||m.method||m.shorthand))){var I=m.key,le;switch(I.type){case"Identifier":le=I.name;break;case"Literal":le=String(I.value);break;default:return}var Oe=m.kind;if(this.options.ecmaVersion>=6){le==="__proto__"&&Oe==="init"&&(w.proto&&(N?N.doubleProto<0&&(N.doubleProto=I.start):this.raiseRecoverable(I.start,"Redefinition of __proto__ property")),w.proto=!0);return}le="$"+le;var ct=w[le];if(ct){var Ft;Oe==="init"?Ft=this.strict&&ct.init||ct.get||ct.set:Ft=ct.init||ct[Oe],Ft&&this.raiseRecoverable(I.start,"Redefinition of property")}else ct=w[le]={init:!1,get:!1,set:!1};ct[Oe]=!0}},Pr.parseExpression=function(m,w){var N=this.start,I=this.startLoc,le=this.parseMaybeAssign(m,w);if(this.type===q.comma){var Oe=this.startNodeAt(N,I);for(Oe.expressions=[le];this.eat(q.comma);)Oe.expressions.push(this.parseMaybeAssign(m,w));return this.finishNode(Oe,"SequenceExpression")}return le},Pr.parseMaybeAssign=function(m,w,N){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(m);this.exprAllowed=!1}var I=!1,le=-1,Oe=-1;w?(le=w.parenthesizedAssign,Oe=w.trailingComma,w.parenthesizedAssign=w.trailingComma=-1):(w=new K,I=!0);var ct=this.start,Ft=this.startLoc;(this.type===q.parenL||this.type===q.name)&&(this.potentialArrowAt=this.start);var Ut=this.parseMaybeConditional(m,w);if(N&&(Ut=N.call(this,Ut,ct,Ft)),this.type.isAssign){var Fr=this.startNodeAt(ct,Ft);return Fr.operator=this.value,Fr.left=this.type===q.eq?this.toAssignable(Ut,!1,w):Ut,I||(w.parenthesizedAssign=w.trailingComma=w.doubleProto=-1),w.shorthandAssign>=Fr.left.start&&(w.shorthandAssign=-1),this.checkLVal(Ut),this.next(),Fr.right=this.parseMaybeAssign(m),this.finishNode(Fr,"AssignmentExpression")}else I&&this.checkExpressionErrors(w,!0);return le>-1&&(w.parenthesizedAssign=le),Oe>-1&&(w.trailingComma=Oe),Ut},Pr.parseMaybeConditional=function(m,w){var N=this.start,I=this.startLoc,le=this.parseExprOps(m,w);if(this.checkExpressionErrors(w))return le;if(this.eat(q.question)){var Oe=this.startNodeAt(N,I);return Oe.test=le,Oe.consequent=this.parseMaybeAssign(),this.expect(q.colon),Oe.alternate=this.parseMaybeAssign(m),this.finishNode(Oe,"ConditionalExpression")}return le},Pr.parseExprOps=function(m,w){var N=this.start,I=this.startLoc,le=this.parseMaybeUnary(w,!1);return this.checkExpressionErrors(w)||le.start===N&&le.type==="ArrowFunctionExpression"?le:this.parseExprOp(le,N,I,-1,m)},Pr.parseExprOp=function(m,w,N,I,le){var Oe=this.type.binop;if(Oe!=null&&(!le||this.type!==q._in)&&Oe>I){var ct=this.type===q.logicalOR||this.type===q.logicalAND,Ft=this.type===q.coalesce;Ft&&(Oe=q.logicalAND.binop);var Ut=this.value;this.next();var Fr=this.start,Kr=this.startLoc,ni=this.parseExprOp(this.parseMaybeUnary(null,!1),Fr,Kr,Oe,le),Ii=this.buildBinary(w,N,m,ni,Ut,ct||Ft);return(ct&&this.type===q.coalesce||Ft&&(this.type===q.logicalOR||this.type===q.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(Ii,w,N,I,le)}return m},Pr.buildBinary=function(m,w,N,I,le,Oe){var ct=this.startNodeAt(m,w);return ct.left=N,ct.operator=le,ct.right=I,this.finishNode(ct,Oe?"LogicalExpression":"BinaryExpression")},Pr.parseMaybeUnary=function(m,w){var N=this.start,I=this.startLoc,le;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))le=this.parseAwait(),w=!0;else if(this.type.prefix){var Oe=this.startNode(),ct=this.type===q.incDec;Oe.operator=this.value,Oe.prefix=!0,this.next(),Oe.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(m,!0),ct?this.checkLVal(Oe.argument):this.strict&&Oe.operator==="delete"&&Oe.argument.type==="Identifier"?this.raiseRecoverable(Oe.start,"Deleting local variable in strict mode"):w=!0,le=this.finishNode(Oe,ct?"UpdateExpression":"UnaryExpression")}else{if(le=this.parseExprSubscripts(m),this.checkExpressionErrors(m))return le;for(;this.type.postfix&&!this.canInsertSemicolon();){var Ft=this.startNodeAt(N,I);Ft.operator=this.value,Ft.prefix=!1,Ft.argument=le,this.checkLVal(le),this.next(),le=this.finishNode(Ft,"UpdateExpression")}}return!w&&this.eat(q.starstar)?this.buildBinary(N,I,le,this.parseMaybeUnary(null,!1),"**",!1):le},Pr.parseExprSubscripts=function(m){var w=this.start,N=this.startLoc,I=this.parseExprAtom(m);if(I.type==="ArrowFunctionExpression"&&this.input.slice(this.lastTokStart,this.lastTokEnd)!==")")return I;var le=this.parseSubscripts(I,w,N);return m&&le.type==="MemberExpression"&&(m.parenthesizedAssign>=le.start&&(m.parenthesizedAssign=-1),m.parenthesizedBind>=le.start&&(m.parenthesizedBind=-1)),le},Pr.parseSubscripts=function(m,w,N,I){for(var le=this.options.ecmaVersion>=8&&m.type==="Identifier"&&m.name==="async"&&this.lastTokEnd===m.end&&!this.canInsertSemicolon()&&m.end-m.start==5&&this.potentialArrowAt===m.start,Oe=!1;;){var ct=this.parseSubscript(m,w,N,I,le,Oe);if(ct.optional&&(Oe=!0),ct===m||ct.type==="ArrowFunctionExpression"){if(Oe){var Ft=this.startNodeAt(w,N);Ft.expression=ct,ct=this.finishNode(Ft,"ChainExpression")}return ct}m=ct}},Pr.parseSubscript=function(m,w,N,I,le,Oe){var ct=this.options.ecmaVersion>=11,Ft=ct&&this.eat(q.questionDot);I&&Ft&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var Ut=this.eat(q.bracketL);if(Ut||Ft&&this.type!==q.parenL&&this.type!==q.backQuote||this.eat(q.dot)){var Fr=this.startNodeAt(w,N);Fr.object=m,Fr.property=Ut?this.parseExpression():this.parseIdent(this.options.allowReserved!=="never"),Fr.computed=!!Ut,Ut&&this.expect(q.bracketR),ct&&(Fr.optional=Ft),m=this.finishNode(Fr,"MemberExpression")}else if(!I&&this.eat(q.parenL)){var Kr=new K,ni=this.yieldPos,Ii=this.awaitPos,bi=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var pa=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1,Kr);if(le&&!Ft&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(Kr,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=ni,this.awaitPos=Ii,this.awaitIdentPos=bi,this.parseArrowExpression(this.startNodeAt(w,N),pa,!0);this.checkExpressionErrors(Kr,!0),this.yieldPos=ni||this.yieldPos,this.awaitPos=Ii||this.awaitPos,this.awaitIdentPos=bi||this.awaitIdentPos;var Pa=this.startNodeAt(w,N);Pa.callee=m,Pa.arguments=pa,ct&&(Pa.optional=Ft),m=this.finishNode(Pa,"CallExpression")}else if(this.type===q.backQuote){(Ft||Oe)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var za=this.startNodeAt(w,N);za.tag=m,za.quasi=this.parseTemplate({isTagged:!0}),m=this.finishNode(za,"TaggedTemplateExpression")}return m},Pr.parseExprAtom=function(m){this.type===q.slash&&this.readRegexp();var w,N=this.potentialArrowAt===this.start;switch(this.type){case q._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),w=this.startNode(),this.next(),this.type===q.parenL&&!this.allowDirectSuper&&this.raise(w.start,"super() call outside constructor of a subclass"),this.type!==q.dot&&this.type!==q.bracketL&&this.type!==q.parenL&&this.unexpected(),this.finishNode(w,"Super");case q._this:return w=this.startNode(),this.next(),this.finishNode(w,"ThisExpression");case q.name:var I=this.start,le=this.startLoc,Oe=this.containsEsc,ct=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!Oe&&ct.name==="async"&&!this.canInsertSemicolon()&&this.eat(q._function))return this.parseFunction(this.startNodeAt(I,le),0,!1,!0);if(N&&!this.canInsertSemicolon()){if(this.eat(q.arrow))return this.parseArrowExpression(this.startNodeAt(I,le),[ct],!1);if(this.options.ecmaVersion>=8&&ct.name==="async"&&this.type===q.name&&!Oe)return ct=this.parseIdent(!1),(this.canInsertSemicolon()||!this.eat(q.arrow))&&this.unexpected(),this.parseArrowExpression(this.startNodeAt(I,le),[ct],!0)}return ct;case q.regexp:var Ft=this.value;return w=this.parseLiteral(Ft.value),w.regex={pattern:Ft.pattern,flags:Ft.flags},w;case q.num:case q.string:return this.parseLiteral(this.value);case q._null:case q._true:case q._false:return w=this.startNode(),w.value=this.type===q._null?null:this.type===q._true,w.raw=this.type.keyword,this.next(),this.finishNode(w,"Literal");case q.parenL:var Ut=this.start,Fr=this.parseParenAndDistinguishExpression(N);return m&&(m.parenthesizedAssign<0&&!this.isSimpleAssignTarget(Fr)&&(m.parenthesizedAssign=Ut),m.parenthesizedBind<0&&(m.parenthesizedBind=Ut)),Fr;case q.bracketL:return w=this.startNode(),this.next(),w.elements=this.parseExprList(q.bracketR,!0,!0,m),this.finishNode(w,"ArrayExpression");case q.braceL:return this.parseObj(!1,m);case q._function:return w=this.startNode(),this.next(),this.parseFunction(w,0);case q._class:return this.parseClass(this.startNode(),!1);case q._new:return this.parseNew();case q.backQuote:return this.parseTemplate();case q._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},Pr.parseExprImport=function(){var m=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var w=this.parseIdent(!0);switch(this.type){case q.parenL:return this.parseDynamicImport(m);case q.dot:return m.meta=w,this.parseImportMeta(m);default:this.unexpected()}},Pr.parseDynamicImport=function(m){if(this.next(),m.source=this.parseMaybeAssign(),!this.eat(q.parenR)){var w=this.start;this.eat(q.comma)&&this.eat(q.parenR)?this.raiseRecoverable(w,"Trailing comma is not allowed in import()"):this.unexpected(w)}return this.finishNode(m,"ImportExpression")},Pr.parseImportMeta=function(m){this.next();var w=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="meta"&&this.raiseRecoverable(m.property.start,"The only valid meta property for import is 'import.meta'"),w&&this.raiseRecoverable(m.start,"'import.meta' must not contain escaped characters"),this.options.sourceType!=="module"&&this.raiseRecoverable(m.start,"Cannot use 'import.meta' outside a module"),this.finishNode(m,"MetaProperty")},Pr.parseLiteral=function(m){var w=this.startNode();return w.value=m,w.raw=this.input.slice(this.start,this.end),w.raw.charCodeAt(w.raw.length-1)===110&&(w.bigint=w.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(w,"Literal")},Pr.parseParenExpression=function(){this.expect(q.parenL);var m=this.parseExpression();return this.expect(q.parenR),m},Pr.parseParenAndDistinguishExpression=function(m){var w=this.start,N=this.startLoc,I,le=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var Oe=this.start,ct=this.startLoc,Ft=[],Ut=!0,Fr=!1,Kr=new K,ni=this.yieldPos,Ii=this.awaitPos,bi;for(this.yieldPos=0,this.awaitPos=0;this.type!==q.parenR;)if(Ut?Ut=!1:this.expect(q.comma),le&&this.afterTrailingComma(q.parenR,!0)){Fr=!0;break}else if(this.type===q.ellipsis){bi=this.start,Ft.push(this.parseParenItem(this.parseRestBinding())),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}else Ft.push(this.parseMaybeAssign(!1,Kr,this.parseParenItem));var pa=this.start,Pa=this.startLoc;if(this.expect(q.parenR),m&&!this.canInsertSemicolon()&&this.eat(q.arrow))return this.checkPatternErrors(Kr,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=ni,this.awaitPos=Ii,this.parseParenArrowList(w,N,Ft);(!Ft.length||Fr)&&this.unexpected(this.lastTokStart),bi&&this.unexpected(bi),this.checkExpressionErrors(Kr,!0),this.yieldPos=ni||this.yieldPos,this.awaitPos=Ii||this.awaitPos,Ft.length>1?(I=this.startNodeAt(Oe,ct),I.expressions=Ft,this.finishNodeAt(I,"SequenceExpression",pa,Pa)):I=Ft[0]}else I=this.parseParenExpression();if(this.options.preserveParens){var za=this.startNodeAt(w,N);return za.expression=I,this.finishNode(za,"ParenthesizedExpression")}else return I},Pr.parseParenItem=function(m){return m},Pr.parseParenArrowList=function(m,w,N){return this.parseArrowExpression(this.startNodeAt(m,w),N)};var er=[];Pr.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var m=this.startNode(),w=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(q.dot)){m.meta=w;var N=this.containsEsc;return m.property=this.parseIdent(!0),m.property.name!=="target"&&this.raiseRecoverable(m.property.start,"The only valid meta property for new is 'new.target'"),N&&this.raiseRecoverable(m.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(m.start,"'new.target' can only be used in functions"),this.finishNode(m,"MetaProperty")}var I=this.start,le=this.startLoc,Oe=this.type===q._import;return m.callee=this.parseSubscripts(this.parseExprAtom(),I,le,!0),Oe&&m.callee.type==="ImportExpression"&&this.raise(I,"Cannot use new with import()"),this.eat(q.parenL)?m.arguments=this.parseExprList(q.parenR,this.options.ecmaVersion>=8,!1):m.arguments=er,this.finishNode(m,"NewExpression")},Pr.parseTemplateElement=function(m){var w=m.isTagged,N=this.startNode();return this.type===q.invalidTemplate?(w||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),N.value={raw:this.value,cooked:null}):N.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,`
`),cooked:this.value},this.next(),N.tail=this.type===q.backQuote,this.finishNode(N,"TemplateElement")},Pr.parseTemplate=function(m){m===void 0&&(m={});var w=m.isTagged;w===void 0&&(w=!1);var N=this.startNode();this.next(),N.expressions=[];var I=this.parseTemplateElement({isTagged:w});for(N.quasis=[I];!I.tail;)this.type===q.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(q.dollarBraceL),N.expressions.push(this.parseExpression()),this.expect(q.braceR),N.quasis.push(I=this.parseTemplateElement({isTagged:w}));return this.next(),this.finishNode(N,"TemplateLiteral")},Pr.isAsyncProp=function(m){return!m.computed&&m.key.type==="Identifier"&&m.key.name==="async"&&(this.type===q.name||this.type===q.num||this.type===q.string||this.type===q.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===q.star)&&!dr.test(this.input.slice(this.lastTokEnd,this.start))},Pr.parseObj=function(m,w){var N=this.startNode(),I=!0,le={};for(N.properties=[],this.next();!this.eat(q.braceR);){if(I)I=!1;else if(this.expect(q.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(q.braceR))break;var Oe=this.parseProperty(m,w);m||this.checkPropClash(Oe,le,w),N.properties.push(Oe)}return this.finishNode(N,m?"ObjectPattern":"ObjectExpression")},Pr.parseProperty=function(m,w){var N=this.startNode(),I,le,Oe,ct;if(this.options.ecmaVersion>=9&&this.eat(q.ellipsis))return m?(N.argument=this.parseIdent(!1),this.type===q.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(N,"RestElement")):(this.type===q.parenL&&w&&(w.parenthesizedAssign<0&&(w.parenthesizedAssign=this.start),w.parenthesizedBind<0&&(w.parenthesizedBind=this.start)),N.argument=this.parseMaybeAssign(!1,w),this.type===q.comma&&w&&w.trailingComma<0&&(w.trailingComma=this.start),this.finishNode(N,"SpreadElement"));this.options.ecmaVersion>=6&&(N.method=!1,N.shorthand=!1,(m||w)&&(Oe=this.start,ct=this.startLoc),m||(I=this.eat(q.star)));var Ft=this.containsEsc;return this.parsePropertyName(N),!m&&!Ft&&this.options.ecmaVersion>=8&&!I&&this.isAsyncProp(N)?(le=!0,I=this.options.ecmaVersion>=9&&this.eat(q.star),this.parsePropertyName(N,w)):le=!1,this.parsePropertyValue(N,m,I,le,Oe,ct,w,Ft),this.finishNode(N,"Property")},Pr.parsePropertyValue=function(m,w,N,I,le,Oe,ct,Ft){if((N||I)&&this.type===q.colon&&this.unexpected(),this.eat(q.colon))m.value=w?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,ct),m.kind="init";else if(this.options.ecmaVersion>=6&&this.type===q.parenL)w&&this.unexpected(),m.kind="init",m.method=!0,m.value=this.parseMethod(N,I);else if(!w&&!Ft&&this.options.ecmaVersion>=5&&!m.computed&&m.key.type==="Identifier"&&(m.key.name==="get"||m.key.name==="set")&&this.type!==q.comma&&this.type!==q.braceR&&this.type!==q.eq){(N||I)&&this.unexpected(),m.kind=m.key.name,this.parsePropertyName(m),m.value=this.parseMethod(!1);var Ut=m.kind==="get"?0:1;if(m.value.params.length!==Ut){var Fr=m.value.start;m.kind==="get"?this.raiseRecoverable(Fr,"getter should have no params"):this.raiseRecoverable(Fr,"setter should have exactly one param")}else m.kind==="set"&&m.value.params[0].type==="RestElement"&&this.raiseRecoverable(m.value.params[0].start,"Setter cannot use rest params")}else this.options.ecmaVersion>=6&&!m.computed&&m.key.type==="Identifier"?((N||I)&&this.unexpected(),this.checkUnreserved(m.key),m.key.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=le),m.kind="init",w?m.value=this.parseMaybeDefault(le,Oe,m.key):this.type===q.eq&&ct?(ct.shorthandAssign<0&&(ct.shorthandAssign=this.start),m.value=this.parseMaybeDefault(le,Oe,m.key)):m.value=m.key,m.shorthand=!0):this.unexpected()},Pr.parsePropertyName=function(m){if(this.options.ecmaVersion>=6){if(this.eat(q.bracketL))return m.computed=!0,m.key=this.parseMaybeAssign(),this.expect(q.bracketR),m.key;m.computed=!1}return m.key=this.type===q.num||this.type===q.string?this.parseExprAtom():this.parseIdent(this.options.allowReserved!=="never")},Pr.initFunction=function(m){m.id=null,this.options.ecmaVersion>=6&&(m.generator=m.expression=!1),this.options.ecmaVersion>=8&&(m.async=!1)},Pr.parseMethod=function(m,w,N){var I=this.startNode(),le=this.yieldPos,Oe=this.awaitPos,ct=this.awaitIdentPos;return this.initFunction(I),this.options.ecmaVersion>=6&&(I.generator=m),this.options.ecmaVersion>=8&&(I.async=!!w),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(nr(w,I.generator)|Le|(N?kt:0)),this.expect(q.parenL),I.params=this.parseBindingList(q.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(I,!1,!0),this.yieldPos=le,this.awaitPos=Oe,this.awaitIdentPos=ct,this.finishNode(I,"FunctionExpression")},Pr.parseArrowExpression=function(m,w,N){var I=this.yieldPos,le=this.awaitPos,Oe=this.awaitIdentPos;return this.enterScope(nr(N,!1)|Ae),this.initFunction(m),this.options.ecmaVersion>=8&&(m.async=!!N),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,m.params=this.toAssignableList(w,!0),this.parseFunctionBody(m,!0,!1),this.yieldPos=I,this.awaitPos=le,this.awaitIdentPos=Oe,this.finishNode(m,"ArrowFunctionExpression")},Pr.parseFunctionBody=function(m,w,N){var I=w&&this.type!==q.braceL,le=this.strict,Oe=!1;if(I)m.body=this.parseMaybeAssign(),m.expression=!0,this.checkParams(m,!1);else{var ct=this.options.ecmaVersion>=7&&!this.isSimpleParamList(m.params);(!le||ct)&&(Oe=this.strictDirective(this.end),Oe&&ct&&this.raiseRecoverable(m.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var Ft=this.labels;this.labels=[],Oe&&(this.strict=!0),this.checkParams(m,!le&&!Oe&&!w&&!N&&this.isSimpleParamList(m.params)),this.strict&&m.id&&this.checkLVal(m.id,V),m.body=this.parseBlock(!1,void 0,Oe&&!le),m.expression=!1,this.adaptDirectivePrologue(m.body.body),this.labels=Ft}this.exitScope()},Pr.isSimpleParamList=function(m){for(var w=0,N=m;w<N.length;w+=1){var I=N[w];if(I.type!=="Identifier")return!1}return!0},Pr.checkParams=function(m,w){for(var N={},I=0,le=m.params;I<le.length;I+=1){var Oe=le[I];this.checkLVal(Oe,Lr,w?null:N)}},Pr.parseExprList=function(m,w,N,I){for(var le=[],Oe=!0;!this.eat(m);){if(Oe)Oe=!1;else if(this.expect(q.comma),w&&this.afterTrailingComma(m))break;var ct=void 0;N&&this.type===q.comma?ct=null:this.type===q.ellipsis?(ct=this.parseSpread(I),I&&this.type===q.comma&&I.trailingComma<0&&(I.trailingComma=this.start)):ct=this.parseMaybeAssign(!1,I),le.push(ct)}return le},Pr.checkUnreserved=function(m){var w=m.start,N=m.end,I=m.name;if(this.inGenerator&&I==="yield"&&this.raiseRecoverable(w,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&I==="await"&&this.raiseRecoverable(w,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(I)&&this.raise(w,"Unexpected keyword '"+I+"'"),!(this.options.ecmaVersion<6&&this.input.slice(w,N).indexOf("\\")!==-1)){var le=this.strict?this.reservedWordsStrict:this.reservedWords;le.test(I)&&(!this.inAsync&&I==="await"&&this.raiseRecoverable(w,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(w,"The keyword '"+I+"' is reserved"))}},Pr.parseIdent=function(m,w){var N=this.startNode();return this.type===q.name?N.name=this.value:this.type.keyword?(N.name=this.type.keyword,(N.name==="class"||N.name==="function")&&(this.lastTokEnd!==this.lastTokStart+1||this.input.charCodeAt(this.lastTokStart)!==46)&&this.context.pop()):this.unexpected(),this.next(!!m),this.finishNode(N,"Identifier"),m||(this.checkUnreserved(N),N.name==="await"&&!this.awaitIdentPos&&(this.awaitIdentPos=N.start)),N},Pr.parseYield=function(m){this.yieldPos||(this.yieldPos=this.start);var w=this.startNode();return this.next(),this.type===q.semi||this.canInsertSemicolon()||this.type!==q.star&&!this.type.startsExpr?(w.delegate=!1,w.argument=null):(w.delegate=this.eat(q.star),w.argument=this.parseMaybeAssign(m)),this.finishNode(w,"YieldExpression")},Pr.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var m=this.startNode();return this.next(),m.argument=this.parseMaybeUnary(null,!1),this.finishNode(m,"AwaitExpression")};var Jr=Ze.prototype;Jr.raise=function(m,w){var N=vt(this.input,m);w+=" ("+N.line+":"+N.column+")";var I=new SyntaxError(w);throw I.pos=m,I.loc=N,I.raisedAt=this.pos,I},Jr.raiseRecoverable=Jr.raise,Jr.curPosition=function(){if(this.options.locations)return new ge(this.curLine,this.pos-this.lineStart)};var Yr=Ze.prototype,En=function(w){this.flags=w,this.var=[],this.lexical=[],this.functions=[]};Yr.enterScope=function(m){this.scopeStack.push(new En(m))},Yr.exitScope=function(){this.scopeStack.pop()},Yr.treatFunctionsAsVarInScope=function(m){return m.flags&on||!this.inModule&&m.flags&dn},Yr.declareName=function(m,w,N){var I=!1;if(w===fr){var le=this.currentScope();I=le.lexical.indexOf(m)>-1||le.functions.indexOf(m)>-1||le.var.indexOf(m)>-1,le.lexical.push(m),this.inModule&&le.flags&dn&&delete this.undefinedExports[m]}else if(w===E){var Oe=this.currentScope();Oe.lexical.push(m)}else if(w===H){var ct=this.currentScope();this.treatFunctionsAsVar?I=ct.lexical.indexOf(m)>-1:I=ct.lexical.indexOf(m)>-1||ct.var.indexOf(m)>-1,ct.functions.push(m)}else for(var Ft=this.scopeStack.length-1;Ft>=0;--Ft){var Ut=this.scopeStack[Ft];if(Ut.lexical.indexOf(m)>-1&&!(Ut.flags&Ue&&Ut.lexical[0]===m)||!this.treatFunctionsAsVarInScope(Ut)&&Ut.functions.indexOf(m)>-1){I=!0;break}if(Ut.var.push(m),this.inModule&&Ut.flags&dn&&delete this.undefinedExports[m],Ut.flags&$i)break}I&&this.raiseRecoverable(N,"Identifier '"+m+"' has already been declared")},Yr.checkLocalExport=function(m){this.scopeStack[0].lexical.indexOf(m.name)===-1&&this.scopeStack[0].var.indexOf(m.name)===-1&&(this.undefinedExports[m.name]=m)},Yr.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},Yr.currentVarScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&$i)return w}},Yr.currentThisScope=function(){for(var m=this.scopeStack.length-1;;m--){var w=this.scopeStack[m];if(w.flags&$i&&!(w.flags&Ae))return w}};var _n=function(w,N,I){this.type="",this.start=N,this.end=0,w.options.locations&&(this.loc=new xt(w,I)),w.options.directSourceFile&&(this.sourceFile=w.options.directSourceFile),w.options.ranges&&(this.range=[N,0])},ei=Ze.prototype;ei.startNode=function(){return new _n(this,this.start,this.startLoc)},ei.startNodeAt=function(m,w){return new _n(this,m,w)};function si(m,w,N,I){return m.type=w,m.end=N,this.options.locations&&(m.loc.end=I),this.options.ranges&&(m.range[1]=N),m}ei.finishNode=function(m,w){return si.call(this,m,w,this.lastTokEnd,this.lastTokEndLoc)},ei.finishNodeAt=function(m,w,N,I){return si.call(this,m,w,N,I)};var na=function(w,N,I,le,Oe){this.token=w,this.isExpr=!!N,this.preserveSpace=!!I,this.override=le,this.generator=!!Oe},Zi={b_stat:new na("{",!1),b_expr:new na("{",!0),b_tmpl:new na("${",!1),p_stat:new na("(",!1),p_expr:new na("(",!0),q_tmpl:new na("`",!0,!0,function(m){return m.tryReadTemplateToken()}),f_stat:new na("function",!1),f_expr:new na("function",!0),f_expr_gen:new na("function",!0,!1,null,!0),f_gen:new na("function",!1,!1,null,!0)},Pi=Ze.prototype;Pi.initialContext=function(){return[Zi.b_stat]},Pi.braceIsBlock=function(m){var w=this.curContext();return w===Zi.f_expr||w===Zi.f_stat?!0:m===q.colon&&(w===Zi.b_stat||w===Zi.b_expr)?!w.isExpr:m===q._return||m===q.name&&this.exprAllowed?dr.test(this.input.slice(this.lastTokEnd,this.start)):m===q._else||m===q.semi||m===q.eof||m===q.parenR||m===q.arrow?!0:m===q.braceL?w===Zi.b_stat:m===q._var||m===q._const||m===q.name?!1:!this.exprAllowed},Pi.inGeneratorContext=function(){for(var m=this.context.length-1;m>=1;m--){var w=this.context[m];if(w.token==="function")return w.generator}return!1},Pi.updateContext=function(m){var w,N=this.type;N.keyword&&m===q.dot?this.exprAllowed=!1:(w=N.updateContext)?w.call(this,m):this.exprAllowed=N.beforeExpr},q.parenR.updateContext=q.braceR.updateContext=function(){if(this.context.length===1){this.exprAllowed=!0;return}var m=this.context.pop();m===Zi.b_stat&&this.curContext().token==="function"&&(m=this.context.pop()),this.exprAllowed=!m.isExpr},q.braceL.updateContext=function(m){this.context.push(this.braceIsBlock(m)?Zi.b_stat:Zi.b_expr),this.exprAllowed=!0},q.dollarBraceL.updateContext=function(){this.context.push(Zi.b_tmpl),this.exprAllowed=!0},q.parenL.updateContext=function(m){var w=m===q._if||m===q._for||m===q._with||m===q._while;this.context.push(w?Zi.p_stat:Zi.p_expr),this.exprAllowed=!0},q.incDec.updateContext=function(){},q._function.updateContext=q._class.updateContext=function(m){m.beforeExpr&&m!==q.semi&&m!==q._else&&!(m===q._return&&dr.test(this.input.slice(this.lastTokEnd,this.start)))&&!((m===q.colon||m===q.braceL)&&this.curContext()===Zi.b_stat)?this.context.push(Zi.f_expr):this.context.push(Zi.f_stat),this.exprAllowed=!1},q.backQuote.updateContext=function(){this.curContext()===Zi.q_tmpl?this.context.pop():this.context.push(Zi.q_tmpl),this.exprAllowed=!1},q.star.updateContext=function(m){if(m===q._function){var w=this.context.length-1;this.context[w]===Zi.f_expr?this.context[w]=Zi.f_expr_gen:this.context[w]=Zi.f_gen}this.exprAllowed=!0},q.name.updateContext=function(m){var w=!1;this.options.ecmaVersion>=6&&m!==q.dot&&(this.value==="of"&&!this.exprAllowed||this.value==="yield"&&this.inGeneratorContext())&&(w=!0),this.exprAllowed=w};var X="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",ue=X+" Extended_Pictographic",pe=ue,F={9:X,10:ue,11:pe},ee="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",he="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Te=he+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",ae=Te+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Ee={9:he,10:Te,11:ae},mt={};function Sr(m){var w=mt[m]={binary:Re(F[m]+" "+ee),nonBinary:{General_Category:Re(ee),Script:Re(Ee[m])}};w.nonBinary.Script_Extensions=w.nonBinary.Script,w.nonBinary.gc=w.nonBinary.General_Category,w.nonBinary.sc=w.nonBinary.Script,w.nonBinary.scx=w.nonBinary.Script_Extensions}Sr(9),Sr(10),Sr(11);var Wt=Ze.prototype,Ke=function(w){this.parser=w,this.validFlags="gim"+(w.options.ecmaVersion>=6?"uy":"")+(w.options.ecmaVersion>=9?"s":""),this.unicodeProperties=mt[w.options.ecmaVersion>=11?11:w.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};Ke.prototype.reset=function(w,N,I){var le=I.indexOf("u")!==-1;this.start=w|0,this.source=N+"",this.flags=I,this.switchU=le&&this.parser.options.ecmaVersion>=6,this.switchN=le&&this.parser.options.ecmaVersion>=9},Ke.prototype.raise=function(w){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+w)},Ke.prototype.at=function(w,N){N===void 0&&(N=!1);var I=this.source,le=I.length;if(w>=le)return-1;var Oe=I.charCodeAt(w);if(!(N||this.switchU)||Oe<=55295||Oe>=57344||w+1>=le)return Oe;var ct=I.charCodeAt(w+1);return ct>=56320&&ct<=57343?(Oe<<10)+ct-56613888:Oe},Ke.prototype.nextIndex=function(w,N){N===void 0&&(N=!1);var I=this.source,le=I.length;if(w>=le)return le;var Oe=I.charCodeAt(w),ct;return!(N||this.switchU)||Oe<=55295||Oe>=57344||w+1>=le||(ct=I.charCodeAt(w+1))<56320||ct>57343?w+1:w+2},Ke.prototype.current=function(w){return w===void 0&&(w=!1),this.at(this.pos,w)},Ke.prototype.lookahead=function(w){return w===void 0&&(w=!1),this.at(this.nextIndex(this.pos,w),w)},Ke.prototype.advance=function(w){w===void 0&&(w=!1),this.pos=this.nextIndex(this.pos,w)},Ke.prototype.eat=function(w,N){return N===void 0&&(N=!1),this.current(N)===w?(this.advance(N),!0):!1};function Zr(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}Wt.validateRegExpFlags=function(m){for(var w=m.validFlags,N=m.flags,I=0;I<N.length;I++){var le=N.charAt(I);w.indexOf(le)===-1&&this.raise(m.start,"Invalid regular expression flag"),N.indexOf(le,I+1)>-1&&this.raise(m.start,"Duplicate regular expression flag")}},Wt.validateRegExpPattern=function(m){this.regexp_pattern(m),!m.switchN&&this.options.ecmaVersion>=9&&m.groupNames.length>0&&(m.switchN=!0,this.regexp_pattern(m))},Wt.regexp_pattern=function(m){m.pos=0,m.lastIntValue=0,m.lastStringValue="",m.lastAssertionIsQuantifiable=!1,m.numCapturingParens=0,m.maxBackReference=0,m.groupNames.length=0,m.backReferenceNames.length=0,this.regexp_disjunction(m),m.pos!==m.source.length&&(m.eat(41)&&m.raise("Unmatched ')'"),(m.eat(93)||m.eat(125))&&m.raise("Lone quantifier brackets")),m.maxBackReference>m.numCapturingParens&&m.raise("Invalid escape");for(var w=0,N=m.backReferenceNames;w<N.length;w+=1){var I=N[w];m.groupNames.indexOf(I)===-1&&m.raise("Invalid named capture referenced")}},Wt.regexp_disjunction=function(m){for(this.regexp_alternative(m);m.eat(124);)this.regexp_alternative(m);this.regexp_eatQuantifier(m,!0)&&m.raise("Nothing to repeat"),m.eat(123)&&m.raise("Lone quantifier brackets")},Wt.regexp_alternative=function(m){for(;m.pos<m.source.length&&this.regexp_eatTerm(m););},Wt.regexp_eatTerm=function(m){return this.regexp_eatAssertion(m)?(m.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(m)&&m.switchU&&m.raise("Invalid quantifier"),!0):(m.switchU?this.regexp_eatAtom(m):this.regexp_eatExtendedAtom(m))?(this.regexp_eatQuantifier(m),!0):!1},Wt.regexp_eatAssertion=function(m){var w=m.pos;if(m.lastAssertionIsQuantifiable=!1,m.eat(94)||m.eat(36))return!0;if(m.eat(92)){if(m.eat(66)||m.eat(98))return!0;m.pos=w}if(m.eat(40)&&m.eat(63)){var N=!1;if(this.options.ecmaVersion>=9&&(N=m.eat(60)),m.eat(61)||m.eat(33))return this.regexp_disjunction(m),m.eat(41)||m.raise("Unterminated group"),m.lastAssertionIsQuantifiable=!N,!0}return m.pos=w,!1},Wt.regexp_eatQuantifier=function(m,w){return w===void 0&&(w=!1),this.regexp_eatQuantifierPrefix(m,w)?(m.eat(63),!0):!1},Wt.regexp_eatQuantifierPrefix=function(m,w){return m.eat(42)||m.eat(43)||m.eat(63)||this.regexp_eatBracedQuantifier(m,w)},Wt.regexp_eatBracedQuantifier=function(m,w){var N=m.pos;if(m.eat(123)){var I=0,le=-1;if(this.regexp_eatDecimalDigits(m)&&(I=m.lastIntValue,m.eat(44)&&this.regexp_eatDecimalDigits(m)&&(le=m.lastIntValue),m.eat(125)))return le!==-1&&le<I&&!w&&m.raise("numbers out of order in {} quantifier"),!0;m.switchU&&!w&&m.raise("Incomplete quantifier"),m.pos=N}return!1},Wt.regexp_eatAtom=function(m){return this.regexp_eatPatternCharacters(m)||m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)},Wt.regexp_eatReverseSolidusAtomEscape=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatAtomEscape(m))return!0;m.pos=w}return!1},Wt.regexp_eatUncapturingGroup=function(m){var w=m.pos;if(m.eat(40)){if(m.eat(63)&&m.eat(58)){if(this.regexp_disjunction(m),m.eat(41))return!0;m.raise("Unterminated group")}m.pos=w}return!1},Wt.regexp_eatCapturingGroup=function(m){if(m.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(m):m.current()===63&&m.raise("Invalid group"),this.regexp_disjunction(m),m.eat(41))return m.numCapturingParens+=1,!0;m.raise("Unterminated group")}return!1},Wt.regexp_eatExtendedAtom=function(m){return m.eat(46)||this.regexp_eatReverseSolidusAtomEscape(m)||this.regexp_eatCharacterClass(m)||this.regexp_eatUncapturingGroup(m)||this.regexp_eatCapturingGroup(m)||this.regexp_eatInvalidBracedQuantifier(m)||this.regexp_eatExtendedPatternCharacter(m)},Wt.regexp_eatInvalidBracedQuantifier=function(m){return this.regexp_eatBracedQuantifier(m,!0)&&m.raise("Nothing to repeat"),!1},Wt.regexp_eatSyntaxCharacter=function(m){var w=m.current();return kn(w)?(m.lastIntValue=w,m.advance(),!0):!1};function kn(m){return m===36||m>=40&&m<=43||m===46||m===63||m>=91&&m<=94||m>=123&&m<=125}Wt.regexp_eatPatternCharacters=function(m){for(var w=m.pos,N=0;(N=m.current())!==-1&&!kn(N);)m.advance();return m.pos!==w},Wt.regexp_eatExtendedPatternCharacter=function(m){var w=m.current();return w!==-1&&w!==36&&!(w>=40&&w<=43)&&w!==46&&w!==63&&w!==91&&w!==94&&w!==124?(m.advance(),!0):!1},Wt.regexp_groupSpecifier=function(m){if(m.eat(63)){if(this.regexp_eatGroupName(m)){m.groupNames.indexOf(m.lastStringValue)!==-1&&m.raise("Duplicate capture group name"),m.groupNames.push(m.lastStringValue);return}m.raise("Invalid group")}},Wt.regexp_eatGroupName=function(m){if(m.lastStringValue="",m.eat(60)){if(this.regexp_eatRegExpIdentifierName(m)&&m.eat(62))return!0;m.raise("Invalid capture group name")}return!1},Wt.regexp_eatRegExpIdentifierName=function(m){if(m.lastStringValue="",this.regexp_eatRegExpIdentifierStart(m)){for(m.lastStringValue+=Zr(m.lastIntValue);this.regexp_eatRegExpIdentifierPart(m);)m.lastStringValue+=Zr(m.lastIntValue);return!0}return!1},Wt.regexp_eatRegExpIdentifierStart=function(m){var w=m.pos,N=this.options.ecmaVersion>=11,I=m.current(N);return m.advance(N),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,N)&&(I=m.lastIntValue),Rn(I)?(m.lastIntValue=I,!0):(m.pos=w,!1)};function Rn(m){return Ir(m,!0)||m===36||m===95}Wt.regexp_eatRegExpIdentifierPart=function(m){var w=m.pos,N=this.options.ecmaVersion>=11,I=m.current(N);return m.advance(N),I===92&&this.regexp_eatRegExpUnicodeEscapeSequence(m,N)&&(I=m.lastIntValue),ft(I)?(m.lastIntValue=I,!0):(m.pos=w,!1)};function ft(m){return Qt(m,!0)||m===36||m===95||m===8204||m===8205}Wt.regexp_eatAtomEscape=function(m){return this.regexp_eatBackReference(m)||this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)||m.switchN&&this.regexp_eatKGroupName(m)?!0:(m.switchU&&(m.current()===99&&m.raise("Invalid unicode escape"),m.raise("Invalid escape")),!1)},Wt.regexp_eatBackReference=function(m){var w=m.pos;if(this.regexp_eatDecimalEscape(m)){var N=m.lastIntValue;if(m.switchU)return N>m.maxBackReference&&(m.maxBackReference=N),!0;if(N<=m.numCapturingParens)return!0;m.pos=w}return!1},Wt.regexp_eatKGroupName=function(m){if(m.eat(107)){if(this.regexp_eatGroupName(m))return m.backReferenceNames.push(m.lastStringValue),!0;m.raise("Invalid named reference")}return!1},Wt.regexp_eatCharacterEscape=function(m){return this.regexp_eatControlEscape(m)||this.regexp_eatCControlLetter(m)||this.regexp_eatZero(m)||this.regexp_eatHexEscapeSequence(m)||this.regexp_eatRegExpUnicodeEscapeSequence(m,!1)||!m.switchU&&this.regexp_eatLegacyOctalEscapeSequence(m)||this.regexp_eatIdentityEscape(m)},Wt.regexp_eatCControlLetter=function(m){var w=m.pos;if(m.eat(99)){if(this.regexp_eatControlLetter(m))return!0;m.pos=w}return!1},Wt.regexp_eatZero=function(m){return m.current()===48&&!Ni(m.lookahead())?(m.lastIntValue=0,m.advance(),!0):!1},Wt.regexp_eatControlEscape=function(m){var w=m.current();return w===116?(m.lastIntValue=9,m.advance(),!0):w===110?(m.lastIntValue=10,m.advance(),!0):w===118?(m.lastIntValue=11,m.advance(),!0):w===102?(m.lastIntValue=12,m.advance(),!0):w===114?(m.lastIntValue=13,m.advance(),!0):!1},Wt.regexp_eatControlLetter=function(m){var w=m.current();return vr(w)?(m.lastIntValue=w%32,m.advance(),!0):!1};function vr(m){return m>=65&&m<=90||m>=97&&m<=122}Wt.regexp_eatRegExpUnicodeEscapeSequence=function(m,w){w===void 0&&(w=!1);var N=m.pos,I=w||m.switchU;if(m.eat(117)){if(this.regexp_eatFixedHexDigits(m,4)){var le=m.lastIntValue;if(I&&le>=55296&&le<=56319){var Oe=m.pos;if(m.eat(92)&&m.eat(117)&&this.regexp_eatFixedHexDigits(m,4)){var ct=m.lastIntValue;if(ct>=56320&&ct<=57343)return m.lastIntValue=(le-55296)*1024+(ct-56320)+65536,!0}m.pos=Oe,m.lastIntValue=le}return!0}if(I&&m.eat(123)&&this.regexp_eatHexDigits(m)&&m.eat(125)&&et(m.lastIntValue))return!0;I&&m.raise("Invalid unicode escape"),m.pos=N}return!1};function et(m){return m>=0&&m<=1114111}Wt.regexp_eatIdentityEscape=function(m){if(m.switchU)return this.regexp_eatSyntaxCharacter(m)?!0:m.eat(47)?(m.lastIntValue=47,!0):!1;var w=m.current();return w!==99&&(!m.switchN||w!==107)?(m.lastIntValue=w,m.advance(),!0):!1},Wt.regexp_eatDecimalEscape=function(m){m.lastIntValue=0;var w=m.current();if(w>=49&&w<=57){do m.lastIntValue=10*m.lastIntValue+(w-48),m.advance();while((w=m.current())>=48&&w<=57);return!0}return!1},Wt.regexp_eatCharacterClassEscape=function(m){var w=m.current();if(Dr(w))return m.lastIntValue=-1,m.advance(),!0;if(m.switchU&&this.options.ecmaVersion>=9&&(w===80||w===112)){if(m.lastIntValue=-1,m.advance(),m.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(m)&&m.eat(125))return!0;m.raise("Invalid property name")}return!1};function Dr(m){return m===100||m===68||m===115||m===83||m===119||m===87}Wt.regexp_eatUnicodePropertyValueExpression=function(m){var w=m.pos;if(this.regexp_eatUnicodePropertyName(m)&&m.eat(61)){var N=m.lastStringValue;if(this.regexp_eatUnicodePropertyValue(m)){var I=m.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(m,N,I),!0}}if(m.pos=w,this.regexp_eatLoneUnicodePropertyNameOrValue(m)){var le=m.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(m,le),!0}return!1},Wt.regexp_validateUnicodePropertyNameAndValue=function(m,w,N){Xr(m.unicodeProperties.nonBinary,w)||m.raise("Invalid property name"),m.unicodeProperties.nonBinary[w].test(N)||m.raise("Invalid property value")},Wt.regexp_validateUnicodePropertyNameOrValue=function(m,w){m.unicodeProperties.binary.test(w)||m.raise("Invalid property name")},Wt.regexp_eatUnicodePropertyName=function(m){var w=0;for(m.lastStringValue="";In(w=m.current());)m.lastStringValue+=Zr(w),m.advance();return m.lastStringValue!==""};function In(m){return vr(m)||m===95}Wt.regexp_eatUnicodePropertyValue=function(m){var w=0;for(m.lastStringValue="";tr(w=m.current());)m.lastStringValue+=Zr(w),m.advance();return m.lastStringValue!==""};function tr(m){return In(m)||Ni(m)}Wt.regexp_eatLoneUnicodePropertyNameOrValue=function(m){return this.regexp_eatUnicodePropertyValue(m)},Wt.regexp_eatCharacterClass=function(m){if(m.eat(91)){if(m.eat(94),this.regexp_classRanges(m),m.eat(93))return!0;m.raise("Unterminated character class")}return!1},Wt.regexp_classRanges=function(m){for(;this.regexp_eatClassAtom(m);){var w=m.lastIntValue;if(m.eat(45)&&this.regexp_eatClassAtom(m)){var N=m.lastIntValue;m.switchU&&(w===-1||N===-1)&&m.raise("Invalid character class"),w!==-1&&N!==-1&&w>N&&m.raise("Range out of order in character class")}}},Wt.regexp_eatClassAtom=function(m){var w=m.pos;if(m.eat(92)){if(this.regexp_eatClassEscape(m))return!0;if(m.switchU){var N=m.current();(N===99||Fi(N))&&m.raise("Invalid class escape"),m.raise("Invalid escape")}m.pos=w}var I=m.current();return I!==93?(m.lastIntValue=I,m.advance(),!0):!1},Wt.regexp_eatClassEscape=function(m){var w=m.pos;if(m.eat(98))return m.lastIntValue=8,!0;if(m.switchU&&m.eat(45))return m.lastIntValue=45,!0;if(!m.switchU&&m.eat(99)){if(this.regexp_eatClassControlLetter(m))return!0;m.pos=w}return this.regexp_eatCharacterClassEscape(m)||this.regexp_eatCharacterEscape(m)},Wt.regexp_eatClassControlLetter=function(m){var w=m.current();return Ni(w)||w===95?(m.lastIntValue=w%32,m.advance(),!0):!1},Wt.regexp_eatHexEscapeSequence=function(m){var w=m.pos;if(m.eat(120)){if(this.regexp_eatFixedHexDigits(m,2))return!0;m.switchU&&m.raise("Invalid escape"),m.pos=w}return!1},Wt.regexp_eatDecimalDigits=function(m){var w=m.pos,N=0;for(m.lastIntValue=0;Ni(N=m.current());)m.lastIntValue=10*m.lastIntValue+(N-48),m.advance();return m.pos!==w};function Ni(m){return m>=48&&m<=57}Wt.regexp_eatHexDigits=function(m){var w=m.pos,N=0;for(m.lastIntValue=0;ia(N=m.current());)m.lastIntValue=16*m.lastIntValue+hi(N),m.advance();return m.pos!==w};function ia(m){return m>=48&&m<=57||m>=65&&m<=70||m>=97&&m<=102}function hi(m){return m>=65&&m<=70?10+(m-65):m>=97&&m<=102?10+(m-97):m-48}Wt.regexp_eatLegacyOctalEscapeSequence=function(m){if(this.regexp_eatOctalDigit(m)){var w=m.lastIntValue;if(this.regexp_eatOctalDigit(m)){var N=m.lastIntValue;w<=3&&this.regexp_eatOctalDigit(m)?m.lastIntValue=w*64+N*8+m.lastIntValue:m.lastIntValue=w*8+N}else m.lastIntValue=w;return!0}return!1},Wt.regexp_eatOctalDigit=function(m){var w=m.current();return Fi(w)?(m.lastIntValue=w-48,m.advance(),!0):(m.lastIntValue=0,!1)};function Fi(m){return m>=48&&m<=55}Wt.regexp_eatFixedHexDigits=function(m,w){var N=m.pos;m.lastIntValue=0;for(var I=0;I<w;++I){var le=m.current();if(!ia(le))return m.pos=N,!1;m.lastIntValue=16*m.lastIntValue+hi(le),m.advance()}return!0};var Wi=function(w){this.type=w.type,this.value=w.value,this.start=w.start,this.end=w.end,w.options.locations&&(this.loc=new xt(w,w.startLoc,w.endLoc)),w.options.ranges&&(this.range=[w.start,w.end])},yi=Ze.prototype;yi.next=function(m){!m&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new Wi(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},yi.getToken=function(){return this.next(),new Wi(this)},typeof Symbol!="undefined"&&(yi[Symbol.iterator]=function(){var m=this;return{next:function(){var w=m.getToken();return{done:w.type===q.eof,value:w}}}}),yi.curContext=function(){return this.context[this.context.length-1]},yi.nextToken=function(){var m=this.curContext();if((!m||!m.preserveSpace)&&this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length)return this.finishToken(q.eof);if(m.override)return m.override(this);this.readToken(this.fullCharCodeAtPos())},yi.readToken=function(m){return Ir(m,this.options.ecmaVersion>=6)||m===92?this.readWord():this.getTokenFromCode(m)},yi.fullCharCodeAtPos=function(){var m=this.input.charCodeAt(this.pos);if(m<=55295||m>=57344)return m;var w=this.input.charCodeAt(this.pos+1);return(m<<10)+w-56613888},yi.skipBlockComment=function(){var m=this.options.onComment&&this.curPosition(),w=this.pos,N=this.input.indexOf("*/",this.pos+=2);if(N===-1&&this.raise(this.pos-2,"Unterminated comment"),this.pos=N+2,this.options.locations){Qe.lastIndex=w;for(var I;(I=Qe.exec(this.input))&&I.index<this.pos;)++this.curLine,this.lineStart=I.index+I[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(w+2,N),w,this.pos,m,this.curPosition())},yi.skipLineComment=function(m){for(var w=this.pos,N=this.options.onComment&&this.curPosition(),I=this.input.charCodeAt(this.pos+=m);this.pos<this.input.length&&!$e(I);)I=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(w+m,this.pos),w,this.pos,N,this.curPosition())},yi.skipSpace=function(){e:for(;this.pos<this.input.length;){var m=this.input.charCodeAt(this.pos);switch(m){case 32:case 160:++this.pos;break;case 13:this.input.charCodeAt(this.pos+1)===10&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break e}break;default:if(m>8&&m<14||m>=5760&&Rt.test(String.fromCharCode(m)))++this.pos;else break e}}},yi.finishToken=function(m,w){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var N=this.type;this.type=m,this.value=w,this.updateContext(N)},yi.readToken_dot=function(){var m=this.input.charCodeAt(this.pos+1);if(m>=48&&m<=57)return this.readNumber(!0);var w=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&m===46&&w===46?(this.pos+=3,this.finishToken(q.ellipsis)):(++this.pos,this.finishToken(q.dot))},yi.readToken_slash=function(){var m=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):m===61?this.finishOp(q.assign,2):this.finishOp(q.slash,1)},yi.readToken_mult_modulo_exp=function(m){var w=this.input.charCodeAt(this.pos+1),N=1,I=m===42?q.star:q.modulo;return this.options.ecmaVersion>=7&&m===42&&w===42&&(++N,I=q.starstar,w=this.input.charCodeAt(this.pos+2)),w===61?this.finishOp(q.assign,N+1):this.finishOp(I,N)},yi.readToken_pipe_amp=function(m){var w=this.input.charCodeAt(this.pos+1);if(w===m){if(this.options.ecmaVersion>=12){var N=this.input.charCodeAt(this.pos+2);if(N===61)return this.finishOp(q.assign,3)}return this.finishOp(m===124?q.logicalOR:q.logicalAND,2)}return w===61?this.finishOp(q.assign,2):this.finishOp(m===124?q.bitwiseOR:q.bitwiseAND,1)},yi.readToken_caret=function(){var m=this.input.charCodeAt(this.pos+1);return m===61?this.finishOp(q.assign,2):this.finishOp(q.bitwiseXOR,1)},yi.readToken_plus_min=function(m){var w=this.input.charCodeAt(this.pos+1);return w===m?w===45&&!this.inModule&&this.input.charCodeAt(this.pos+2)===62&&(this.lastTokEnd===0||dr.test(this.input.slice(this.lastTokEnd,this.pos)))?(this.skipLineComment(3),this.skipSpace(),this.nextToken()):this.finishOp(q.incDec,2):w===61?this.finishOp(q.assign,2):this.finishOp(q.plusMin,1)},yi.readToken_lt_gt=function(m){var w=this.input.charCodeAt(this.pos+1),N=1;return w===m?(N=m===62&&this.input.charCodeAt(this.pos+2)===62?3:2,this.input.charCodeAt(this.pos+N)===61?this.finishOp(q.assign,N+1):this.finishOp(q.bitShift,N)):w===33&&m===60&&!this.inModule&&this.input.charCodeAt(this.pos+2)===45&&this.input.charCodeAt(this.pos+3)===45?(this.skipLineComment(4),this.skipSpace(),this.nextToken()):(w===61&&(N=2),this.finishOp(q.relational,N))},yi.readToken_eq_excl=function(m){var w=this.input.charCodeAt(this.pos+1);return w===61?this.finishOp(q.equality,this.input.charCodeAt(this.pos+2)===61?3:2):m===61&&w===62&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(q.arrow)):this.finishOp(m===61?q.eq:q.prefix,1)},yi.readToken_question=function(){var m=this.options.ecmaVersion;if(m>=11){var w=this.input.charCodeAt(this.pos+1);if(w===46){var N=this.input.charCodeAt(this.pos+2);if(N<48||N>57)return this.finishOp(q.questionDot,2)}if(w===63){if(m>=12){var I=this.input.charCodeAt(this.pos+2);if(I===61)return this.finishOp(q.assign,3)}return this.finishOp(q.coalesce,2)}}return this.finishOp(q.question,1)},yi.getTokenFromCode=function(m){switch(m){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(q.parenL);case 41:return++this.pos,this.finishToken(q.parenR);case 59:return++this.pos,this.finishToken(q.semi);case 44:return++this.pos,this.finishToken(q.comma);case 91:return++this.pos,this.finishToken(q.bracketL);case 93:return++this.pos,this.finishToken(q.bracketR);case 123:return++this.pos,this.finishToken(q.braceL);case 125:return++this.pos,this.finishToken(q.braceR);case 58:return++this.pos,this.finishToken(q.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(q.backQuote);case 48:var w=this.input.charCodeAt(this.pos+1);if(w===120||w===88)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(w===111||w===79)return this.readRadixNumber(8);if(w===98||w===66)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(m);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(m);case 124:case 38:return this.readToken_pipe_amp(m);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(m);case 60:case 62:return this.readToken_lt_gt(m);case 61:case 33:return this.readToken_eq_excl(m);case 63:return this.readToken_question();case 126:return this.finishOp(q.prefix,1)}this.raise(this.pos,"Unexpected character '"+_i(m)+"'")},yi.finishOp=function(m,w){var N=this.input.slice(this.pos,this.pos+w);return this.pos+=w,this.finishToken(m,N)},yi.readRegexp=function(){for(var m,w,N=this.pos;;){this.pos>=this.input.length&&this.raise(N,"Unterminated regular expression");var I=this.input.charAt(this.pos);if(dr.test(I)&&this.raise(N,"Unterminated regular expression"),m)m=!1;else{if(I==="[")w=!0;else if(I==="]"&&w)w=!1;else if(I==="/"&&!w)break;m=I==="\\"}++this.pos}var le=this.input.slice(N,this.pos);++this.pos;var Oe=this.pos,ct=this.readWord1();this.containsEsc&&this.unexpected(Oe);var Ft=this.regexpState||(this.regexpState=new Ke(this));Ft.reset(N,le,ct),this.validateRegExpFlags(Ft),this.validateRegExpPattern(Ft);var Ut=null;try{Ut=new RegExp(le,ct)}catch(Fr){}return this.finishToken(q.regexp,{pattern:le,flags:ct,value:Ut})},yi.readInt=function(m,w,N){for(var I=this.options.ecmaVersion>=12&&w===void 0,le=N&&this.input.charCodeAt(this.pos)===48,Oe=this.pos,ct=0,Ft=0,Ut=0,Fr=w==null?Infinity:w;Ut<Fr;++Ut,++this.pos){var Kr=this.input.charCodeAt(this.pos),ni=void 0;if(I&&Kr===95){le&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),Ft===95&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),Ut===0&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),Ft=Kr;continue}if(Kr>=97?ni=Kr-97+10:Kr>=65?ni=Kr-65+10:Kr>=48&&Kr<=57?ni=Kr-48:ni=Infinity,ni>=m)break;Ft=Kr,ct=ct*m+ni}return I&&Ft===95&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===Oe||w!=null&&this.pos-Oe!==w?null:ct};function ya(m,w){return w?parseInt(m,8):parseFloat(m.replace(/_/g,""))}function La(m){return typeof BigInt!="function"?null:BigInt(m.replace(/_/g,""))}yi.readRadixNumber=function(m){var w=this.pos;this.pos+=2;var N=this.readInt(m);return N==null&&this.raise(this.start+2,"Expected number in radix "+m),this.options.ecmaVersion>=11&&this.input.charCodeAt(this.pos)===110?(N=La(this.input.slice(w,this.pos)),++this.pos):Ir(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,N)},yi.readNumber=function(m){var w=this.pos;!m&&this.readInt(10,void 0,!0)===null&&this.raise(w,"Invalid number");var N=this.pos-w>=2&&this.input.charCodeAt(w)===48;N&&this.strict&&this.raise(w,"Invalid number");var I=this.input.charCodeAt(this.pos);if(!N&&!m&&this.options.ecmaVersion>=11&&I===110){var le=La(this.input.slice(w,this.pos));return++this.pos,Ir(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(q.num,le)}N&&/[89]/.test(this.input.slice(w,this.pos))&&(N=!1),I===46&&!N&&(++this.pos,this.readInt(10),I=this.input.charCodeAt(this.pos)),(I===69||I===101)&&!N&&(I=this.input.charCodeAt(++this.pos),(I===43||I===45)&&++this.pos,this.readInt(10)===null&&this.raise(w,"Invalid number")),Ir(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var Oe=ya(this.input.slice(w,this.pos),N);return this.finishToken(q.num,Oe)},yi.readCodePoint=function(){var m=this.input.charCodeAt(this.pos),w;if(m===123){this.options.ecmaVersion<6&&this.unexpected();var N=++this.pos;w=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,w>1114111&&this.invalidStringToken(N,"Code point out of bounds")}else w=this.readHexChar(4);return w};function _i(m){return m<=65535?String.fromCharCode(m):(m-=65536,String.fromCharCode((m>>10)+55296,(m&1023)+56320))}yi.readString=function(m){for(var w="",N=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var I=this.input.charCodeAt(this.pos);if(I===m)break;I===92?(w+=this.input.slice(N,this.pos),w+=this.readEscapedChar(!1),N=this.pos):($e(I,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return w+=this.input.slice(N,this.pos++),this.finishToken(q.string,w)};var Mi={};yi.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(m){if(m===Mi)this.readInvalidTemplateToken();else throw m}this.inTemplateElement=!1},yi.invalidStringToken=function(m,w){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw Mi;this.raise(m,w)},yi.readTmplToken=function(){for(var m="",w=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var N=this.input.charCodeAt(this.pos);if(N===96||N===36&&this.input.charCodeAt(this.pos+1)===123)return this.pos===this.start&&(this.type===q.template||this.type===q.invalidTemplate)?N===36?(this.pos+=2,this.finishToken(q.dollarBraceL)):(++this.pos,this.finishToken(q.backQuote)):(m+=this.input.slice(w,this.pos),this.finishToken(q.template,m));if(N===92)m+=this.input.slice(w,this.pos),m+=this.readEscapedChar(!0),w=this.pos;else if($e(N)){switch(m+=this.input.slice(w,this.pos),++this.pos,N){case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:m+=`
`;break;default:m+=String.fromCharCode(N);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),w=this.pos}else++this.pos}},yi.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if(this.input[this.pos+1]!=="{")break;case"`":return this.finishToken(q.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},yi.readEscapedChar=function(m){var w=this.input.charCodeAt(++this.pos);switch(++this.pos,w){case 110:return`
`;case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return _i(this.readCodePoint());case 116:return"	";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:this.input.charCodeAt(this.pos)===10&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(m){var N=this.pos-1;return this.invalidStringToken(N,"Invalid escape sequence in template string"),null}default:if(w>=48&&w<=55){var I=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],le=parseInt(I,8);return le>255&&(I=I.slice(0,-1),le=parseInt(I,8)),this.pos+=I.length-1,w=this.input.charCodeAt(this.pos),(I!=="0"||w===56||w===57)&&(this.strict||m)&&this.invalidStringToken(this.pos-1-I.length,m?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(le)}return $e(w)?"":String.fromCharCode(w)}},yi.readHexChar=function(m){var w=this.pos,N=this.readInt(16,m);return N===null&&this.invalidStringToken(w,"Bad character escape sequence"),N},yi.readWord1=function(){this.containsEsc=!1;for(var m="",w=!0,N=this.pos,I=this.options.ecmaVersion>=6;this.pos<this.input.length;){var le=this.fullCharCodeAtPos();if(Qt(le,I))this.pos+=le<=65535?1:2;else if(le===92){this.containsEsc=!0,m+=this.input.slice(N,this.pos);var Oe=this.pos;this.input.charCodeAt(++this.pos)!==117&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var ct=this.readCodePoint();(w?Ir:Qt)(ct,I)||this.invalidStringToken(Oe,"Invalid Unicode escape"),m+=_i(ct),N=this.pos}else break;w=!1}return m+this.input.slice(N,this.pos)},yi.readWord=function(){var m=this.readWord1(),w=q.name;return this.keywords.test(m)&&(w=Ct[m]),this.finishToken(w,m)};var Ji="7.4.1";Ze.acorn={Parser:Ze,version:Ji,defaultOptions:Nt,Position:ge,SourceLocation:xt,getLineInfo:vt,Node:_n,TokenType:Yt,tokTypes:q,keywordTypes:Ct,TokContext:na,tokContexts:Zi,isIdentifierChar:Qt,isIdentifierStart:Ir,Token:Wi,isNewLine:$e,lineBreak:dr,lineBreakG:Qe,nonASCIIwhitespace:Rt};function to(m,w){return Ze.parse(m,w)}function jo(m,w,N){return Ze.parseExpressionAt(m,w,N)}function ja(m,w){return Ze.tokenizer(m,w)}function Xi(m,w){m.prototype=Object.create(w.prototype),m.prototype.constructor=m,m.__proto__=w}function du(m){var w=typeof Map=="function"?new Map:void 0;return du=function(I){if(I===null||!Vo(I))return I;if(typeof I!="function")throw new TypeError("Super expression must either be null or a function");if(typeof w!="undefined"){if(w.has(I))return w.get(I);w.set(I,le)}function le(){return Ba(I,arguments,ro(this).constructor)}return le.prototype=Object.create(I.prototype,{constructor:{value:le,enumerable:!1,writable:!0,configurable:!0}}),Yi(le,I)},du(m)}function ku(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function Ba(m,w,N){return ku()?Ba=Reflect.construct:Ba=function(le,Oe,ct){var Ft=[null];Ft.push.apply(Ft,Oe);var Ut=Function.bind.apply(le,Ft),Fr=new Ut;return ct&&Yi(Fr,ct.prototype),Fr},Ba.apply(null,arguments)}function Vo(m){return Function.toString.call(m).indexOf("[native code]")!==-1}function Yi(m,w){return Yi=Object.setPrototypeOf||function(I,le){return I.__proto__=le,I},Yi(m,w)}function ro(m){return ro=Object.setPrototypeOf?Object.getPrototypeOf:function(N){return N.__proto__||Object.getPrototypeOf(N)},ro(m)}var Jo=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(du(Error)),xa=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(du(SyntaxError)),Lo=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(du(ReferenceError)),No=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(du(TypeError)),Us=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Jo),_o=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(xa),Qo=function(m){Xi(w,m);function w(){return m.apply(this,arguments)||this}return w}(Lo),Va={UnknownError:[3001,"%0",Us],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",Us],NodeTypeSyntaxError:[1001,"Unknown node type: %0",Qo],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",Qo],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",Qo],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",Qo],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",Qo],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",Qo],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",Qo],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",Qo],ParamTypeSyntaxError:[1009,"Unknown param type: %0",Qo],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",Qo],FunctionUndefinedReferenceError:[2001,"%0 is not a function",Lo],VariableUndefinedReferenceError:[2002,"%0 is not defined",Lo],IsNotConstructor:[2003,"%0 is not a constructor",No]};function uo(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(m){return!1}}function ss(m,w,N){return uo()?ss=Reflect.construct:ss=function(le,Oe,ct){var Ft=[null];Ft.push.apply(Ft,Oe);var Ut=Function.bind.apply(le,Ft),Fr=new Ut;return ct&&Co(Fr,ct.prototype),Fr},ss.apply(null,arguments)}function Co(m,w){return Co=Object.setPrototypeOf||function(I,le){return I.__proto__=le,I},Co(m,w)}var _e="0.0.2";function De(m,w){Object.defineProperty(m,"name",{value:w,writable:!1,enumerable:!1,configurable:!0})}var pt=Object.prototype.hasOwnProperty,$t=Symbol("Break"),en=Symbol("Continue"),ti=Symbol("DefaultCase"),Ai=Symbol("EmptyStatementReturn"),ha=Symbol("WithScopeName"),Na=Symbol("SuperScopeName"),po=Symbol("RootScopeName"),us=Symbol("GlobalScopeName");function vu(m){return typeof m=="function"}var Au=function(){function m(N){this.interpreter=N}var w=m.prototype;return w.generator=function(){var I=this.interpreter;function le(){return this.getCurrentScope()}function Oe(){return this.getGlobalScope()}function ct(){return this.getCurrentContext()}return{getOptions:I.getOptions.bind(I),getCurrentScope:le.bind(I),getGlobalScope:Oe.bind(I),getCurrentContext:ct.bind(I),getExecStartTime:I.getExecStartTime.bind(I)}},m}();function Xu(m,w,N){if(N===void 0&&(N=!0),!(m instanceof Au))throw new Error("Illegal call");if(typeof w!="string")return w;if(!!w){var I=m.generator(),le=I.getOptions(),Oe={timeout:le.timeout,_initEnv:function(){N||this.setCurrentContext(I.getCurrentContext()),this.execStartTime=I.getExecStartTime(),this.execEndTime=this.execStartTime}},ct=N?I.getGlobalScope():I.getCurrentScope(),Ft=new Ro(ct,Oe);return Ft.evaluate(w)}}Object.defineProperty(Xu,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});function Go(m){if(!(m instanceof Au))throw new Error("Illegal call");for(var w=m.generator(),N=arguments.length,I=new Array(N>1?N-1:0),le=1;le<N;le++)I[le-1]=arguments[le];var Oe=I.pop(),ct=new Ro(w.getGlobalScope(),w.getOptions()),Ft=`
		    (function anonymous(`+I.join(",")+`){
		        `+Oe+`
		    });
		    `;return ct.evaluate(Ft)}Object.defineProperty(Go,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var qo=function(w){this.value=w},ls=function(w){this.value=w},ys=function(w){this.value=w},Ho=function(w,N,I){N===void 0&&(N=null),this.name=I,this.parent=N,this.data=w,this.labelStack=[]};function Ws(){}function ru(m,w){return m===void 0&&(m=null),new Ho(Object.create(null),m,w)}function Is(m){return Object.create(m)}var Ta={NaN:NaN,Infinity:Infinity,undefined:void 0,Object,Array,String,Boolean,Number,Date,RegExp,Error,URIError,TypeError,RangeError,SyntaxError,ReferenceError,Float32Array,Uint32Array,Math,parseInt,parseFloat,isNaN,isFinite,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,escape,unescape,eval:Xu,Function:Go};typeof JSON!="undefined"&&(Ta.JSON=JSON),typeof Promise!="undefined"&&(Ta.Promise=Promise),typeof Set!="undefined"&&(Ta.Set=Set),typeof Map!="undefined"&&(Ta.Map=Map),typeof Symbol!="undefined"&&(Ta.Symbol=Symbol),typeof Proxy!="undefined"&&(Ta.Proxy=Proxy),typeof WeakMap!="undefined"&&(Ta.WeakMap=WeakMap),typeof WeakSet!="undefined"&&(Ta.WeakSet=WeakSet),typeof Reflect!="undefined"&&(Ta.Reflect=Reflect);var Ro=function(){function m(N,I){N===void 0&&(N=m.global),I===void 0&&(I={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:I.ecmaVersion||m.ecmaVersion,timeout:I.timeout||0,rootContext:I.rootContext,globalContextInFunction:I.globalContextInFunction===void 0?m.globalContextInFunction:I.globalContextInFunction,_initEnv:I._initEnv},this.context=N||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var w=m.prototype;return w.initEnvironment=function(I){var le;if(I instanceof Ho)le=I;else{var Oe=null,ct=this.createSuperScope(I);this.options.rootContext&&(Oe=new Ho(Is(this.options.rootContext),ct,po)),le=new Ho(I,Oe||ct,us)}this.globalScope=le,this.currentScope=this.globalScope,this.globalContext=le.data,this.currentContext=le.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var Ft=this.options._initEnv;Ft&&Ft.call(this)},w.getExecStartTime=function(){return this.execStartTime},w.getExecutionTime=function(){return this.execEndTime-this.execStartTime},w.setExecTimeout=function(I){I===void 0&&(I=0),this.options.timeout=I},w.getOptions=function(){return this.options},w.getGlobalScope=function(){return this.globalScope},w.getCurrentScope=function(){return this.currentScope},w.getCurrentContext=function(){return this.currentContext},w.isInterruptThrow=function(I){return I instanceof Us||I instanceof Qo||I instanceof _o},w.createSuperScope=function(I){var le=Object.assign({},Ta),Oe=Object.keys(le);return Oe.forEach(function(ct){ct in I&&delete le[ct]}),new Ho(le,null,Na)},w.setCurrentContext=function(I){this.currentContext=I},w.setCurrentScope=function(I){this.currentScope=I},w.evaluate=function(I){I===void 0&&(I="");var le;if(!!I)return le=to(I,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||m.ecmaVersion}),this.evaluateNode(le,I)},w.appendCode=function(I){return this.evaluate(I)},w.evaluateNode=function(I,le){var Oe=this;le===void 0&&(le=""),this.value=void 0,this.source=le,this.sourceList.push(le),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var ct=this.getCurrentScope(),Ft=this.getCurrentContext(),Ut=ct.labelStack.concat([]),Fr=this.callStack.concat([]),Kr=function(){Oe.setCurrentScope(ct),Oe.setCurrentContext(Ft),ct.labelStack=Ut,Oe.callStack=Fr};try{var ni=this.createClosure(I);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),ni()}catch(Ii){throw Ii}finally{Kr(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},w.createErrorMessage=function(I,le,Oe){var ct=I[1].replace("%0",String(le));return Oe!==null&&(ct+=this.getNodePosition(Oe||this.lastExecNode)),ct},w.createError=function(I,le){return new le(I)},w.createThrowError=function(I,le){return this.createError(I,le)},w.createInternalThrowError=function(I,le,Oe){return this.createError(this.createErrorMessage(I,le,Oe),I[2])},w.checkTimeout=function(){if(!this.isRunning)return!1;var I=this.options.timeout||0,le=Date.now();return le-this.execStartTime>I},w.getNodePosition=function(I){if(I){var le="";return I.loc?" ["+I.loc.start.line+":"+I.loc.start.column+"]"+le:""}return""},w.createClosure=function(I){var le=this,Oe;switch(I.type){case"BinaryExpression":Oe=this.binaryExpressionHandler(I);break;case"LogicalExpression":Oe=this.logicalExpressionHandler(I);break;case"UnaryExpression":Oe=this.unaryExpressionHandler(I);break;case"UpdateExpression":Oe=this.updateExpressionHandler(I);break;case"ObjectExpression":Oe=this.objectExpressionHandler(I);break;case"ArrayExpression":Oe=this.arrayExpressionHandler(I);break;case"CallExpression":Oe=this.callExpressionHandler(I);break;case"NewExpression":Oe=this.newExpressionHandler(I);break;case"MemberExpression":Oe=this.memberExpressionHandler(I);break;case"ThisExpression":Oe=this.thisExpressionHandler(I);break;case"SequenceExpression":Oe=this.sequenceExpressionHandler(I);break;case"Literal":Oe=this.literalHandler(I);break;case"Identifier":Oe=this.identifierHandler(I);break;case"AssignmentExpression":Oe=this.assignmentExpressionHandler(I);break;case"FunctionDeclaration":Oe=this.functionDeclarationHandler(I);break;case"VariableDeclaration":Oe=this.variableDeclarationHandler(I);break;case"BlockStatement":case"Program":Oe=this.programHandler(I);break;case"ExpressionStatement":Oe=this.expressionStatementHandler(I);break;case"EmptyStatement":Oe=this.emptyStatementHandler(I);break;case"ReturnStatement":Oe=this.returnStatementHandler(I);break;case"FunctionExpression":Oe=this.functionExpressionHandler(I);break;case"IfStatement":Oe=this.ifStatementHandler(I);break;case"ConditionalExpression":Oe=this.conditionalExpressionHandler(I);break;case"ForStatement":Oe=this.forStatementHandler(I);break;case"WhileStatement":Oe=this.whileStatementHandler(I);break;case"DoWhileStatement":Oe=this.doWhileStatementHandler(I);break;case"ForInStatement":Oe=this.forInStatementHandler(I);break;case"WithStatement":Oe=this.withStatementHandler(I);break;case"ThrowStatement":Oe=this.throwStatementHandler(I);break;case"TryStatement":Oe=this.tryStatementHandler(I);break;case"ContinueStatement":Oe=this.continueStatementHandler(I);break;case"BreakStatement":Oe=this.breakStatementHandler(I);break;case"SwitchStatement":Oe=this.switchStatementHandler(I);break;case"LabeledStatement":Oe=this.labeledStatementHandler(I);break;case"DebuggerStatement":Oe=this.debuggerStatementHandler(I);break;default:throw this.createInternalThrowError(Va.NodeTypeSyntaxError,I.type,I)}return function(){var ct=le.options.timeout;if(ct&&ct>0&&le.checkTimeout())throw le.createInternalThrowError(Va.ExecutionTimeOutError,ct,null);return le.lastExecNode=I,Oe.apply(void 0,arguments)}},w.binaryExpressionHandler=function(I){var le=this,Oe=this.createClosure(I.left),ct=this.createClosure(I.right);return function(){var Ft=Oe(),Ut=ct();switch(I.operator){case"==":return Ft==Ut;case"!=":return Ft!=Ut;case"===":return Ft===Ut;case"!==":return Ft!==Ut;case"<":return Ft<Ut;case"<=":return Ft<=Ut;case">":return Ft>Ut;case">=":return Ft>=Ut;case"<<":return Ft<<Ut;case">>":return Ft>>Ut;case">>>":return Ft>>>Ut;case"+":return Ft+Ut;case"-":return Ft-Ut;case"*":return Ft*Ut;case"**":return Math.pow(Ft,Ut);case"/":return Ft/Ut;case"%":return Ft%Ut;case"|":return Ft|Ut;case"^":return Ft^Ut;case"&":return Ft&Ut;case"in":return Ft in Ut;case"instanceof":return Ft instanceof Ut;default:throw le.createInternalThrowError(Va.BinaryOperatorSyntaxError,I.operator,I)}}},w.logicalExpressionHandler=function(I){var le=this,Oe=this.createClosure(I.left),ct=this.createClosure(I.right);return function(){switch(I.operator){case"||":return Oe()||ct();case"&&":return Oe()&&ct();default:throw le.createInternalThrowError(Va.LogicalOperatorSyntaxError,I.operator,I)}}},w.unaryExpressionHandler=function(I){var le=this;switch(I.operator){case"delete":var Oe=this.createObjectGetter(I.argument),ct=this.createNameGetter(I.argument);return function(){var Kr=Oe(),ni=ct();return delete Kr[ni]};default:var Ft;if(I.operator==="typeof"&&I.argument.type==="Identifier"){var Ut=this.createObjectGetter(I.argument),Fr=this.createNameGetter(I.argument);Ft=function(){return Ut()[Fr()]}}else Ft=this.createClosure(I.argument);return function(){var Kr=Ft();switch(I.operator){case"-":return-Kr;case"+":return+Kr;case"!":return!Kr;case"~":return~Kr;case"void":return;case"typeof":return typeof Kr;default:throw le.createInternalThrowError(Va.UnaryOperatorSyntaxError,I.operator,I)}}}},w.updateExpressionHandler=function(I){var le=this,Oe=this.createObjectGetter(I.argument),ct=this.createNameGetter(I.argument);return function(){var Ft=Oe(),Ut=ct();switch(le.assertVariable(Ft,Ut,I),I.operator){case"++":return I.prefix?++Ft[Ut]:Ft[Ut]++;case"--":return I.prefix?--Ft[Ut]:Ft[Ut]--;default:throw le.createInternalThrowError(Va.UpdateOperatorSyntaxError,I.operator,I)}}},w.objectExpressionHandler=function(I){var le=this,Oe=[];function ct(Ut){return Ut.type==="Identifier"?Ut.name:Ut.type==="Literal"?Ut.value:this.throwError(Va.ObjectStructureSyntaxError,Ut.type,Ut)}var Ft=Object.create(null);return I.properties.forEach(function(Ut){var Fr=Ut.kind,Kr=ct(Ut.key);(!Ft[Kr]||Fr==="init")&&(Ft[Kr]={}),Ft[Kr][Fr]=le.createClosure(Ut.value),Oe.push({key:Kr,property:Ut})}),function(){for(var Ut={},Fr=Oe.length,Kr=0;Kr<Fr;Kr++){var ni=Oe[Kr],Ii=ni.key,bi=Ft[Ii],pa=bi.init?bi.init():void 0,Pa=bi.get?bi.get():function(){},za=bi.set?bi.set():function(Bu){};if("set"in bi||"get"in bi){var Ti={configurable:!0,enumerable:!0,get:Pa,set:za};Object.defineProperty(Ut,Ii,Ti)}else{var _s=ni.property,iu=_s.kind;_s.key.type==="Identifier"&&_s.value.type==="FunctionExpression"&&iu==="init"&&!_s.value.id&&De(pa,_s.key.name),Ut[Ii]=pa}}return Ut}},w.arrayExpressionHandler=function(I){var le=this,Oe=I.elements.map(function(ct){return ct&&le.createClosure(ct)});return function(){for(var ct=Oe.length,Ft=Array(ct),Ut=0;Ut<ct;Ut++){var Fr=Oe[Ut];Fr&&(Ft[Ut]=Fr())}return Ft}},w.safeObjectGet=function(I,le,Oe){return I[le]},w.createCallFunctionGetter=function(I){var le=this;switch(I.type){case"MemberExpression":var Oe=this.createClosure(I.object),ct=this.createMemberKeyGetter(I),Ft=this.source;return function(){var Fr=Oe(),Kr=ct(),ni=le.safeObjectGet(Fr,Kr,I);if(!ni||!vu(ni)){var Ii=Ft.slice(I.start,I.end);throw le.createInternalThrowError(Va.FunctionUndefinedReferenceError,Ii,I)}return ni.__IS_EVAL_FUNC?function(bi){return ni(new Au(le),bi,!0)}:ni.__IS_FUNCTION_FUNC?function(){for(var bi=arguments.length,pa=new Array(bi),Pa=0;Pa<bi;Pa++)pa[Pa]=arguments[Pa];return ni.apply(void 0,[new Au(le)].concat(pa))}:ni.bind(Fr)};default:var Ut=this.createClosure(I);return function(){var Fr="";I.type==="Identifier"&&(Fr=I.name);var Kr=Ut();if(!Kr||!vu(Kr))throw le.createInternalThrowError(Va.FunctionUndefinedReferenceError,Fr,I);if(I.type==="Identifier"&&Kr.__IS_EVAL_FUNC&&Fr==="eval")return function(bi){var pa=le.getScopeFromName(Fr,le.getCurrentScope()),Pa=pa.name===Na||pa.name===us||pa.name===po;return Kr(new Au(le),bi,!Pa)};if(Kr.__IS_EVAL_FUNC)return function(bi){return Kr(new Au(le),bi,!0)};if(Kr.__IS_FUNCTION_FUNC)return function(){for(var bi=arguments.length,pa=new Array(bi),Pa=0;Pa<bi;Pa++)pa[Pa]=arguments[Pa];return Kr.apply(void 0,[new Au(le)].concat(pa))};var ni=le.options.globalContextInFunction;if(I.type==="Identifier"){var Ii=le.getIdentifierScope(I);Ii.name===ha&&(ni=Ii.data)}return Kr.bind(ni)}}},w.callExpressionHandler=function(I){var le=this,Oe=this.createCallFunctionGetter(I.callee),ct=I.arguments.map(function(Ft){return le.createClosure(Ft)});return function(){return Oe().apply(void 0,ct.map(function(Ft){return Ft()}))}},w.functionExpressionHandler=function(I){var le=this,Oe=this,ct=this.source,Ft=this.collectDeclVars,Ut=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var Fr=I.id?I.id.name:"",Kr=I.params.length,ni=I.params.map(function(Pa){return le.createParamNameGetter(Pa)}),Ii=this.createClosure(I.body),bi=this.collectDeclVars,pa=this.collectDeclFuncs;return this.collectDeclVars=Ft,this.collectDeclFuncs=Ut,function(){var Pa=Oe.getCurrentScope(),za=function Ti(){for(var _s=arguments.length,iu=new Array(_s),Bu=0;Bu<_s;Bu++)iu[Bu]=arguments[Bu];Oe.callStack.push(""+Fr);var tc=Oe.getCurrentScope(),Yu=ru(Pa,"FunctionScope("+Fr+")");Oe.setCurrentScope(Yu),Oe.addDeclarationsToScope(bi,pa,Yu),Fr&&(Yu.data[Fr]=Ti),Yu.data.arguments=arguments,ni.forEach(function(gu,Tu){Yu.data[gu()]=iu[Tu]});var rc=Oe.getCurrentContext();Oe.setCurrentContext(this);var mu=Ii();if(Oe.setCurrentContext(rc),Oe.setCurrentScope(tc),Oe.callStack.pop(),mu instanceof qo)return mu.value};return De(za,Fr),Object.defineProperty(za,"length",{value:Kr,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(za,"toString",{value:function(){return ct.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(za,"valueOf",{value:function(){return ct.slice(I.start,I.end)},writable:!0,configurable:!0,enumerable:!1}),za}},w.newExpressionHandler=function(I){var le=this,Oe=this.source,ct=this.createClosure(I.callee),Ft=I.arguments.map(function(Ut){return le.createClosure(Ut)});return function(){var Ut=ct();if(!vu(Ut)||Ut.__IS_EVAL_FUNC){var Fr=I.callee,Kr=Oe.slice(Fr.start,Fr.end);throw le.createInternalThrowError(Va.IsNotConstructor,Kr,I)}return Ut.__IS_FUNCTION_FUNC?Ut.apply(void 0,[new Au(le)].concat(Ft.map(function(ni){return ni()}))):ss(Ut,Ft.map(function(ni){return ni()}))}},w.memberExpressionHandler=function(I){var le=this.createClosure(I.object),Oe=this.createMemberKeyGetter(I);return function(){var ct=le(),Ft=Oe();return ct[Ft]}},w.thisExpressionHandler=function(I){var le=this;return function(){return le.getCurrentContext()}},w.sequenceExpressionHandler=function(I){var le=this,Oe=I.expressions.map(function(ct){return le.createClosure(ct)});return function(){for(var ct,Ft=Oe.length,Ut=0;Ut<Ft;Ut++){var Fr=Oe[Ut];ct=Fr()}return ct}},w.literalHandler=function(I){return function(){return I.regex?new RegExp(I.regex.pattern,I.regex.flags):I.value}},w.identifierHandler=function(I){var le=this;return function(){var Oe=le.getCurrentScope(),ct=le.getScopeDataFromName(I.name,Oe);return le.assertVariable(ct,I.name,I),ct[I.name]}},w.getIdentifierScope=function(I){var le=this.getCurrentScope(),Oe=this.getScopeFromName(I.name,le);return Oe},w.assignmentExpressionHandler=function(I){var le=this;I.left.type==="Identifier"&&I.right.type==="FunctionExpression"&&!I.right.id&&(I.right.id={type:"Identifier",name:I.left.name});var Oe=this.createObjectGetter(I.left),ct=this.createNameGetter(I.left),Ft=this.createClosure(I.right);return function(){var Ut=Oe(),Fr=ct(),Kr=Ft();switch(I.operator!=="="&&le.assertVariable(Ut,Fr,I),I.operator){case"=":return Ut[Fr]=Kr;case"+=":return Ut[Fr]+=Kr;case"-=":return Ut[Fr]-=Kr;case"*=":return Ut[Fr]*=Kr;case"**=":return Ut[Fr]=Math.pow(Ut[Fr],Kr);case"/=":return Ut[Fr]/=Kr;case"%=":return Ut[Fr]%=Kr;case"<<=":return Ut[Fr]<<=Kr;case">>=":return Ut[Fr]>>=Kr;case">>>=":return Ut[Fr]>>>=Kr;case"&=":return Ut[Fr]&=Kr;case"^=":return Ut[Fr]^=Kr;case"|=":return Ut[Fr]|=Kr;default:throw le.createInternalThrowError(Va.AssignmentExpressionSyntaxError,I.type,I)}}},w.functionDeclarationHandler=function(I){if(I.id){var le=this.functionExpressionHandler(I);Object.defineProperty(le,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(I.id.name,le)}return function(){return Ai}},w.getVariableName=function(I){if(I.type==="Identifier")return I.name;throw this.createInternalThrowError(Va.VariableTypeSyntaxError,I.type,I)},w.variableDeclarationHandler=function(I){for(var le=this,Oe,ct=[],Ft=0;Ft<I.declarations.length;Ft++){var Ut=I.declarations[Ft];this.varDeclaration(this.getVariableName(Ut.id)),Ut.init&&ct.push({type:"AssignmentExpression",operator:"=",left:Ut.id,right:Ut.init})}return ct.length&&(Oe=this.createClosure({type:"BlockStatement",body:ct})),function(){if(Oe){var Fr=le.isVarDeclMode;le.isVarDeclMode=!0,Oe(),le.isVarDeclMode=Fr}return Ai}},w.assertVariable=function(I,le,Oe){if(I===this.globalScope.data&&!(le in I))throw this.createInternalThrowError(Va.VariableUndefinedReferenceError,le,Oe)},w.programHandler=function(I){var le=this,Oe=I.body.map(function(ct){return le.createClosure(ct)});return function(){for(var ct=Ai,Ft=0;Ft<Oe.length;Ft++){var Ut=Oe[Ft],Fr=le.setValue(Ut());if(Fr!==Ai&&(ct=Fr,ct instanceof qo||ct instanceof ls||ct instanceof ys||ct===$t||ct===en))break}return ct}},w.expressionStatementHandler=function(I){return this.createClosure(I.expression)},w.emptyStatementHandler=function(I){return function(){return Ai}},w.returnStatementHandler=function(I){var le=I.argument?this.createClosure(I.argument):Ws;return function(){return new qo(le())}},w.ifStatementHandler=function(I){var le=this.createClosure(I.test),Oe=this.createClosure(I.consequent),ct=I.alternate?this.createClosure(I.alternate):function(){return Ai};return function(){return le()?Oe():ct()}},w.conditionalExpressionHandler=function(I){return this.ifStatementHandler(I)},w.forStatementHandler=function(I){var le=this,Oe=Ws,ct=I.test?this.createClosure(I.test):function(){return!0},Ft=Ws,Ut=this.createClosure(I.body);return I.type==="ForStatement"&&(Oe=I.init?this.createClosure(I.init):Oe,Ft=I.update?this.createClosure(I.update):Ws),function(Fr){var Kr,ni=Ai,Ii=I.type==="DoWhileStatement";for(Fr&&Fr.type==="LabeledStatement"&&(Kr=Fr.label.name),Oe();Ii||ct();Ft()){Ii=!1;var bi=le.setValue(Ut());if(!(bi===Ai||bi===en)){if(bi===$t)break;if(ni=bi,ni instanceof ys&&ni.value===Kr){ni=Ai;continue}if(ni instanceof qo||ni instanceof ls||ni instanceof ys)break}}return ni}},w.whileStatementHandler=function(I){return this.forStatementHandler(I)},w.doWhileStatementHandler=function(I){return this.forStatementHandler(I)},w.forInStatementHandler=function(I){var le=this,Oe=I.left,ct=this.createClosure(I.right),Ft=this.createClosure(I.body);return I.left.type==="VariableDeclaration"&&(this.createClosure(I.left)(),Oe=I.left.declarations[0].id),function(Ut){var Fr,Kr=Ai,ni;Ut&&Ut.type==="LabeledStatement"&&(Fr=Ut.label.name);var Ii=ct();for(ni in Ii){le.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:Oe,right:{type:"Literal",value:ni}})();var bi=le.setValue(Ft());if(!(bi===Ai||bi===en)){if(bi===$t)break;if(Kr=bi,Kr instanceof ys&&Kr.value===Fr){Kr=Ai;continue}if(Kr instanceof qo||Kr instanceof ls||Kr instanceof ys)break}}return Kr}},w.withStatementHandler=function(I){var le=this,Oe=this.createClosure(I.object),ct=this.createClosure(I.body);return function(){var Ft=Oe(),Ut=le.getCurrentScope(),Fr=new Ho(Ft,Ut,ha);le.setCurrentScope(Fr);var Kr=le.setValue(ct());return le.setCurrentScope(Ut),Kr}},w.throwStatementHandler=function(I){var le=this,Oe=this.createClosure(I.argument);return function(){throw le.setValue(void 0),Oe()}},w.tryStatementHandler=function(I){var le=this,Oe=this.createClosure(I.block),ct=I.handler?this.catchClauseHandler(I.handler):null,Ft=I.finalizer?this.createClosure(I.finalizer):null;return function(){var Ut=le.getCurrentScope(),Fr=le.getCurrentContext(),Kr=Ut.labelStack.concat([]),ni=le.callStack.concat([]),Ii=Ai,bi,pa,Pa=function(){le.setCurrentScope(Ut),le.setCurrentContext(Fr),Ut.labelStack=Kr,le.callStack=ni};try{Ii=le.setValue(Oe()),Ii instanceof qo&&(bi=Ii)}catch(za){if(Pa(),le.isInterruptThrow(za))throw za;if(ct)try{Ii=le.setValue(ct(za)),Ii instanceof qo&&(bi=Ii)}catch(Ti){if(Pa(),le.isInterruptThrow(Ti))throw Ti;pa=Ti}}if(Ft)try{Ii=Ft(),Ii instanceof qo&&(bi=Ii)}catch(za){if(Pa(),le.isInterruptThrow(za))throw za;pa=za}if(pa)throw pa;return bi||Ii}},w.catchClauseHandler=function(I){var le=this,Oe=this.createParamNameGetter(I.param),ct=this.createClosure(I.body);return function(Ft){var Ut,Fr=le.getCurrentScope(),Kr=Fr.data,ni=Oe(),Ii=pt.call(Kr,ni),bi=Kr[ni];return Kr[ni]=Ft,Ut=ct(),Ii?Kr[ni]=bi:delete Kr[ni],Ut}},w.continueStatementHandler=function(I){return function(){return I.label?new ys(I.label.name):en}},w.breakStatementHandler=function(I){return function(){return I.label?new ls(I.label.name):$t}},w.switchStatementHandler=function(I){var le=this,Oe=this.createClosure(I.discriminant),ct=I.cases.map(function(Ft){return le.switchCaseHandler(Ft)});return function(){for(var Ft=Oe(),Ut=!1,Fr,Kr,ni,Ii=0;Ii<ct.length;Ii++){var bi=ct[Ii](),pa=bi.testClosure();if(pa===ti){ni=bi;continue}if(Ut||pa===Ft){if(Ut=!0,Kr=le.setValue(bi.bodyClosure()),Kr===Ai)continue;if(Kr===$t||(Fr=Kr,Fr instanceof qo||Fr instanceof ls||Fr instanceof ys||Fr===en))break}}if(!Ut&&ni){Kr=le.setValue(ni.bodyClosure());var Pa=Kr===Ai||Kr===$t||Kr===en;Pa||(Fr=Kr)}return Fr}},w.switchCaseHandler=function(I){var le=I.test?this.createClosure(I.test):function(){return ti},Oe=this.createClosure({type:"BlockStatement",body:I.consequent});return function(){return{testClosure:le,bodyClosure:Oe}}},w.labeledStatementHandler=function(I){var le=this,Oe=I.label.name,ct=this.createClosure(I.body);return function(){var Ft,Ut=le.getCurrentScope();return Ut.labelStack.push(Oe),Ft=ct(I),Ft instanceof ls&&Ft.value===Oe&&(Ft=Ai),Ut.labelStack.pop(),Ft}},w.debuggerStatementHandler=function(I){return function(){debugger;return Ai}},w.createParamNameGetter=function(I){if(I.type==="Identifier")return function(){return I.name};throw this.createInternalThrowError(Va.ParamTypeSyntaxError,I.type,I)},w.createObjectKeyGetter=function(I){var le;return I.type==="Identifier"?le=function(){return I.name}:le=this.createClosure(I),function(){return le()}},w.createMemberKeyGetter=function(I){return I.computed?this.createClosure(I.property):this.createObjectKeyGetter(I.property)},w.createObjectGetter=function(I){var le=this;switch(I.type){case"Identifier":return function(){return le.getScopeDataFromName(I.name,le.getCurrentScope())};case"MemberExpression":return this.createClosure(I.object);default:throw this.createInternalThrowError(Va.AssignmentTypeSyntaxError,I.type,I)}},w.createNameGetter=function(I){switch(I.type){case"Identifier":return function(){return I.name};case"MemberExpression":return this.createMemberKeyGetter(I);default:throw this.createInternalThrowError(Va.AssignmentTypeSyntaxError,I.type,I)}},w.varDeclaration=function(I){var le=this.collectDeclVars;le[I]=void 0},w.funcDeclaration=function(I,le){var Oe=this.collectDeclFuncs;Oe[I]=le},w.addDeclarationsToScope=function(I,le,Oe){var ct=Oe.data;for(var Ft in le){var Ut=le[Ft];ct[Ft]=Ut&&Ut()}for(var Fr in I)Fr in ct||(ct[Fr]=void 0)},w.getScopeValue=function(I,le){var Oe=this.getScopeFromName(I,le);return Oe.data[I]},w.getScopeDataFromName=function(I,le){return this.getScopeFromName(I,le).data},w.getScopeFromName=function(I,le){var Oe=le;do if(I in Oe.data)return Oe;while(Oe=Oe.parent);return this.globalScope},w.setValue=function(I){var le=this.callStack.length;return this.isVarDeclMode||le||I===Ai||I===$t||I===en||I instanceof ls||I instanceof ys||(this.value=I instanceof qo?I.value:I),I},w.getValue=function(){return this.value},m}();Ro.version=_e,Ro.eval=Xu,Ro.Function=Go,Ro.ecmaVersion=5,Ro.globalContextInFunction=void 0,Ro.global=Object.create(null);function gl(m){return m===void 0&&(m=Object.create(null)),m}function U(m,w,N){w===void 0&&(w=[]),N===void 0&&(N={});var I=N.parsingContext,le=N.timeout===void 0?0:N.timeout,Oe=`
    (function anonymous(`+w.join(",")+`){
         `+m+`
    });
    `,ct=new Ro(I,{ecmaVersion:N.ecmaVersion,timeout:le,rootContext:N.rootContext,globalContextInFunction:N.globalContextInFunction});return ct.evaluate(Oe)}function nl(m,w,N){var I=new Ro(w,N);return I.evaluate(m)}var Rl=nl,yl=function(){function m(N){this._code=N}var w=m.prototype;return w.runInContext=function(I){return nl(this._code,I)},w.runInNewContext=function(I){return nl(this._code,I)},m}(),il=function(m,w,N){return nl(m,w,N)};function nu(){for(var m=arguments.length,w=new Array(m),N=0;N<m;N++)w[N]=arguments[N];var I=w.pop();return U(I||"",w)}var Fu=il},88307:function(zr,B,S){(function(ye,C){zr.exports=C(S(18857))})(this,function(ye){"use strict";var C=function(z){return z instanceof Uint8Array||z instanceof Uint16Array||z instanceof Uint32Array||z instanceof Int8Array||z instanceof Int16Array||z instanceof Int32Array||z instanceof Float32Array||z instanceof Float64Array||z instanceof Uint8ClampedArray},d=function(z,Ie){for(var qe=Object.keys(Ie),ar=0;ar<qe.length;++ar)z[qe[ar]]=Ie[qe[ar]];return z},de=`
`;function re(z){return typeof atob!="undefined"?atob(z):"base64:"+z}function ie(z){var Ie=new Error("(regl) "+z);throw console.error(Ie),Ie}function se(z,Ie){z||ie(Ie)}function Be(z){return z?": "+z:""}function $(z,Ie,qe){z in Ie||ie("unknown parameter ("+z+")"+Be(qe)+". possible values: "+Object.keys(Ie).join())}function Je(z,Ie){C(z)||ie("invalid parameter type"+Be(Ie)+". must be a typed array")}function bt(z,Ie){switch(Ie){case"number":return typeof z=="number";case"object":return typeof z=="object";case"string":return typeof z=="string";case"boolean":return typeof z=="boolean";case"function":return typeof z=="function";case"undefined":return typeof z=="undefined";case"symbol":return typeof z=="symbol"}}function Gt(z,Ie,qe){bt(z,Ie)||ie("invalid parameter type"+Be(qe)+". expected "+Ie+", got "+typeof z)}function Ir(z,Ie){z>=0&&(z|0)===z||ie("invalid parameter type, ("+z+")"+Be(Ie)+". must be a nonnegative integer")}function Qt(z,Ie,qe){Ie.indexOf(z)<0&&ie("invalid value"+Be(qe)+". must be one of: "+Ie)}var Yt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function ir(z){Object.keys(z).forEach(function(Ie){Yt.indexOf(Ie)<0&&ie('invalid regl constructor argument "'+Ie+'". must be one of '+Yt)})}function jt(z,Ie){for(z=z+"";z.length<Ie;)z=" "+z;return z}function Tt(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Ct(z,Ie){this.number=z,this.line=Ie,this.errors=[]}function br(z,Ie,qe){this.file=z,this.line=Ie,this.message=qe}function q(){var z=new Error,Ie=(z.stack||z).toString(),qe=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(Ie);if(qe)return qe[1];var ar=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(Ie);return ar?ar[1]:"unknown"}function dr(){var z=new Error,Ie=(z.stack||z).toString(),qe=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(Ie);if(qe)return qe[1];var ar=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(Ie);return ar?ar[1]:"unknown"}function Qe(z,Ie){var qe=z.split(`
`),ar=1,Br=0,rr={unknown:new Tt,0:new Tt};rr.unknown.name=rr[0].name=Ie||q(),rr.unknown.lines.push(new Ct(0,""));for(var Mr=0;Mr<qe.length;++Mr){var Gr=qe[Mr],$r=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Gr);if($r)switch($r[1]){case"line":var tn=/(\d+)(\s+\d+)?/.exec($r[2]);tn&&(ar=tn[1]|0,tn[2]&&(Br=tn[2]|0,Br in rr||(rr[Br]=new Tt)));break;case"define":var rn=/SHADER_NAME(_B64)?\s+(.*)$/.exec($r[2]);rn&&(rr[Br].name=rn[1]?re(rn[2]):rn[2]);break}rr[Br].lines.push(new Ct(ar++,Gr))}return Object.keys(rr).forEach(function(sn){var yn=rr[sn];yn.lines.forEach(function(Qr){yn.index[Qr.number]=Qr})}),rr}function $e(z){var Ie=[];return z.split(`
`).forEach(function(qe){if(!(qe.length<5)){var ar=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(qe);ar?Ie.push(new br(ar[1]|0,ar[2]|0,ar[3].trim())):qe.length>0&&Ie.push(new br("unknown",0,qe))}}),Ie}function Rt(z,Ie){Ie.forEach(function(qe){var ar=z[qe.file];if(ar){var Br=ar.index[qe.line];if(Br){Br.errors.push(qe),ar.hasErrors=!0;return}}z.unknown.hasErrors=!0,z.unknown.lines[0].errors.push(qe)})}function Xe(z,Ie,qe,ar,Br){if(!z.getShaderParameter(Ie,z.COMPILE_STATUS)){var rr=z.getShaderInfoLog(Ie),Mr=ar===z.FRAGMENT_SHADER?"fragment":"vertex";ge(qe,"string",Mr+" shader source must be a string",Br);var Gr=Qe(qe,Br),$r=$e(rr);Rt(Gr,$r),Object.keys(Gr).forEach(function(tn){var rn=Gr[tn];if(!rn.hasErrors)return;var sn=[""],yn=[""];function Qr(un,Bt){sn.push(un),yn.push(Bt||"")}Qr("file number "+tn+": "+rn.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),rn.lines.forEach(function(un){if(un.errors.length>0){Qr(jt(un.number,4)+"|  ","background-color:yellow; font-weight:bold"),Qr(un.line+de,"color:red; background-color:yellow; font-weight:bold");var Bt=0;un.errors.forEach(function(gr){var qr=gr.message,Ln=/^\s*'(.*)'\s*:\s*(.*)$/.exec(qr);if(Ln){var Rr=Ln[1];switch(qr=Ln[2],Rr){case"assign":Rr="=";break}Bt=Math.max(un.line.indexOf(Rr,Bt),0)}else Bt=0;Qr(jt("| ",6)),Qr(jt("^^^",Bt+3)+de,"font-weight:bold"),Qr(jt("| ",6)),Qr(qr+de,"font-weight:bold")}),Qr(jt("| ",6)+de)}else Qr(jt(un.number,4)+"|  "),Qr(un.line+de,"color:red")}),typeof document!="undefined"&&!window.chrome?(yn[0]=sn.join("%c"),console.log.apply(console,yn)):console.log(sn.join(""))}),se.raise("Error compiling "+Mr+" shader, "+Gr[0].name)}}function Zt(z,Ie,qe,ar,Br){if(!z.getProgramParameter(Ie,z.LINK_STATUS)){var rr=z.getProgramInfoLog(Ie),Mr=Qe(qe,Br),Gr=Qe(ar,Br),$r='Error linking program with vertex shader, "'+Gr[0].name+'", and fragment shader "'+Mr[0].name+'"';typeof document!="undefined"?console.log("%c"+$r+de+"%c"+rr,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log($r+de+rr),se.raise($r)}}function xr(z){z._commandRef=q()}function qt(z,Ie,qe,ar){xr(z);function Br($r){return $r?ar.id($r):0}z._fragId=Br(z.static.frag),z._vertId=Br(z.static.vert);function rr($r,tn){Object.keys(tn).forEach(function(rn){$r[ar.id(rn)]=!0})}var Mr=z._uniformSet={};rr(Mr,Ie.static),rr(Mr,Ie.dynamic);var Gr=z._attributeSet={};rr(Gr,qe.static),rr(Gr,qe.dynamic),z._hasCount="count"in z.static||"count"in z.dynamic||"elements"in z.static||"elements"in z.dynamic}function Xr(z,Ie){var qe=dr();ie(z+" in command "+(Ie||q())+(qe==="unknown"?"":" called from "+qe))}function ce(z,Ie,qe){z||Xr(Ie,qe||q())}function Re(z,Ie,qe,ar){z in Ie||Xr("unknown parameter ("+z+")"+Be(qe)+". possible values: "+Object.keys(Ie).join(),ar||q())}function ge(z,Ie,qe,ar){bt(z,Ie)||Xr("invalid parameter type"+Be(qe)+". expected "+Ie+", got "+typeof z,ar||q())}function xt(z){z()}function vt(z,Ie,qe){z.texture?Qt(z.texture._texture.internalformat,Ie,"unsupported texture format for attachment"):Qt(z.renderbuffer._renderbuffer.format,qe,"unsupported renderbuffer format for attachment")}var Nt=33071,Dt=9728,Ur=9984,dn=9985,on=9986,$i=9987,or=5120,me=5121,Ae=5122,Ue=5123,Le=5124,kt=5125,nr=5126,_r=32819,Lr=32820,fr=33635,H=34042,E=36193,V={};V[or]=V[me]=1,V[Ae]=V[Ue]=V[E]=V[fr]=V[_r]=V[Lr]=2,V[Le]=V[kt]=V[nr]=V[H]=4;function Ze(z,Ie){return z===Lr||z===_r||z===fr?2:z===H?4:V[z]*Ie}function tt(z){return!(z&z-1)&&!!z}function ut(z,Ie,qe){var ar,Br=Ie.width,rr=Ie.height,Mr=Ie.channels;se(Br>0&&Br<=qe.maxTextureSize&&rr>0&&rr<=qe.maxTextureSize,"invalid texture shape"),(z.wrapS!==Nt||z.wrapT!==Nt)&&se(tt(Br)&&tt(rr),"incompatible wrap mode for texture, both width and height must be power of 2"),Ie.mipmask===1?Br!==1&&rr!==1&&se(z.minFilter!==Ur&&z.minFilter!==on&&z.minFilter!==dn&&z.minFilter!==$i,"min filter requires mipmap"):(se(tt(Br)&&tt(rr),"texture must be a square power of 2 to support mipmapping"),se(Ie.mipmask===(Br<<1)-1,"missing or incomplete mipmap data")),Ie.type===nr&&(qe.extensions.indexOf("oes_texture_float_linear")<0&&se(z.minFilter===Dt&&z.magFilter===Dt,"filter not supported, must enable oes_texture_float_linear"),se(!z.genMipmaps,"mipmap generation not supported with float textures"));var Gr=Ie.images;for(ar=0;ar<16;++ar)if(Gr[ar]){var $r=Br>>ar,tn=rr>>ar;se(Ie.mipmask&1<<ar,"missing mipmap data");var rn=Gr[ar];if(se(rn.width===$r&&rn.height===tn,"invalid shape for mip images"),se(rn.format===Ie.format&&rn.internalformat===Ie.internalformat&&rn.type===Ie.type,"incompatible type for mip image"),!rn.compressed)if(rn.data){var sn=Math.ceil(Ze(rn.type,Mr)*$r/rn.unpackAlignment)*rn.unpackAlignment;se(rn.data.byteLength===sn*tn,"invalid data for image, buffer size is inconsistent with image format")}else rn.element||rn.copy}else z.genMipmaps||se((Ie.mipmask&1<<ar)==0,"extra mipmap data");Ie.compressed&&se(!z.genMipmaps,"mipmap generation for compressed images not supported")}function wt(z,Ie,qe,ar){var Br=z.width,rr=z.height,Mr=z.channels;se(Br>0&&Br<=ar.maxTextureSize&&rr>0&&rr<=ar.maxTextureSize,"invalid texture shape"),se(Br===rr,"cube map must be square"),se(Ie.wrapS===Nt&&Ie.wrapT===Nt,"wrap mode not supported by cube map");for(var Gr=0;Gr<qe.length;++Gr){var $r=qe[Gr];se($r.width===Br&&$r.height===rr,"inconsistent cube map face shape"),Ie.genMipmaps&&(se(!$r.compressed,"can not generate mipmap for compressed textures"),se($r.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var tn=$r.images,rn=0;rn<16;++rn){var sn=tn[rn];if(sn){var yn=Br>>rn,Qr=rr>>rn;se($r.mipmask&1<<rn,"missing mipmap data"),se(sn.width===yn&&sn.height===Qr,"invalid shape for mip images"),se(sn.format===z.format&&sn.internalformat===z.internalformat&&sn.type===z.type,"incompatible type for mip image"),sn.compressed||(sn.data?se(sn.data.byteLength===yn*Qr*Math.max(Ze(sn.type,Mr),sn.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):sn.element||sn.copy)}}}}var K=d(se,{optional:xt,raise:ie,commandRaise:Xr,command:ce,parameter:$,commandParameter:Re,constructor:ir,type:Gt,commandType:ge,isTypedArray:Je,nni:Ir,oneOf:Qt,shaderError:Xe,linkError:Zt,callSite:dr,saveCommandRef:xr,saveDrawInfo:qt,framebufferFormat:vt,guessCommand:q,texture2D:ut,textureCube:wt}),Ht=0,Tr=0,Or=5,Ye=6;function lt(z,Ie){this.id=Ht++,this.type=z,this.data=Ie}function At(z){return z.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function zt(z){if(z.length===0)return[];var Ie=z.charAt(0),qe=z.charAt(z.length-1);if(z.length>1&&Ie===qe&&(Ie==='"'||Ie==="'"))return['"'+At(z.substr(1,z.length-2))+'"'];var ar=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(z);if(ar)return zt(z.substr(0,ar.index)).concat(zt(ar[1])).concat(zt(z.substr(ar.index+ar[0].length)));var Br=z.split(".");if(Br.length===1)return['"'+At(z)+'"'];for(var rr=[],Mr=0;Mr<Br.length;++Mr)rr=rr.concat(zt(Br[Mr]));return rr}function wr(z){return"["+zt(z).join("][")+"]"}function Pr(z,Ie){return new lt(z,wr(Ie+""))}function er(z){return typeof z=="function"&&!z._reglType||z instanceof lt}function Jr(z,Ie){if(typeof z=="function")return new lt(Tr,z);if(typeof z=="number"||typeof z=="boolean")return new lt(Or,z);if(Array.isArray(z))return new lt(Ye,z.map(function(qe,ar){return Jr(qe,Ie+"["+ar+"]")}));if(z instanceof lt)return z;K(!1,"invalid option type in uniform "+Ie)}var Yr={DynamicVariable:lt,define:Pr,isDynamic:er,unbox:Jr,accessor:wr},En={next:typeof requestAnimationFrame=="function"?function(z){return requestAnimationFrame(z)}:function(z){return setTimeout(z,16)},cancel:typeof cancelAnimationFrame=="function"?function(z){return cancelAnimationFrame(z)}:clearTimeout},_n=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",ei=_n?function(){return+new Date}:typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function si(){var z={"":0},Ie=[""];return{id:function(qe){var ar=z[qe];return ar||(ar=z[qe]=Ie.length,Ie.push(qe),ar)},str:function(qe){return Ie[qe]}}}function na(z,Ie,qe){var ar=document.createElement("canvas");d(ar.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),z.appendChild(ar),z===document.body&&(ar.style.position="absolute",d(z.style,{margin:0,padding:0}));function Br(){var Gr=window.innerWidth,$r=window.innerHeight;if(z!==document.body){var tn=ar.getBoundingClientRect();Gr=tn.right-tn.left,$r=tn.bottom-tn.top}ar.width=qe*Gr,ar.height=qe*$r}var rr;z!==document.body&&typeof ResizeObserver=="function"?(rr=new ResizeObserver(function(){setTimeout(Br)}),rr.observe(z)):window.addEventListener("resize",Br,!1);function Mr(){rr?rr.disconnect():window.removeEventListener("resize",Br),z.removeChild(ar)}return Br(),{canvas:ar,onDestroy:Mr}}function Zi(z,Ie){function qe(ar){try{return z.getContext(ar,Ie)}catch(Br){return null}}return qe("webgl")||qe("experimental-webgl")||qe("webgl-experimental")}function Pi(z){return typeof z.nodeName=="string"&&typeof z.appendChild=="function"&&typeof z.getBoundingClientRect=="function"}function X(z){return typeof z.drawArrays=="function"||typeof z.drawElements=="function"}function ue(z){return typeof z=="string"?z.split():(K(Array.isArray(z),"invalid extension array"),z)}function pe(z){return typeof z=="string"?(K(typeof document!="undefined","not supported outside of DOM"),document.querySelector(z)):z}function F(z){var Ie=z||{},qe,ar,Br,rr,Mr={},Gr=[],$r=[],tn=typeof window=="undefined"?1:window.devicePixelRatio,rn=!1,sn=function(un){un&&K.raise(un)},yn=function(){};if(typeof Ie=="string"?(K(typeof document!="undefined","selector queries only supported in DOM environments"),qe=document.querySelector(Ie),K(qe,"invalid query string for element")):typeof Ie=="object"?Pi(Ie)?qe=Ie:X(Ie)?(rr=Ie,Br=rr.canvas):(K.constructor(Ie),"gl"in Ie?rr=Ie.gl:"canvas"in Ie?Br=pe(Ie.canvas):"container"in Ie&&(ar=pe(Ie.container)),"attributes"in Ie&&(Mr=Ie.attributes,K.type(Mr,"object","invalid context attributes")),"extensions"in Ie&&(Gr=ue(Ie.extensions)),"optionalExtensions"in Ie&&($r=ue(Ie.optionalExtensions)),"onDone"in Ie&&(K.type(Ie.onDone,"function","invalid or missing onDone callback"),sn=Ie.onDone),"profile"in Ie&&(rn=!!Ie.profile),"pixelRatio"in Ie&&(tn=+Ie.pixelRatio,K(tn>0,"invalid pixel ratio"))):K.raise("invalid arguments to regl"),qe&&(qe.nodeName.toLowerCase()==="canvas"?Br=qe:ar=qe),!rr){if(!Br){K(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Qr=na(ar||document.body,sn,tn);if(!Qr)return null;Br=Qr.canvas,yn=Qr.onDestroy}Mr.premultipliedAlpha===void 0&&(Mr.premultipliedAlpha=!0),rr=Zi(Br,Mr)}return rr?{gl:rr,canvas:Br,container:ar,extensions:Gr,optionalExtensions:$r,pixelRatio:tn,profile:rn,onDone:sn,onDestroy:yn}:(yn(),sn("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function ee(z,Ie){var qe={};function ar(Gr){K.type(Gr,"string","extension name must be string");var $r=Gr.toLowerCase(),tn;try{tn=qe[$r]=Br(Gr)}catch(rn){}return!!tn}function Br(Gr){return z.getExtension(Gr)?z.getExtension(Gr):z.getExtension(Gr.toLowerCase())?z.getExtension(Gr.toLowerCase()):null}for(var rr=0;rr<Ie.extensions.length;++rr){var Mr=Ie.extensions[rr];if(!ar(Mr))return Ie.onDestroy(),Ie.onDone('"'+Mr+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return Ie.optionalExtensions.forEach(ar),{extensions:qe,restore:function(){Object.keys(qe).forEach(function(Gr){if(qe[Gr]&&!ar(Gr))throw new Error("(regl): error restoring extension "+Gr)})}}}function he(z,Ie){for(var qe=Array(z),ar=0;ar<z;++ar)qe[ar]=Ie(ar);return qe}var Te=5120,ae=5121,Ee=5122,mt=5123,Sr=5124,Wt=5125,Ke=5126;function Zr(z){for(var Ie=16;Ie<=1<<28;Ie*=16)if(z<=Ie)return Ie;return 0}function kn(z){var Ie,qe;return Ie=(z>65535)<<4,z>>>=Ie,qe=(z>255)<<3,z>>>=qe,Ie|=qe,qe=(z>15)<<2,z>>>=qe,Ie|=qe,qe=(z>3)<<1,z>>>=qe,Ie|=qe,Ie|z>>1}function Rn(){var z=he(8,function(){return[]});function Ie(rr){var Mr=Zr(rr),Gr=z[kn(Mr)>>2];return Gr.length>0?Gr.pop():new ArrayBuffer(Mr)}function qe(rr){z[kn(rr.byteLength)>>2].push(rr)}function ar(rr,Mr){var Gr=null;switch(rr){case Te:Gr=new Int8Array(Ie(Mr),0,Mr);break;case ae:Gr=new Uint8Array(Ie(Mr),0,Mr);break;case Ee:Gr=new Int16Array(Ie(2*Mr),0,Mr);break;case mt:Gr=new Uint16Array(Ie(2*Mr),0,Mr);break;case Sr:Gr=new Int32Array(Ie(4*Mr),0,Mr);break;case Wt:Gr=new Uint32Array(Ie(4*Mr),0,Mr);break;case Ke:Gr=new Float32Array(Ie(4*Mr),0,Mr);break;default:return null}return Gr.length!==Mr?Gr.subarray(0,Mr):Gr}function Br(rr){qe(rr.buffer)}return{alloc:Ie,free:qe,allocType:ar,freeType:Br}}var ft=Rn();ft.zero=Rn();var vr=3408,et=3410,Dr=3411,In=3412,tr=3413,Ni=3414,ia=3415,hi=33901,Fi=33902,Wi=3379,yi=3386,ya=34921,La=36347,_i=36348,Mi=35661,Ji=35660,to=34930,jo=36349,ja=34076,Xi=34024,du=7936,ku=7937,Ba=7938,Vo=35724,Yi=34047,ro=36063,Jo=34852,xa=3553,Lo=34067,No=34069,Us=33984,_o=6408,Qo=5126,Va=5121,uo=36160,ss=36053,Co=36064,_e=16384,De=function(z,Ie){var qe=1;Ie.ext_texture_filter_anisotropic&&(qe=z.getParameter(Yi));var ar=1,Br=1;Ie.webgl_draw_buffers&&(ar=z.getParameter(Jo),Br=z.getParameter(ro));var rr=!!Ie.oes_texture_float;if(rr){var Mr=z.createTexture();z.bindTexture(xa,Mr),z.texImage2D(xa,0,_o,1,1,0,_o,Qo,null);var Gr=z.createFramebuffer();if(z.bindFramebuffer(uo,Gr),z.framebufferTexture2D(uo,Co,xa,Mr,0),z.bindTexture(xa,null),z.checkFramebufferStatus(uo)!==ss)rr=!1;else{z.viewport(0,0,1,1),z.clearColor(1,0,0,1),z.clear(_e);var $r=ft.allocType(Qo,4);z.readPixels(0,0,1,1,_o,Qo,$r),z.getError()?rr=!1:(z.deleteFramebuffer(Gr),z.deleteTexture(Mr),rr=$r[0]===1),ft.freeType($r)}}var tn=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),rn=!0;if(!tn){var sn=z.createTexture(),yn=ft.allocType(Va,36);z.activeTexture(Us),z.bindTexture(Lo,sn),z.texImage2D(No,0,_o,3,3,0,_o,Va,yn),ft.freeType(yn),z.bindTexture(Lo,null),z.deleteTexture(sn),rn=!z.getError()}return{colorBits:[z.getParameter(et),z.getParameter(Dr),z.getParameter(In),z.getParameter(tr)],depthBits:z.getParameter(Ni),stencilBits:z.getParameter(ia),subpixelBits:z.getParameter(vr),extensions:Object.keys(Ie).filter(function(Qr){return!!Ie[Qr]}),maxAnisotropic:qe,maxDrawbuffers:ar,maxColorAttachments:Br,pointSizeDims:z.getParameter(hi),lineWidthDims:z.getParameter(Fi),maxViewportDims:z.getParameter(yi),maxCombinedTextureUnits:z.getParameter(Mi),maxCubeMapSize:z.getParameter(ja),maxRenderbufferSize:z.getParameter(Xi),maxTextureUnits:z.getParameter(to),maxTextureSize:z.getParameter(Wi),maxAttributes:z.getParameter(ya),maxVertexUniforms:z.getParameter(La),maxVertexTextureUnits:z.getParameter(Ji),maxVaryingVectors:z.getParameter(_i),maxFragmentUniforms:z.getParameter(jo),glsl:z.getParameter(Vo),renderer:z.getParameter(ku),vendor:z.getParameter(du),version:z.getParameter(Ba),readFloat:rr,npotTextureCube:rn}};function pt(z){return!!z&&typeof z=="object"&&Array.isArray(z.shape)&&Array.isArray(z.stride)&&typeof z.offset=="number"&&z.shape.length===z.stride.length&&(Array.isArray(z.data)||C(z.data))}var $t=function(z){return Object.keys(z).map(function(Ie){return z[Ie]})},en={shape:us,flatten:po};function ti(z,Ie,qe){for(var ar=0;ar<Ie;++ar)qe[ar]=z[ar]}function Ai(z,Ie,qe,ar){for(var Br=0,rr=0;rr<Ie;++rr)for(var Mr=z[rr],Gr=0;Gr<qe;++Gr)ar[Br++]=Mr[Gr]}function ha(z,Ie,qe,ar,Br,rr){for(var Mr=rr,Gr=0;Gr<Ie;++Gr)for(var $r=z[Gr],tn=0;tn<qe;++tn)for(var rn=$r[tn],sn=0;sn<ar;++sn)Br[Mr++]=rn[sn]}function Na(z,Ie,qe,ar,Br){for(var rr=1,Mr=qe+1;Mr<Ie.length;++Mr)rr*=Ie[Mr];var Gr=Ie[qe];if(Ie.length-qe==4){var $r=Ie[qe+1],tn=Ie[qe+2],rn=Ie[qe+3];for(Mr=0;Mr<Gr;++Mr)ha(z[Mr],$r,tn,rn,ar,Br),Br+=rr}else for(Mr=0;Mr<Gr;++Mr)Na(z[Mr],Ie,qe+1,ar,Br),Br+=rr}function po(z,Ie,qe,ar){var Br=1;if(Ie.length)for(var rr=0;rr<Ie.length;++rr)Br*=Ie[rr];else Br=0;var Mr=ar||ft.allocType(qe,Br);switch(Ie.length){case 0:break;case 1:ti(z,Ie[0],Mr);break;case 2:Ai(z,Ie[0],Ie[1],Mr);break;case 3:ha(z,Ie[0],Ie[1],Ie[2],Mr,0);break;default:Na(z,Ie,0,Mr,0)}return Mr}function us(z){for(var Ie=[],qe=z;qe.length;qe=qe[0])Ie.push(qe.length);return Ie}var vu={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Au=5120,Xu=5122,Go=5124,qo=5121,ls=5123,ys=5125,Ho=5126,Ws=5126,ru={int8:Au,int16:Xu,int32:Go,uint8:qo,uint16:ls,uint32:ys,float:Ho,float32:Ws},Is=35048,Ta=35040,Ro={dynamic:Is,stream:Ta,static:35044},gl=en.flatten,U=en.shape,nl=35044,Rl=35040,yl=5121,il=5126,nu=[];nu[5120]=1,nu[5122]=2,nu[5124]=4,nu[5121]=1,nu[5123]=2,nu[5125]=4,nu[5126]=4;function Fu(z){return vu[Object.prototype.toString.call(z)]|0}function m(z,Ie){for(var qe=0;qe<Ie.length;++qe)z[qe]=Ie[qe]}function w(z,Ie,qe,ar,Br,rr,Mr){for(var Gr=0,$r=0;$r<qe;++$r)for(var tn=0;tn<ar;++tn)z[Gr++]=Ie[Br*$r+rr*tn+Mr]}function N(z,Ie,qe,ar){var Br=0,rr={};function Mr(Bt){this.id=Br++,this.buffer=z.createBuffer(),this.type=Bt,this.usage=nl,this.byteLength=0,this.dimension=1,this.dtype=yl,this.persistentData=null,qe.profile&&(this.stats={size:0})}Mr.prototype.bind=function(){z.bindBuffer(this.type,this.buffer)},Mr.prototype.destroy=function(){yn(this)};var Gr=[];function $r(Bt,gr){var qr=Gr.pop();return qr||(qr=new Mr(Bt)),qr.bind(),sn(qr,gr,Rl,0,1,!1),qr}function tn(Bt){Gr.push(Bt)}function rn(Bt,gr,qr){Bt.byteLength=gr.byteLength,z.bufferData(Bt.type,gr,qr)}function sn(Bt,gr,qr,Ln,Rr,wn){var cn;if(Bt.usage=qr,Array.isArray(gr)){if(Bt.dtype=Ln||il,gr.length>0){var pi;if(Array.isArray(gr[0])){cn=U(gr);for(var kr=1,Ar=1;Ar<cn.length;++Ar)kr*=cn[Ar];Bt.dimension=kr,pi=gl(gr,cn,Bt.dtype),rn(Bt,pi,qr),wn?Bt.persistentData=pi:ft.freeType(pi)}else if(typeof gr[0]=="number"){Bt.dimension=Rr;var Kn=ft.allocType(Bt.dtype,gr.length);m(Kn,gr),rn(Bt,Kn,qr),wn?Bt.persistentData=Kn:ft.freeType(Kn)}else C(gr[0])?(Bt.dimension=gr[0].length,Bt.dtype=Ln||Fu(gr[0])||il,pi=gl(gr,[gr.length,gr[0].length],Bt.dtype),rn(Bt,pi,qr),wn?Bt.persistentData=pi:ft.freeType(pi)):K.raise("invalid buffer data")}}else if(C(gr))Bt.dtype=Ln||Fu(gr),Bt.dimension=Rr,rn(Bt,gr,qr),wn&&(Bt.persistentData=new Uint8Array(new Uint8Array(gr.buffer)));else if(pt(gr)){cn=gr.shape;var bn=gr.stride,an=gr.offset,An=0,Tn=0,ji=0,Bi=0;cn.length===1?(An=cn[0],Tn=1,ji=bn[0],Bi=0):cn.length===2?(An=cn[0],Tn=cn[1],ji=bn[0],Bi=bn[1]):K.raise("invalid shape"),Bt.dtype=Ln||Fu(gr.data)||il,Bt.dimension=Tn;var Mn=ft.allocType(Bt.dtype,An*Tn);w(Mn,gr.data,An,Tn,ji,Bi,an),rn(Bt,Mn,qr),wn?Bt.persistentData=Mn:ft.freeType(Mn)}else gr instanceof ArrayBuffer?(Bt.dtype=yl,Bt.dimension=Rr,rn(Bt,gr,qr),wn&&(Bt.persistentData=new Uint8Array(new Uint8Array(gr)))):K.raise("invalid buffer data")}function yn(Bt){Ie.bufferCount--,ar(Bt);var gr=Bt.buffer;K(gr,"buffer must not be deleted already"),z.deleteBuffer(gr),Bt.buffer=null,delete rr[Bt.id]}function Qr(Bt,gr,qr,Ln){Ie.bufferCount++;var Rr=new Mr(gr);rr[Rr.id]=Rr;function wn(kr){var Ar=nl,Kn=null,bn=0,an=0,An=1;return Array.isArray(kr)||C(kr)||pt(kr)||kr instanceof ArrayBuffer?Kn=kr:typeof kr=="number"?bn=kr|0:kr&&(K.type(kr,"object","buffer arguments must be an object, a number or an array"),"data"in kr&&(K(Kn===null||Array.isArray(Kn)||C(Kn)||pt(Kn),"invalid data for buffer"),Kn=kr.data),"usage"in kr&&(K.parameter(kr.usage,Ro,"invalid buffer usage"),Ar=Ro[kr.usage]),"type"in kr&&(K.parameter(kr.type,ru,"invalid buffer type"),an=ru[kr.type]),"dimension"in kr&&(K.type(kr.dimension,"number","invalid dimension"),An=kr.dimension|0),"length"in kr&&(K.nni(bn,"buffer length must be a nonnegative integer"),bn=kr.length|0)),Rr.bind(),Kn?sn(Rr,Kn,Ar,an,An,Ln):(bn&&z.bufferData(Rr.type,bn,Ar),Rr.dtype=an||yl,Rr.usage=Ar,Rr.dimension=An,Rr.byteLength=bn),qe.profile&&(Rr.stats.size=Rr.byteLength*nu[Rr.dtype]),wn}function cn(kr,Ar){K(Ar+kr.byteLength<=Rr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+kr.byteLength+" starting from offset "+Ar+" to a buffer of size "+Rr.byteLength),z.bufferSubData(Rr.type,Ar,kr)}function pi(kr,Ar){var Kn=(Ar||0)|0,bn;if(Rr.bind(),C(kr)||kr instanceof ArrayBuffer)cn(kr,Kn);else if(Array.isArray(kr)){if(kr.length>0)if(typeof kr[0]=="number"){var an=ft.allocType(Rr.dtype,kr.length);m(an,kr),cn(an,Kn),ft.freeType(an)}else if(Array.isArray(kr[0])||C(kr[0])){bn=U(kr);var An=gl(kr,bn,Rr.dtype);cn(An,Kn),ft.freeType(An)}else K.raise("invalid buffer data")}else if(pt(kr)){bn=kr.shape;var Tn=kr.stride,ji=0,Bi=0,Mn=0,Pn=0;bn.length===1?(ji=bn[0],Bi=1,Mn=Tn[0],Pn=0):bn.length===2?(ji=bn[0],Bi=bn[1],Mn=Tn[0],Pn=Tn[1]):K.raise("invalid shape");var wi=Array.isArray(kr.data)?Rr.dtype:Fu(kr.data),Di=ft.allocType(wi,ji*Bi);w(Di,kr.data,ji,Bi,Mn,Pn,kr.offset),cn(Di,Kn),ft.freeType(Di)}else K.raise("invalid data for buffer subdata");return wn}return qr||wn(Bt),wn._reglType="buffer",wn._buffer=Rr,wn.subdata=pi,qe.profile&&(wn.stats=Rr.stats),wn.destroy=function(){yn(Rr)},wn}function un(){$t(rr).forEach(function(Bt){Bt.buffer=z.createBuffer(),z.bindBuffer(Bt.type,Bt.buffer),z.bufferData(Bt.type,Bt.persistentData||Bt.byteLength,Bt.usage)})}return qe.profile&&(Ie.getTotalBufferSize=function(){var Bt=0;return Object.keys(rr).forEach(function(gr){Bt+=rr[gr].stats.size}),Bt}),{create:Qr,createStream:$r,destroyStream:tn,clear:function(){$t(rr).forEach(yn),Gr.forEach(yn)},getBuffer:function(Bt){return Bt&&Bt._buffer instanceof Mr?Bt._buffer:null},restore:un,_initBuffer:sn}}var I=0,le=0,Oe=1,ct=1,Ft=4,Ut=4,Fr={points:I,point:le,lines:Oe,line:ct,triangles:Ft,triangle:Ut,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},Kr=0,ni=1,Ii=4,bi=5120,pa=5121,Pa=5122,za=5123,Ti=5124,_s=5125,iu=34963,Bu=35040,tc=35044;function Yu(z,Ie,qe,ar){var Br={},rr=0,Mr={uint8:pa,uint16:za};Ie.oes_element_index_uint&&(Mr.uint32=_s);function Gr(un){this.id=rr++,Br[this.id]=this,this.buffer=un,this.primType=Ii,this.vertCount=0,this.type=0}Gr.prototype.bind=function(){this.buffer.bind()};var $r=[];function tn(un){var Bt=$r.pop();return Bt||(Bt=new Gr(qe.create(null,iu,!0,!1)._buffer)),sn(Bt,un,Bu,-1,-1,0,0),Bt}function rn(un){$r.push(un)}function sn(un,Bt,gr,qr,Ln,Rr,wn){un.buffer.bind();var cn;if(Bt){var pi=wn;!wn&&(!C(Bt)||pt(Bt)&&!C(Bt.data))&&(pi=Ie.oes_element_index_uint?_s:za),qe._initBuffer(un.buffer,Bt,gr,pi,3)}else z.bufferData(iu,Rr,gr),un.buffer.dtype=cn||pa,un.buffer.usage=gr,un.buffer.dimension=3,un.buffer.byteLength=Rr;if(cn=wn,!wn){switch(un.buffer.dtype){case pa:case bi:cn=pa;break;case za:case Pa:cn=za;break;case _s:case Ti:cn=_s;break;default:K.raise("unsupported type for element array")}un.buffer.dtype=cn}un.type=cn,K(cn!==_s||!!Ie.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var kr=Ln;kr<0&&(kr=un.buffer.byteLength,cn===za?kr>>=1:cn===_s&&(kr>>=2)),un.vertCount=kr;var Ar=qr;if(qr<0){Ar=Ii;var Kn=un.buffer.dimension;Kn===1&&(Ar=Kr),Kn===2&&(Ar=ni),Kn===3&&(Ar=Ii)}un.primType=Ar}function yn(un){ar.elementsCount--,K(un.buffer!==null,"must not double destroy elements"),delete Br[un.id],un.buffer.destroy(),un.buffer=null}function Qr(un,Bt){var gr=qe.create(null,iu,!0),qr=new Gr(gr._buffer);ar.elementsCount++;function Ln(Rr){if(!Rr)gr(),qr.primType=Ii,qr.vertCount=0,qr.type=pa;else if(typeof Rr=="number")gr(Rr),qr.primType=Ii,qr.vertCount=Rr|0,qr.type=pa;else{var wn=null,cn=tc,pi=-1,kr=-1,Ar=0,Kn=0;Array.isArray(Rr)||C(Rr)||pt(Rr)?wn=Rr:(K.type(Rr,"object","invalid arguments for elements"),"data"in Rr&&(wn=Rr.data,K(Array.isArray(wn)||C(wn)||pt(wn),"invalid data for element buffer")),"usage"in Rr&&(K.parameter(Rr.usage,Ro,"invalid element buffer usage"),cn=Ro[Rr.usage]),"primitive"in Rr&&(K.parameter(Rr.primitive,Fr,"invalid element buffer primitive"),pi=Fr[Rr.primitive]),"count"in Rr&&(K(typeof Rr.count=="number"&&Rr.count>=0,"invalid vertex count for elements"),kr=Rr.count|0),"type"in Rr&&(K.parameter(Rr.type,Mr,"invalid buffer type"),Kn=Mr[Rr.type]),"length"in Rr?Ar=Rr.length|0:(Ar=kr,Kn===za||Kn===Pa?Ar*=2:(Kn===_s||Kn===Ti)&&(Ar*=4))),sn(qr,wn,cn,pi,kr,Ar,Kn)}return Ln}return Ln(un),Ln._reglType="elements",Ln._elements=qr,Ln.subdata=function(Rr,wn){return gr.subdata(Rr,wn),Ln},Ln.destroy=function(){yn(qr)},Ln}return{create:Qr,createStream:tn,destroyStream:rn,getElements:function(un){return typeof un=="function"&&un._elements instanceof Gr?un._elements:null},clear:function(){$t(Br).forEach(yn)}}}var rc=new Float32Array(1),mu=new Uint32Array(rc.buffer),gu=5123;function Tu(z){for(var Ie=ft.allocType(gu,z.length),qe=0;qe<z.length;++qe)if(isNaN(z[qe]))Ie[qe]=65535;else if(z[qe]===Infinity)Ie[qe]=31744;else if(z[qe]===-Infinity)Ie[qe]=64512;else{rc[0]=z[qe];var ar=mu[0],Br=ar>>>31<<15,rr=(ar<<1>>>24)-127,Mr=ar>>13&(1<<10)-1;if(rr<-24)Ie[qe]=Br;else if(rr<-14){var Gr=-14-rr;Ie[qe]=Br+(Mr+(1<<10)>>Gr)}else rr>15?Ie[qe]=Br+31744:Ie[qe]=Br+(rr+15<<10)+Mr}return Ie}function xo(z){return Array.isArray(z)||C(z)}var nc=function(z){return!(z&z-1)&&!!z},yc=34467,cs=3553,ic=34067,Xs=34069,sa=6408,_c=6406,al=6407,Ga=6409,_l=6410,Nu=32854,yu=32855,_u=36194,au=32819,xl=32820,xu=33635,Ys=34042,Pu=6402,Os=34041,ou=35904,wo=35906,Ls=36193,xs=33776,Rs=33777,xc=33778,ac=33779,oc=35986,ol=35987,Dl=34798,kl=35840,sc=35841,uc=35842,Qc=35843,Fl=36196,Ks=5121,sl=5123,zu=5125,Ku=5126,bc=10242,lc=10243,Sc=10497,Zu=33071,kc=33648,ul=10240,lo=10241,Bl=9728,ll=9729,Ds=9984,ua=9985,Ha=9986,fs=9987,bl=33170,$u=4352,Nl=4353,Fc=4354,gf=34046,Ju=3317,bo=37440,Qa=37441,Do=37443,bs=37444,Sl=33984,To=[Ds,Ha,ua,fs],Cn=[0,Ga,_l,al,sa],no={};no[Ga]=no[_c]=no[Pu]=1,no[Os]=no[_l]=2,no[al]=no[ou]=3,no[sa]=no[wo]=4;function Mu(z){return"[object "+z+"]"}var cl=Mu("HTMLCanvasElement"),su=Mu("OffscreenCanvas"),ko=Mu("CanvasRenderingContext2D"),cc=Mu("ImageBitmap"),xn=Mu("HTMLImageElement"),Wa=Mu("HTMLVideoElement"),Ec=Object.keys(vu).concat([cl,su,ko,cc,xn,Wa]),js=[];js[Ks]=1,js[Ku]=4,js[Ls]=2,js[sl]=2,js[zu]=4;var qa=[];qa[Nu]=2,qa[yu]=2,qa[_u]=2,qa[Os]=4,qa[xs]=.5,qa[Rs]=.5,qa[xc]=1,qa[ac]=1,qa[oc]=.5,qa[ol]=1,qa[Dl]=1,qa[kl]=.5,qa[sc]=.25,qa[uc]=.5,qa[Qc]=.25,qa[Fl]=.5;function Ya(z){return Array.isArray(z)&&(z.length===0||typeof z[0]=="number")}function zl(z){if(!Array.isArray(z))return!1;var Ie=z.length;return!(Ie===0||!xo(z[0]))}function bu(z){return Object.prototype.toString.call(z)}function ks(z){return bu(z)===cl}function Uu(z){return bu(z)===su}function Bc(z){return bu(z)===ko}function Zl(z){return bu(z)===cc}function El(z){return bu(z)===xn}function fc(z){return bu(z)===Wa}function Vs(z){var Ie=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return!!(Ie&&z&&z.getContext)}function Fs(z){if(!z)return!1;if(Vs(z))return!0;var Ie=bu(z);return Ec.indexOf(Ie)>=0?!0:Ya(z)||zl(z)||pt(z)}function ea(z){return vu[Object.prototype.toString.call(z)]|0}function Iu(z,Ie){var qe=Ie.length;switch(z.type){case Ks:case sl:case zu:case Ku:var ar=ft.allocType(z.type,qe);ar.set(Ie),z.data=ar;break;case Ls:z.data=Tu(Ie);break;default:K.raise("unsupported texture type, must specify a typed array")}}function $s(z,Ie){return ft.allocType(z.type===Ls?Ku:z.type,Ie)}function Ra(z,Ie){z.type===Ls?(z.data=Tu(Ie),ft.freeType(Ie)):z.data=Ie}function Cl(z,Ie,qe,ar,Br,rr){for(var Mr=z.width,Gr=z.height,$r=z.channels,tn=Mr*Gr*$r,rn=$s(z,tn),sn=0,yn=0;yn<Gr;++yn)for(var Qr=0;Qr<Mr;++Qr)for(var un=0;un<$r;++un)rn[sn++]=Ie[qe*Qr+ar*yn+Br*un+rr];Ra(z,rn)}function Su(z,Ie,qe,ar,Br,rr){var Mr;if(typeof qa[z]!="undefined"?Mr=qa[z]:Mr=no[z]*js[Ie],rr&&(Mr*=6),Br){for(var Gr=0,$r=qe;$r>=1;)Gr+=Mr*$r*$r,$r/=2;return Gr}else return Mr*qe*ar}function uu(z,Ie,qe,ar,Br,rr,Mr){var Gr={"don't care":$u,"dont care":$u,nice:Fc,fast:Nl},$r={repeat:Sc,clamp:Zu,mirror:kc},tn={nearest:Bl,linear:ll},rn=d({mipmap:fs,"nearest mipmap nearest":Ds,"linear mipmap nearest":ua,"nearest mipmap linear":Ha,"linear mipmap linear":fs},tn),sn={none:0,browser:bs},yn={uint8:Ks,rgba4:au,rgb565:xu,"rgb5 a1":xl},Qr={alpha:_c,luminance:Ga,"luminance alpha":_l,rgb:al,rgba:sa,rgba4:Nu,"rgb5 a1":yu,rgb565:_u},un={};Ie.ext_srgb&&(Qr.srgb=ou,Qr.srgba=wo),Ie.oes_texture_float&&(yn.float32=yn.float=Ku),Ie.oes_texture_half_float&&(yn.float16=yn["half float"]=Ls),Ie.webgl_depth_texture&&(d(Qr,{depth:Pu,"depth stencil":Os}),d(yn,{uint16:sl,uint32:zu,"depth stencil":Ys})),Ie.webgl_compressed_texture_s3tc&&d(un,{"rgb s3tc dxt1":xs,"rgba s3tc dxt1":Rs,"rgba s3tc dxt3":xc,"rgba s3tc dxt5":ac}),Ie.webgl_compressed_texture_atc&&d(un,{"rgb atc":oc,"rgba atc explicit alpha":ol,"rgba atc interpolated alpha":Dl}),Ie.webgl_compressed_texture_pvrtc&&d(un,{"rgb pvrtc 4bppv1":kl,"rgb pvrtc 2bppv1":sc,"rgba pvrtc 4bppv1":uc,"rgba pvrtc 2bppv1":Qc}),Ie.webgl_compressed_texture_etc1&&(un["rgb etc1"]=Fl);var Bt=Array.prototype.slice.call(z.getParameter(yc)||new Uint32Array(0));Object.keys(un).forEach(function(Ge){var cr=un[Ge];Bt.indexOf(cr)>=0&&(Qr[Ge]=cr)});var gr=Object.keys(Qr);qe.textureFormats=gr;var qr=[];Object.keys(Qr).forEach(function(Ge){var cr=Qr[Ge];qr[cr]=Ge});var Ln=[];Object.keys(yn).forEach(function(Ge){var cr=yn[Ge];Ln[cr]=Ge});var Rr=[];Object.keys(tn).forEach(function(Ge){var cr=tn[Ge];Rr[cr]=Ge});var wn=[];Object.keys(rn).forEach(function(Ge){var cr=rn[Ge];wn[cr]=Ge});var cn=[];Object.keys($r).forEach(function(Ge){var cr=$r[Ge];cn[cr]=Ge});var pi=gr.reduce(function(Ge,cr){var Jt=Qr[cr];return Jt===Ga||Jt===_c||Jt===Ga||Jt===_l||Jt===Pu||Jt===Os||Ie.ext_srgb&&(Jt===ou||Jt===wo)?Ge[Jt]=Jt:Jt===yu||cr.indexOf("rgba")>=0?Ge[Jt]=sa:Ge[Jt]=al,Ge},{});function kr(){this.internalformat=sa,this.format=sa,this.type=Ks,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=bs,this.width=0,this.height=0,this.channels=0}function Ar(Ge,cr){Ge.internalformat=cr.internalformat,Ge.format=cr.format,Ge.type=cr.type,Ge.compressed=cr.compressed,Ge.premultiplyAlpha=cr.premultiplyAlpha,Ge.flipY=cr.flipY,Ge.unpackAlignment=cr.unpackAlignment,Ge.colorSpace=cr.colorSpace,Ge.width=cr.width,Ge.height=cr.height,Ge.channels=cr.channels}function Kn(Ge,cr){if(!(typeof cr!="object"||!cr)){if("premultiplyAlpha"in cr&&(K.type(cr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),Ge.premultiplyAlpha=cr.premultiplyAlpha),"flipY"in cr&&(K.type(cr.flipY,"boolean","invalid texture flip"),Ge.flipY=cr.flipY),"alignment"in cr&&(K.oneOf(cr.alignment,[1,2,4,8],"invalid texture unpack alignment"),Ge.unpackAlignment=cr.alignment),"colorSpace"in cr&&(K.parameter(cr.colorSpace,sn,"invalid colorSpace"),Ge.colorSpace=sn[cr.colorSpace]),"type"in cr){var Jt=cr.type;K(Ie.oes_texture_float||!(Jt==="float"||Jt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),K(Ie.oes_texture_half_float||!(Jt==="half float"||Jt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),K(Ie.webgl_depth_texture||!(Jt==="uint16"||Jt==="uint32"||Jt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),K.parameter(Jt,yn,"invalid texture type"),Ge.type=yn[Jt]}var Fn=Ge.width,fa=Ge.height,ke=Ge.channels,Se=!1;"shape"in cr?(K(Array.isArray(cr.shape)&&cr.shape.length>=2,"shape must be an array"),Fn=cr.shape[0],fa=cr.shape[1],cr.shape.length===3&&(ke=cr.shape[2],K(ke>0&&ke<=4,"invalid number of channels"),Se=!0),K(Fn>=0&&Fn<=qe.maxTextureSize,"invalid width"),K(fa>=0&&fa<=qe.maxTextureSize,"invalid height")):("radius"in cr&&(Fn=fa=cr.radius,K(Fn>=0&&Fn<=qe.maxTextureSize,"invalid radius")),"width"in cr&&(Fn=cr.width,K(Fn>=0&&Fn<=qe.maxTextureSize,"invalid width")),"height"in cr&&(fa=cr.height,K(fa>=0&&fa<=qe.maxTextureSize,"invalid height")),"channels"in cr&&(ke=cr.channels,K(ke>0&&ke<=4,"invalid number of channels"),Se=!0)),Ge.width=Fn|0,Ge.height=fa|0,Ge.channels=ke|0;var it=!1;if("format"in cr){var Ot=cr.format;K(Ie.webgl_depth_texture||!(Ot==="depth"||Ot==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),K.parameter(Ot,Qr,"invalid texture format");var sr=Ge.internalformat=Qr[Ot];Ge.format=pi[sr],Ot in yn&&("type"in cr||(Ge.type=yn[Ot])),Ot in un&&(Ge.compressed=!0),it=!0}!Se&&it?Ge.channels=no[Ge.format]:Se&&!it?Ge.channels!==Cn[Ge.format]&&(Ge.format=Ge.internalformat=Cn[Ge.channels]):it&&Se&&K(Ge.channels===no[Ge.format],"number of channels inconsistent with specified format")}}function bn(Ge){z.pixelStorei(bo,Ge.flipY),z.pixelStorei(Qa,Ge.premultiplyAlpha),z.pixelStorei(Do,Ge.colorSpace),z.pixelStorei(Ju,Ge.unpackAlignment)}function an(){kr.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function An(Ge,cr){var Jt=null;if(Fs(cr)?Jt=cr:cr&&(K.type(cr,"object","invalid pixel data type"),Kn(Ge,cr),"x"in cr&&(Ge.xOffset=cr.x|0),"y"in cr&&(Ge.yOffset=cr.y|0),Fs(cr.data)&&(Jt=cr.data)),K(!Ge.compressed||Jt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),cr.copy){K(!Jt,"can not specify copy and data field for the same texture");var Fn=Br.viewportWidth,fa=Br.viewportHeight;Ge.width=Ge.width||Fn-Ge.xOffset,Ge.height=Ge.height||fa-Ge.yOffset,Ge.needsCopy=!0,K(Ge.xOffset>=0&&Ge.xOffset<Fn&&Ge.yOffset>=0&&Ge.yOffset<fa&&Ge.width>0&&Ge.width<=Fn&&Ge.height>0&&Ge.height<=fa,"copy texture read out of bounds")}else if(!Jt)Ge.width=Ge.width||1,Ge.height=Ge.height||1,Ge.channels=Ge.channels||4;else if(C(Jt))Ge.channels=Ge.channels||4,Ge.data=Jt,!("type"in cr)&&Ge.type===Ks&&(Ge.type=ea(Jt));else if(Ya(Jt))Ge.channels=Ge.channels||4,Iu(Ge,Jt),Ge.alignment=1,Ge.needsFree=!0;else if(pt(Jt)){var ke=Jt.data;!Array.isArray(ke)&&Ge.type===Ks&&(Ge.type=ea(ke));var Se=Jt.shape,it=Jt.stride,Ot,sr,_t,dt,st,Me;Se.length===3?(_t=Se[2],Me=it[2]):(K(Se.length===2,"invalid ndarray pixel data, must be 2 or 3D"),_t=1,Me=1),Ot=Se[0],sr=Se[1],dt=it[0],st=it[1],Ge.alignment=1,Ge.width=Ot,Ge.height=sr,Ge.channels=_t,Ge.format=Ge.internalformat=Cn[_t],Ge.needsFree=!0,Cl(Ge,ke,dt,st,Me,Jt.offset)}else if(Vs(Jt)||ks(Jt)||Uu(Jt)||Bc(Jt))Vs(Jt)||ks(Jt)||Uu(Jt)?Ge.element=Jt:Ge.element=Jt.canvas,Ge.width=Ge.element.width,Ge.height=Ge.element.height,Ge.channels=4;else if(Zl(Jt))Ge.element=Jt,Ge.width=Jt.width,Ge.height=Jt.height,Ge.channels=4;else if(El(Jt))Ge.element=Jt,Ge.width=Jt.naturalWidth,Ge.height=Jt.naturalHeight,Ge.channels=4;else if(fc(Jt))Ge.element=Jt,Ge.width=Jt.videoWidth,Ge.height=Jt.videoHeight,Ge.channels=4;else if(zl(Jt)){var nt=Ge.width||Jt[0].length,Ne=Ge.height||Jt.length,Lt=Ge.channels;xo(Jt[0][0])?Lt=Lt||Jt[0][0].length:Lt=Lt||1;for(var Kt=en.shape(Jt),Hr=1,mn=0;mn<Kt.length;++mn)Hr*=Kt[mn];var vn=$s(Ge,Hr);en.flatten(Jt,Kt,"",vn),Ra(Ge,vn),Ge.alignment=1,Ge.width=nt,Ge.height=Ne,Ge.channels=Lt,Ge.format=Ge.internalformat=Cn[Lt],Ge.needsFree=!0}Ge.type===Ku?K(qe.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):Ge.type===Ls&&K(qe.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function Tn(Ge,cr,Jt){var Fn=Ge.element,fa=Ge.data,ke=Ge.internalformat,Se=Ge.format,it=Ge.type,Ot=Ge.width,sr=Ge.height;bn(Ge),Fn?z.texImage2D(cr,Jt,Se,Se,it,Fn):Ge.compressed?z.compressedTexImage2D(cr,Jt,ke,Ot,sr,0,fa):Ge.needsCopy?(ar(),z.copyTexImage2D(cr,Jt,Se,Ge.xOffset,Ge.yOffset,Ot,sr,0)):z.texImage2D(cr,Jt,Se,Ot,sr,0,Se,it,fa||null)}function ji(Ge,cr,Jt,Fn,fa){var ke=Ge.element,Se=Ge.data,it=Ge.internalformat,Ot=Ge.format,sr=Ge.type,_t=Ge.width,dt=Ge.height;bn(Ge),ke?z.texSubImage2D(cr,fa,Jt,Fn,Ot,sr,ke):Ge.compressed?z.compressedTexSubImage2D(cr,fa,Jt,Fn,it,_t,dt,Se):Ge.needsCopy?(ar(),z.copyTexSubImage2D(cr,fa,Jt,Fn,Ge.xOffset,Ge.yOffset,_t,dt)):z.texSubImage2D(cr,fa,Jt,Fn,_t,dt,Ot,sr,Se)}var Bi=[];function Mn(){return Bi.pop()||new an}function Pn(Ge){Ge.needsFree&&ft.freeType(Ge.data),an.call(Ge),Bi.push(Ge)}function wi(){kr.call(this),this.genMipmaps=!1,this.mipmapHint=$u,this.mipmask=0,this.images=Array(16)}function Di(Ge,cr,Jt){var Fn=Ge.images[0]=Mn();Ge.mipmask=1,Fn.width=Ge.width=cr,Fn.height=Ge.height=Jt,Fn.channels=Ge.channels=4}function la(Ge,cr){var Jt=null;if(Fs(cr))Jt=Ge.images[0]=Mn(),Ar(Jt,Ge),An(Jt,cr),Ge.mipmask=1;else if(Kn(Ge,cr),Array.isArray(cr.mipmap))for(var Fn=cr.mipmap,fa=0;fa<Fn.length;++fa)Jt=Ge.images[fa]=Mn(),Ar(Jt,Ge),Jt.width>>=fa,Jt.height>>=fa,An(Jt,Fn[fa]),Ge.mipmask|=1<<fa;else Jt=Ge.images[0]=Mn(),Ar(Jt,Ge),An(Jt,cr),Ge.mipmask=1;Ar(Ge,Ge.images[0]),Ge.compressed&&(Ge.internalformat===xs||Ge.internalformat===Rs||Ge.internalformat===xc||Ge.internalformat===ac)&&K(Ge.width%4==0&&Ge.height%4==0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function Mo(Ge,cr){for(var Jt=Ge.images,Fn=0;Fn<Jt.length;++Fn){if(!Jt[Fn])return;Tn(Jt[Fn],cr,Fn)}}var Io=[];function ca(){var Ge=Io.pop()||new wi;kr.call(Ge),Ge.mipmask=0;for(var cr=0;cr<16;++cr)Ge.images[cr]=null;return Ge}function Ns(Ge){for(var cr=Ge.images,Jt=0;Jt<cr.length;++Jt)cr[Jt]&&Pn(cr[Jt]),cr[Jt]=null;Io.push(Ge)}function mo(){this.minFilter=Bl,this.magFilter=Bl,this.wrapS=Zu,this.wrapT=Zu,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=$u}function ds(Ge,cr){if("min"in cr){var Jt=cr.min;K.parameter(Jt,rn),Ge.minFilter=rn[Jt],To.indexOf(Ge.minFilter)>=0&&!("faces"in cr)&&(Ge.genMipmaps=!0)}if("mag"in cr){var Fn=cr.mag;K.parameter(Fn,tn),Ge.magFilter=tn[Fn]}var fa=Ge.wrapS,ke=Ge.wrapT;if("wrap"in cr){var Se=cr.wrap;typeof Se=="string"?(K.parameter(Se,$r),fa=ke=$r[Se]):Array.isArray(Se)&&(K.parameter(Se[0],$r),K.parameter(Se[1],$r),fa=$r[Se[0]],ke=$r[Se[1]])}else{if("wrapS"in cr){var it=cr.wrapS;K.parameter(it,$r),fa=$r[it]}if("wrapT"in cr){var Ot=cr.wrapT;K.parameter(Ot,$r),ke=$r[Ot]}}if(Ge.wrapS=fa,Ge.wrapT=ke,"anisotropic"in cr){var sr=cr.anisotropic;K(typeof sr=="number"&&sr>=1&&sr<=qe.maxAnisotropic,"aniso samples must be between 1 and "),Ge.anisotropic=cr.anisotropic}if("mipmap"in cr){var _t=!1;switch(typeof cr.mipmap){case"string":K.parameter(cr.mipmap,Gr,"invalid mipmap hint"),Ge.mipmapHint=Gr[cr.mipmap],Ge.genMipmaps=!0,_t=!0;break;case"boolean":_t=Ge.genMipmaps=cr.mipmap;break;case"object":K(Array.isArray(cr.mipmap),"invalid mipmap type"),Ge.genMipmaps=!1,_t=!0;break;default:K.raise("invalid mipmap type")}_t&&!("min"in cr)&&(Ge.minFilter=Ds)}}function Xo(Ge,cr){z.texParameteri(cr,lo,Ge.minFilter),z.texParameteri(cr,ul,Ge.magFilter),z.texParameteri(cr,bc,Ge.wrapS),z.texParameteri(cr,lc,Ge.wrapT),Ie.ext_texture_filter_anisotropic&&z.texParameteri(cr,gf,Ge.anisotropic),Ge.genMipmaps&&(z.hint(bl,Ge.mipmapHint),z.generateMipmap(cr))}var Cs=0,zs={},ws=qe.maxTextureUnits,Yo=Array(ws).map(function(){return null});function Hi(Ge){kr.call(this),this.mipmask=0,this.internalformat=sa,this.id=Cs++,this.refCount=1,this.target=Ge,this.texture=z.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new mo,Mr.profile&&(this.stats={size:0})}function Ko(Ge){z.activeTexture(Sl),z.bindTexture(Ge.target,Ge.texture)}function Ma(){var Ge=Yo[0];Ge?z.bindTexture(Ge.target,Ge.texture):z.bindTexture(cs,null)}function Zo(Ge){var cr=Ge.texture;K(cr,"must not double destroy texture");var Jt=Ge.unit,Fn=Ge.target;Jt>=0&&(z.activeTexture(Sl+Jt),z.bindTexture(Fn,null),Yo[Jt]=null),z.deleteTexture(cr),Ge.texture=null,Ge.params=null,Ge.pixels=null,Ge.refCount=0,delete zs[Ge.id],rr.textureCount--}d(Hi.prototype,{bind:function(){var Ge=this;Ge.bindCount+=1;var cr=Ge.unit;if(cr<0){for(var Jt=0;Jt<ws;++Jt){var Fn=Yo[Jt];if(Fn){if(Fn.bindCount>0)continue;Fn.unit=-1}Yo[Jt]=Ge,cr=Jt;break}cr>=ws&&K.raise("insufficient number of texture units"),Mr.profile&&rr.maxTextureUnits<cr+1&&(rr.maxTextureUnits=cr+1),Ge.unit=cr,z.activeTexture(Sl+cr),z.bindTexture(Ge.target,Ge.texture)}return cr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&Zo(this)}});function Li(Ge,cr){var Jt=new Hi(cs);zs[Jt.id]=Jt,rr.textureCount++;function Fn(Se,it){var Ot=Jt.texInfo;mo.call(Ot);var sr=ca();return typeof Se=="number"?typeof it=="number"?Di(sr,Se|0,it|0):Di(sr,Se|0,Se|0):Se?(K.type(Se,"object","invalid arguments to regl.texture"),ds(Ot,Se),la(sr,Se)):Di(sr,1,1),Ot.genMipmaps&&(sr.mipmask=(sr.width<<1)-1),Jt.mipmask=sr.mipmask,Ar(Jt,sr),K.texture2D(Ot,sr,qe),Jt.internalformat=sr.internalformat,Fn.width=sr.width,Fn.height=sr.height,Ko(Jt),Mo(sr,cs),Xo(Ot,cs),Ma(),Ns(sr),Mr.profile&&(Jt.stats.size=Su(Jt.internalformat,Jt.type,sr.width,sr.height,Ot.genMipmaps,!1)),Fn.format=qr[Jt.internalformat],Fn.type=Ln[Jt.type],Fn.mag=Rr[Ot.magFilter],Fn.min=wn[Ot.minFilter],Fn.wrapS=cn[Ot.wrapS],Fn.wrapT=cn[Ot.wrapT],Fn}function fa(Se,it,Ot,sr){K(!!Se,"must specify image data");var _t=it|0,dt=Ot|0,st=sr|0,Me=Mn();return Ar(Me,Jt),Me.width=0,Me.height=0,An(Me,Se),Me.width=Me.width||(Jt.width>>st)-_t,Me.height=Me.height||(Jt.height>>st)-dt,K(Jt.type===Me.type&&Jt.format===Me.format&&Jt.internalformat===Me.internalformat,"incompatible format for texture.subimage"),K(_t>=0&&dt>=0&&_t+Me.width<=Jt.width&&dt+Me.height<=Jt.height,"texture.subimage write out of bounds"),K(Jt.mipmask&1<<st,"missing mipmap data"),K(Me.data||Me.element||Me.needsCopy,"missing image data"),Ko(Jt),ji(Me,cs,_t,dt,st),Ma(),Pn(Me),Fn}function ke(Se,it){var Ot=Se|0,sr=it|0||Ot;if(Ot===Jt.width&&sr===Jt.height)return Fn;Fn.width=Jt.width=Ot,Fn.height=Jt.height=sr,Ko(Jt);for(var _t=0;Jt.mipmask>>_t;++_t){var dt=Ot>>_t,st=sr>>_t;if(!dt||!st)break;z.texImage2D(cs,_t,Jt.format,dt,st,0,Jt.format,Jt.type,null)}return Ma(),Mr.profile&&(Jt.stats.size=Su(Jt.internalformat,Jt.type,Ot,sr,!1,!1)),Fn}return Fn(Ge,cr),Fn.subimage=fa,Fn.resize=ke,Fn._reglType="texture2d",Fn._texture=Jt,Mr.profile&&(Fn.stats=Jt.stats),Fn.destroy=function(){Jt.decRef()},Fn}function va(Ge,cr,Jt,Fn,fa,ke){var Se=new Hi(ic);zs[Se.id]=Se,rr.cubeCount++;var it=new Array(6);function Ot(dt,st,Me,nt,Ne,Lt){var Kt,Hr=Se.texInfo;for(mo.call(Hr),Kt=0;Kt<6;++Kt)it[Kt]=ca();if(typeof dt=="number"||!dt){var mn=dt|0||1;for(Kt=0;Kt<6;++Kt)Di(it[Kt],mn,mn)}else if(typeof dt=="object")if(st)la(it[0],dt),la(it[1],st),la(it[2],Me),la(it[3],nt),la(it[4],Ne),la(it[5],Lt);else if(ds(Hr,dt),Kn(Se,dt),"faces"in dt){var vn=dt.faces;for(K(Array.isArray(vn)&&vn.length===6,"cube faces must be a length 6 array"),Kt=0;Kt<6;++Kt)K(typeof vn[Kt]=="object"&&!!vn[Kt],"invalid input for cube map face"),Ar(it[Kt],Se),la(it[Kt],vn[Kt])}else for(Kt=0;Kt<6;++Kt)la(it[Kt],dt);else K.raise("invalid arguments to cube map");for(Ar(Se,it[0]),K.optional(function(){qe.npotTextureCube||K(nc(Se.width)&&nc(Se.height),"your browser does not support non power or two texture dimensions")}),Hr.genMipmaps?Se.mipmask=(it[0].width<<1)-1:Se.mipmask=it[0].mipmask,K.textureCube(Se,Hr,it,qe),Se.internalformat=it[0].internalformat,Ot.width=it[0].width,Ot.height=it[0].height,Ko(Se),Kt=0;Kt<6;++Kt)Mo(it[Kt],Xs+Kt);for(Xo(Hr,ic),Ma(),Mr.profile&&(Se.stats.size=Su(Se.internalformat,Se.type,Ot.width,Ot.height,Hr.genMipmaps,!0)),Ot.format=qr[Se.internalformat],Ot.type=Ln[Se.type],Ot.mag=Rr[Hr.magFilter],Ot.min=wn[Hr.minFilter],Ot.wrapS=cn[Hr.wrapS],Ot.wrapT=cn[Hr.wrapT],Kt=0;Kt<6;++Kt)Ns(it[Kt]);return Ot}function sr(dt,st,Me,nt,Ne){K(!!st,"must specify image data"),K(typeof dt=="number"&&dt===(dt|0)&&dt>=0&&dt<6,"invalid face");var Lt=Me|0,Kt=nt|0,Hr=Ne|0,mn=Mn();return Ar(mn,Se),mn.width=0,mn.height=0,An(mn,st),mn.width=mn.width||(Se.width>>Hr)-Lt,mn.height=mn.height||(Se.height>>Hr)-Kt,K(Se.type===mn.type&&Se.format===mn.format&&Se.internalformat===mn.internalformat,"incompatible format for texture.subimage"),K(Lt>=0&&Kt>=0&&Lt+mn.width<=Se.width&&Kt+mn.height<=Se.height,"texture.subimage write out of bounds"),K(Se.mipmask&1<<Hr,"missing mipmap data"),K(mn.data||mn.element||mn.needsCopy,"missing image data"),Ko(Se),ji(mn,Xs+dt,Lt,Kt,Hr),Ma(),Pn(mn),Ot}function _t(dt){var st=dt|0;if(st!==Se.width){Ot.width=Se.width=st,Ot.height=Se.height=st,Ko(Se);for(var Me=0;Me<6;++Me)for(var nt=0;Se.mipmask>>nt;++nt)z.texImage2D(Xs+Me,nt,Se.format,st>>nt,st>>nt,0,Se.format,Se.type,null);return Ma(),Mr.profile&&(Se.stats.size=Su(Se.internalformat,Se.type,Ot.width,Ot.height,!1,!0)),Ot}}return Ot(Ge,cr,Jt,Fn,fa,ke),Ot.subimage=sr,Ot.resize=_t,Ot._reglType="textureCube",Ot._texture=Se,Mr.profile&&(Ot.stats=Se.stats),Ot.destroy=function(){Se.decRef()},Ot}function fo(){for(var Ge=0;Ge<ws;++Ge)z.activeTexture(Sl+Ge),z.bindTexture(cs,null),Yo[Ge]=null;$t(zs).forEach(Zo),rr.cubeCount=0,rr.textureCount=0}Mr.profile&&(rr.getTotalTextureSize=function(){var Ge=0;return Object.keys(zs).forEach(function(cr){Ge+=zs[cr].stats.size}),Ge});function go(){for(var Ge=0;Ge<ws;++Ge){var cr=Yo[Ge];cr&&(cr.bindCount=0,cr.unit=-1,Yo[Ge]=null)}$t(zs).forEach(function(Jt){Jt.texture=z.createTexture(),z.bindTexture(Jt.target,Jt.texture);for(var Fn=0;Fn<32;++Fn)if((Jt.mipmask&1<<Fn)!=0)if(Jt.target===cs)z.texImage2D(cs,Fn,Jt.internalformat,Jt.width>>Fn,Jt.height>>Fn,0,Jt.internalformat,Jt.type,null);else for(var fa=0;fa<6;++fa)z.texImage2D(Xs+fa,Fn,Jt.internalformat,Jt.width>>Fn,Jt.height>>Fn,0,Jt.internalformat,Jt.type,null);Xo(Jt.texInfo,Jt.target)})}function Pl(){for(var Ge=0;Ge<ws;++Ge){var cr=Yo[Ge];cr&&(cr.bindCount=0,cr.unit=-1,Yo[Ge]=null),z.activeTexture(Sl+Ge),z.bindTexture(cs,null),z.bindTexture(ic,null)}}return{create2D:Li,createCube:va,clear:fo,getTexture:function(Ge){return null},restore:go,refresh:Pl}}var eo=36161,fl=32854,ii=32855,qn=36194,Ul=33189,es=36168,Bs=34041,zo=35907,lu=34836,Cc=34842,hc=34843,ta=[];ta[fl]=2,ta[ii]=2,ta[qn]=2,ta[Ul]=2,ta[es]=1,ta[Bs]=4,ta[zo]=4,ta[lu]=16,ta[Cc]=8,ta[hc]=6;function ba(z,Ie,qe){return ta[z]*Ie*qe}var qc=function(z,Ie,qe,ar,Br){var rr={rgba4:fl,rgb565:qn,"rgb5 a1":ii,depth:Ul,stencil:es,"depth stencil":Bs};Ie.ext_srgb&&(rr.srgba=zo),Ie.ext_color_buffer_half_float&&(rr.rgba16f=Cc,rr.rgb16f=hc),Ie.webgl_color_buffer_float&&(rr.rgba32f=lu);var Mr=[];Object.keys(rr).forEach(function(Qr){var un=rr[Qr];Mr[un]=Qr});var Gr=0,$r={};function tn(Qr){this.id=Gr++,this.refCount=1,this.renderbuffer=Qr,this.format=fl,this.width=0,this.height=0,Br.profile&&(this.stats={size:0})}tn.prototype.decRef=function(){--this.refCount<=0&&rn(this)};function rn(Qr){var un=Qr.renderbuffer;K(un,"must not double destroy renderbuffer"),z.bindRenderbuffer(eo,null),z.deleteRenderbuffer(un),Qr.renderbuffer=null,Qr.refCount=0,delete $r[Qr.id],ar.renderbufferCount--}function sn(Qr,un){var Bt=new tn(z.createRenderbuffer());$r[Bt.id]=Bt,ar.renderbufferCount++;function gr(Ln,Rr){var wn=0,cn=0,pi=fl;if(typeof Ln=="object"&&Ln){var kr=Ln;if("shape"in kr){var Ar=kr.shape;K(Array.isArray(Ar)&&Ar.length>=2,"invalid renderbuffer shape"),wn=Ar[0]|0,cn=Ar[1]|0}else"radius"in kr&&(wn=cn=kr.radius|0),"width"in kr&&(wn=kr.width|0),"height"in kr&&(cn=kr.height|0);"format"in kr&&(K.parameter(kr.format,rr,"invalid renderbuffer format"),pi=rr[kr.format])}else typeof Ln=="number"?(wn=Ln|0,typeof Rr=="number"?cn=Rr|0:cn=wn):Ln?K.raise("invalid arguments to renderbuffer constructor"):wn=cn=1;if(K(wn>0&&cn>0&&wn<=qe.maxRenderbufferSize&&cn<=qe.maxRenderbufferSize,"invalid renderbuffer size"),!(wn===Bt.width&&cn===Bt.height&&pi===Bt.format))return gr.width=Bt.width=wn,gr.height=Bt.height=cn,Bt.format=pi,z.bindRenderbuffer(eo,Bt.renderbuffer),z.renderbufferStorage(eo,pi,wn,cn),K(z.getError()===0,"invalid render buffer format"),Br.profile&&(Bt.stats.size=ba(Bt.format,Bt.width,Bt.height)),gr.format=Mr[Bt.format],gr}function qr(Ln,Rr){var wn=Ln|0,cn=Rr|0||wn;return wn===Bt.width&&cn===Bt.height||(K(wn>0&&cn>0&&wn<=qe.maxRenderbufferSize&&cn<=qe.maxRenderbufferSize,"invalid renderbuffer size"),gr.width=Bt.width=wn,gr.height=Bt.height=cn,z.bindRenderbuffer(eo,Bt.renderbuffer),z.renderbufferStorage(eo,Bt.format,wn,cn),K(z.getError()===0,"invalid render buffer format"),Br.profile&&(Bt.stats.size=ba(Bt.format,Bt.width,Bt.height))),gr}return gr(Qr,un),gr.resize=qr,gr._reglType="renderbuffer",gr._renderbuffer=Bt,Br.profile&&(gr.stats=Bt.stats),gr.destroy=function(){Bt.decRef()},gr}Br.profile&&(ar.getTotalRenderbufferSize=function(){var Qr=0;return Object.keys($r).forEach(function(un){Qr+=$r[un].stats.size}),Qr});function yn(){$t($r).forEach(function(Qr){Qr.renderbuffer=z.createRenderbuffer(),z.bindRenderbuffer(eo,Qr.renderbuffer),z.renderbufferStorage(eo,Qr.format,Qr.width,Qr.height)}),z.bindRenderbuffer(eo,null)}return{create:sn,clear:function(){$t($r).forEach(rn)},restore:yn}},Po=36160,wl=36161,Gs=3553,Ss=34069,hl=36064,Eu=36096,wc=36128,Ri=33306,Qu=36053,Nc=36054,Fo=36055,Cu=36057,jl=36061,qu=36193,cu=5121,Al=5126,Ou=6407,fu=6408,zc=6402,Lu=[Ou,fu],Ea=[];Ea[fu]=4,Ea[Ou]=3;var Tl=[];Tl[cu]=1,Tl[Al]=4,Tl[qu]=2;var i=32854,u=32855,o=36194,h=33189,y=36168,b=34041,T=35907,R=34836,j=34842,ne=34843,be=[i,u,o,T,j,ne,R],Ce={};Ce[Qu]="complete",Ce[Nc]="incomplete attachment",Ce[Cu]="incomplete dimensions",Ce[Fo]="incomplete, missing attachment",Ce[jl]="unsupported";function Pe(z,Ie,qe,ar,Br,rr){var Mr={cur:null,next:null,dirty:!1,setFBO:null},Gr=["rgba"],$r=["rgba4","rgb565","rgb5 a1"];Ie.ext_srgb&&$r.push("srgba"),Ie.ext_color_buffer_half_float&&$r.push("rgba16f","rgb16f"),Ie.webgl_color_buffer_float&&$r.push("rgba32f");var tn=["uint8"];Ie.oes_texture_half_float&&tn.push("half float","float16"),Ie.oes_texture_float&&tn.push("float","float32");function rn(an,An,Tn){this.target=an,this.texture=An,this.renderbuffer=Tn;var ji=0,Bi=0;An?(ji=An.width,Bi=An.height):Tn&&(ji=Tn.width,Bi=Tn.height),this.width=ji,this.height=Bi}function sn(an){an&&(an.texture&&an.texture._texture.decRef(),an.renderbuffer&&an.renderbuffer._renderbuffer.decRef())}function yn(an,An,Tn){if(!!an)if(an.texture){var ji=an.texture._texture,Bi=Math.max(1,ji.width),Mn=Math.max(1,ji.height);K(Bi===An&&Mn===Tn,"inconsistent width/height for supplied texture"),ji.refCount+=1}else{var Pn=an.renderbuffer._renderbuffer;K(Pn.width===An&&Pn.height===Tn,"inconsistent width/height for renderbuffer"),Pn.refCount+=1}}function Qr(an,An){An&&(An.texture?z.framebufferTexture2D(Po,an,An.target,An.texture._texture.texture,0):z.framebufferRenderbuffer(Po,an,wl,An.renderbuffer._renderbuffer.renderbuffer))}function un(an){var An=Gs,Tn=null,ji=null,Bi=an;typeof an=="object"&&(Bi=an.data,"target"in an&&(An=an.target|0)),K.type(Bi,"function","invalid attachment data");var Mn=Bi._reglType;return Mn==="texture2d"?(Tn=Bi,K(An===Gs)):Mn==="textureCube"?(Tn=Bi,K(An>=Ss&&An<Ss+6,"invalid cube map target")):Mn==="renderbuffer"?(ji=Bi,An=wl):K.raise("invalid regl object for attachment"),new rn(An,Tn,ji)}function Bt(an,An,Tn,ji,Bi){if(Tn){var Mn=ar.create2D({width:an,height:An,format:ji,type:Bi});return Mn._texture.refCount=0,new rn(Gs,Mn,null)}else{var Pn=Br.create({width:an,height:An,format:ji});return Pn._renderbuffer.refCount=0,new rn(wl,null,Pn)}}function gr(an){return an&&(an.texture||an.renderbuffer)}function qr(an,An,Tn){an&&(an.texture?an.texture.resize(An,Tn):an.renderbuffer&&an.renderbuffer.resize(An,Tn),an.width=An,an.height=Tn)}var Ln=0,Rr={};function wn(){this.id=Ln++,Rr[this.id]=this,this.framebuffer=z.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function cn(an){an.colorAttachments.forEach(sn),sn(an.depthAttachment),sn(an.stencilAttachment),sn(an.depthStencilAttachment)}function pi(an){var An=an.framebuffer;K(An,"must not double destroy framebuffer"),z.deleteFramebuffer(An),an.framebuffer=null,rr.framebufferCount--,delete Rr[an.id]}function kr(an){var An;z.bindFramebuffer(Po,an.framebuffer);var Tn=an.colorAttachments;for(An=0;An<Tn.length;++An)Qr(hl+An,Tn[An]);for(An=Tn.length;An<qe.maxColorAttachments;++An)z.framebufferTexture2D(Po,hl+An,Gs,null,0);z.framebufferTexture2D(Po,Ri,Gs,null,0),z.framebufferTexture2D(Po,Eu,Gs,null,0),z.framebufferTexture2D(Po,wc,Gs,null,0),Qr(Eu,an.depthAttachment),Qr(wc,an.stencilAttachment),Qr(Ri,an.depthStencilAttachment);var ji=z.checkFramebufferStatus(Po);!z.isContextLost()&&ji!==Qu&&K.raise("framebuffer configuration not supported, status = "+Ce[ji]),z.bindFramebuffer(Po,Mr.next?Mr.next.framebuffer:null),Mr.cur=Mr.next,z.getError()}function Ar(an,An){var Tn=new wn;rr.framebufferCount++;function ji(Mn,Pn){var wi;K(Mr.next!==Tn,"can not update framebuffer which is currently in use");var Di=0,la=0,Mo=!0,Io=!0,ca=null,Ns=!0,mo="rgba",ds="uint8",Xo=1,Cs=null,zs=null,ws=null,Yo=!1;if(typeof Mn=="number")Di=Mn|0,la=Pn|0||Di;else if(!Mn)Di=la=1;else{K.type(Mn,"object","invalid arguments for framebuffer");var Hi=Mn;if("shape"in Hi){var Ko=Hi.shape;K(Array.isArray(Ko)&&Ko.length>=2,"invalid shape for framebuffer"),Di=Ko[0],la=Ko[1]}else"radius"in Hi&&(Di=la=Hi.radius),"width"in Hi&&(Di=Hi.width),"height"in Hi&&(la=Hi.height);("color"in Hi||"colors"in Hi)&&(ca=Hi.color||Hi.colors,Array.isArray(ca)&&K(ca.length===1||Ie.webgl_draw_buffers,"multiple render targets not supported")),ca||("colorCount"in Hi&&(Xo=Hi.colorCount|0,K(Xo>0,"invalid color buffer count")),"colorTexture"in Hi&&(Ns=!!Hi.colorTexture,mo="rgba4"),"colorType"in Hi&&(ds=Hi.colorType,Ns?(K(Ie.oes_texture_float||!(ds==="float"||ds==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),K(Ie.oes_texture_half_float||!(ds==="half float"||ds==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):ds==="half float"||ds==="float16"?(K(Ie.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),mo="rgba16f"):(ds==="float"||ds==="float32")&&(K(Ie.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),mo="rgba32f"),K.oneOf(ds,tn,"invalid color type")),"colorFormat"in Hi&&(mo=Hi.colorFormat,Gr.indexOf(mo)>=0?Ns=!0:$r.indexOf(mo)>=0?Ns=!1:K.optional(function(){Ns?K.oneOf(Hi.colorFormat,Gr,"invalid color format for texture"):K.oneOf(Hi.colorFormat,$r,"invalid color format for renderbuffer")}))),("depthTexture"in Hi||"depthStencilTexture"in Hi)&&(Yo=!!(Hi.depthTexture||Hi.depthStencilTexture),K(!Yo||Ie.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in Hi&&(typeof Hi.depth=="boolean"?Mo=Hi.depth:(Cs=Hi.depth,Io=!1)),"stencil"in Hi&&(typeof Hi.stencil=="boolean"?Io=Hi.stencil:(zs=Hi.stencil,Mo=!1)),"depthStencil"in Hi&&(typeof Hi.depthStencil=="boolean"?Mo=Io=Hi.depthStencil:(ws=Hi.depthStencil,Mo=!1,Io=!1))}var Ma=null,Zo=null,Li=null,va=null;if(Array.isArray(ca))Ma=ca.map(un);else if(ca)Ma=[un(ca)];else for(Ma=new Array(Xo),wi=0;wi<Xo;++wi)Ma[wi]=Bt(Di,la,Ns,mo,ds);K(Ie.webgl_draw_buffers||Ma.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),K(Ma.length<=qe.maxColorAttachments,"too many color attachments, not supported"),Di=Di||Ma[0].width,la=la||Ma[0].height,Cs?Zo=un(Cs):Mo&&!Io&&(Zo=Bt(Di,la,Yo,"depth","uint32")),zs?Li=un(zs):Io&&!Mo&&(Li=Bt(Di,la,!1,"stencil","uint8")),ws?va=un(ws):!Cs&&!zs&&Io&&Mo&&(va=Bt(Di,la,Yo,"depth stencil","depth stencil")),K(!!Cs+!!zs+!!ws<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var fo=null;for(wi=0;wi<Ma.length;++wi)if(yn(Ma[wi],Di,la),K(!Ma[wi]||Ma[wi].texture&&Lu.indexOf(Ma[wi].texture._texture.format)>=0||Ma[wi].renderbuffer&&be.indexOf(Ma[wi].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+wi+" is invalid"),Ma[wi]&&Ma[wi].texture){var go=Ea[Ma[wi].texture._texture.format]*Tl[Ma[wi].texture._texture.type];fo===null?fo=go:K(fo===go,"all color attachments much have the same number of bits per pixel.")}return yn(Zo,Di,la),K(!Zo||Zo.texture&&Zo.texture._texture.format===zc||Zo.renderbuffer&&Zo.renderbuffer._renderbuffer.format===h,"invalid depth attachment for framebuffer object"),yn(Li,Di,la),K(!Li||Li.renderbuffer&&Li.renderbuffer._renderbuffer.format===y,"invalid stencil attachment for framebuffer object"),yn(va,Di,la),K(!va||va.texture&&va.texture._texture.format===b||va.renderbuffer&&va.renderbuffer._renderbuffer.format===b,"invalid depth-stencil attachment for framebuffer object"),cn(Tn),Tn.width=Di,Tn.height=la,Tn.colorAttachments=Ma,Tn.depthAttachment=Zo,Tn.stencilAttachment=Li,Tn.depthStencilAttachment=va,ji.color=Ma.map(gr),ji.depth=gr(Zo),ji.stencil=gr(Li),ji.depthStencil=gr(va),ji.width=Tn.width,ji.height=Tn.height,kr(Tn),ji}function Bi(Mn,Pn){K(Mr.next!==Tn,"can not resize a framebuffer which is currently in use");var wi=Math.max(Mn|0,1),Di=Math.max(Pn|0||wi,1);if(wi===Tn.width&&Di===Tn.height)return ji;for(var la=Tn.colorAttachments,Mo=0;Mo<la.length;++Mo)qr(la[Mo],wi,Di);return qr(Tn.depthAttachment,wi,Di),qr(Tn.stencilAttachment,wi,Di),qr(Tn.depthStencilAttachment,wi,Di),Tn.width=ji.width=wi,Tn.height=ji.height=Di,kr(Tn),ji}return ji(an,An),d(ji,{resize:Bi,_reglType:"framebuffer",_framebuffer:Tn,destroy:function(){pi(Tn),cn(Tn)},use:function(Mn){Mr.setFBO({framebuffer:ji},Mn)}})}function Kn(an){var An=Array(6);function Tn(Bi){var Mn;K(An.indexOf(Mr.next)<0,"can not update framebuffer which is currently in use");var Pn={color:null},wi=0,Di=null,la="rgba",Mo="uint8",Io=1;if(typeof Bi=="number")wi=Bi|0;else if(!Bi)wi=1;else{K.type(Bi,"object","invalid arguments for framebuffer");var ca=Bi;if("shape"in ca){var Ns=ca.shape;K(Array.isArray(Ns)&&Ns.length>=2,"invalid shape for framebuffer"),K(Ns[0]===Ns[1],"cube framebuffer must be square"),wi=Ns[0]}else"radius"in ca&&(wi=ca.radius|0),"width"in ca?(wi=ca.width|0,"height"in ca&&K(ca.height===wi,"must be square")):"height"in ca&&(wi=ca.height|0);("color"in ca||"colors"in ca)&&(Di=ca.color||ca.colors,Array.isArray(Di)&&K(Di.length===1||Ie.webgl_draw_buffers,"multiple render targets not supported")),Di||("colorCount"in ca&&(Io=ca.colorCount|0,K(Io>0,"invalid color buffer count")),"colorType"in ca&&(K.oneOf(ca.colorType,tn,"invalid color type"),Mo=ca.colorType),"colorFormat"in ca&&(la=ca.colorFormat,K.oneOf(ca.colorFormat,Gr,"invalid color format for texture"))),"depth"in ca&&(Pn.depth=ca.depth),"stencil"in ca&&(Pn.stencil=ca.stencil),"depthStencil"in ca&&(Pn.depthStencil=ca.depthStencil)}var mo;if(Di)if(Array.isArray(Di))for(mo=[],Mn=0;Mn<Di.length;++Mn)mo[Mn]=Di[Mn];else mo=[Di];else{mo=Array(Io);var ds={radius:wi,format:la,type:Mo};for(Mn=0;Mn<Io;++Mn)mo[Mn]=ar.createCube(ds)}for(Pn.color=Array(mo.length),Mn=0;Mn<mo.length;++Mn){var Xo=mo[Mn];K(typeof Xo=="function"&&Xo._reglType==="textureCube","invalid cube map"),wi=wi||Xo.width,K(Xo.width===wi&&Xo.height===wi,"invalid cube map shape"),Pn.color[Mn]={target:Ss,data:mo[Mn]}}for(Mn=0;Mn<6;++Mn){for(var Cs=0;Cs<mo.length;++Cs)Pn.color[Cs].target=Ss+Mn;Mn>0&&(Pn.depth=An[0].depth,Pn.stencil=An[0].stencil,Pn.depthStencil=An[0].depthStencil),An[Mn]?An[Mn](Pn):An[Mn]=Ar(Pn)}return d(Tn,{width:wi,height:wi,color:mo})}function ji(Bi){var Mn,Pn=Bi|0;if(K(Pn>0&&Pn<=qe.maxCubeMapSize,"invalid radius for cube fbo"),Pn===Tn.width)return Tn;var wi=Tn.color;for(Mn=0;Mn<wi.length;++Mn)wi[Mn].resize(Pn);for(Mn=0;Mn<6;++Mn)An[Mn].resize(Pn);return Tn.width=Tn.height=Pn,Tn}return Tn(an),d(Tn,{faces:An,resize:ji,_reglType:"framebufferCube",destroy:function(){An.forEach(function(Bi){Bi.destroy()})}})}function bn(){Mr.cur=null,Mr.next=null,Mr.dirty=!0,$t(Rr).forEach(function(an){an.framebuffer=z.createFramebuffer(),kr(an)})}return d(Mr,{getFramebuffer:function(an){if(typeof an=="function"&&an._reglType==="framebuffer"){var An=an._framebuffer;if(An instanceof wn)return An}return null},create:Ar,createCube:Kn,clear:function(){$t(Rr).forEach(pi)},restore:bn})}var He=5126,je=34962,ot=34963,ze=["attributes","elements","offset","count","primitive","instances"];function at(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=He,this.offset=0,this.stride=0,this.divisor=0}function Et(z,Ie,qe,ar,Br,rr,Mr){for(var Gr=qe.maxAttributes,$r=new Array(Gr),tn=0;tn<Gr;++tn)$r[tn]=new at;var rn=0,sn={},yn={Record:at,scope:{},state:$r,currentVAO:null,targetVAO:null,restore:un()?cn:function(){},createVAO:pi,getVAO:gr,destroyBuffer:Qr,setVAO:un()?qr:Ln,clear:un()?Rr:function(){}};function Qr(kr){for(var Ar=0;Ar<$r.length;++Ar){var Kn=$r[Ar];Kn.buffer===kr&&(z.disableVertexAttribArray(Ar),Kn.buffer=null)}}function un(){return Ie.oes_vertex_array_object}function Bt(){return Ie.angle_instanced_arrays}function gr(kr){return typeof kr=="function"&&kr._vao?kr._vao:null}function qr(kr){if(kr!==yn.currentVAO){var Ar=un();kr?Ar.bindVertexArrayOES(kr.vao):Ar.bindVertexArrayOES(null),yn.currentVAO=kr}}function Ln(kr){if(kr!==yn.currentVAO){if(kr)kr.bindAttrs();else{for(var Ar=Bt(),Kn=0;Kn<$r.length;++Kn){var bn=$r[Kn];bn.buffer?(z.enableVertexAttribArray(Kn),bn.buffer.bind(),z.vertexAttribPointer(Kn,bn.size,bn.type,bn.normalized,bn.stride,bn.offfset),Ar&&bn.divisor&&Ar.vertexAttribDivisorANGLE(Kn,bn.divisor)):(z.disableVertexAttribArray(Kn),z.vertexAttrib4f(Kn,bn.x,bn.y,bn.z,bn.w))}Mr.elements?z.bindBuffer(ot,Mr.elements.buffer.buffer):z.bindBuffer(ot,null)}yn.currentVAO=kr}}function Rr(){$t(sn).forEach(function(kr){kr.destroy()})}function wn(){this.id=++rn,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var kr=un();kr?this.vao=kr.createVertexArrayOES():this.vao=null,sn[this.id]=this,this.buffers=[]}wn.prototype.bindAttrs=function(){for(var kr=Bt(),Ar=this.attributes,Kn=0;Kn<Ar.length;++Kn){var bn=Ar[Kn];bn.buffer?(z.enableVertexAttribArray(Kn),z.bindBuffer(je,bn.buffer.buffer),z.vertexAttribPointer(Kn,bn.size,bn.type,bn.normalized,bn.stride,bn.offset),kr&&bn.divisor&&kr.vertexAttribDivisorANGLE(Kn,bn.divisor)):(z.disableVertexAttribArray(Kn),z.vertexAttrib4f(Kn,bn.x,bn.y,bn.z,bn.w))}for(var an=Ar.length;an<Gr;++an)z.disableVertexAttribArray(an);var An=rr.getElements(this.elements);An?z.bindBuffer(ot,An.buffer.buffer):z.bindBuffer(ot,null)},wn.prototype.refresh=function(){var kr=un();kr&&(kr.bindVertexArrayOES(this.vao),this.bindAttrs(),yn.currentVAO=null,kr.bindVertexArrayOES(null))},wn.prototype.destroy=function(){if(this.vao){var kr=un();this===yn.currentVAO&&(yn.currentVAO=null,kr.bindVertexArrayOES(null)),kr.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),sn[this.id]&&(delete sn[this.id],ar.vaoCount-=1)};function cn(){var kr=un();kr&&$t(sn).forEach(function(Ar){Ar.refresh()})}function pi(kr){var Ar=new wn;ar.vaoCount+=1;function Kn(bn){var an;if(Array.isArray(bn))an=bn,Ar.elements&&Ar.ownsElements&&Ar.elements.destroy(),Ar.elements=null,Ar.ownsElements=!1,Ar.offset=0,Ar.count=0,Ar.instances=-1,Ar.primitive=4;else{if(K(typeof bn=="object","invalid arguments for create vao"),K("attributes"in bn,"must specify attributes for vao"),bn.elements){var An=bn.elements;Ar.ownsElements?typeof An=="function"&&An._reglType==="elements"?(Ar.elements.destroy(),Ar.ownsElements=!1):(Ar.elements(An),Ar.ownsElements=!1):rr.getElements(bn.elements)?(Ar.elements=bn.elements,Ar.ownsElements=!1):(Ar.elements=rr.create(bn.elements),Ar.ownsElements=!0)}else Ar.elements=null,Ar.ownsElements=!1;an=bn.attributes,Ar.offset=0,Ar.count=-1,Ar.instances=-1,Ar.primitive=4,Ar.elements&&(Ar.count=Ar.elements._elements.vertCount,Ar.primitive=Ar.elements._elements.primType),"offset"in bn&&(Ar.offset=bn.offset|0),"count"in bn&&(Ar.count=bn.count|0),"instances"in bn&&(Ar.instances=bn.instances|0),"primitive"in bn&&(K(bn.primitive in Fr,"bad primitive type: "+bn.primitive),Ar.primitive=Fr[bn.primitive]),K.optional(()=>{for(var Mo=Object.keys(bn),Io=0;Io<Mo.length;++Io)K(ze.indexOf(Mo[Io])>=0,'invalid option for vao: "'+Mo[Io]+'" valid options are '+ze)}),K(Array.isArray(an),"attributes must be an array")}K(an.length<Gr,"too many attributes"),K(an.length>0,"must specify at least one attribute");var Tn={},ji=Ar.attributes;ji.length=an.length;for(var Bi=0;Bi<an.length;++Bi){var Mn=an[Bi],Pn=ji[Bi]=new at,wi=Mn.data||Mn;if(Array.isArray(wi)||C(wi)||pt(wi)){var Di;Ar.buffers[Bi]&&(Di=Ar.buffers[Bi],C(wi)&&Di._buffer.byteLength>=wi.byteLength?Di.subdata(wi):(Di.destroy(),Ar.buffers[Bi]=null)),Ar.buffers[Bi]||(Di=Ar.buffers[Bi]=Br.create(Mn,je,!1,!0)),Pn.buffer=Br.getBuffer(Di),Pn.size=Pn.buffer.dimension|0,Pn.normalized=!1,Pn.type=Pn.buffer.dtype,Pn.offset=0,Pn.stride=0,Pn.divisor=0,Pn.state=1,Tn[Bi]=1}else Br.getBuffer(Mn)?(Pn.buffer=Br.getBuffer(Mn),Pn.size=Pn.buffer.dimension|0,Pn.normalized=!1,Pn.type=Pn.buffer.dtype,Pn.offset=0,Pn.stride=0,Pn.divisor=0,Pn.state=1):Br.getBuffer(Mn.buffer)?(Pn.buffer=Br.getBuffer(Mn.buffer),Pn.size=(+Mn.size||Pn.buffer.dimension)|0,Pn.normalized=!!Mn.normalized||!1,"type"in Mn?(K.parameter(Mn.type,ru,"invalid buffer type"),Pn.type=ru[Mn.type]):Pn.type=Pn.buffer.dtype,Pn.offset=(Mn.offset||0)|0,Pn.stride=(Mn.stride||0)|0,Pn.divisor=(Mn.divisor||0)|0,Pn.state=1,K(Pn.size>=1&&Pn.size<=4,"size must be between 1 and 4"),K(Pn.offset>=0,"invalid offset"),K(Pn.stride>=0&&Pn.stride<=255,"stride must be between 0 and 255"),K(Pn.divisor>=0,"divisor must be positive"),K(!Pn.divisor||!!Ie.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Mn?(K(Bi>0,"first attribute must not be a constant"),Pn.x=+Mn.x||0,Pn.y=+Mn.y||0,Pn.z=+Mn.z||0,Pn.w=+Mn.w||0,Pn.state=2):K(!1,"invalid attribute spec for location "+Bi)}for(var la=0;la<Ar.buffers.length;++la)!Tn[la]&&Ar.buffers[la]&&(Ar.buffers[la].destroy(),Ar.buffers[la]=null);return Ar.refresh(),Kn}return Kn.destroy=function(){for(var bn=0;bn<Ar.buffers.length;++bn)Ar.buffers[bn]&&Ar.buffers[bn].destroy();Ar.buffers.length=0,Ar.ownsElements&&(Ar.elements.destroy(),Ar.elements=null,Ar.ownsElements=!1),Ar.destroy()},Kn._vao=Ar,Kn._reglType="vao",Kn(kr)}return yn}var Vt=35632,mr=35633,ur=35718,Er=35721;function jr(z,Ie,qe,ar){var Br={},rr={};function Mr(Bt,gr,qr,Ln){this.name=Bt,this.id=gr,this.location=qr,this.info=Ln}function Gr(Bt,gr){for(var qr=0;qr<Bt.length;++qr)if(Bt[qr].id===gr.id){Bt[qr].location=gr.location;return}Bt.push(gr)}function $r(Bt,gr,qr){var Ln=Bt===Vt?Br:rr,Rr=Ln[gr];if(!Rr){var wn=Ie.str(gr);Rr=z.createShader(Bt),z.shaderSource(Rr,wn),z.compileShader(Rr),K.shaderError(z,Rr,wn,Bt,qr),Ln[gr]=Rr}return Rr}var tn={},rn=[],sn=0;function yn(Bt,gr){this.id=sn++,this.fragId=Bt,this.vertId=gr,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,ar.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Qr(Bt,gr,qr){var Ln,Rr,wn=$r(Vt,Bt.fragId),cn=$r(mr,Bt.vertId),pi=Bt.program=z.createProgram();if(z.attachShader(pi,wn),z.attachShader(pi,cn),qr)for(Ln=0;Ln<qr.length;++Ln){var kr=qr[Ln];z.bindAttribLocation(pi,kr[0],kr[1])}z.linkProgram(pi),K.linkError(z,pi,Ie.str(Bt.fragId),Ie.str(Bt.vertId),gr);var Ar=z.getProgramParameter(pi,ur);ar.profile&&(Bt.stats.uniformsCount=Ar);var Kn=Bt.uniforms;for(Ln=0;Ln<Ar;++Ln)if(Rr=z.getActiveUniform(pi,Ln),Rr)if(Rr.size>1)for(var bn=0;bn<Rr.size;++bn){var an=Rr.name.replace("[0]","["+bn+"]");Gr(Kn,new Mr(an,Ie.id(an),z.getUniformLocation(pi,an),Rr))}else Gr(Kn,new Mr(Rr.name,Ie.id(Rr.name),z.getUniformLocation(pi,Rr.name),Rr));var An=z.getProgramParameter(pi,Er);ar.profile&&(Bt.stats.attributesCount=An);var Tn=Bt.attributes;for(Ln=0;Ln<An;++Ln)Rr=z.getActiveAttrib(pi,Ln),Rr&&Gr(Tn,new Mr(Rr.name,Ie.id(Rr.name),z.getAttribLocation(pi,Rr.name),Rr))}ar.profile&&(qe.getMaxUniformsCount=function(){var Bt=0;return rn.forEach(function(gr){gr.stats.uniformsCount>Bt&&(Bt=gr.stats.uniformsCount)}),Bt},qe.getMaxAttributesCount=function(){var Bt=0;return rn.forEach(function(gr){gr.stats.attributesCount>Bt&&(Bt=gr.stats.attributesCount)}),Bt});function un(){Br={},rr={};for(var Bt=0;Bt<rn.length;++Bt)Qr(rn[Bt],null,rn[Bt].attributes.map(function(gr){return[gr.location,gr.name]}))}return{clear:function(){var Bt=z.deleteShader.bind(z);$t(Br).forEach(Bt),Br={},$t(rr).forEach(Bt),rr={},rn.forEach(function(gr){z.deleteProgram(gr.program)}),rn.length=0,tn={},qe.shaderCount=0},program:function(Bt,gr,qr,Ln){K.command(Bt>=0,"missing vertex shader",qr),K.command(gr>=0,"missing fragment shader",qr);var Rr=tn[gr];Rr||(Rr=tn[gr]={});var wn=Rr[Bt];if(wn&&(wn.refCount++,!Ln))return wn;var cn=new yn(gr,Bt);return qe.shaderCount++,Qr(cn,qr,Ln),wn||(Rr[Bt]=cn),rn.push(cn),d(cn,{destroy:function(){if(cn.refCount--,cn.refCount<=0){z.deleteProgram(cn.program);var pi=rn.indexOf(cn);rn.splice(pi,1),qe.shaderCount--}Rr[cn.vertId].refCount<=0&&(z.deleteShader(rr[cn.vertId]),delete rr[cn.vertId],delete tn[cn.fragId][cn.vertId]),Object.keys(tn[cn.fragId]).length||(z.deleteShader(Br[cn.fragId]),delete Br[cn.fragId],delete tn[cn.fragId])}})},restore:un,shader:$r,frag:-1,vert:-1}}var hn=6408,nn=5121,Nn=3333,oi=5126;function ui(z,Ie,qe,ar,Br,rr,Mr){function Gr(rn){var sn;Ie.next===null?(K(Br.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),sn=nn):(K(Ie.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),sn=Ie.next.colorAttachments[0].texture._texture.type,K.optional(function(){rr.oes_texture_float?(K(sn===nn||sn===oi,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),sn===oi&&K(Mr.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):K(sn===nn,"Reading from a framebuffer is only allowed for the type 'uint8'")}));var yn=0,Qr=0,un=ar.framebufferWidth,Bt=ar.framebufferHeight,gr=null;C(rn)?gr=rn:rn&&(K.type(rn,"object","invalid arguments to regl.read()"),yn=rn.x|0,Qr=rn.y|0,K(yn>=0&&yn<ar.framebufferWidth,"invalid x offset for regl.read"),K(Qr>=0&&Qr<ar.framebufferHeight,"invalid y offset for regl.read"),un=(rn.width||ar.framebufferWidth-yn)|0,Bt=(rn.height||ar.framebufferHeight-Qr)|0,gr=rn.data||null),gr&&(sn===nn?K(gr instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):sn===oi&&K(gr instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),K(un>0&&un+yn<=ar.framebufferWidth,"invalid width for read pixels"),K(Bt>0&&Bt+Qr<=ar.framebufferHeight,"invalid height for read pixels"),qe();var qr=un*Bt*4;return gr||(sn===nn?gr=new Uint8Array(qr):sn===oi&&(gr=gr||new Float32Array(qr))),K.isTypedArray(gr,"data buffer for regl.read() must be a typedarray"),K(gr.byteLength>=qr,"data buffer for regl.read() too small"),z.pixelStorei(Nn,4),z.readPixels(yn,Qr,un,Bt,hn,sn,gr),gr}function $r(rn){var sn;return Ie.setFBO({framebuffer:rn.framebuffer},function(){sn=Gr(rn)}),sn}function tn(rn){return!rn||!("framebuffer"in rn)?Gr(rn):$r(rn)}return tn}function ai(z){return Array.prototype.slice.call(z)}function Qi(z){return ai(z).join("")}function Wn(){var z=0,Ie=[],qe=[];function ar(sn){for(var yn=0;yn<qe.length;++yn)if(qe[yn]===sn)return Ie[yn];var Qr="g"+z++;return Ie.push(Qr),qe.push(sn),Qr}function Br(){var sn=[];function yn(){sn.push.apply(sn,ai(arguments))}var Qr=[];function un(){var Bt="v"+z++;return Qr.push(Bt),arguments.length>0&&(sn.push(Bt,"="),sn.push.apply(sn,ai(arguments)),sn.push(";")),Bt}return d(yn,{def:un,toString:function(){return Qi([Qr.length>0?"var "+Qr.join(",")+";":"",Qi(sn)])}})}function rr(){var sn=Br(),yn=Br(),Qr=sn.toString,un=yn.toString;function Bt(gr,qr){yn(gr,qr,"=",sn.def(gr,qr),";")}return d(function(){sn.apply(sn,ai(arguments))},{def:sn.def,entry:sn,exit:yn,save:Bt,set:function(gr,qr,Ln){Bt(gr,qr),sn(gr,qr,"=",Ln,";")},toString:function(){return Qr()+un()}})}function Mr(){var sn=Qi(arguments),yn=rr(),Qr=rr(),un=yn.toString,Bt=Qr.toString;return d(yn,{then:function(){return yn.apply(yn,ai(arguments)),this},else:function(){return Qr.apply(Qr,ai(arguments)),this},toString:function(){var gr=Bt();return gr&&(gr="else{"+gr+"}"),Qi(["if(",sn,"){",un(),"}",gr])}})}var Gr=Br(),$r={};function tn(sn,yn){var Qr=[];function un(){var Rr="a"+Qr.length;return Qr.push(Rr),Rr}yn=yn||0;for(var Bt=0;Bt<yn;++Bt)un();var gr=rr(),qr=gr.toString,Ln=$r[sn]=d(gr,{arg:un,toString:function(){return Qi(["function(",Qr.join(),"){",qr(),"}"])}});return Ln}function rn(){var sn=['"use strict";',Gr,"return {"];Object.keys($r).forEach(function(Bt){sn.push('"',Bt,'":',$r[Bt].toString(),",")}),sn.push("}");var yn=Qi(sn).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Qr=typeof my!="undefined"&&!!my&&typeof my.showToast=="function",un=Qr?ye.Function.apply(null,Ie.concat(yn)):Function.apply(null,Ie.concat(yn));return un.apply(null,qe)}return{global:Gr,link:ar,block:Br,proc:tn,scope:rr,cond:Mr,compile:rn}}var Ei="xyzw".split(""),Gi=5121,xi=1,Ci=2,Q=0,J=1,O=2,k=3,oe=4,we=5,gt=6,Mt="dither",St="blend.enable",lr="blend.color",Wr="blend.equation",Xn="blend.func",Un="depth.enable",ci="depth.func",vi="depth.range",jn="depth.mask",aa="colorMask",da="cull.enable",Sa="cull.face",vo="frontFace",Ca="lineWidth",Bo="polygonOffset.enable",Za="polygonOffset.offset",Ui="sample.alpha",ga="sample.enable",io="sample.coverage",So="stencil.enable",Oi="stencil.mask",co="stencil.func",Ka="stencil.opFront",Js="stencil.opBack",Vl="scissor.enable",Hs="scissor.box",ju="viewport",Vu="profile",Gl="framebuffer",pl="vert",Hl="frag",pc="elements",el="primitive",hs="count",Ff="offset",yf="instances",_f="vao",ah="Width",oh="Height",ef=Gl+ah,Ac=Gl+oh,gp=ju+ah,Bf=ju+oh,sh="drawingBuffer",dc=sh+ah,tf=sh+oh,yp=[Xn,Wr,co,Ka,Js,io,ju,Hs,Za],rf=34962,uh=34963,_p=35632,xp=35633,Nh=3553,bp=34067,lh=2884,Sp=3042,nf=3024,Ep=2960,ts=2929,Nf=3089,zh=32823,zf=32926,Zf=32928,Zc=5126,xf=35664,bf=35665,Tc=35666,af=5124,of=35667,Uf=35668,Pc=35669,ch=35670,sf=35671,jf=35672,uf=35673,Uc=35674,Ru=35675,lf=35676,Sf=35678,Ef=35680,fh=4,cf=1028,tl=1029,Zh=2304,hh=2305,Uh=32775,jh=32776,Cp=519,Mc=7680,jc=0,Vh=1,Vf=32774,ff=513,dl=36160,wp=36064,Wl={"0":0,"1":1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Gh=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Xl={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Yl={"0":0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},hf={frag:_p,vert:xp},ph={cw:Zh,ccw:hh};function Gf(z){return Array.isArray(z)||C(z)||pt(z)}function dh(z){return z.sort(function(Ie,qe){return Ie===ju?-1:qe===ju?1:Ie<qe?-1:1})}function Es(z,Ie,qe,ar){this.thisDep=z,this.contextDep=Ie,this.propDep=qe,this.append=ar}function Wo(z){return z&&!(z.thisDep||z.contextDep||z.propDep)}function ps(z){return new Es(!1,!1,!1,z)}function wu(z,Ie){var qe=z.type;if(qe===Q){var ar=z.data.length;return new Es(!0,ar>=1,ar>=2,Ie)}else if(qe===oe){var Br=z.data;return new Es(Br.thisDep,Br.contextDep,Br.propDep,Ie)}else{if(qe===we)return new Es(!1,!1,!1,Ie);if(qe===gt){for(var rr=!1,Mr=!1,Gr=!1,$r=0;$r<z.data.length;++$r){var tn=z.data[$r];if(tn.type===J)Gr=!0;else if(tn.type===O)Mr=!0;else if(tn.type===k)rr=!0;else if(tn.type===Q){rr=!0;var rn=tn.data;rn>=1&&(Mr=!0),rn>=2&&(Gr=!0)}else tn.type===oe&&(rr=rr||tn.data.thisDep,Mr=Mr||tn.data.contextDep,Gr=Gr||tn.data.propDep)}return new Es(rr,Mr,Gr,Ie)}else return new Es(qe===k,qe===O,qe===J,Ie)}}var vh=new Es(!1,!1,!1,function(){});function Hh(z,Ie,qe,ar,Br,rr,Mr,Gr,$r,tn,rn,sn,yn,Qr,un){var Bt=tn.Record,gr={add:32774,subtract:32778,"reverse subtract":32779};qe.ext_blend_minmax&&(gr.min=Uh,gr.max=jh);var qr=qe.angle_instanced_arrays,Ln=qe.webgl_draw_buffers,Rr=qe.oes_vertex_array_object,wn={dirty:!0,profile:un.profile},cn={},pi=[],kr={},Ar={};function Kn(ke){return ke.replace(".","_")}function bn(ke,Se,it){var Ot=Kn(ke);pi.push(ke),cn[Ot]=wn[Ot]=!!it,kr[Ot]=Se}function an(ke,Se,it){var Ot=Kn(ke);pi.push(ke),Array.isArray(it)?(wn[Ot]=it.slice(),cn[Ot]=it.slice()):wn[Ot]=cn[Ot]=it,Ar[Ot]=Se}bn(Mt,nf),bn(St,Sp),an(lr,"blendColor",[0,0,0,0]),an(Wr,"blendEquationSeparate",[Vf,Vf]),an(Xn,"blendFuncSeparate",[Vh,jc,Vh,jc]),bn(Un,ts,!0),an(ci,"depthFunc",ff),an(vi,"depthRange",[0,1]),an(jn,"depthMask",!0),an(aa,aa,[!0,!0,!0,!0]),bn(da,lh),an(Sa,"cullFace",tl),an(vo,vo,hh),an(Ca,Ca,1),bn(Bo,zh),an(Za,"polygonOffset",[0,0]),bn(Ui,zf),bn(ga,Zf),an(io,"sampleCoverage",[1,!1]),bn(So,Ep),an(Oi,"stencilMask",-1),an(co,"stencilFunc",[Cp,0,-1]),an(Ka,"stencilOpSeparate",[cf,Mc,Mc,Mc]),an(Js,"stencilOpSeparate",[tl,Mc,Mc,Mc]),bn(Vl,Nf),an(Hs,"scissor",[0,0,z.drawingBufferWidth,z.drawingBufferHeight]),an(ju,ju,[0,0,z.drawingBufferWidth,z.drawingBufferHeight]);var An={gl:z,context:yn,strings:Ie,next:cn,current:wn,draw:sn,elements:rr,buffer:Br,shader:rn,attributes:tn.state,vao:tn,uniforms:$r,framebuffer:Gr,extensions:qe,timer:Qr,isBufferArgs:Gf},Tn={primTypes:Fr,compareFuncs:Xl,blendFuncs:Wl,blendEquations:gr,stencilOps:Yl,glTypes:ru,orientationType:ph};K.optional(function(){An.isArrayLike=xo}),Ln&&(Tn.backBuffer=[tl],Tn.drawBuffer=he(ar.maxDrawbuffers,function(ke){return ke===0?[0]:he(ke,function(Se){return wp+Se})}));var ji=0;function Bi(){var ke=Wn(),Se=ke.link,it=ke.global;ke.id=ji++,ke.batchId="0";var Ot=Se(An),sr=ke.shared={props:"a0"};Object.keys(An).forEach(function(nt){sr[nt]=it.def(Ot,".",nt)}),K.optional(function(){ke.CHECK=Se(K),ke.commandStr=K.guessCommand(),ke.command=Se(ke.commandStr),ke.assert=function(nt,Ne,Lt){nt("if(!(",Ne,"))",this.CHECK,".commandRaise(",Se(Lt),",",this.command,");")},Tn.invalidBlendCombinations=Gh});var _t=ke.next={},dt=ke.current={};Object.keys(Ar).forEach(function(nt){Array.isArray(wn[nt])&&(_t[nt]=it.def(sr.next,".",nt),dt[nt]=it.def(sr.current,".",nt))});var st=ke.constants={};Object.keys(Tn).forEach(function(nt){st[nt]=it.def(JSON.stringify(Tn[nt]))}),ke.invoke=function(nt,Ne){switch(Ne.type){case Q:var Lt=["this",sr.context,sr.props,ke.batchId];return nt.def(Se(Ne.data),".call(",Lt.slice(0,Math.max(Ne.data.length+1,4)),")");case J:return nt.def(sr.props,Ne.data);case O:return nt.def(sr.context,Ne.data);case k:return nt.def("this",Ne.data);case oe:return Ne.data.append(ke,nt),Ne.data.ref;case we:return Ne.data.toString();case gt:return Ne.data.map(function(Kt){return ke.invoke(nt,Kt)})}},ke.attribCache={};var Me={};return ke.scopeAttrib=function(nt){var Ne=Ie.id(nt);if(Ne in Me)return Me[Ne];var Lt=tn.scope[Ne];Lt||(Lt=tn.scope[Ne]=new Bt);var Kt=Me[Ne]=Se(Lt);return Kt},ke}function Mn(ke){var Se=ke.static,it=ke.dynamic,Ot;if(Vu in Se){var sr=!!Se[Vu];Ot=ps(function(dt,st){return sr}),Ot.enable=sr}else if(Vu in it){var _t=it[Vu];Ot=wu(_t,function(dt,st){return dt.invoke(st,_t)})}return Ot}function Pn(ke,Se){var it=ke.static,Ot=ke.dynamic;if(Gl in it){var sr=it[Gl];return sr?(sr=Gr.getFramebuffer(sr),K.command(sr,"invalid framebuffer object"),ps(function(dt,st){var Me=dt.link(sr),nt=dt.shared;st.set(nt.framebuffer,".next",Me);var Ne=nt.context;return st.set(Ne,"."+ef,Me+".width"),st.set(Ne,"."+Ac,Me+".height"),Me})):ps(function(dt,st){var Me=dt.shared;st.set(Me.framebuffer,".next","null");var nt=Me.context;return st.set(nt,"."+ef,nt+"."+dc),st.set(nt,"."+Ac,nt+"."+tf),"null"})}else if(Gl in Ot){var _t=Ot[Gl];return wu(_t,function(dt,st){var Me=dt.invoke(st,_t),nt=dt.shared,Ne=nt.framebuffer,Lt=st.def(Ne,".getFramebuffer(",Me,")");K.optional(function(){dt.assert(st,"!"+Me+"||"+Lt,"invalid framebuffer object")}),st.set(Ne,".next",Lt);var Kt=nt.context;return st.set(Kt,"."+ef,Lt+"?"+Lt+".width:"+Kt+"."+dc),st.set(Kt,"."+Ac,Lt+"?"+Lt+".height:"+Kt+"."+tf),Lt})}else return null}function wi(ke,Se,it){var Ot=ke.static,sr=ke.dynamic;function _t(Me){if(Me in Ot){var nt=Ot[Me];K.commandType(nt,"object","invalid "+Me,it.commandStr);var Ne=!0,Lt=nt.x|0,Kt=nt.y|0,Hr,mn;return"width"in nt?(Hr=nt.width|0,K.command(Hr>=0,"invalid "+Me,it.commandStr)):Ne=!1,"height"in nt?(mn=nt.height|0,K.command(mn>=0,"invalid "+Me,it.commandStr)):Ne=!1,new Es(!Ne&&Se&&Se.thisDep,!Ne&&Se&&Se.contextDep,!Ne&&Se&&Se.propDep,function(fn,zn){var Bn=fn.shared.context,Jn=Hr;"width"in nt||(Jn=zn.def(Bn,".",ef,"-",Lt));var $n=mn;return"height"in nt||($n=zn.def(Bn,".",Ac,"-",Kt)),[Lt,Kt,Jn,$n]})}else if(Me in sr){var vn=sr[Me],On=wu(vn,function(fn,zn){var Bn=fn.invoke(zn,vn);K.optional(function(){fn.assert(zn,Bn+"&&typeof "+Bn+'==="object"',"invalid "+Me)});var Jn=fn.shared.context,$n=zn.def(Bn,".x|0"),Vn=zn.def(Bn,".y|0"),li=zn.def('"width" in ',Bn,"?",Bn,".width|0:","(",Jn,".",ef,"-",$n,")"),Ia=zn.def('"height" in ',Bn,"?",Bn,".height|0:","(",Jn,".",Ac,"-",Vn,")");return K.optional(function(){fn.assert(zn,li+">=0&&"+Ia+">=0","invalid "+Me)}),[$n,Vn,li,Ia]});return Se&&(On.thisDep=On.thisDep||Se.thisDep,On.contextDep=On.contextDep||Se.contextDep,On.propDep=On.propDep||Se.propDep),On}else return Se?new Es(Se.thisDep,Se.contextDep,Se.propDep,function(fn,zn){var Bn=fn.shared.context;return[0,0,zn.def(Bn,".",ef),zn.def(Bn,".",Ac)]}):null}var dt=_t(ju);if(dt){var st=dt;dt=new Es(dt.thisDep,dt.contextDep,dt.propDep,function(Me,nt){var Ne=st.append(Me,nt),Lt=Me.shared.context;return nt.set(Lt,"."+gp,Ne[2]),nt.set(Lt,"."+Bf,Ne[3]),Ne})}return{viewport:dt,scissor_box:_t(Hs)}}function Di(ke,Se){var it=ke.static,Ot=typeof it[Hl]=="string"&&typeof it[pl]=="string";if(Ot){if(Object.keys(Se.dynamic).length>0)return null;var sr=Se.static,_t=Object.keys(sr);if(_t.length>0&&typeof sr[_t[0]]=="number"){for(var dt=[],st=0;st<_t.length;++st)K(typeof sr[_t[st]]=="number","must specify all vertex attribute locations when using vaos"),dt.push([sr[_t[st]]|0,_t[st]]);return dt}}return null}function la(ke,Se,it){var Ot=ke.static,sr=ke.dynamic;function _t(Ne){if(Ne in Ot){var Lt=Ie.id(Ot[Ne]);K.optional(function(){rn.shader(hf[Ne],Lt,K.guessCommand())});var Kt=ps(function(){return Lt});return Kt.id=Lt,Kt}else if(Ne in sr){var Hr=sr[Ne];return wu(Hr,function(mn,vn){var On=mn.invoke(vn,Hr),fn=vn.def(mn.shared.strings,".id(",On,")");return K.optional(function(){vn(mn.shared.shader,".shader(",hf[Ne],",",fn,",",mn.command,");")}),fn})}return null}var dt=_t(Hl),st=_t(pl),Me=null,nt;return Wo(dt)&&Wo(st)?(Me=rn.program(st.id,dt.id,null,it),nt=ps(function(Ne,Lt){return Ne.link(Me)})):nt=new Es(dt&&dt.thisDep||st&&st.thisDep,dt&&dt.contextDep||st&&st.contextDep,dt&&dt.propDep||st&&st.propDep,function(Ne,Lt){var Kt=Ne.shared.shader,Hr;dt?Hr=dt.append(Ne,Lt):Hr=Lt.def(Kt,".",Hl);var mn;st?mn=st.append(Ne,Lt):mn=Lt.def(Kt,".",pl);var vn=Kt+".program("+mn+","+Hr;return K.optional(function(){vn+=","+Ne.command}),Lt.def(vn+")")}),{frag:dt,vert:st,progVar:nt,program:Me}}function Mo(ke,Se){var it=ke.static,Ot=ke.dynamic,sr={},_t=!1;function dt(){if(_f in it){var zn=it[_f];return zn!==null&&tn.getVAO(zn)===null&&(zn=tn.createVAO(zn)),_t=!0,sr.vao=zn,ps(function(Jn){var $n=tn.getVAO(zn);return $n?Jn.link($n):"null"})}else if(_f in Ot){_t=!0;var Bn=Ot[_f];return wu(Bn,function(Jn,$n){var Vn=Jn.invoke($n,Bn);return $n.def(Jn.shared.vao+".getVAO("+Vn+")")})}return null}var st=dt(),Me=!1;function nt(){if(pc in it){var zn=it[pc];if(sr.elements=zn,Gf(zn)){var Bn=sr.elements=rr.create(zn,!0);zn=rr.getElements(Bn),Me=!0}else zn&&(zn=rr.getElements(zn),Me=!0,K.command(zn,"invalid elements",Se.commandStr));var Jn=ps(function(Vn,li){if(zn){var Ia=Vn.link(zn);return Vn.ELEMENTS=Ia,Ia}return Vn.ELEMENTS=null,null});return Jn.value=zn,Jn}else if(pc in Ot){Me=!0;var $n=Ot[pc];return wu($n,function(Vn,li){var Ia=Vn.shared,rs=Ia.isBufferArgs,Ml=Ia.elements,$a=Vn.invoke(li,$n),Da=li.def("null"),Qs=li.def(rs,"(",$a,")"),$l=Vn.cond(Qs).then(Da,"=",Ml,".createStream(",$a,");").else(Da,"=",Ml,".getElements(",$a,");");return K.optional(function(){Vn.assert($l.else,"!"+$a+"||"+Da,"invalid elements")}),li.entry($l),li.exit(Vn.cond(Qs).then(Ml,".destroyStream(",Da,");")),Vn.ELEMENTS=Da,Da})}else if(_t)return new Es(st.thisDep,st.contextDep,st.propDep,function(Vn,li){return li.def(Vn.shared.vao+".currentVAO?"+Vn.shared.elements+".getElements("+Vn.shared.vao+".currentVAO.elements):null")});return null}var Ne=nt();function Lt(){if(el in it){var zn=it[el];return sr.primitive=zn,K.commandParameter(zn,Fr,"invalid primitve",Se.commandStr),ps(function(Jn,$n){return Fr[zn]})}else if(el in Ot){var Bn=Ot[el];return wu(Bn,function(Jn,$n){var Vn=Jn.constants.primTypes,li=Jn.invoke($n,Bn);return K.optional(function(){Jn.assert($n,li+" in "+Vn,"invalid primitive, must be one of "+Object.keys(Fr))}),$n.def(Vn,"[",li,"]")})}else{if(Me)return Wo(Ne)?Ne.value?ps(function(Jn,$n){return $n.def(Jn.ELEMENTS,".primType")}):ps(function(){return fh}):new Es(Ne.thisDep,Ne.contextDep,Ne.propDep,function(Jn,$n){var Vn=Jn.ELEMENTS;return $n.def(Vn,"?",Vn,".primType:",fh)});if(_t)return new Es(st.thisDep,st.contextDep,st.propDep,function(Jn,$n){return $n.def(Jn.shared.vao+".currentVAO?"+Jn.shared.vao+".currentVAO.primitive:"+fh)})}return null}function Kt(zn,Bn){if(zn in it){var Jn=it[zn]|0;return Bn?sr.offset=Jn:sr.instances=Jn,K.command(!Bn||Jn>=0,"invalid "+zn,Se.commandStr),ps(function(Vn,li){return Bn&&(Vn.OFFSET=Jn),Jn})}else if(zn in Ot){var $n=Ot[zn];return wu($n,function(Vn,li){var Ia=Vn.invoke(li,$n);return Bn&&(Vn.OFFSET=Ia,K.optional(function(){Vn.assert(li,Ia+">=0","invalid "+zn)})),Ia})}else if(Bn){if(Me)return ps(function(Vn,li){return Vn.OFFSET=0,0});if(_t)return new Es(st.thisDep,st.contextDep,st.propDep,function(Vn,li){return li.def(Vn.shared.vao+".currentVAO?"+Vn.shared.vao+".currentVAO.offset:0")})}else if(_t)return new Es(st.thisDep,st.contextDep,st.propDep,function(Vn,li){return li.def(Vn.shared.vao+".currentVAO?"+Vn.shared.vao+".currentVAO.instances:-1")});return null}var Hr=Kt(Ff,!0);function mn(){if(hs in it){var zn=it[hs]|0;return sr.count=zn,K.command(typeof zn=="number"&&zn>=0,"invalid vertex count",Se.commandStr),ps(function(){return zn})}else if(hs in Ot){var Bn=Ot[hs];return wu(Bn,function(li,Ia){var rs=li.invoke(Ia,Bn);return K.optional(function(){li.assert(Ia,"typeof "+rs+'==="number"&&'+rs+">=0&&"+rs+"===("+rs+"|0)","invalid vertex count")}),rs})}else if(Me)if(Wo(Ne)){if(Ne)return Hr?new Es(Hr.thisDep,Hr.contextDep,Hr.propDep,function(li,Ia){var rs=Ia.def(li.ELEMENTS,".vertCount-",li.OFFSET);return K.optional(function(){li.assert(Ia,rs+">=0","invalid vertex offset/element buffer too small")}),rs}):ps(function(li,Ia){return Ia.def(li.ELEMENTS,".vertCount")});var Jn=ps(function(){return-1});return K.optional(function(){Jn.MISSING=!0}),Jn}else{var $n=new Es(Ne.thisDep||Hr.thisDep,Ne.contextDep||Hr.contextDep,Ne.propDep||Hr.propDep,function(li,Ia){var rs=li.ELEMENTS;return li.OFFSET?Ia.def(rs,"?",rs,".vertCount-",li.OFFSET,":-1"):Ia.def(rs,"?",rs,".vertCount:-1")});return K.optional(function(){$n.DYNAMIC=!0}),$n}else if(_t){var Vn=new Es(st.thisDep,st.contextDep,st.propDep,function(li,Ia){return Ia.def(li.shared.vao,".currentVAO?",li.shared.vao,".currentVAO.count:-1")});return Vn}return null}var vn=Lt(),On=mn(),fn=Kt(yf,!1);return{elements:Ne,primitive:vn,count:On,instances:fn,offset:Hr,vao:st,vaoActive:_t,elementsActive:Me,static:sr}}function Io(ke,Se){var it=ke.static,Ot=ke.dynamic,sr={};return pi.forEach(function(_t){var dt=Kn(_t);function st(Me,nt){if(_t in it){var Ne=Me(it[_t]);sr[dt]=ps(function(){return Ne})}else if(_t in Ot){var Lt=Ot[_t];sr[dt]=wu(Lt,function(Kt,Hr){return nt(Kt,Hr,Kt.invoke(Hr,Lt))})}}switch(_t){case da:case St:case Mt:case So:case Un:case Vl:case Bo:case Ui:case ga:case jn:return st(function(Me){return K.commandType(Me,"boolean",_t,Se.commandStr),Me},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,"typeof "+Ne+'==="boolean"',"invalid flag "+_t,Me.commandStr)}),Ne});case ci:return st(function(Me){return K.commandParameter(Me,Xl,"invalid "+_t,Se.commandStr),Xl[Me]},function(Me,nt,Ne){var Lt=Me.constants.compareFuncs;return K.optional(function(){Me.assert(nt,Ne+" in "+Lt,"invalid "+_t+", must be one of "+Object.keys(Xl))}),nt.def(Lt,"[",Ne,"]")});case vi:return st(function(Me){return K.command(xo(Me)&&Me.length===2&&typeof Me[0]=="number"&&typeof Me[1]=="number"&&Me[0]<=Me[1],"depth range is 2d array",Se.commandStr),Me},function(Me,nt,Ne){K.optional(function(){Me.assert(nt,Me.shared.isArrayLike+"("+Ne+")&&"+Ne+".length===2&&typeof "+Ne+'[0]==="number"&&typeof '+Ne+'[1]==="number"&&'+Ne+"[0]<="+Ne+"[1]","depth range must be a 2d array")});var Lt=nt.def("+",Ne,"[0]"),Kt=nt.def("+",Ne,"[1]");return[Lt,Kt]});case Xn:return st(function(Me){K.commandType(Me,"object","blend.func",Se.commandStr);var nt="srcRGB"in Me?Me.srcRGB:Me.src,Ne="srcAlpha"in Me?Me.srcAlpha:Me.src,Lt="dstRGB"in Me?Me.dstRGB:Me.dst,Kt="dstAlpha"in Me?Me.dstAlpha:Me.dst;return K.commandParameter(nt,Wl,dt+".srcRGB",Se.commandStr),K.commandParameter(Ne,Wl,dt+".srcAlpha",Se.commandStr),K.commandParameter(Lt,Wl,dt+".dstRGB",Se.commandStr),K.commandParameter(Kt,Wl,dt+".dstAlpha",Se.commandStr),K.command(Gh.indexOf(nt+", "+Lt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+nt+", "+Lt+")",Se.commandStr),[Wl[nt],Wl[Lt],Wl[Ne],Wl[Kt]]},function(Me,nt,Ne){var Lt=Me.constants.blendFuncs;K.optional(function(){Me.assert(nt,Ne+"&&typeof "+Ne+'==="object"',"invalid blend func, must be an object")});function Kt(Bn,Jn){var $n=nt.def('"',Bn,Jn,'" in ',Ne,"?",Ne,".",Bn,Jn,":",Ne,".",Bn);return K.optional(function(){Me.assert(nt,$n+" in "+Lt,"invalid "+_t+"."+Bn+Jn+", must be one of "+Object.keys(Wl))}),$n}var Hr=Kt("src","RGB"),mn=Kt("dst","RGB");K.optional(function(){var Bn=Me.constants.invalidBlendCombinations;Me.assert(nt,Bn+".indexOf("+Hr+'+", "+'+mn+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var vn=nt.def(Lt,"[",Hr,"]"),On=nt.def(Lt,"[",Kt("src","Alpha"),"]"),fn=nt.def(Lt,"[",mn,"]"),zn=nt.def(Lt,"[",Kt("dst","Alpha"),"]");return[vn,fn,On,zn]});case Wr:return st(function(Me){if(typeof Me=="string")return K.commandParameter(Me,gr,"invalid "+_t,Se.commandStr),[gr[Me],gr[Me]];if(typeof Me=="object")return K.commandParameter(Me.rgb,gr,_t+".rgb",Se.commandStr),K.commandParameter(Me.alpha,gr,_t+".alpha",Se.commandStr),[gr[Me.rgb],gr[Me.alpha]];K.commandRaise("invalid blend.equation",Se.commandStr)},function(Me,nt,Ne){var Lt=Me.constants.blendEquations,Kt=nt.def(),Hr=nt.def(),mn=Me.cond("typeof ",Ne,'==="string"');return K.optional(function(){function vn(On,fn,zn){Me.assert(On,zn+" in "+Lt,"invalid "+fn+", must be one of "+Object.keys(gr))}vn(mn.then,_t,Ne),Me.assert(mn.else,Ne+"&&typeof "+Ne+'==="object"',"invalid "+_t),vn(mn.else,_t+".rgb",Ne+".rgb"),vn(mn.else,_t+".alpha",Ne+".alpha")}),mn.then(Kt,"=",Hr,"=",Lt,"[",Ne,"];"),mn.else(Kt,"=",Lt,"[",Ne,".rgb];",Hr,"=",Lt,"[",Ne,".alpha];"),nt(mn),[Kt,Hr]});case lr:return st(function(Me){return K.command(xo(Me)&&Me.length===4,"blend.color must be a 4d array",Se.commandStr),he(4,function(nt){return+Me[nt]})},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,Me.shared.isArrayLike+"("+Ne+")&&"+Ne+".length===4","blend.color must be a 4d array")}),he(4,function(Lt){return nt.def("+",Ne,"[",Lt,"]")})});case Oi:return st(function(Me){return K.commandType(Me,"number",dt,Se.commandStr),Me|0},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,"typeof "+Ne+'==="number"',"invalid stencil.mask")}),nt.def(Ne,"|0")});case co:return st(function(Me){K.commandType(Me,"object",dt,Se.commandStr);var nt=Me.cmp||"keep",Ne=Me.ref||0,Lt="mask"in Me?Me.mask:-1;return K.commandParameter(nt,Xl,_t+".cmp",Se.commandStr),K.commandType(Ne,"number",_t+".ref",Se.commandStr),K.commandType(Lt,"number",_t+".mask",Se.commandStr),[Xl[nt],Ne,Lt]},function(Me,nt,Ne){var Lt=Me.constants.compareFuncs;K.optional(function(){function vn(){Me.assert(nt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}vn(Ne+"&&typeof ",Ne,'==="object"'),vn('!("cmp" in ',Ne,")||(",Ne,".cmp in ",Lt,")")});var Kt=nt.def('"cmp" in ',Ne,"?",Lt,"[",Ne,".cmp]",":",Mc),Hr=nt.def(Ne,".ref|0"),mn=nt.def('"mask" in ',Ne,"?",Ne,".mask|0:-1");return[Kt,Hr,mn]});case Ka:case Js:return st(function(Me){K.commandType(Me,"object",dt,Se.commandStr);var nt=Me.fail||"keep",Ne=Me.zfail||"keep",Lt=Me.zpass||"keep";return K.commandParameter(nt,Yl,_t+".fail",Se.commandStr),K.commandParameter(Ne,Yl,_t+".zfail",Se.commandStr),K.commandParameter(Lt,Yl,_t+".zpass",Se.commandStr),[_t===Js?tl:cf,Yl[nt],Yl[Ne],Yl[Lt]]},function(Me,nt,Ne){var Lt=Me.constants.stencilOps;K.optional(function(){Me.assert(nt,Ne+"&&typeof "+Ne+'==="object"',"invalid "+_t)});function Kt(Hr){return K.optional(function(){Me.assert(nt,'!("'+Hr+'" in '+Ne+")||("+Ne+"."+Hr+" in "+Lt+")","invalid "+_t+"."+Hr+", must be one of "+Object.keys(Yl))}),nt.def('"',Hr,'" in ',Ne,"?",Lt,"[",Ne,".",Hr,"]:",Mc)}return[_t===Js?tl:cf,Kt("fail"),Kt("zfail"),Kt("zpass")]});case Za:return st(function(Me){K.commandType(Me,"object",dt,Se.commandStr);var nt=Me.factor|0,Ne=Me.units|0;return K.commandType(nt,"number",dt+".factor",Se.commandStr),K.commandType(Ne,"number",dt+".units",Se.commandStr),[nt,Ne]},function(Me,nt,Ne){K.optional(function(){Me.assert(nt,Ne+"&&typeof "+Ne+'==="object"',"invalid "+_t)});var Lt=nt.def(Ne,".factor|0"),Kt=nt.def(Ne,".units|0");return[Lt,Kt]});case Sa:return st(function(Me){var nt=0;return Me==="front"?nt=cf:Me==="back"&&(nt=tl),K.command(!!nt,dt,Se.commandStr),nt},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,Ne+'==="front"||'+Ne+'==="back"',"invalid cull.face")}),nt.def(Ne,'==="front"?',cf,":",tl)});case Ca:return st(function(Me){return K.command(typeof Me=="number"&&Me>=ar.lineWidthDims[0]&&Me<=ar.lineWidthDims[1],"invalid line width, must be a positive number between "+ar.lineWidthDims[0]+" and "+ar.lineWidthDims[1],Se.commandStr),Me},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,"typeof "+Ne+'==="number"&&'+Ne+">="+ar.lineWidthDims[0]+"&&"+Ne+"<="+ar.lineWidthDims[1],"invalid line width")}),Ne});case vo:return st(function(Me){return K.commandParameter(Me,ph,dt,Se.commandStr),ph[Me]},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,Ne+'==="cw"||'+Ne+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),nt.def(Ne+'==="cw"?'+Zh+":"+hh)});case aa:return st(function(Me){return K.command(xo(Me)&&Me.length===4,"color.mask must be length 4 array",Se.commandStr),Me.map(function(nt){return!!nt})},function(Me,nt,Ne){return K.optional(function(){Me.assert(nt,Me.shared.isArrayLike+"("+Ne+")&&"+Ne+".length===4","invalid color.mask")}),he(4,function(Lt){return"!!"+Ne+"["+Lt+"]"})});case io:return st(function(Me){K.command(typeof Me=="object"&&Me,dt,Se.commandStr);var nt="value"in Me?Me.value:1,Ne=!!Me.invert;return K.command(typeof nt=="number"&&nt>=0&&nt<=1,"sample.coverage.value must be a number between 0 and 1",Se.commandStr),[nt,Ne]},function(Me,nt,Ne){K.optional(function(){Me.assert(nt,Ne+"&&typeof "+Ne+'==="object"',"invalid sample.coverage")});var Lt=nt.def('"value" in ',Ne,"?+",Ne,".value:1"),Kt=nt.def("!!",Ne,".invert");return[Lt,Kt]})}}),sr}function ca(ke,Se){var it=ke.static,Ot=ke.dynamic,sr={};return Object.keys(it).forEach(function(_t){var dt=it[_t],st;if(typeof dt=="number"||typeof dt=="boolean")st=ps(function(){return dt});else if(typeof dt=="function"){var Me=dt._reglType;Me==="texture2d"||Me==="textureCube"?st=ps(function(nt){return nt.link(dt)}):Me==="framebuffer"||Me==="framebufferCube"?(K.command(dt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+_t+'"',Se.commandStr),st=ps(function(nt){return nt.link(dt.color[0])})):K.commandRaise('invalid data for uniform "'+_t+'"',Se.commandStr)}else xo(dt)?st=ps(function(nt){var Ne=nt.global.def("[",he(dt.length,function(Lt){return K.command(typeof dt[Lt]=="number"||typeof dt[Lt]=="boolean","invalid uniform "+_t,nt.commandStr),dt[Lt]}),"]");return Ne}):K.commandRaise('invalid or missing data for uniform "'+_t+'"',Se.commandStr);st.value=dt,sr[_t]=st}),Object.keys(Ot).forEach(function(_t){var dt=Ot[_t];sr[_t]=wu(dt,function(st,Me){return st.invoke(Me,dt)})}),sr}function Ns(ke,Se){var it=ke.static,Ot=ke.dynamic,sr={};return Object.keys(it).forEach(function(_t){var dt=it[_t],st=Ie.id(_t),Me=new Bt;if(Gf(dt))Me.state=xi,Me.buffer=Br.getBuffer(Br.create(dt,rf,!1,!0)),Me.type=0;else{var nt=Br.getBuffer(dt);if(nt)Me.state=xi,Me.buffer=nt,Me.type=0;else if(K.command(typeof dt=="object"&&dt,"invalid data for attribute "+_t,Se.commandStr),"constant"in dt){var Ne=dt.constant;Me.buffer="null",Me.state=Ci,typeof Ne=="number"?Me.x=Ne:(K.command(xo(Ne)&&Ne.length>0&&Ne.length<=4,"invalid constant for attribute "+_t,Se.commandStr),Ei.forEach(function(fn,zn){zn<Ne.length&&(Me[fn]=Ne[zn])}))}else{Gf(dt.buffer)?nt=Br.getBuffer(Br.create(dt.buffer,rf,!1,!0)):nt=Br.getBuffer(dt.buffer),K.command(!!nt,'missing buffer for attribute "'+_t+'"',Se.commandStr);var Lt=dt.offset|0;K.command(Lt>=0,'invalid offset for attribute "'+_t+'"',Se.commandStr);var Kt=dt.stride|0;K.command(Kt>=0&&Kt<256,'invalid stride for attribute "'+_t+'", must be integer betweeen [0, 255]',Se.commandStr);var Hr=dt.size|0;K.command(!("size"in dt)||Hr>0&&Hr<=4,'invalid size for attribute "'+_t+'", must be 1,2,3,4',Se.commandStr);var mn=!!dt.normalized,vn=0;"type"in dt&&(K.commandParameter(dt.type,ru,"invalid type for attribute "+_t,Se.commandStr),vn=ru[dt.type]);var On=dt.divisor|0;K.optional(function(){"divisor"in dt&&(K.command(On===0||qr,'cannot specify divisor for attribute "'+_t+'", instancing not supported',Se.commandStr),K.command(On>=0,'invalid divisor for attribute "'+_t+'"',Se.commandStr));var fn=Se.commandStr,zn=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(dt).forEach(function(Bn){K.command(zn.indexOf(Bn)>=0,'unknown parameter "'+Bn+'" for attribute pointer "'+_t+'" (valid parameters are '+zn+")",fn)})}),Me.buffer=nt,Me.state=xi,Me.size=Hr,Me.normalized=mn,Me.type=vn||nt.dtype,Me.offset=Lt,Me.stride=Kt,Me.divisor=On}}sr[_t]=ps(function(fn,zn){var Bn=fn.attribCache;if(st in Bn)return Bn[st];var Jn={isStream:!1};return Object.keys(Me).forEach(function($n){Jn[$n]=Me[$n]}),Me.buffer&&(Jn.buffer=fn.link(Me.buffer),Jn.type=Jn.type||Jn.buffer+".dtype"),Bn[st]=Jn,Jn})}),Object.keys(Ot).forEach(function(_t){var dt=Ot[_t];function st(Me,nt){var Ne=Me.invoke(nt,dt),Lt=Me.shared,Kt=Me.constants,Hr=Lt.isBufferArgs,mn=Lt.buffer;K.optional(function(){Me.assert(nt,Ne+"&&(typeof "+Ne+'==="object"||typeof '+Ne+'==="function")&&('+Hr+"("+Ne+")||"+mn+".getBuffer("+Ne+")||"+mn+".getBuffer("+Ne+".buffer)||"+Hr+"("+Ne+'.buffer)||("constant" in '+Ne+"&&(typeof "+Ne+'.constant==="number"||'+Lt.isArrayLike+"("+Ne+".constant))))",'invalid dynamic attribute "'+_t+'"')});var vn={isStream:nt.def(!1)},On=new Bt;On.state=xi,Object.keys(On).forEach(function(Jn){vn[Jn]=nt.def(""+On[Jn])});var fn=vn.buffer,zn=vn.type;nt("if(",Hr,"(",Ne,")){",vn.isStream,"=true;",fn,"=",mn,".createStream(",rf,",",Ne,");",zn,"=",fn,".dtype;","}else{",fn,"=",mn,".getBuffer(",Ne,");","if(",fn,"){",zn,"=",fn,".dtype;",'}else if("constant" in ',Ne,"){",vn.state,"=",Ci,";","if(typeof "+Ne+'.constant === "number"){',vn[Ei[0]],"=",Ne,".constant;",Ei.slice(1).map(function(Jn){return vn[Jn]}).join("="),"=0;","}else{",Ei.map(function(Jn,$n){return vn[Jn]+"="+Ne+".constant.length>"+$n+"?"+Ne+".constant["+$n+"]:0;"}).join(""),"}}else{","if(",Hr,"(",Ne,".buffer)){",fn,"=",mn,".createStream(",rf,",",Ne,".buffer);","}else{",fn,"=",mn,".getBuffer(",Ne,".buffer);","}",zn,'="type" in ',Ne,"?",Kt.glTypes,"[",Ne,".type]:",fn,".dtype;",vn.normalized,"=!!",Ne,".normalized;");function Bn(Jn){nt(vn[Jn],"=",Ne,".",Jn,"|0;")}return Bn("size"),Bn("offset"),Bn("stride"),Bn("divisor"),nt("}}"),nt.exit("if(",vn.isStream,"){",mn,".destroyStream(",fn,");","}"),vn}sr[_t]=wu(dt,st)}),sr}function mo(ke){var Se=ke.static,it=ke.dynamic,Ot={};return Object.keys(Se).forEach(function(sr){var _t=Se[sr];Ot[sr]=ps(function(dt,st){return typeof _t=="number"||typeof _t=="boolean"?""+_t:dt.link(_t)})}),Object.keys(it).forEach(function(sr){var _t=it[sr];Ot[sr]=wu(_t,function(dt,st){return dt.invoke(st,_t)})}),Ot}function ds(ke,Se,it,Ot,sr){var _t=ke.static,dt=ke.dynamic;K.optional(function(){var Bn=[Gl,pl,Hl,pc,el,Ff,hs,yf,Vu,_f].concat(pi);function Jn($n){Object.keys($n).forEach(function(Vn){K.command(Bn.indexOf(Vn)>=0,'unknown parameter "'+Vn+'"',sr.commandStr)})}Jn(_t),Jn(dt)});var st=Di(ke,Se),Me=Pn(ke,sr),nt=wi(ke,Me,sr),Ne=Mo(ke,sr),Lt=Io(ke,sr),Kt=la(ke,sr,st);function Hr(Bn){var Jn=nt[Bn];Jn&&(Lt[Bn]=Jn)}Hr(ju),Hr(Kn(Hs));var mn=Object.keys(Lt).length>0,vn={framebuffer:Me,draw:Ne,shader:Kt,state:Lt,dirty:mn,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(vn.profile=Mn(ke,sr),vn.uniforms=ca(it,sr),vn.drawVAO=vn.scopeVAO=Ne.vao,!vn.drawVAO&&Kt.program&&!st&&qe.angle_instanced_arrays&&Ne.static.elements){var On=!0,fn=Kt.program.attributes.map(function(Bn){var Jn=Se.static[Bn];return On=On&&!!Jn,Jn});if(On&&fn.length>0){var zn=tn.getVAO(tn.createVAO({attributes:fn,elements:Ne.static.elements}));vn.drawVAO=new Es(null,null,null,function(Bn,Jn){return Bn.link(zn)}),vn.useVAO=!0}}return st?vn.useVAO=!0:vn.attributes=Ns(Se,sr),vn.context=mo(Ot,sr),vn}function Xo(ke,Se,it){var Ot=ke.shared,sr=Ot.context,_t=ke.scope();Object.keys(it).forEach(function(dt){Se.save(sr,"."+dt);var st=it[dt],Me=st.append(ke,Se);Array.isArray(Me)?_t(sr,".",dt,"=[",Me.join(),"];"):_t(sr,".",dt,"=",Me,";")}),Se(_t)}function Cs(ke,Se,it,Ot){var sr=ke.shared,_t=sr.gl,dt=sr.framebuffer,st;Ln&&(st=Se.def(sr.extensions,".webgl_draw_buffers"));var Me=ke.constants,nt=Me.drawBuffer,Ne=Me.backBuffer,Lt;it?Lt=it.append(ke,Se):Lt=Se.def(dt,".next"),Ot||Se("if(",Lt,"!==",dt,".cur){"),Se("if(",Lt,"){",_t,".bindFramebuffer(",dl,",",Lt,".framebuffer);"),Ln&&Se(st,".drawBuffersWEBGL(",nt,"[",Lt,".colorAttachments.length]);"),Se("}else{",_t,".bindFramebuffer(",dl,",null);"),Ln&&Se(st,".drawBuffersWEBGL(",Ne,");"),Se("}",dt,".cur=",Lt,";"),Ot||Se("}")}function zs(ke,Se,it){var Ot=ke.shared,sr=Ot.gl,_t=ke.current,dt=ke.next,st=Ot.current,Me=Ot.next,nt=ke.cond(st,".dirty");pi.forEach(function(Ne){var Lt=Kn(Ne);if(!(Lt in it.state)){var Kt,Hr;if(Lt in dt){Kt=dt[Lt],Hr=_t[Lt];var mn=he(wn[Lt].length,function(On){return nt.def(Kt,"[",On,"]")});nt(ke.cond(mn.map(function(On,fn){return On+"!=="+Hr+"["+fn+"]"}).join("||")).then(sr,".",Ar[Lt],"(",mn,");",mn.map(function(On,fn){return Hr+"["+fn+"]="+On}).join(";"),";"))}else{Kt=nt.def(Me,".",Lt);var vn=ke.cond(Kt,"!==",st,".",Lt);nt(vn),Lt in kr?vn(ke.cond(Kt).then(sr,".enable(",kr[Lt],");").else(sr,".disable(",kr[Lt],");"),st,".",Lt,"=",Kt,";"):vn(sr,".",Ar[Lt],"(",Kt,");",st,".",Lt,"=",Kt,";")}}}),Object.keys(it.state).length===0&&nt(st,".dirty=false;"),Se(nt)}function ws(ke,Se,it,Ot){var sr=ke.shared,_t=ke.current,dt=sr.current,st=sr.gl;dh(Object.keys(it)).forEach(function(Me){var nt=it[Me];if(!(Ot&&!Ot(nt))){var Ne=nt.append(ke,Se);if(kr[Me]){var Lt=kr[Me];Wo(nt)?Ne?Se(st,".enable(",Lt,");"):Se(st,".disable(",Lt,");"):Se(ke.cond(Ne).then(st,".enable(",Lt,");").else(st,".disable(",Lt,");")),Se(dt,".",Me,"=",Ne,";")}else if(xo(Ne)){var Kt=_t[Me];Se(st,".",Ar[Me],"(",Ne,");",Ne.map(function(Hr,mn){return Kt+"["+mn+"]="+Hr}).join(";"),";")}else Se(st,".",Ar[Me],"(",Ne,");",dt,".",Me,"=",Ne,";")}})}function Yo(ke,Se){qr&&(ke.instancing=Se.def(ke.shared.extensions,".angle_instanced_arrays"))}function Hi(ke,Se,it,Ot,sr){var _t=ke.shared,dt=ke.stats,st=_t.current,Me=_t.timer,nt=it.profile;function Ne(){var Bn=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";return Bn||typeof performance=="undefined"?"Date.now()":"performance.now()"}var Lt,Kt;function Hr(Bn){Lt=Se.def(),Bn(Lt,"=",Ne(),";"),typeof sr=="string"?Bn(dt,".count+=",sr,";"):Bn(dt,".count++;"),Qr&&(Ot?(Kt=Se.def(),Bn(Kt,"=",Me,".getNumPendingQueries();")):Bn(Me,".beginQuery(",dt,");"))}function mn(Bn){Bn(dt,".cpuTime+=",Ne(),"-",Lt,";"),Qr&&(Ot?Bn(Me,".pushScopeStats(",Kt,",",Me,".getNumPendingQueries(),",dt,");"):Bn(Me,".endQuery();"))}function vn(Bn){var Jn=Se.def(st,".profile");Se(st,".profile=",Bn,";"),Se.exit(st,".profile=",Jn,";")}var On;if(nt){if(Wo(nt)){nt.enable?(Hr(Se),mn(Se.exit),vn("true")):vn("false");return}On=nt.append(ke,Se),vn(On)}else On=Se.def(st,".profile");var fn=ke.block();Hr(fn),Se("if(",On,"){",fn,"}");var zn=ke.block();mn(zn),Se.exit("if(",On,"){",zn,"}")}function Ko(ke,Se,it,Ot,sr){var _t=ke.shared;function dt(Me){switch(Me){case xf:case of:case sf:return 2;case bf:case Uf:case jf:return 3;case Tc:case Pc:case uf:return 4;default:return 1}}function st(Me,nt,Ne){var Lt=_t.gl,Kt=Se.def(Me,".location"),Hr=Se.def(_t.attributes,"[",Kt,"]"),mn=Ne.state,vn=Ne.buffer,On=[Ne.x,Ne.y,Ne.z,Ne.w],fn=["buffer","normalized","offset","stride"];function zn(){Se("if(!",Hr,".buffer){",Lt,".enableVertexAttribArray(",Kt,");}");var Jn=Ne.type,$n;if(Ne.size?$n=Se.def(Ne.size,"||",nt):$n=nt,Se("if(",Hr,".type!==",Jn,"||",Hr,".size!==",$n,"||",fn.map(function(li){return Hr+"."+li+"!=="+Ne[li]}).join("||"),"){",Lt,".bindBuffer(",rf,",",vn,".buffer);",Lt,".vertexAttribPointer(",[Kt,$n,Jn,Ne.normalized,Ne.stride,Ne.offset],");",Hr,".type=",Jn,";",Hr,".size=",$n,";",fn.map(function(li){return Hr+"."+li+"="+Ne[li]+";"}).join(""),"}"),qr){var Vn=Ne.divisor;Se("if(",Hr,".divisor!==",Vn,"){",ke.instancing,".vertexAttribDivisorANGLE(",[Kt,Vn],");",Hr,".divisor=",Vn,";}")}}function Bn(){Se("if(",Hr,".buffer){",Lt,".disableVertexAttribArray(",Kt,");",Hr,".buffer=null;","}if(",Ei.map(function(Jn,$n){return Hr+"."+Jn+"!=="+On[$n]}).join("||"),"){",Lt,".vertexAttrib4f(",Kt,",",On,");",Ei.map(function(Jn,$n){return Hr+"."+Jn+"="+On[$n]+";"}).join(""),"}")}mn===xi?zn():mn===Ci?Bn():(Se("if(",mn,"===",xi,"){"),zn(),Se("}else{"),Bn(),Se("}"))}Ot.forEach(function(Me){var nt=Me.name,Ne=it.attributes[nt],Lt;if(Ne){if(!sr(Ne))return;Lt=Ne.append(ke,Se)}else{if(!sr(vh))return;var Kt=ke.scopeAttrib(nt);K.optional(function(){ke.assert(Se,Kt+".state","missing attribute "+nt)}),Lt={},Object.keys(new Bt).forEach(function(Hr){Lt[Hr]=Se.def(Kt,".",Hr)})}st(ke.link(Me),dt(Me.info.type),Lt)})}function Ma(ke,Se,it,Ot,sr,_t){for(var dt=ke.shared,st=dt.gl,Me,nt=0;nt<Ot.length;++nt){var Ne=Ot[nt],Lt=Ne.name,Kt=Ne.info.type,Hr=it.uniforms[Lt],mn=ke.link(Ne),vn=mn+".location",On;if(Hr){if(!sr(Hr))continue;if(Wo(Hr)){var fn=Hr.value;if(K.command(fn!==null&&typeof fn!="undefined",'missing uniform "'+Lt+'"',ke.commandStr),Kt===Sf||Kt===Ef){K.command(typeof fn=="function"&&(Kt===Sf&&(fn._reglType==="texture2d"||fn._reglType==="framebuffer")||Kt===Ef&&(fn._reglType==="textureCube"||fn._reglType==="framebufferCube")),"invalid texture for uniform "+Lt,ke.commandStr);var zn=ke.link(fn._texture||fn.color[0]._texture);Se(st,".uniform1i(",vn,",",zn+".bind());"),Se.exit(zn,".unbind();")}else if(Kt===Uc||Kt===Ru||Kt===lf){K.optional(function(){K.command(xo(fn),"invalid matrix for uniform "+Lt,ke.commandStr),K.command(Kt===Uc&&fn.length===4||Kt===Ru&&fn.length===9||Kt===lf&&fn.length===16,"invalid length for matrix uniform "+Lt,ke.commandStr)});var Bn=ke.global.def("new Float32Array(["+Array.prototype.slice.call(fn)+"])"),Jn=2;Kt===Ru?Jn=3:Kt===lf&&(Jn=4),Se(st,".uniformMatrix",Jn,"fv(",vn,",false,",Bn,");")}else{switch(Kt){case Zc:K.commandType(fn,"number","uniform "+Lt,ke.commandStr),Me="1f";break;case xf:K.command(xo(fn)&&fn.length===2,"uniform "+Lt,ke.commandStr),Me="2f";break;case bf:K.command(xo(fn)&&fn.length===3,"uniform "+Lt,ke.commandStr),Me="3f";break;case Tc:K.command(xo(fn)&&fn.length===4,"uniform "+Lt,ke.commandStr),Me="4f";break;case ch:K.commandType(fn,"boolean","uniform "+Lt,ke.commandStr),Me="1i";break;case af:K.commandType(fn,"number","uniform "+Lt,ke.commandStr),Me="1i";break;case sf:K.command(xo(fn)&&fn.length===2,"uniform "+Lt,ke.commandStr),Me="2i";break;case of:K.command(xo(fn)&&fn.length===2,"uniform "+Lt,ke.commandStr),Me="2i";break;case jf:K.command(xo(fn)&&fn.length===3,"uniform "+Lt,ke.commandStr),Me="3i";break;case Uf:K.command(xo(fn)&&fn.length===3,"uniform "+Lt,ke.commandStr),Me="3i";break;case uf:K.command(xo(fn)&&fn.length===4,"uniform "+Lt,ke.commandStr),Me="4i";break;case Pc:K.command(xo(fn)&&fn.length===4,"uniform "+Lt,ke.commandStr),Me="4i";break}Se(st,".uniform",Me,"(",vn,",",xo(fn)?Array.prototype.slice.call(fn):fn,");")}continue}else On=Hr.append(ke,Se)}else{if(!sr(vh))continue;On=Se.def(dt.uniforms,"[",Ie.id(Lt),"]")}Kt===Sf?(K(!Array.isArray(On),"must specify a scalar prop for textures"),Se("if(",On,"&&",On,'._reglType==="framebuffer"){',On,"=",On,".color[0];","}")):Kt===Ef&&(K(!Array.isArray(On),"must specify a scalar prop for cube maps"),Se("if(",On,"&&",On,'._reglType==="framebufferCube"){',On,"=",On,".color[0];","}")),K.optional(function(){function Qs(vl,Wf){ke.assert(Se,vl,'bad data or missing for uniform "'+Lt+'".  '+Wf)}function $l(vl){K(!Array.isArray(On),"must not specify an array type for uniform"),Qs("typeof "+On+'==="'+vl+'"',"invalid type, expected "+vl)}function rl(vl,Wf){Array.isArray(On)?K(On.length===vl,"must have length "+vl):Qs(dt.isArrayLike+"("+On+")&&"+On+".length==="+vl,"invalid vector, should have length "+vl,ke.commandStr)}function _h(vl){K(!Array.isArray(On),"must not specify a value type"),Qs("typeof "+On+'==="function"&&'+On+'._reglType==="texture'+(vl===Nh?"2d":"Cube")+'"',"invalid texture type",ke.commandStr)}switch(Kt){case af:$l("number");break;case of:rl(2,"number");break;case Uf:rl(3,"number");break;case Pc:rl(4,"number");break;case Zc:$l("number");break;case xf:rl(2,"number");break;case bf:rl(3,"number");break;case Tc:rl(4,"number");break;case ch:$l("boolean");break;case sf:rl(2,"boolean");break;case jf:rl(3,"boolean");break;case uf:rl(4,"boolean");break;case Uc:rl(4,"number");break;case Ru:rl(9,"number");break;case lf:rl(16,"number");break;case Sf:_h(Nh);break;case Ef:_h(bp);break}});var $n=1;switch(Kt){case Sf:case Ef:var Vn=Se.def(On,"._texture");Se(st,".uniform1i(",vn,",",Vn,".bind());"),Se.exit(Vn,".unbind();");continue;case af:case ch:Me="1i";break;case of:case sf:Me="2i",$n=2;break;case Uf:case jf:Me="3i",$n=3;break;case Pc:case uf:Me="4i",$n=4;break;case Zc:Me="1f";break;case xf:Me="2f",$n=2;break;case bf:Me="3f",$n=3;break;case Tc:Me="4f",$n=4;break;case Uc:Me="Matrix2fv";break;case Ru:Me="Matrix3fv";break;case lf:Me="Matrix4fv";break}if(Me.charAt(0)==="M"){Se(st,".uniform",Me,"(",vn,",");var li=Math.pow(Kt-Uc+2,2),Ia=ke.global.def("new Float32Array(",li,")");Array.isArray(On)?Se("false,(",he(li,function(Qs){return Ia+"["+Qs+"]="+On[Qs]}),",",Ia,")"):Se("false,(Array.isArray(",On,")||",On," instanceof Float32Array)?",On,":(",he(li,function(Qs){return Ia+"["+Qs+"]="+On+"["+Qs+"]"}),",",Ia,")"),Se(");")}else if($n>1){for(var rs=[],Ml=[],$a=0;$a<$n;++$a)Array.isArray(On)?Ml.push(On[$a]):Ml.push(Se.def(On+"["+$a+"]")),_t&&rs.push(Se.def());_t&&Se("if(!",ke.batchId,"||",rs.map(function(Qs,$l){return Qs+"!=="+Ml[$l]}).join("||"),"){",rs.map(function(Qs,$l){return Qs+"="+Ml[$l]+";"}).join("")),Se(st,".uniform",Me,"(",vn,",",Ml.join(","),");"),_t&&Se("}")}else{if(K(!Array.isArray(On),"uniform value must not be an array"),_t){var Da=Se.def();Se("if(!",ke.batchId,"||",Da,"!==",On,"){",Da,"=",On,";")}Se(st,".uniform",Me,"(",vn,",",On,");"),_t&&Se("}")}}}function Zo(ke,Se,it,Ot){var sr=ke.shared,_t=sr.gl,dt=sr.draw,st=Ot.draw;function Me(){var $n=st.elements,Vn,li=Se;return $n?(($n.contextDep&&Ot.contextDynamic||$n.propDep)&&(li=it),Vn=$n.append(ke,li),st.elementsActive&&li("if("+Vn+")"+_t+".bindBuffer("+uh+","+Vn+".buffer.buffer);")):(Vn=li.def(),li(Vn,"=",dt,".",pc,";","if(",Vn,"){",_t,".bindBuffer(",uh,",",Vn,".buffer.buffer);}","else if(",sr.vao,".currentVAO){",Vn,"=",ke.shared.elements+".getElements("+sr.vao,".currentVAO.elements);",Rr?"":"if("+Vn+")"+_t+".bindBuffer("+uh+","+Vn+".buffer.buffer);","}")),Vn}function nt(){var $n=st.count,Vn,li=Se;return $n?(($n.contextDep&&Ot.contextDynamic||$n.propDep)&&(li=it),Vn=$n.append(ke,li),K.optional(function(){$n.MISSING&&ke.assert(Se,"false","missing vertex count"),$n.DYNAMIC&&ke.assert(li,Vn+">=0","missing vertex count")})):(Vn=li.def(dt,".",hs),K.optional(function(){ke.assert(li,Vn+">=0","missing vertex count")})),Vn}var Ne=Me();function Lt($n){var Vn=st[$n];return Vn?Vn.contextDep&&Ot.contextDynamic||Vn.propDep?Vn.append(ke,it):Vn.append(ke,Se):Se.def(dt,".",$n)}var Kt=Lt(el),Hr=Lt(Ff),mn=nt();if(typeof mn=="number"){if(mn===0)return}else it("if(",mn,"){"),it.exit("}");var vn,On;qr&&(vn=Lt(yf),On=ke.instancing);var fn=Ne+".type",zn=st.elements&&Wo(st.elements)&&!st.vaoActive;function Bn(){function $n(){it(On,".drawElementsInstancedANGLE(",[Kt,mn,fn,Hr+"<<(("+fn+"-"+Gi+")>>1)",vn],");")}function Vn(){it(On,".drawArraysInstancedANGLE(",[Kt,Hr,mn,vn],");")}Ne&&Ne!=="null"?zn?$n():(it("if(",Ne,"){"),$n(),it("}else{"),Vn(),it("}")):Vn()}function Jn(){function $n(){it(_t+".drawElements("+[Kt,mn,fn,Hr+"<<(("+fn+"-"+Gi+")>>1)"]+");")}function Vn(){it(_t+".drawArrays("+[Kt,Hr,mn]+");")}Ne&&Ne!=="null"?zn?$n():(it("if(",Ne,"){"),$n(),it("}else{"),Vn(),it("}")):Vn()}qr&&(typeof vn!="number"||vn>=0)?typeof vn=="string"?(it("if(",vn,">0){"),Bn(),it("}else if(",vn,"<0){"),Jn(),it("}")):Bn():Jn()}function Li(ke,Se,it,Ot,sr){var _t=Bi(),dt=_t.proc("body",sr);return K.optional(function(){_t.commandStr=Se.commandStr,_t.command=_t.link(Se.commandStr)}),qr&&(_t.instancing=dt.def(_t.shared.extensions,".angle_instanced_arrays")),ke(_t,dt,it,Ot),_t.compile().body}function va(ke,Se,it,Ot){Yo(ke,Se),it.useVAO?it.drawVAO?Se(ke.shared.vao,".setVAO(",it.drawVAO.append(ke,Se),");"):Se(ke.shared.vao,".setVAO(",ke.shared.vao,".targetVAO);"):(Se(ke.shared.vao,".setVAO(null);"),Ko(ke,Se,it,Ot.attributes,function(){return!0})),Ma(ke,Se,it,Ot.uniforms,function(){return!0},!1),Zo(ke,Se,Se,it)}function fo(ke,Se){var it=ke.proc("draw",1);Yo(ke,it),Xo(ke,it,Se.context),Cs(ke,it,Se.framebuffer),zs(ke,it,Se),ws(ke,it,Se.state),Hi(ke,it,Se,!1,!0);var Ot=Se.shader.progVar.append(ke,it);if(it(ke.shared.gl,".useProgram(",Ot,".program);"),Se.shader.program)va(ke,it,Se,Se.shader.program);else{it(ke.shared.vao,".setVAO(null);");var sr=ke.global.def("{}"),_t=it.def(Ot,".id"),dt=it.def(sr,"[",_t,"]");it(ke.cond(dt).then(dt,".call(this,a0);").else(dt,"=",sr,"[",_t,"]=",ke.link(function(st){return Li(va,ke,Se,st,1)}),"(",Ot,");",dt,".call(this,a0);"))}Object.keys(Se.state).length>0&&it(ke.shared.current,".dirty=true;"),ke.shared.vao&&it(ke.shared.vao,".setVAO(null);")}function go(ke,Se,it,Ot){ke.batchId="a1",Yo(ke,Se);function sr(){return!0}Ko(ke,Se,it,Ot.attributes,sr),Ma(ke,Se,it,Ot.uniforms,sr,!1),Zo(ke,Se,Se,it)}function Pl(ke,Se,it,Ot){Yo(ke,Se);var sr=it.contextDep,_t=Se.def(),dt="a0",st="a1",Me=Se.def();ke.shared.props=Me,ke.batchId=_t;var nt=ke.scope(),Ne=ke.scope();Se(nt.entry,"for(",_t,"=0;",_t,"<",st,";++",_t,"){",Me,"=",dt,"[",_t,"];",Ne,"}",nt.exit);function Lt(fn){return fn.contextDep&&sr||fn.propDep}function Kt(fn){return!Lt(fn)}if(it.needsContext&&Xo(ke,Ne,it.context),it.needsFramebuffer&&Cs(ke,Ne,it.framebuffer),ws(ke,Ne,it.state,Lt),it.profile&&Lt(it.profile)&&Hi(ke,Ne,it,!1,!0),Ot)it.useVAO?it.drawVAO?Lt(it.drawVAO)?Ne(ke.shared.vao,".setVAO(",it.drawVAO.append(ke,Ne),");"):nt(ke.shared.vao,".setVAO(",it.drawVAO.append(ke,nt),");"):nt(ke.shared.vao,".setVAO(",ke.shared.vao,".targetVAO);"):(nt(ke.shared.vao,".setVAO(null);"),Ko(ke,nt,it,Ot.attributes,Kt),Ko(ke,Ne,it,Ot.attributes,Lt)),Ma(ke,nt,it,Ot.uniforms,Kt,!1),Ma(ke,Ne,it,Ot.uniforms,Lt,!0),Zo(ke,nt,Ne,it);else{var Hr=ke.global.def("{}"),mn=it.shader.progVar.append(ke,Ne),vn=Ne.def(mn,".id"),On=Ne.def(Hr,"[",vn,"]");Ne(ke.shared.gl,".useProgram(",mn,".program);","if(!",On,"){",On,"=",Hr,"[",vn,"]=",ke.link(function(fn){return Li(go,ke,it,fn,2)}),"(",mn,");}",On,".call(this,a0[",_t,"],",_t,");")}}function Ge(ke,Se){var it=ke.proc("batch",2);ke.batchId="0",Yo(ke,it);var Ot=!1,sr=!0;Object.keys(Se.context).forEach(function(Hr){Ot=Ot||Se.context[Hr].propDep}),Ot||(Xo(ke,it,Se.context),sr=!1);var _t=Se.framebuffer,dt=!1;_t?(_t.propDep?Ot=dt=!0:_t.contextDep&&Ot&&(dt=!0),dt||Cs(ke,it,_t)):Cs(ke,it,null),Se.state.viewport&&Se.state.viewport.propDep&&(Ot=!0);function st(Hr){return Hr.contextDep&&Ot||Hr.propDep}zs(ke,it,Se),ws(ke,it,Se.state,function(Hr){return!st(Hr)}),(!Se.profile||!st(Se.profile))&&Hi(ke,it,Se,!1,"a1"),Se.contextDep=Ot,Se.needsContext=sr,Se.needsFramebuffer=dt;var Me=Se.shader.progVar;if(Me.contextDep&&Ot||Me.propDep)Pl(ke,it,Se,null);else{var nt=Me.append(ke,it);if(it(ke.shared.gl,".useProgram(",nt,".program);"),Se.shader.program)Pl(ke,it,Se,Se.shader.program);else{it(ke.shared.vao,".setVAO(null);");var Ne=ke.global.def("{}"),Lt=it.def(nt,".id"),Kt=it.def(Ne,"[",Lt,"]");it(ke.cond(Kt).then(Kt,".call(this,a0,a1);").else(Kt,"=",Ne,"[",Lt,"]=",ke.link(function(Hr){return Li(Pl,ke,Se,Hr,2)}),"(",nt,");",Kt,".call(this,a0,a1);"))}}Object.keys(Se.state).length>0&&it(ke.shared.current,".dirty=true;"),ke.shared.vao&&it(ke.shared.vao,".setVAO(null);")}function cr(ke,Se){var it=ke.proc("scope",3);ke.batchId="a2";var Ot=ke.shared,sr=Ot.current;Xo(ke,it,Se.context),Se.framebuffer&&Se.framebuffer.append(ke,it),dh(Object.keys(Se.state)).forEach(function(dt){var st=Se.state[dt],Me=st.append(ke,it);xo(Me)?Me.forEach(function(nt,Ne){it.set(ke.next[dt],"["+Ne+"]",nt)}):it.set(Ot.next,"."+dt,Me)}),Hi(ke,it,Se,!0,!0),[pc,Ff,hs,yf,el].forEach(function(dt){var st=Se.draw[dt];!st||it.set(Ot.draw,"."+dt,""+st.append(ke,it))}),Object.keys(Se.uniforms).forEach(function(dt){var st=Se.uniforms[dt].append(ke,it);Array.isArray(st)&&(st="["+st.join()+"]"),it.set(Ot.uniforms,"["+Ie.id(dt)+"]",st)}),Object.keys(Se.attributes).forEach(function(dt){var st=Se.attributes[dt].append(ke,it),Me=ke.scopeAttrib(dt);Object.keys(new Bt).forEach(function(nt){it.set(Me,"."+nt,st[nt])})}),Se.scopeVAO&&it.set(Ot.vao,".targetVAO",Se.scopeVAO.append(ke,it));function _t(dt){var st=Se.shader[dt];st&&it.set(Ot.shader,"."+dt,st.append(ke,it))}_t(pl),_t(Hl),Object.keys(Se.state).length>0&&(it(sr,".dirty=true;"),it.exit(sr,".dirty=true;")),it("a1(",ke.shared.context,",a0,",ke.batchId,");")}function Jt(ke){if(!(typeof ke!="object"||xo(ke))){for(var Se=Object.keys(ke),it=0;it<Se.length;++it)if(Yr.isDynamic(ke[Se[it]]))return!0;return!1}}function Fn(ke,Se,it){var Ot=Se.static[it];if(!Ot||!Jt(Ot))return;var sr=ke.global,_t=Object.keys(Ot),dt=!1,st=!1,Me=!1,nt=ke.global.def("{}");_t.forEach(function(Lt){var Kt=Ot[Lt];if(Yr.isDynamic(Kt)){typeof Kt=="function"&&(Kt=Ot[Lt]=Yr.unbox(Kt));var Hr=wu(Kt,null);dt=dt||Hr.thisDep,Me=Me||Hr.propDep,st=st||Hr.contextDep}else{switch(sr(nt,".",Lt,"="),typeof Kt){case"number":sr(Kt);break;case"string":sr('"',Kt,'"');break;case"object":Array.isArray(Kt)&&sr("[",Kt.join(),"]");break;default:sr(ke.link(Kt));break}sr(";")}});function Ne(Lt,Kt){_t.forEach(function(Hr){var mn=Ot[Hr];if(!!Yr.isDynamic(mn)){var vn=Lt.invoke(Kt,mn);Kt(nt,".",Hr,"=",vn,";")}})}Se.dynamic[it]=new Yr.DynamicVariable(oe,{thisDep:dt,contextDep:st,propDep:Me,ref:nt,append:Ne}),delete Se.static[it]}function fa(ke,Se,it,Ot,sr){var _t=Bi();_t.stats=_t.link(sr),Object.keys(Se.static).forEach(function(st){Fn(_t,Se,st)}),yp.forEach(function(st){Fn(_t,ke,st)});var dt=ds(ke,Se,it,Ot,_t);return fo(_t,dt),cr(_t,dt),Ge(_t,dt),d(_t.compile(),{destroy:function(){dt.shader.program.destroy()}})}return{next:cn,current:wn,procs:function(){var ke=Bi(),Se=ke.proc("poll"),it=ke.proc("refresh"),Ot=ke.block();Se(Ot),it(Ot);var sr=ke.shared,_t=sr.gl,dt=sr.next,st=sr.current;Ot(st,".dirty=false;"),Cs(ke,Se),Cs(ke,it,null,!0);var Me;qr&&(Me=ke.link(qr)),qe.oes_vertex_array_object&&it(ke.link(qe.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var nt=0;nt<ar.maxAttributes;++nt){var Ne=it.def(sr.attributes,"[",nt,"]"),Lt=ke.cond(Ne,".buffer");Lt.then(_t,".enableVertexAttribArray(",nt,");",_t,".bindBuffer(",rf,",",Ne,".buffer.buffer);",_t,".vertexAttribPointer(",nt,",",Ne,".size,",Ne,".type,",Ne,".normalized,",Ne,".stride,",Ne,".offset);").else(_t,".disableVertexAttribArray(",nt,");",_t,".vertexAttrib4f(",nt,",",Ne,".x,",Ne,".y,",Ne,".z,",Ne,".w);",Ne,".buffer=null;"),it(Lt),qr&&it(Me,".vertexAttribDivisorANGLE(",nt,",",Ne,".divisor);")}return it(ke.shared.vao,".currentVAO=null;",ke.shared.vao,".setVAO(",ke.shared.vao,".targetVAO);"),Object.keys(kr).forEach(function(Kt){var Hr=kr[Kt],mn=Ot.def(dt,".",Kt),vn=ke.block();vn("if(",mn,"){",_t,".enable(",Hr,")}else{",_t,".disable(",Hr,")}",st,".",Kt,"=",mn,";"),it(vn),Se("if(",mn,"!==",st,".",Kt,"){",vn,"}")}),Object.keys(Ar).forEach(function(Kt){var Hr=Ar[Kt],mn=wn[Kt],vn,On,fn=ke.block();if(fn(_t,".",Hr,"("),xo(mn)){var zn=mn.length;vn=ke.global.def(dt,".",Kt),On=ke.global.def(st,".",Kt),fn(he(zn,function(Bn){return vn+"["+Bn+"]"}),");",he(zn,function(Bn){return On+"["+Bn+"]="+vn+"["+Bn+"];"}).join("")),Se("if(",he(zn,function(Bn){return vn+"["+Bn+"]!=="+On+"["+Bn+"]"}).join("||"),"){",fn,"}")}else vn=Ot.def(dt,".",Kt),On=Ot.def(st,".",Kt),fn(vn,");",st,".",Kt,"=",vn,";"),Se("if(",vn,"!==",On,"){",fn,"}");it(fn)}),ke.compile()}(),compile:fa}}function mh(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Wh=34918,Xh=34919,Yh=35007,Kh=function(z,Ie){if(!Ie.ext_disjoint_timer_query)return null;var qe=[];function ar(){return qe.pop()||Ie.ext_disjoint_timer_query.createQueryEXT()}function Br(qr){qe.push(qr)}var rr=[];function Mr(qr){var Ln=ar();Ie.ext_disjoint_timer_query.beginQueryEXT(Yh,Ln),rr.push(Ln),Qr(rr.length-1,rr.length,qr)}function Gr(){Ie.ext_disjoint_timer_query.endQueryEXT(Yh)}function $r(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var tn=[];function rn(){return tn.pop()||new $r}function sn(qr){tn.push(qr)}var yn=[];function Qr(qr,Ln,Rr){var wn=rn();wn.startQueryIndex=qr,wn.endQueryIndex=Ln,wn.sum=0,wn.stats=Rr,yn.push(wn)}var un=[],Bt=[];function gr(){var qr,Ln,Rr=rr.length;if(Rr!==0){Bt.length=Math.max(Bt.length,Rr+1),un.length=Math.max(un.length,Rr+1),un[0]=0,Bt[0]=0;var wn=0;for(qr=0,Ln=0;Ln<rr.length;++Ln){var cn=rr[Ln];Ie.ext_disjoint_timer_query.getQueryObjectEXT(cn,Xh)?(wn+=Ie.ext_disjoint_timer_query.getQueryObjectEXT(cn,Wh),Br(cn)):rr[qr++]=cn,un[Ln+1]=wn,Bt[Ln+1]=qr}for(rr.length=qr,qr=0,Ln=0;Ln<yn.length;++Ln){var pi=yn[Ln],kr=pi.startQueryIndex,Ar=pi.endQueryIndex;pi.sum+=un[Ar]-un[kr];var Kn=Bt[kr],bn=Bt[Ar];bn===Kn?(pi.stats.gpuTime+=pi.sum/1e6,sn(pi)):(pi.startQueryIndex=Kn,pi.endQueryIndex=bn,yn[qr++]=pi)}yn.length=qr}}return{beginQuery:Mr,endQuery:Gr,pushScopeStats:Qr,update:gr,getNumPendingQueries:function(){return rr.length},clear:function(){qe.push.apply(qe,rr);for(var qr=0;qr<qe.length;qr++)Ie.ext_disjoint_timer_query.deleteQueryEXT(qe[qr]);rr.length=0,qe.length=0},restore:function(){rr.length=0,qe.length=0}}},Ap=16384,Tp=256,Cf=1024,$h=34962,Hf="webglcontextlost",wf="webglcontextrestored",ao=1,gh=2,Kl=3;function Ic(z,Ie){for(var qe=0;qe<z.length;++qe)if(z[qe]===Ie)return qe;return-1}function yh(z){var Ie=F(z);if(!Ie)return null;var qe=Ie.gl,ar=qe.getContextAttributes(),Br=qe.isContextLost(),rr=ee(qe,Ie);if(!rr)return null;var Mr=si(),Gr=mh(),$r=rr.extensions,tn=Kh(qe,$r),rn=ei(),sn=qe.drawingBufferWidth,yn=qe.drawingBufferHeight,Qr={tick:0,time:0,viewportWidth:sn,viewportHeight:yn,framebufferWidth:sn,framebufferHeight:yn,drawingBufferWidth:sn,drawingBufferHeight:yn,pixelRatio:Ie.pixelRatio},un={},Bt={elements:null,primitive:4,count:-1,offset:0,instances:-1},gr=De(qe,$r),qr=N(qe,Gr,Ie,wn),Ln=Yu(qe,$r,qr,Gr),Rr=Et(qe,$r,gr,Gr,qr,Ln,Bt);function wn(Li){return Rr.destroyBuffer(Li)}var cn=jr(qe,Mr,Gr,Ie),pi=uu(qe,$r,gr,function(){Kn.procs.poll()},Qr,Gr,Ie),kr=qc(qe,$r,gr,Gr,Ie),Ar=Pe(qe,$r,gr,pi,kr,Gr),Kn=Hh(qe,Mr,$r,gr,qr,Ln,pi,Ar,un,Rr,cn,Bt,Qr,tn,Ie),bn=ui(qe,Ar,Kn.procs.poll,Qr,ar,$r,gr),an=Kn.next,An=qe.canvas,Tn=[],ji=[],Bi=[],Mn=[Ie.onDestroy],Pn=null;function wi(){if(Tn.length===0){tn&&tn.update(),Pn=null;return}Pn=En.next(wi),Yo();for(var Li=Tn.length-1;Li>=0;--Li){var va=Tn[Li];va&&va(Qr,null,0)}qe.flush(),tn&&tn.update()}function Di(){!Pn&&Tn.length>0&&(Pn=En.next(wi))}function la(){Pn&&(En.cancel(wi),Pn=null)}function Mo(Li){Li.preventDefault(),Br=!0,la(),ji.forEach(function(va){va()})}function Io(Li){qe.getError(),Br=!1,rr.restore(),cn.restore(),qr.restore(),pi.restore(),kr.restore(),Ar.restore(),Rr.restore(),tn&&tn.restore(),Kn.procs.refresh(),Di(),Bi.forEach(function(va){va()})}var ca=typeof my!="undefined"&&!!my&&typeof my.showToast=="function";!ca&&An&&(An.addEventListener(Hf,Mo,!1),An.addEventListener(wf,Io,!1));function Ns(){Tn.length=0,la(),!ca&&An&&(An.removeEventListener(Hf,Mo),An.removeEventListener(wf,Io)),cn.clear(),Ar.clear(),kr.clear(),Rr.clear(),pi.clear(),Ln.clear(),qr.clear(),tn&&tn.clear(),Mn.forEach(function(Li){Li()})}function mo(Li){K(!!Li,"invalid args to regl({...})"),K.type(Li,"object","invalid args to regl({...})");function va(_t){var dt=d({},_t);delete dt.uniforms,delete dt.attributes,delete dt.context,delete dt.vao,"stencil"in dt&&dt.stencil.op&&(dt.stencil.opBack=dt.stencil.opFront=dt.stencil.op,delete dt.stencil.op);function st(Me){if(Me in dt){var nt=dt[Me];delete dt[Me],Object.keys(nt).forEach(function(Ne){dt[Me+"."+Ne]=nt[Ne]})}}return st("blend"),st("depth"),st("cull"),st("stencil"),st("polygonOffset"),st("scissor"),st("sample"),"vao"in _t&&(dt.vao=_t.vao),dt}function fo(_t,dt){var st={},Me={};return Object.keys(_t).forEach(function(nt){var Ne=_t[nt];if(Yr.isDynamic(Ne)){Me[nt]=Yr.unbox(Ne,nt);return}else if(dt&&Array.isArray(Ne)){for(var Lt=0;Lt<Ne.length;++Lt)if(Yr.isDynamic(Ne[Lt])){Me[nt]=Yr.unbox(Ne,nt);return}}st[nt]=Ne}),{dynamic:Me,static:st}}var go=fo(Li.context||{},!0),Pl=fo(Li.uniforms||{},!0),Ge=fo(Li.attributes||{},!1),cr=fo(va(Li),!1),Jt={gpuTime:0,cpuTime:0,count:0},Fn=Kn.compile(cr,Ge,Pl,go,Jt),fa=Fn.draw,ke=Fn.batch,Se=Fn.scope,it=[];function Ot(_t){for(;it.length<_t;)it.push(null);return it}function sr(_t,dt){var st;if(Br&&K.raise("context lost"),typeof _t=="function")return Se.call(this,null,_t,0);if(typeof dt=="function")if(typeof _t=="number")for(st=0;st<_t;++st)Se.call(this,null,dt,st);else if(Array.isArray(_t))for(st=0;st<_t.length;++st)Se.call(this,_t[st],dt,st);else return Se.call(this,_t,dt,0);else if(typeof _t=="number"){if(_t>0)return ke.call(this,Ot(_t|0),_t|0)}else if(Array.isArray(_t)){if(_t.length)return ke.call(this,_t,_t.length)}else return fa.call(this,_t)}return d(sr,{stats:Jt,destroy:function(){Fn.destroy()}})}var ds=Ar.setFBO=mo({framebuffer:Yr.define.call(null,ao,"framebuffer")});function Xo(Li,va){var fo=0;Kn.procs.poll();var go=va.color;go&&(qe.clearColor(+go[0]||0,+go[1]||0,+go[2]||0,+go[3]||0),fo|=Ap),"depth"in va&&(qe.clearDepth(+va.depth),fo|=Tp),"stencil"in va&&(qe.clearStencil(va.stencil|0),fo|=Cf),K(!!fo,"called regl.clear with no buffer specified"),qe.clear(fo)}function Cs(Li){if(K(typeof Li=="object"&&Li,"regl.clear() takes an object as input"),"framebuffer"in Li)if(Li.framebuffer&&Li.framebuffer_reglType==="framebufferCube")for(var va=0;va<6;++va)ds(d({framebuffer:Li.framebuffer.faces[va]},Li),Xo);else ds(Li,Xo);else Xo(null,Li)}function zs(Li){K.type(Li,"function","regl.frame() callback must be a function"),Tn.push(Li);function va(){var fo=Ic(Tn,Li);K(fo>=0,"cannot cancel a frame twice");function go(){var Pl=Ic(Tn,go);Tn[Pl]=Tn[Tn.length-1],Tn.length-=1,Tn.length<=0&&la()}Tn[fo]=go}return Di(),{cancel:va}}function ws(){var Li=an.viewport,va=an.scissor_box;Li[0]=Li[1]=va[0]=va[1]=0,Qr.viewportWidth=Qr.framebufferWidth=Qr.drawingBufferWidth=Li[2]=va[2]=qe.drawingBufferWidth,Qr.viewportHeight=Qr.framebufferHeight=Qr.drawingBufferHeight=Li[3]=va[3]=qe.drawingBufferHeight}function Yo(){Qr.tick+=1,Qr.time=Ko(),ws(),Kn.procs.poll()}function Hi(){pi.refresh(),ws(),Kn.procs.refresh(),tn&&tn.update()}function Ko(){return(ei()-rn)/1e3}Hi();function Ma(Li,va){K.type(va,"function","listener callback must be a function");var fo;switch(Li){case"frame":return zs(va);case"lost":fo=ji;break;case"restore":fo=Bi;break;case"destroy":fo=Mn;break;default:K.raise("invalid event, must be one of frame,lost,restore,destroy")}return fo.push(va),{cancel:function(){for(var go=0;go<fo.length;++go)if(fo[go]===va){fo[go]=fo[fo.length-1],fo.pop();return}}}}var Zo=d(mo,{clear:Cs,prop:Yr.define.bind(null,ao),context:Yr.define.bind(null,gh),this:Yr.define.bind(null,Kl),draw:mo({}),buffer:function(Li){return qr.create(Li,$h,!1,!1)},elements:function(Li){return Ln.create(Li,!1)},texture:pi.create2D,cube:pi.createCube,renderbuffer:kr.create,framebuffer:Ar.create,framebufferCube:Ar.createCube,vao:Rr.createVAO,attributes:ar,frame:zs,on:Ma,limits:gr,hasExtension:function(Li){return gr.extensions.indexOf(Li.toLowerCase())>=0},read:bn,destroy:Ns,_gl:qe,_refresh:Hi,poll:function(){Yo(),tn&&tn.update()},now:Ko,stats:Gr});return Ie.onDone(null,Zo),Zo}return yh})},49029:function(zr){var B=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function S(ye){return ye.match(B)||[]}zr.exports=S},29750:function(zr){function B(S,ye,C){return S===S&&(C!==void 0&&(S=S<=C?S:C),ye!==void 0&&(S=S>=ye?S:ye)),S}zr.exports=B},18674:function(zr){function B(S){return function(ye){return S==null?void 0:S[ye]}}zr.exports=B},98805:function(zr,B,S){var ye=S(40180),C=S(62689),d=S(83140),de=S(79833);function re(ie){return function(se){se=de(se);var Be=C(se)?d(se):void 0,$=Be?Be[0]:se.charAt(0),Je=Be?ye(Be,1).join(""):se.slice(1);return $[ie]()+Je}}zr.exports=re},35393:function(zr,B,S){var ye=S(62663),C=S(53816),d=S(58748),de="['\u2019]",re=RegExp(de,"g");function ie(se){return function(Be){return ye(d(C(Be).replace(re,"")),se,"")}}zr.exports=ie},69389:function(zr,B,S){var ye=S(18674),C={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"s"},d=ye(C);zr.exports=d},93157:function(zr){var B=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function S(ye){return B.test(ye)}zr.exports=S},2757:function(zr){var B="\\ud800-\\udfff",S="\\u0300-\\u036f",ye="\\ufe20-\\ufe2f",C="\\u20d0-\\u20ff",d=S+ye+C,de="\\u2700-\\u27bf",re="a-z\\xdf-\\xf6\\xf8-\\xff",ie="\\xac\\xb1\\xd7\\xf7",se="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",Be="\\u2000-\\u206f",$=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",Je="A-Z\\xc0-\\xd6\\xd8-\\xde",bt="\\ufe0e\\ufe0f",Gt=ie+se+Be+$,Ir="['\u2019]",Qt="["+Gt+"]",Yt="["+d+"]",ir="\\d+",jt="["+de+"]",Tt="["+re+"]",Ct="[^"+B+Gt+ir+de+re+Je+"]",br="\\ud83c[\\udffb-\\udfff]",q="(?:"+Yt+"|"+br+")",dr="[^"+B+"]",Qe="(?:\\ud83c[\\udde6-\\uddff]){2}",$e="[\\ud800-\\udbff][\\udc00-\\udfff]",Rt="["+Je+"]",Xe="\\u200d",Zt="(?:"+Tt+"|"+Ct+")",xr="(?:"+Rt+"|"+Ct+")",qt="(?:"+Ir+"(?:d|ll|m|re|s|t|ve))?",Xr="(?:"+Ir+"(?:D|LL|M|RE|S|T|VE))?",ce=q+"?",Re="["+bt+"]?",ge="(?:"+Xe+"(?:"+[dr,Qe,$e].join("|")+")"+Re+ce+")*",xt="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",vt="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Nt=Re+ce+ge,Dt="(?:"+[jt,Qe,$e].join("|")+")"+Nt,Ur=RegExp([Rt+"?"+Tt+"+"+qt+"(?="+[Qt,Rt,"$"].join("|")+")",xr+"+"+Xr+"(?="+[Qt,Rt+Zt,"$"].join("|")+")",Rt+"?"+Zt+"+"+qt,Rt+"+"+Xr,vt,xt,ir,Dt].join("|"),"g");function dn(on){return on.match(Ur)||[]}zr.exports=dn},68929:function(zr,B,S){var ye=S(48403),C=S(35393),d=C(function(de,re,ie){return re=re.toLowerCase(),de+(ie?ye(re):re)});zr.exports=d},48403:function(zr,B,S){var ye=S(79833),C=S(11700);function d(de){return C(ye(de).toLowerCase())}zr.exports=d},74691:function(zr,B,S){var ye=S(29750),C=S(14841);function d(de,re,ie){return ie===void 0&&(ie=re,re=void 0),ie!==void 0&&(ie=C(ie),ie=ie===ie?ie:0),re!==void 0&&(re=C(re),re=re===re?re:0),ye(C(de),re,ie)}zr.exports=d},53816:function(zr,B,S){var ye=S(69389),C=S(79833),d=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,de="\\u0300-\\u036f",re="\\ufe20-\\ufe2f",ie="\\u20d0-\\u20ff",se=de+re+ie,Be="["+se+"]",$=RegExp(Be,"g");function Je(bt){return bt=C(bt),bt&&bt.replace(d,ye).replace($,"")}zr.exports=Je},14293:function(zr){function B(S){return S==null}zr.exports=B},81763:function(zr,B,S){var ye=S(44239),C=S(37005),d="[object Number]";function de(re){return typeof re=="number"||C(re)&&ye(re)==d}zr.exports=de},30236:function(zr,B,S){var ye=S(42980),C=S(21463),d=C(function(de,re,ie,se){ye(de,re,ie,se)});zr.exports=d},44908:function(zr,B,S){var ye=S(45652);function C(d){return d&&d.length?ye(d):[]}zr.exports=C},11700:function(zr,B,S){var ye=S(98805),C=ye("toUpperCase");zr.exports=C},58748:function(zr,B,S){var ye=S(49029),C=S(93157),d=S(79833),de=S(2757);function re(ie,se,Be){return ie=d(ie),se=Be?void 0:se,se===void 0?C(ie)?de(ie):ye(ie):ie.match(se)||[]}zr.exports=re},6158:function(zr){(function(B,S){zr.exports=S()})(this,function(){"use strict";var B,S,ye;function C(d,de){if(!B)B=de;else if(!S)S=de;else{var re="var sharedChunk = {}; ("+B+")(sharedChunk); ("+S+")(sharedChunk);",ie={};B(ie),ye=de(ie),typeof window!="undefined"&&(ye.workerUrl=window.URL.createObjectURL(new Blob([re],{type:"text/javascript"})))}}return C(["exports"],function(d){"use strict";function de(e,t){return e(t={exports:{}},t.exports),t.exports}var re=ie;function ie(e,t,r,f){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(f-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=f,this.p2x=r,this.p2y=f}ie.prototype.sampleCurveX=function(e){return((this.ax*e+this.bx)*e+this.cx)*e},ie.prototype.sampleCurveY=function(e){return((this.ay*e+this.by)*e+this.cy)*e},ie.prototype.sampleCurveDerivativeX=function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},ie.prototype.solveCurveX=function(e,t){var r,f,v,g,x;for(t===void 0&&(t=1e-6),v=e,x=0;x<8;x++){if(g=this.sampleCurveX(v)-e,Math.abs(g)<t)return v;var P=this.sampleCurveDerivativeX(v);if(Math.abs(P)<1e-6)break;v-=g/P}if((v=e)<(r=0))return r;if(v>(f=1))return f;for(;r<f;){if(g=this.sampleCurveX(v),Math.abs(g-e)<t)return v;e>g?r=v:f=v,v=.5*(f-r)+r}return v},ie.prototype.solve=function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))};var se=Be;function Be(e,t){this.x=e,this.y=t}Be.prototype={clone:function(){return new Be(this.x,this.y)},add:function(e){return this.clone()._add(e)},sub:function(e){return this.clone()._sub(e)},multByPoint:function(e){return this.clone()._multByPoint(e)},divByPoint:function(e){return this.clone()._divByPoint(e)},mult:function(e){return this.clone()._mult(e)},div:function(e){return this.clone()._div(e)},rotate:function(e){return this.clone()._rotate(e)},rotateAround:function(e,t){return this.clone()._rotateAround(e,t)},matMult:function(e){return this.clone()._matMult(e)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(e){return this.x===e.x&&this.y===e.y},dist:function(e){return Math.sqrt(this.distSqr(e))},distSqr:function(e){var t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith:function(e){return this.angleWithSep(e.x,e.y)},angleWithSep:function(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult:function(e){var t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add:function(e){return this.x+=e.x,this.y+=e.y,this},_sub:function(e){return this.x-=e.x,this.y-=e.y,this},_mult:function(e){return this.x*=e,this.y*=e,this},_div:function(e){return this.x/=e,this.y/=e,this},_multByPoint:function(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint:function(e){return this.x/=e.x,this.y/=e.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var e=this.y;return this.y=this.x,this.x=-e,this},_rotate:function(e){var t=Math.cos(e),r=Math.sin(e),f=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=f,this},_rotateAround:function(e,t){var r=Math.cos(e),f=Math.sin(e),v=t.y+f*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-f*(this.y-t.y),this.y=v,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Be.convert=function(e){return e instanceof Be?e:Array.isArray(e)?new Be(e[0],e[1]):e};var $=typeof self!="undefined"?self:{},Je=Math.pow(2,53)-1;function bt(e,t,r,f){var v=new re(e,t,r,f);return function(g){return v.solve(g)}}var Gt=bt(.25,.1,.25,1);function Ir(e,t,r){return Math.min(r,Math.max(t,e))}function Qt(e,t,r){var f=r-t,v=((e-t)%f+f)%f+t;return v===t?r:v}function Yt(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var x in g)e[x]=g[x]}return e}var ir=1;function jt(){return ir++}function Tt(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}function Ct(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}function br(e,t){e.forEach(function(r){t[r]&&(t[r]=t[r].bind(t))})}function q(e,t){return e.indexOf(t,e.length-t.length)!==-1}function dr(e,t,r){var f={};for(var v in e)f[v]=t.call(r||this,e[v],v,e);return f}function Qe(e,t,r){var f={};for(var v in e)t.call(r||this,e[v],v,e)&&(f[v]=e[v]);return f}function $e(e){return Array.isArray(e)?e.map($e):typeof e=="object"&&e?dr(e,$e):e}var Rt={};function Xe(e){Rt[e]||(typeof console!="undefined"&&console.warn(e),Rt[e]=!0)}function Zt(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function xr(e){for(var t=0,r=0,f=e.length,v=f-1,g=void 0,x=void 0;r<f;v=r++)t+=((x=e[v]).x-(g=e[r]).x)*(g.y+x.y);return t}function qt(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function Xr(e){var t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(f,v,g,x){var P=g||x;return t[v]=!P||P.toLowerCase(),""}),t["max-age"]){var r=parseInt(t["max-age"],10);isNaN(r)?delete t["max-age"]:t["max-age"]=r}return t}var ce=null;function Re(e){if(ce==null){var t=e.navigator?e.navigator.userAgent:null;ce=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return ce}function ge(e){try{var t=$[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(r){return!1}}var xt,vt,Nt,Dt,Ur=$.performance&&$.performance.now?$.performance.now.bind($.performance):Date.now.bind(Date),dn=$.requestAnimationFrame||$.mozRequestAnimationFrame||$.webkitRequestAnimationFrame||$.msRequestAnimationFrame,on=$.cancelAnimationFrame||$.mozCancelAnimationFrame||$.webkitCancelAnimationFrame||$.msCancelAnimationFrame,$i={now:Ur,frame:function(e){var t=dn(e);return{cancel:function(){return on(t)}}},getImageData:function(e,t){t===void 0&&(t=0);var r=$.document.createElement("canvas"),f=r.getContext("2d");if(!f)throw new Error("failed to create canvas 2d context");return r.width=e.width,r.height=e.height,f.drawImage(e,0,0,e.width,e.height),f.getImageData(-t,-t,e.width+2*t,e.height+2*t)},resolveURL:function(e){return xt||(xt=$.document.createElement("a")),xt.href=e,xt.href},hardwareConcurrency:$.navigator&&$.navigator.hardwareConcurrency||4,get devicePixelRatio(){return $.devicePixelRatio},get prefersReducedMotion(){return!!$.matchMedia&&(vt==null&&(vt=$.matchMedia("(prefers-reduced-motion: reduce)")),vt.matches)}},or={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},me={supported:!1,testSupport:function(e){!Ae&&Dt&&(Ue?Le(e):Nt=e)}},Ae=!1,Ue=!1;function Le(e){var t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Dt),e.isContextLost())return;me.supported=!0}catch(r){}e.deleteTexture(t),Ae=!0}$.document&&((Dt=$.document.createElement("img")).onload=function(){Nt&&Le(Nt),Nt=null,Ue=!0},Dt.onerror=function(){Ae=!0,Nt=null},Dt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var kt="01",nr=function(e,t){this._transformRequestFn=e,this._customAccessToken=t,this._createSkuToken()};function _r(e){return e.indexOf("mapbox:")===0}nr.prototype._createSkuToken=function(){var e=function(){for(var t="",r=0;r<10;r++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",kt,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt},nr.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},nr.prototype.transformRequest=function(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}},nr.prototype.normalizeStyleURL=function(e,t){if(!_r(e))return e;var r=E(e);return r.path="/styles/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},nr.prototype.normalizeGlyphsURL=function(e,t){if(!_r(e))return e;var r=E(e);return r.path="/fonts/v1"+r.path,this._makeAPIURL(r,this._customAccessToken||t)},nr.prototype.normalizeSourceURL=function(e,t){if(!_r(e))return e;var r=E(e);return r.path="/v4/"+r.authority+".json",r.params.push("secure"),this._makeAPIURL(r,this._customAccessToken||t)},nr.prototype.normalizeSpriteURL=function(e,t,r,f){var v=E(e);return _r(e)?(v.path="/styles/v1"+v.path+"/sprite"+t+r,this._makeAPIURL(v,this._customAccessToken||f)):(v.path+=""+t+r,V(v))},nr.prototype.normalizeTileURL=function(e,t){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!_r(e))return e;var r=E(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,($i.devicePixelRatio>=2||t===512?"@2x":"")+(me.supported?".webp":"$1")),r.path=r.path.replace(/^.+\/v4\//,"/"),r.path="/v4"+r.path;var f=this._customAccessToken||function(v){for(var g=0,x=v;g<x.length;g+=1){var P=x[g].match(/^access_token=(.*)$/);if(P)return P[1]}return null}(r.params)||or.ACCESS_TOKEN;return or.REQUIRE_ACCESS_TOKEN&&f&&this._skuToken&&r.params.push("sku="+this._skuToken),this._makeAPIURL(r,f)},nr.prototype.canonicalizeTileURL=function(e,t){var r=E(e);if(!r.path.match(/(^\/v4\/)/)||!r.path.match(/\.[\w]+$/))return e;var f="mapbox://tiles/";f+=r.path.replace("/v4/","");var v=r.params;return t&&(v=v.filter(function(g){return!g.match(/^access_token=/)})),v.length&&(f+="?"+v.join("&")),f},nr.prototype.canonicalizeTileset=function(e,t){for(var r=!!t&&_r(t),f=[],v=0,g=e.tiles||[];v<g.length;v+=1){var x=g[v];fr(x)?f.push(this.canonicalizeTileURL(x,r)):f.push(x)}return f},nr.prototype._makeAPIURL=function(e,t){var r="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",f=E(or.API_URL);if(e.protocol=f.protocol,e.authority=f.authority,e.protocol==="http"){var v=e.params.indexOf("secure");v>=0&&e.params.splice(v,1)}if(f.path!=="/"&&(e.path=""+f.path+e.path),!or.REQUIRE_ACCESS_TOKEN)return V(e);if(!(t=t||or.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+r);if(t[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+r);return e.params=e.params.filter(function(g){return g.indexOf("access_token")===-1}),e.params.push("access_token="+t),V(e)};var Lr=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function fr(e){return Lr.test(e)}var H=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function E(e){var t=e.match(H);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function V(e){var t=e.params.length?"?"+e.params.join("&"):"";return e.protocol+"://"+e.authority+e.path+t}function Ze(e){if(!e)return null;var t=e.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(decodeURIComponent($.atob(t[1]).split("").map(function(r){return"%"+("00"+r.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(r){return null}}var tt=function(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};tt.prototype.getStorageKey=function(e){var t,r=Ze(or.ACCESS_TOKEN);return t=r&&r.u?$.btoa(encodeURIComponent(r.u).replace(/%([0-9A-F]{2})/g,function(f,v){return String.fromCharCode(Number("0x"+v))})):or.ACCESS_TOKEN||"",e?"mapbox.eventData."+e+":"+t:"mapbox.eventData:"+t},tt.prototype.fetchEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{var f=$.localStorage.getItem(t);f&&(this.eventData=JSON.parse(f));var v=$.localStorage.getItem(r);v&&(this.anonId=v)}catch(g){Xe("Unable to read from LocalStorage")}},tt.prototype.saveEventData=function(){var e=ge("localStorage"),t=this.getStorageKey(),r=this.getStorageKey("uuid");if(e)try{$.localStorage.setItem(r,this.anonId),Object.keys(this.eventData).length>=1&&$.localStorage.setItem(t,JSON.stringify(this.eventData))}catch(f){Xe("Unable to write to LocalStorage")}},tt.prototype.processRequests=function(e){},tt.prototype.postEvent=function(e,t,r,f){var v=this;if(or.EVENTS_URL){var g=E(or.EVENTS_URL);g.params.push("access_token="+(f||or.ACCESS_TOKEN||""));var x={event:this.type,created:new Date(e).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.2",skuId:kt,userId:this.anonId},P=t?Yt(x,t):x,D={url:V(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([P])};this.pendingRequest=Pi(D,function(Z){v.pendingRequest=null,r(Z),v.saveEventData(),v.processRequests(f)})}},tt.prototype.queueRequest=function(e,t){this.queue.push(e),this.processRequests(t)};var ut,wt,K=function(e){function t(){e.call(this,"map.load"),this.success={},this.skuToken=""}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postMapLoadEvent=function(r,f,v,g){this.skuToken=v,(or.EVENTS_URL&&g||or.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(x){return _r(x)||fr(x)}))&&this.queueRequest({id:f,timestamp:Date.now()},g)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){var v=this.queue.shift(),g=v.id,x=v.timestamp;g&&this.success[g]||(this.anonId||this.fetchEventData(),Ct(this.anonId)||(this.anonId=Tt()),this.postEvent(x,{skuToken:this.skuToken},function(P){P||g&&(f.success[g]=!0)},r))}},t}(tt),Ht=new(function(e){function t(r){e.call(this,"appUserTurnstile"),this._customAccessToken=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.postTurnstileEvent=function(r,f){or.EVENTS_URL&&or.ACCESS_TOKEN&&Array.isArray(r)&&r.some(function(v){return _r(v)||fr(v)})&&this.queueRequest(Date.now(),f)},t.prototype.processRequests=function(r){var f=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var v=Ze(or.ACCESS_TOKEN),g=v?v.u:or.ACCESS_TOKEN,x=g!==this.eventData.tokenU;Ct(this.anonId)||(this.anonId=Tt(),x=!0);var P=this.queue.shift();if(this.eventData.lastSuccess){var D=new Date(this.eventData.lastSuccess),Z=new Date(P),W=(P-this.eventData.lastSuccess)/864e5;x=x||W>=1||W<-1||D.getDate()!==Z.getDate()}else x=!0;if(!x)return this.processRequests();this.postEvent(P,{"enabled.telemetry":!1},function(te){te||(f.eventData.lastSuccess=P,f.eventData.tokenU=g)},r)}},t}(tt)),Tr=Ht.postTurnstileEvent.bind(Ht),Or=new K,Ye=Or.postMapLoadEvent.bind(Or),lt=500,At=50;function zt(){$.caches&&!ut&&(ut=$.caches.open("mapbox-tiles"))}function wr(e){var t=e.indexOf("?");return t<0?e:e.slice(0,t)}var Pr,er=1/0;function Jr(){return Pr==null&&(Pr=$.OffscreenCanvas&&new $.OffscreenCanvas(1,1).getContext("2d")&&typeof $.createImageBitmap=="function"),Pr}var Yr={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Yr);var En=function(e){function t(r,f,v){f===401&&fr(v)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),e.call(this,r),this.status=f,this.url=v,this.name=this.constructor.name,this.message=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},t}(Error),_n=qt()?function(){return self.worker&&self.worker.referrer}:function(){return($.location.protocol==="blob:"?$.parent:$).location.href},ei,si,na=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(_n())&&!/^\w+:/.test(r))){if($.fetch&&$.Request&&$.AbortController&&$.Request.prototype.hasOwnProperty("signal"))return function(f,v){var g,x=new $.AbortController,P=new $.Request(f.url,{method:f.method||"GET",body:f.body,credentials:f.credentials,headers:f.headers,referrer:_n(),signal:x.signal}),D=!1,Z=!1,W=(g=P.url).indexOf("sku=")>0&&fr(g);f.type==="json"&&P.headers.set("Accept","application/json");var te=function(xe,Ve,We){if(!Z){if(xe&&xe.message!=="SecurityError"&&Xe(xe),Ve&&We)return fe(Ve);var yt=Date.now();$.fetch(P).then(function(rt){if(rt.ok){var Pt=W?rt.clone():null;return fe(rt,Pt,yt)}return v(new En(rt.statusText,rt.status,f.url))}).catch(function(rt){rt.code!==20&&v(new Error(rt.message))})}},fe=function(xe,Ve,We){(f.type==="arrayBuffer"?xe.arrayBuffer():f.type==="json"?xe.json():xe.text()).then(function(yt){Z||(Ve&&We&&function(rt,Pt,Xt){if(zt(),ut){var hr={status:Pt.status,statusText:Pt.statusText,headers:new $.Headers};Pt.headers.forEach(function(Nr,ln){return hr.headers.set(ln,Nr)});var yr=Xr(Pt.headers.get("Cache-Control")||"");yr["no-store"]||(yr["max-age"]&&hr.headers.set("Expires",new Date(Xt+1e3*yr["max-age"]).toUTCString()),new Date(hr.headers.get("Expires")).getTime()-Xt<42e4||function(Nr,ln){if(wt===void 0)try{new Response(new ReadableStream),wt=!0}catch(Sn){wt=!1}wt?ln(Nr.body):Nr.blob().then(ln)}(Pt,function(Nr){var ln=new $.Response(Nr,hr);zt(),ut&&ut.then(function(Sn){return Sn.put(wr(rt.url),ln)}).catch(function(Sn){return Xe(Sn.message)})}))}}(P,Ve,We),D=!0,v(null,yt,xe.headers.get("Cache-Control"),xe.headers.get("Expires")))}).catch(function(yt){Z||v(new Error(yt.message))})};return W?function(xe,Ve){if(zt(),!ut)return Ve(null);var We=wr(xe.url);ut.then(function(yt){yt.match(We).then(function(rt){var Pt=function(Xt){if(!Xt)return!1;var hr=new Date(Xt.headers.get("Expires")||0),yr=Xr(Xt.headers.get("Cache-Control")||"");return hr>Date.now()&&!yr["no-cache"]}(rt);yt.delete(We),Pt&&yt.put(We,rt.clone()),Ve(null,rt,Pt)}).catch(Ve)}).catch(Ve)}(P,te):te(null,null),{cancel:function(){Z=!0,D||x.abort()}}}(e,t);if(qt()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(f,v){var g=new $.XMLHttpRequest;for(var x in g.open(f.method||"GET",f.url,!0),f.type==="arrayBuffer"&&(g.responseType="arraybuffer"),f.headers)g.setRequestHeader(x,f.headers[x]);return f.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=f.credentials==="include",g.onerror=function(){v(new Error(g.statusText))},g.onload=function(){if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){var P=g.response;if(f.type==="json")try{P=JSON.parse(g.response)}catch(D){return v(D)}v(null,P,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else v(new En(g.statusText,g.status,f.url))},g.send(f.body),{cancel:function(){return g.abort()}}}(e,t)},Zi=function(e,t){return na(Yt(e,{type:"arrayBuffer"}),t)},Pi=function(e,t){return na(Yt(e,{method:"POST"}),t)},X="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ei=[],si=0;var ue=function(e,t){if(me.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),si>=or.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:t,cancelled:!1,cancel:function(){this.cancelled=!0}};return ei.push(r),r}si++;var f=!1,v=function(){if(!f)for(f=!0,si--;ei.length&&si<or.MAX_PARALLEL_IMAGE_REQUESTS;){var x=ei.shift();x.cancelled||(x.cancel=ue(x.requestParameters,x.callback).cancel)}},g=Zi(e,function(x,P,D,Z){v(),x?t(x):P&&(Jr()?function(W,te){var fe=new $.Blob([new Uint8Array(W)],{type:"image/png"});$.createImageBitmap(fe).then(function(xe){te(null,xe)}).catch(function(xe){te(new Error("Could not load image because of "+xe.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(P,t):function(W,te,fe,xe){var Ve=new $.Image,We=$.URL;Ve.onload=function(){te(null,Ve),We.revokeObjectURL(Ve.src),Ve.onload=null,$.requestAnimationFrame(function(){Ve.src=X})},Ve.onerror=function(){return te(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var yt=new $.Blob([new Uint8Array(W)],{type:"image/png"});Ve.cacheControl=fe,Ve.expires=xe,Ve.src=W.byteLength?We.createObjectURL(yt):X}(P,t,D,Z))});return{cancel:function(){g.cancel(),v()}}};function pe(e,t,r){r[e]&&r[e].indexOf(t)!==-1||(r[e]=r[e]||[],r[e].push(t))}function F(e,t,r){if(r&&r[e]){var f=r[e].indexOf(t);f!==-1&&r[e].splice(f,1)}}var ee=function(e,t){t===void 0&&(t={}),Yt(this,t),this.type=e},he=function(e){function t(r,f){f===void 0&&(f={}),e.call(this,"error",Yt({error:r},f))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(ee),Te=function(){};Te.prototype.on=function(e,t){return this._listeners=this._listeners||{},pe(e,t,this._listeners),this},Te.prototype.off=function(e,t){return F(e,t,this._listeners),F(e,t,this._oneTimeListeners),this},Te.prototype.once=function(e,t){return this._oneTimeListeners=this._oneTimeListeners||{},pe(e,t,this._oneTimeListeners),this},Te.prototype.fire=function(e,t){typeof e=="string"&&(e=new ee(e,t||{}));var r=e.type;if(this.listens(r)){e.target=this;for(var f=0,v=this._listeners&&this._listeners[r]?this._listeners[r].slice():[];f<v.length;f+=1)v[f].call(this,e);for(var g=0,x=this._oneTimeListeners&&this._oneTimeListeners[r]?this._oneTimeListeners[r].slice():[];g<x.length;g+=1){var P=x[g];F(r,P,this._oneTimeListeners),P.call(this,e)}var D=this._eventedParent;D&&(Yt(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),D.fire(e))}else e instanceof he&&console.error(e.error);return this},Te.prototype.listens=function(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)},Te.prototype.setEventedParent=function(e,t){return this._eventedParent=e,this._eventedParentData=t,this};var ae={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Ee=function(e,t,r,f){this.message=(e?e+": ":"")+r,f&&(this.identifier=f),t!=null&&t.__line__&&(this.line=t.__line__)};function mt(e){var t=e.value;return t?[new Ee(e.key,t,"constants have been deprecated as of v8")]:[]}function Sr(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];for(var f=0,v=t;f<v.length;f+=1){var g=v[f];for(var x in g)e[x]=g[x]}return e}function Wt(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function Ke(e){if(Array.isArray(e))return e.map(Ke);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){var t={};for(var r in e)t[r]=Ke(e[r]);return t}return Wt(e)}var Zr=function(e){function t(r,f){e.call(this,f),this.message=f,this.key=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Error),kn=function(e,t){t===void 0&&(t=[]),this.parent=e,this.bindings={};for(var r=0,f=t;r<f.length;r+=1){var v=f[r];this.bindings[v[0]]=v[1]}};kn.prototype.concat=function(e){return new kn(this,e)},kn.prototype.get=function(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(e+" not found in scope.")},kn.prototype.has=function(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)};var Rn={kind:"null"},ft={kind:"number"},vr={kind:"string"},et={kind:"boolean"},Dr={kind:"color"},In={kind:"object"},tr={kind:"value"},Ni={kind:"collator"},ia={kind:"formatted"},hi={kind:"resolvedImage"};function Fi(e,t){return{kind:"array",itemType:e,N:t}}function Wi(e){if(e.kind==="array"){var t=Wi(e.itemType);return typeof e.N=="number"?"array<"+t+", "+e.N+">":e.itemType.kind==="value"?"array":"array<"+t+">"}return e.kind}var yi=[Rn,ft,vr,et,Dr,ia,In,Fi(tr),hi];function ya(e,t){if(t.kind==="error")return null;if(e.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!ya(e.itemType,t.itemType))&&(typeof e.N!="number"||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if(e.kind==="value"){for(var r=0,f=yi;r<f.length;r+=1)if(!ya(f[r],t))return null}}return"Expected "+Wi(e)+" but found "+Wi(t)+" instead."}function La(e,t){return t.some(function(r){return r.kind===e.kind})}function _i(e,t){return t.some(function(r){return r==="null"?e===null:r==="array"?Array.isArray(e):r==="object"?e&&!Array.isArray(e)&&typeof e=="object":r===typeof e})}var Mi=de(function(e,t){var r={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function f(P){return(P=Math.round(P))<0?0:P>255?255:P}function v(P){return f(P[P.length-1]==="%"?parseFloat(P)/100*255:parseInt(P))}function g(P){return(D=P[P.length-1]==="%"?parseFloat(P)/100:parseFloat(P))<0?0:D>1?1:D;var D}function x(P,D,Z){return Z<0?Z+=1:Z>1&&(Z-=1),6*Z<1?P+(D-P)*Z*6:2*Z<1?D:3*Z<2?P+(D-P)*(2/3-Z)*6:P}try{t.parseCSSColor=function(P){var D,Z=P.replace(/ /g,"").toLowerCase();if(Z in r)return r[Z].slice();if(Z[0]==="#")return Z.length===4?(D=parseInt(Z.substr(1),16))>=0&&D<=4095?[(3840&D)>>4|(3840&D)>>8,240&D|(240&D)>>4,15&D|(15&D)<<4,1]:null:Z.length===7&&(D=parseInt(Z.substr(1),16))>=0&&D<=16777215?[(16711680&D)>>16,(65280&D)>>8,255&D,1]:null;var W=Z.indexOf("("),te=Z.indexOf(")");if(W!==-1&&te+1===Z.length){var fe=Z.substr(0,W),xe=Z.substr(W+1,te-(W+1)).split(","),Ve=1;switch(fe){case"rgba":if(xe.length!==4)return null;Ve=g(xe.pop());case"rgb":return xe.length!==3?null:[v(xe[0]),v(xe[1]),v(xe[2]),Ve];case"hsla":if(xe.length!==4)return null;Ve=g(xe.pop());case"hsl":if(xe.length!==3)return null;var We=(parseFloat(xe[0])%360+360)%360/360,yt=g(xe[1]),rt=g(xe[2]),Pt=rt<=.5?rt*(yt+1):rt+yt-rt*yt,Xt=2*rt-Pt;return[f(255*x(Xt,Pt,We+1/3)),f(255*x(Xt,Pt,We)),f(255*x(Xt,Pt,We-1/3)),Ve];default:return null}}return null}}catch(P){}}).parseCSSColor,Ji=function(e,t,r,f){f===void 0&&(f=1),this.r=e,this.g=t,this.b=r,this.a=f};Ji.parse=function(e){if(e){if(e instanceof Ji)return e;if(typeof e=="string"){var t=Mi(e);if(t)return new Ji(t[0]/255*t[3],t[1]/255*t[3],t[2]/255*t[3],t[3])}}},Ji.prototype.toString=function(){var e=this.toArray(),t=e[1],r=e[2],f=e[3];return"rgba("+Math.round(e[0])+","+Math.round(t)+","+Math.round(r)+","+f+")"},Ji.prototype.toArray=function(){var e=this.a;return e===0?[0,0,0,0]:[255*this.r/e,255*this.g/e,255*this.b/e,e]},Ji.black=new Ji(0,0,0,1),Ji.white=new Ji(1,1,1,1),Ji.transparent=new Ji(0,0,0,0),Ji.red=new Ji(1,0,0,1);var to=function(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};to.prototype.compare=function(e,t){return this.collator.compare(e,t)},to.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var jo=function(e,t,r,f,v){this.text=e,this.image=t,this.scale=r,this.fontStack=f,this.textColor=v},ja=function(e){this.sections=e};ja.fromString=function(e){return new ja([new jo(e,null,null,null,null)])},ja.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(e){return e.text.length!==0||e.image&&e.image.name.length!==0})},ja.factory=function(e){return e instanceof ja?e:ja.fromString(e)},ja.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(e){return e.text}).join("")},ja.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];if(f.image)e.push(["image",f.image.name]);else{e.push(f.text);var v={};f.fontStack&&(v["text-font"]=["literal",f.fontStack.split(",")]),f.scale&&(v["font-scale"]=f.scale),f.textColor&&(v["text-color"]=["rgba"].concat(f.textColor.toArray())),e.push(v)}}return e};var Xi=function(e){this.name=e.name,this.available=e.available};function du(e,t,r,f){return typeof e=="number"&&e>=0&&e<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof r=="number"&&r>=0&&r<=255?f===void 0||typeof f=="number"&&f>=0&&f<=1?null:"Invalid rgba value ["+[e,t,r,f].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof f=="number"?[e,t,r,f]:[e,t,r]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ku(e){if(e===null||typeof e=="string"||typeof e=="boolean"||typeof e=="number"||e instanceof Ji||e instanceof to||e instanceof ja||e instanceof Xi)return!0;if(Array.isArray(e)){for(var t=0,r=e;t<r.length;t+=1)if(!ku(r[t]))return!1;return!0}if(typeof e=="object"){for(var f in e)if(!ku(e[f]))return!1;return!0}return!1}function Ba(e){if(e===null)return Rn;if(typeof e=="string")return vr;if(typeof e=="boolean")return et;if(typeof e=="number")return ft;if(e instanceof Ji)return Dr;if(e instanceof to)return Ni;if(e instanceof ja)return ia;if(e instanceof Xi)return hi;if(Array.isArray(e)){for(var t,r=e.length,f=0,v=e;f<v.length;f+=1){var g=Ba(v[f]);if(t){if(t===g)continue;t=tr;break}t=g}return Fi(t||tr,r)}return In}function Vo(e){var t=typeof e;return e===null?"":t==="string"||t==="number"||t==="boolean"?String(e):e instanceof Ji||e instanceof ja||e instanceof Xi?e.toString():JSON.stringify(e)}Xi.prototype.toString=function(){return this.name},Xi.fromString=function(e){return e?new Xi({name:e,available:!1}):null},Xi.prototype.serialize=function(){return["image",this.name]};var Yi=function(e,t){this.type=e,this.value=t};Yi.parse=function(e,t){if(e.length!==2)return t.error("'literal' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(!ku(e[1]))return t.error("invalid value");var r=e[1],f=Ba(r),v=t.expectedType;return f.kind!=="array"||f.N!==0||!v||v.kind!=="array"||typeof v.N=="number"&&v.N!==0||(f=v),new Yi(f,r)},Yi.prototype.evaluate=function(){return this.value},Yi.prototype.eachChild=function(){},Yi.prototype.outputDefined=function(){return!0},Yi.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ji?["rgba"].concat(this.value.toArray()):this.value instanceof ja?this.value.serialize():this.value};var ro=function(e){this.name="ExpressionEvaluationError",this.message=e};ro.prototype.toJSON=function(){return this.message};var Jo={string:vr,number:ft,boolean:et,object:In},xa=function(e,t){this.type=e,this.args=t};xa.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r,f=1,v=e[0];if(v==="array"){var g,x;if(e.length>2){var P=e[1];if(typeof P!="string"||!(P in Jo)||P==="object")return t.error('The item type argument of "array" must be one of string, number, boolean',1);g=Jo[P],f++}else g=tr;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);x=e[2],f++}r=Fi(g,x)}else r=Jo[v];for(var D=[];f<e.length;f++){var Z=t.parse(e[f],f,tr);if(!Z)return null;D.push(Z)}return new xa(r,D)},xa.prototype.evaluate=function(e){for(var t=0;t<this.args.length;t++){var r=this.args[t].evaluate(e);if(!ya(this.type,Ba(r)))return r;if(t===this.args.length-1)throw new ro("Expected value to be of type "+Wi(this.type)+", but found "+Wi(Ba(r))+" instead.")}return null},xa.prototype.eachChild=function(e){this.args.forEach(e)},xa.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},xa.prototype.serialize=function(){var e=this.type,t=[e.kind];if(e.kind==="array"){var r=e.itemType;if(r.kind==="string"||r.kind==="number"||r.kind==="boolean"){t.push(r.kind);var f=e.N;(typeof f=="number"||this.args.length>1)&&t.push(f)}}return t.concat(this.args.map(function(v){return v.serialize()}))};var Lo=function(e){this.type=ia,this.sections=e};Lo.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[1];if(!Array.isArray(r)&&typeof r=="object")return t.error("First argument must be an image or text section.");for(var f=[],v=!1,g=1;g<=e.length-1;++g){var x=e[g];if(v&&typeof x=="object"&&!Array.isArray(x)){v=!1;var P=null;if(x["font-scale"]&&!(P=t.parse(x["font-scale"],1,ft)))return null;var D=null;if(x["text-font"]&&!(D=t.parse(x["text-font"],1,Fi(vr))))return null;var Z=null;if(x["text-color"]&&!(Z=t.parse(x["text-color"],1,Dr)))return null;var W=f[f.length-1];W.scale=P,W.font=D,W.textColor=Z}else{var te=t.parse(e[g],1,tr);if(!te)return null;var fe=te.type.kind;if(fe!=="string"&&fe!=="value"&&fe!=="null"&&fe!=="resolvedImage")return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");v=!0,f.push({content:te,scale:null,font:null,textColor:null})}}return new Lo(f)},Lo.prototype.evaluate=function(e){return new ja(this.sections.map(function(t){var r=t.content.evaluate(e);return Ba(r)===hi?new jo("",r,null,null,null):new jo(Vo(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))},Lo.prototype.eachChild=function(e){for(var t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e(f.content),f.scale&&e(f.scale),f.font&&e(f.font),f.textColor&&e(f.textColor)}},Lo.prototype.outputDefined=function(){return!1},Lo.prototype.serialize=function(){for(var e=["format"],t=0,r=this.sections;t<r.length;t+=1){var f=r[t];e.push(f.content.serialize());var v={};f.scale&&(v["font-scale"]=f.scale.serialize()),f.font&&(v["text-font"]=f.font.serialize()),f.textColor&&(v["text-color"]=f.textColor.serialize()),e.push(v)}return e};var No=function(e){this.type=hi,this.input=e};No.parse=function(e,t){if(e.length!==2)return t.error("Expected two arguments.");var r=t.parse(e[1],1,vr);return r?new No(r):t.error("No image name provided.")},No.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=Xi.fromString(t);return r&&e.availableImages&&(r.available=e.availableImages.indexOf(t)>-1),r},No.prototype.eachChild=function(e){e(this.input)},No.prototype.outputDefined=function(){return!1},No.prototype.serialize=function(){return["image",this.input.serialize()]};var Us={"to-boolean":et,"to-color":Dr,"to-number":ft,"to-string":vr},_o=function(e,t){this.type=e,this.args=t};_o.parse=function(e,t){if(e.length<2)return t.error("Expected at least one argument.");var r=e[0];if((r==="to-boolean"||r==="to-string")&&e.length!==2)return t.error("Expected one argument.");for(var f=Us[r],v=[],g=1;g<e.length;g++){var x=t.parse(e[g],g,tr);if(!x)return null;v.push(x)}return new _o(f,v)},_o.prototype.evaluate=function(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){for(var t,r,f=0,v=this.args;f<v.length;f+=1){if(r=null,(t=v[f].evaluate(e))instanceof Ji)return t;if(typeof t=="string"){var g=e.parseColor(t);if(g)return g}else if(Array.isArray(t)&&!(r=t.length<3||t.length>4?"Invalid rbga value "+JSON.stringify(t)+": expected an array containing either three or four numeric values.":du(t[0],t[1],t[2],t[3])))return new Ji(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new ro(r||"Could not parse color from value '"+(typeof t=="string"?t:String(JSON.stringify(t)))+"'")}if(this.type.kind==="number"){for(var x=null,P=0,D=this.args;P<D.length;P+=1){if((x=D[P].evaluate(e))===null)return 0;var Z=Number(x);if(!isNaN(Z))return Z}throw new ro("Could not convert "+JSON.stringify(x)+" to number.")}return this.type.kind==="formatted"?ja.fromString(Vo(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?Xi.fromString(Vo(this.args[0].evaluate(e))):Vo(this.args[0].evaluate(e))},_o.prototype.eachChild=function(e){this.args.forEach(e)},_o.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},_o.prototype.serialize=function(){if(this.type.kind==="formatted")return new Lo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new No(this.args[0]).serialize();var e=["to-"+this.type.kind];return this.eachChild(function(t){e.push(t.serialize())}),e};var Qo=["Unknown","Point","LineString","Polygon"],Va=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};Va.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},Va.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?Qo[this.feature.type]:this.feature.type:null},Va.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},Va.prototype.canonicalID=function(){return this.canonical},Va.prototype.properties=function(){return this.feature&&this.feature.properties||{}},Va.prototype.parseColor=function(e){var t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=Ji.parse(e)),t};var uo=function(e,t,r,f){this.name=e,this.type=t,this._evaluate=r,this.args=f};uo.prototype.evaluate=function(e){return this._evaluate(e,this.args)},uo.prototype.eachChild=function(e){this.args.forEach(e)},uo.prototype.outputDefined=function(){return!1},uo.prototype.serialize=function(){return[this.name].concat(this.args.map(function(e){return e.serialize()}))},uo.parse=function(e,t){var r,f=e[0],v=uo.definitions[f];if(!v)return t.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0);for(var g=Array.isArray(v)?v[0]:v.type,x=Array.isArray(v)?[[v[1],v[2]]]:v.overloads,P=x.filter(function(di){var Gn=di[0];return!Array.isArray(Gn)||Gn.length===e.length-1}),D=null,Z=0,W=P;Z<W.length;Z+=1){var te=W[Z],fe=te[0],xe=te[1];D=new Ws(t.registry,t.path,null,t.scope);for(var Ve=[],We=!1,yt=1;yt<e.length;yt++){var rt=e[yt],Pt=Array.isArray(fe)?fe[yt-1]:fe.type,Xt=D.parse(rt,1+Ve.length,Pt);if(!Xt){We=!0;break}Ve.push(Xt)}if(!We)if(Array.isArray(fe)&&fe.length!==Ve.length)D.error("Expected "+fe.length+" arguments, but found "+Ve.length+" instead.");else{for(var hr=0;hr<Ve.length;hr++){var yr=Array.isArray(fe)?fe[hr]:fe.type,Nr=Ve[hr];D.concat(hr+1).checkSubtype(yr,Nr.type)}if(D.errors.length===0)return new uo(f,g,xe,Ve)}}if(P.length===1)(r=t.errors).push.apply(r,D.errors);else{for(var ln=(P.length?P:x).map(function(di){var Gn;return Gn=di[0],Array.isArray(Gn)?"("+Gn.map(Wi).join(", ")+")":"("+Wi(Gn.type)+"...)"}).join(" | "),Sn=[],fi=1;fi<e.length;fi++){var Zn=t.parse(e[fi],1+Sn.length);if(!Zn)return null;Sn.push(Wi(Zn.type))}t.error("Expected arguments of type "+ln+", but found ("+Sn.join(", ")+") instead.")}return null},uo.register=function(e,t){for(var r in uo.definitions=t,t)e[r]=uo};var ss=function(e,t,r){this.type=Ni,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t};function Co(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function _e(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function De(e,t){var r=(180+e[0])/360,f=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,v=Math.pow(2,t.z);return[Math.round(r*v*8192),Math.round(f*v*8192)]}function pt(e,t,r){return t[1]>e[1]!=r[1]>e[1]&&e[0]<(r[0]-t[0])*(e[1]-t[1])/(r[1]-t[1])+t[0]}function $t(e,t){for(var r,f,v,g,x,P,D,Z=!1,W=0,te=t.length;W<te;W++)for(var fe=t[W],xe=0,Ve=fe.length;xe<Ve-1;xe++){if((g=(r=e)[0]-(f=fe[xe])[0])*(D=r[1]-(v=fe[xe+1])[1])-(P=r[0]-v[0])*(x=r[1]-f[1])==0&&g*P<=0&&x*D<=0)return!1;pt(e,fe[xe],fe[xe+1])&&(Z=!Z)}return Z}function en(e,t){for(var r=0;r<t.length;r++)if($t(e,t[r]))return!0;return!1}function ti(e,t,r,f){var v=f[0]-r[0],g=f[1]-r[1],x=(e[0]-r[0])*g-v*(e[1]-r[1]),P=(t[0]-r[0])*g-v*(t[1]-r[1]);return x>0&&P<0||x<0&&P>0}function Ai(e,t,r){for(var f=0,v=r;f<v.length;f+=1)for(var g=v[f],x=0;x<g.length-1;++x)if((te=[(W=g[x+1])[0]-(Z=g[x])[0],W[1]-Z[1]])[0]*(fe=[(D=t)[0]-(P=e)[0],D[1]-P[1]])[1]-te[1]*fe[0]!=0&&ti(P,D,Z,W)&&ti(Z,W,P,D))return!0;var P,D,Z,W,te,fe;return!1}function ha(e,t){for(var r=0;r<e.length;++r)if(!$t(e[r],t))return!1;for(var f=0;f<e.length-1;++f)if(Ai(e[f],e[f+1],t))return!1;return!0}function Na(e,t){for(var r=0;r<t.length;r++)if(ha(e,t[r]))return!0;return!1}function po(e,t,r){for(var f=[],v=0;v<e.length;v++){for(var g=[],x=0;x<e[v].length;x++){var P=De(e[v][x],r);Co(t,P),g.push(P)}f.push(g)}return f}function us(e,t,r){for(var f=[],v=0;v<e.length;v++){var g=po(e[v],t,r);f.push(g)}return f}function vu(e,t,r,f){if(e[0]<r[0]||e[0]>r[2]){var v=.5*f,g=e[0]-r[0]>v?-f:r[0]-e[0]>v?f:0;g===0&&(g=e[0]-r[2]>v?-f:r[2]-e[0]>v?f:0),e[0]+=g}Co(t,e)}function Au(e,t,r,f){for(var v=8192*Math.pow(2,f.z),g=[8192*f.x,8192*f.y],x=[],P=0,D=e;P<D.length;P+=1)for(var Z=0,W=D[P];Z<W.length;Z+=1){var te=W[Z],fe=[te.x+g[0],te.y+g[1]];vu(fe,t,r,v),x.push(fe)}return x}function Xu(e,t,r,f){for(var v,g=8192*Math.pow(2,f.z),x=[8192*f.x,8192*f.y],P=[],D=0,Z=e;D<Z.length;D+=1){for(var W=[],te=0,fe=Z[D];te<fe.length;te+=1){var xe=fe[te],Ve=[xe.x+x[0],xe.y+x[1]];Co(t,Ve),W.push(Ve)}P.push(W)}if(t[2]-t[0]<=g/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(var We=0,yt=P;We<yt.length;We+=1)for(var rt=0,Pt=yt[We];rt<Pt.length;rt+=1)vu(Pt[rt],t,r,g)}return P}ss.parse=function(e,t){if(e.length!==2)return t.error("Expected one argument.");var r=e[1];if(typeof r!="object"||Array.isArray(r))return t.error("Collator options argument must be an object.");var f=t.parse(r["case-sensitive"]!==void 0&&r["case-sensitive"],1,et);if(!f)return null;var v=t.parse(r["diacritic-sensitive"]!==void 0&&r["diacritic-sensitive"],1,et);if(!v)return null;var g=null;return r.locale&&!(g=t.parse(r.locale,1,vr))?null:new ss(f,v,g)},ss.prototype.evaluate=function(e){return new to(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)},ss.prototype.eachChild=function(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)},ss.prototype.outputDefined=function(){return!1},ss.prototype.serialize=function(){var e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]};var Go=function(e,t){this.type=et,this.geojson=e,this.geometries=t};function qo(e){if(e instanceof uo&&(e.name==="get"&&e.args.length===1||e.name==="feature-state"||e.name==="has"&&e.args.length===1||e.name==="properties"||e.name==="geometry-type"||e.name==="id"||/^filter-/.test(e.name))||e instanceof Go)return!1;var t=!0;return e.eachChild(function(r){t&&!qo(r)&&(t=!1)}),t}function ls(e){if(e instanceof uo&&e.name==="feature-state")return!1;var t=!0;return e.eachChild(function(r){t&&!ls(r)&&(t=!1)}),t}function ys(e,t){if(e instanceof uo&&t.indexOf(e.name)>=0)return!1;var r=!0;return e.eachChild(function(f){r&&!ys(f,t)&&(r=!1)}),r}Go.parse=function(e,t){if(e.length!==2)return t.error("'within' expression requires exactly one argument, but found "+(e.length-1)+" instead.");if(ku(e[1])){var r=e[1];if(r.type==="FeatureCollection")for(var f=0;f<r.features.length;++f){var v=r.features[f].geometry.type;if(v==="Polygon"||v==="MultiPolygon")return new Go(r,r.features[f].geometry)}else if(r.type==="Feature"){var g=r.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Go(r,r.geometry)}else if(r.type==="Polygon"||r.type==="MultiPolygon")return new Go(r,r)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Go.prototype.evaluate=function(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var x=po(r.coordinates,v,g),P=Au(t.geometry(),f,v,g);if(!_e(f,v))return!1;for(var D=0,Z=P;D<Z.length;D+=1)if(!$t(Z[D],x))return!1}if(r.type==="MultiPolygon"){var W=us(r.coordinates,v,g),te=Au(t.geometry(),f,v,g);if(!_e(f,v))return!1;for(var fe=0,xe=te;fe<xe.length;fe+=1)if(!en(xe[fe],W))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(t,r){var f=[1/0,1/0,-1/0,-1/0],v=[1/0,1/0,-1/0,-1/0],g=t.canonicalID();if(r.type==="Polygon"){var x=po(r.coordinates,v,g),P=Xu(t.geometry(),f,v,g);if(!_e(f,v))return!1;for(var D=0,Z=P;D<Z.length;D+=1)if(!ha(Z[D],x))return!1}if(r.type==="MultiPolygon"){var W=us(r.coordinates,v,g),te=Xu(t.geometry(),f,v,g);if(!_e(f,v))return!1;for(var fe=0,xe=te;fe<xe.length;fe+=1)if(!Na(xe[fe],W))return!1}return!0}(e,this.geometries)}return!1},Go.prototype.eachChild=function(){},Go.prototype.outputDefined=function(){return!0},Go.prototype.serialize=function(){return["within",this.geojson]};var Ho=function(e,t){this.type=t.type,this.name=e,this.boundExpression=t};Ho.parse=function(e,t){if(e.length!==2||typeof e[1]!="string")return t.error("'var' expression requires exactly one string literal argument.");var r=e[1];return t.scope.has(r)?new Ho(r,t.scope.get(r)):t.error('Unknown variable "'+r+'". Make sure "'+r+'" has been bound in an enclosing "let" expression before using it.',1)},Ho.prototype.evaluate=function(e){return this.boundExpression.evaluate(e)},Ho.prototype.eachChild=function(){},Ho.prototype.outputDefined=function(){return!1},Ho.prototype.serialize=function(){return["var",this.name]};var Ws=function(e,t,r,f,v){t===void 0&&(t=[]),f===void 0&&(f=new kn),v===void 0&&(v=[]),this.registry=e,this.path=t,this.key=t.map(function(g){return"["+g+"]"}).join(""),this.scope=f,this.errors=v,this.expectedType=r};function ru(e,t){for(var r,f=e.length-1,v=0,g=f,x=0;v<=g;)if((r=e[x=Math.floor((v+g)/2)])<=t){if(x===f||t<e[x+1])return x;v=x+1}else{if(!(r>t))throw new ro("Input is not a number.");g=x-1}return 0}Ws.prototype.parse=function(e,t,r,f,v){return v===void 0&&(v={}),t?this.concat(t,r,f)._parse(e,v):this._parse(e,v)},Ws.prototype._parse=function(e,t){function r(Z,W,te){return te==="assert"?new xa(W,[Z]):te==="coerce"?new _o(W,[Z]):Z}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var f=e[0];if(typeof f!="string")return this.error("Expression name must be a string, but found "+typeof f+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var v=this.registry[f];if(v){var g=v.parse(e,this);if(!g)return null;if(this.expectedType){var x=this.expectedType,P=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||P.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||P.kind!=="value"&&P.kind!=="string"){if(this.checkSubtype(x,P))return null}else g=r(g,x,t.typeAnnotation||"coerce");else g=r(g,x,t.typeAnnotation||"assert")}if(!(g instanceof Yi)&&g.type.kind!=="resolvedImage"&&function Z(W){if(W instanceof Ho)return Z(W.boundExpression);if(W instanceof uo&&W.name==="error"||W instanceof ss||W instanceof Go)return!1;var te=W instanceof _o||W instanceof xa,fe=!0;return W.eachChild(function(xe){fe=te?fe&&Z(xe):fe&&xe instanceof Yi}),!!fe&&qo(W)&&ys(W,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(g)){var D=new Va;try{g=new Yi(g.type,g.evaluate(D))}catch(Z){return this.error(Z.message),null}}return g}return this.error('Unknown expression "'+f+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof e+" instead.")},Ws.prototype.concat=function(e,t,r){var f=typeof e=="number"?this.path.concat(e):this.path,v=r?this.scope.concat(r):this.scope;return new Ws(this.registry,f,t||null,v,this.errors)},Ws.prototype.error=function(e){for(var t=[],r=arguments.length-1;r-- >0;)t[r]=arguments[r+1];var f=""+this.key+t.map(function(v){return"["+v+"]"}).join("");this.errors.push(new Zr(f,e))},Ws.prototype.checkSubtype=function(e,t){var r=ya(e,t);return r&&this.error(r),r};var Is=function(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(var f=0,v=r;f<v.length;f+=1){var g=v[f],x=g[1];this.labels.push(g[0]),this.outputs.push(x)}};function Ta(e,t,r){return e*(1-r)+t*r}Is.parse=function(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");var r=t.parse(e[1],1,ft);if(!r)return null;var f=[],v=null;t.expectedType&&t.expectedType.kind!=="value"&&(v=t.expectedType);for(var g=1;g<e.length;g+=2){var x=g===1?-1/0:e[g],P=e[g+1],D=g,Z=g+1;if(typeof x!="number")return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(f.length&&f[f.length-1][0]>=x)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);var W=t.parse(P,Z,v);if(!W)return null;v=v||W.type,f.push([x,W])}return new Is(v,r,f)},Is.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;return f>=t[v-1]?r[v-1].evaluate(e):r[ru(t,f)].evaluate(e)},Is.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Is.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Is.prototype.serialize=function(){for(var e=["step",this.input.serialize()],t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e};var Ro=Object.freeze({__proto__:null,number:Ta,color:function(e,t,r){return new Ji(Ta(e.r,t.r,r),Ta(e.g,t.g,r),Ta(e.b,t.b,r),Ta(e.a,t.a,r))},array:function(e,t,r){return e.map(function(f,v){return Ta(f,t[v],r)})}}),gl=6/29*3*(6/29),U=Math.PI/180,nl=180/Math.PI;function Rl(e){return e>.008856451679035631?Math.pow(e,1/3):e/gl+4/29}function yl(e){return e>6/29?e*e*e:gl*(e-4/29)}function il(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function nu(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Fu(e){var t=nu(e.r),r=nu(e.g),f=nu(e.b),v=Rl((.4124564*t+.3575761*r+.1804375*f)/.95047),g=Rl((.2126729*t+.7151522*r+.072175*f)/1);return{l:116*g-16,a:500*(v-g),b:200*(g-Rl((.0193339*t+.119192*r+.9503041*f)/1.08883)),alpha:e.a}}function m(e){var t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,f=isNaN(e.b)?t:t-e.b/200;return t=1*yl(t),r=.95047*yl(r),f=1.08883*yl(f),new Ji(il(3.2404542*r-1.5371385*t-.4985314*f),il(-.969266*r+1.8760108*t+.041556*f),il(.0556434*r-.2040259*t+1.0572252*f),e.alpha)}function w(e,t,r){var f=t-e;return e+r*(f>180||f<-180?f-360*Math.round(f/360):f)}var N={forward:Fu,reverse:m,interpolate:function(e,t,r){return{l:Ta(e.l,t.l,r),a:Ta(e.a,t.a,r),b:Ta(e.b,t.b,r),alpha:Ta(e.alpha,t.alpha,r)}}},I={forward:function(e){var t=Fu(e),r=t.l,f=t.a,v=t.b,g=Math.atan2(v,f)*nl;return{h:g<0?g+360:g,c:Math.sqrt(f*f+v*v),l:r,alpha:e.a}},reverse:function(e){var t=e.h*U,r=e.c;return m({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:w(e.h,t.h,r),c:Ta(e.c,t.c,r),l:Ta(e.l,t.l,r),alpha:Ta(e.alpha,t.alpha,r)}}},le=Object.freeze({__proto__:null,lab:N,hcl:I}),Oe=function(e,t,r,f,v){this.type=e,this.operator=t,this.interpolation=r,this.input=f,this.labels=[],this.outputs=[];for(var g=0,x=v;g<x.length;g+=1){var P=x[g],D=P[1];this.labels.push(P[0]),this.outputs.push(D)}};function ct(e,t,r,f){var v=f-r,g=e-r;return v===0?0:t===1?g/v:(Math.pow(t,g)-1)/(Math.pow(t,v)-1)}Oe.interpolationFactor=function(e,t,r,f){var v=0;if(e.name==="exponential")v=ct(t,e.base,r,f);else if(e.name==="linear")v=ct(t,1,r,f);else if(e.name==="cubic-bezier"){var g=e.controlPoints;v=new re(g[0],g[1],g[2],g[3]).solve(ct(t,1,r,f))}return v},Oe.parse=function(e,t){var r=e[0],f=e[1],v=e[2],g=e.slice(3);if(!Array.isArray(f)||f.length===0)return t.error("Expected an interpolation type expression.",1);if(f[0]==="linear")f={name:"linear"};else if(f[0]==="exponential"){var x=f[1];if(typeof x!="number")return t.error("Exponential interpolation requires a numeric base.",1,1);f={name:"exponential",base:x}}else{if(f[0]!=="cubic-bezier")return t.error("Unknown interpolation type "+String(f[0]),1,0);var P=f.slice(1);if(P.length!==4||P.some(function(yt){return typeof yt!="number"||yt<0||yt>1}))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);f={name:"cubic-bezier",controlPoints:P}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(!(v=t.parse(v,2,ft)))return null;var D=[],Z=null;r==="interpolate-hcl"||r==="interpolate-lab"?Z=Dr:t.expectedType&&t.expectedType.kind!=="value"&&(Z=t.expectedType);for(var W=0;W<g.length;W+=2){var te=g[W],fe=g[W+1],xe=W+3,Ve=W+4;if(typeof te!="number")return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',xe);if(D.length&&D[D.length-1][0]>=te)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',xe);var We=t.parse(fe,Ve,Z);if(!We)return null;Z=Z||We.type,D.push([te,We])}return Z.kind==="number"||Z.kind==="color"||Z.kind==="array"&&Z.itemType.kind==="number"&&typeof Z.N=="number"?new Oe(Z,r,f,v,D):t.error("Type "+Wi(Z)+" is not interpolatable.")},Oe.prototype.evaluate=function(e){var t=this.labels,r=this.outputs;if(t.length===1)return r[0].evaluate(e);var f=this.input.evaluate(e);if(f<=t[0])return r[0].evaluate(e);var v=t.length;if(f>=t[v-1])return r[v-1].evaluate(e);var g=ru(t,f),x=Oe.interpolationFactor(this.interpolation,f,t[g],t[g+1]),P=r[g].evaluate(e),D=r[g+1].evaluate(e);return this.operator==="interpolate"?Ro[this.type.kind.toLowerCase()](P,D,x):this.operator==="interpolate-hcl"?I.reverse(I.interpolate(I.forward(P),I.forward(D),x)):N.reverse(N.interpolate(N.forward(P),N.forward(D),x))},Oe.prototype.eachChild=function(e){e(this.input);for(var t=0,r=this.outputs;t<r.length;t+=1)e(r[t])},Oe.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})},Oe.prototype.serialize=function(){var e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var t=[this.operator,e,this.input.serialize()],r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t};var Ft=function(e,t){this.type=e,this.args=t};Ft.parse=function(e,t){if(e.length<2)return t.error("Expectected at least one argument.");var r=null,f=t.expectedType;f&&f.kind!=="value"&&(r=f);for(var v=[],g=0,x=e.slice(1);g<x.length;g+=1){var P=t.parse(x[g],1+v.length,r,void 0,{typeAnnotation:"omit"});if(!P)return null;r=r||P.type,v.push(P)}var D=f&&v.some(function(Z){return ya(f,Z.type)});return new Ft(D?tr:r,v)},Ft.prototype.evaluate=function(e){for(var t,r=null,f=0,v=0,g=this.args;v<g.length&&(f++,(r=g[v].evaluate(e))&&r instanceof Xi&&!r.available&&(t||(t=r.name),r=null,f===this.args.length&&(r=t)),r===null);v+=1);return r},Ft.prototype.eachChild=function(e){this.args.forEach(e)},Ft.prototype.outputDefined=function(){return this.args.every(function(e){return e.outputDefined()})},Ft.prototype.serialize=function(){var e=["coalesce"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Ut=function(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t};Ut.prototype.evaluate=function(e){return this.result.evaluate(e)},Ut.prototype.eachChild=function(e){for(var t=0,r=this.bindings;t<r.length;t+=1)e(r[t][1]);e(this.result)},Ut.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found "+(e.length-1)+" instead.");for(var r=[],f=1;f<e.length-1;f+=2){var v=e[f];if(typeof v!="string")return t.error("Expected string, but found "+typeof v+" instead.",f);if(/[^a-zA-Z0-9_]/.test(v))return t.error("Variable names must contain only alphanumeric characters or '_'.",f);var g=t.parse(e[f+1],f+1);if(!g)return null;r.push([v,g])}var x=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return x?new Ut(r,x):null},Ut.prototype.outputDefined=function(){return this.result.outputDefined()},Ut.prototype.serialize=function(){for(var e=["let"],t=0,r=this.bindings;t<r.length;t+=1){var f=r[t];e.push(f[0],f[1].serialize())}return e.push(this.result.serialize()),e};var Fr=function(e,t,r){this.type=e,this.index=t,this.input=r};Fr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,ft),f=t.parse(e[2],2,Fi(t.expectedType||tr));return r&&f?new Fr(f.type.itemType,r,f):null},Fr.prototype.evaluate=function(e){var t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new ro("Array index out of bounds: "+t+" < 0.");if(t>=r.length)throw new ro("Array index out of bounds: "+t+" > "+(r.length-1)+".");if(t!==Math.floor(t))throw new ro("Array index must be an integer, but found "+t+" instead.");return r[t]},Fr.prototype.eachChild=function(e){e(this.index),e(this.input)},Fr.prototype.outputDefined=function(){return!1},Fr.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var Kr=function(e,t){this.type=et,this.needle=e,this.haystack=t};Kr.parse=function(e,t){if(e.length!==3)return t.error("Expected 2 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,tr),f=t.parse(e[2],2,tr);return r&&f?La(r.type,[et,vr,ft,Rn,tr])?new Kr(r,f):t.error("Expected first argument to be of type boolean, string, number or null, but found "+Wi(r.type)+" instead"):null},Kr.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!r)return!1;if(!_i(t,["boolean","string","number","null"]))throw new ro("Expected first argument to be of type boolean, string, number or null, but found "+Wi(Ba(t))+" instead.");if(!_i(r,["string","array"]))throw new ro("Expected second argument to be of type array or string, but found "+Wi(Ba(r))+" instead.");return r.indexOf(t)>=0},Kr.prototype.eachChild=function(e){e(this.needle),e(this.haystack)},Kr.prototype.outputDefined=function(){return!0},Kr.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var ni=function(e,t,r){this.type=ft,this.needle=e,this.haystack=t,this.fromIndex=r};ni.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,tr),f=t.parse(e[2],2,tr);if(!r||!f)return null;if(!La(r.type,[et,vr,ft,Rn,tr]))return t.error("Expected first argument to be of type boolean, string, number or null, but found "+Wi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,ft);return v?new ni(r,f,v):null}return new ni(r,f)},ni.prototype.evaluate=function(e){var t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!_i(t,["boolean","string","number","null"]))throw new ro("Expected first argument to be of type boolean, string, number or null, but found "+Wi(Ba(t))+" instead.");if(!_i(r,["string","array"]))throw new ro("Expected second argument to be of type array or string, but found "+Wi(Ba(r))+" instead.");if(this.fromIndex){var f=this.fromIndex.evaluate(e);return r.indexOf(t,f)}return r.indexOf(t)},ni.prototype.eachChild=function(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)},ni.prototype.outputDefined=function(){return!1},ni.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Ii=function(e,t,r,f,v,g){this.inputType=e,this.type=t,this.input=r,this.cases=f,this.outputs=v,this.otherwise=g};Ii.parse=function(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only "+(e.length-1)+".");if(e.length%2!=1)return t.error("Expected an even number of arguments.");var r,f;t.expectedType&&t.expectedType.kind!=="value"&&(f=t.expectedType);for(var v={},g=[],x=2;x<e.length-1;x+=2){var P=e[x],D=e[x+1];Array.isArray(P)||(P=[P]);var Z=t.concat(x);if(P.length===0)return Z.error("Expected at least one branch label.");for(var W=0,te=P;W<te.length;W+=1){var fe=te[W];if(typeof fe!="number"&&typeof fe!="string")return Z.error("Branch labels must be numbers or strings.");if(typeof fe=="number"&&Math.abs(fe)>Number.MAX_SAFE_INTEGER)return Z.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof fe=="number"&&Math.floor(fe)!==fe)return Z.error("Numeric branch labels must be integer values.");if(r){if(Z.checkSubtype(r,Ba(fe)))return null}else r=Ba(fe);if(v[String(fe)]!==void 0)return Z.error("Branch labels must be unique.");v[String(fe)]=g.length}var xe=t.parse(D,x,f);if(!xe)return null;f=f||xe.type,g.push(xe)}var Ve=t.parse(e[1],1,tr);if(!Ve)return null;var We=t.parse(e[e.length-1],e.length-1,f);return We?Ve.type.kind!=="value"&&t.concat(1).checkSubtype(r,Ve.type)?null:new Ii(r,f,Ve,v,g,We):null},Ii.prototype.evaluate=function(e){var t=this.input.evaluate(e);return(Ba(t)===this.inputType&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)},Ii.prototype.eachChild=function(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)},Ii.prototype.outputDefined=function(){return this.outputs.every(function(e){return e.outputDefined()})&&this.otherwise.outputDefined()},Ii.prototype.serialize=function(){for(var e=this,t=["match",this.input.serialize()],r=[],f={},v=0,g=Object.keys(this.cases).sort();v<g.length;v+=1){var x=g[v];(te=f[this.cases[x]])===void 0?(f[this.cases[x]]=r.length,r.push([this.cases[x],[x]])):r[te][1].push(x)}for(var P=function(xe){return e.inputType.kind==="number"?Number(xe):xe},D=0,Z=r;D<Z.length;D+=1){var W=Z[D],te=W[0],fe=W[1];t.push(fe.length===1?P(fe[0]):fe.map(P)),t.push(this.outputs[outputIndex$1].serialize())}return t.push(this.otherwise.serialize()),t};var bi=function(e,t,r){this.type=e,this.branches=t,this.otherwise=r};bi.parse=function(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only "+(e.length-1)+".");if(e.length%2!=0)return t.error("Expected an odd number of arguments.");var r;t.expectedType&&t.expectedType.kind!=="value"&&(r=t.expectedType);for(var f=[],v=1;v<e.length-1;v+=2){var g=t.parse(e[v],v,et);if(!g)return null;var x=t.parse(e[v+1],v+1,r);if(!x)return null;f.push([g,x]),r=r||x.type}var P=t.parse(e[e.length-1],e.length-1,r);return P?new bi(r,f,P):null},bi.prototype.evaluate=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];if(f[0].evaluate(e))return v.evaluate(e)}return this.otherwise.evaluate(e)},bi.prototype.eachChild=function(e){for(var t=0,r=this.branches;t<r.length;t+=1){var f=r[t],v=f[1];e(f[0]),e(v)}e(this.otherwise)},bi.prototype.outputDefined=function(){return this.branches.every(function(e){return e[1].outputDefined()})&&this.otherwise.outputDefined()},bi.prototype.serialize=function(){var e=["case"];return this.eachChild(function(t){e.push(t.serialize())}),e};var pa=function(e,t,r,f){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=f};function Pa(e,t){return e==="=="||e==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function za(e,t,r,f){return f.compare(t,r)===0}function Ti(e,t,r){var f=e!=="=="&&e!=="!=";return function(){function v(g,x,P){this.type=et,this.lhs=g,this.rhs=x,this.collator=P,this.hasUntypedArgument=g.type.kind==="value"||x.type.kind==="value"}return v.parse=function(g,x){if(g.length!==3&&g.length!==4)return x.error("Expected two or three arguments.");var P=g[0],D=x.parse(g[1],1,tr);if(!D)return null;if(!Pa(P,D.type))return x.concat(1).error('"'+P+`" comparisons are not supported for type '`+Wi(D.type)+"'.");var Z=x.parse(g[2],2,tr);if(!Z)return null;if(!Pa(P,Z.type))return x.concat(2).error('"'+P+`" comparisons are not supported for type '`+Wi(Z.type)+"'.");if(D.type.kind!==Z.type.kind&&D.type.kind!=="value"&&Z.type.kind!=="value")return x.error("Cannot compare types '"+Wi(D.type)+"' and '"+Wi(Z.type)+"'.");f&&(D.type.kind==="value"&&Z.type.kind!=="value"?D=new xa(Z.type,[D]):D.type.kind!=="value"&&Z.type.kind==="value"&&(Z=new xa(D.type,[Z])));var W=null;if(g.length===4){if(D.type.kind!=="string"&&Z.type.kind!=="string"&&D.type.kind!=="value"&&Z.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(!(W=x.parse(g[3],3,Ni)))return null}return new v(D,Z,W)},v.prototype.evaluate=function(g){var x=this.lhs.evaluate(g),P=this.rhs.evaluate(g);if(f&&this.hasUntypedArgument){var D=Ba(x),Z=Ba(P);if(D.kind!==Z.kind||D.kind!=="string"&&D.kind!=="number")throw new ro('Expected arguments for "'+e+'" to be (string, string) or (number, number), but found ('+D.kind+", "+Z.kind+") instead.")}if(this.collator&&!f&&this.hasUntypedArgument){var W=Ba(x),te=Ba(P);if(W.kind!=="string"||te.kind!=="string")return t(g,x,P)}return this.collator?r(g,x,P,this.collator.evaluate(g)):t(g,x,P)},v.prototype.eachChild=function(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)},v.prototype.outputDefined=function(){return!0},v.prototype.serialize=function(){var g=[e];return this.eachChild(function(x){g.push(x.serialize())}),g},v}()}pa.parse=function(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1,tr),f=t.parse(e[2],2,ft);if(!r||!f)return null;if(!La(r.type,[Fi(tr),vr,tr]))return t.error("Expected first argument to be of type array or string, but found "+Wi(r.type)+" instead");if(e.length===4){var v=t.parse(e[3],3,ft);return v?new pa(r.type,r,f,v):null}return new pa(r.type,r,f)},pa.prototype.evaluate=function(e){var t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!_i(t,["string","array"]))throw new ro("Expected first argument to be of type array or string, but found "+Wi(Ba(t))+" instead.");if(this.endIndex){var f=this.endIndex.evaluate(e);return t.slice(r,f)}return t.slice(r)},pa.prototype.eachChild=function(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)},pa.prototype.outputDefined=function(){return!1},pa.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var _s=Ti("==",function(e,t,r){return t===r},za),iu=Ti("!=",function(e,t,r){return t!==r},function(e,t,r,f){return!za(0,t,r,f)}),Bu=Ti("<",function(e,t,r){return t<r},function(e,t,r,f){return f.compare(t,r)<0}),tc=Ti(">",function(e,t,r){return t>r},function(e,t,r,f){return f.compare(t,r)>0}),Yu=Ti("<=",function(e,t,r){return t<=r},function(e,t,r,f){return f.compare(t,r)<=0}),rc=Ti(">=",function(e,t,r){return t>=r},function(e,t,r,f){return f.compare(t,r)>=0}),mu=function(e,t,r,f,v){this.type=vr,this.number=e,this.locale=t,this.currency=r,this.minFractionDigits=f,this.maxFractionDigits=v};mu.parse=function(e,t){if(e.length!==3)return t.error("Expected two arguments.");var r=t.parse(e[1],1,ft);if(!r)return null;var f=e[2];if(typeof f!="object"||Array.isArray(f))return t.error("NumberFormat options argument must be an object.");var v=null;if(f.locale&&!(v=t.parse(f.locale,1,vr)))return null;var g=null;if(f.currency&&!(g=t.parse(f.currency,1,vr)))return null;var x=null;if(f["min-fraction-digits"]&&!(x=t.parse(f["min-fraction-digits"],1,ft)))return null;var P=null;return f["max-fraction-digits"]&&!(P=t.parse(f["max-fraction-digits"],1,ft))?null:new mu(r,v,g,x,P)},mu.prototype.evaluate=function(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))},mu.prototype.eachChild=function(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)},mu.prototype.outputDefined=function(){return!1},mu.prototype.serialize=function(){var e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]};var gu=function(e){this.type=ft,this.input=e};gu.parse=function(e,t){if(e.length!==2)return t.error("Expected 1 argument, but found "+(e.length-1)+" instead.");var r=t.parse(e[1],1);return r?r.type.kind!=="array"&&r.type.kind!=="string"&&r.type.kind!=="value"?t.error("Expected argument of type string or array, but found "+Wi(r.type)+" instead."):new gu(r):null},gu.prototype.evaluate=function(e){var t=this.input.evaluate(e);if(typeof t=="string"||Array.isArray(t))return t.length;throw new ro("Expected value to be of type string or array, but found "+Wi(Ba(t))+" instead.")},gu.prototype.eachChild=function(e){e(this.input)},gu.prototype.outputDefined=function(){return!1},gu.prototype.serialize=function(){var e=["length"];return this.eachChild(function(t){e.push(t.serialize())}),e};var Tu={"==":_s,"!=":iu,">":tc,"<":Bu,">=":rc,"<=":Yu,array:xa,at:Fr,boolean:xa,case:bi,coalesce:Ft,collator:ss,format:Lo,image:No,in:Kr,"index-of":ni,interpolate:Oe,"interpolate-hcl":Oe,"interpolate-lab":Oe,length:gu,let:Ut,literal:Yi,match:Ii,number:xa,"number-format":mu,object:xa,slice:pa,step:Is,string:xa,"to-boolean":_o,"to-color":_o,"to-number":_o,"to-string":_o,var:Ho,within:Go};function xo(e,t){var r=t[0],f=t[1],v=t[2],g=t[3];r=r.evaluate(e),f=f.evaluate(e),v=v.evaluate(e);var x=g?g.evaluate(e):1,P=du(r,f,v,x);if(P)throw new ro(P);return new Ji(r/255*x,f/255*x,v/255*x,x)}function nc(e,t){return e in t}function yc(e,t){var r=t[e];return r===void 0?null:r}function cs(e){return{type:e}}function ic(e){return{result:"success",value:e}}function Xs(e){return{result:"error",value:e}}function sa(e){return e["property-type"]==="data-driven"||e["property-type"]==="cross-faded-data-driven"}function _c(e){return!!e.expression&&e.expression.parameters.indexOf("zoom")>-1}function al(e){return!!e.expression&&e.expression.interpolated}function Ga(e){return e instanceof Number?"number":e instanceof String?"string":e instanceof Boolean?"boolean":Array.isArray(e)?"array":e===null?"null":typeof e}function _l(e){return typeof e=="object"&&e!==null&&!Array.isArray(e)}function Nu(e){return e}function yu(e,t,r){return e!==void 0?e:t!==void 0?t:r!==void 0?r:void 0}function _u(e,t,r,f,v){return yu(typeof r===v?f[r]:void 0,e.default,t.default)}function au(e,t,r){if(Ga(r)!=="number")return yu(e.default,t.default);var f=e.stops.length;if(f===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[f-1][0])return e.stops[f-1][1];var v=ru(e.stops.map(function(g){return g[0]}),r);return e.stops[v][1]}function xl(e,t,r){var f=e.base!==void 0?e.base:1;if(Ga(r)!=="number")return yu(e.default,t.default);var v=e.stops.length;if(v===1||r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[v-1][0])return e.stops[v-1][1];var g=ru(e.stops.map(function(te){return te[0]}),r),x=function(te,fe,xe,Ve){var We=Ve-xe,yt=te-xe;return We===0?0:fe===1?yt/We:(Math.pow(fe,yt)-1)/(Math.pow(fe,We)-1)}(r,f,e.stops[g][0],e.stops[g+1][0]),P=e.stops[g][1],D=e.stops[g+1][1],Z=Ro[t.type]||Nu;if(e.colorSpace&&e.colorSpace!=="rgb"){var W=le[e.colorSpace];Z=function(te,fe){return W.reverse(W.interpolate(W.forward(te),W.forward(fe),x))}}return typeof P.evaluate=="function"?{evaluate:function(){for(var te=[],fe=arguments.length;fe--;)te[fe]=arguments[fe];var xe=P.evaluate.apply(void 0,te),Ve=D.evaluate.apply(void 0,te);if(xe!==void 0&&Ve!==void 0)return Z(xe,Ve,x)}}:Z(P,D,x)}function xu(e,t,r){return t.type==="color"?r=Ji.parse(r):t.type==="formatted"?r=ja.fromString(r.toString()):t.type==="resolvedImage"?r=Xi.fromString(r.toString()):Ga(r)===t.type||t.type==="enum"&&t.values[r]||(r=void 0),yu(r,e.default,t.default)}uo.register(Tu,{error:[{kind:"error"},[vr],function(e,t){throw new ro(t[0].evaluate(e))}],typeof:[vr,[tr],function(e,t){return Wi(Ba(t[0].evaluate(e)))}],"to-rgba":[Fi(ft,4),[Dr],function(e,t){return t[0].evaluate(e).toArray()}],rgb:[Dr,[ft,ft,ft],xo],rgba:[Dr,[ft,ft,ft,ft],xo],has:{type:et,overloads:[[[vr],function(e,t){return nc(t[0].evaluate(e),e.properties())}],[[vr,In],function(e,t){var r=t[1];return nc(t[0].evaluate(e),r.evaluate(e))}]]},get:{type:tr,overloads:[[[vr],function(e,t){return yc(t[0].evaluate(e),e.properties())}],[[vr,In],function(e,t){var r=t[1];return yc(t[0].evaluate(e),r.evaluate(e))}]]},"feature-state":[tr,[vr],function(e,t){return yc(t[0].evaluate(e),e.featureState||{})}],properties:[In,[],function(e){return e.properties()}],"geometry-type":[vr,[],function(e){return e.geometryType()}],id:[tr,[],function(e){return e.id()}],zoom:[ft,[],function(e){return e.globals.zoom}],"heatmap-density":[ft,[],function(e){return e.globals.heatmapDensity||0}],"line-progress":[ft,[],function(e){return e.globals.lineProgress||0}],accumulated:[tr,[],function(e){return e.globals.accumulated===void 0?null:e.globals.accumulated}],"+":[ft,cs(ft),function(e,t){for(var r=0,f=0,v=t;f<v.length;f+=1)r+=v[f].evaluate(e);return r}],"*":[ft,cs(ft),function(e,t){for(var r=1,f=0,v=t;f<v.length;f+=1)r*=v[f].evaluate(e);return r}],"-":{type:ft,overloads:[[[ft,ft],function(e,t){var r=t[1];return t[0].evaluate(e)-r.evaluate(e)}],[[ft],function(e,t){return-t[0].evaluate(e)}]]},"/":[ft,[ft,ft],function(e,t){var r=t[1];return t[0].evaluate(e)/r.evaluate(e)}],"%":[ft,[ft,ft],function(e,t){var r=t[1];return t[0].evaluate(e)%r.evaluate(e)}],ln2:[ft,[],function(){return Math.LN2}],pi:[ft,[],function(){return Math.PI}],e:[ft,[],function(){return Math.E}],"^":[ft,[ft,ft],function(e,t){var r=t[1];return Math.pow(t[0].evaluate(e),r.evaluate(e))}],sqrt:[ft,[ft],function(e,t){return Math.sqrt(t[0].evaluate(e))}],log10:[ft,[ft],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN10}],ln:[ft,[ft],function(e,t){return Math.log(t[0].evaluate(e))}],log2:[ft,[ft],function(e,t){return Math.log(t[0].evaluate(e))/Math.LN2}],sin:[ft,[ft],function(e,t){return Math.sin(t[0].evaluate(e))}],cos:[ft,[ft],function(e,t){return Math.cos(t[0].evaluate(e))}],tan:[ft,[ft],function(e,t){return Math.tan(t[0].evaluate(e))}],asin:[ft,[ft],function(e,t){return Math.asin(t[0].evaluate(e))}],acos:[ft,[ft],function(e,t){return Math.acos(t[0].evaluate(e))}],atan:[ft,[ft],function(e,t){return Math.atan(t[0].evaluate(e))}],min:[ft,cs(ft),function(e,t){return Math.min.apply(Math,t.map(function(r){return r.evaluate(e)}))}],max:[ft,cs(ft),function(e,t){return Math.max.apply(Math,t.map(function(r){return r.evaluate(e)}))}],abs:[ft,[ft],function(e,t){return Math.abs(t[0].evaluate(e))}],round:[ft,[ft],function(e,t){var r=t[0].evaluate(e);return r<0?-Math.round(-r):Math.round(r)}],floor:[ft,[ft],function(e,t){return Math.floor(t[0].evaluate(e))}],ceil:[ft,[ft],function(e,t){return Math.ceil(t[0].evaluate(e))}],"filter-==":[et,[vr,tr],function(e,t){var r=t[0],f=t[1];return e.properties()[r.value]===f.value}],"filter-id-==":[et,[tr],function(e,t){var r=t[0];return e.id()===r.value}],"filter-type-==":[et,[vr],function(e,t){var r=t[0];return e.geometryType()===r.value}],"filter-<":[et,[vr,tr],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<g}],"filter-id-<":[et,[tr],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<v}],"filter->":[et,[vr,tr],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>g}],"filter-id->":[et,[tr],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>v}],"filter-<=":[et,[vr,tr],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v<=g}],"filter-id-<=":[et,[tr],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f<=v}],"filter->=":[et,[vr,tr],function(e,t){var r=t[0],f=t[1],v=e.properties()[r.value],g=f.value;return typeof v==typeof g&&v>=g}],"filter-id->=":[et,[tr],function(e,t){var r=t[0],f=e.id(),v=r.value;return typeof f==typeof v&&f>=v}],"filter-has":[et,[tr],function(e,t){return t[0].value in e.properties()}],"filter-has-id":[et,[],function(e){return e.id()!==null&&e.id()!==void 0}],"filter-type-in":[et,[Fi(vr)],function(e,t){return t[0].value.indexOf(e.geometryType())>=0}],"filter-id-in":[et,[Fi(tr)],function(e,t){return t[0].value.indexOf(e.id())>=0}],"filter-in-small":[et,[vr,Fi(tr)],function(e,t){var r=t[0];return t[1].value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[et,[vr,Fi(tr)],function(e,t){var r=t[0],f=t[1];return function(v,g,x,P){for(;x<=P;){var D=x+P>>1;if(g[D]===v)return!0;g[D]>v?P=D-1:x=D+1}return!1}(e.properties()[r.value],f.value,0,f.value.length-1)}],all:{type:et,overloads:[[[et,et],function(e,t){var r=t[1];return t[0].evaluate(e)&&r.evaluate(e)}],[cs(et),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(!f[r].evaluate(e))return!1;return!0}]]},any:{type:et,overloads:[[[et,et],function(e,t){var r=t[1];return t[0].evaluate(e)||r.evaluate(e)}],[cs(et),function(e,t){for(var r=0,f=t;r<f.length;r+=1)if(f[r].evaluate(e))return!0;return!1}]]},"!":[et,[et],function(e,t){return!t[0].evaluate(e)}],"is-supported-script":[et,[vr],function(e,t){var r=e.globals&&e.globals.isSupportedScript;return!r||r(t[0].evaluate(e))}],upcase:[vr,[vr],function(e,t){return t[0].evaluate(e).toUpperCase()}],downcase:[vr,[vr],function(e,t){return t[0].evaluate(e).toLowerCase()}],concat:[vr,cs(tr),function(e,t){return t.map(function(r){return Vo(r.evaluate(e))}).join("")}],"resolved-locale":[vr,[Ni],function(e,t){return t[0].evaluate(e).resolvedLocale()}]});var Ys=function(e,t){this.expression=e,this._warningHistory={},this._evaluator=new Va,this._defaultValue=t?function(r){return r.type==="color"&&_l(r.default)?new Ji(0,0,0,0):r.type==="color"?Ji.parse(r.default)||null:r.default===void 0?null:r.default}(t):null,this._enumValues=t&&t.type==="enum"?t.values:null};function Pu(e){return Array.isArray(e)&&e.length>0&&typeof e[0]=="string"&&e[0]in Tu}function Os(e,t){var r=new Ws(Tu,[],t?function(v){var g={color:Dr,string:vr,number:ft,enum:vr,boolean:et,formatted:ia,resolvedImage:hi};return v.type==="array"?Fi(g[v.value]||tr,v.length):g[v.type]}(t):void 0),f=r.parse(e,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return f?ic(new Ys(f,t)):Xs(r.errors)}Ys.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g,this.expression.evaluate(this._evaluator)},Ys.prototype.evaluate=function(e,t,r,f,v,g){this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=f,this._evaluator.availableImages=v||null,this._evaluator.formattedSection=g||null;try{var x=this.expression.evaluate(this._evaluator);if(x==null||typeof x=="number"&&x!=x)return this._defaultValue;if(this._enumValues&&!(x in this._enumValues))throw new ro("Expected value to be one of "+Object.keys(this._enumValues).map(function(P){return JSON.stringify(P)}).join(", ")+", but found "+JSON.stringify(x)+" instead.");return x}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console!="undefined"&&console.warn(P.message)),this._defaultValue}};var ou=function(e,t){this.kind=e,this._styleExpression=t,this.isStateDependent=e!=="constant"&&!ls(t.expression)};ou.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},ou.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)};var wo=function(e,t,r,f){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent=e!=="camera"&&!ls(t.expression),this.interpolationType=f};function Ls(e,t){if((e=Os(e,t)).result==="error")return e;var r=e.value.expression,f=qo(r);if(!f&&!sa(t))return Xs([new Zr("","data expressions not supported")]);var v=ys(r,["zoom"]);if(!v&&!_c(t))return Xs([new Zr("","zoom expressions not supported")]);var g=function x(P){var D=null;if(P instanceof Ut)D=x(P.result);else if(P instanceof Ft)for(var Z=0,W=P.args;Z<W.length&&!(D=x(W[Z]));Z+=1);else(P instanceof Is||P instanceof Oe)&&P.input instanceof uo&&P.input.name==="zoom"&&(D=P);return D instanceof Zr||P.eachChild(function(te){var fe=x(te);fe instanceof Zr?D=fe:!D&&fe?D=new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):D&&fe&&D!==fe&&(D=new Zr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),D}(r);return g||v?g instanceof Zr?Xs([g]):g instanceof Oe&&!al(t)?Xs([new Zr("",'"interpolate" expressions cannot be used with this property')]):ic(g?new wo(f?"camera":"composite",e.value,g.labels,g instanceof Oe?g.interpolation:void 0):new ou(f?"constant":"source",e.value)):Xs([new Zr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}wo.prototype.evaluateWithoutErrorHandling=function(e,t,r,f,v,g){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,f,v,g)},wo.prototype.evaluate=function(e,t,r,f,v,g){return this._styleExpression.evaluate(e,t,r,f,v,g)},wo.prototype.interpolationFactor=function(e,t,r){return this.interpolationType?Oe.interpolationFactor(this.interpolationType,e,t,r):0};var xs=function(e,t){this._parameters=e,this._specification=t,Sr(this,function r(f,v){var g,x,P,D=v.type==="color",Z=f.stops&&typeof f.stops[0][0]=="object",W=Z||!(Z||f.property!==void 0),te=f.type||(al(v)?"exponential":"interval");if(D&&((f=Sr({},f)).stops&&(f.stops=f.stops.map(function(Zn){return[Zn[0],Ji.parse(Zn[1])]})),f.default=Ji.parse(f.default?f.default:v.default)),f.colorSpace&&f.colorSpace!=="rgb"&&!le[f.colorSpace])throw new Error("Unknown color space: "+f.colorSpace);if(te==="exponential")g=xl;else if(te==="interval")g=au;else if(te==="categorical"){g=_u,x=Object.create(null);for(var fe=0,xe=f.stops;fe<xe.length;fe+=1){var Ve=xe[fe];x[Ve[0]]=Ve[1]}P=typeof f.stops[0][0]}else{if(te!=="identity")throw new Error('Unknown function type "'+te+'"');g=xu}if(Z){for(var We={},yt=[],rt=0;rt<f.stops.length;rt++){var Pt=f.stops[rt],Xt=Pt[0].zoom;We[Xt]===void 0&&(We[Xt]={zoom:Xt,type:f.type,property:f.property,default:f.default,stops:[]},yt.push(Xt)),We[Xt].stops.push([Pt[0].value,Pt[1]])}for(var hr=[],yr=0,Nr=yt;yr<Nr.length;yr+=1){var ln=Nr[yr];hr.push([We[ln].zoom,r(We[ln],v)])}var Sn={name:"linear"};return{kind:"composite",interpolationType:Sn,interpolationFactor:Oe.interpolationFactor.bind(void 0,Sn),zoomStops:hr.map(function(Zn){return Zn[0]}),evaluate:function(Zn,di){var Gn=Zn.zoom;return xl({stops:hr,base:f.base},v,Gn).evaluate(Gn,di)}}}if(W){var fi=te==="exponential"?{name:"exponential",base:f.base!==void 0?f.base:1}:null;return{kind:"camera",interpolationType:fi,interpolationFactor:Oe.interpolationFactor.bind(void 0,fi),zoomStops:f.stops.map(function(Zn){return Zn[0]}),evaluate:function(Zn){return g(f,v,Zn.zoom,x,P)}}}return{kind:"source",evaluate:function(Zn,di){var Gn=di&&di.properties?di.properties[f.property]:void 0;return Gn===void 0?yu(f.default,v.default):g(f,v,Gn,x,P)}}}(this._parameters,this._specification))};function Rs(e){var t=e.key,r=e.value,f=e.valueSpec||{},v=e.objectElementValidators||{},g=e.style,x=e.styleSpec,P=[],D=Ga(r);if(D!=="object")return[new Ee(t,r,"object expected, "+D+" found")];for(var Z in r){var W=Z.split(".")[0],te=f[W]||f["*"],fe=void 0;if(v[W])fe=v[W];else if(f[W])fe=ua;else if(v["*"])fe=v["*"];else{if(!f["*"]){P.push(new Ee(t,r[Z],'unknown property "'+Z+'"'));continue}fe=ua}P=P.concat(fe({key:(t&&t+".")+Z,value:r[Z],valueSpec:te,style:g,styleSpec:x,object:r,objectKey:Z},r))}for(var xe in f)v[xe]||f[xe].required&&f[xe].default===void 0&&r[xe]===void 0&&P.push(new Ee(t,r,'missing required property "'+xe+'"'));return P}function xc(e){var t=e.value,r=e.valueSpec,f=e.style,v=e.styleSpec,g=e.key,x=e.arrayElementValidator||ua;if(Ga(t)!=="array")return[new Ee(g,t,"array expected, "+Ga(t)+" found")];if(r.length&&t.length!==r.length)return[new Ee(g,t,"array length "+r.length+" expected, length "+t.length+" found")];if(r["min-length"]&&t.length<r["min-length"])return[new Ee(g,t,"array length at least "+r["min-length"]+" expected, length "+t.length+" found")];var P={type:r.value,values:r.values};v.$version<7&&(P.function=r.function),Ga(r.value)==="object"&&(P=r.value);for(var D=[],Z=0;Z<t.length;Z++)D=D.concat(x({array:t,arrayIndex:Z,value:t[Z],valueSpec:P,style:f,styleSpec:v,key:g+"["+Z+"]"}));return D}function ac(e){var t=e.key,r=e.value,f=e.valueSpec,v=Ga(r);return v==="number"&&r!=r&&(v="NaN"),v!=="number"?[new Ee(t,r,"number expected, "+v+" found")]:"minimum"in f&&r<f.minimum?[new Ee(t,r,r+" is less than the minimum value "+f.minimum)]:"maximum"in f&&r>f.maximum?[new Ee(t,r,r+" is greater than the maximum value "+f.maximum)]:[]}function oc(e){var t,r,f,v=e.valueSpec,g=Wt(e.value.type),x={},P=g!=="categorical"&&e.value.property===void 0,D=!P,Z=Ga(e.value.stops)==="array"&&Ga(e.value.stops[0])==="array"&&Ga(e.value.stops[0][0])==="object",W=Rs({key:e.key,value:e.value,valueSpec:e.styleSpec.function,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{stops:function(xe){if(g==="identity")return[new Ee(xe.key,xe.value,'identity function may not have a "stops" property')];var Ve=[],We=xe.value;return Ve=Ve.concat(xc({key:xe.key,value:We,valueSpec:xe.valueSpec,style:xe.style,styleSpec:xe.styleSpec,arrayElementValidator:te})),Ga(We)==="array"&&We.length===0&&Ve.push(new Ee(xe.key,We,"array must have at least one stop")),Ve},default:function(xe){return ua({key:xe.key,value:xe.value,valueSpec:v,style:xe.style,styleSpec:xe.styleSpec})}}});return g==="identity"&&P&&W.push(new Ee(e.key,e.value,'missing required property "property"')),g==="identity"||e.value.stops||W.push(new Ee(e.key,e.value,'missing required property "stops"')),g==="exponential"&&e.valueSpec.expression&&!al(e.valueSpec)&&W.push(new Ee(e.key,e.value,"exponential functions not supported")),e.styleSpec.$version>=8&&(D&&!sa(e.valueSpec)?W.push(new Ee(e.key,e.value,"property functions not supported")):P&&!_c(e.valueSpec)&&W.push(new Ee(e.key,e.value,"zoom functions not supported"))),g!=="categorical"&&!Z||e.value.property!==void 0||W.push(new Ee(e.key,e.value,'"property" property is required')),W;function te(xe){var Ve=[],We=xe.value,yt=xe.key;if(Ga(We)!=="array")return[new Ee(yt,We,"array expected, "+Ga(We)+" found")];if(We.length!==2)return[new Ee(yt,We,"array length 2 expected, length "+We.length+" found")];if(Z){if(Ga(We[0])!=="object")return[new Ee(yt,We,"object expected, "+Ga(We[0])+" found")];if(We[0].zoom===void 0)return[new Ee(yt,We,"object stop key must have zoom")];if(We[0].value===void 0)return[new Ee(yt,We,"object stop key must have value")];if(f&&f>Wt(We[0].zoom))return[new Ee(yt,We[0].zoom,"stop zoom values must appear in ascending order")];Wt(We[0].zoom)!==f&&(f=Wt(We[0].zoom),r=void 0,x={}),Ve=Ve.concat(Rs({key:yt+"[0]",value:We[0],valueSpec:{zoom:{}},style:xe.style,styleSpec:xe.styleSpec,objectElementValidators:{zoom:ac,value:fe}}))}else Ve=Ve.concat(fe({key:yt+"[0]",value:We[0],valueSpec:{},style:xe.style,styleSpec:xe.styleSpec},We));return Pu(Ke(We[1]))?Ve.concat([new Ee(yt+"[1]",We[1],"expressions are not allowed in function stops.")]):Ve.concat(ua({key:yt+"[1]",value:We[1],valueSpec:v,style:xe.style,styleSpec:xe.styleSpec}))}function fe(xe,Ve){var We=Ga(xe.value),yt=Wt(xe.value),rt=xe.value!==null?xe.value:Ve;if(t){if(We!==t)return[new Ee(xe.key,rt,We+" stop domain type must match previous stop domain type "+t)]}else t=We;if(We!=="number"&&We!=="string"&&We!=="boolean")return[new Ee(xe.key,rt,"stop domain value must be a number, string, or boolean")];if(We!=="number"&&g!=="categorical"){var Pt="number expected, "+We+" found";return sa(v)&&g===void 0&&(Pt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(xe.key,rt,Pt)]}return g!=="categorical"||We!=="number"||isFinite(yt)&&Math.floor(yt)===yt?g!=="categorical"&&We==="number"&&r!==void 0&&yt<r?[new Ee(xe.key,rt,"stop domain values must appear in ascending order")]:(r=yt,g==="categorical"&&yt in x?[new Ee(xe.key,rt,"stop domain values must be unique")]:(x[yt]=!0,[])):[new Ee(xe.key,rt,"integer expected, found "+yt)]}}function ol(e){var t=(e.expressionContext==="property"?Ls:Os)(Ke(e.value),e.valueSpec);if(t.result==="error")return t.value.map(function(f){return new Ee(""+e.key+f.key,e.value,f.message)});var r=t.value.expression||t.value._styleExpression.expression;if(e.expressionContext==="property"&&e.propertyKey==="text-font"&&!r.outputDefined())return[new Ee(e.key,e.value,'Invalid data expression for "'+e.propertyKey+'". Output values must be contained as literals within the expression.')];if(e.expressionContext==="property"&&e.propertyType==="layout"&&!ls(r))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with layout properties.')];if(e.expressionContext==="filter"&&!ls(r))return[new Ee(e.key,e.value,'"feature-state" data expressions are not supported with filters.')];if(e.expressionContext&&e.expressionContext.indexOf("cluster")===0){if(!ys(r,["zoom","feature-state"]))return[new Ee(e.key,e.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(e.expressionContext==="cluster-initial"&&!qo(r))return[new Ee(e.key,e.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Dl(e){var t=e.key,r=e.value,f=e.valueSpec,v=[];return Array.isArray(f.values)?f.values.indexOf(Wt(r))===-1&&v.push(new Ee(t,r,"expected one of ["+f.values.join(", ")+"], "+JSON.stringify(r)+" found")):Object.keys(f.values).indexOf(Wt(r))===-1&&v.push(new Ee(t,r,"expected one of ["+Object.keys(f.values).join(", ")+"], "+JSON.stringify(r)+" found")),v}function kl(e){if(e===!0||e===!1)return!0;if(!Array.isArray(e)||e.length===0)return!1;switch(e[0]){case"has":return e.length>=2&&e[1]!=="$id"&&e[1]!=="$type";case"in":return e.length>=3&&(typeof e[1]!="string"||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return e.length!==3||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(var t=0,r=e.slice(1);t<r.length;t+=1){var f=r[t];if(!kl(f)&&typeof f!="boolean")return!1}return!0;default:return!0}}xs.deserialize=function(e){return new xs(e._parameters,e._specification)},xs.serialize=function(e){return{_parameters:e._parameters,_specification:e._specification}};var sc={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function uc(e){if(e==null)return{filter:function(){return!0},needGeometry:!1};kl(e)||(e=Fl(e));var t=Os(e,sc);if(t.result==="error")throw new Error(t.value.map(function(r){return r.key+": "+r.message}).join(", "));return{filter:function(r,f,v){return t.value.evaluate(r,f,{},v)},needGeometry:function r(f){if(!Array.isArray(f))return!1;if(f[0]==="within")return!0;for(var v=1;v<f.length;v++)if(r(f[v]))return!0;return!1}(e)}}function Qc(e,t){return e<t?-1:e>t?1:0}function Fl(e){if(!e)return!0;var t,r=e[0];return e.length<=1?r!=="any":r==="=="?Ks(e[1],e[2],"=="):r==="!="?Ku(Ks(e[1],e[2],"==")):r==="<"||r===">"||r==="<="||r===">="?Ks(e[1],e[2],r):r==="any"?(t=e.slice(1),["any"].concat(t.map(Fl))):r==="all"?["all"].concat(e.slice(1).map(Fl)):r==="none"?["all"].concat(e.slice(1).map(Fl).map(Ku)):r==="in"?sl(e[1],e.slice(2)):r==="!in"?Ku(sl(e[1],e.slice(2))):r==="has"?zu(e[1]):r==="!has"?Ku(zu(e[1])):r!=="within"||e}function Ks(e,t,r){switch(e){case"$type":return["filter-type-"+r,t];case"$id":return["filter-id-"+r,t];default:return["filter-"+r,e,t]}}function sl(e,t){if(t.length===0)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(function(r){return typeof r!=typeof t[0]})?["filter-in-large",e,["literal",t.sort(Qc)]]:["filter-in-small",e,["literal",t]]}}function zu(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Ku(e){return["!",e]}function bc(e){return kl(Ke(e.value))?ol(Sr({},e,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(r){var f=r.value,v=r.key;if(Ga(f)!=="array")return[new Ee(v,f,"array expected, "+Ga(f)+" found")];var g,x=r.styleSpec,P=[];if(f.length<1)return[new Ee(v,f,"filter array must have at least 1 element")];switch(P=P.concat(Dl({key:v+"[0]",value:f[0],valueSpec:x.filter_operator,style:r.style,styleSpec:r.styleSpec})),Wt(f[0])){case"<":case"<=":case">":case">=":f.length>=2&&Wt(f[1])==="$type"&&P.push(new Ee(v,f,'"$type" cannot be use with operator "'+f[0]+'"'));case"==":case"!=":f.length!==3&&P.push(new Ee(v,f,'filter array for operator "'+f[0]+'" must have 3 elements'));case"in":case"!in":f.length>=2&&(g=Ga(f[1]))!=="string"&&P.push(new Ee(v+"[1]",f[1],"string expected, "+g+" found"));for(var D=2;D<f.length;D++)g=Ga(f[D]),Wt(f[1])==="$type"?P=P.concat(Dl({key:v+"["+D+"]",value:f[D],valueSpec:x.geometry_type,style:r.style,styleSpec:r.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&P.push(new Ee(v+"["+D+"]",f[D],"string, number, or boolean expected, "+g+" found"));break;case"any":case"all":case"none":for(var Z=1;Z<f.length;Z++)P=P.concat(t({key:v+"["+Z+"]",value:f[Z],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":g=Ga(f[1]),f.length!==2?P.push(new Ee(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="string"&&P.push(new Ee(v+"[1]",f[1],"string expected, "+g+" found"));break;case"within":g=Ga(f[1]),f.length!==2?P.push(new Ee(v,f,'filter array for "'+f[0]+'" operator must have 2 elements')):g!=="object"&&P.push(new Ee(v+"[1]",f[1],"object expected, "+g+" found"))}return P}(e)}function lc(e,t){var r=e.key,f=e.style,v=e.styleSpec,g=e.value,x=e.objectKey,P=v[t+"_"+e.layerType];if(!P)return[];var D=x.match(/^(.*)-transition$/);if(t==="paint"&&D&&P[D[1]]&&P[D[1]].transition)return ua({key:r,value:g,valueSpec:v.transition,style:f,styleSpec:v});var Z,W=e.valueSpec||P[x];if(!W)return[new Ee(r,g,'unknown property "'+x+'"')];if(Ga(g)==="string"&&sa(W)&&!W.tokens&&(Z=/^{([^}]+)}$/.exec(g)))return[new Ee(r,g,'"'+x+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(Z[1])+" }`.")];var te=[];return e.layerType==="symbol"&&(x==="text-field"&&f&&!f.glyphs&&te.push(new Ee(r,g,'use of "text-field" requires a style "glyphs" property')),x==="text-font"&&_l(Ke(g))&&Wt(g.type)==="identity"&&te.push(new Ee(r,g,'"text-font" does not support identity functions'))),te.concat(ua({key:e.key,value:g,valueSpec:W,style:f,styleSpec:v,expressionContext:"property",propertyType:t,propertyKey:x}))}function Sc(e){return lc(e,"paint")}function Zu(e){return lc(e,"layout")}function kc(e){var t=[],r=e.value,f=e.key,v=e.style,g=e.styleSpec;r.type||r.ref||t.push(new Ee(f,r,'either "type" or "ref" is required'));var x,P=Wt(r.type),D=Wt(r.ref);if(r.id)for(var Z=Wt(r.id),W=0;W<e.arrayIndex;W++){var te=v.layers[W];Wt(te.id)===Z&&t.push(new Ee(f,r.id,'duplicate layer id "'+r.id+'", previously used at line '+te.id.__line__))}if("ref"in r)["type","source","source-layer","filter","layout"].forEach(function(Ve){Ve in r&&t.push(new Ee(f,r[Ve],'"'+Ve+'" is prohibited for ref layers'))}),v.layers.forEach(function(Ve){Wt(Ve.id)===D&&(x=Ve)}),x?x.ref?t.push(new Ee(f,r.ref,"ref cannot reference another ref layer")):P=Wt(x.type):t.push(new Ee(f,r.ref,'ref layer "'+D+'" not found'));else if(P!=="background")if(r.source){var fe=v.sources&&v.sources[r.source],xe=fe&&Wt(fe.type);fe?xe==="vector"&&P==="raster"?t.push(new Ee(f,r.source,'layer "'+r.id+'" requires a raster source')):xe==="raster"&&P!=="raster"?t.push(new Ee(f,r.source,'layer "'+r.id+'" requires a vector source')):xe!=="vector"||r["source-layer"]?xe==="raster-dem"&&P!=="hillshade"?t.push(new Ee(f,r.source,"raster-dem source can only be used with layer type 'hillshade'.")):P!=="line"||!r.paint||!r.paint["line-gradient"]||xe==="geojson"&&fe.lineMetrics||t.push(new Ee(f,r,'layer "'+r.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):t.push(new Ee(f,r,'layer "'+r.id+'" must specify a "source-layer"')):t.push(new Ee(f,r.source,'source "'+r.source+'" not found'))}else t.push(new Ee(f,r,'missing required property "source"'));return t=t.concat(Rs({key:f,value:r,valueSpec:g.layer,style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return ua({key:f+".type",value:r.type,valueSpec:g.layer.type,style:e.style,styleSpec:e.styleSpec,object:r,objectKey:"type"})},filter:bc,layout:function(Ve){return Rs({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return Zu(Sr({layerType:P},We))}}})},paint:function(Ve){return Rs({layer:r,key:Ve.key,value:Ve.value,style:Ve.style,styleSpec:Ve.styleSpec,objectElementValidators:{"*":function(We){return Sc(Sr({layerType:P},We))}}})}}}))}function ul(e){var t=e.value,r=e.key,f=Ga(t);return f!=="string"?[new Ee(r,t,"string expected, "+f+" found")]:[]}var lo={promoteId:function(e){var t=e.key,r=e.value;if(Ga(r)==="string")return ul({key:t,value:r});var f=[];for(var v in r)f.push.apply(f,ul({key:t+"."+v,value:r[v]}));return f}};function Bl(e){var t=e.value,r=e.key,f=e.styleSpec,v=e.style;if(!t.type)return[new Ee(r,t,'"type" is required')];var g,x=Wt(t.type);switch(x){case"vector":case"raster":case"raster-dem":return Rs({key:r,value:t,valueSpec:f["source_"+x.replace("-","_")],style:e.style,styleSpec:f,objectElementValidators:lo});case"geojson":if(g=Rs({key:r,value:t,valueSpec:f.source_geojson,style:v,styleSpec:f,objectElementValidators:lo}),t.cluster)for(var P in t.clusterProperties){var D=t.clusterProperties[P],Z=D[0],W=typeof Z=="string"?[Z,["accumulated"],["get",P]]:Z;g.push.apply(g,ol({key:r+"."+P+".map",value:D[1],expressionContext:"cluster-map"})),g.push.apply(g,ol({key:r+"."+P+".reduce",value:W,expressionContext:"cluster-reduce"}))}return g;case"video":return Rs({key:r,value:t,valueSpec:f.source_video,style:v,styleSpec:f});case"image":return Rs({key:r,value:t,valueSpec:f.source_image,style:v,styleSpec:f});case"canvas":return[new Ee(r,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Dl({key:r+".type",value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:v,styleSpec:f})}}function ll(e){var t=e.value,r=e.styleSpec,f=r.light,v=e.style,g=[],x=Ga(t);if(t===void 0)return g;if(x!=="object")return g.concat([new Ee("light",t,"object expected, "+x+" found")]);for(var P in t){var D=P.match(/^(.*)-transition$/);g=g.concat(D&&f[D[1]]&&f[D[1]].transition?ua({key:P,value:t[P],valueSpec:r.transition,style:v,styleSpec:r}):f[P]?ua({key:P,value:t[P],valueSpec:f[P],style:v,styleSpec:r}):[new Ee(P,t[P],'unknown property "'+P+'"')])}return g}var Ds={"*":function(){return[]},array:xc,boolean:function(e){var t=e.value,r=e.key,f=Ga(t);return f!=="boolean"?[new Ee(r,t,"boolean expected, "+f+" found")]:[]},number:ac,color:function(e){var t=e.key,r=e.value,f=Ga(r);return f!=="string"?[new Ee(t,r,"color expected, "+f+" found")]:Mi(r)===null?[new Ee(t,r,'color expected, "'+r+'" found')]:[]},constants:mt,enum:Dl,filter:bc,function:oc,layer:kc,object:Rs,source:Bl,light:ll,string:ul,formatted:function(e){return ul(e).length===0?[]:ol(e)},resolvedImage:function(e){return ul(e).length===0?[]:ol(e)}};function ua(e){var t=e.value,r=e.valueSpec,f=e.styleSpec;return r.expression&&_l(Wt(t))?oc(e):r.expression&&Pu(Ke(t))?ol(e):r.type&&Ds[r.type]?Ds[r.type](e):Rs(Sr({},e,{valueSpec:r.type?f[r.type]:r}))}function Ha(e){var t=e.value,r=e.key,f=ul(e);return f.length||(t.indexOf("{fontstack}")===-1&&f.push(new Ee(r,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&f.push(new Ee(r,t,'"glyphs" url must include a "{range}" token'))),f}function fs(e,t){t===void 0&&(t=ae);var r=[];return r=r.concat(ua({key:"",value:e,valueSpec:t.$root,styleSpec:t,style:e,objectElementValidators:{glyphs:Ha,"*":function(){return[]}}})),e.constants&&(r=r.concat(mt({key:"constants",value:e.constants,style:e,styleSpec:t}))),bl(r)}function bl(e){return[].concat(e).sort(function(t,r){return t.line-r.line})}function $u(e){return function(){for(var t=[],r=arguments.length;r--;)t[r]=arguments[r];return bl(e.apply(this,t))}}fs.source=$u(Bl),fs.light=$u(ll),fs.layer=$u(kc),fs.filter=$u(bc),fs.paintProperty=$u(Sc),fs.layoutProperty=$u(Zu);var Nl=fs,Fc=Nl.light,gf=Nl.paintProperty,Ju=Nl.layoutProperty;function bo(e,t){var r=!1;if(t&&t.length)for(var f=0,v=t;f<v.length;f+=1)e.fire(new he(new Error(v[f].message))),r=!0;return r}var Qa=Do;function Do(e,t,r){var f=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;var v=new Int32Array(this.arrayBuffer);e=v[0],this.d=(t=v[1])+2*(r=v[2]);for(var g=0;g<this.d*this.d;g++){var x=v[3+g],P=v[3+g+1];f.push(x===P?null:v.subarray(x,P))}var D=v[3+f.length+1];this.keys=v.subarray(v[3+f.length],D),this.bboxes=v.subarray(D),this.insert=this._insertReadonly}else{this.d=t+2*r;for(var Z=0;Z<this.d*this.d;Z++)f.push([]);this.keys=[],this.bboxes=[]}this.n=t,this.extent=e,this.padding=r,this.scale=t/e,this.uid=0;var W=r/t*e;this.min=-W,this.max=e+W}Do.prototype.insert=function(e,t,r,f,v){this._forEachCell(t,r,f,v,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(f),this.bboxes.push(v)},Do.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Do.prototype._insertCell=function(e,t,r,f,v,g){this.cells[v].push(g)},Do.prototype.query=function(e,t,r,f,v){var g=this.min,x=this.max;if(e<=g&&t<=g&&x<=r&&x<=f&&!v)return Array.prototype.slice.call(this.keys);var P=[];return this._forEachCell(e,t,r,f,this._queryCell,P,{},v),P},Do.prototype._queryCell=function(e,t,r,f,v,g,x,P){var D=this.cells[v];if(D!==null)for(var Z=this.keys,W=this.bboxes,te=0;te<D.length;te++){var fe=D[te];if(x[fe]===void 0){var xe=4*fe;(P?P(W[xe+0],W[xe+1],W[xe+2],W[xe+3]):e<=W[xe+2]&&t<=W[xe+3]&&r>=W[xe+0]&&f>=W[xe+1])?(x[fe]=!0,g.push(Z[fe])):x[fe]=!1}}},Do.prototype._forEachCell=function(e,t,r,f,v,g,x,P){for(var D=this._convertToCellCoord(e),Z=this._convertToCellCoord(t),W=this._convertToCellCoord(r),te=this._convertToCellCoord(f),fe=D;fe<=W;fe++)for(var xe=Z;xe<=te;xe++){var Ve=this.d*xe+fe;if((!P||P(this._convertFromCellCoord(fe),this._convertFromCellCoord(xe),this._convertFromCellCoord(fe+1),this._convertFromCellCoord(xe+1)))&&v.call(this,e,t,r,f,Ve,g,x,P))return}},Do.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},Do.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},Do.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var e=this.cells,t=3+this.cells.length+1+1,r=0,f=0;f<this.cells.length;f++)r+=this.cells[f].length;var v=new Int32Array(t+r+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var g=t,x=0;x<e.length;x++){var P=e[x];v[3+x]=g,v.set(P,g),g+=P.length}return v[3+e.length]=g,v.set(this.keys,g),v[3+e.length+1]=g+=this.keys.length,v.set(this.bboxes,g),g+=this.bboxes.length,v.buffer};var bs=$.ImageData,Sl=$.ImageBitmap,To={};function Cn(e,t,r){r===void 0&&(r={}),Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),To[e]={klass:t,omit:r.omit||[],shallow:r.shallow||[]}}for(var no in Cn("Object",Object),Qa.serialize=function(e,t){var r=e.toArrayBuffer();return t&&t.push(r),{buffer:r}},Qa.deserialize=function(e){return new Qa(e.buffer)},Cn("Grid",Qa),Cn("Color",Ji),Cn("Error",Error),Cn("ResolvedImage",Xi),Cn("StylePropertyFunction",xs),Cn("StyleExpression",Ys,{omit:["_evaluator"]}),Cn("ZoomDependentExpression",wo),Cn("ZoomConstantExpression",ou),Cn("CompoundExpression",uo,{omit:["_evaluate"]}),Tu)Tu[no]._classRegistryKey||Cn("Expression_"+no,Tu[no]);function Mu(e){return e&&typeof ArrayBuffer!="undefined"&&(e instanceof ArrayBuffer||e.constructor&&e.constructor.name==="ArrayBuffer")}function cl(e){return Sl&&e instanceof Sl}function su(e,t){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(Mu(e)||cl(e))return t&&t.push(e),e;if(ArrayBuffer.isView(e)){var r=e;return t&&t.push(r.buffer),r}if(e instanceof bs)return t&&t.push(e.data.buffer),e;if(Array.isArray(e)){for(var f=[],v=0,g=e;v<g.length;v+=1)f.push(su(g[v],t));return f}if(typeof e=="object"){var x=e.constructor,P=x._classRegistryKey;if(!P)throw new Error("can't serialize object of unregistered class");var D=x.serialize?x.serialize(e,t):{};if(!x.serialize){for(var Z in e)if(e.hasOwnProperty(Z)&&!(To[P].omit.indexOf(Z)>=0)){var W=e[Z];D[Z]=To[P].shallow.indexOf(Z)>=0?W:su(W,t)}e instanceof Error&&(D.message=e.message)}if(D.$name)throw new Error("$name property is reserved for worker serialization logic.");return P!=="Object"&&(D.$name=P),D}throw new Error("can't serialize object of type "+typeof e)}function ko(e){if(e==null||typeof e=="boolean"||typeof e=="number"||typeof e=="string"||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||Mu(e)||cl(e)||ArrayBuffer.isView(e)||e instanceof bs)return e;if(Array.isArray(e))return e.map(ko);if(typeof e=="object"){var t=e.$name||"Object",r=To[t].klass;if(!r)throw new Error("can't deserialize unregistered class "+t);if(r.deserialize)return r.deserialize(e);for(var f=Object.create(r.prototype),v=0,g=Object.keys(e);v<g.length;v+=1){var x=g[v];if(x!=="$name"){var P=e[x];f[x]=To[t].shallow.indexOf(x)>=0?P:ko(P)}}return f}throw new Error("can't deserialize object of type "+typeof e)}var cc=function(){this.first=!0};cc.prototype.update=function(e,t){var r=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=r,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=r,!0):(this.lastFloorZoom>r?(this.lastIntegerZoom=r+1,this.lastIntegerZoomTime=t):this.lastFloorZoom<r&&(this.lastIntegerZoom=r,this.lastIntegerZoomTime=t),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=r,!0))};var xn={"Latin-1 Supplement":function(e){return e>=128&&e<=255},Arabic:function(e){return e>=1536&&e<=1791},"Arabic Supplement":function(e){return e>=1872&&e<=1919},"Arabic Extended-A":function(e){return e>=2208&&e<=2303},"Hangul Jamo":function(e){return e>=4352&&e<=4607},"Unified Canadian Aboriginal Syllabics":function(e){return e>=5120&&e<=5759},Khmer:function(e){return e>=6016&&e<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(e){return e>=6320&&e<=6399},"General Punctuation":function(e){return e>=8192&&e<=8303},"Letterlike Symbols":function(e){return e>=8448&&e<=8527},"Number Forms":function(e){return e>=8528&&e<=8591},"Miscellaneous Technical":function(e){return e>=8960&&e<=9215},"Control Pictures":function(e){return e>=9216&&e<=9279},"Optical Character Recognition":function(e){return e>=9280&&e<=9311},"Enclosed Alphanumerics":function(e){return e>=9312&&e<=9471},"Geometric Shapes":function(e){return e>=9632&&e<=9727},"Miscellaneous Symbols":function(e){return e>=9728&&e<=9983},"Miscellaneous Symbols and Arrows":function(e){return e>=11008&&e<=11263},"CJK Radicals Supplement":function(e){return e>=11904&&e<=12031},"Kangxi Radicals":function(e){return e>=12032&&e<=12255},"Ideographic Description Characters":function(e){return e>=12272&&e<=12287},"CJK Symbols and Punctuation":function(e){return e>=12288&&e<=12351},Hiragana:function(e){return e>=12352&&e<=12447},Katakana:function(e){return e>=12448&&e<=12543},Bopomofo:function(e){return e>=12544&&e<=12591},"Hangul Compatibility Jamo":function(e){return e>=12592&&e<=12687},Kanbun:function(e){return e>=12688&&e<=12703},"Bopomofo Extended":function(e){return e>=12704&&e<=12735},"CJK Strokes":function(e){return e>=12736&&e<=12783},"Katakana Phonetic Extensions":function(e){return e>=12784&&e<=12799},"Enclosed CJK Letters and Months":function(e){return e>=12800&&e<=13055},"CJK Compatibility":function(e){return e>=13056&&e<=13311},"CJK Unified Ideographs Extension A":function(e){return e>=13312&&e<=19903},"Yijing Hexagram Symbols":function(e){return e>=19904&&e<=19967},"CJK Unified Ideographs":function(e){return e>=19968&&e<=40959},"Yi Syllables":function(e){return e>=40960&&e<=42127},"Yi Radicals":function(e){return e>=42128&&e<=42191},"Hangul Jamo Extended-A":function(e){return e>=43360&&e<=43391},"Hangul Syllables":function(e){return e>=44032&&e<=55215},"Hangul Jamo Extended-B":function(e){return e>=55216&&e<=55295},"Private Use Area":function(e){return e>=57344&&e<=63743},"CJK Compatibility Ideographs":function(e){return e>=63744&&e<=64255},"Arabic Presentation Forms-A":function(e){return e>=64336&&e<=65023},"Vertical Forms":function(e){return e>=65040&&e<=65055},"CJK Compatibility Forms":function(e){return e>=65072&&e<=65103},"Small Form Variants":function(e){return e>=65104&&e<=65135},"Arabic Presentation Forms-B":function(e){return e>=65136&&e<=65279},"Halfwidth and Fullwidth Forms":function(e){return e>=65280&&e<=65519}};function Wa(e){for(var t=0,r=e;t<r.length;t+=1)if(Ec(r[t].charCodeAt(0)))return!0;return!1}function Ec(e){return!(e!==746&&e!==747&&(e<4352||!(xn["Bopomofo Extended"](e)||xn.Bopomofo(e)||xn["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||xn["CJK Compatibility Ideographs"](e)||xn["CJK Compatibility"](e)||xn["CJK Radicals Supplement"](e)||xn["CJK Strokes"](e)||!(!xn["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||e===12336)||xn["CJK Unified Ideographs Extension A"](e)||xn["CJK Unified Ideographs"](e)||xn["Enclosed CJK Letters and Months"](e)||xn["Hangul Compatibility Jamo"](e)||xn["Hangul Jamo Extended-A"](e)||xn["Hangul Jamo Extended-B"](e)||xn["Hangul Jamo"](e)||xn["Hangul Syllables"](e)||xn.Hiragana(e)||xn["Ideographic Description Characters"](e)||xn.Kanbun(e)||xn["Kangxi Radicals"](e)||xn["Katakana Phonetic Extensions"](e)||xn.Katakana(e)&&e!==12540||!(!xn["Halfwidth and Fullwidth Forms"](e)||e===65288||e===65289||e===65293||e>=65306&&e<=65310||e===65339||e===65341||e===65343||e>=65371&&e<=65503||e===65507||e>=65512&&e<=65519)||!(!xn["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||xn["Unified Canadian Aboriginal Syllabics"](e)||xn["Unified Canadian Aboriginal Syllabics Extended"](e)||xn["Vertical Forms"](e)||xn["Yijing Hexagram Symbols"](e)||xn["Yi Syllables"](e)||xn["Yi Radicals"](e))))}function js(e){return!(Ec(e)||function(t){return!!(xn["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||xn["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||xn["Letterlike Symbols"](t)||xn["Number Forms"](t)||xn["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||xn["Control Pictures"](t)&&t!==9251||xn["Optical Character Recognition"](t)||xn["Enclosed Alphanumerics"](t)||xn["Geometric Shapes"](t)||xn["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||xn["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||xn["CJK Symbols and Punctuation"](t)||xn.Katakana(t)||xn["Private Use Area"](t)||xn["CJK Compatibility Forms"](t)||xn["Small Form Variants"](t)||xn["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(e))}function qa(e){return e>=1424&&e<=2303||xn["Arabic Presentation Forms-A"](e)||xn["Arabic Presentation Forms-B"](e)}function Ya(e,t){return!(!t&&qa(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||xn.Khmer(e))}function zl(e){for(var t=0,r=e;t<r.length;t+=1)if(qa(r[t].charCodeAt(0)))return!0;return!1}var bu=null,ks="unavailable",Uu=null,Bc=function(e){e&&typeof e=="string"&&e.indexOf("NetworkError")>-1&&(ks="error"),bu&&bu(e)};function Zl(){El.fire(new ee("pluginStateChange",{pluginStatus:ks,pluginURL:Uu}))}var El=new Te,fc=function(){return ks},Vs=function(){if(ks!=="deferred"||!Uu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ks="loading",Zl(),Uu&&Zi({url:Uu},function(e){e?Bc(e):(ks="loaded",Zl())})},Fs={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return ks==="loaded"||Fs.applyArabicShaping!=null},isLoading:function(){return ks==="loading"},setState:function(e){ks=e.pluginStatus,Uu=e.pluginURL},isParsed:function(){return Fs.applyArabicShaping!=null&&Fs.processBidirectionalText!=null&&Fs.processStyledBidirectionalText!=null},getPluginURL:function(){return Uu}},ea=function(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.zoomHistory=t.zoomHistory,this.transition=t.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new cc,this.transition={})};ea.prototype.isSupportedScript=function(e){return function(t,r){for(var f=0,v=t;f<v.length;f+=1)if(!Ya(v[f].charCodeAt(0),r))return!1;return!0}(e,Fs.isLoaded())},ea.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ea.prototype.getCrossfadeParameters=function(){var e=this.zoom,t=e-Math.floor(e),r=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:t+(1-t)*r}:{fromScale:.5,toScale:1,t:1-(1-r)*t}};var Iu=function(e,t){this.property=e,this.value=t,this.expression=function(r,f){if(_l(r))return new xs(r,f);if(Pu(r)){var v=Ls(r,f);if(v.result==="error")throw new Error(v.value.map(function(x){return x.key+": "+x.message}).join(", "));return v.value}var g=r;return typeof r=="string"&&f.type==="color"&&(g=Ji.parse(r)),{kind:"constant",evaluate:function(){return g}}}(t===void 0?e.specification.default:t,e.specification)};Iu.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},Iu.prototype.possiblyEvaluate=function(e,t,r){return this.property.possiblyEvaluate(this,e,t,r)};var $s=function(e){this.property=e,this.value=new Iu(e,void 0)};$s.prototype.transitioned=function(e,t){return new Cl(this.property,this.value,t,Yt({},e.transition,this.transition),e.now)},$s.prototype.untransitioned=function(){return new Cl(this.property,this.value,null,{},0)};var Ra=function(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)};Ra.prototype.getValue=function(e){return $e(this._values[e].value.value)},Ra.prototype.setValue=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new $s(this._values[e].property)),this._values[e].value=new Iu(this._values[e].property,t===null?void 0:$e(t))},Ra.prototype.getTransition=function(e){return $e(this._values[e].transition)},Ra.prototype.setTransition=function(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new $s(this._values[e].property)),this._values[e].transition=$e(t)||void 0},Ra.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v);var g=this.getTransition(f);g!==void 0&&(e[f+"-transition"]=g)}return e},Ra.prototype.transitioned=function(e,t){for(var r=new Su(this._properties),f=0,v=Object.keys(this._values);f<v.length;f+=1){var g=v[f];r._values[g]=this._values[g].transitioned(e,t._values[g])}return r},Ra.prototype.untransitioned=function(){for(var e=new Su(this._properties),t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t];e._values[f]=this._values[f].untransitioned()}return e};var Cl=function(e,t,r,f,v){this.property=e,this.value=t,this.begin=v+f.delay||0,this.end=this.begin+f.duration||0,e.specification.transition&&(f.delay||f.duration)&&(this.prior=r)};Cl.prototype.possiblyEvaluate=function(e,t,r){var f=e.now||0,v=this.value.possiblyEvaluate(e,t,r),g=this.prior;if(g){if(f>this.end)return this.prior=null,v;if(this.value.isDataDriven())return this.prior=null,v;if(f<this.begin)return g.possiblyEvaluate(e,t,r);var x=(f-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,t,r),v,function(P){if(P<=0)return 0;if(P>=1)return 1;var D=P*P,Z=D*P;return 4*(P<.5?Z:3*(P-D)+Z-.75)}(x))}return v};var Su=function(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)};Su.prototype.possiblyEvaluate=function(e,t,r){for(var f=new fl(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var x=g[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f},Su.prototype.hasTransition=function(){for(var e=0,t=Object.keys(this._values);e<t.length;e+=1)if(this._values[t[e]].prior)return!0;return!1};var uu=function(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)};uu.prototype.getValue=function(e){return $e(this._values[e].value)},uu.prototype.setValue=function(e,t){this._values[e]=new Iu(this._values[e].property,t===null?void 0:$e(t))},uu.prototype.serialize=function(){for(var e={},t=0,r=Object.keys(this._values);t<r.length;t+=1){var f=r[t],v=this.getValue(f);v!==void 0&&(e[f]=v)}return e},uu.prototype.possiblyEvaluate=function(e,t,r){for(var f=new fl(this._properties),v=0,g=Object.keys(this._values);v<g.length;v+=1){var x=g[v];f._values[x]=this._values[x].possiblyEvaluate(e,t,r)}return f};var eo=function(e,t,r){this.property=e,this.value=t,this.parameters=r};eo.prototype.isConstant=function(){return this.value.kind==="constant"},eo.prototype.constantOr=function(e){return this.value.kind==="constant"?this.value.value:e},eo.prototype.evaluate=function(e,t,r,f){return this.property.evaluate(this.value,this.parameters,e,t,r,f)};var fl=function(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)};fl.prototype.get=function(e){return this._values[e]};var ii=function(e){this.specification=e};ii.prototype.possiblyEvaluate=function(e,t){return e.expression.evaluate(t)},ii.prototype.interpolate=function(e,t,r){var f=Ro[this.specification.type];return f?f(e,t,r):e};var qn=function(e,t){this.specification=e,this.overrides=t};qn.prototype.possiblyEvaluate=function(e,t,r,f){return new eo(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(t,null,{},r,f)}:e.expression,t)},qn.prototype.interpolate=function(e,t,r){if(e.value.kind!=="constant"||t.value.kind!=="constant")return e;if(e.value.value===void 0||t.value.value===void 0)return new eo(this,{kind:"constant",value:void 0},e.parameters);var f=Ro[this.specification.type];return f?new eo(this,{kind:"constant",value:f(e.value.value,t.value.value,r)},e.parameters):e},qn.prototype.evaluate=function(e,t,r,f,v,g){return e.kind==="constant"?e.value:e.evaluate(t,r,f,v,g)};var Ul=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f,v,g){if(r.value===void 0)return new eo(this,{kind:"constant",value:void 0},f);if(r.expression.kind==="constant"){var x=r.expression.evaluate(f,null,{},v,g),P=r.property.specification.type==="resolvedImage"&&typeof x!="string"?x.name:x,D=this._calculate(P,P,P,f);return new eo(this,{kind:"constant",value:D},f)}if(r.expression.kind==="camera"){var Z=this._calculate(r.expression.evaluate({zoom:f.zoom-1}),r.expression.evaluate({zoom:f.zoom}),r.expression.evaluate({zoom:f.zoom+1}),f);return new eo(this,{kind:"constant",value:Z},f)}return new eo(this,r.expression,f)},t.prototype.evaluate=function(r,f,v,g,x,P){if(r.kind==="source"){var D=r.evaluate(f,v,g,x,P);return this._calculate(D,D,D,f)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(f.zoom)-1},v,g),r.evaluate({zoom:Math.floor(f.zoom)},v,g),r.evaluate({zoom:Math.floor(f.zoom)+1},v,g),f):r.value},t.prototype._calculate=function(r,f,v,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:f}:{from:v,to:f}},t.prototype.interpolate=function(r){return r},t}(qn),es=function(e){this.specification=e};es.prototype.possiblyEvaluate=function(e,t,r,f){if(e.value!==void 0){if(e.expression.kind==="constant"){var v=e.expression.evaluate(t,null,{},r,f);return this._calculate(v,v,v,t)}return this._calculate(e.expression.evaluate(new ea(Math.floor(t.zoom-1),t)),e.expression.evaluate(new ea(Math.floor(t.zoom),t)),e.expression.evaluate(new ea(Math.floor(t.zoom+1),t)),t)}},es.prototype._calculate=function(e,t,r,f){return f.zoom>f.zoomHistory.lastIntegerZoom?{from:e,to:t}:{from:r,to:t}},es.prototype.interpolate=function(e){return e};var Bs=function(e){this.specification=e};Bs.prototype.possiblyEvaluate=function(e,t,r,f){return!!e.expression.evaluate(t,null,{},r,f)},Bs.prototype.interpolate=function(){return!1};var zo=function(e){for(var t in this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],e){var r=e[t];r.specification.overridable&&this.overridableProperties.push(t);var f=this.defaultPropertyValues[t]=new Iu(r,void 0),v=this.defaultTransitionablePropertyValues[t]=new $s(r);this.defaultTransitioningPropertyValues[t]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[t]=f.possiblyEvaluate({})}};Cn("DataDrivenProperty",qn),Cn("DataConstantProperty",ii),Cn("CrossFadedDataDrivenProperty",Ul),Cn("CrossFadedProperty",es),Cn("ColorRampProperty",Bs);var lu=function(e){function t(r,f){if(e.call(this),this.id=r.id,this.type=r.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},r.type!=="custom"&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),f.layout&&(this._unevaluatedLayout=new uu(f.layout)),f.paint)){for(var v in this._transitionablePaint=new Ra(f.paint),r.paint)this.setPaintProperty(v,r.paint[v],{validate:!1});for(var g in r.layout)this.setLayoutProperty(g,r.layout[g],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fl(f.paint)}}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},t.prototype.getLayoutProperty=function(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)},t.prototype.setLayoutProperty=function(r,f,v){v===void 0&&(v={}),f!=null&&this._validate(Ju,"layers."+this.id+".layout."+r,r,f,v)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,f):this.visibility=f)},t.prototype.getPaintProperty=function(r){return q(r,"-transition")?this._transitionablePaint.getTransition(r.slice(0,-"-transition".length)):this._transitionablePaint.getValue(r)},t.prototype.setPaintProperty=function(r,f,v){if(v===void 0&&(v={}),f!=null&&this._validate(gf,"layers."+this.id+".paint."+r,r,f,v))return!1;if(q(r,"-transition"))return this._transitionablePaint.setTransition(r.slice(0,-"-transition".length),f||void 0),!1;var g=this._transitionablePaint._values[r],x=g.property.specification["property-type"]==="cross-faded-data-driven",P=g.value.isDataDriven(),D=g.value;this._transitionablePaint.setValue(r,f),this._handleSpecialPaintPropertyUpdate(r);var Z=this._transitionablePaint._values[r].value;return Z.isDataDriven()||P||x||this._handleOverridablePaintPropertyUpdate(r,D,Z)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!1},t.prototype.isHidden=function(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"},t.prototype.updateTransitions=function(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)},t.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},t.prototype.recalculate=function(r,f){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,f)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,f)},t.prototype.serialize=function(){var r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Qe(r,function(f,v){return!(f===void 0||v==="layout"&&!Object.keys(f).length||v==="paint"&&!Object.keys(f).length)})},t.prototype._validate=function(r,f,v,g,x){return x===void 0&&(x={}),(!x||x.validate!==!1)&&bo(this,r.call(Nl,{key:f,layerType:this.type,objectKey:v,value:g,styleSpec:ae,style:{glyphs:!0,sprite:!0}}))},t.prototype.is3D=function(){return!1},t.prototype.isTileClipped=function(){return!1},t.prototype.hasOffscreenPass=function(){return!1},t.prototype.resize=function(){},t.prototype.isStateDependent=function(){for(var r in this.paint._values){var f=this.paint.get(r);if(f instanceof eo&&sa(f.property.specification)&&(f.value.kind==="source"||f.value.kind==="composite")&&f.value.isStateDependent)return!0}return!1},t}(Te),Cc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},hc=function(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},ta=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function ba(e,t){t===void 0&&(t=1);var r=0,f=0;return{members:e.map(function(v){var g=Cc[v.type].BYTES_PER_ELEMENT,x=r=qc(r,Math.max(t,g)),P=v.components||1;return f=Math.max(f,g),r+=g*P,{name:v.name,type:v.type,components:P,offset:x}}),size:qc(r,Math.max(f,t)),alignment:t}}function qc(e,t){return Math.ceil(e/t)*t}ta.serialize=function(e,t){return e._trim(),t&&(e.isTransferred=!0,t.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}},ta.deserialize=function(e){var t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement,t._refreshViews(),t},ta.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},ta.prototype.clear=function(){this.length=0},ta.prototype.resize=function(e){this.reserve(e),this.length=e},ta.prototype.reserve=function(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}},ta.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Po=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.int16[g+0]=f,this.int16[g+1]=v,r},t}(ta);Po.prototype.bytesPerElement=4,Cn("StructArrayLayout2i4",Po);var wl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var P=4*r;return this.int16[P+0]=f,this.int16[P+1]=v,this.int16[P+2]=g,this.int16[P+3]=x,r},t}(ta);wl.prototype.bytesPerElement=8,Cn("StructArrayLayout4i8",wl);var Gs=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P){var D=this.length;return this.resize(D+1),this.emplace(D,r,f,v,g,x,P)},t.prototype.emplace=function(r,f,v,g,x,P,D){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=g,this.int16[Z+3]=x,this.int16[Z+4]=P,this.int16[Z+5]=D,r},t}(ta);Gs.prototype.bytesPerElement=12,Cn("StructArrayLayout2i4i12",Gs);var Ss=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P){var D=this.length;return this.resize(D+1),this.emplace(D,r,f,v,g,x,P)},t.prototype.emplace=function(r,f,v,g,x,P,D){var Z=4*r,W=8*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.uint8[W+4]=g,this.uint8[W+5]=x,this.uint8[W+6]=P,this.uint8[W+7]=D,r},t}(ta);Ss.prototype.bytesPerElement=8,Cn("StructArrayLayout2i4ub8",Ss);var hl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.float32[g+0]=f,this.float32[g+1]=v,r},t}(ta);hl.prototype.bytesPerElement=8,Cn("StructArrayLayout2f8",hl);var Eu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,D,Z,W,te){var fe=this.length;return this.resize(fe+1),this.emplace(fe,r,f,v,g,x,P,D,Z,W,te)},t.prototype.emplace=function(r,f,v,g,x,P,D,Z,W,te,fe){var xe=10*r;return this.uint16[xe+0]=f,this.uint16[xe+1]=v,this.uint16[xe+2]=g,this.uint16[xe+3]=x,this.uint16[xe+4]=P,this.uint16[xe+5]=D,this.uint16[xe+6]=Z,this.uint16[xe+7]=W,this.uint16[xe+8]=te,this.uint16[xe+9]=fe,r},t}(ta);Eu.prototype.bytesPerElement=20,Cn("StructArrayLayout10ui20",Eu);var wc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,D,Z,W,te,fe,xe){var Ve=this.length;return this.resize(Ve+1),this.emplace(Ve,r,f,v,g,x,P,D,Z,W,te,fe,xe)},t.prototype.emplace=function(r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve){var We=12*r;return this.int16[We+0]=f,this.int16[We+1]=v,this.int16[We+2]=g,this.int16[We+3]=x,this.uint16[We+4]=P,this.uint16[We+5]=D,this.uint16[We+6]=Z,this.uint16[We+7]=W,this.int16[We+8]=te,this.int16[We+9]=fe,this.int16[We+10]=xe,this.int16[We+11]=Ve,r},t}(ta);wc.prototype.bytesPerElement=24,Cn("StructArrayLayout4i4ui4i24",wc);var Ri=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.float32[x+0]=f,this.float32[x+1]=v,this.float32[x+2]=g,r},t}(ta);Ri.prototype.bytesPerElement=12,Cn("StructArrayLayout3f12",Ri);var Qu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint32[1*r+0]=f,r},t}(ta);Qu.prototype.bytesPerElement=4,Cn("StructArrayLayout1ul4",Qu);var Nc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,D,Z,W){var te=this.length;return this.resize(te+1),this.emplace(te,r,f,v,g,x,P,D,Z,W)},t.prototype.emplace=function(r,f,v,g,x,P,D,Z,W,te){var fe=10*r,xe=5*r;return this.int16[fe+0]=f,this.int16[fe+1]=v,this.int16[fe+2]=g,this.int16[fe+3]=x,this.int16[fe+4]=P,this.int16[fe+5]=D,this.uint32[xe+3]=Z,this.uint16[fe+8]=W,this.uint16[fe+9]=te,r},t}(ta);Nc.prototype.bytesPerElement=20,Cn("StructArrayLayout6i1ul2ui20",Nc);var Fo=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P){var D=this.length;return this.resize(D+1),this.emplace(D,r,f,v,g,x,P)},t.prototype.emplace=function(r,f,v,g,x,P,D){var Z=6*r;return this.int16[Z+0]=f,this.int16[Z+1]=v,this.int16[Z+2]=g,this.int16[Z+3]=x,this.int16[Z+4]=P,this.int16[Z+5]=D,r},t}(ta);Fo.prototype.bytesPerElement=12,Cn("StructArrayLayout2i2i2i12",Fo);var Cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x){var P=this.length;return this.resize(P+1),this.emplace(P,r,f,v,g,x)},t.prototype.emplace=function(r,f,v,g,x,P){var D=4*r,Z=8*r;return this.float32[D+0]=f,this.float32[D+1]=v,this.float32[D+2]=g,this.int16[Z+6]=x,this.int16[Z+7]=P,r},t}(ta);Cu.prototype.bytesPerElement=16,Cn("StructArrayLayout2f1f2i16",Cu);var jl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var P=12*r,D=3*r;return this.uint8[P+0]=f,this.uint8[P+1]=v,this.float32[D+1]=g,this.float32[D+2]=x,r},t}(ta);jl.prototype.bytesPerElement=12,Cn("StructArrayLayout2ub2f12",jl);var qu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.uint16[x+0]=f,this.uint16[x+1]=v,this.uint16[x+2]=g,r},t}(ta);qu.prototype.bytesPerElement=6,Cn("StructArrayLayout3ui6",qu);var cu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We,yt,rt,Pt){var Xt=this.length;return this.resize(Xt+1),this.emplace(Xt,r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We,yt,rt,Pt)},t.prototype.emplace=function(r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We,yt,rt,Pt,Xt){var hr=24*r,yr=12*r,Nr=48*r;return this.int16[hr+0]=f,this.int16[hr+1]=v,this.uint16[hr+2]=g,this.uint16[hr+3]=x,this.uint32[yr+2]=P,this.uint32[yr+3]=D,this.uint32[yr+4]=Z,this.uint16[hr+10]=W,this.uint16[hr+11]=te,this.uint16[hr+12]=fe,this.float32[yr+7]=xe,this.float32[yr+8]=Ve,this.uint8[Nr+36]=We,this.uint8[Nr+37]=yt,this.uint8[Nr+38]=rt,this.uint32[yr+10]=Pt,this.int16[hr+22]=Xt,r},t}(ta);cu.prototype.bytesPerElement=48,Cn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",cu);var Al=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We,yt,rt,Pt,Xt,hr,yr,Nr,ln,Sn,fi,Zn,di,Gn,ra){var ki=this.length;return this.resize(ki+1),this.emplace(ki,r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We,yt,rt,Pt,Xt,hr,yr,Nr,ln,Sn,fi,Zn,di,Gn,ra)},t.prototype.emplace=function(r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We,yt,rt,Pt,Xt,hr,yr,Nr,ln,Sn,fi,Zn,di,Gn,ra,ki){var ri=34*r,ma=17*r;return this.int16[ri+0]=f,this.int16[ri+1]=v,this.int16[ri+2]=g,this.int16[ri+3]=x,this.int16[ri+4]=P,this.int16[ri+5]=D,this.int16[ri+6]=Z,this.int16[ri+7]=W,this.uint16[ri+8]=te,this.uint16[ri+9]=fe,this.uint16[ri+10]=xe,this.uint16[ri+11]=Ve,this.uint16[ri+12]=We,this.uint16[ri+13]=yt,this.uint16[ri+14]=rt,this.uint16[ri+15]=Pt,this.uint16[ri+16]=Xt,this.uint16[ri+17]=hr,this.uint16[ri+18]=yr,this.uint16[ri+19]=Nr,this.uint16[ri+20]=ln,this.uint16[ri+21]=Sn,this.uint16[ri+22]=fi,this.uint32[ma+12]=Zn,this.float32[ma+13]=di,this.float32[ma+14]=Gn,this.float32[ma+15]=ra,this.float32[ma+16]=ki,r},t}(ta);Al.prototype.bytesPerElement=68,Cn("StructArrayLayout8i15ui1ul4f68",Al);var Ou=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.float32[1*r+0]=f,r},t}(ta);Ou.prototype.bytesPerElement=4,Cn("StructArrayLayout1f4",Ou);var fu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=3*r;return this.int16[x+0]=f,this.int16[x+1]=v,this.int16[x+2]=g,r},t}(ta);fu.prototype.bytesPerElement=6,Cn("StructArrayLayout3i6",fu);var zc=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v){var g=this.length;return this.resize(g+1),this.emplace(g,r,f,v)},t.prototype.emplace=function(r,f,v,g){var x=4*r;return this.uint32[2*r+0]=f,this.uint16[x+2]=v,this.uint16[x+3]=g,r},t}(ta);zc.prototype.bytesPerElement=8,Cn("StructArrayLayout1ul2ui8",zc);var Lu=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f){var v=this.length;return this.resize(v+1),this.emplace(v,r,f)},t.prototype.emplace=function(r,f,v){var g=2*r;return this.uint16[g+0]=f,this.uint16[g+1]=v,r},t}(ta);Lu.prototype.bytesPerElement=4,Cn("StructArrayLayout2ui4",Lu);var Ea=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r){var f=this.length;return this.resize(f+1),this.emplace(f,r)},t.prototype.emplace=function(r,f){return this.uint16[1*r+0]=f,r},t}(ta);Ea.prototype.bytesPerElement=2,Cn("StructArrayLayout1ui2",Ea);var Tl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},t.prototype.emplaceBack=function(r,f,v,g){var x=this.length;return this.resize(x+1),this.emplace(x,r,f,v,g)},t.prototype.emplace=function(r,f,v,g,x){var P=4*r;return this.float32[P+0]=f,this.float32[P+1]=v,this.float32[P+2]=g,this.float32[P+3]=x,r},t}(ta);Tl.prototype.bytesPerElement=16,Cn("StructArrayLayout4f16",Tl);var i=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return r.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},r.x1.get=function(){return this._structArray.int16[this._pos2+2]},r.y1.get=function(){return this._structArray.int16[this._pos2+3]},r.x2.get=function(){return this._structArray.int16[this._pos2+4]},r.y2.get=function(){return this._structArray.int16[this._pos2+5]},r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.anchorPoint.get=function(){return new se(this.anchorPointX,this.anchorPointY)},Object.defineProperties(t.prototype,r),t}(hc);i.prototype.size=20;var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new i(this,r)},t}(Nc);Cn("CollisionBoxArray",u);var o=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},r.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},r.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},r.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},r.segment.get=function(){return this._structArray.uint16[this._pos2+10]},r.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},r.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},r.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},r.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},r.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},r.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},r.placedOrientation.set=function(f){this._structArray.uint8[this._pos1+37]=f},r.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},r.hidden.set=function(f){this._structArray.uint8[this._pos1+38]=f},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+10]=f},r.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(t.prototype,r),t}(hc);o.prototype.size=48;var h=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new o(this,r)},t}(cu);Cn("PlacedSymbolArray",h);var y=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return r.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},r.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},r.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},r.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},r.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},r.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},r.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},r.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},r.key.get=function(){return this._structArray.uint16[this._pos2+8]},r.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},r.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},r.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},r.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},r.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},r.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},r.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},r.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},r.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},r.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},r.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},r.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},r.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},r.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},r.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},r.crossTileID.set=function(f){this._structArray.uint32[this._pos4+12]=f},r.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},r.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},r.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},r.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(t.prototype,r),t}(hc);y.prototype.size=68;var b=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new y(this,r)},t}(Al);Cn("SymbolInstanceArray",b);var T=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getoffsetX=function(r){return this.float32[1*r+0]},t}(Ou);Cn("GlyphOffsetArray",T);var R=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.getx=function(r){return this.int16[3*r+0]},t.prototype.gety=function(r){return this.int16[3*r+1]},t.prototype.gettileUnitDistanceFromAnchor=function(r){return this.int16[3*r+2]},t}(fu);Cn("SymbolLineVertexArray",R);var j=function(e){function t(){e.apply(this,arguments)}e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t;var r={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return r.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},r.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},r.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(t.prototype,r),t}(hc);j.prototype.size=8;var ne=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.get=function(r){return new j(this,r)},t}(zc);Cn("FeatureIndexArray",ne);var be=ba([{name:"a_pos",components:2,type:"Int16"}],4).members,Ce=function(e){e===void 0&&(e=[]),this.segments=e};function Pe(e,t){return 256*(e=Ir(Math.floor(e),0,255))+Ir(Math.floor(t),0,255)}Ce.prototype.prepareSegment=function(e,t,r,f){var v=this.segments[this.segments.length-1];return e>Ce.MAX_VERTEX_ARRAY_LENGTH&&Xe("Max vertices per segment is "+Ce.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+e),(!v||v.vertexLength+e>Ce.MAX_VERTEX_ARRAY_LENGTH||v.sortKey!==f)&&(v={vertexOffset:t.length,primitiveOffset:r.length,vertexLength:0,primitiveLength:0},f!==void 0&&(v.sortKey=f),this.segments.push(v)),v},Ce.prototype.get=function(){return this.segments},Ce.prototype.destroy=function(){for(var e=0,t=this.segments;e<t.length;e+=1){var r=t[e];for(var f in r.vaos)r.vaos[f].destroy()}},Ce.simpleSegment=function(e,t,r,f){return new Ce([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:f,vaos:{},sortKey:0}])},Ce.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Cn("SegmentVector",Ce);var He=ba([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),je=de(function(e){e.exports=function(t,r){var f,v,g,x,P,D,Z,W;for(v=t.length-(f=3&t.length),g=r,P=3432918353,D=461845907,W=0;W<v;)Z=255&t.charCodeAt(W)|(255&t.charCodeAt(++W))<<8|(255&t.charCodeAt(++W))<<16|(255&t.charCodeAt(++W))<<24,++W,g=27492+(65535&(x=5*(65535&(g=(g^=Z=(65535&(Z=(Z=(65535&Z)*P+(((Z>>>16)*P&65535)<<16)&4294967295)<<15|Z>>>17))*D+(((Z>>>16)*D&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(x>>>16)&65535)<<16);switch(Z=0,f){case 3:Z^=(255&t.charCodeAt(W+2))<<16;case 2:Z^=(255&t.charCodeAt(W+1))<<8;case 1:g^=Z=(65535&(Z=(Z=(65535&(Z^=255&t.charCodeAt(W)))*P+(((Z>>>16)*P&65535)<<16)&4294967295)<<15|Z>>>17))*D+(((Z>>>16)*D&65535)<<16)&4294967295}return g^=t.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0}}),ot=de(function(e){e.exports=function(t,r){for(var f,v=t.length,g=r^v,x=0;v>=4;)f=1540483477*(65535&(f=255&t.charCodeAt(x)|(255&t.charCodeAt(++x))<<8|(255&t.charCodeAt(++x))<<16|(255&t.charCodeAt(++x))<<24))+((1540483477*(f>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(f=1540483477*(65535&(f^=f>>>24))+((1540483477*(f>>>16)&65535)<<16)),v-=4,++x;switch(v){case 3:g^=(255&t.charCodeAt(x+2))<<16;case 2:g^=(255&t.charCodeAt(x+1))<<8;case 1:g=1540483477*(65535&(g^=255&t.charCodeAt(x)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0}}),ze=je,at=ot;ze.murmur3=je,ze.murmur2=at;var Et=function(){this.ids=[],this.positions=[],this.indexed=!1};Et.prototype.add=function(e,t,r,f){this.ids.push(mr(e)),this.positions.push(t,r,f)},Et.prototype.getPositions=function(e){for(var t=mr(e),r=0,f=this.ids.length-1;r<f;){var v=r+f>>1;this.ids[v]>=t?f=v:r=v+1}for(var g=[];this.ids[r]===t;)g.push({index:this.positions[3*r],start:this.positions[3*r+1],end:this.positions[3*r+2]}),r++;return g},Et.serialize=function(e,t){var r=new Float64Array(e.ids),f=new Uint32Array(e.positions);return function v(g,x,P,D){for(;P<D;){for(var Z=g[P+D>>1],W=P-1,te=D+1;;){do W++;while(g[W]<Z);do te--;while(g[te]>Z);if(W>=te)break;ur(g,W,te),ur(x,3*W,3*te),ur(x,3*W+1,3*te+1),ur(x,3*W+2,3*te+2)}te-P<D-te?(v(g,x,P,te),P=te+1):(v(g,x,te+1,D),D=te)}}(r,f,0,r.length-1),t&&t.push(r.buffer,f.buffer),{ids:r,positions:f}},Et.deserialize=function(e){var t=new Et;return t.ids=e.ids,t.positions=e.positions,t.indexed=!0,t};var Vt=Math.pow(2,53)-1;function mr(e){var t=+e;return!isNaN(t)&&t<=Vt?t:ze(String(e))}function ur(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}Cn("FeaturePositionMap",Et);var Er=function(e,t){this.gl=e.gl,this.location=t},jr=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))},t}(Er),hn=function(e){function t(r,f){e.call(this,r,f),this.current=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))},t}(Er),nn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))},t}(Er),Nn=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))},t}(Er),oi=function(e){function t(r,f){e.call(this,r,f),this.current=[0,0,0,0]}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))},t}(Er),ui=function(e){function t(r,f){e.call(this,r,f),this.current=Ji.transparent}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))},t}(Er),ai=new Float32Array(16),Qi=function(e){function t(r,f){e.call(this,r,f),this.current=ai}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.set=function(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(var f=1;f<16;f++)if(r[f]!==this.current[f]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}},t}(Er);function Wn(e){return[Pe(255*e.r,255*e.g),Pe(255*e.b,255*e.a)]}var Ei=function(e,t,r){this.value=e,this.uniformNames=t.map(function(f){return"u_"+f}),this.type=r};Ei.prototype.setUniform=function(e,t,r){e.set(r.constantOr(this.value))},Ei.prototype.getBinding=function(e,t,r){return this.type==="color"?new ui(e,t):new hn(e,t)};var Gi=function(e,t){this.uniformNames=t.map(function(r){return"u_"+r}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Gi.prototype.setConstantPatternPositions=function(e,t){this.pixelRatioFrom=t.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=t.tlbr,this.patternTo=e.tlbr},Gi.prototype.setUniform=function(e,t,r,f){var v=f==="u_pattern_to"?this.patternTo:f==="u_pattern_from"?this.patternFrom:f==="u_pixel_ratio_to"?this.pixelRatioTo:f==="u_pixel_ratio_from"?this.pixelRatioFrom:null;v&&e.set(v)},Gi.prototype.getBinding=function(e,t,r){return r.substr(0,9)==="u_pattern"?new oi(e,t):new hn(e,t)};var xi=function(e,t,r,f){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(function(v){return{name:"a_"+v,type:"Float32",components:r==="color"?2:1,offset:0}}),this.paintVertexArray=new f};xi.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.paintVertexArray.length,x=this.expression.evaluate(new ea(0),t,{},f,[],v);this.paintVertexArray.resize(e),this._setPaintValue(g,e,x)},xi.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:0},r,f);this._setPaintValue(e,t,v)},xi.prototype._setPaintValue=function(e,t,r){if(this.type==="color")for(var f=Wn(r),v=e;v<t;v++)this.paintVertexArray.emplace(v,f[0],f[1]);else{for(var g=e;g<t;g++)this.paintVertexArray.emplace(g,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}},xi.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},xi.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Ci=function(e,t,r,f,v,g){this.expression=e,this.uniformNames=t.map(function(x){return"u_"+x+"_t"}),this.type=r,this.useIntegerZoom=f,this.zoom=v,this.maxValue=0,this.paintVertexAttributes=t.map(function(x){return{name:"a_"+x,type:"Float32",components:r==="color"?4:2,offset:0}}),this.paintVertexArray=new g};Ci.prototype.populatePaintArray=function(e,t,r,f,v){var g=this.expression.evaluate(new ea(this.zoom),t,{},f,[],v),x=this.expression.evaluate(new ea(this.zoom+1),t,{},f,[],v),P=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(P,e,g,x)},Ci.prototype.updatePaintArray=function(e,t,r,f){var v=this.expression.evaluate({zoom:this.zoom},r,f),g=this.expression.evaluate({zoom:this.zoom+1},r,f);this._setPaintValue(e,t,v,g)},Ci.prototype._setPaintValue=function(e,t,r,f){if(this.type==="color")for(var v=Wn(r),g=Wn(f),x=e;x<t;x++)this.paintVertexArray.emplace(x,v[0],v[1],g[0],g[1]);else{for(var P=e;P<t;P++)this.paintVertexArray.emplace(P,r,f);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(f))}},Ci.prototype.upload=function(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ci.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Ci.prototype.setUniform=function(e,t){var r=this.useIntegerZoom?Math.floor(t.zoom):t.zoom,f=Ir(this.expression.interpolationFactor(r,this.zoom,this.zoom+1),0,1);e.set(f)},Ci.prototype.getBinding=function(e,t,r){return new hn(e,t)};var Q=function(e,t,r,f,v,g){this.expression=e,this.type=t,this.useIntegerZoom=r,this.zoom=f,this.layerId=g,this.zoomInPaintVertexArray=new v,this.zoomOutPaintVertexArray=new v};Q.prototype.populatePaintArray=function(e,t,r){var f=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(f,e,t.patterns&&t.patterns[this.layerId],r)},Q.prototype.updatePaintArray=function(e,t,r,f,v){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],v)},Q.prototype._setPaintValues=function(e,t,r,f){if(f&&r){var v=f[r.min],g=f[r.mid],x=f[r.max];if(v&&g&&x)for(var P=e;P<t;P++)this.zoomInPaintVertexArray.emplace(P,g.tl[0],g.tl[1],g.br[0],g.br[1],v.tl[0],v.tl[1],v.br[0],v.br[1],g.pixelRatio,v.pixelRatio),this.zoomOutPaintVertexArray.emplace(P,g.tl[0],g.tl[1],g.br[0],g.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],g.pixelRatio,x.pixelRatio)}},Q.prototype.upload=function(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,He.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,He.members,this.expression.isStateDependent))},Q.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var J=function(e,t,r){this.binders={},this._buffers=[];var f=[];for(var v in e.paint._values)if(r(v)){var g=e.paint.get(v);if(g instanceof eo&&sa(g.property.specification)){var x=k(v,e.type),P=g.value,D=g.property.specification.type,Z=g.property.useIntegerZoom,W=g.property.specification["property-type"],te=W==="cross-faded"||W==="cross-faded-data-driven";if(P.kind==="constant")this.binders[v]=te?new Gi(P.value,x):new Ei(P.value,x,D),f.push("/u_"+v);else if(P.kind==="source"||te){var fe=oe(v,D,"source");this.binders[v]=te?new Q(P,D,Z,t,fe,e.id):new xi(P,x,D,fe),f.push("/a_"+v)}else{var xe=oe(v,D,"composite");this.binders[v]=new Ci(P,x,D,Z,t,xe),f.push("/z_"+v)}}}this.cacheKey=f.sort().join("")};J.prototype.getMaxValue=function(e){var t=this.binders[e];return t instanceof xi||t instanceof Ci?t.maxValue:0},J.prototype.populatePaintArrays=function(e,t,r,f,v){for(var g in this.binders){var x=this.binders[g];(x instanceof xi||x instanceof Ci||x instanceof Q)&&x.populatePaintArray(e,t,r,f,v)}},J.prototype.setConstantPatternPositions=function(e,t){for(var r in this.binders){var f=this.binders[r];f instanceof Gi&&f.setConstantPatternPositions(e,t)}},J.prototype.updatePaintArrays=function(e,t,r,f,v){var g=!1;for(var x in e)for(var P=0,D=t.getPositions(x);P<D.length;P+=1){var Z=D[P],W=r.feature(Z.index);for(var te in this.binders){var fe=this.binders[te];if((fe instanceof xi||fe instanceof Ci||fe instanceof Q)&&fe.expression.isStateDependent===!0){var xe=f.paint.get(te);fe.expression=xe.value,fe.updatePaintArray(Z.start,Z.end,W,e[x],v),g=!0}}}return g},J.prototype.defines=function(){var e=[];for(var t in this.binders){var r=this.binders[t];(r instanceof Ei||r instanceof Gi)&&e.push.apply(e,r.uniformNames.map(function(f){return"#define HAS_UNIFORM_"+f}))}return e},J.prototype.getBinderAttributes=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof xi||r instanceof Ci)for(var f=0;f<r.paintVertexAttributes.length;f++)e.push(r.paintVertexAttributes[f].name);else if(r instanceof Q)for(var v=0;v<He.members.length;v++)e.push(He.members[v].name)}return e},J.prototype.getBinderUniforms=function(){var e=[];for(var t in this.binders){var r=this.binders[t];if(r instanceof Ei||r instanceof Gi||r instanceof Ci)for(var f=0,v=r.uniformNames;f<v.length;f+=1)e.push(v[f])}return e},J.prototype.getPaintVertexBuffers=function(){return this._buffers},J.prototype.getUniforms=function(e,t){var r=[];for(var f in this.binders){var v=this.binders[f];if(v instanceof Ei||v instanceof Gi||v instanceof Ci)for(var g=0,x=v.uniformNames;g<x.length;g+=1){var P=x[g];if(t[P]){var D=v.getBinding(e,t[P],P);r.push({name:P,property:f,binding:D})}}}return r},J.prototype.setUniforms=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1){var x=g[v],P=x.name,D=x.property;this.binders[D].setUniform(x.binding,f,r.get(D),P)}},J.prototype.updatePaintBuffers=function(e){for(var t in this._buffers=[],this.binders){var r=this.binders[t];if(e&&r instanceof Q){var f=e.fromScale===2?r.zoomInPaintVertexBuffer:r.zoomOutPaintVertexBuffer;f&&this._buffers.push(f)}else(r instanceof xi||r instanceof Ci)&&r.paintVertexBuffer&&this._buffers.push(r.paintVertexBuffer)}},J.prototype.upload=function(e){for(var t in this.binders){var r=this.binders[t];(r instanceof xi||r instanceof Ci||r instanceof Q)&&r.upload(e)}this.updatePaintBuffers()},J.prototype.destroy=function(){for(var e in this.binders){var t=this.binders[e];(t instanceof xi||t instanceof Ci||t instanceof Q)&&t.destroy()}};var O=function(e,t,r){r===void 0&&(r=function(){return!0}),this.programConfigurations={};for(var f=0,v=e;f<v.length;f+=1){var g=v[f];this.programConfigurations[g.id]=new J(g,t,r)}this.needsUpload=!1,this._featureMap=new Et,this._bufferOffset=0};function k(e,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[e]||[e.replace(t+"-","").replace(/-/g,"_")]}function oe(e,t,r){var f={color:{source:hl,composite:Tl},number:{source:Ou,composite:hl}},v=function(g){return{"line-pattern":{source:Eu,composite:Eu},"fill-pattern":{source:Eu,composite:Eu},"fill-extrusion-pattern":{source:Eu,composite:Eu}}[g]}(e);return v&&v[r]||f[t][r]}O.prototype.populatePaintArrays=function(e,t,r,f,v,g){for(var x in this.programConfigurations)this.programConfigurations[x].populatePaintArrays(e,t,f,v,g);t.id!==void 0&&this._featureMap.add(t.id,r,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0},O.prototype.updatePaintArrays=function(e,t,r,f){for(var v=0,g=r;v<g.length;v+=1){var x=g[v];this.needsUpload=this.programConfigurations[x.id].updatePaintArrays(e,this._featureMap,t,x,f)||this.needsUpload}},O.prototype.get=function(e){return this.programConfigurations[e]},O.prototype.upload=function(e){if(this.needsUpload){for(var t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}},O.prototype.destroy=function(){for(var e in this.programConfigurations)this.programConfigurations[e].destroy()},Cn("ConstantBinder",Ei),Cn("CrossFadedConstantBinder",Gi),Cn("SourceExpressionBinder",xi),Cn("CrossFadedCompositeBinder",Q),Cn("CompositeExpressionBinder",Ci),Cn("ProgramConfiguration",J,{omit:["_buffers"]}),Cn("ProgramConfigurationSet",O);var we=Math.pow(2,14)-1,gt=-we-1;function Mt(e){for(var t=8192/e.extent,r=e.loadGeometry(),f=0;f<r.length;f++)for(var v=r[f],g=0;g<v.length;g++){var x=v[g],P=Math.round(x.x*t),D=Math.round(x.y*t);x.x=Ir(P,gt,we),x.y=Ir(D,gt,we),(P<x.x||P>x.x+1||D<x.y||D>x.y+1)&&Xe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return r}function St(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Mt(e):[]}}function lr(e,t,r,f,v){e.emplaceBack(2*t+(f+1)/2,2*r+(v+1)/2)}var Wr=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Po,this.indexArray=new qu,this.segments=new Ce,this.programConfigurations=new O(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function Xn(e,t){for(var r=0;r<e.length;r++)if(Ca(t,e[r]))return!0;for(var f=0;f<t.length;f++)if(Ca(e,t[f]))return!0;return!!jn(e,t)}function Un(e,t,r){return!!Ca(e,t)||!!da(t,e,r)}function ci(e,t){if(e.length===1)return vo(t,e[0]);for(var r=0;r<t.length;r++)for(var f=t[r],v=0;v<f.length;v++)if(Ca(e,f[v]))return!0;for(var g=0;g<e.length;g++)if(vo(t,e[g]))return!0;for(var x=0;x<t.length;x++)if(jn(e,t[x]))return!0;return!1}function vi(e,t,r){if(e.length>1){if(jn(e,t))return!0;for(var f=0;f<t.length;f++)if(da(t[f],e,r))return!0}for(var v=0;v<e.length;v++)if(da(e[v],t,r))return!0;return!1}function jn(e,t){if(e.length===0||t.length===0)return!1;for(var r=0;r<e.length-1;r++)for(var f=e[r],v=e[r+1],g=0;g<t.length-1;g++)if(aa(f,v,t[g],t[g+1]))return!0;return!1}function aa(e,t,r,f){return Zt(e,r,f)!==Zt(t,r,f)&&Zt(e,t,r)!==Zt(e,t,f)}function da(e,t,r){var f=r*r;if(t.length===1)return e.distSqr(t[0])<f;for(var v=1;v<t.length;v++)if(Sa(e,t[v-1],t[v])<f)return!0;return!1}function Sa(e,t,r){var f=t.distSqr(r);if(f===0)return e.distSqr(t);var v=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/f;return e.distSqr(v<0?t:v>1?r:r.sub(t)._mult(v)._add(t))}function vo(e,t){for(var r,f,v,g=!1,x=0;x<e.length;x++)for(var P=0,D=(r=e[x]).length-1;P<r.length;D=P++)(f=r[P]).y>t.y!=(v=r[D]).y>t.y&&t.x<(v.x-f.x)*(t.y-f.y)/(v.y-f.y)+f.x&&(g=!g);return g}function Ca(e,t){for(var r=!1,f=0,v=e.length-1;f<e.length;v=f++){var g=e[f],x=e[v];g.y>t.y!=x.y>t.y&&t.x<(x.x-g.x)*(t.y-g.y)/(x.y-g.y)+g.x&&(r=!r)}return r}function Bo(e,t,r){var f=r[0],v=r[2];if(e.x<f.x&&t.x<f.x||e.x>v.x&&t.x>v.x||e.y<f.y&&t.y<f.y||e.y>v.y&&t.y>v.y)return!1;var g=Zt(e,t,r[0]);return g!==Zt(e,t,r[1])||g!==Zt(e,t,r[2])||g!==Zt(e,t,r[3])}function Za(e,t,r){var f=t.paint.get(e).value;return f.kind==="constant"?f.value:r.programConfigurations.get(t.id).getMaxValue(e)}function Ui(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ga(e,t,r,f,v){if(!t[0]&&!t[1])return e;var g=se.convert(t)._mult(v);r==="viewport"&&g._rotate(-f);for(var x=[],P=0;P<e.length;P++)x.push(e[P].sub(g));return x}Wr.prototype.populate=function(e,t,r){var f=this.layers[0],v=[],g=null;f.type==="circle"&&(g=f.layout.get("circle-sort-key"));for(var x=0,P=e;x<P.length;x+=1){var D=P[x],Z=D.feature,W=D.id,te=D.index,fe=D.sourceLayerIndex,xe=this.layers[0]._featureFilter.needGeometry,Ve=St(Z,xe);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),Ve,r)){var We=g?g.evaluate(Ve,{},r):void 0,yt={id:W,properties:Z.properties,type:Z.type,sourceLayerIndex:fe,index:te,geometry:xe?Ve.geometry:Mt(Z),patterns:{},sortKey:We};v.push(yt)}}g&&v.sort(function(Sn,fi){return Sn.sortKey-fi.sortKey});for(var rt=0,Pt=v;rt<Pt.length;rt+=1){var Xt=Pt[rt],hr=Xt.geometry,yr=Xt.index,Nr=Xt.sourceLayerIndex,ln=e[yr].feature;this.addFeature(Xt,hr,yr,r),t.featureIndex.insert(ln,hr,yr,Nr,this.index)}},Wr.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Wr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wr.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wr.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,be),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Wr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wr.prototype.addFeature=function(e,t,r,f){for(var v=0,g=t;v<g.length;v+=1)for(var x=0,P=g[v];x<P.length;x+=1){var D=P[x],Z=D.x,W=D.y;if(!(Z<0||Z>=8192||W<0||W>=8192)){var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),fe=te.vertexLength;lr(this.layoutVertexArray,Z,W,-1,-1),lr(this.layoutVertexArray,Z,W,1,-1),lr(this.layoutVertexArray,Z,W,1,1),lr(this.layoutVertexArray,Z,W,-1,1),this.indexArray.emplaceBack(fe,fe+1,fe+2),this.indexArray.emplaceBack(fe,fe+3,fe+2),te.vertexLength+=4,te.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},f)},Cn("CircleBucket",Wr,{omit:["layers"]});var io=new zo({"circle-sort-key":new qn(ae.layout_circle["circle-sort-key"])}),So={paint:new zo({"circle-radius":new qn(ae.paint_circle["circle-radius"]),"circle-color":new qn(ae.paint_circle["circle-color"]),"circle-blur":new qn(ae.paint_circle["circle-blur"]),"circle-opacity":new qn(ae.paint_circle["circle-opacity"]),"circle-translate":new ii(ae.paint_circle["circle-translate"]),"circle-translate-anchor":new ii(ae.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ii(ae.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ii(ae.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new qn(ae.paint_circle["circle-stroke-width"]),"circle-stroke-color":new qn(ae.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new qn(ae.paint_circle["circle-stroke-opacity"])}),layout:io},Oi=typeof Float32Array!="undefined"?Float32Array:Array;function co(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ka(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3],P=t[4],D=t[5],Z=t[6],W=t[7],te=t[8],fe=t[9],xe=t[10],Ve=t[11],We=t[12],yt=t[13],rt=t[14],Pt=t[15],Xt=r[0],hr=r[1],yr=r[2],Nr=r[3];return e[0]=Xt*f+hr*P+yr*te+Nr*We,e[1]=Xt*v+hr*D+yr*fe+Nr*yt,e[2]=Xt*g+hr*Z+yr*xe+Nr*rt,e[3]=Xt*x+hr*W+yr*Ve+Nr*Pt,e[4]=(Xt=r[4])*f+(hr=r[5])*P+(yr=r[6])*te+(Nr=r[7])*We,e[5]=Xt*v+hr*D+yr*fe+Nr*yt,e[6]=Xt*g+hr*Z+yr*xe+Nr*rt,e[7]=Xt*x+hr*W+yr*Ve+Nr*Pt,e[8]=(Xt=r[8])*f+(hr=r[9])*P+(yr=r[10])*te+(Nr=r[11])*We,e[9]=Xt*v+hr*D+yr*fe+Nr*yt,e[10]=Xt*g+hr*Z+yr*xe+Nr*rt,e[11]=Xt*x+hr*W+yr*Ve+Nr*Pt,e[12]=(Xt=r[12])*f+(hr=r[13])*P+(yr=r[14])*te+(Nr=r[15])*We,e[13]=Xt*v+hr*D+yr*fe+Nr*yt,e[14]=Xt*g+hr*Z+yr*xe+Nr*rt,e[15]=Xt*x+hr*W+yr*Ve+Nr*Pt,e}Math.hypot||(Math.hypot=function(){for(var e=arguments,t=0,r=arguments.length;r--;)t+=e[r]*e[r];return Math.sqrt(t)});var Js,Vl=Ka;function Hs(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3];return e[0]=r[0]*f+r[4]*v+r[8]*g+r[12]*x,e[1]=r[1]*f+r[5]*v+r[9]*g+r[13]*x,e[2]=r[2]*f+r[6]*v+r[10]*g+r[14]*x,e[3]=r[3]*f+r[7]*v+r[11]*g+r[15]*x,e}Js=new Oi(3),Oi!=Float32Array&&(Js[0]=0,Js[1]=0,Js[2]=0),function(){var e=new Oi(4);Oi!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}();var ju=(function(){var e=new Oi(2);Oi!=Float32Array&&(e[0]=0,e[1]=0)}(),function(e){function t(r){e.call(this,r,So)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Wr(r)},t.prototype.queryRadius=function(r){var f=r;return Za("circle-radius",this,f)+Za("circle-stroke-width",this,f)+Ui(this.paint.get("circle-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,D,Z){for(var W=ga(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),P.angle,D),te=this.paint.get("circle-radius").evaluate(f,v)+this.paint.get("circle-stroke-width").evaluate(f,v),fe=this.paint.get("circle-pitch-alignment")==="map",xe=fe?W:function(ln,Sn){return ln.map(function(fi){return Vu(fi,Sn)})}(W,Z),Ve=fe?te*D:te,We=0,yt=g;We<yt.length;We+=1)for(var rt=0,Pt=yt[We];rt<Pt.length;rt+=1){var Xt=Pt[rt],hr=fe?Xt:Vu(Xt,Z),yr=Ve,Nr=Hs([],[Xt.x,Xt.y,0,1],Z);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?yr*=Nr[3]/P.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(yr*=P.cameraToCenterDistance/Nr[3]),Un(xe,hr,yr))return!0}return!1},t}(lu));function Vu(e,t){var r=Hs([],[e.x,e.y,0,1],t);return new se(r[0]/r[3],r[1]/r[3])}var Gl=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(Wr);function pl(e,t,r,f){var v=t.width,g=t.height;if(f){if(f instanceof Uint8ClampedArray)f=new Uint8Array(f.buffer);else if(f.length!==v*g*r)throw new RangeError("mismatched image size")}else f=new Uint8Array(v*g*r);return e.width=v,e.height=g,e.data=f,e}function Hl(e,t,r){var f=t.width,v=t.height;if(f!==e.width||v!==e.height){var g=pl({},{width:f,height:v},r);pc(e,g,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,f),height:Math.min(e.height,v)},r),e.width=f,e.height=v,e.data=g.data}}function pc(e,t,r,f,v,g){if(v.width===0||v.height===0)return t;if(v.width>e.width||v.height>e.height||r.x>e.width-v.width||r.y>e.height-v.height)throw new RangeError("out of range source coordinates for image copy");if(v.width>t.width||v.height>t.height||f.x>t.width-v.width||f.y>t.height-v.height)throw new RangeError("out of range destination coordinates for image copy");for(var x=e.data,P=t.data,D=0;D<v.height;D++)for(var Z=((r.y+D)*e.width+r.x)*g,W=((f.y+D)*t.width+f.x)*g,te=0;te<v.width*g;te++)P[W+te]=x[Z+te];return t}Cn("HeatmapBucket",Gl,{omit:["layers"]});var el=function(e,t){pl(this,e,1,t)};el.prototype.resize=function(e){Hl(this,e,1)},el.prototype.clone=function(){return new el({width:this.width,height:this.height},new Uint8Array(this.data))},el.copy=function(e,t,r,f,v){pc(e,t,r,f,v,1)};var hs=function(e,t){pl(this,e,4,t)};hs.prototype.resize=function(e){Hl(this,e,4)},hs.prototype.replace=function(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e},hs.prototype.clone=function(){return new hs({width:this.width,height:this.height},new Uint8Array(this.data))},hs.copy=function(e,t,r,f,v){pc(e,t,r,f,v,4)},Cn("AlphaImage",el),Cn("RGBAImage",hs);var Ff={paint:new zo({"heatmap-radius":new qn(ae.paint_heatmap["heatmap-radius"]),"heatmap-weight":new qn(ae.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ii(ae.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bs(ae.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ii(ae.paint_heatmap["heatmap-opacity"])})};function yf(e){var t={},r=e.resolution||256,f=e.clips?e.clips.length:1,v=e.image||new hs({width:r,height:f}),g=function(Ve,We,yt){t[e.evaluationKey]=yt;var rt=e.expression.evaluate(t);v.data[Ve+We+0]=Math.floor(255*rt.r/rt.a),v.data[Ve+We+1]=Math.floor(255*rt.g/rt.a),v.data[Ve+We+2]=Math.floor(255*rt.b/rt.a),v.data[Ve+We+3]=Math.floor(255*rt.a)};if(e.clips)for(var x=0,P=0;x<f;++x,P+=4*r)for(var D=0,Z=0;D<r;D++,Z+=4){var W=D/(r-1),te=e.clips[x];g(P,Z,te.start*(1-W)+te.end*W)}else for(var fe=0,xe=0;fe<r;fe++,xe+=4)g(0,xe,fe/(r-1));return v}var _f=function(e){function t(r){e.call(this,r,Ff),this._updateColorRamp()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new Gl(r)},t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="heatmap-color"&&this._updateColorRamp()},t.prototype._updateColorRamp=function(){this.colorRamp=yf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},t.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},t}(lu),ah={paint:new zo({"hillshade-illumination-direction":new ii(ae.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ii(ae.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ii(ae.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ii(ae.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ii(ae.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ii(ae.paint_hillshade["hillshade-accent-color"])})},oh=function(e){function t(r){e.call(this,r,ah)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},t}(lu),ef=ba([{name:"a_pos",components:2,type:"Int16"}],4).members,Ac=Bf,gp=Bf;function Bf(e,t,r){r=r||2;var f,v,g,x,P,D,Z,W=t&&t.length,te=W?t[0]*r:e.length,fe=sh(e,0,te,r,!0),xe=[];if(!fe||fe.next===fe.prev)return xe;if(W&&(fe=function(We,yt,rt,Pt){var Xt,hr,yr,Nr=[];for(Xt=0,hr=yt.length;Xt<hr;Xt++)(yr=sh(We,yt[Xt]*Pt,Xt<hr-1?yt[Xt+1]*Pt:We.length,Pt,!1))===yr.next&&(yr.steiner=!0),Nr.push(Sp(yr));for(Nr.sort(xp),Xt=0;Xt<Nr.length;Xt++)Nh(Nr[Xt],rt),rt=dc(rt,rt.next);return rt}(e,t,fe,r)),e.length>80*r){f=g=e[0],v=x=e[1];for(var Ve=r;Ve<te;Ve+=r)(P=e[Ve])<f&&(f=P),(D=e[Ve+1])<v&&(v=D),P>g&&(g=P),D>x&&(x=D);Z=(Z=Math.max(g-f,x-v))!==0?1/Z:0}return tf(fe,xe,r,f,v,Z),xe}function sh(e,t,r,f,v){var g,x;if(v===of(e,t,r,f)>0)for(g=t;g<r;g+=f)x=bf(g,e[g],e[g+1],x);else for(g=r-f;g>=t;g-=f)x=bf(g,e[g],e[g+1],x);return x&&Nf(x,x.next)&&(Tc(x),x=x.next),x}function dc(e,t){if(!e)return e;t||(t=e);var r,f=e;do if(r=!1,f.steiner||!Nf(f,f.next)&&ts(f.prev,f,f.next)!==0)f=f.next;else{if(Tc(f),(f=t=f.prev)===f.next)break;r=!0}while(r||f!==t);return t}function tf(e,t,r,f,v,g,x){if(e){!x&&g&&function(W,te,fe,xe){var Ve=W;do Ve.z===null&&(Ve.z=lh(Ve.x,Ve.y,te,fe,xe)),Ve.prevZ=Ve.prev,Ve.nextZ=Ve.next,Ve=Ve.next;while(Ve!==W);Ve.prevZ.nextZ=null,Ve.prevZ=null,function(We){var yt,rt,Pt,Xt,hr,yr,Nr,ln,Sn=1;do{for(rt=We,We=null,hr=null,yr=0;rt;){for(yr++,Pt=rt,Nr=0,yt=0;yt<Sn&&(Nr++,Pt=Pt.nextZ);yt++);for(ln=Sn;Nr>0||ln>0&&Pt;)Nr!==0&&(ln===0||!Pt||rt.z<=Pt.z)?(Xt=rt,rt=rt.nextZ,Nr--):(Xt=Pt,Pt=Pt.nextZ,ln--),hr?hr.nextZ=Xt:We=Xt,Xt.prevZ=hr,hr=Xt;rt=Pt}hr.nextZ=null,Sn*=2}while(yr>1)}(Ve)}(e,f,v,g);for(var P,D,Z=e;e.prev!==e.next;)if(P=e.prev,D=e.next,g?rf(e,f,v,g):yp(e))t.push(P.i/r),t.push(e.i/r),t.push(D.i/r),Tc(e),e=D.next,Z=D.next;else if((e=D)===Z){x?x===1?tf(e=uh(dc(e),t,r),t,r,f,v,g,2):x===2&&_p(e,t,r,f,v,g):tf(dc(e),t,r,f,v,g,1);break}}}function yp(e){var t=e.prev,r=e,f=e.next;if(ts(t,r,f)>=0)return!1;for(var v=e.next.next;v!==e.prev;){if(nf(t.x,t.y,r.x,r.y,f.x,f.y,v.x,v.y)&&ts(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function rf(e,t,r,f){var v=e.prev,g=e,x=e.next;if(ts(v,g,x)>=0)return!1;for(var P=v.x>g.x?v.x>x.x?v.x:x.x:g.x>x.x?g.x:x.x,D=v.y>g.y?v.y>x.y?v.y:x.y:g.y>x.y?g.y:x.y,Z=lh(v.x<g.x?v.x<x.x?v.x:x.x:g.x<x.x?g.x:x.x,v.y<g.y?v.y<x.y?v.y:x.y:g.y<x.y?g.y:x.y,t,r,f),W=lh(P,D,t,r,f),te=e.prevZ,fe=e.nextZ;te&&te.z>=Z&&fe&&fe.z<=W;){if(te!==e.prev&&te!==e.next&&nf(v.x,v.y,g.x,g.y,x.x,x.y,te.x,te.y)&&ts(te.prev,te,te.next)>=0||(te=te.prevZ,fe!==e.prev&&fe!==e.next&&nf(v.x,v.y,g.x,g.y,x.x,x.y,fe.x,fe.y)&&ts(fe.prev,fe,fe.next)>=0))return!1;fe=fe.nextZ}for(;te&&te.z>=Z;){if(te!==e.prev&&te!==e.next&&nf(v.x,v.y,g.x,g.y,x.x,x.y,te.x,te.y)&&ts(te.prev,te,te.next)>=0)return!1;te=te.prevZ}for(;fe&&fe.z<=W;){if(fe!==e.prev&&fe!==e.next&&nf(v.x,v.y,g.x,g.y,x.x,x.y,fe.x,fe.y)&&ts(fe.prev,fe,fe.next)>=0)return!1;fe=fe.nextZ}return!0}function uh(e,t,r){var f=e;do{var v=f.prev,g=f.next.next;!Nf(v,g)&&zh(v,f,f.next,g)&&Zc(v,g)&&Zc(g,v)&&(t.push(v.i/r),t.push(f.i/r),t.push(g.i/r),Tc(f),Tc(f.next),f=e=g),f=f.next}while(f!==e);return dc(f)}function _p(e,t,r,f,v,g){var x=e;do{for(var P=x.next.next;P!==x.prev;){if(x.i!==P.i&&Ep(x,P)){var D=xf(x,P);return x=dc(x,x.next),D=dc(D,D.next),tf(x,t,r,f,v,g),void tf(D,t,r,f,v,g)}P=P.next}x=x.next}while(x!==e)}function xp(e,t){return e.x-t.x}function Nh(e,t){if(t=function(f,v){var g,x=v,P=f.x,D=f.y,Z=-1/0;do{if(D<=x.y&&D>=x.next.y&&x.next.y!==x.y){var W=x.x+(D-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(W<=P&&W>Z){if(Z=W,W===P){if(D===x.y)return x;if(D===x.next.y)return x.next}g=x.x<x.next.x?x:x.next}}x=x.next}while(x!==v);if(!g)return null;if(P===Z)return g;var te,fe=g,xe=g.x,Ve=g.y,We=1/0;x=g;do P>=x.x&&x.x>=xe&&P!==x.x&&nf(D<Ve?P:Z,D,xe,Ve,D<Ve?Z:P,D,x.x,x.y)&&(te=Math.abs(D-x.y)/(P-x.x),Zc(x,f)&&(te<We||te===We&&(x.x>g.x||x.x===g.x&&bp(g,x)))&&(g=x,We=te)),x=x.next;while(x!==fe);return g}(e,t)){var r=xf(t,e);dc(t,t.next),dc(r,r.next)}}function bp(e,t){return ts(e.prev,e,t.prev)<0&&ts(t.next,e,e.next)<0}function lh(e,t,r,f,v){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*v)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-f)*v)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Sp(e){var t=e,r=e;do(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next;while(t!==e);return r}function nf(e,t,r,f,v,g,x,P){return(v-x)*(t-P)-(e-x)*(g-P)>=0&&(e-x)*(f-P)-(r-x)*(t-P)>=0&&(r-x)*(g-P)-(v-x)*(f-P)>=0}function Ep(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(r,f){var v=r;do{if(v.i!==r.i&&v.next.i!==r.i&&v.i!==f.i&&v.next.i!==f.i&&zh(v,v.next,r,f))return!0;v=v.next}while(v!==r);return!1}(e,t)&&(Zc(e,t)&&Zc(t,e)&&function(r,f){var v=r,g=!1,x=(r.x+f.x)/2,P=(r.y+f.y)/2;do v.y>P!=v.next.y>P&&v.next.y!==v.y&&x<(v.next.x-v.x)*(P-v.y)/(v.next.y-v.y)+v.x&&(g=!g),v=v.next;while(v!==r);return g}(e,t)&&(ts(e.prev,e,t.prev)||ts(e,t.prev,t))||Nf(e,t)&&ts(e.prev,e,e.next)>0&&ts(t.prev,t,t.next)>0)}function ts(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Nf(e,t){return e.x===t.x&&e.y===t.y}function zh(e,t,r,f){var v=Zf(ts(e,t,r)),g=Zf(ts(e,t,f)),x=Zf(ts(r,f,e)),P=Zf(ts(r,f,t));return v!==g&&x!==P||!(v!==0||!zf(e,r,t))||!(g!==0||!zf(e,f,t))||!(x!==0||!zf(r,e,f))||!(P!==0||!zf(r,t,f))}function zf(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Zf(e){return e>0?1:e<0?-1:0}function Zc(e,t){return ts(e.prev,e,e.next)<0?ts(e,t,e.next)>=0&&ts(e,e.prev,t)>=0:ts(e,t,e.prev)<0||ts(e,e.next,t)<0}function xf(e,t){var r=new af(e.i,e.x,e.y),f=new af(t.i,t.x,t.y),v=e.next,g=t.prev;return e.next=t,t.prev=e,r.next=v,v.prev=r,f.next=r,r.prev=f,g.next=f,f.prev=g,f}function bf(e,t,r,f){var v=new af(e,t,r);return f?(v.next=f.next,v.prev=f,f.next.prev=v,f.next=v):(v.prev=v,v.next=v),v}function Tc(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function af(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function of(e,t,r,f){for(var v=0,g=t,x=r-f;g<r;g+=f)v+=(e[x]-e[g])*(e[g+1]+e[x+1]),x=g;return v}function Uf(e,t,r,f,v){(function g(x,P,D,Z,W){for(;Z>D;){if(Z-D>600){var te=Z-D+1,fe=P-D+1,xe=Math.log(te),Ve=.5*Math.exp(2*xe/3),We=.5*Math.sqrt(xe*Ve*(te-Ve)/te)*(fe-te/2<0?-1:1);g(x,P,Math.max(D,Math.floor(P-fe*Ve/te+We)),Math.min(Z,Math.floor(P+(te-fe)*Ve/te+We)),W)}var yt=x[P],rt=D,Pt=Z;for(Pc(x,D,P),W(x[Z],yt)>0&&Pc(x,D,Z);rt<Pt;){for(Pc(x,rt,Pt),rt++,Pt--;W(x[rt],yt)<0;)rt++;for(;W(x[Pt],yt)>0;)Pt--}W(x[D],yt)===0?Pc(x,D,Pt):Pc(x,++Pt,Z),Pt<=P&&(D=Pt+1),P<=Pt&&(Z=Pt-1)}})(e,t,r||0,f||e.length-1,v||ch)}function Pc(e,t,r){var f=e[t];e[t]=e[r],e[r]=f}function ch(e,t){return e<t?-1:e>t?1:0}function sf(e,t){var r=e.length;if(r<=1)return[e];for(var f,v,g=[],x=0;x<r;x++){var P=xr(e[x]);P!==0&&(e[x].area=Math.abs(P),v===void 0&&(v=P<0),v===P<0?(f&&g.push(f),f=[e[x]]):f.push(e[x]))}if(f&&g.push(f),t>1)for(var D=0;D<g.length;D++)g[D].length<=t||(Uf(g[D],t,1,g[D].length-1,jf),g[D]=g[D].slice(0,t));return g}function jf(e,t){return t.area-e.area}function uf(e,t,r){for(var f=r.patternDependencies,v=!1,g=0,x=t;g<x.length;g+=1){var P=x[g].paint.get(e+"-pattern");P.isConstant()||(v=!0);var D=P.constantOr(null);D&&(v=!0,f[D.to]=!0,f[D.from]=!0)}return v}function Uc(e,t,r,f,v){for(var g=v.patternDependencies,x=0,P=t;x<P.length;x+=1){var D=P[x],Z=D.paint.get(e+"-pattern").value;if(Z.kind!=="constant"){var W=Z.evaluate({zoom:f-1},r,{},v.availableImages),te=Z.evaluate({zoom:f},r,{},v.availableImages),fe=Z.evaluate({zoom:f+1},r,{},v.availableImages);te=te&&te.name?te.name:te,fe=fe&&fe.name?fe.name:fe,g[W=W&&W.name?W.name:W]=!0,g[te]=!0,g[fe]=!0,r.patterns[D.id]={min:W,mid:te,max:fe}}}return r}Bf.deviation=function(e,t,r,f){var v=t&&t.length,g=Math.abs(of(e,0,v?t[0]*r:e.length,r));if(v)for(var x=0,P=t.length;x<P;x++)g-=Math.abs(of(e,t[x]*r,x<P-1?t[x+1]*r:e.length,r));var D=0;for(x=0;x<f.length;x+=3){var Z=f[x]*r,W=f[x+1]*r,te=f[x+2]*r;D+=Math.abs((e[Z]-e[te])*(e[W+1]-e[Z+1])-(e[Z]-e[W])*(e[te+1]-e[Z+1]))}return g===0&&D===0?0:Math.abs((D-g)/g)},Bf.flatten=function(e){for(var t=e[0][0].length,r={vertices:[],holes:[],dimensions:t},f=0,v=0;v<e.length;v++){for(var g=0;g<e[v].length;g++)for(var x=0;x<t;x++)r.vertices.push(e[v][g][x]);v>0&&r.holes.push(f+=e[v-1].length)}return r},Ac.default=gp;var Ru=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Po,this.indexArray=new qu,this.indexArray2=new Lu,this.programConfigurations=new O(e.layers,e.zoom),this.segments=new Ce,this.segments2=new Ce,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};Ru.prototype.populate=function(e,t,r){this.hasPattern=uf("fill",this.layers,t);for(var f=this.layers[0].layout.get("fill-sort-key"),v=[],g=0,x=e;g<x.length;g+=1){var P=x[g],D=P.feature,Z=P.id,W=P.index,te=P.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,xe=St(D,fe);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),xe,r)){var Ve=f?f.evaluate(xe,{},r,t.availableImages):void 0,We={id:Z,properties:D.properties,type:D.type,sourceLayerIndex:te,index:W,geometry:fe?xe.geometry:Mt(D),patterns:{},sortKey:Ve};v.push(We)}}f&&v.sort(function(ln,Sn){return ln.sortKey-Sn.sortKey});for(var yt=0,rt=v;yt<rt.length;yt+=1){var Pt=rt[yt],Xt=Pt.geometry,hr=Pt.index,yr=Pt.sourceLayerIndex;if(this.hasPattern){var Nr=Uc("fill",this.layers,Pt,this.zoom,t);this.patternFeatures.push(Nr)}else this.addFeature(Pt,Xt,hr,r,{});t.featureIndex.insert(e[hr].feature,Xt,hr,yr,this.index)}},Ru.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Ru.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Ru.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ru.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ru.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ef),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0},Ru.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},Ru.prototype.addFeature=function(e,t,r,f,v){for(var g=0,x=sf(t,500);g<x.length;g+=1){for(var P=x[g],D=0,Z=0,W=P;Z<W.length;Z+=1)D+=W[Z].length;for(var te=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray),fe=te.vertexLength,xe=[],Ve=[],We=0,yt=P;We<yt.length;We+=1){var rt=yt[We];if(rt.length!==0){rt!==P[0]&&Ve.push(xe.length/2);var Pt=this.segments2.prepareSegment(rt.length,this.layoutVertexArray,this.indexArray2),Xt=Pt.vertexLength;this.layoutVertexArray.emplaceBack(rt[0].x,rt[0].y),this.indexArray2.emplaceBack(Xt+rt.length-1,Xt),xe.push(rt[0].x),xe.push(rt[0].y);for(var hr=1;hr<rt.length;hr++)this.layoutVertexArray.emplaceBack(rt[hr].x,rt[hr].y),this.indexArray2.emplaceBack(Xt+hr-1,Xt+hr),xe.push(rt[hr].x),xe.push(rt[hr].y);Pt.vertexLength+=rt.length,Pt.primitiveLength+=rt.length}}for(var yr=Ac(xe,Ve),Nr=0;Nr<yr.length;Nr+=3)this.indexArray.emplaceBack(fe+yr[Nr],fe+yr[Nr+1],fe+yr[Nr+2]);te.vertexLength+=D,te.primitiveLength+=yr.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Cn("FillBucket",Ru,{omit:["layers","patternFeatures"]});var lf=new zo({"fill-sort-key":new qn(ae.layout_fill["fill-sort-key"])}),Sf={paint:new zo({"fill-antialias":new ii(ae.paint_fill["fill-antialias"]),"fill-opacity":new qn(ae.paint_fill["fill-opacity"]),"fill-color":new qn(ae.paint_fill["fill-color"]),"fill-outline-color":new qn(ae.paint_fill["fill-outline-color"]),"fill-translate":new ii(ae.paint_fill["fill-translate"]),"fill-translate-anchor":new ii(ae.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ul(ae.paint_fill["fill-pattern"])}),layout:lf},Ef=function(e){function t(r){e.call(this,r,Sf)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f);var v=this.paint._values["fill-outline-color"];v.value.kind==="constant"&&v.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},t.prototype.createBucket=function(r){return new Ru(r)},t.prototype.queryRadius=function(){return Ui(this.paint.get("fill-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,D){return ci(ga(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),P.angle,D),g)},t.prototype.isTileClipped=function(){return!0},t}(lu),fh=ba([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,cf=tl;function tl(e,t,r,f,v){this.properties={},this.extent=r,this.type=0,this._pbf=e,this._geometry=-1,this._keys=f,this._values=v,e.readFields(Zh,this,t)}function Zh(e,t,r){e==1?t.id=r.readVarint():e==2?function(f,v){for(var g=f.readVarint()+f.pos;f.pos<g;){var x=v._keys[f.readVarint()],P=v._values[f.readVarint()];v.properties[x]=P}}(r,t):e==3?t.type=r.readVarint():e==4&&(t._geometry=r.pos)}function hh(e){for(var t,r,f=0,v=0,g=e.length,x=g-1;v<g;x=v++)f+=((r=e[x]).x-(t=e[v]).x)*(t.y+r.y);return f}tl.types=["Unknown","Point","LineString","Polygon"],tl.prototype.loadGeometry=function(){var e=this._pbf;e.pos=this._geometry;for(var t,r=e.readVarint()+e.pos,f=1,v=0,g=0,x=0,P=[];e.pos<r;){if(v<=0){var D=e.readVarint();f=7&D,v=D>>3}if(v--,f===1||f===2)g+=e.readSVarint(),x+=e.readSVarint(),f===1&&(t&&P.push(t),t=[]),t.push(new se(g,x));else{if(f!==7)throw new Error("unknown command "+f);t&&t.push(t[0].clone())}}return t&&P.push(t),P},tl.prototype.bbox=function(){var e=this._pbf;e.pos=this._geometry;for(var t=e.readVarint()+e.pos,r=1,f=0,v=0,g=0,x=1/0,P=-1/0,D=1/0,Z=-1/0;e.pos<t;){if(f<=0){var W=e.readVarint();r=7&W,f=W>>3}if(f--,r===1||r===2)(v+=e.readSVarint())<x&&(x=v),v>P&&(P=v),(g+=e.readSVarint())<D&&(D=g),g>Z&&(Z=g);else if(r!==7)throw new Error("unknown command "+r)}return[x,D,P,Z]},tl.prototype.toGeoJSON=function(e,t,r){var f,v,g=this.extent*Math.pow(2,r),x=this.extent*e,P=this.extent*t,D=this.loadGeometry(),Z=tl.types[this.type];function W(xe){for(var Ve=0;Ve<xe.length;Ve++){var We=xe[Ve];xe[Ve]=[360*(We.x+x)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(We.y+P)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var te=[];for(f=0;f<D.length;f++)te[f]=D[f][0];W(D=te);break;case 2:for(f=0;f<D.length;f++)W(D[f]);break;case 3:for(D=function(xe){var Ve=xe.length;if(Ve<=1)return[xe];for(var We,yt,rt=[],Pt=0;Pt<Ve;Pt++){var Xt=hh(xe[Pt]);Xt!==0&&(yt===void 0&&(yt=Xt<0),yt===Xt<0?(We&&rt.push(We),We=[xe[Pt]]):We.push(xe[Pt]))}return We&&rt.push(We),rt}(D),f=0;f<D.length;f++)for(v=0;v<D[f].length;v++)W(D[f][v])}D.length===1?D=D[0]:Z="Multi"+Z;var fe={type:"Feature",geometry:{type:Z,coordinates:D},properties:this.properties};return"id"in this&&(fe.id=this.id),fe};var Uh=jh;function jh(e,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Cp,this,t),this.length=this._features.length}function Cp(e,t,r){e===15?t.version=r.readVarint():e===1?t.name=r.readString():e===5?t.extent=r.readVarint():e===2?t._features.push(r.pos):e===3?t._keys.push(r.readString()):e===4&&t._values.push(function(f){for(var v=null,g=f.readVarint()+f.pos;f.pos<g;){var x=f.readVarint()>>3;v=x===1?f.readString():x===2?f.readFloat():x===3?f.readDouble():x===4?f.readVarint64():x===5?f.readVarint():x===6?f.readSVarint():x===7?f.readBoolean():null}return v}(r))}function Mc(e,t,r){if(e===3){var f=new Uh(r,r.readVarint()+r.pos);f.length&&(t[f.name]=f)}}jh.prototype.feature=function(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];var t=this._pbf.readVarint()+this._pbf.pos;return new cf(this._pbf,t,this.extent,this._keys,this._values)};var jc={VectorTile:function(e,t){this.layers=e.readFields(Mc,{},t)},VectorTileFeature:cf,VectorTileLayer:Uh},Vh=jc.VectorTileFeature.types,Vf=Math.pow(2,13);function ff(e,t,r,f,v,g,x,P){e.emplaceBack(t,r,2*Math.floor(f*Vf)+x,v*Vf*2,g*Vf*2,Math.round(P))}var dl=function(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(t){return t.id}),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Gs,this.indexArray=new qu,this.programConfigurations=new O(e.layers,e.zoom),this.segments=new Ce,this.stateDependentLayerIds=this.layers.filter(function(t){return t.isStateDependent()}).map(function(t){return t.id})};function wp(e,t){return e.x===t.x&&(e.x<0||e.x>8192)||e.y===t.y&&(e.y<0||e.y>8192)}dl.prototype.populate=function(e,t,r){this.features=[],this.hasPattern=uf("fill-extrusion",this.layers,t);for(var f=0,v=e;f<v.length;f+=1){var g=v[f],x=g.feature,P=g.id,D=g.index,Z=g.sourceLayerIndex,W=this.layers[0]._featureFilter.needGeometry,te=St(x,W);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),te,r)){var fe={id:P,sourceLayerIndex:Z,index:D,geometry:W?te.geometry:Mt(x),properties:x.properties,type:x.type,patterns:{}};this.hasPattern?this.features.push(Uc("fill-extrusion",this.layers,fe,this.zoom,t)):this.addFeature(fe,fe.geometry,D,r,{}),t.featureIndex.insert(x,fe.geometry,D,Z,this.index,!0)}}},dl.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.features;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},dl.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},dl.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},dl.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},dl.prototype.upload=function(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,fh),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},dl.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},dl.prototype.addFeature=function(e,t,r,f,v){for(var g=0,x=sf(t,500);g<x.length;g+=1){for(var P=x[g],D=0,Z=0,W=P;Z<W.length;Z+=1)D+=W[Z].length;for(var te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),fe=0,xe=P;fe<xe.length;fe+=1){var Ve=xe[fe];if(Ve.length!==0&&!((ma=Ve).every(function(Ki){return Ki.x<0})||ma.every(function(Ki){return Ki.x>8192})||ma.every(function(Ki){return Ki.y<0})||ma.every(function(Ki){return Ki.y>8192})))for(var We=0,yt=0;yt<Ve.length;yt++){var rt=Ve[yt];if(yt>=1){var Pt=Ve[yt-1];if(!wp(rt,Pt)){te.vertexLength+4>Ce.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var Xt=rt.sub(Pt)._perp()._unit(),hr=Pt.dist(rt);We+hr>32768&&(We=0),ff(this.layoutVertexArray,rt.x,rt.y,Xt.x,Xt.y,0,0,We),ff(this.layoutVertexArray,rt.x,rt.y,Xt.x,Xt.y,0,1,We),ff(this.layoutVertexArray,Pt.x,Pt.y,Xt.x,Xt.y,0,0,We+=hr),ff(this.layoutVertexArray,Pt.x,Pt.y,Xt.x,Xt.y,0,1,We);var yr=te.vertexLength;this.indexArray.emplaceBack(yr,yr+2,yr+1),this.indexArray.emplaceBack(yr+1,yr+2,yr+3),te.vertexLength+=4,te.primitiveLength+=2}}}}if(te.vertexLength+D>Ce.MAX_VERTEX_ARRAY_LENGTH&&(te=this.segments.prepareSegment(D,this.layoutVertexArray,this.indexArray)),Vh[e.type]==="Polygon"){for(var Nr=[],ln=[],Sn=te.vertexLength,fi=0,Zn=P;fi<Zn.length;fi+=1){var di=Zn[fi];if(di.length!==0){di!==P[0]&&ln.push(Nr.length/2);for(var Gn=0;Gn<di.length;Gn++){var ra=di[Gn];ff(this.layoutVertexArray,ra.x,ra.y,0,0,1,1,0),Nr.push(ra.x),Nr.push(ra.y)}}}for(var ki=Ac(Nr,ln),ri=0;ri<ki.length;ri+=3)this.indexArray.emplaceBack(Sn+ki[ri],Sn+ki[ri+2],Sn+ki[ri+1]);te.primitiveLength+=ki.length/3,te.vertexLength+=D}}var ma;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Cn("FillExtrusionBucket",dl,{omit:["layers","features"]});var Wl={paint:new zo({"fill-extrusion-opacity":new ii(ae["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new qn(ae["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ii(ae["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ii(ae["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ul(ae["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new qn(ae["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new qn(ae["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ii(ae["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Gh=function(e){function t(r){e.call(this,r,Wl)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.createBucket=function(r){return new dl(r)},t.prototype.queryRadius=function(){return Ui(this.paint.get("fill-extrusion-translate"))},t.prototype.is3D=function(){return!0},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,D,Z){var W=ga(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),P.angle,D),te=this.paint.get("fill-extrusion-height").evaluate(f,v),fe=this.paint.get("fill-extrusion-base").evaluate(f,v),xe=function(We,yt,rt,Pt){for(var Xt=[],hr=0,yr=We;hr<yr.length;hr+=1){var Nr=yr[hr],ln=[Nr.x,Nr.y,0,1];Hs(ln,ln,yt),Xt.push(new se(ln[0]/ln[3],ln[1]/ln[3]))}return Xt}(W,Z),Ve=function(We,yt,rt,Pt){for(var Xt=[],hr=[],yr=Pt[8]*yt,Nr=Pt[9]*yt,ln=Pt[10]*yt,Sn=Pt[11]*yt,fi=Pt[8]*rt,Zn=Pt[9]*rt,di=Pt[10]*rt,Gn=Pt[11]*rt,ra=0,ki=We;ra<ki.length;ra+=1){for(var ri=[],ma=[],Ki=0,wa=ki[ra];Ki<wa.length;Ki+=1){var mi=wa[Ki],ka=mi.x,Oo=mi.y,$o=Pt[0]*ka+Pt[4]*Oo+Pt[12],Uo=Pt[1]*ka+Pt[5]*Oo+Pt[13],Eo=Pt[2]*ka+Pt[6]*Oo+Pt[14],is=Pt[3]*ka+Pt[7]*Oo+Pt[15],As=Eo+ln,Ts=is+Sn,hu=$o+fi,Ps=Uo+Zn,qs=Eo+di,Ua=is+Gn,Ms=new se(($o+yr)/Ts,(Uo+Nr)/Ts);Ms.z=As/Ts,ri.push(Ms);var oa=new se(hu/Ua,Ps/Ua);oa.z=qs/Ua,ma.push(oa)}Xt.push(ri),hr.push(ma)}return[Xt,hr]}(g,fe,te,Z);return function(We,yt,rt){var Pt=1/0;ci(rt,yt)&&(Pt=Yl(rt,yt[0]));for(var Xt=0;Xt<yt.length;Xt++)for(var hr=yt[Xt],yr=We[Xt],Nr=0;Nr<hr.length-1;Nr++){var ln=hr[Nr],Sn=[ln,hr[Nr+1],yr[Nr+1],yr[Nr],ln];Xn(rt,Sn)&&(Pt=Math.min(Pt,Yl(rt,Sn)))}return Pt!==1/0&&Pt}(Ve[0],Ve[1],xe)},t}(lu);function Xl(e,t){return e.x*t.x+e.y*t.y}function Yl(e,t){if(e.length===1){for(var r,f=0,v=t[f++];!r||v.equals(r);)if(!(r=t[f++]))return 1/0;for(;f<t.length;f++){var g=t[f],x=e[0],P=r.sub(v),D=g.sub(v),Z=x.sub(v),W=Xl(P,P),te=Xl(P,D),fe=Xl(D,D),xe=Xl(Z,P),Ve=Xl(Z,D),We=W*fe-te*te,yt=(fe*xe-te*Ve)/We,rt=(W*Ve-te*xe)/We,Pt=v.z*(1-yt-rt)+r.z*yt+g.z*rt;if(isFinite(Pt))return Pt}return 1/0}for(var Xt=1/0,hr=0,yr=t;hr<yr.length;hr+=1)Xt=Math.min(Xt,yr[hr].z);return Xt}var hf=ba([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,ph=ba([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Gf=jc.VectorTileFeature.types,dh=Math.cos(Math.PI/180*37.5),Es=Math.pow(2,14)/.5,Wo=function(e){var t=this;this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(r){return r.id}),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(r){t.gradients[r.id]={}}),this.layoutVertexArray=new Ss,this.layoutVertexArray2=new hl,this.indexArray=new qu,this.programConfigurations=new O(e.layers,e.zoom),this.segments=new Ce,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(r){return r.isStateDependent()}).map(function(r){return r.id})};Wo.prototype.populate=function(e,t,r){this.hasPattern=uf("line",this.layers,t);for(var f=this.layers[0].layout.get("line-sort-key"),v=[],g=0,x=e;g<x.length;g+=1){var P=x[g],D=P.feature,Z=P.id,W=P.index,te=P.sourceLayerIndex,fe=this.layers[0]._featureFilter.needGeometry,xe=St(D,fe);if(this.layers[0]._featureFilter.filter(new ea(this.zoom),xe,r)){var Ve=f?f.evaluate(xe,{},r):void 0,We={id:Z,properties:D.properties,type:D.type,sourceLayerIndex:te,index:W,geometry:fe?xe.geometry:Mt(D),patterns:{},sortKey:Ve};v.push(We)}}f&&v.sort(function(ln,Sn){return ln.sortKey-Sn.sortKey});for(var yt=0,rt=v;yt<rt.length;yt+=1){var Pt=rt[yt],Xt=Pt.geometry,hr=Pt.index,yr=Pt.sourceLayerIndex;if(this.hasPattern){var Nr=Uc("line",this.layers,Pt,this.zoom,t);this.patternFeatures.push(Nr)}else this.addFeature(Pt,Xt,hr,r,{});t.featureIndex.insert(e[hr].feature,Xt,hr,yr,this.index)}},Wo.prototype.update=function(e,t,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,t,this.stateDependentLayers,r)},Wo.prototype.addFeatures=function(e,t,r){for(var f=0,v=this.patternFeatures;f<v.length;f+=1){var g=v[f];this.addFeature(g,g.geometry,g.index,t,r)}},Wo.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Wo.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Wo.prototype.upload=function(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,ph)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,hf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0},Wo.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Wo.prototype.lineFeatureClips=function(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}},Wo.prototype.addFeature=function(e,t,r,f,v){var g=this.layers[0].layout,x=g.get("line-join").evaluate(e,{}),P=g.get("line-cap"),D=g.get("line-miter-limit"),Z=g.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(var W=0,te=t;W<te.length;W+=1)this.addLine(te[W],e,x,P,D,Z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,v,f)},Wo.prototype.addLine=function(e,t,r,f,v,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var x=0;x<e.length-1;x++)this.totalDistance+=e[x].dist(e[x+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var P=Gf[t.type]==="Polygon",D=e.length;D>=2&&e[D-1].equals(e[D-2]);)D--;for(var Z=0;Z<D-1&&e[Z].equals(e[Z+1]);)Z++;if(!(D<(P?3:2))){r==="bevel"&&(v=1.05);var W,te=this.overscaling<=16?122880/(512*this.overscaling):0,fe=this.segments.prepareSegment(10*D,this.layoutVertexArray,this.indexArray),xe=void 0,Ve=void 0,We=void 0,yt=void 0;this.e1=this.e2=-1,P&&(yt=e[Z].sub(W=e[D-2])._unit()._perp());for(var rt=Z;rt<D;rt++)if(!(Ve=rt===D-1?P?e[Z+1]:void 0:e[rt+1])||!e[rt].equals(Ve)){yt&&(We=yt),W&&(xe=W),W=e[rt],yt=Ve?Ve.sub(W)._unit()._perp():We;var Pt=(We=We||yt).add(yt);Pt.x===0&&Pt.y===0||Pt._unit();var Xt=We.x*yt.x+We.y*yt.y,hr=Pt.x*yt.x+Pt.y*yt.y,yr=hr!==0?1/hr:1/0,Nr=2*Math.sqrt(2-2*hr),ln=hr<dh&&xe&&Ve,Sn=We.x*yt.y-We.y*yt.x>0;if(ln&&rt>Z){var fi=W.dist(xe);if(fi>2*te){var Zn=W.sub(W.sub(xe)._mult(te/fi)._round());this.updateDistance(xe,Zn),this.addCurrentVertex(Zn,We,0,0,fe),xe=Zn}}var di=xe&&Ve,Gn=di?r:P?"butt":f;if(di&&Gn==="round"&&(yr<g?Gn="miter":yr<=2&&(Gn="fakeround")),Gn==="miter"&&yr>v&&(Gn="bevel"),Gn==="bevel"&&(yr>2&&(Gn="flipbevel"),yr<v&&(Gn="miter")),xe&&this.updateDistance(xe,W),Gn==="miter")Pt._mult(yr),this.addCurrentVertex(W,Pt,0,0,fe);else if(Gn==="flipbevel"){if(yr>100)Pt=yt.mult(-1);else{var ra=yr*We.add(yt).mag()/We.sub(yt).mag();Pt._perp()._mult(ra*(Sn?-1:1))}this.addCurrentVertex(W,Pt,0,0,fe),this.addCurrentVertex(W,Pt.mult(-1),0,0,fe)}else if(Gn==="bevel"||Gn==="fakeround"){var ki=-Math.sqrt(yr*yr-1),ri=Sn?ki:0,ma=Sn?0:ki;if(xe&&this.addCurrentVertex(W,We,ri,ma,fe),Gn==="fakeround")for(var Ki=Math.round(180*Nr/Math.PI/20),wa=1;wa<Ki;wa++){var mi=wa/Ki;if(mi!==.5){var ka=mi-.5;mi+=mi*ka*(mi-1)*((1.0904+Xt*(Xt*(3.55645-1.43519*Xt)-3.2452))*ka*ka+(.848013+Xt*(.215638*Xt-1.06021)))}var Oo=yt.sub(We)._mult(mi)._add(We)._unit()._mult(Sn?-1:1);this.addHalfVertex(W,Oo.x,Oo.y,!1,Sn,0,fe)}Ve&&this.addCurrentVertex(W,yt,-ri,-ma,fe)}else if(Gn==="butt")this.addCurrentVertex(W,Pt,0,0,fe);else if(Gn==="square"){var $o=xe?1:-1;this.addCurrentVertex(W,Pt,$o,$o,fe)}else Gn==="round"&&(xe&&(this.addCurrentVertex(W,We,0,0,fe),this.addCurrentVertex(W,We,1,1,fe,!0)),Ve&&(this.addCurrentVertex(W,yt,-1,-1,fe,!0),this.addCurrentVertex(W,yt,0,0,fe)));if(ln&&rt<D-1){var Uo=W.dist(Ve);if(Uo>2*te){var Eo=W.add(Ve.sub(W)._mult(te/Uo)._round());this.updateDistance(W,Eo),this.addCurrentVertex(Eo,yt,0,0,fe),W=Eo}}}}},Wo.prototype.addCurrentVertex=function(e,t,r,f,v,g){g===void 0&&(g=!1);var x=t.y*f-t.x,P=-t.y-t.x*f;this.addHalfVertex(e,t.x+t.y*r,t.y-t.x*r,g,!1,r,v),this.addHalfVertex(e,x,P,g,!0,-f,v),this.distance>Es/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,t,r,f,v,g))},Wo.prototype.addHalfVertex=function(e,t,r,f,v,g,x){var P=.5*(this.lineClips?this.scaledDistance*(Es-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e.x<<1)+(f?1:0),(e.y<<1)+(v?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(g===0?0:g<0?-1:1)|(63&P)<<2,P>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var D=x.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),x.primitiveLength++),v?this.e2=D:this.e1=D},Wo.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Wo.prototype.updateDistance=function(e,t){this.distance+=e.dist(t),this.updateScaledDistance()},Cn("LineBucket",Wo,{omit:["layers","patternFeatures"]});var ps=new zo({"line-cap":new ii(ae.layout_line["line-cap"]),"line-join":new qn(ae.layout_line["line-join"]),"line-miter-limit":new ii(ae.layout_line["line-miter-limit"]),"line-round-limit":new ii(ae.layout_line["line-round-limit"]),"line-sort-key":new qn(ae.layout_line["line-sort-key"])}),wu={paint:new zo({"line-opacity":new qn(ae.paint_line["line-opacity"]),"line-color":new qn(ae.paint_line["line-color"]),"line-translate":new ii(ae.paint_line["line-translate"]),"line-translate-anchor":new ii(ae.paint_line["line-translate-anchor"]),"line-width":new qn(ae.paint_line["line-width"]),"line-gap-width":new qn(ae.paint_line["line-gap-width"]),"line-offset":new qn(ae.paint_line["line-offset"]),"line-blur":new qn(ae.paint_line["line-blur"]),"line-dasharray":new es(ae.paint_line["line-dasharray"]),"line-pattern":new Ul(ae.paint_line["line-pattern"]),"line-gradient":new Bs(ae.paint_line["line-gradient"])}),layout:ps},vh=new(function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.possiblyEvaluate=function(r,f){return f=new ea(Math.floor(f.zoom),{now:f.now,fadeDuration:f.fadeDuration,zoomHistory:f.zoomHistory,transition:f.transition}),e.prototype.possiblyEvaluate.call(this,r,f)},t.prototype.evaluate=function(r,f,v,g){return f=Yt({},f,{zoom:Math.floor(f.zoom)}),e.prototype.evaluate.call(this,r,f,v,g)},t}(qn))(wu.paint.properties["line-width"].specification);vh.useIntegerZoom=!0;var Hh=function(e){function t(r){e.call(this,r,wu),this.gradientVersion=0}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype._handleSpecialPaintPropertyUpdate=function(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Is,this.gradientVersion=(this.gradientVersion+1)%Je)},t.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},t.prototype.recalculate=function(r,f){e.prototype.recalculate.call(this,r,f),this.paint._values["line-floorwidth"]=vh.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)},t.prototype.createBucket=function(r){return new Wo(r)},t.prototype.queryRadius=function(r){var f=r,v=mh(Za("line-width",this,f),Za("line-gap-width",this,f)),g=Za("line-offset",this,f);return v/2+Math.abs(g)+Ui(this.paint.get("line-translate"))},t.prototype.queryIntersectsFeature=function(r,f,v,g,x,P,D){var Z=ga(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),P.angle,D),W=D/2*mh(this.paint.get("line-width").evaluate(f,v),this.paint.get("line-gap-width").evaluate(f,v)),te=this.paint.get("line-offset").evaluate(f,v);return te&&(g=function(fe,xe){for(var Ve=[],We=new se(0,0),yt=0;yt<fe.length;yt++){for(var rt=fe[yt],Pt=[],Xt=0;Xt<rt.length;Xt++){var hr=rt[Xt],yr=rt[Xt+1],Nr=Xt===0?We:hr.sub(rt[Xt-1])._unit()._perp(),ln=Xt===rt.length-1?We:yr.sub(hr)._unit()._perp(),Sn=Nr._add(ln)._unit();Sn._mult(1/(Sn.x*ln.x+Sn.y*ln.y)),Pt.push(Sn._mult(xe)._add(hr))}Ve.push(Pt)}return Ve}(g,te*D)),function(fe,xe,Ve){for(var We=0;We<xe.length;We++){var yt=xe[We];if(fe.length>=3){for(var rt=0;rt<yt.length;rt++)if(Ca(fe,yt[rt]))return!0}if(vi(fe,yt,Ve))return!0}return!1}(Z,g,W)},t.prototype.isTileClipped=function(){return!0},t}(lu);function mh(e,t){return t>0?t+2*e:e}var Wh=ba([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Xh=ba([{name:"a_projected_pos",components:3,type:"Float32"}],4),Yh=(ba([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),ba([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Kh=(ba([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),ba([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ap=ba([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Tp(e,t,r){return e.sections.forEach(function(f){f.text=function(v,g,x){var P=g.layout.get("text-transform").evaluate(x,{});return P==="uppercase"?v=v.toLocaleUpperCase():P==="lowercase"&&(v=v.toLocaleLowerCase()),Fs.applyArabicShaping&&(v=Fs.applyArabicShaping(v)),v}(f.text,t,r)}),e}ba([{name:"triangle",components:3,type:"Uint16"}]),ba([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),ba([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),ba([{type:"Float32",name:"offsetX"}]),ba([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Cf={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},$h=function(e,t,r,f,v){var g,x,P=8*v-f-1,D=(1<<P)-1,Z=D>>1,W=-7,te=r?v-1:0,fe=r?-1:1,xe=e[t+te];for(te+=fe,g=xe&(1<<-W)-1,xe>>=-W,W+=P;W>0;g=256*g+e[t+te],te+=fe,W-=8);for(x=g&(1<<-W)-1,g>>=-W,W+=f;W>0;x=256*x+e[t+te],te+=fe,W-=8);if(g===0)g=1-Z;else{if(g===D)return x?NaN:1/0*(xe?-1:1);x+=Math.pow(2,f),g-=Z}return(xe?-1:1)*x*Math.pow(2,g-f)},Hf=function(e,t,r,f,v,g){var x,P,D,Z=8*g-v-1,W=(1<<Z)-1,te=W>>1,fe=v===23?Math.pow(2,-24)-Math.pow(2,-77):0,xe=f?0:g-1,Ve=f?1:-1,We=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(P=isNaN(t)?1:0,x=W):(x=Math.floor(Math.log(t)/Math.LN2),t*(D=Math.pow(2,-x))<1&&(x--,D*=2),(t+=x+te>=1?fe/D:fe*Math.pow(2,1-te))*D>=2&&(x++,D/=2),x+te>=W?(P=0,x=W):x+te>=1?(P=(t*D-1)*Math.pow(2,v),x+=te):(P=t*Math.pow(2,te-1)*Math.pow(2,v),x=0));v>=8;e[r+xe]=255&P,xe+=Ve,P/=256,v-=8);for(x=x<<v|P,Z+=v;Z>0;e[r+xe]=255&x,xe+=Ve,x/=256,Z-=8);e[r+xe-Ve]|=128*We},wf=ao;function ao(e){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(e)?e:new Uint8Array(e||0),this.pos=0,this.type=0,this.length=this.buf.length}ao.Varint=0,ao.Fixed64=1,ao.Bytes=2,ao.Fixed32=5;var gh=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Kl(e){return e.type===ao.Bytes?e.readVarint()+e.pos:e.pos+1}function Ic(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function yh(e,t,r){var f=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(f);for(var v=r.pos-1;v>=e;v--)r.buf[v+f]=r.buf[v]}function z(e,t){for(var r=0;r<e.length;r++)t.writeVarint(e[r])}function Ie(e,t){for(var r=0;r<e.length;r++)t.writeSVarint(e[r])}function qe(e,t){for(var r=0;r<e.length;r++)t.writeFloat(e[r])}function ar(e,t){for(var r=0;r<e.length;r++)t.writeDouble(e[r])}function Br(e,t){for(var r=0;r<e.length;r++)t.writeBoolean(e[r])}function rr(e,t){for(var r=0;r<e.length;r++)t.writeFixed32(e[r])}function Mr(e,t){for(var r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Gr(e,t){for(var r=0;r<e.length;r++)t.writeFixed64(e[r])}function $r(e,t){for(var r=0;r<e.length;r++)t.writeSFixed64(e[r])}function tn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+16777216*e[t+3]}function rn(e,t,r){e[r]=t,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24}function sn(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16)+(e[t+3]<<24)}function yn(e,t,r){e===1&&r.readMessage(Qr,t)}function Qr(e,t,r){if(e===3){var f=r.readMessage(un,{}),v=f.width,g=f.height,x=f.left,P=f.top,D=f.advance;t.push({id:f.id,bitmap:new el({width:v+6,height:g+6},f.bitmap),metrics:{width:v,height:g,left:x,top:P,advance:D}})}}function un(e,t,r){e===1?t.id=r.readVarint():e===2?t.bitmap=r.readBytes():e===3?t.width=r.readVarint():e===4?t.height=r.readVarint():e===5?t.left=r.readSVarint():e===6?t.top=r.readSVarint():e===7&&(t.advance=r.readVarint())}function Bt(e){for(var t=0,r=0,f=0,v=e;f<v.length;f+=1){var g=v[f];t+=g.w*g.h,r=Math.max(r,g.w)}e.sort(function(We,yt){return yt.h-We.h});for(var x=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}],P=0,D=0,Z=0,W=e;Z<W.length;Z+=1)for(var te=W[Z],fe=x.length-1;fe>=0;fe--){var xe=x[fe];if(!(te.w>xe.w||te.h>xe.h)){if(te.x=xe.x,te.y=xe.y,D=Math.max(D,te.y+te.h),P=Math.max(P,te.x+te.w),te.w===xe.w&&te.h===xe.h){var Ve=x.pop();fe<x.length&&(x[fe]=Ve)}else te.h===xe.h?(xe.x+=te.w,xe.w-=te.w):te.w===xe.w?(xe.y+=te.h,xe.h-=te.h):(x.push({x:xe.x+te.w,y:xe.y,w:xe.w-te.w,h:te.h}),xe.y+=te.h,xe.h-=te.h);break}}return{w:P,h:D,fill:t/(P*D)||0}}ao.prototype={destroy:function(){this.buf=null},readFields:function(e,t,r){for(r=r||this.length;this.pos<r;){var f=this.readVarint(),v=f>>3,g=this.pos;this.type=7&f,e(v,t,this),this.pos===g&&this.skip(f)}return t},readMessage:function(e,t){return this.readFields(e,t,this.readVarint()+this.pos)},readFixed32:function(){var e=tn(this.buf,this.pos);return this.pos+=4,e},readSFixed32:function(){var e=sn(this.buf,this.pos);return this.pos+=4,e},readFixed64:function(){var e=tn(this.buf,this.pos)+4294967296*tn(this.buf,this.pos+4);return this.pos+=8,e},readSFixed64:function(){var e=tn(this.buf,this.pos)+4294967296*sn(this.buf,this.pos+4);return this.pos+=8,e},readFloat:function(){var e=$h(this.buf,this.pos,!0,23,4);return this.pos+=4,e},readDouble:function(){var e=$h(this.buf,this.pos,!0,52,8);return this.pos+=8,e},readVarint:function(e){var t,r,f=this.buf;return t=127&(r=f[this.pos++]),r<128?t:(t|=(127&(r=f[this.pos++]))<<7,r<128?t:(t|=(127&(r=f[this.pos++]))<<14,r<128?t:(t|=(127&(r=f[this.pos++]))<<21,r<128?t:function(v,g,x){var P,D,Z=x.buf;if(P=(112&(D=Z[x.pos++]))>>4,D<128||(P|=(127&(D=Z[x.pos++]))<<3,D<128)||(P|=(127&(D=Z[x.pos++]))<<10,D<128)||(P|=(127&(D=Z[x.pos++]))<<17,D<128)||(P|=(127&(D=Z[x.pos++]))<<24,D<128)||(P|=(1&(D=Z[x.pos++]))<<31,D<128))return Ic(v,P,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(r=f[this.pos]))<<28,e,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var e=this.readVarint();return e%2==1?(e+1)/-2:e/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&gh?function(r,f,v){return gh.decode(r.subarray(f,v))}(this.buf,t,e):function(r,f,v){for(var g="",x=f;x<v;){var P,D,Z,W=r[x],te=null,fe=W>239?4:W>223?3:W>191?2:1;if(x+fe>v)break;fe===1?W<128&&(te=W):fe===2?(192&(P=r[x+1]))==128&&(te=(31&W)<<6|63&P)<=127&&(te=null):fe===3?(D=r[x+2],(192&(P=r[x+1]))==128&&(192&D)==128&&((te=(15&W)<<12|(63&P)<<6|63&D)<=2047||te>=55296&&te<=57343)&&(te=null)):fe===4&&(D=r[x+2],Z=r[x+3],(192&(P=r[x+1]))==128&&(192&D)==128&&(192&Z)==128&&((te=(15&W)<<18|(63&P)<<12|(63&D)<<6|63&Z)<=65535||te>=1114112)&&(te=null)),te===null?(te=65533,fe=1):te>65535&&(te-=65536,g+=String.fromCharCode(te>>>10&1023|55296),te=56320|1023&te),g+=String.fromCharCode(te),x+=fe}return g}(this.buf,t,e)},readBytes:function(){var e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t},readPackedVarint:function(e,t){if(this.type!==ao.Bytes)return e.push(this.readVarint(t));var r=Kl(this);for(e=e||[];this.pos<r;)e.push(this.readVarint(t));return e},readPackedSVarint:function(e){if(this.type!==ao.Bytes)return e.push(this.readSVarint());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readSVarint());return e},readPackedBoolean:function(e){if(this.type!==ao.Bytes)return e.push(this.readBoolean());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readBoolean());return e},readPackedFloat:function(e){if(this.type!==ao.Bytes)return e.push(this.readFloat());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readFloat());return e},readPackedDouble:function(e){if(this.type!==ao.Bytes)return e.push(this.readDouble());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readDouble());return e},readPackedFixed32:function(e){if(this.type!==ao.Bytes)return e.push(this.readFixed32());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed32());return e},readPackedSFixed32:function(e){if(this.type!==ao.Bytes)return e.push(this.readSFixed32());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed32());return e},readPackedFixed64:function(e){if(this.type!==ao.Bytes)return e.push(this.readFixed64());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readFixed64());return e},readPackedSFixed64:function(e){if(this.type!==ao.Bytes)return e.push(this.readSFixed64());var t=Kl(this);for(e=e||[];this.pos<t;)e.push(this.readSFixed64());return e},skip:function(e){var t=7&e;if(t===ao.Varint)for(;this.buf[this.pos++]>127;);else if(t===ao.Bytes)this.pos=this.readVarint()+this.pos;else if(t===ao.Fixed32)this.pos+=4;else{if(t!==ao.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(e,t){this.writeVarint(e<<3|t)},realloc:function(e){for(var t=this.length||16;t<this.pos+e;)t*=2;if(t!==this.length){var r=new Uint8Array(t);r.set(this.buf),this.buf=r,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(e){this.realloc(4),rn(this.buf,e,this.pos),this.pos+=4},writeSFixed32:function(e){this.realloc(4),rn(this.buf,e,this.pos),this.pos+=4},writeFixed64:function(e){this.realloc(8),rn(this.buf,-1&e,this.pos),rn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(e){this.realloc(8),rn(this.buf,-1&e,this.pos),rn(this.buf,Math.floor(e*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(e){(e=+e||0)>268435455||e<0?function(t,r){var f,v;if(t>=0?(f=t%4294967296|0,v=t/4294967296|0):(v=~(-t/4294967296),4294967295^(f=~(-t%4294967296))?f=f+1|0:(f=0,v=v+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");r.realloc(10),function(g,x,P){P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,g>>>=7,P.buf[P.pos++]=127&g|128,P.buf[P.pos]=127&(g>>>=7)}(f,0,r),function(g,x){var P=(7&g)<<4;x.buf[x.pos++]|=P|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))}(v,r)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))},writeSVarint:function(e){this.writeVarint(e<0?2*-e-1:2*e)},writeBoolean:function(e){this.writeVarint(Boolean(e))},writeString:function(e){e=String(e),this.realloc(4*e.length),this.pos++;var t=this.pos;this.pos=function(f,v,g){for(var x,P,D=0;D<v.length;D++){if((x=v.charCodeAt(D))>55295&&x<57344){if(!P){x>56319||D+1===v.length?(f[g++]=239,f[g++]=191,f[g++]=189):P=x;continue}if(x<56320){f[g++]=239,f[g++]=191,f[g++]=189,P=x;continue}x=P-55296<<10|x-56320|65536,P=null}else P&&(f[g++]=239,f[g++]=191,f[g++]=189,P=null);x<128?f[g++]=x:(x<2048?f[g++]=x>>6|192:(x<65536?f[g++]=x>>12|224:(f[g++]=x>>18|240,f[g++]=x>>12&63|128),f[g++]=x>>6&63|128),f[g++]=63&x|128)}return g}(this.buf,e,this.pos);var r=this.pos-t;r>=128&&yh(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r},writeFloat:function(e){this.realloc(4),Hf(this.buf,e,this.pos,!0,23,4),this.pos+=4},writeDouble:function(e){this.realloc(8),Hf(this.buf,e,this.pos,!0,52,8),this.pos+=8},writeBytes:function(e){var t=e.length;this.writeVarint(t),this.realloc(t);for(var r=0;r<t;r++)this.buf[this.pos++]=e[r]},writeRawMessage:function(e,t){this.pos++;var r=this.pos;e(t,this);var f=this.pos-r;f>=128&&yh(r,f,this),this.pos=r-1,this.writeVarint(f),this.pos+=f},writeMessage:function(e,t,r){this.writeTag(e,ao.Bytes),this.writeRawMessage(t,r)},writePackedVarint:function(e,t){t.length&&this.writeMessage(e,z,t)},writePackedSVarint:function(e,t){t.length&&this.writeMessage(e,Ie,t)},writePackedBoolean:function(e,t){t.length&&this.writeMessage(e,Br,t)},writePackedFloat:function(e,t){t.length&&this.writeMessage(e,qe,t)},writePackedDouble:function(e,t){t.length&&this.writeMessage(e,ar,t)},writePackedFixed32:function(e,t){t.length&&this.writeMessage(e,rr,t)},writePackedSFixed32:function(e,t){t.length&&this.writeMessage(e,Mr,t)},writePackedFixed64:function(e,t){t.length&&this.writeMessage(e,Gr,t)},writePackedSFixed64:function(e,t){t.length&&this.writeMessage(e,$r,t)},writeBytesField:function(e,t){this.writeTag(e,ao.Bytes),this.writeBytes(t)},writeFixed32Field:function(e,t){this.writeTag(e,ao.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(e,t){this.writeTag(e,ao.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(e,t){this.writeTag(e,ao.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(e,t){this.writeTag(e,ao.Fixed64),this.writeSFixed64(t)},writeVarintField:function(e,t){this.writeTag(e,ao.Varint),this.writeVarint(t)},writeSVarintField:function(e,t){this.writeTag(e,ao.Varint),this.writeSVarint(t)},writeStringField:function(e,t){this.writeTag(e,ao.Bytes),this.writeString(t)},writeFloatField:function(e,t){this.writeTag(e,ao.Fixed32),this.writeFloat(t)},writeDoubleField:function(e,t){this.writeTag(e,ao.Fixed64),this.writeDouble(t)},writeBooleanField:function(e,t){this.writeVarintField(e,Boolean(t))}};var gr=function(e,t){var r=t.pixelRatio,f=t.version,v=t.stretchX,g=t.stretchY,x=t.content;this.paddedRect=e,this.pixelRatio=r,this.stretchX=v,this.stretchY=g,this.content=x,this.version=f},qr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};qr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},qr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},qr.tlbr.get=function(){return this.tl.concat(this.br)},qr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(gr.prototype,qr);var Ln=function(e,t){var r={},f={};this.haveRenderCallbacks=[];var v=[];this.addImages(e,r,v),this.addImages(t,f,v);var g=Bt(v),x=new hs({width:g.w||1,height:g.h||1});for(var P in e){var D=e[P],Z=r[P].paddedRect;hs.copy(D.data,x,{x:0,y:0},{x:Z.x+1,y:Z.y+1},D.data)}for(var W in t){var te=t[W],fe=f[W].paddedRect,xe=fe.x+1,Ve=fe.y+1,We=te.data.width,yt=te.data.height;hs.copy(te.data,x,{x:0,y:0},{x:xe,y:Ve},te.data),hs.copy(te.data,x,{x:0,y:yt-1},{x:xe,y:Ve-1},{width:We,height:1}),hs.copy(te.data,x,{x:0,y:0},{x:xe,y:Ve+yt},{width:We,height:1}),hs.copy(te.data,x,{x:We-1,y:0},{x:xe-1,y:Ve},{width:1,height:yt}),hs.copy(te.data,x,{x:0,y:0},{x:xe+We,y:Ve},{width:1,height:yt})}this.image=x,this.iconPositions=r,this.patternPositions=f};Ln.prototype.addImages=function(e,t,r){for(var f in e){var v=e[f],g={x:0,y:0,w:v.data.width+2,h:v.data.height+2};r.push(g),t[f]=new gr(g,v),v.hasRenderCallback&&this.haveRenderCallbacks.push(f)}},Ln.prototype.patchUpdatedImages=function(e,t){for(var r in e.dispatchRenderCallbacks(this.haveRenderCallbacks),e.updatedImages)this.patchUpdatedImage(this.iconPositions[r],e.getImage(r),t),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r),t)},Ln.prototype.patchUpdatedImage=function(e,t,r){if(e&&t&&e.version!==t.version){e.version=t.version;var f=e.tl;r.update(t.data,void 0,{x:f[0],y:f[1]})}},Cn("ImagePosition",gr),Cn("ImageAtlas",Ln);var Rr={horizontal:1,vertical:2,horizontalOnly:3},wn=function(){this.scale=1,this.fontStack="",this.imageName=null};wn.forText=function(e,t){var r=new wn;return r.scale=e||1,r.fontStack=t,r},wn.forImage=function(e){var t=new wn;return t.imageName=e,t};var cn=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function pi(e,t,r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We){var yt,rt=cn.fromFeature(e,v);te===Rr.vertical&&rt.verticalizePunctuation();var Pt=Fs.processBidirectionalText,Xt=Fs.processStyledBidirectionalText;if(Pt&&rt.sections.length===1){yt=[];for(var hr=0,yr=Pt(rt.toString(),Tn(rt,Z,g,t,f,xe,Ve));hr<yr.length;hr+=1){var Nr=yr[hr],ln=new cn;ln.text=Nr,ln.sections=rt.sections;for(var Sn=0;Sn<Nr.length;Sn++)ln.sectionIndex.push(0);yt.push(ln)}}else if(Xt){yt=[];for(var fi=0,Zn=Xt(rt.text,rt.sectionIndex,Tn(rt,Z,g,t,f,xe,Ve));fi<Zn.length;fi+=1){var di=Zn[fi],Gn=new cn;Gn.text=di[0],Gn.sectionIndex=di[1],Gn.sections=rt.sections,yt.push(Gn)}}else yt=function(ri,ma){for(var Ki=[],wa=ri.text,mi=0,ka=0,Oo=ma;ka<Oo.length;ka+=1){var $o=Oo[ka];Ki.push(ri.substring(mi,$o)),mi=$o}return mi<wa.length&&Ki.push(ri.substring(mi,wa.length)),Ki}(rt,Tn(rt,Z,g,t,f,xe,Ve));var ra=[],ki={positionedLines:ra,text:rt.toString(),top:W[1],bottom:W[1],left:W[0],right:W[0],writingMode:te,iconsInText:!1,verticalizable:!1};return function(ri,ma,Ki,wa,mi,ka,Oo,$o,Uo,Eo,is,As){for(var Ts=0,hu=-17,Ps=0,qs=0,Ua=$o==="right"?1:$o==="left"?0:.5,Ms=0,oa=0,yo=mi;oa<yo.length;oa+=1){var Ja=yo[oa];Ja.trim();var Oa=Ja.getMaxScale(),Gu=24*(Oa-1),Zs={positionedGlyphs:[],lineOffset:0};ri.positionedLines[Ms]=Zs;var oo=Zs.positionedGlyphs,as=0;if(Ja.length()){for(var eu=0;eu<Ja.length();eu++){var Fa=Ja.getSection(eu),Hu=Ja.getSectionIndex(eu),Wu=Ja.getCharCode(eu),Ll=0,os=null,Oc=null,Du=null,Yf=24,Pf=!(Uo===Rr.horizontal||!is&&!Ec(Wu)||is&&(kr[Wu]||(vc=Wu,xn.Arabic(vc)||xn["Arabic Supplement"](vc)||xn["Arabic Extended-A"](vc)||xn["Arabic Presentation Forms-A"](vc)||xn["Arabic Presentation Forms-B"](vc))));if(Fa.imageName){var Sh=wa[Fa.imageName];if(!Sh)continue;Du=Fa.imageName,ri.iconsInText=ri.iconsInText||!0,Oc=Sh.paddedRect;var df=Sh.displaySize;Fa.scale=24*Fa.scale/As,Ll=Gu+(24-df[1]*Fa.scale),Yf=(os={width:df[0],height:df[1],left:1,top:-3,advance:Pf?df[1]:df[0]}).advance;var Eh=Pf?df[0]*Fa.scale-24*Oa:df[1]*Fa.scale-24*Oa;Eh>0&&Eh>as&&(as=Eh)}else{var Pp=Ki[Fa.fontStack],Ch=Pp&&Pp[Wu];if(Ch&&Ch.rect)Oc=Ch.rect,os=Ch.metrics;else{var qh=ma[Fa.fontStack],Mp=qh&&qh[Wu];if(!Mp)continue;os=Mp.metrics}Ll=24*(Oa-Fa.scale)}Pf?(ri.verticalizable=!0,oo.push({glyph:Wu,imageName:Du,x:Ts,y:hu+Ll,vertical:Pf,scale:Fa.scale,fontStack:Fa.fontStack,sectionIndex:Hu,metrics:os,rect:Oc}),Ts+=Yf*Fa.scale+Eo):(oo.push({glyph:Wu,imageName:Du,x:Ts,y:hu+Ll,vertical:Pf,scale:Fa.scale,fontStack:Fa.fontStack,sectionIndex:Hu,metrics:os,rect:Oc}),Ts+=os.advance*Fa.scale+Eo)}oo.length!==0&&(Ps=Math.max(Ts-Eo,Ps),Bi(oo,0,oo.length-1,Ua,as)),Ts=0;var wh=ka*Oa+as;Zs.lineOffset=Math.max(as,Gu),hu+=wh,qs=Math.max(wh,qs),++Ms}else hu+=ka,++Ms}var vc,ep=hu- -17,Mf=ji(Oo),vf=Mf.horizontalAlign,Ah=Mf.verticalAlign;(function(Th,tp,rp,Kf,np,ip,mf,Ph,Ip){var Jl,Mh=(tp-rp)*np;Jl=ip!==mf?-Ph*Kf- -17:(-Kf*Ip+.5)*mf;for(var Wc=0,Ih=Th;Wc<Ih.length;Wc+=1)for(var If=0,Lc=Ih[Wc].positionedGlyphs;If<Lc.length;If+=1){var $f=Lc[If];$f.x+=Mh,$f.y+=Jl}})(ri.positionedLines,Ua,vf,Ah,Ps,qs,ka,ep,mi.length),ri.top+=-Ah*ep,ri.bottom=ri.top+ep,ri.left+=-vf*Ps,ri.right=ri.left+Ps}(ki,t,r,f,yt,x,P,D,te,Z,fe,We),!function(ri){for(var ma=0,Ki=ri;ma<Ki.length;ma+=1)if(Ki[ma].positionedGlyphs.length!==0)return!1;return!0}(ra)&&ki}cn.fromFeature=function(e,t){for(var r=new cn,f=0;f<e.sections.length;f++){var v=e.sections[f];v.image?r.addImageSection(v):r.addTextSection(v,t)}return r},cn.prototype.length=function(){return this.text.length},cn.prototype.getSection=function(e){return this.sections[this.sectionIndex[e]]},cn.prototype.getSectionIndex=function(e){return this.sectionIndex[e]},cn.prototype.getCharCode=function(e){return this.text.charCodeAt(e)},cn.prototype.verticalizePunctuation=function(){this.text=function(e){for(var t="",r=0;r<e.length;r++){var f=e.charCodeAt(r+1)||null,v=e.charCodeAt(r-1)||null;t+=f&&js(f)&&!Cf[e[r+1]]||v&&js(v)&&!Cf[e[r-1]]||!Cf[e[r]]?e[r]:Cf[e[r]]}return t}(this.text)},cn.prototype.trim=function(){for(var e=0,t=0;t<this.text.length&&kr[this.text.charCodeAt(t)];t++)e++;for(var r=this.text.length,f=this.text.length-1;f>=0&&f>=e&&kr[this.text.charCodeAt(f)];f--)r--;this.text=this.text.substring(e,r),this.sectionIndex=this.sectionIndex.slice(e,r)},cn.prototype.substring=function(e,t){var r=new cn;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r},cn.prototype.toString=function(){return this.text},cn.prototype.getMaxScale=function(){var e=this;return this.sectionIndex.reduce(function(t,r){return Math.max(t,e.sections[r].scale)},0)},cn.prototype.addTextSection=function(e,t){this.text+=e.text,this.sections.push(wn.forText(e.scale,e.fontStack||t));for(var r=this.sections.length-1,f=0;f<e.text.length;++f)this.sectionIndex.push(r)},cn.prototype.addImageSection=function(e){var t=e.image?e.image.name:"";if(t.length!==0){var r=this.getNextImageSectionCharCode();r?(this.text+=String.fromCharCode(r),this.sections.push(wn.forImage(t)),this.sectionIndex.push(this.sections.length-1)):Xe("Reached maximum number of images 6401")}else Xe("Can't add FormattedSection with an empty image.")},cn.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var kr={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ar={};function Kn(e,t,r,f,v,g){if(t.imageName){var x=f[t.imageName];return x?x.displaySize[0]*t.scale*24/g+v:0}var P=r[t.fontStack],D=P&&P[e];return D?D.metrics.advance*t.scale+v:0}function bn(e,t,r,f){var v=Math.pow(e-t,2);return f?e<t?v/2:2*v:v+Math.abs(r)*r}function an(e,t,r){var f=0;return e===10&&(f-=1e4),r&&(f+=150),e!==40&&e!==65288||(f+=50),t!==41&&t!==65289||(f+=50),f}function An(e,t,r,f,v,g){for(var x=null,P=bn(t,r,v,g),D=0,Z=f;D<Z.length;D+=1){var W=Z[D],te=bn(t-W.x,r,v,g)+W.badness;te<=P&&(x=W,P=te)}return{index:e,x:t,priorBreak:x,badness:P}}function Tn(e,t,r,f,v,g,x){if(g!=="point")return[];if(!e)return[];for(var P,D=[],Z=function(yt,rt,Pt,Xt,hr,yr){for(var Nr=0,ln=0;ln<yt.length();ln++){var Sn=yt.getSection(ln);Nr+=Kn(yt.getCharCode(ln),Sn,Xt,hr,rt,yr)}return Nr/Math.max(1,Math.ceil(Nr/Pt))}(e,t,r,f,v,x),W=e.text.indexOf("\u200B")>=0,te=0,fe=0;fe<e.length();fe++){var xe=e.getSection(fe),Ve=e.getCharCode(fe);if(kr[Ve]||(te+=Kn(Ve,xe,f,v,t,x)),fe<e.length()-1){var We=!((P=Ve)<11904||!(xn["Bopomofo Extended"](P)||xn.Bopomofo(P)||xn["CJK Compatibility Forms"](P)||xn["CJK Compatibility Ideographs"](P)||xn["CJK Compatibility"](P)||xn["CJK Radicals Supplement"](P)||xn["CJK Strokes"](P)||xn["CJK Symbols and Punctuation"](P)||xn["CJK Unified Ideographs Extension A"](P)||xn["CJK Unified Ideographs"](P)||xn["Enclosed CJK Letters and Months"](P)||xn["Halfwidth and Fullwidth Forms"](P)||xn.Hiragana(P)||xn["Ideographic Description Characters"](P)||xn["Kangxi Radicals"](P)||xn["Katakana Phonetic Extensions"](P)||xn.Katakana(P)||xn["Vertical Forms"](P)||xn["Yi Radicals"](P)||xn["Yi Syllables"](P)));(Ar[Ve]||We||xe.imageName)&&D.push(An(fe+1,te,Z,D,an(Ve,e.getCharCode(fe+1),We&&W),!1))}}return function yt(rt){return rt?yt(rt.priorBreak).concat(rt.index):[]}(An(e.length(),te,Z,D,0,!0))}function ji(e){var t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function Bi(e,t,r,f,v){if(f||v)for(var g=e[r],x=(e[r].x+g.metrics.advance*g.scale)*f,P=t;P<=r;P++)e[P].x-=x,e[P].y+=v}function Mn(e,t,r,f,v,g){var x,P=e.image;if(P.content){var D=P.content,Z=P.pixelRatio||1;x=[D[0]/Z,D[1]/Z,P.displaySize[0]-D[2]/Z,P.displaySize[1]-D[3]/Z]}var W,te,fe,xe,Ve=t.left*g,We=t.right*g;r==="width"||r==="both"?(xe=v[0]+Ve-f[3],te=v[0]+We+f[1]):te=(xe=v[0]+(Ve+We-P.displaySize[0])/2)+P.displaySize[0];var yt=t.top*g,rt=t.bottom*g;return r==="height"||r==="both"?(W=v[1]+yt-f[0],fe=v[1]+rt+f[2]):fe=(W=v[1]+(yt+rt-P.displaySize[1])/2)+P.displaySize[1],{image:P,top:W,right:te,bottom:fe,left:xe,collisionPadding:x}}Ar[10]=!0,Ar[32]=!0,Ar[38]=!0,Ar[40]=!0,Ar[41]=!0,Ar[43]=!0,Ar[45]=!0,Ar[47]=!0,Ar[173]=!0,Ar[183]=!0,Ar[8203]=!0,Ar[8208]=!0,Ar[8211]=!0,Ar[8231]=!0;var Pn=function(e){function t(r,f,v,g){e.call(this,r,f),this.angle=v,g!==void 0&&(this.segment=g)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.clone=function(){return new t(this.x,this.y,this.angle,this.segment)},t}(se);function wi(e,t){var r=t.expression;if(r.kind==="constant")return{kind:"constant",layoutSize:r.evaluate(new ea(e+1))};if(r.kind==="source")return{kind:"source"};for(var f=r.zoomStops,v=r.interpolationType,g=0;g<f.length&&f[g]<=e;)g++;for(var x=g=Math.max(0,g-1);x<f.length&&f[x]<e+1;)x++;x=Math.min(f.length-1,x);var P=f[g],D=f[x];return r.kind==="composite"?{kind:"composite",minZoom:P,maxZoom:D,interpolationType:v}:{kind:"camera",minZoom:P,maxZoom:D,minSize:r.evaluate(new ea(P)),maxSize:r.evaluate(new ea(D)),interpolationType:v}}function Di(e,t,r){var f=t.uSize,v=r.lowerSize;return e.kind==="source"?v/128:e.kind==="composite"?Ta(v/128,r.upperSize/128,t.uSizeT):f}function la(e,t){var r=0,f=0;if(e.kind==="constant")f=e.layoutSize;else if(e.kind!=="source"){var v=e.interpolationType,g=v?Ir(Oe.interpolationFactor(v,t,e.minZoom,e.maxZoom),0,1):0;e.kind==="camera"?f=Ta(e.minSize,e.maxSize,g):r=g}return{uSizeT:r,uSize:f}}Cn("Anchor",Pn);var Mo=Object.freeze({__proto__:null,getSizeData:wi,evaluateSizeForFeature:Di,evaluateSizeForZoom:la,SIZE_PACK_FACTOR:128});function Io(e,t,r,f,v){if(t.segment===void 0)return!0;for(var g=t,x=t.segment+1,P=0;P>-r/2;){if(--x<0)return!1;P-=e[x].dist(g),g=e[x]}P+=e[x].dist(e[x+1]),x++;for(var D=[],Z=0;P<r/2;){var W=e[x],te=e[x+1];if(!te)return!1;var fe=e[x-1].angleTo(W)-W.angleTo(te);for(fe=Math.abs((fe+3*Math.PI)%(2*Math.PI)-Math.PI),D.push({distance:P,angleDelta:fe}),Z+=fe;P-D[0].distance>f;)Z-=D.shift().angleDelta;if(Z>v)return!1;x++,P+=W.dist(te)}return!0}function ca(e){for(var t=0,r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function Ns(e,t,r){return e?.6*t*r:0}function mo(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function ds(e,t,r,f,v,g){for(var x=Ns(r,v,g),P=mo(r,f)*g,D=0,Z=ca(e)/2,W=0;W<e.length-1;W++){var te=e[W],fe=e[W+1],xe=te.dist(fe);if(D+xe>Z){var Ve=(Z-D)/xe,We=Ta(te.x,fe.x,Ve),yt=Ta(te.y,fe.y,Ve),rt=new Pn(We,yt,fe.angleTo(te),W);return rt._round(),!x||Io(e,rt,P,x,t)?rt:void 0}D+=xe}}function Xo(e,t,r,f,v,g,x,P,D){var Z=Ns(f,g,x),W=mo(f,v),te=W*x,fe=e[0].x===0||e[0].x===D||e[0].y===0||e[0].y===D;return t-te<t/4&&(t=te+t/4),function xe(Ve,We,yt,rt,Pt,Xt,hr,yr,Nr){for(var ln=Xt/2,Sn=ca(Ve),fi=0,Zn=We-yt,di=[],Gn=0;Gn<Ve.length-1;Gn++){for(var ra=Ve[Gn],ki=Ve[Gn+1],ri=ra.dist(ki),ma=ki.angleTo(ra);Zn+yt<fi+ri;){var Ki=((Zn+=yt)-fi)/ri,wa=Ta(ra.x,ki.x,Ki),mi=Ta(ra.y,ki.y,Ki);if(wa>=0&&wa<Nr&&mi>=0&&mi<Nr&&Zn-ln>=0&&Zn+ln<=Sn){var ka=new Pn(wa,mi,ma,Gn);ka._round(),rt&&!Io(Ve,ka,Xt,rt,Pt)||di.push(ka)}}fi+=ri}return yr||di.length||hr||(di=xe(Ve,fi/2,yt,rt,Pt,Xt,hr,!0,Nr)),di}(e,fe?t/2*P%t:(W/2+2*g)*x*P%t,t,Z,r,te,fe,!1,D)}function Cs(e,t,r,f,v){for(var g=[],x=0;x<e.length;x++)for(var P=e[x],D=void 0,Z=0;Z<P.length-1;Z++){var W=P[Z],te=P[Z+1];W.x<t&&te.x<t||(W.x<t?W=new se(t,W.y+(t-W.x)/(te.x-W.x)*(te.y-W.y))._round():te.x<t&&(te=new se(t,W.y+(t-W.x)/(te.x-W.x)*(te.y-W.y))._round()),W.y<r&&te.y<r||(W.y<r?W=new se(W.x+(r-W.y)/(te.y-W.y)*(te.x-W.x),r)._round():te.y<r&&(te=new se(W.x+(r-W.y)/(te.y-W.y)*(te.x-W.x),r)._round()),W.x>=f&&te.x>=f||(W.x>=f?W=new se(f,W.y+(f-W.x)/(te.x-W.x)*(te.y-W.y))._round():te.x>=f&&(te=new se(f,W.y+(f-W.x)/(te.x-W.x)*(te.y-W.y))._round()),W.y>=v&&te.y>=v||(W.y>=v?W=new se(W.x+(v-W.y)/(te.y-W.y)*(te.x-W.x),v)._round():te.y>=v&&(te=new se(W.x+(v-W.y)/(te.y-W.y)*(te.x-W.x),v)._round()),D&&W.equals(D[D.length-1])||g.push(D=[W]),D.push(te)))))}return g}function zs(e,t,r,f){var v=[],g=e.image,x=g.pixelRatio,P=g.paddedRect.w-2,D=g.paddedRect.h-2,Z=e.right-e.left,W=e.bottom-e.top,te=g.stretchX||[[0,P]],fe=g.stretchY||[[0,D]],xe=function(wa,mi){return wa+mi[1]-mi[0]},Ve=te.reduce(xe,0),We=fe.reduce(xe,0),yt=P-Ve,rt=D-We,Pt=0,Xt=Ve,hr=0,yr=We,Nr=0,ln=yt,Sn=0,fi=rt;if(g.content&&f){var Zn=g.content;Pt=ws(te,0,Zn[0]),hr=ws(fe,0,Zn[1]),Xt=ws(te,Zn[0],Zn[2]),yr=ws(fe,Zn[1],Zn[3]),Nr=Zn[0]-Pt,Sn=Zn[1]-hr,ln=Zn[2]-Zn[0]-Xt,fi=Zn[3]-Zn[1]-yr}var di=function(wa,mi,ka,Oo){var $o=Hi(wa.stretch-Pt,Xt,Z,e.left),Uo=Ko(wa.fixed-Nr,ln,wa.stretch,Ve),Eo=Hi(mi.stretch-hr,yr,W,e.top),is=Ko(mi.fixed-Sn,fi,mi.stretch,We),As=Hi(ka.stretch-Pt,Xt,Z,e.left),Ts=Ko(ka.fixed-Nr,ln,ka.stretch,Ve),hu=Hi(Oo.stretch-hr,yr,W,e.top),Ps=Ko(Oo.fixed-Sn,fi,Oo.stretch,We),qs=new se($o,Eo),Ua=new se(As,Eo),Ms=new se(As,hu),oa=new se($o,hu),yo=new se(Uo/x,is/x),Ja=new se(Ts/x,Ps/x),Oa=t*Math.PI/180;if(Oa){var Gu=Math.sin(Oa),Zs=Math.cos(Oa),oo=[Zs,-Gu,Gu,Zs];qs._matMult(oo),Ua._matMult(oo),oa._matMult(oo),Ms._matMult(oo)}var as=wa.stretch+wa.fixed,eu=mi.stretch+mi.fixed;return{tl:qs,tr:Ua,bl:oa,br:Ms,tex:{x:g.paddedRect.x+1+as,y:g.paddedRect.y+1+eu,w:ka.stretch+ka.fixed-as,h:Oo.stretch+Oo.fixed-eu},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:yo,pixelOffsetBR:Ja,minFontScaleX:ln/x/Z,minFontScaleY:fi/x/W,isSDF:r}};if(f&&(g.stretchX||g.stretchY))for(var Gn=Yo(te,yt,Ve),ra=Yo(fe,rt,We),ki=0;ki<Gn.length-1;ki++)for(var ri=Gn[ki],ma=Gn[ki+1],Ki=0;Ki<ra.length-1;Ki++)v.push(di(ri,ra[Ki],ma,ra[Ki+1]));else v.push(di({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:P+1},{fixed:0,stretch:D+1}));return v}function ws(e,t,r){for(var f=0,v=0,g=e;v<g.length;v+=1){var x=g[v];f+=Math.max(t,Math.min(r,x[1]))-Math.max(t,Math.min(r,x[0]))}return f}function Yo(e,t,r){for(var f=[{fixed:-1,stretch:0}],v=0,g=e;v<g.length;v+=1){var x=g[v],P=x[0],D=x[1],Z=f[f.length-1];f.push({fixed:P-Z.stretch,stretch:Z.stretch}),f.push({fixed:P-Z.stretch,stretch:Z.stretch+(D-P)})}return f.push({fixed:t+1,stretch:r}),f}function Hi(e,t,r,f){return e/t*r+f}function Ko(e,t,r,f){return e-t*r/f}var Ma=function(e,t,r,f,v,g,x,P,D,Z){if(this.boxStartIndex=e.length,D){var W=g.top,te=g.bottom,fe=g.collisionPadding;fe&&(W-=fe[1],te+=fe[3]);var xe=te-W;xe>0&&(xe=Math.max(10,xe),this.circleDiameter=xe)}else{var Ve=g.top*x-P,We=g.bottom*x+P,yt=g.left*x-P,rt=g.right*x+P,Pt=g.collisionPadding;if(Pt&&(yt-=Pt[0]*x,Ve-=Pt[1]*x,rt+=Pt[2]*x,We+=Pt[3]*x),Z){var Xt=new se(yt,Ve),hr=new se(rt,Ve),yr=new se(yt,We),Nr=new se(rt,We),ln=Z*Math.PI/180;Xt._rotate(ln),hr._rotate(ln),yr._rotate(ln),Nr._rotate(ln),yt=Math.min(Xt.x,hr.x,yr.x,Nr.x),rt=Math.max(Xt.x,hr.x,yr.x,Nr.x),Ve=Math.min(Xt.y,hr.y,yr.y,Nr.y),We=Math.max(Xt.y,hr.y,yr.y,Nr.y)}e.emplaceBack(t.x,t.y,yt,Ve,rt,We,r,f,v)}this.boxEndIndex=e.length},Zo=function(e,t){if(e===void 0&&(e=[]),t===void 0&&(t=Li),this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function Li(e,t){return e<t?-1:e>t?1:0}function va(e,t,r){t===void 0&&(t=1),r===void 0&&(r=!1);for(var f=1/0,v=1/0,g=-1/0,x=-1/0,P=e[0],D=0;D<P.length;D++){var Z=P[D];(!D||Z.x<f)&&(f=Z.x),(!D||Z.y<v)&&(v=Z.y),(!D||Z.x>g)&&(g=Z.x),(!D||Z.y>x)&&(x=Z.y)}var W=Math.min(g-f,x-v),te=W/2,fe=new Zo([],fo);if(W===0)return new se(f,v);for(var xe=f;xe<g;xe+=W)for(var Ve=v;Ve<x;Ve+=W)fe.push(new go(xe+te,Ve+te,te,e));for(var We=function(Pt){for(var Xt=0,hr=0,yr=0,Nr=Pt[0],ln=0,Sn=Nr.length,fi=Sn-1;ln<Sn;fi=ln++){var Zn=Nr[ln],di=Nr[fi],Gn=Zn.x*di.y-di.x*Zn.y;hr+=(Zn.x+di.x)*Gn,yr+=(Zn.y+di.y)*Gn,Xt+=3*Gn}return new go(hr/Xt,yr/Xt,0,Pt)}(e),yt=fe.length;fe.length;){var rt=fe.pop();(rt.d>We.d||!We.d)&&(We=rt,r&&console.log("found best %d after %d probes",Math.round(1e4*rt.d)/1e4,yt)),rt.max-We.d<=t||(fe.push(new go(rt.p.x-(te=rt.h/2),rt.p.y-te,te,e)),fe.push(new go(rt.p.x+te,rt.p.y-te,te,e)),fe.push(new go(rt.p.x-te,rt.p.y+te,te,e)),fe.push(new go(rt.p.x+te,rt.p.y+te,te,e)),yt+=4)}return r&&(console.log("num probes: "+yt),console.log("best distance: "+We.d)),We.p}function fo(e,t){return t.max-e.max}function go(e,t,r,f){this.p=new se(e,t),this.h=r,this.d=function(v,g){for(var x=!1,P=1/0,D=0;D<g.length;D++)for(var Z=g[D],W=0,te=Z.length,fe=te-1;W<te;fe=W++){var xe=Z[W],Ve=Z[fe];xe.y>v.y!=Ve.y>v.y&&v.x<(Ve.x-xe.x)*(v.y-xe.y)/(Ve.y-xe.y)+xe.x&&(x=!x),P=Math.min(P,Sa(v,xe,Ve))}return(x?1:-1)*Math.sqrt(P)}(this.p,f),this.max=this.d+this.h*Math.SQRT2}Zo.prototype.push=function(e){this.data.push(e),this.length++,this._up(this.length-1)},Zo.prototype.pop=function(){if(this.length!==0){var e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}},Zo.prototype.peek=function(){return this.data[0]},Zo.prototype._up=function(e){for(var t=this.data,r=this.compare,f=t[e];e>0;){var v=e-1>>1,g=t[v];if(r(f,g)>=0)break;t[e]=g,e=v}t[e]=f},Zo.prototype._down=function(e){for(var t=this.data,r=this.compare,f=this.length>>1,v=t[e];e<f;){var g=1+(e<<1),x=t[g],P=g+1;if(P<this.length&&r(t[P],x)<0&&(g=P,x=t[P]),r(x,v)>=0)break;t[e]=x,e=g}t[e]=v};var Pl=Number.POSITIVE_INFINITY;function Ge(e,t){return t[1]!==Pl?function(r,f,v){var g=0,x=0;switch(f=Math.abs(f),v=Math.abs(v),r){case"top-right":case"top-left":case"top":x=v-7;break;case"bottom-right":case"bottom-left":case"bottom":x=7-v}switch(r){case"top-right":case"bottom-right":case"right":g=-f;break;case"top-left":case"bottom-left":case"left":g=f}return[g,x]}(e,t[0],t[1]):function(r,f){var v=0,g=0;f<0&&(f=0);var x=f/Math.sqrt(2);switch(r){case"top-right":case"top-left":g=x-7;break;case"bottom-right":case"bottom-left":g=7-x;break;case"bottom":g=7-f;break;case"top":g=f-7}switch(r){case"top-right":case"bottom-right":v=-x;break;case"top-left":case"bottom-left":v=x;break;case"left":v=f;break;case"right":v=-f}return[v,g]}(e,t[0])}function cr(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Jt(e,t,r,f,v,g,x,P,D,Z,W,te,fe,xe,Ve){var We=function(hr,yr,Nr,ln,Sn,fi,Zn,di){for(var Gn=ln.layout.get("text-rotate").evaluate(fi,{})*Math.PI/180,ra=[],ki=0,ri=yr.positionedLines;ki<ri.length;ki+=1)for(var ma=ri[ki],Ki=0,wa=ma.positionedGlyphs;Ki<wa.length;Ki+=1){var mi=wa[Ki];if(mi.rect){var ka=mi.rect||{},Oo=4,$o=!0,Uo=1,Eo=0,is=(Sn||di)&&mi.vertical,As=mi.metrics.advance*mi.scale/2;if(di&&yr.verticalizable&&(Eo=ma.lineOffset/2-(mi.imageName?-(24-mi.metrics.width*mi.scale)/2:24*(mi.scale-1))),mi.imageName){var Ts=Zn[mi.imageName];$o=Ts.sdf,Oo=1/(Uo=Ts.pixelRatio)}var hu=Sn?[mi.x+As,mi.y]:[0,0],Ps=Sn?[0,0]:[mi.x+As+Nr[0],mi.y+Nr[1]-Eo],qs=[0,0];is&&(qs=Ps,Ps=[0,0]);var Ua=(mi.metrics.left-Oo)*mi.scale-As+Ps[0],Ms=(-mi.metrics.top-Oo)*mi.scale+Ps[1],oa=Ua+ka.w*mi.scale/Uo,yo=Ms+ka.h*mi.scale/Uo,Ja=new se(Ua,Ms),Oa=new se(oa,Ms),Gu=new se(Ua,yo),Zs=new se(oa,yo);if(is){var oo=new se(-As,As- -17),as=-Math.PI/2,eu=12-As,Fa=new se(22-eu,-(mi.imageName?eu:0)),Hu=new(Function.prototype.bind.apply(se,[null].concat(qs)));Ja._rotateAround(as,oo)._add(Fa)._add(Hu),Oa._rotateAround(as,oo)._add(Fa)._add(Hu),Gu._rotateAround(as,oo)._add(Fa)._add(Hu),Zs._rotateAround(as,oo)._add(Fa)._add(Hu)}if(Gn){var Wu=Math.sin(Gn),Ll=Math.cos(Gn),os=[Ll,-Wu,Wu,Ll];Ja._matMult(os),Oa._matMult(os),Gu._matMult(os),Zs._matMult(os)}var Oc=new se(0,0),Du=new se(0,0);ra.push({tl:Ja,tr:Oa,bl:Gu,br:Zs,tex:ka,writingMode:yr.writingMode,glyphOffset:hu,sectionIndex:mi.sectionIndex,isSDF:$o,pixelOffsetTL:Oc,pixelOffsetBR:Du,minFontScaleX:0,minFontScaleY:0})}}return ra}(0,r,P,v,g,x,f,e.allowVerticalPlacement),yt=e.textSizeData,rt=null;yt.kind==="source"?(rt=[128*v.layout.get("text-size").evaluate(x,{})])[0]>32640&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):yt.kind==="composite"&&((rt=[128*xe.compositeTextSizes[0].evaluate(x,{},Ve),128*xe.compositeTextSizes[1].evaluate(x,{},Ve)])[0]>32640||rt[1]>32640)&&Xe(e.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),e.addSymbols(e.text,We,rt,P,g,x,Z,t,D.lineStartIndex,D.lineLength,fe,Ve);for(var Pt=0,Xt=W;Pt<Xt.length;Pt+=1)te[Xt[Pt]]=e.text.placedSymbolArray.length-1;return 4*We.length}function Fn(e){for(var t in e)return e[t];return null}function fa(e,t,r,f){var v=e.compareText;if(t in v){for(var g=v[t],x=g.length-1;x>=0;x--)if(f.dist(g[x])<r)return!0}else v[t]=[];return v[t].push(f),!1}var ke=jc.VectorTileFeature.types,Se=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function it(e,t,r,f,v,g,x,P,D,Z,W,te,fe){var xe=P?Math.min(32640,Math.round(P[0])):0,Ve=P?Math.min(32640,Math.round(P[1])):0;e.emplaceBack(t,r,Math.round(32*f),Math.round(32*v),g,x,(xe<<1)+(D?1:0),Ve,16*Z,16*W,256*te,256*fe)}function Ot(e,t,r){e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r),e.emplaceBack(t.x,t.y,r)}function sr(e){for(var t=0,r=e.sections;t<r.length;t+=1)if(zl(r[t].text))return!0;return!1}var _t=function(e){this.layoutVertexArray=new wc,this.indexArray=new qu,this.programConfigurations=e,this.segments=new Ce,this.dynamicLayoutVertexArray=new Ri,this.opacityVertexArray=new Qu,this.placedSymbolArray=new h};_t.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},_t.prototype.upload=function(e,t,r,f){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Wh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Xh.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Se,!0),this.opacityVertexBuffer.itemSize=1),(r||f)&&this.programConfigurations.upload(e))},_t.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Cn("SymbolBuffers",_t);var dt=function(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new Ce,this.collisionVertexArray=new jl};dt.prototype.upload=function(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Yh.members,!0)},dt.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Cn("CollisionBuffers",dt);var st=function(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(function(g){return g.id}),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=co([]),this.placementViewportMatrix=co([]);var t=this.layers[0]._unevaluatedLayout._values;this.textSizeData=wi(this.zoom,t["text-size"]),this.iconSizeData=wi(this.zoom,t["icon-size"]);var r=this.layers[0].layout,f=r.get("symbol-sort-key"),v=r.get("symbol-z-order");this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey=v!=="viewport-y"&&f.constantOr(1)!==void 0,this.sortFeaturesByY=(v==="viewport-y"||v==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,r.get("symbol-placement")==="point"&&(this.writingModes=r.get("text-writing-mode").map(function(g){return Rr[g]})),this.stateDependentLayerIds=this.layers.filter(function(g){return g.isStateDependent()}).map(function(g){return g.id}),this.sourceID=e.sourceID};st.prototype.createArrays=function(){this.text=new _t(new O(this.layers,this.zoom,function(e){return/^text/.test(e)})),this.icon=new _t(new O(this.layers,this.zoom,function(e){return/^icon/.test(e)})),this.glyphOffsetArray=new T,this.lineVertexArray=new R,this.symbolInstances=new b},st.prototype.calculateGlyphDependencies=function(e,t,r,f,v){for(var g=0;g<e.length;g++)if(t[e.charCodeAt(g)]=!0,(r||f)&&v){var x=Cf[e.charAt(g)];x&&(t[x.charCodeAt(0)]=!0)}},st.prototype.populate=function(e,t,r){var f=this.layers[0],v=f.layout,g=v.get("text-font"),x=v.get("text-field"),P=v.get("icon-image"),D=(x.value.kind!=="constant"||x.value.value instanceof ja&&!x.value.value.isEmpty()||x.value.value.toString().length>0)&&(g.value.kind!=="constant"||g.value.value.length>0),Z=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,W=v.get("symbol-sort-key");if(this.features=[],D||Z){for(var te=t.iconDependencies,fe=t.glyphDependencies,xe=t.availableImages,Ve=new ea(this.zoom),We=0,yt=e;We<yt.length;We+=1){var rt=yt[We],Pt=rt.feature,Xt=rt.id,hr=rt.index,yr=rt.sourceLayerIndex,Nr=f._featureFilter.needGeometry,ln=St(Pt,Nr);if(f._featureFilter.filter(Ve,ln,r)){Nr||(ln.geometry=Mt(Pt));var Sn=void 0;if(D){var fi=f.getValueAndResolveTokens("text-field",ln,r,xe),Zn=ja.factory(fi);sr(Zn)&&(this.hasRTLText=!0),(!this.hasRTLText||fc()==="unavailable"||this.hasRTLText&&Fs.isParsed())&&(Sn=Tp(Zn,f,ln))}var di=void 0;if(Z){var Gn=f.getValueAndResolveTokens("icon-image",ln,r,xe);di=Gn instanceof Xi?Gn:Xi.fromString(Gn)}if(Sn||di){var ra=this.sortFeaturesByKey?W.evaluate(ln,{},r):void 0;if(this.features.push({id:Xt,text:Sn,icon:di,index:hr,sourceLayerIndex:yr,geometry:ln.geometry,properties:Pt.properties,type:ke[Pt.type],sortKey:ra}),di&&(te[di.name]=!0),Sn){var ki=g.evaluate(ln,{},r).join(","),ri=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Rr.vertical)>=0;for(var ma=0,Ki=Sn.sections;ma<Ki.length;ma+=1){var wa=Ki[ma];if(wa.image)te[wa.image.name]=!0;else{var mi=Wa(Sn.toString()),ka=wa.fontStack||ki,Oo=fe[ka]=fe[ka]||{};this.calculateGlyphDependencies(wa.text,Oo,ri,this.allowVerticalPlacement,mi)}}}}}}v.get("symbol-placement")==="line"&&(this.features=function($o){var Uo={},Eo={},is=[],As=0;function Ts(oo){is.push($o[oo]),As++}function hu(oo,as,eu){var Fa=Eo[oo];return delete Eo[oo],Eo[as]=Fa,is[Fa].geometry[0].pop(),is[Fa].geometry[0]=is[Fa].geometry[0].concat(eu[0]),Fa}function Ps(oo,as,eu){var Fa=Uo[as];return delete Uo[as],Uo[oo]=Fa,is[Fa].geometry[0].shift(),is[Fa].geometry[0]=eu[0].concat(is[Fa].geometry[0]),Fa}function qs(oo,as,eu){var Fa=eu?as[0][as[0].length-1]:as[0][0];return oo+":"+Fa.x+":"+Fa.y}for(var Ua=0;Ua<$o.length;Ua++){var Ms=$o[Ua],oa=Ms.geometry,yo=Ms.text?Ms.text.toString():null;if(yo){var Ja=qs(yo,oa),Oa=qs(yo,oa,!0);if(Ja in Eo&&Oa in Uo&&Eo[Ja]!==Uo[Oa]){var Gu=Ps(Ja,Oa,oa),Zs=hu(Ja,Oa,is[Gu].geometry);delete Uo[Ja],delete Eo[Oa],Eo[qs(yo,is[Zs].geometry,!0)]=Zs,is[Gu].geometry=null}else Ja in Eo?hu(Ja,Oa,oa):Oa in Uo?Ps(Ja,Oa,oa):(Ts(Ua),Uo[Ja]=As-1,Eo[Oa]=As-1)}else Ts(Ua)}return is.filter(function(oo){return oo.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function($o,Uo){return $o.sortKey-Uo.sortKey})}},st.prototype.update=function(e,t,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,t,this.layers,r),this.icon.programConfigurations.updatePaintArrays(e,t,this.layers,r))},st.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},st.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},st.prototype.upload=function(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},st.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},st.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},st.prototype.addToLineVertexArray=function(e,t){var r=this.lineVertexArray.length;if(e.segment!==void 0){for(var f=e.dist(t[e.segment+1]),v=e.dist(t[e.segment]),g={},x=e.segment+1;x<t.length;x++)g[x]={x:t[x].x,y:t[x].y,tileUnitDistanceFromAnchor:f},x<t.length-1&&(f+=t[x+1].dist(t[x]));for(var P=e.segment||0;P>=0;P--)g[P]={x:t[P].x,y:t[P].y,tileUnitDistanceFromAnchor:v},P>0&&(v+=t[P-1].dist(t[P]));for(var D=0;D<t.length;D++){var Z=g[D];this.lineVertexArray.emplaceBack(Z.x,Z.y,Z.tileUnitDistanceFromAnchor)}}return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}},st.prototype.addSymbols=function(e,t,r,f,v,g,x,P,D,Z,W,te){for(var fe=e.indexArray,xe=e.layoutVertexArray,Ve=e.segments.prepareSegment(4*t.length,xe,fe,this.canOverlap?g.sortKey:void 0),We=this.glyphOffsetArray.length,yt=Ve.vertexLength,rt=this.allowVerticalPlacement&&x===Rr.vertical?Math.PI/2:0,Pt=g.text&&g.text.sections,Xt=0;Xt<t.length;Xt++){var hr=t[Xt],yr=hr.tl,Nr=hr.tr,ln=hr.bl,Sn=hr.br,fi=hr.tex,Zn=hr.pixelOffsetTL,di=hr.pixelOffsetBR,Gn=hr.minFontScaleX,ra=hr.minFontScaleY,ki=hr.glyphOffset,ri=hr.isSDF,ma=hr.sectionIndex,Ki=Ve.vertexLength,wa=ki[1];it(xe,P.x,P.y,yr.x,wa+yr.y,fi.x,fi.y,r,ri,Zn.x,Zn.y,Gn,ra),it(xe,P.x,P.y,Nr.x,wa+Nr.y,fi.x+fi.w,fi.y,r,ri,di.x,Zn.y,Gn,ra),it(xe,P.x,P.y,ln.x,wa+ln.y,fi.x,fi.y+fi.h,r,ri,Zn.x,di.y,Gn,ra),it(xe,P.x,P.y,Sn.x,wa+Sn.y,fi.x+fi.w,fi.y+fi.h,r,ri,di.x,di.y,Gn,ra),Ot(e.dynamicLayoutVertexArray,P,rt),fe.emplaceBack(Ki,Ki+1,Ki+2),fe.emplaceBack(Ki+1,Ki+2,Ki+3),Ve.vertexLength+=4,Ve.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ki[0]),Xt!==t.length-1&&ma===t[Xt+1].sectionIndex||e.programConfigurations.populatePaintArrays(xe.length,g,g.index,{},te,Pt&&Pt[ma])}e.placedSymbolArray.emplaceBack(P.x,P.y,We,this.glyphOffsetArray.length-We,yt,D,Z,P.segment,r?r[0]:0,r?r[1]:0,f[0],f[1],x,0,!1,0,W)},st.prototype._addCollisionDebugVertex=function(e,t,r,f,v,g){return t.emplaceBack(0,0),e.emplaceBack(r.x,r.y,f,v,Math.round(g.x),Math.round(g.y))},st.prototype.addCollisionDebugVertices=function(e,t,r,f,v,g,x){var P=v.segments.prepareSegment(4,v.layoutVertexArray,v.indexArray),D=P.vertexLength,Z=v.layoutVertexArray,W=v.collisionVertexArray,te=x.anchorX,fe=x.anchorY;this._addCollisionDebugVertex(Z,W,g,te,fe,new se(e,t)),this._addCollisionDebugVertex(Z,W,g,te,fe,new se(r,t)),this._addCollisionDebugVertex(Z,W,g,te,fe,new se(r,f)),this._addCollisionDebugVertex(Z,W,g,te,fe,new se(e,f)),P.vertexLength+=4;var xe=v.indexArray;xe.emplaceBack(D,D+1),xe.emplaceBack(D+1,D+2),xe.emplaceBack(D+2,D+3),xe.emplaceBack(D+3,D),P.primitiveLength+=4},st.prototype.addDebugCollisionBoxes=function(e,t,r,f){for(var v=e;v<t;v++){var g=this.collisionBoxArray.get(v);this.addCollisionDebugVertices(g.x1,g.y1,g.x2,g.y2,f?this.textCollisionBox:this.iconCollisionBox,g.anchorPoint,r)}},st.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new dt(Fo,Kh.members,Lu),this.iconCollisionBox=new dt(Fo,Kh.members,Lu);for(var e=0;e<this.symbolInstances.length;e++){var t=this.symbolInstances.get(e);this.addDebugCollisionBoxes(t.textBoxStartIndex,t.textBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.verticalTextBoxStartIndex,t.verticalTextBoxEndIndex,t,!0),this.addDebugCollisionBoxes(t.iconBoxStartIndex,t.iconBoxEndIndex,t,!1),this.addDebugCollisionBoxes(t.verticalIconBoxStartIndex,t.verticalIconBoxEndIndex,t,!1)}},st.prototype._deserializeCollisionBoxesForSymbol=function(e,t,r,f,v,g,x,P,D){for(var Z={},W=t;W<r;W++){var te=e.get(W);Z.textBox={x1:te.x1,y1:te.y1,x2:te.x2,y2:te.y2,anchorPointX:te.anchorPointX,anchorPointY:te.anchorPointY},Z.textFeatureIndex=te.featureIndex;break}for(var fe=f;fe<v;fe++){var xe=e.get(fe);Z.verticalTextBox={x1:xe.x1,y1:xe.y1,x2:xe.x2,y2:xe.y2,anchorPointX:xe.anchorPointX,anchorPointY:xe.anchorPointY},Z.verticalTextFeatureIndex=xe.featureIndex;break}for(var Ve=g;Ve<x;Ve++){var We=e.get(Ve);Z.iconBox={x1:We.x1,y1:We.y1,x2:We.x2,y2:We.y2,anchorPointX:We.anchorPointX,anchorPointY:We.anchorPointY},Z.iconFeatureIndex=We.featureIndex;break}for(var yt=P;yt<D;yt++){var rt=e.get(yt);Z.verticalIconBox={x1:rt.x1,y1:rt.y1,x2:rt.x2,y2:rt.y2,anchorPointX:rt.anchorPointX,anchorPointY:rt.anchorPointY},Z.verticalIconFeatureIndex=rt.featureIndex;break}return Z},st.prototype.deserializeCollisionBoxes=function(e){this.collisionArrays=[];for(var t=0;t<this.symbolInstances.length;t++){var r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}},st.prototype.hasTextData=function(){return this.text.segments.get().length>0},st.prototype.hasIconData=function(){return this.icon.segments.get().length>0},st.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},st.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},st.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},st.prototype.addIndicesForPlacedSymbol=function(e,t){for(var r=e.placedSymbolArray.get(t),f=r.vertexStartIndex+4*r.numGlyphs,v=r.vertexStartIndex;v<f;v+=4)e.indexArray.emplaceBack(v,v+1,v+2),e.indexArray.emplaceBack(v+1,v+2,v+3)},st.prototype.getSortedSymbolIndexes=function(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var t=Math.sin(e),r=Math.cos(e),f=[],v=[],g=[],x=0;x<this.symbolInstances.length;++x){g.push(x);var P=this.symbolInstances.get(x);f.push(0|Math.round(t*P.anchorX+r*P.anchorY)),v.push(P.featureIndex)}return g.sort(function(D,Z){return f[D]-f[Z]||v[Z]-v[D]}),g},st.prototype.addToSortKeyRanges=function(e,t){var r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})},st.prototype.sortFeatures=function(e){var t=this;if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var r=0,f=this.symbolInstanceIndexes;r<f.length;r+=1){var v=this.symbolInstances.get(f[r]);this.featureSortOrder.push(v.featureIndex),[v.rightJustifiedTextSymbolIndex,v.centerJustifiedTextSymbolIndex,v.leftJustifiedTextSymbolIndex].forEach(function(g,x,P){g>=0&&P.indexOf(g)===x&&t.addIndicesForPlacedSymbol(t.text,g)}),v.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,v.verticalPlacedTextSymbolIndex),v.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.placedIconSymbolIndex),v.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,v.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Cn("SymbolBucket",st,{omit:["layers","collisionBoxArray","features","compareText"]}),st.MAX_GLYPHS=65535,st.addDynamicAttributes=Ot;var Me=new zo({"symbol-placement":new ii(ae.layout_symbol["symbol-placement"]),"symbol-spacing":new ii(ae.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ii(ae.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new qn(ae.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ii(ae.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ii(ae.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ii(ae.layout_symbol["icon-ignore-placement"]),"icon-optional":new ii(ae.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ii(ae.layout_symbol["icon-rotation-alignment"]),"icon-size":new qn(ae.layout_symbol["icon-size"]),"icon-text-fit":new ii(ae.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ii(ae.layout_symbol["icon-text-fit-padding"]),"icon-image":new qn(ae.layout_symbol["icon-image"]),"icon-rotate":new qn(ae.layout_symbol["icon-rotate"]),"icon-padding":new ii(ae.layout_symbol["icon-padding"]),"icon-keep-upright":new ii(ae.layout_symbol["icon-keep-upright"]),"icon-offset":new qn(ae.layout_symbol["icon-offset"]),"icon-anchor":new qn(ae.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ii(ae.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ii(ae.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ii(ae.layout_symbol["text-rotation-alignment"]),"text-field":new qn(ae.layout_symbol["text-field"]),"text-font":new qn(ae.layout_symbol["text-font"]),"text-size":new qn(ae.layout_symbol["text-size"]),"text-max-width":new qn(ae.layout_symbol["text-max-width"]),"text-line-height":new ii(ae.layout_symbol["text-line-height"]),"text-letter-spacing":new qn(ae.layout_symbol["text-letter-spacing"]),"text-justify":new qn(ae.layout_symbol["text-justify"]),"text-radial-offset":new qn(ae.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ii(ae.layout_symbol["text-variable-anchor"]),"text-anchor":new qn(ae.layout_symbol["text-anchor"]),"text-max-angle":new ii(ae.layout_symbol["text-max-angle"]),"text-writing-mode":new ii(ae.layout_symbol["text-writing-mode"]),"text-rotate":new qn(ae.layout_symbol["text-rotate"]),"text-padding":new ii(ae.layout_symbol["text-padding"]),"text-keep-upright":new ii(ae.layout_symbol["text-keep-upright"]),"text-transform":new qn(ae.layout_symbol["text-transform"]),"text-offset":new qn(ae.layout_symbol["text-offset"]),"text-allow-overlap":new ii(ae.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ii(ae.layout_symbol["text-ignore-placement"]),"text-optional":new ii(ae.layout_symbol["text-optional"])}),nt={paint:new zo({"icon-opacity":new qn(ae.paint_symbol["icon-opacity"]),"icon-color":new qn(ae.paint_symbol["icon-color"]),"icon-halo-color":new qn(ae.paint_symbol["icon-halo-color"]),"icon-halo-width":new qn(ae.paint_symbol["icon-halo-width"]),"icon-halo-blur":new qn(ae.paint_symbol["icon-halo-blur"]),"icon-translate":new ii(ae.paint_symbol["icon-translate"]),"icon-translate-anchor":new ii(ae.paint_symbol["icon-translate-anchor"]),"text-opacity":new qn(ae.paint_symbol["text-opacity"]),"text-color":new qn(ae.paint_symbol["text-color"],{runtimeType:Dr,getOverride:function(e){return e.textColor},hasOverride:function(e){return!!e.textColor}}),"text-halo-color":new qn(ae.paint_symbol["text-halo-color"]),"text-halo-width":new qn(ae.paint_symbol["text-halo-width"]),"text-halo-blur":new qn(ae.paint_symbol["text-halo-blur"]),"text-translate":new ii(ae.paint_symbol["text-translate"]),"text-translate-anchor":new ii(ae.paint_symbol["text-translate-anchor"])}),layout:Me},Ne=function(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Rn,this.defaultValue=e};Ne.prototype.evaluate=function(e){if(e.formattedSection){var t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default},Ne.prototype.eachChild=function(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)},Ne.prototype.outputDefined=function(){return!1},Ne.prototype.serialize=function(){return null},Cn("FormatSectionOverride",Ne,{omit:["defaultValue"]});var Lt=function(e){function t(r){e.call(this,r,nt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.recalculate=function(r,f){if(e.prototype.recalculate.call(this,r,f),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var v=this.layout.get("text-writing-mode");if(v){for(var g=[],x=0,P=v;x<P.length;x+=1){var D=P[x];g.indexOf(D)<0&&g.push(D)}this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},t.prototype.getValueAndResolveTokens=function(r,f,v,g){var x=this.layout.get(r).evaluate(f,{},v,g),P=this._unevaluatedLayout._values[r];return P.isDataDriven()||Pu(P.value)||!x?x:function(D,Z){return Z.replace(/{([^{}]+)}/g,function(W,te){return te in D?String(D[te]):""})}(f.properties,x)},t.prototype.createBucket=function(r){return new st(r)},t.prototype.queryRadius=function(){return 0},t.prototype.queryIntersectsFeature=function(){return!1},t.prototype._setPaintOverrides=function(){for(var r=0,f=nt.paint.overridableProperties;r<f.length;r+=1){var v=f[r];if(t.hasPaintOverride(this.layout,v)){var g,x=this.paint.get(v),P=new Ne(x),D=new Ys(P,x.property.specification);g=x.value.kind==="constant"||x.value.kind==="source"?new ou("source",D):new wo("composite",D,x.value.zoomStops,x.value._interpolationType),this.paint._values[v]=new eo(x.property,g,x.parameters)}}},t.prototype._handleOverridablePaintPropertyUpdate=function(r,f,v){return!(!this.layout||f.isDataDriven()||v.isDataDriven())&&t.hasPaintOverride(this.layout,r)},t.hasPaintOverride=function(r,f){var v=r.get("text-field"),g=nt.paint.properties[f],x=!1,P=function(W){for(var te=0,fe=W;te<fe.length;te+=1)if(g.overrides&&g.overrides.hasOverride(fe[te]))return void(x=!0)};if(v.value.kind==="constant"&&v.value.value instanceof ja)P(v.value.value.sections);else if(v.value.kind==="source"){var D=function(W){x||(W instanceof Yi&&Ba(W.value)===ia?P(W.value.sections):W instanceof Lo?P(W.sections):W.eachChild(D))},Z=v.value;Z._styleExpression&&D(Z._styleExpression.expression)}return x},t}(lu),Kt={paint:new zo({"background-color":new ii(ae.paint_background["background-color"]),"background-pattern":new es(ae.paint_background["background-pattern"]),"background-opacity":new ii(ae.paint_background["background-opacity"])})},Hr=function(e){function t(r){e.call(this,r,Kt)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(lu),mn={paint:new zo({"raster-opacity":new ii(ae.paint_raster["raster-opacity"]),"raster-hue-rotate":new ii(ae.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ii(ae.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ii(ae.paint_raster["raster-brightness-max"]),"raster-saturation":new ii(ae.paint_raster["raster-saturation"]),"raster-contrast":new ii(ae.paint_raster["raster-contrast"]),"raster-resampling":new ii(ae.paint_raster["raster-resampling"]),"raster-fade-duration":new ii(ae.paint_raster["raster-fade-duration"])})},vn=function(e){function t(r){e.call(this,r,mn)}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t}(lu),On=function(e){function t(r){e.call(this,r,{}),this.implementation=r}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t,t.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},t.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},t.prototype.recalculate=function(){},t.prototype.updateTransitions=function(){},t.prototype.hasTransition=function(){},t.prototype.serialize=function(){},t.prototype.onAdd=function(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)},t.prototype.onRemove=function(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)},t}(lu),fn={circle:ju,heatmap:_f,hillshade:oh,fill:Ef,"fill-extrusion":Gh,line:Hh,symbol:Lt,background:Hr,raster:vn},zn=$.HTMLImageElement,Bn=$.HTMLCanvasElement,Jn=$.HTMLVideoElement,$n=$.ImageData,Vn=$.ImageBitmap,li=function(e,t,r,f){this.context=e,this.format=r,this.texture=e.gl.createTexture(),this.update(t,f)};li.prototype.update=function(e,t,r){var f=e.width,v=e.height,g=!(this.size&&this.size[0]===f&&this.size[1]===v||r),x=this.context,P=x.gl;if(this.useMipmap=Boolean(t&&t.useMipmap),P.bindTexture(P.TEXTURE_2D,this.texture),x.pixelStoreUnpackFlipY.set(!1),x.pixelStoreUnpack.set(1),x.pixelStoreUnpackPremultiplyAlpha.set(this.format===P.RGBA&&(!t||t.premultiply!==!1)),g)this.size=[f,v],e instanceof zn||e instanceof Bn||e instanceof Jn||e instanceof $n||Vn&&e instanceof Vn?P.texImage2D(P.TEXTURE_2D,0,this.format,this.format,P.UNSIGNED_BYTE,e):P.texImage2D(P.TEXTURE_2D,0,this.format,f,v,0,this.format,P.UNSIGNED_BYTE,e.data);else{var D=r||{x:0,y:0},Z=D.x,W=D.y;e instanceof zn||e instanceof Bn||e instanceof Jn||e instanceof $n||Vn&&e instanceof Vn?P.texSubImage2D(P.TEXTURE_2D,0,Z,W,P.RGBA,P.UNSIGNED_BYTE,e):P.texSubImage2D(P.TEXTURE_2D,0,Z,W,f,v,P.RGBA,P.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&P.generateMipmap(P.TEXTURE_2D)},li.prototype.bind=function(e,t,r){var f=this.context.gl;f.bindTexture(f.TEXTURE_2D,this.texture),r!==f.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(r=f.LINEAR),e!==this.filter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,r||e),this.filter=e),t!==this.wrap&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,t),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,t),this.wrap=t)},li.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},li.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Ia=function(e){var t=this;this._callback=e,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){t._triggered=!1,t._callback()})};Ia.prototype.trigger=function(){var e=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){e._triggered=!1,e._callback()},0))},Ia.prototype.remove=function(){delete this._channel,this._callback=function(){}};var rs=function(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},br(["receive","process"],this),this.invoker=new Ia(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=qt()?e:$};function Ml(e,t,r){var f=2*Math.PI*6378137/256/Math.pow(2,r);return[e*f-2*Math.PI*6378137/2,t*f-2*Math.PI*6378137/2]}rs.prototype.send=function(e,t,r,f,v){var g=this;v===void 0&&(v=!1);var x=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(this.callbacks[x]=r);var P=Re(this.globalScope)?void 0:[];return this.target.postMessage({id:x,type:e,hasCallback:!!r,targetMapId:f,mustQueue:v,sourceMapId:this.mapId,data:su(t,P)},P),{cancel:function(){r&&delete g.callbacks[x],g.target.postMessage({id:x,type:"<cancel>",targetMapId:f,sourceMapId:g.mapId})}}},rs.prototype.receive=function(e){var t=e.data,r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if(t.type==="<cancel>"){delete this.tasks[r];var f=this.cancelCallbacks[r];delete this.cancelCallbacks[r],f&&f()}else qt()||t.mustQueue?(this.tasks[r]=t,this.taskQueue.push(r),this.invoker.trigger()):this.processTask(r,t)},rs.prototype.process=function(){if(this.taskQueue.length){var e=this.taskQueue.shift(),t=this.tasks[e];delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),t&&this.processTask(e,t)}},rs.prototype.processTask=function(e,t){var r=this;if(t.type==="<response>"){var f=this.callbacks[e];delete this.callbacks[e],f&&(t.error?f(ko(t.error)):f(null,ko(t.data)))}else{var v=!1,g=Re(this.globalScope)?void 0:[],x=t.hasCallback?function(W,te){v=!0,delete r.cancelCallbacks[e],r.target.postMessage({id:e,type:"<response>",sourceMapId:r.mapId,error:W?su(W):null,data:su(te,g)},g)}:function(W){v=!0},P=null,D=ko(t.data);if(this.parent[t.type])P=this.parent[t.type](t.sourceMapId,D,x);else if(this.parent.getWorkerSource){var Z=t.type.split(".");P=this.parent.getWorkerSource(t.sourceMapId,Z[0],D.source)[Z[1]](D,x)}else x(new Error("Could not find function "+t.type));!v&&P&&P.cancel&&(this.cancelCallbacks[e]=P.cancel)}},rs.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var $a=function(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))};$a.prototype.setNorthEast=function(e){return this._ne=e instanceof Da?new Da(e.lng,e.lat):Da.convert(e),this},$a.prototype.setSouthWest=function(e){return this._sw=e instanceof Da?new Da(e.lng,e.lat):Da.convert(e),this},$a.prototype.extend=function(e){var t,r,f=this._sw,v=this._ne;if(e instanceof Da)t=e,r=e;else{if(!(e instanceof $a))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend($a.convert(e)):this.extend(Da.convert(e)):this;if(r=e._ne,!(t=e._sw)||!r)return this}return f||v?(f.lng=Math.min(t.lng,f.lng),f.lat=Math.min(t.lat,f.lat),v.lng=Math.max(r.lng,v.lng),v.lat=Math.max(r.lat,v.lat)):(this._sw=new Da(t.lng,t.lat),this._ne=new Da(r.lng,r.lat)),this},$a.prototype.getCenter=function(){return new Da((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},$a.prototype.getSouthWest=function(){return this._sw},$a.prototype.getNorthEast=function(){return this._ne},$a.prototype.getNorthWest=function(){return new Da(this.getWest(),this.getNorth())},$a.prototype.getSouthEast=function(){return new Da(this.getEast(),this.getSouth())},$a.prototype.getWest=function(){return this._sw.lng},$a.prototype.getSouth=function(){return this._sw.lat},$a.prototype.getEast=function(){return this._ne.lng},$a.prototype.getNorth=function(){return this._ne.lat},$a.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},$a.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},$a.prototype.isEmpty=function(){return!(this._sw&&this._ne)},$a.prototype.contains=function(e){var t=Da.convert(e),r=t.lng,f=t.lat,v=this._sw.lng<=r&&r<=this._ne.lng;return this._sw.lng>this._ne.lng&&(v=this._sw.lng>=r&&r>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&v},$a.convert=function(e){return!e||e instanceof $a?e:new $a(e)};var Da=function(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: ("+e+", "+t+")");if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Da.prototype.wrap=function(){return new Da(Qt(this.lng,-180,180),this.lat)},Da.prototype.toArray=function(){return[this.lng,this.lat]},Da.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Da.prototype.distanceTo=function(e){var t=Math.PI/180,r=this.lat*t,f=e.lat*t,v=Math.sin(r)*Math.sin(f)+Math.cos(r)*Math.cos(f)*Math.cos((e.lng-this.lng)*t);return 63710088e-1*Math.acos(Math.min(v,1))},Da.prototype.toBounds=function(e){e===void 0&&(e=0);var t=360*e/40075017,r=t/Math.cos(Math.PI/180*this.lat);return new $a(new Da(this.lng-r,this.lat-t),new Da(this.lng+r,this.lat+t))},Da.convert=function(e){if(e instanceof Da)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new Da(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new Da(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Qs=2*Math.PI*63710088e-1;function $l(e){return Qs*Math.cos(e*Math.PI/180)}function rl(e){return(180+e)/360}function _h(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function vl(e,t){return e/$l(t)}function Wf(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}var Vc=function(e,t,r){r===void 0&&(r=0),this.x=+e,this.y=+t,this.z=+r};Vc.fromLngLat=function(e,t){t===void 0&&(t=0);var r=Da.convert(e);return new Vc(rl(r.lng),_h(r.lat),vl(t,r.lat))},Vc.prototype.toLngLat=function(){return new Da(360*this.x-180,Wf(this.y))},Vc.prototype.toAltitude=function(){return this.z*$l(Wf(this.y))},Vc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Qs*(e=Wf(this.y),1/Math.cos(e*Math.PI/180));var e};var pf=function(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Xf(0,e,e,t,r)};pf.prototype.equals=function(e){return this.z===e.z&&this.x===e.x&&this.y===e.y},pf.prototype.url=function(e,t){var r,f,v,g,x,P=(f=this.y,v=this.z,g=Ml(256*(r=this.x),256*(f=Math.pow(2,v)-f-1),v),x=Ml(256*(r+1),256*(f+1),v),g[0]+","+g[1]+","+x[0]+","+x[1]),D=function(Z,W,te){for(var fe,xe="",Ve=Z;Ve>0;Ve--)xe+=(W&(fe=1<<Ve-1)?1:0)+(te&fe?2:0);return xe}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(t==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",D).replace("{bbox-epsg-3857}",P)},pf.prototype.getTilePoint=function(e){var t=Math.pow(2,this.z);return new se(8192*(e.x*t-this.x),8192*(e.y*t-this.y))},pf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Il=function(e,t){this.wrap=e,this.canonical=t,this.key=Xf(e,t.z,t.z,t.x,t.y)},ns=function(e,t,r,f,v){this.overscaledZ=e,this.wrap=t,this.canonical=new pf(r,+f,+v),this.key=Xf(t,e,r,f,v)};function Xf(e,t,r,f,v){(e*=2)<0&&(e=-1*e-1);var g=1<<r;return(g*g*e+g*v+f).toString(36)+r.toString(36)+t.toString(36)}ns.prototype.equals=function(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)},ns.prototype.scaledTo=function(e){var t=this.canonical.z-e;return e>this.canonical.z?new ns(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ns(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)},ns.prototype.calculateScaledKey=function(e,t){var r=this.canonical.z-e;return e>this.canonical.z?Xf(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y):Xf(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)},ns.prototype.isChildOf=function(e){if(e.wrap!==this.wrap)return!1;var t=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t},ns.prototype.children=function(e){if(this.overscaledZ>=e)return[new ns(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var t=this.canonical.z+1,r=2*this.canonical.x,f=2*this.canonical.y;return[new ns(t,this.wrap,t,r,f),new ns(t,this.wrap,t,r+1,f),new ns(t,this.wrap,t,r,f+1),new ns(t,this.wrap,t,r+1,f+1)]},ns.prototype.isLessThan=function(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))},ns.prototype.wrapped=function(){return new ns(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},ns.prototype.unwrapTo=function(e){return new ns(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)},ns.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},ns.prototype.toUnwrapped=function(){return new Il(this.wrap,this.canonical)},ns.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},ns.prototype.getTilePoint=function(e){return this.canonical.getTilePoint(new Vc(e.x-this.wrap,e.y))},Cn("CanonicalTileID",pf),Cn("OverscaledTileID",ns,{omit:["posMatrix"]});var Gc=function(e,t,r){if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&r!=="mapbox"&&r!=="terrarium")return Xe('"'+r+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=t.height;var f=this.dim=t.height-2;this.data=new Uint32Array(t.data.buffer),this.encoding=r||"mapbox";for(var v=0;v<f;v++)this.data[this._idx(-1,v)]=this.data[this._idx(0,v)],this.data[this._idx(f,v)]=this.data[this._idx(f-1,v)],this.data[this._idx(v,-1)]=this.data[this._idx(v,0)],this.data[this._idx(v,f)]=this.data[this._idx(v,f-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(f,-1)]=this.data[this._idx(f-1,0)],this.data[this._idx(-1,f)]=this.data[this._idx(0,f-1)],this.data[this._idx(f,f)]=this.data[this._idx(f-1,f-1)]};Gc.prototype.get=function(e,t){var r=new Uint8Array(this.data.buffer),f=4*this._idx(e,t);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(r[f],r[f+1],r[f+2])},Gc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Gc.prototype._idx=function(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)},Gc.prototype._unpackMapbox=function(e,t,r){return(256*e*256+256*t+r)/10-1e4},Gc.prototype._unpackTerrarium=function(e,t,r){return 256*e+t+r/256-32768},Gc.prototype.getPixels=function(){return new hs({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Gc.prototype.backfillBorder=function(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");var f=t*this.dim,v=t*this.dim+this.dim,g=r*this.dim,x=r*this.dim+this.dim;switch(t){case-1:f=v-1;break;case 1:v=f+1}switch(r){case-1:g=x-1;break;case 1:x=g+1}for(var P=-t*this.dim,D=-r*this.dim,Z=g;Z<x;Z++)for(var W=f;W<v;W++)this.data[this._idx(W,Z)]=e.data[this._idx(W+P,Z+D)]},Cn("DEMData",Gc);var Jh=function(e){this._stringToNumber={},this._numberToString=[];for(var t=0;t<e.length;t++){var r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}};Jh.prototype.encode=function(e){return this._stringToNumber[e]},Jh.prototype.decode=function(e){return this._numberToString[e]};var Af=function(e,t,r,f,v){this.type="Feature",this._vectorTileFeature=e,e._z=t,e._x=r,e._y=f,this.properties=e.properties,this.id=v},xh={geometry:{configurable:!0}};xh.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},xh.geometry.set=function(e){this._geometry=e},Af.prototype.toJSON=function(){var e={geometry:this.geometry};for(var t in this)t!=="_geometry"&&t!=="_vectorTileFeature"&&(e[t]=this[t]);return e},Object.defineProperties(Af.prototype,xh);var Tf=function(){this.state={},this.stateChanges={},this.deletedStates={}};Tf.prototype.updateState=function(e,t,r){var f=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][f]=this.stateChanges[e][f]||{},Yt(this.stateChanges[e][f],r),this.deletedStates[e]===null)for(var v in this.deletedStates[e]={},this.state[e])v!==f&&(this.deletedStates[e][v]=null);else if(this.deletedStates[e]&&this.deletedStates[e][f]===null)for(var g in this.deletedStates[e][f]={},this.state[e][f])r[g]||(this.deletedStates[e][f][g]=null);else for(var x in r)this.deletedStates[e]&&this.deletedStates[e][f]&&this.deletedStates[e][f][x]===null&&delete this.deletedStates[e][f][x]},Tf.prototype.removeFeatureState=function(e,t,r){if(this.deletedStates[e]!==null){var f=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&t!==void 0)this.deletedStates[e][f]!==null&&(this.deletedStates[e][f]=this.deletedStates[e][f]||{},this.deletedStates[e][f][r]=null);else if(t!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][f])for(r in this.deletedStates[e][f]={},this.stateChanges[e][f])this.deletedStates[e][f][r]=null;else this.deletedStates[e][f]=null;else this.deletedStates[e]=null}},Tf.prototype.getState=function(e,t){var r=String(t),f=Yt({},(this.state[e]||{})[r],(this.stateChanges[e]||{})[r]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){var v=this.deletedStates[e][t];if(v===null)return{};for(var g in v)delete f[g]}return f},Tf.prototype.initializeTileState=function(e,t){e.setFeatureState(this.state,t)},Tf.prototype.coalesceChanges=function(e,t){var r={};for(var f in this.stateChanges){this.state[f]=this.state[f]||{};var v={};for(var g in this.stateChanges[f])this.state[f][g]||(this.state[f][g]={}),Yt(this.state[f][g],this.stateChanges[f][g]),v[g]=this.state[f][g];r[f]=v}for(var x in this.deletedStates){this.state[x]=this.state[x]||{};var P={};if(this.deletedStates[x]===null)for(var D in this.state[x])P[D]={},this.state[x][D]={};else for(var Z in this.deletedStates[x]){if(this.deletedStates[x][Z]===null)this.state[x][Z]={};else for(var W=0,te=Object.keys(this.deletedStates[x][Z]);W<te.length;W+=1)delete this.state[x][Z][te[W]];P[Z]=this.state[x][Z]}r[x]=r[x]||{},Yt(r[x],P)}if(this.stateChanges={},this.deletedStates={},Object.keys(r).length!==0)for(var fe in e)e[fe].setFeatureState(r,t)};var Hc=function(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Qa(8192,16,0),this.grid3D=new Qa(8192,16,0),this.featureIndexArray=new ne,this.promoteId=t};function bh(e,t,r,f,v){return dr(e,function(g,x){var P=t instanceof fl?t.get(x):null;return P&&P.evaluate?P.evaluate(r,f,v):P})}function Qh(e){for(var t=1/0,r=1/0,f=-1/0,v=-1/0,g=0,x=e;g<x.length;g+=1){var P=x[g];t=Math.min(t,P.x),r=Math.min(r,P.y),f=Math.max(f,P.x),v=Math.max(v,P.y)}return{minX:t,minY:r,maxX:f,maxY:v}}function Pd(e,t){return t-e}Hc.prototype.insert=function(e,t,r,f,v,g){var x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,f,v);for(var P=g?this.grid3D:this.grid,D=0;D<t.length;D++){for(var Z=t[D],W=[1/0,1/0,-1/0,-1/0],te=0;te<Z.length;te++){var fe=Z[te];W[0]=Math.min(W[0],fe.x),W[1]=Math.min(W[1],fe.y),W[2]=Math.max(W[2],fe.x),W[3]=Math.max(W[3],fe.y)}W[0]<8192&&W[1]<8192&&W[2]>=0&&W[3]>=0&&P.insert(x,W[0],W[1],W[2],W[3])}},Hc.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new jc.VectorTile(new wf(this.rawTileData)).layers,this.sourceLayerCoder=new Jh(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},Hc.prototype.query=function(e,t,r,f){var v=this;this.loadVTLayers();for(var g=e.params||{},x=8192/e.tileSize/e.scale,P=uc(g.filter),D=e.queryGeometry,Z=e.queryPadding*x,W=Qh(D),te=this.grid.query(W.minX-Z,W.minY-Z,W.maxX+Z,W.maxY+Z),fe=Qh(e.cameraQueryGeometry),xe=this.grid3D.query(fe.minX-Z,fe.minY-Z,fe.maxX+Z,fe.maxY+Z,function(hr,yr,Nr,ln){return function(Sn,fi,Zn,di,Gn){for(var ra=0,ki=Sn;ra<ki.length;ra+=1){var ri=ki[ra];if(fi<=ri.x&&Zn<=ri.y&&di>=ri.x&&Gn>=ri.y)return!0}var ma=[new se(fi,Zn),new se(fi,Gn),new se(di,Gn),new se(di,Zn)];if(Sn.length>2){for(var Ki=0,wa=ma;Ki<wa.length;Ki+=1)if(Ca(Sn,wa[Ki]))return!0}for(var mi=0;mi<Sn.length-1;mi++)if(Bo(Sn[mi],Sn[mi+1],ma))return!0;return!1}(e.cameraQueryGeometry,hr-Z,yr-Z,Nr+Z,ln+Z)}),Ve=0,We=xe;Ve<We.length;Ve+=1)te.push(We[Ve]);te.sort(Pd);for(var yt,rt={},Pt=function(hr){var yr=te[hr];if(yr!==yt){yt=yr;var Nr=v.featureIndexArray.get(yr),ln=null;v.loadMatchingFeature(rt,Nr.bucketIndex,Nr.sourceLayerIndex,Nr.featureIndex,P,g.layers,g.availableImages,t,r,f,function(Sn,fi,Zn){return ln||(ln=Mt(Sn)),fi.queryIntersectsFeature(D,Sn,Zn,ln,v.z,e.transform,x,e.pixelPosMatrix)})}},Xt=0;Xt<te.length;Xt++)Pt(Xt);return rt},Hc.prototype.loadMatchingFeature=function(e,t,r,f,v,g,x,P,D,Z,W){var te=this.bucketLayerIDs[t];if(!g||function(Sn,fi){for(var Zn=0;Zn<Sn.length;Zn++)if(fi.indexOf(Sn[Zn])>=0)return!0;return!1}(g,te)){var fe=this.sourceLayerCoder.decode(r),xe=this.vtLayers[fe].feature(f);if(v.needGeometry){var Ve=St(xe,!0);if(!v.filter(new ea(this.tileID.overscaledZ),Ve,this.tileID.canonical))return}else if(!v.filter(new ea(this.tileID.overscaledZ),xe))return;for(var We=this.getId(xe,fe),yt=0;yt<te.length;yt++){var rt=te[yt];if(!(g&&g.indexOf(rt)<0)){var Pt=P[rt];if(Pt){var Xt={};We!==void 0&&Z&&(Xt=Z.getState(Pt.sourceLayer||"_geojsonTileLayer",We));var hr=Yt({},D[rt]);hr.paint=bh(hr.paint,Pt.paint,xe,Xt,x),hr.layout=bh(hr.layout,Pt.layout,xe,Xt,x);var yr=!W||W(xe,Pt,Xt);if(yr){var Nr=new Af(xe,this.z,this.x,this.y,We);Nr.layer=hr;var ln=e[rt];ln===void 0&&(ln=e[rt]=[]),ln.push({featureIndex:f,feature:Nr,intersectionZ:yr})}}}}}},Hc.prototype.lookupSymbolFeatures=function(e,t,r,f,v,g,x,P){var D={};this.loadVTLayers();for(var Z=uc(v),W=0,te=e;W<te.length;W+=1)this.loadMatchingFeature(D,r,f,te[W],Z,g,x,P,t);return D},Hc.prototype.hasLayer=function(e){for(var t=0,r=this.bucketLayerIDs;t<r.length;t+=1)for(var f=0,v=r[t];f<v.length;f+=1)if(e===v[f])return!0;return!1},Hc.prototype.getId=function(e,t){var r=e.id;return this.promoteId&&typeof(r=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[t]])=="boolean"&&(r=Number(r)),r},Cn("FeatureIndex",Hc,{omit:["rawTileData","sourceLayerCoder"]});var vs=function(e,t){this.tileID=e,this.uid=jt(),this.uses=0,this.tileSize=t,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};vs.prototype.registerFadeDuration=function(e){var t=e+this.timeAdded;t<$i.now()||this.fadeEndTime&&t<this.fadeEndTime||(this.fadeEndTime=t)},vs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},vs.prototype.loadVectorData=function(e,t,r){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){for(var f in e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(Z,W){var te={};if(!W)return te;for(var fe=function(){var We=Ve[xe],yt=We.layerIds.map(function(Xt){return W.getLayer(Xt)}).filter(Boolean);if(yt.length!==0){We.layers=yt,We.stateDependentLayerIds&&(We.stateDependentLayers=We.stateDependentLayerIds.map(function(Xt){return yt.filter(function(hr){return hr.id===Xt})[0]}));for(var rt=0,Pt=yt;rt<Pt.length;rt+=1)te[Pt[rt].id]=We}},xe=0,Ve=Z;xe<Ve.length;xe+=1)fe();return te}(e.buckets,t.style),this.hasSymbolBuckets=!1,this.buckets){var v=this.buckets[f];if(v instanceof st){if(this.hasSymbolBuckets=!0,!r)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var g in this.buckets){var x=this.buckets[g];if(x instanceof st&&x.hasRTLText){this.hasRTLText=!0,Fs.isLoading()||Fs.isLoaded()||fc()!=="deferred"||Vs();break}}for(var P in this.queryPadding=0,this.buckets){var D=this.buckets[P];this.queryPadding=Math.max(this.queryPadding,t.style.getLayer(P).queryRadius(D))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u},vs.prototype.unloadVectorData=function(){for(var e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},vs.prototype.getBucket=function(e){return this.buckets[e.id]},vs.prototype.upload=function(e){for(var t in this.buckets){var r=this.buckets[t];r.uploadPending()&&r.upload(e)}var f=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new li(e,this.imageAtlas.image,f.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new li(e,this.glyphAtlasImage,f.ALPHA),this.glyphAtlasImage=null)},vs.prototype.prepare=function(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)},vs.prototype.queryRenderedFeatures=function(e,t,r,f,v,g,x,P,D,Z){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:f,cameraQueryGeometry:v,scale:g,tileSize:this.tileSize,pixelPosMatrix:Z,transform:P,params:x,queryPadding:this.queryPadding*D},e,t,r):{}},vs.prototype.querySourceFeatures=function(e,t){var r=this.latestFeatureIndex;if(r&&r.rawTileData){var f=r.loadVTLayers(),v=t?t.sourceLayer:"",g=f._geojsonTileLayer||f[v];if(g)for(var x=uc(t&&t.filter),P=this.tileID.canonical,D=P.z,Z=P.x,W=P.y,te={z:D,x:Z,y:W},fe=0;fe<g.length;fe++){var xe=g.feature(fe);if(x.needGeometry){var Ve=St(xe,!0);if(!x.filter(new ea(this.tileID.overscaledZ),Ve,this.tileID.canonical))continue}else if(!x.filter(new ea(this.tileID.overscaledZ),xe))continue;var We=r.getId(xe,v),yt=new Af(xe,D,Z,W,We);yt.tile=te,e.push(yt)}}},vs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},vs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},vs.prototype.setExpiryData=function(e){var t=this.expirationTime;if(e.cacheControl){var r=Xr(e.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){var f=Date.now(),v=!1;if(this.expirationTime>f)v=!1;else if(t)if(this.expirationTime<t)v=!0;else{var g=this.expirationTime-t;g?this.expirationTime=f+Math.max(g,3e4):v=!0}else v=!0;v?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},vs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},vs.prototype.setFeatureState=function(e,t){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0){var r=this.latestFeatureIndex.loadVTLayers();for(var f in this.buckets)if(t.style.hasLayer(f)){var v=this.buckets[f],g=v.layers[0].sourceLayer||"_geojsonTileLayer",x=r[g],P=e[g];if(x&&P&&Object.keys(P).length!==0){v.update(P,x,this.imageAtlas&&this.imageAtlas.patternPositions||{});var D=t&&t.style&&t.style.getLayer(f);D&&(this.queryPadding=Math.max(this.queryPadding,D.queryRadius(v)))}}}},vs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},vs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<$i.now()},vs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},vs.prototype.setHoldDuration=function(e){this.symbolFadeHoldUntil=$i.now()+e},vs.prototype.setDependencies=function(e,t){for(var r={},f=0,v=t;f<v.length;f+=1)r[v[f]]=!0;this.dependencies[e]=r},vs.prototype.hasDependency=function(e,t){for(var r=0,f=e;r<f.length;r+=1){var v=this.dependencies[f[r]];if(v){for(var g=0,x=t;g<x.length;g+=1)if(v[x[g]])return!0}}return!1};var Ol=$.performance,Yp=function(e){this._marks={start:[e.url,"start"].join("#"),end:[e.url,"end"].join("#"),measure:e.url.toString()},Ol.mark(this._marks.start)};Yp.prototype.finish=function(){Ol.mark(this._marks.end);var e=Ol.getEntriesByName(this._marks.measure);return e.length===0&&(Ol.measure(this._marks.measure,this._marks.start,this._marks.end),e=Ol.getEntriesByName(this._marks.measure),Ol.clearMarks(this._marks.start),Ol.clearMarks(this._marks.end),Ol.clearMeasures(this._marks.measure)),e},d.Actor=rs,d.AlphaImage=el,d.CanonicalTileID=pf,d.CollisionBoxArray=u,d.Color=Ji,d.DEMData=Gc,d.DataConstantProperty=ii,d.DictionaryCoder=Jh,d.EXTENT=8192,d.ErrorEvent=he,d.EvaluationParameters=ea,d.Event=ee,d.Evented=Te,d.FeatureIndex=Hc,d.FillBucket=Ru,d.FillExtrusionBucket=dl,d.ImageAtlas=Ln,d.ImagePosition=gr,d.LineBucket=Wo,d.LngLat=Da,d.LngLatBounds=$a,d.MercatorCoordinate=Vc,d.ONE_EM=24,d.OverscaledTileID=ns,d.Point=se,d.Point$1=se,d.Properties=zo,d.Protobuf=wf,d.RGBAImage=hs,d.RequestManager=nr,d.RequestPerformance=Yp,d.ResourceType=Yr,d.SegmentVector=Ce,d.SourceFeatureState=Tf,d.StructArrayLayout1ui2=Ea,d.StructArrayLayout2f1f2i16=Cu,d.StructArrayLayout2i4=Po,d.StructArrayLayout3ui6=qu,d.StructArrayLayout4i8=wl,d.SymbolBucket=st,d.Texture=li,d.Tile=vs,d.Transitionable=Ra,d.Uniform1f=hn,d.Uniform1i=jr,d.Uniform2f=nn,d.Uniform3f=Nn,d.Uniform4f=oi,d.UniformColor=ui,d.UniformMatrix4f=Qi,d.UnwrappedTileID=Il,d.ValidationError=Ee,d.WritingMode=Rr,d.ZoomHistory=cc,d.add=function(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e},d.addDynamicAttributes=Ot,d.asyncAll=function(e,t,r){if(!e.length)return r(null,[]);var f=e.length,v=new Array(e.length),g=null;e.forEach(function(x,P){t(x,function(D,Z){D&&(g=D),v[P]=Z,--f==0&&r(g,v)})})},d.bezier=bt,d.bindAll=br,d.browser=$i,d.cacheEntryPossiblyAdded=function(e){++er>At&&(e.getActor().send("enforceCacheSizeLimit",lt),er=0)},d.clamp=Ir,d.clearTileCache=function(e){var t=$.caches.delete("mapbox-tiles");e&&t.catch(e).then(function(){return e()})},d.clipLine=Cs,d.clone=function(e){var t=new Oi(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},d.clone$1=$e,d.clone$2=function(e){var t=new Oi(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},d.collisionCircleLayout=Ap,d.config=or,d.create=function(){var e=new Oi(16);return Oi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e},d.create$1=function(){var e=new Oi(9);return Oi!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e},d.create$2=function(){var e=new Oi(4);return Oi!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},d.createCommonjsModule=de,d.createExpression=Os,d.createLayout=ba,d.createStyleLayer=function(e){return e.type==="custom"?new On(e):new fn[e.type](e)},d.cross=function(e,t,r){var f=t[0],v=t[1],g=t[2],x=r[0],P=r[1],D=r[2];return e[0]=v*D-g*P,e[1]=g*x-f*D,e[2]=f*P-v*x,e},d.deepEqual=function e(t,r){if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(var f=0;f<t.length;f++)if(!e(t[f],r[f]))return!1;return!0}if(typeof t=="object"&&t!==null&&r!==null){if(typeof r!="object"||Object.keys(t).length!==Object.keys(r).length)return!1;for(var v in t)if(!e(t[v],r[v]))return!1;return!0}return t===r},d.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},d.dot$1=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},d.ease=Gt,d.emitValidationErrors=bo,d.endsWith=q,d.enforceCacheSizeLimit=function(e){zt(),ut&&ut.then(function(t){t.keys().then(function(r){for(var f=0;f<r.length-e;f++)t.delete(r[f])})})},d.evaluateSizeForFeature=Di,d.evaluateSizeForZoom=la,d.evaluateVariableOffset=Ge,d.evented=El,d.extend=Yt,d.featureFilter=uc,d.filterObject=Qe,d.fromRotation=function(e,t){var r=Math.sin(t),f=Math.cos(t);return e[0]=f,e[1]=r,e[2]=0,e[3]=-r,e[4]=f,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},d.getAnchorAlignment=ji,d.getAnchorJustification=cr,d.getArrayBuffer=Zi,d.getImage=ue,d.getJSON=function(e,t){return na(Yt(e,{type:"json"}),t)},d.getRTLTextPluginStatus=fc,d.getReferrer=_n,d.getVideo=function(e,t){var r,f,v=$.document.createElement("video");v.muted=!0,v.onloadstart=function(){t(null,v)};for(var g=0;g<e.length;g++){var x=$.document.createElement("source");r=e[g],f=void 0,(f=$.document.createElement("a")).href=r,(f.protocol!==$.document.location.protocol||f.host!==$.document.location.host)&&(v.crossOrigin="Anonymous"),x.src=e[g],v.appendChild(x)}return{cancel:function(){}}},d.identity=co,d.invert=function(e,t){var r=t[0],f=t[1],v=t[2],g=t[3],x=t[4],P=t[5],D=t[6],Z=t[7],W=t[8],te=t[9],fe=t[10],xe=t[11],Ve=t[12],We=t[13],yt=t[14],rt=t[15],Pt=r*P-f*x,Xt=r*D-v*x,hr=r*Z-g*x,yr=f*D-v*P,Nr=f*Z-g*P,ln=v*Z-g*D,Sn=W*We-te*Ve,fi=W*yt-fe*Ve,Zn=W*rt-xe*Ve,di=te*yt-fe*We,Gn=te*rt-xe*We,ra=fe*rt-xe*yt,ki=Pt*ra-Xt*Gn+hr*di+yr*Zn-Nr*fi+ln*Sn;return ki?(e[0]=(P*ra-D*Gn+Z*di)*(ki=1/ki),e[1]=(v*Gn-f*ra-g*di)*ki,e[2]=(We*ln-yt*Nr+rt*yr)*ki,e[3]=(fe*Nr-te*ln-xe*yr)*ki,e[4]=(D*Zn-x*ra-Z*fi)*ki,e[5]=(r*ra-v*Zn+g*fi)*ki,e[6]=(yt*hr-Ve*ln-rt*Xt)*ki,e[7]=(W*ln-fe*hr+xe*Xt)*ki,e[8]=(x*Gn-P*Zn+Z*Sn)*ki,e[9]=(f*Zn-r*Gn-g*Sn)*ki,e[10]=(Ve*Nr-We*hr+rt*Pt)*ki,e[11]=(te*hr-W*Nr-xe*Pt)*ki,e[12]=(P*fi-x*di-D*Sn)*ki,e[13]=(r*di-f*fi+v*Sn)*ki,e[14]=(We*Xt-Ve*yr-yt*Pt)*ki,e[15]=(W*yr-te*Xt+fe*Pt)*ki,e):null},d.isChar=xn,d.isMapboxURL=_r,d.keysDifference=function(e,t){var r=[];for(var f in e)f in t||r.push(f);return r},d.makeRequest=na,d.mapObject=dr,d.mercatorXfromLng=rl,d.mercatorYfromLat=_h,d.mercatorZfromAltitude=vl,d.mul=Vl,d.multiply=Ka,d.mvt=jc,d.nextPowerOfTwo=function(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},d.normalize=function(e,t){var r=t[0],f=t[1],v=t[2],g=r*r+f*f+v*v;return g>0&&(g=1/Math.sqrt(g)),e[0]=t[0]*g,e[1]=t[1]*g,e[2]=t[2]*g,e},d.number=Ta,d.offscreenCanvasSupported=Jr,d.ortho=function(e,t,r,f,v,g,x){var P=1/(t-r),D=1/(f-v),Z=1/(g-x);return e[0]=-2*P,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*D,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*Z,e[11]=0,e[12]=(t+r)*P,e[13]=(v+f)*D,e[14]=(x+g)*Z,e[15]=1,e},d.parseGlyphPBF=function(e){return new wf(e).readFields(yn,[])},d.pbf=wf,d.performSymbolLayout=function(e,t,r,f,v,g,x){e.createArrays(),e.tilePixelRatio=8192/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;var P=e.layers[0].layout,D=e.layers[0]._unevaluatedLayout._values,Z={};if(e.textSizeData.kind==="composite"){var W=e.textSizeData,te=W.maxZoom;Z.compositeTextSizes=[D["text-size"].possiblyEvaluate(new ea(W.minZoom),x),D["text-size"].possiblyEvaluate(new ea(te),x)]}if(e.iconSizeData.kind==="composite"){var fe=e.iconSizeData,xe=fe.maxZoom;Z.compositeIconSizes=[D["icon-size"].possiblyEvaluate(new ea(fe.minZoom),x),D["icon-size"].possiblyEvaluate(new ea(xe),x)]}Z.layoutTextSize=D["text-size"].possiblyEvaluate(new ea(e.zoom+1),x),Z.layoutIconSize=D["icon-size"].possiblyEvaluate(new ea(e.zoom+1),x),Z.textMaxSize=D["text-size"].possiblyEvaluate(new ea(18));for(var Ve=24*P.get("text-line-height"),We=P.get("text-rotation-alignment")==="map"&&P.get("symbol-placement")!=="point",yt=P.get("text-keep-upright"),rt=P.get("text-size"),Pt=function(){var yr=hr[Xt],Nr=P.get("text-font").evaluate(yr,{},x).join(","),ln=rt.evaluate(yr,{},x),Sn=Z.layoutTextSize.evaluate(yr,{},x),fi=Z.layoutIconSize.evaluate(yr,{},x),Zn={horizontal:{},vertical:void 0},di=yr.text,Gn=[0,0];if(di){var ra=di.toString(),ki=24*P.get("text-letter-spacing").evaluate(yr,{},x),ri=function(oa){for(var yo=0,Ja=oa;yo<Ja.length;yo+=1)if(Oa=Ja[yo].charCodeAt(0),xn.Arabic(Oa)||xn["Arabic Supplement"](Oa)||xn["Arabic Extended-A"](Oa)||xn["Arabic Presentation Forms-A"](Oa)||xn["Arabic Presentation Forms-B"](Oa))return!1;var Oa;return!0}(ra)?ki:0,ma=P.get("text-anchor").evaluate(yr,{},x),Ki=P.get("text-variable-anchor");if(!Ki){var wa=P.get("text-radial-offset").evaluate(yr,{},x);Gn=wa?Ge(ma,[24*wa,Pl]):P.get("text-offset").evaluate(yr,{},x).map(function(oa){return 24*oa})}var mi=We?"center":P.get("text-justify").evaluate(yr,{},x),ka=P.get("symbol-placement"),Oo=ka==="point"?24*P.get("text-max-width").evaluate(yr,{},x):0,$o=function(){e.allowVerticalPlacement&&Wa(ra)&&(Zn.vertical=pi(di,t,r,v,Nr,Oo,Ve,ma,"left",ri,Gn,Rr.vertical,!0,ka,Sn,ln))};if(!We&&Ki){for(var Uo=mi==="auto"?Ki.map(function(oa){return cr(oa)}):[mi],Eo=!1,is=0;is<Uo.length;is++){var As=Uo[is];if(!Zn.horizontal[As])if(Eo)Zn.horizontal[As]=Zn.horizontal[0];else{var Ts=pi(di,t,r,v,Nr,Oo,Ve,"center",As,ri,Gn,Rr.horizontal,!1,ka,Sn,ln);Ts&&(Zn.horizontal[As]=Ts,Eo=Ts.positionedLines.length===1)}}$o()}else{mi==="auto"&&(mi=cr(ma));var hu=pi(di,t,r,v,Nr,Oo,Ve,ma,mi,ri,Gn,Rr.horizontal,!1,ka,Sn,ln);hu&&(Zn.horizontal[mi]=hu),$o(),Wa(ra)&&We&&yt&&(Zn.vertical=pi(di,t,r,v,Nr,Oo,Ve,ma,mi,ri,Gn,Rr.vertical,!1,ka,Sn,ln))}}var Ps=void 0,qs=!1;if(yr.icon&&yr.icon.name){var Ua=f[yr.icon.name];Ua&&(Ps=function(oa,yo,Ja){var Oa=ji(Ja),Gu=yo[0]-oa.displaySize[0]*Oa.horizontalAlign,Zs=yo[1]-oa.displaySize[1]*Oa.verticalAlign;return{image:oa,top:Zs,bottom:Zs+oa.displaySize[1],left:Gu,right:Gu+oa.displaySize[0]}}(v[yr.icon.name],P.get("icon-offset").evaluate(yr,{},x),P.get("icon-anchor").evaluate(yr,{},x)),qs=Ua.sdf,e.sdfIcons===void 0?e.sdfIcons=Ua.sdf:e.sdfIcons!==Ua.sdf&&Xe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ua.pixelRatio!==e.pixelRatio||P.get("icon-rotate").constantOr(1)!==0)&&(e.iconsNeedLinear=!0))}var Ms=Fn(Zn.horizontal)||Zn.vertical;e.iconsInText=!!Ms&&Ms.iconsInText,(Ms||Ps)&&function(oa,yo,Ja,Oa,Gu,Zs,oo,as,eu,Fa,Hu){var Wu=Zs.textMaxSize.evaluate(yo,{});Wu===void 0&&(Wu=oo);var Ll,os=oa.layers[0].layout,Oc=os.get("icon-offset").evaluate(yo,{},Hu),Du=Fn(Ja.horizontal),Yf=oo/24,Pf=oa.tilePixelRatio*Yf,Sh=oa.tilePixelRatio*Wu/24,df=oa.tilePixelRatio*as,Eh=oa.tilePixelRatio*os.get("symbol-spacing"),Pp=os.get("text-padding")*oa.tilePixelRatio,Ch=os.get("icon-padding")*oa.tilePixelRatio,qh=os.get("text-max-angle")/180*Math.PI,Mp=os.get("text-rotation-alignment")==="map"&&os.get("symbol-placement")!=="point",wh=os.get("icon-rotation-alignment")==="map"&&os.get("symbol-placement")!=="point",vc=os.get("symbol-placement"),ep=Eh/2,Mf=os.get("icon-text-fit");Oa&&Mf!=="none"&&(oa.allowVerticalPlacement&&Ja.vertical&&(Ll=Mn(Oa,Ja.vertical,Mf,os.get("icon-text-fit-padding"),Oc,Yf)),Du&&(Oa=Mn(Oa,Du,Mf,os.get("icon-text-fit-padding"),Oc,Yf)));var vf=function(Yd,ap){ap.x<0||ap.x>=8192||ap.y<0||ap.y>=8192||function(ms,Ql,Jp,Of,Oh,Jf,Lp,ql,Qf,Xc,op,Lh,tu,Qp,Rh,ho,qp,qf,eh,ed,ml,sp,td,Rc,rd){var Rp,Lf,th,rh,Rf,nh=ms.addToLineVertexArray(Ql,Jp),Dp=0,nd=0,id=0,ad=0,kp=-1,Fp=-1,Yc={},od=ze(""),up=0,Bp=0;if(ql._unevaluatedLayout.getValue("text-radial-offset")===void 0?(up=(Rp=ql.layout.get("text-offset").evaluate(ml,{},Rc).map(function(ih){return 24*ih}))[0],Bp=Rp[1]):(up=24*ql.layout.get("text-radial-offset").evaluate(ml,{},Rc),Bp=Pl),ms.allowVerticalPlacement&&Of.vertical){var sd=ql.layout.get("text-rotate").evaluate(ml,{},Rc)+90;rh=new Ma(Qf,Ql,Xc,op,Lh,Of.vertical,tu,Qp,Rh,sd),Lp&&(Rf=new Ma(Qf,Ql,Xc,op,Lh,Lp,qp,qf,Rh,sd))}if(Oh){var Np=ql.layout.get("icon-rotate").evaluate(ml,{}),zp=ql.layout.get("icon-text-fit")!=="none",ud=zs(Oh,Np,td,zp),Zp=Lp?zs(Lp,Np,td,zp):void 0;th=new Ma(Qf,Ql,Xc,op,Lh,Oh,qp,qf,!1,Np),Dp=4*ud.length;var ld=ms.iconSizeData,Dh=null;ld.kind==="source"?(Dh=[128*ql.layout.get("icon-size").evaluate(ml,{})])[0]>32640&&Xe(ms.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):ld.kind==="composite"&&((Dh=[128*sp.compositeIconSizes[0].evaluate(ml,{},Rc),128*sp.compositeIconSizes[1].evaluate(ml,{},Rc)])[0]>32640||Dh[1]>32640)&&Xe(ms.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),ms.addSymbols(ms.icon,ud,Dh,ed,eh,ml,!1,Ql,nh.lineStartIndex,nh.lineLength,-1,Rc),kp=ms.icon.placedSymbolArray.length-1,Zp&&(nd=4*Zp.length,ms.addSymbols(ms.icon,Zp,Dh,ed,eh,ml,Rr.vertical,Ql,nh.lineStartIndex,nh.lineLength,-1,Rc),Fp=ms.icon.placedSymbolArray.length-1)}for(var cd in Of.horizontal){var lp=Of.horizontal[cd];if(!Lf){od=ze(lp.text);var fd=ql.layout.get("text-rotate").evaluate(ml,{},Rc);Lf=new Ma(Qf,Ql,Xc,op,Lh,lp,tu,Qp,Rh,fd)}var hd=lp.positionedLines.length===1;if(id+=Jt(ms,Ql,lp,Jf,ql,Rh,ml,ho,nh,Of.vertical?Rr.horizontal:Rr.horizontalOnly,hd?Object.keys(Of.horizontal):[cd],Yc,kp,sp,Rc),hd)break}Of.vertical&&(ad+=Jt(ms,Ql,Of.vertical,Jf,ql,Rh,ml,ho,nh,Rr.vertical,["vertical"],Yc,Fp,sp,Rc));var Od=Lf?Lf.boxStartIndex:ms.collisionBoxArray.length,Ld=Lf?Lf.boxEndIndex:ms.collisionBoxArray.length,Rd=rh?rh.boxStartIndex:ms.collisionBoxArray.length,Dd=rh?rh.boxEndIndex:ms.collisionBoxArray.length,kd=th?th.boxStartIndex:ms.collisionBoxArray.length,Fd=th?th.boxEndIndex:ms.collisionBoxArray.length,Bd=Rf?Rf.boxStartIndex:ms.collisionBoxArray.length,pd=Rf?Rf.boxEndIndex:ms.collisionBoxArray.length,Dc=-1,cp=function(ih,vd){return ih&&ih.circleDiameter?Math.max(ih.circleDiameter,vd):vd};Dc=cp(Lf,Dc),Dc=cp(rh,Dc),Dc=cp(th,Dc);var dd=(Dc=cp(Rf,Dc))>-1?1:0;dd&&(Dc*=rd/24),ms.glyphOffsetArray.length>=st.MAX_GLYPHS&&Xe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),ml.sortKey!==void 0&&ms.addToSortKeyRanges(ms.symbolInstances.length,ml.sortKey),ms.symbolInstances.emplaceBack(Ql.x,Ql.y,Yc.right>=0?Yc.right:-1,Yc.center>=0?Yc.center:-1,Yc.left>=0?Yc.left:-1,Yc.vertical||-1,kp,Fp,od,Od,Ld,Rd,Dd,kd,Fd,Bd,pd,Xc,id,ad,Dp,nd,dd,0,tu,up,Bp,Dc)}(oa,ap,Yd,Ja,Oa,Gu,Ll,oa.layers[0],oa.collisionBoxArray,yo.index,yo.sourceLayerIndex,oa.index,Pf,Pp,Mp,eu,df,Ch,wh,Oc,yo,Zs,Fa,Hu,oo)};if(vc==="line")for(var Ah=0,Th=Cs(yo.geometry,0,0,8192,8192);Ah<Th.length;Ah+=1)for(var tp=Th[Ah],rp=0,Kf=Xo(tp,Eh,qh,Ja.vertical||Du,Oa,24,Sh,oa.overscaling,8192);rp<Kf.length;rp+=1){var np=Kf[rp];Du&&fa(oa,Du.text,ep,np)||vf(tp,np)}else if(vc==="line-center")for(var ip=0,mf=yo.geometry;ip<mf.length;ip+=1){var Ph=mf[ip];if(Ph.length>1){var Ip=ds(Ph,qh,Ja.vertical||Du,Oa,24,Sh);Ip&&vf(Ph,Ip)}}else if(yo.type==="Polygon")for(var Jl=0,Mh=sf(yo.geometry,0);Jl<Mh.length;Jl+=1){var Wc=Mh[Jl],Ih=va(Wc,16);vf(Wc[0],new Pn(Ih.x,Ih.y,0))}else if(yo.type==="LineString")for(var If=0,Lc=yo.geometry;If<Lc.length;If+=1){var $f=Lc[If];vf($f,new Pn($f[0].x,$f[0].y,0))}else if(yo.type==="Point")for(var Op=0,Md=yo.geometry;Op<Md.length;Op+=1)for(var Kp=0,Id=Md[Op];Kp<Id.length;Kp+=1){var $p=Id[Kp];vf([$p],new Pn($p.x,$p.y,0))}}(e,yr,Zn,Ps,f,Z,Sn,fi,Gn,qs,x)},Xt=0,hr=e.features;Xt<hr.length;Xt+=1)Pt();g&&e.generateCollisionDebugBuffers()},d.perspective=function(e,t,r,f,v){var g,x=1/Math.tan(t/2);return e[0]=x/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=x,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,v!=null&&v!==1/0?(e[10]=(v+f)*(g=1/(f-v)),e[14]=2*v*f*g):(e[10]=-1,e[14]=-2*f),e},d.pick=function(e,t){for(var r={},f=0;f<t.length;f++){var v=t[f];v in e&&(r[v]=e[v])}return r},d.plugin=Fs,d.polygonIntersectsPolygon=Xn,d.postMapLoadEvent=Ye,d.postTurnstileEvent=Tr,d.potpack=Bt,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.register=Cn,d.registerForPluginStateChange=function(e){return e({pluginStatus:ks,pluginURL:Uu}),El.on("pluginStateChange",e),e},d.renderColorRamp=yf,d.rotate=function(e,t,r){var f=t[0],v=t[1],g=t[2],x=t[3],P=Math.sin(r),D=Math.cos(r);return e[0]=f*D+g*P,e[1]=v*D+x*P,e[2]=f*-P+g*D,e[3]=v*-P+x*D,e},d.rotateX=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[4],x=t[5],P=t[6],D=t[7],Z=t[8],W=t[9],te=t[10],fe=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=g*v+Z*f,e[5]=x*v+W*f,e[6]=P*v+te*f,e[7]=D*v+fe*f,e[8]=Z*v-g*f,e[9]=W*v-x*f,e[10]=te*v-P*f,e[11]=fe*v-D*f,e},d.rotateZ=function(e,t,r){var f=Math.sin(r),v=Math.cos(r),g=t[0],x=t[1],P=t[2],D=t[3],Z=t[4],W=t[5],te=t[6],fe=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=g*v+Z*f,e[1]=x*v+W*f,e[2]=P*v+te*f,e[3]=D*v+fe*f,e[4]=Z*v-g*f,e[5]=W*v-x*f,e[6]=te*v-P*f,e[7]=fe*v-D*f,e},d.scale=function(e,t,r){var f=r[0],v=r[1],g=r[2];return e[0]=t[0]*f,e[1]=t[1]*f,e[2]=t[2]*f,e[3]=t[3]*f,e[4]=t[4]*v,e[5]=t[5]*v,e[6]=t[6]*v,e[7]=t[7]*v,e[8]=t[8]*g,e[9]=t[9]*g,e[10]=t[10]*g,e[11]=t[11]*g,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},d.scale$1=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e},d.scale$2=function(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e},d.setCacheLimits=function(e,t){lt=e,At=t},d.setRTLTextPlugin=function(e,t,r){if(r===void 0&&(r=!1),ks==="deferred"||ks==="loading"||ks==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");Uu=$i.resolveURL(e),ks="deferred",bu=t,Zl(),r||Vs()},d.sphericalToCartesian=function(e){var t=e[0],r=e[1],f=e[2];return r+=90,r*=Math.PI/180,f*=Math.PI/180,{x:t*Math.cos(r)*Math.sin(f),y:t*Math.sin(r)*Math.sin(f),z:t*Math.cos(f)}},d.sqrLen=function(e){var t=e[0],r=e[1];return t*t+r*r},d.styleSpec=ae,d.sub=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},d.symbolSize=Mo,d.transformMat3=function(e,t,r){var f=t[0],v=t[1],g=t[2];return e[0]=f*r[0]+v*r[3]+g*r[6],e[1]=f*r[1]+v*r[4]+g*r[7],e[2]=f*r[2]+v*r[5]+g*r[8],e},d.transformMat4=Hs,d.translate=function(e,t,r){var f,v,g,x,P,D,Z,W,te,fe,xe,Ve,We=r[0],yt=r[1],rt=r[2];return t===e?(e[12]=t[0]*We+t[4]*yt+t[8]*rt+t[12],e[13]=t[1]*We+t[5]*yt+t[9]*rt+t[13],e[14]=t[2]*We+t[6]*yt+t[10]*rt+t[14],e[15]=t[3]*We+t[7]*yt+t[11]*rt+t[15]):(v=t[1],g=t[2],x=t[3],P=t[4],D=t[5],Z=t[6],W=t[7],te=t[8],fe=t[9],xe=t[10],Ve=t[11],e[0]=f=t[0],e[1]=v,e[2]=g,e[3]=x,e[4]=P,e[5]=D,e[6]=Z,e[7]=W,e[8]=te,e[9]=fe,e[10]=xe,e[11]=Ve,e[12]=f*We+P*yt+te*rt+t[12],e[13]=v*We+D*yt+fe*rt+t[13],e[14]=g*We+Z*yt+xe*rt+t[14],e[15]=x*We+W*yt+Ve*rt+t[15]),e},d.triggerPluginCompletionEvent=Bc,d.uniqueId=jt,d.validateCustomStyleLayer=function(e){var t=[],r=e.id;return r===void 0&&t.push({message:"layers."+r+': missing required property "id"'}),e.render===void 0&&t.push({message:"layers."+r+': missing required method "render"'}),e.renderingMode&&e.renderingMode!=="2d"&&e.renderingMode!=="3d"&&t.push({message:"layers."+r+': property "renderingMode" must be either "2d" or "3d"'}),t},d.validateLight=Fc,d.validateStyle=Nl,d.values=function(e){var t=[];for(var r in e)t.push(e[r]);return t},d.vectorTile=jc,d.version="1.13.2",d.warnOnce=Xe,d.webpSupported=me,d.window=$,d.wrap=Qt}),C(["./shared"],function(d){"use strict";function de(X){var ue=typeof X;if(ue==="number"||ue==="boolean"||ue==="string"||X==null)return JSON.stringify(X);if(Array.isArray(X)){for(var pe="[",F=0,ee=X;F<ee.length;F+=1)pe+=de(ee[F])+",";return pe+"]"}for(var he=Object.keys(X).sort(),Te="{",ae=0;ae<he.length;ae++)Te+=JSON.stringify(he[ae])+":"+de(X[he[ae]])+",";return Te+"}"}function re(X){for(var ue="",pe=0,F=d.refProperties;pe<F.length;pe+=1)ue+="/"+de(X[F[pe]]);return ue}var ie=function(X){this.keyCache={},X&&this.replace(X)};ie.prototype.replace=function(X){this._layerConfigs={},this._layers={},this.update(X,[])},ie.prototype.update=function(X,ue){for(var pe=this,F=0,ee=X;F<ee.length;F+=1){var he=ee[F];this._layerConfigs[he.id]=he;var Te=this._layers[he.id]=d.createStyleLayer(he);Te._featureFilter=d.featureFilter(Te.filter),this.keyCache[he.id]&&delete this.keyCache[he.id]}for(var ae=0,Ee=ue;ae<Ee.length;ae+=1){var mt=Ee[ae];delete this.keyCache[mt],delete this._layerConfigs[mt],delete this._layers[mt]}this.familiesBySource={};for(var Sr=0,Wt=function(et,Dr){for(var In={},tr=0;tr<et.length;tr++){var Ni=Dr&&Dr[et[tr].id]||re(et[tr]);Dr&&(Dr[et[tr].id]=Ni);var ia=In[Ni];ia||(ia=In[Ni]=[]),ia.push(et[tr])}var hi=[];for(var Fi in In)hi.push(In[Fi]);return hi}(d.values(this._layerConfigs),this.keyCache);Sr<Wt.length;Sr+=1){var Ke=Wt[Sr].map(function(et){return pe._layers[et.id]}),Zr=Ke[0];if(Zr.visibility!=="none"){var kn=Zr.source||"",Rn=this.familiesBySource[kn];Rn||(Rn=this.familiesBySource[kn]={});var ft=Zr.sourceLayer||"_geojsonTileLayer",vr=Rn[ft];vr||(vr=Rn[ft]=[]),vr.push(Ke)}}};var se=function(X){var ue={},pe=[];for(var F in X){var ee=X[F],he=ue[F]={};for(var Te in ee){var ae=ee[+Te];if(ae&&ae.bitmap.width!==0&&ae.bitmap.height!==0){var Ee={x:0,y:0,w:ae.bitmap.width+2,h:ae.bitmap.height+2};pe.push(Ee),he[Te]={rect:Ee,metrics:ae.metrics}}}}var mt=d.potpack(pe),Sr=new d.AlphaImage({width:mt.w||1,height:mt.h||1});for(var Wt in X){var Ke=X[Wt];for(var Zr in Ke){var kn=Ke[+Zr];if(kn&&kn.bitmap.width!==0&&kn.bitmap.height!==0){var Rn=ue[Wt][Zr].rect;d.AlphaImage.copy(kn.bitmap,Sr,{x:0,y:0},{x:Rn.x+1,y:Rn.y+1},kn.bitmap)}}}this.image=Sr,this.positions=ue};d.register("GlyphAtlas",se);var Be=function(X){this.tileID=new d.OverscaledTileID(X.tileID.overscaledZ,X.tileID.wrap,X.tileID.canonical.z,X.tileID.canonical.x,X.tileID.canonical.y),this.uid=X.uid,this.zoom=X.zoom,this.pixelRatio=X.pixelRatio,this.tileSize=X.tileSize,this.source=X.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=X.showCollisionBoxes,this.collectResourceTiming=!!X.collectResourceTiming,this.returnDependencies=!!X.returnDependencies,this.promoteId=X.promoteId};function $(X,ue,pe){for(var F=new d.EvaluationParameters(ue),ee=0,he=X;ee<he.length;ee+=1)he[ee].recalculate(F,pe)}function Je(X,ue){var pe=d.getArrayBuffer(X.request,function(F,ee,he,Te){F?ue(F):ee&&ue(null,{vectorTile:new d.vectorTile.VectorTile(new d.pbf(ee)),rawData:ee,cacheControl:he,expires:Te})});return function(){pe.cancel(),ue()}}Be.prototype.parse=function(X,ue,pe,F,ee){var he=this;this.status="parsing",this.data=X,this.collisionBoxArray=new d.CollisionBoxArray;var Te=new d.DictionaryCoder(Object.keys(X.layers).sort()),ae=new d.FeatureIndex(this.tileID,this.promoteId);ae.bucketLayerIDs=[];var Ee,mt,Sr,Wt,Ke={},Zr={featureIndex:ae,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:pe},kn=ue.familiesBySource[this.source];for(var Rn in kn){var ft=X.layers[Rn];if(ft){ft.version===1&&d.warnOnce('Vector tile source "'+this.source+'" layer "'+Rn+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var vr=Te.encode(Rn),et=[],Dr=0;Dr<ft.length;Dr++){var In=ft.feature(Dr),tr=ae.getId(In,Rn);et.push({feature:In,id:tr,index:Dr,sourceLayerIndex:vr})}for(var Ni=0,ia=kn[Rn];Ni<ia.length;Ni+=1){var hi=ia[Ni],Fi=hi[0];Fi.minzoom&&this.zoom<Math.floor(Fi.minzoom)||Fi.maxzoom&&this.zoom>=Fi.maxzoom||Fi.visibility!=="none"&&($(hi,this.zoom,pe),(Ke[Fi.id]=Fi.createBucket({index:ae.bucketLayerIDs.length,layers:hi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:vr,sourceID:this.source})).populate(et,Zr,this.tileID.canonical),ae.bucketLayerIDs.push(hi.map(function(_i){return _i.id})))}}}var Wi=d.mapObject(Zr.glyphDependencies,function(_i){return Object.keys(_i).map(Number)});Object.keys(Wi).length?F.send("getGlyphs",{uid:this.uid,stacks:Wi},function(_i,Mi){Ee||(Ee=_i,mt=Mi,La.call(he))}):mt={};var yi=Object.keys(Zr.iconDependencies);yi.length?F.send("getImages",{icons:yi,source:this.source,tileID:this.tileID,type:"icons"},function(_i,Mi){Ee||(Ee=_i,Sr=Mi,La.call(he))}):Sr={};var ya=Object.keys(Zr.patternDependencies);function La(){if(Ee)return ee(Ee);if(mt&&Sr&&Wt){var _i=new se(mt),Mi=new d.ImageAtlas(Sr,Wt);for(var Ji in Ke){var to=Ke[Ji];to instanceof d.SymbolBucket?($(to.layers,this.zoom,pe),d.performSymbolLayout(to,mt,_i.positions,Sr,Mi.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):to.hasPattern&&(to instanceof d.LineBucket||to instanceof d.FillBucket||to instanceof d.FillExtrusionBucket)&&($(to.layers,this.zoom,pe),to.addFeatures(Zr,this.tileID.canonical,Mi.patternPositions))}this.status="done",ee(null,{buckets:d.values(Ke).filter(function(jo){return!jo.isEmpty()}),featureIndex:ae,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:_i.image,imageAtlas:Mi,glyphMap:this.returnDependencies?mt:null,iconMap:this.returnDependencies?Sr:null,glyphPositions:this.returnDependencies?_i.positions:null})}}ya.length?F.send("getImages",{icons:ya,source:this.source,tileID:this.tileID,type:"patterns"},function(_i,Mi){Ee||(Ee=_i,Wt=Mi,La.call(he))}):Wt={},La.call(this)};var bt=function(X,ue,pe,F){this.actor=X,this.layerIndex=ue,this.availableImages=pe,this.loadVectorData=F||Je,this.loading={},this.loaded={}};bt.prototype.loadTile=function(X,ue){var pe=this,F=X.uid;this.loading||(this.loading={});var ee=!!(X&&X.request&&X.request.collectResourceTiming)&&new d.RequestPerformance(X.request),he=this.loading[F]=new Be(X);he.abort=this.loadVectorData(X,function(Te,ae){if(delete pe.loading[F],Te||!ae)return he.status="done",pe.loaded[F]=he,ue(Te);var Ee=ae.rawData,mt={};ae.expires&&(mt.expires=ae.expires),ae.cacheControl&&(mt.cacheControl=ae.cacheControl);var Sr={};if(ee){var Wt=ee.finish();Wt&&(Sr.resourceTiming=JSON.parse(JSON.stringify(Wt)))}he.vectorTile=ae.vectorTile,he.parse(ae.vectorTile,pe.layerIndex,pe.availableImages,pe.actor,function(Ke,Zr){if(Ke||!Zr)return ue(Ke);ue(null,d.extend({rawTileData:Ee.slice(0)},Zr,mt,Sr))}),pe.loaded=pe.loaded||{},pe.loaded[F]=he})},bt.prototype.reloadTile=function(X,ue){var pe=this,F=this.loaded,ee=X.uid,he=this;if(F&&F[ee]){var Te=F[ee];Te.showCollisionBoxes=X.showCollisionBoxes;var ae=function(Ee,mt){var Sr=Te.reloadCallback;Sr&&(delete Te.reloadCallback,Te.parse(Te.vectorTile,he.layerIndex,pe.availableImages,he.actor,Sr)),ue(Ee,mt)};Te.status==="parsing"?Te.reloadCallback=ae:Te.status==="done"&&(Te.vectorTile?Te.parse(Te.vectorTile,this.layerIndex,this.availableImages,this.actor,ae):ae())}},bt.prototype.abortTile=function(X,ue){var pe=this.loading,F=X.uid;pe&&pe[F]&&pe[F].abort&&(pe[F].abort(),delete pe[F]),ue()},bt.prototype.removeTile=function(X,ue){var pe=this.loaded,F=X.uid;pe&&pe[F]&&delete pe[F],ue()};var Gt=d.window.ImageBitmap,Ir=function(){this.loaded={}};function Qt(X,ue){if(X.length!==0){Yt(X[0],ue);for(var pe=1;pe<X.length;pe++)Yt(X[pe],!ue)}}function Yt(X,ue){for(var pe=0,F=0,ee=X.length,he=ee-1;F<ee;he=F++)pe+=(X[F][0]-X[he][0])*(X[he][1]+X[F][1]);pe>=0!=!!ue&&X.reverse()}Ir.prototype.loadTile=function(X,ue){var pe=X.uid,F=X.encoding,ee=X.rawImageData,he=Gt&&ee instanceof Gt?this.getImageData(ee):ee,Te=new d.DEMData(pe,he,F);this.loaded=this.loaded||{},this.loaded[pe]=Te,ue(null,Te)},Ir.prototype.getImageData=function(X){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(X.width,X.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=X.width,this.offscreenCanvas.height=X.height,this.offscreenCanvasContext.drawImage(X,0,0,X.width,X.height);var ue=this.offscreenCanvasContext.getImageData(-1,-1,X.width+2,X.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new d.RGBAImage({width:ue.width,height:ue.height},ue.data)},Ir.prototype.removeTile=function(X){var ue=this.loaded,pe=X.uid;ue&&ue[pe]&&delete ue[pe]};var ir=d.vectorTile.VectorTileFeature.prototype.toGeoJSON,jt=function(X){this._feature=X,this.extent=d.EXTENT,this.type=X.type,this.properties=X.tags,"id"in X&&!isNaN(X.id)&&(this.id=parseInt(X.id,10))};jt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var X=[],ue=0,pe=this._feature.geometry;ue<pe.length;ue+=1){var F=pe[ue];X.push([new d.Point$1(F[0],F[1])])}return X}for(var ee=[],he=0,Te=this._feature.geometry;he<Te.length;he+=1){for(var ae=[],Ee=0,mt=Te[he];Ee<mt.length;Ee+=1){var Sr=mt[Ee];ae.push(new d.Point$1(Sr[0],Sr[1]))}ee.push(ae)}return ee},jt.prototype.toGeoJSON=function(X,ue,pe){return ir.call(this,X,ue,pe)};var Tt=function(X){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=X.length,this._features=X};Tt.prototype.feature=function(X){return new jt(this._features[X])};var Ct=d.vectorTile.VectorTileFeature,br=q;function q(X,ue){this.options=ue||{},this.features=X,this.length=X.length}function dr(X,ue){this.id=typeof X.id=="number"?X.id:void 0,this.type=X.type,this.rawGeometry=X.type===1?[X.geometry]:X.geometry,this.properties=X.tags,this.extent=ue||4096}q.prototype.feature=function(X){return new dr(this.features[X],this.options.extent)},dr.prototype.loadGeometry=function(){var X=this.rawGeometry;this.geometry=[];for(var ue=0;ue<X.length;ue++){for(var pe=X[ue],F=[],ee=0;ee<pe.length;ee++)F.push(new d.Point$1(pe[ee][0],pe[ee][1]));this.geometry.push(F)}return this.geometry},dr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var X=this.geometry,ue=1/0,pe=-1/0,F=1/0,ee=-1/0,he=0;he<X.length;he++)for(var Te=X[he],ae=0;ae<Te.length;ae++){var Ee=Te[ae];ue=Math.min(ue,Ee.x),pe=Math.max(pe,Ee.x),F=Math.min(F,Ee.y),ee=Math.max(ee,Ee.y)}return[ue,F,pe,ee]},dr.prototype.toGeoJSON=Ct.prototype.toGeoJSON;var Qe=Rt,$e=br;function Rt(X){var ue=new d.pbf;return function(pe,F){for(var ee in pe.layers)F.writeMessage(3,Xe,pe.layers[ee])}(X,ue),ue.finish()}function Xe(X,ue){var pe;ue.writeVarintField(15,X.version||1),ue.writeStringField(1,X.name||""),ue.writeVarintField(5,X.extent||4096);var F={keys:[],values:[],keycache:{},valuecache:{}};for(pe=0;pe<X.length;pe++)F.feature=X.feature(pe),ue.writeMessage(2,Zt,F);var ee=F.keys;for(pe=0;pe<ee.length;pe++)ue.writeStringField(3,ee[pe]);var he=F.values;for(pe=0;pe<he.length;pe++)ue.writeMessage(4,Re,he[pe])}function Zt(X,ue){var pe=X.feature;pe.id!==void 0&&ue.writeVarintField(1,pe.id),ue.writeMessage(2,xr,X),ue.writeVarintField(3,pe.type),ue.writeMessage(4,ce,pe)}function xr(X,ue){var pe=X.feature,F=X.keys,ee=X.values,he=X.keycache,Te=X.valuecache;for(var ae in pe.properties){var Ee=he[ae];Ee===void 0&&(F.push(ae),he[ae]=Ee=F.length-1),ue.writeVarint(Ee);var mt=pe.properties[ae],Sr=typeof mt;Sr!=="string"&&Sr!=="boolean"&&Sr!=="number"&&(mt=JSON.stringify(mt));var Wt=Sr+":"+mt,Ke=Te[Wt];Ke===void 0&&(ee.push(mt),Te[Wt]=Ke=ee.length-1),ue.writeVarint(Ke)}}function qt(X,ue){return(ue<<3)+(7&X)}function Xr(X){return X<<1^X>>31}function ce(X,ue){for(var pe=X.loadGeometry(),F=X.type,ee=0,he=0,Te=pe.length,ae=0;ae<Te;ae++){var Ee=pe[ae],mt=1;F===1&&(mt=Ee.length),ue.writeVarint(qt(1,mt));for(var Sr=F===3?Ee.length-1:Ee.length,Wt=0;Wt<Sr;Wt++){Wt===1&&F!==1&&ue.writeVarint(qt(2,Sr-1));var Ke=Ee[Wt].x-ee,Zr=Ee[Wt].y-he;ue.writeVarint(Xr(Ke)),ue.writeVarint(Xr(Zr)),ee+=Ke,he+=Zr}F===3&&ue.writeVarint(qt(7,1))}}function Re(X,ue){var pe=typeof X;pe==="string"?ue.writeStringField(1,X):pe==="boolean"?ue.writeBooleanField(7,X):pe==="number"&&(X%1!=0?ue.writeDoubleField(3,X):X<0?ue.writeSVarintField(6,X):ue.writeVarintField(5,X))}function ge(X,ue,pe,F){xt(X,pe,F),xt(ue,2*pe,2*F),xt(ue,2*pe+1,2*F+1)}function xt(X,ue,pe){var F=X[ue];X[ue]=X[pe],X[pe]=F}function vt(X,ue,pe,F){var ee=X-pe,he=ue-F;return ee*ee+he*he}Qe.fromVectorTileJs=Rt,Qe.fromGeojsonVt=function(X,ue){ue=ue||{};var pe={};for(var F in X)pe[F]=new br(X[F].features,ue),pe[F].name=F,pe[F].version=ue.version,pe[F].extent=ue.extent;return Rt({layers:pe})},Qe.GeoJSONWrapper=$e;var Nt=function(X){return X[0]},Dt=function(X){return X[1]},Ur=function(X,ue,pe,F,ee){ue===void 0&&(ue=Nt),pe===void 0&&(pe=Dt),F===void 0&&(F=64),ee===void 0&&(ee=Float64Array),this.nodeSize=F,this.points=X;for(var he=X.length<65536?Uint16Array:Uint32Array,Te=this.ids=new he(X.length),ae=this.coords=new ee(2*X.length),Ee=0;Ee<X.length;Ee++)Te[Ee]=Ee,ae[2*Ee]=ue(X[Ee]),ae[2*Ee+1]=pe(X[Ee]);(function mt(Sr,Wt,Ke,Zr,kn,Rn){if(!(kn-Zr<=Ke)){var ft=Zr+kn>>1;(function vr(et,Dr,In,tr,Ni,ia){for(;Ni>tr;){if(Ni-tr>600){var hi=Ni-tr+1,Fi=In-tr+1,Wi=Math.log(hi),yi=.5*Math.exp(2*Wi/3),ya=.5*Math.sqrt(Wi*yi*(hi-yi)/hi)*(Fi-hi/2<0?-1:1);vr(et,Dr,In,Math.max(tr,Math.floor(In-Fi*yi/hi+ya)),Math.min(Ni,Math.floor(In+(hi-Fi)*yi/hi+ya)),ia)}var La=Dr[2*In+ia],_i=tr,Mi=Ni;for(ge(et,Dr,tr,In),Dr[2*Ni+ia]>La&&ge(et,Dr,tr,Ni);_i<Mi;){for(ge(et,Dr,_i,Mi),_i++,Mi--;Dr[2*_i+ia]<La;)_i++;for(;Dr[2*Mi+ia]>La;)Mi--}Dr[2*tr+ia]===La?ge(et,Dr,tr,Mi):ge(et,Dr,++Mi,Ni),Mi<=In&&(tr=Mi+1),In<=Mi&&(Ni=Mi-1)}})(Sr,Wt,ft,Zr,kn,Rn%2),mt(Sr,Wt,Ke,Zr,ft-1,Rn+1),mt(Sr,Wt,Ke,ft+1,kn,Rn+1)}})(Te,ae,F,0,Te.length-1,0)};Ur.prototype.range=function(X,ue,pe,F){return function(ee,he,Te,ae,Ee,mt,Sr){for(var Wt,Ke,Zr=[0,ee.length-1,0],kn=[];Zr.length;){var Rn=Zr.pop(),ft=Zr.pop(),vr=Zr.pop();if(ft-vr<=Sr)for(var et=vr;et<=ft;et++)Ke=he[2*et+1],(Wt=he[2*et])>=Te&&Wt<=Ee&&Ke>=ae&&Ke<=mt&&kn.push(ee[et]);else{var Dr=Math.floor((vr+ft)/2);Ke=he[2*Dr+1],(Wt=he[2*Dr])>=Te&&Wt<=Ee&&Ke>=ae&&Ke<=mt&&kn.push(ee[Dr]);var In=(Rn+1)%2;(Rn===0?Te<=Wt:ae<=Ke)&&(Zr.push(vr),Zr.push(Dr-1),Zr.push(In)),(Rn===0?Ee>=Wt:mt>=Ke)&&(Zr.push(Dr+1),Zr.push(ft),Zr.push(In))}}return kn}(this.ids,this.coords,X,ue,pe,F,this.nodeSize)},Ur.prototype.within=function(X,ue,pe){return function(F,ee,he,Te,ae,Ee){for(var mt=[0,F.length-1,0],Sr=[],Wt=ae*ae;mt.length;){var Ke=mt.pop(),Zr=mt.pop(),kn=mt.pop();if(Zr-kn<=Ee)for(var Rn=kn;Rn<=Zr;Rn++)vt(ee[2*Rn],ee[2*Rn+1],he,Te)<=Wt&&Sr.push(F[Rn]);else{var ft=Math.floor((kn+Zr)/2),vr=ee[2*ft],et=ee[2*ft+1];vt(vr,et,he,Te)<=Wt&&Sr.push(F[ft]);var Dr=(Ke+1)%2;(Ke===0?he-ae<=vr:Te-ae<=et)&&(mt.push(kn),mt.push(ft-1),mt.push(Dr)),(Ke===0?he+ae>=vr:Te+ae>=et)&&(mt.push(ft+1),mt.push(Zr),mt.push(Dr))}}return Sr}(this.ids,this.coords,X,ue,pe,this.nodeSize)};var dn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(X){return X}},on=function(X){this.options=kt(Object.create(dn),X),this.trees=new Array(this.options.maxZoom+1)};function $i(X,ue,pe,F,ee){return{x:X,y:ue,zoom:1/0,id:pe,parentId:-1,numPoints:F,properties:ee}}function or(X,ue){var pe=X.geometry.coordinates,F=pe[1];return{x:Ue(pe[0]),y:Le(F),zoom:1/0,index:ue,parentId:-1}}function me(X){return{type:"Feature",id:X.id,properties:Ae(X),geometry:{type:"Point",coordinates:[(F=X.x,360*(F-.5)),(ue=X.y,pe=(180-360*ue)*Math.PI/180,360*Math.atan(Math.exp(pe))/Math.PI-90)]}};var ue,pe,F}function Ae(X){var ue=X.numPoints,pe=ue>=1e4?Math.round(ue/1e3)+"k":ue>=1e3?Math.round(ue/100)/10+"k":ue;return kt(kt({},X.properties),{cluster:!0,cluster_id:X.id,point_count:ue,point_count_abbreviated:pe})}function Ue(X){return X/360+.5}function Le(X){var ue=Math.sin(X*Math.PI/180),pe=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return pe<0?0:pe>1?1:pe}function kt(X,ue){for(var pe in ue)X[pe]=ue[pe];return X}function nr(X){return X.x}function _r(X){return X.y}function Lr(X,ue,pe,F,ee,he){var Te=ee-pe,ae=he-F;if(Te!==0||ae!==0){var Ee=((X-pe)*Te+(ue-F)*ae)/(Te*Te+ae*ae);Ee>1?(pe=ee,F=he):Ee>0&&(pe+=Te*Ee,F+=ae*Ee)}return(Te=X-pe)*Te+(ae=ue-F)*ae}function fr(X,ue,pe,F){var ee={id:X===void 0?null:X,type:ue,geometry:pe,tags:F,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(he){var Te=he.geometry,ae=he.type;if(ae==="Point"||ae==="MultiPoint"||ae==="LineString")H(he,Te);else if(ae==="Polygon"||ae==="MultiLineString")for(var Ee=0;Ee<Te.length;Ee++)H(he,Te[Ee]);else if(ae==="MultiPolygon")for(Ee=0;Ee<Te.length;Ee++)for(var mt=0;mt<Te[Ee].length;mt++)H(he,Te[Ee][mt])}(ee),ee}function H(X,ue){for(var pe=0;pe<ue.length;pe+=3)X.minX=Math.min(X.minX,ue[pe]),X.minY=Math.min(X.minY,ue[pe+1]),X.maxX=Math.max(X.maxX,ue[pe]),X.maxY=Math.max(X.maxY,ue[pe+1])}function E(X,ue,pe,F){if(ue.geometry){var ee=ue.geometry.coordinates,he=ue.geometry.type,Te=Math.pow(pe.tolerance/((1<<pe.maxZoom)*pe.extent),2),ae=[],Ee=ue.id;if(pe.promoteId?Ee=ue.properties[pe.promoteId]:pe.generateId&&(Ee=F||0),he==="Point")V(ee,ae);else if(he==="MultiPoint")for(var mt=0;mt<ee.length;mt++)V(ee[mt],ae);else if(he==="LineString")Ze(ee,ae,Te,!1);else if(he==="MultiLineString"){if(pe.lineMetrics){for(mt=0;mt<ee.length;mt++)Ze(ee[mt],ae=[],Te,!1),X.push(fr(Ee,"LineString",ae,ue.properties));return}tt(ee,ae,Te,!1)}else if(he==="Polygon")tt(ee,ae,Te,!0);else{if(he!=="MultiPolygon"){if(he==="GeometryCollection"){for(mt=0;mt<ue.geometry.geometries.length;mt++)E(X,{id:Ee,geometry:ue.geometry.geometries[mt],properties:ue.properties},pe,F);return}throw new Error("Input data is not a valid GeoJSON object.")}for(mt=0;mt<ee.length;mt++){var Sr=[];tt(ee[mt],Sr,Te,!0),ae.push(Sr)}}X.push(fr(Ee,he,ae,ue.properties))}}function V(X,ue){ue.push(ut(X[0])),ue.push(wt(X[1])),ue.push(0)}function Ze(X,ue,pe,F){for(var ee,he,Te=0,ae=0;ae<X.length;ae++){var Ee=ut(X[ae][0]),mt=wt(X[ae][1]);ue.push(Ee),ue.push(mt),ue.push(0),ae>0&&(Te+=F?(ee*mt-Ee*he)/2:Math.sqrt(Math.pow(Ee-ee,2)+Math.pow(mt-he,2))),ee=Ee,he=mt}var Sr=ue.length-3;ue[2]=1,function Wt(Ke,Zr,kn,Rn){for(var ft,vr=Rn,et=kn-Zr>>1,Dr=kn-Zr,In=Ke[Zr],tr=Ke[Zr+1],Ni=Ke[kn],ia=Ke[kn+1],hi=Zr+3;hi<kn;hi+=3){var Fi=Lr(Ke[hi],Ke[hi+1],In,tr,Ni,ia);if(Fi>vr)ft=hi,vr=Fi;else if(Fi===vr){var Wi=Math.abs(hi-et);Wi<Dr&&(ft=hi,Dr=Wi)}}vr>Rn&&(ft-Zr>3&&Wt(Ke,Zr,ft,Rn),Ke[ft+2]=vr,kn-ft>3&&Wt(Ke,ft,kn,Rn))}(ue,0,Sr,pe),ue[Sr+2]=1,ue.size=Math.abs(Te),ue.start=0,ue.end=ue.size}function tt(X,ue,pe,F){for(var ee=0;ee<X.length;ee++){var he=[];Ze(X[ee],he,pe,F),ue.push(he)}}function ut(X){return X/360+.5}function wt(X){var ue=Math.sin(X*Math.PI/180),pe=.5-.25*Math.log((1+ue)/(1-ue))/Math.PI;return pe<0?0:pe>1?1:pe}function K(X,ue,pe,F,ee,he,Te,ae){if(F/=ue,he>=(pe/=ue)&&Te<F)return X;if(Te<pe||he>=F)return null;for(var Ee=[],mt=0;mt<X.length;mt++){var Sr=X[mt],Wt=Sr.geometry,Ke=Sr.type,Zr=ee===0?Sr.minX:Sr.minY,kn=ee===0?Sr.maxX:Sr.maxY;if(Zr>=pe&&kn<F)Ee.push(Sr);else if(!(kn<pe||Zr>=F)){var Rn=[];if(Ke==="Point"||Ke==="MultiPoint")Ht(Wt,Rn,pe,F,ee);else if(Ke==="LineString")Tr(Wt,Rn,pe,F,ee,!1,ae.lineMetrics);else if(Ke==="MultiLineString")Ye(Wt,Rn,pe,F,ee,!1);else if(Ke==="Polygon")Ye(Wt,Rn,pe,F,ee,!0);else if(Ke==="MultiPolygon")for(var ft=0;ft<Wt.length;ft++){var vr=[];Ye(Wt[ft],vr,pe,F,ee,!0),vr.length&&Rn.push(vr)}if(Rn.length){if(ae.lineMetrics&&Ke==="LineString"){for(ft=0;ft<Rn.length;ft++)Ee.push(fr(Sr.id,Ke,Rn[ft],Sr.tags));continue}Ke!=="LineString"&&Ke!=="MultiLineString"||(Rn.length===1?(Ke="LineString",Rn=Rn[0]):Ke="MultiLineString"),Ke!=="Point"&&Ke!=="MultiPoint"||(Ke=Rn.length===3?"Point":"MultiPoint"),Ee.push(fr(Sr.id,Ke,Rn,Sr.tags))}}}return Ee.length?Ee:null}function Ht(X,ue,pe,F,ee){for(var he=0;he<X.length;he+=3){var Te=X[he+ee];Te>=pe&&Te<=F&&(ue.push(X[he]),ue.push(X[he+1]),ue.push(X[he+2]))}}function Tr(X,ue,pe,F,ee,he,Te){for(var ae,Ee,mt=Or(X),Sr=ee===0?At:zt,Wt=X.start,Ke=0;Ke<X.length-3;Ke+=3){var Zr=X[Ke],kn=X[Ke+1],Rn=X[Ke+2],ft=X[Ke+3],vr=X[Ke+4],et=ee===0?Zr:kn,Dr=ee===0?ft:vr,In=!1;Te&&(ae=Math.sqrt(Math.pow(Zr-ft,2)+Math.pow(kn-vr,2))),et<pe?Dr>pe&&(Ee=Sr(mt,Zr,kn,ft,vr,pe),Te&&(mt.start=Wt+ae*Ee)):et>F?Dr<F&&(Ee=Sr(mt,Zr,kn,ft,vr,F),Te&&(mt.start=Wt+ae*Ee)):lt(mt,Zr,kn,Rn),Dr<pe&&et>=pe&&(Ee=Sr(mt,Zr,kn,ft,vr,pe),In=!0),Dr>F&&et<=F&&(Ee=Sr(mt,Zr,kn,ft,vr,F),In=!0),!he&&In&&(Te&&(mt.end=Wt+ae*Ee),ue.push(mt),mt=Or(X)),Te&&(Wt+=ae)}var tr=X.length-3;Zr=X[tr],kn=X[tr+1],Rn=X[tr+2],(et=ee===0?Zr:kn)>=pe&&et<=F&&lt(mt,Zr,kn,Rn),tr=mt.length-3,he&&tr>=3&&(mt[tr]!==mt[0]||mt[tr+1]!==mt[1])&&lt(mt,mt[0],mt[1],mt[2]),mt.length&&ue.push(mt)}function Or(X){var ue=[];return ue.size=X.size,ue.start=X.start,ue.end=X.end,ue}function Ye(X,ue,pe,F,ee,he){for(var Te=0;Te<X.length;Te++)Tr(X[Te],ue,pe,F,ee,he,!1)}function lt(X,ue,pe,F){X.push(ue),X.push(pe),X.push(F)}function At(X,ue,pe,F,ee,he){var Te=(he-ue)/(F-ue);return X.push(he),X.push(pe+(ee-pe)*Te),X.push(1),Te}function zt(X,ue,pe,F,ee,he){var Te=(he-pe)/(ee-pe);return X.push(ue+(F-ue)*Te),X.push(he),X.push(1),Te}function wr(X,ue){for(var pe=[],F=0;F<X.length;F++){var ee,he=X[F],Te=he.type;if(Te==="Point"||Te==="MultiPoint"||Te==="LineString")ee=Pr(he.geometry,ue);else if(Te==="MultiLineString"||Te==="Polygon"){ee=[];for(var ae=0;ae<he.geometry.length;ae++)ee.push(Pr(he.geometry[ae],ue))}else if(Te==="MultiPolygon")for(ee=[],ae=0;ae<he.geometry.length;ae++){for(var Ee=[],mt=0;mt<he.geometry[ae].length;mt++)Ee.push(Pr(he.geometry[ae][mt],ue));ee.push(Ee)}pe.push(fr(he.id,Te,ee,he.tags))}return pe}function Pr(X,ue){var pe=[];pe.size=X.size,X.start!==void 0&&(pe.start=X.start,pe.end=X.end);for(var F=0;F<X.length;F+=3)pe.push(X[F]+ue,X[F+1],X[F+2]);return pe}function er(X,ue){if(X.transformed)return X;var pe,F,ee,he=1<<X.z,Te=X.x,ae=X.y;for(pe=0;pe<X.features.length;pe++){var Ee=X.features[pe],mt=Ee.geometry,Sr=Ee.type;if(Ee.geometry=[],Sr===1)for(F=0;F<mt.length;F+=2)Ee.geometry.push(Jr(mt[F],mt[F+1],ue,he,Te,ae));else for(F=0;F<mt.length;F++){var Wt=[];for(ee=0;ee<mt[F].length;ee+=2)Wt.push(Jr(mt[F][ee],mt[F][ee+1],ue,he,Te,ae));Ee.geometry.push(Wt)}}return X.transformed=!0,X}function Jr(X,ue,pe,F,ee,he){return[Math.round(pe*(X*F-ee)),Math.round(pe*(ue*F-he))]}function Yr(X,ue,pe,F,ee){for(var he=ue===ee.maxZoom?0:ee.tolerance/((1<<ue)*ee.extent),Te={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:pe,y:F,z:ue,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ae=0;ae<X.length;ae++){Te.numFeatures++,En(Te,X[ae],he,ee);var Ee=X[ae].minX,mt=X[ae].minY,Sr=X[ae].maxX,Wt=X[ae].maxY;Ee<Te.minX&&(Te.minX=Ee),mt<Te.minY&&(Te.minY=mt),Sr>Te.maxX&&(Te.maxX=Sr),Wt>Te.maxY&&(Te.maxY=Wt)}return Te}function En(X,ue,pe,F){var ee=ue.geometry,he=ue.type,Te=[];if(he==="Point"||he==="MultiPoint")for(var ae=0;ae<ee.length;ae+=3)Te.push(ee[ae]),Te.push(ee[ae+1]),X.numPoints++,X.numSimplified++;else if(he==="LineString")_n(Te,ee,X,pe,!1,!1);else if(he==="MultiLineString"||he==="Polygon")for(ae=0;ae<ee.length;ae++)_n(Te,ee[ae],X,pe,he==="Polygon",ae===0);else if(he==="MultiPolygon")for(var Ee=0;Ee<ee.length;Ee++){var mt=ee[Ee];for(ae=0;ae<mt.length;ae++)_n(Te,mt[ae],X,pe,!0,ae===0)}if(Te.length){var Sr=ue.tags||null;if(he==="LineString"&&F.lineMetrics){for(var Wt in Sr={},ue.tags)Sr[Wt]=ue.tags[Wt];Sr.mapbox_clip_start=ee.start/ee.size,Sr.mapbox_clip_end=ee.end/ee.size}var Ke={geometry:Te,type:he==="Polygon"||he==="MultiPolygon"?3:he==="LineString"||he==="MultiLineString"?2:1,tags:Sr};ue.id!==null&&(Ke.id=ue.id),X.features.push(Ke)}}function _n(X,ue,pe,F,ee,he){var Te=F*F;if(F>0&&ue.size<(ee?Te:F))pe.numPoints+=ue.length/3;else{for(var ae=[],Ee=0;Ee<ue.length;Ee+=3)(F===0||ue[Ee+2]>Te)&&(pe.numSimplified++,ae.push(ue[Ee]),ae.push(ue[Ee+1])),pe.numPoints++;ee&&function(mt,Sr){for(var Wt=0,Ke=0,Zr=mt.length,kn=Zr-2;Ke<Zr;kn=Ke,Ke+=2)Wt+=(mt[Ke]-mt[kn])*(mt[Ke+1]+mt[kn+1]);if(Wt>0===Sr)for(Ke=0,Zr=mt.length;Ke<Zr/2;Ke+=2){var Rn=mt[Ke],ft=mt[Ke+1];mt[Ke]=mt[Zr-2-Ke],mt[Ke+1]=mt[Zr-1-Ke],mt[Zr-2-Ke]=Rn,mt[Zr-1-Ke]=ft}}(ae,he),X.push(ae)}}function ei(X,ue){var pe=(ue=this.options=function(ee,he){for(var Te in he)ee[Te]=he[Te];return ee}(Object.create(this.options),ue)).debug;if(pe&&console.time("preprocess data"),ue.maxZoom<0||ue.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ue.promoteId&&ue.generateId)throw new Error("promoteId and generateId cannot be used together.");var F=function(ee,he){var Te=[];if(ee.type==="FeatureCollection")for(var ae=0;ae<ee.features.length;ae++)E(Te,ee.features[ae],he,ae);else E(Te,ee.type==="Feature"?ee:{geometry:ee},he);return Te}(X,ue);this.tiles={},this.tileCoords=[],pe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ue.indexMaxZoom,ue.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(F=function(ee,he){var Te=he.buffer/he.extent,ae=ee,Ee=K(ee,1,-1-Te,Te,0,-1,2,he),mt=K(ee,1,1-Te,2+Te,0,-1,2,he);return(Ee||mt)&&(ae=K(ee,1,-Te,1+Te,0,-1,2,he)||[],Ee&&(ae=wr(Ee,1).concat(ae)),mt&&(ae=ae.concat(wr(mt,-1)))),ae}(F,ue)).length&&this.splitTile(F,0,0,0),pe&&(F.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function si(X,ue,pe){return 32*((1<<X)*pe+ue)+X}function na(X,ue){var pe=X.tileID.canonical;if(!this._geoJSONIndex)return ue(null,null);var F=this._geoJSONIndex.getTile(pe.z,pe.x,pe.y);if(!F)return ue(null,null);var ee=new Tt(F.features),he=Qe(ee);he.byteOffset===0&&he.byteLength===he.buffer.byteLength||(he=new Uint8Array(he)),ue(null,{vectorTile:ee,rawData:he.buffer})}on.prototype.load=function(X){var ue=this.options,pe=ue.log,F=ue.minZoom,ee=ue.maxZoom,he=ue.nodeSize;pe&&console.time("total time");var Te="prepare "+X.length+" points";pe&&console.time(Te),this.points=X;for(var ae=[],Ee=0;Ee<X.length;Ee++)X[Ee].geometry&&ae.push(or(X[Ee],Ee));this.trees[ee+1]=new Ur(ae,nr,_r,he,Float32Array),pe&&console.timeEnd(Te);for(var mt=ee;mt>=F;mt--){var Sr=+Date.now();ae=this._cluster(ae,mt),this.trees[mt]=new Ur(ae,nr,_r,he,Float32Array),pe&&console.log("z%d: %d clusters in %dms",mt,ae.length,+Date.now()-Sr)}return pe&&console.timeEnd("total time"),this},on.prototype.getClusters=function(X,ue){var pe=((X[0]+180)%360+360)%360-180,F=Math.max(-90,Math.min(90,X[1])),ee=X[2]===180?180:((X[2]+180)%360+360)%360-180,he=Math.max(-90,Math.min(90,X[3]));if(X[2]-X[0]>=360)pe=-180,ee=180;else if(pe>ee){var Te=this.getClusters([pe,F,180,he],ue),ae=this.getClusters([-180,F,ee,he],ue);return Te.concat(ae)}for(var Ee=this.trees[this._limitZoom(ue)],mt=[],Sr=0,Wt=Ee.range(Ue(pe),Le(he),Ue(ee),Le(F));Sr<Wt.length;Sr+=1){var Ke=Ee.points[Wt[Sr]];mt.push(Ke.numPoints?me(Ke):this.points[Ke.index])}return mt},on.prototype.getChildren=function(X){var ue=this._getOriginId(X),pe=this._getOriginZoom(X),F="No cluster with the specified id.",ee=this.trees[pe];if(!ee)throw new Error(F);var he=ee.points[ue];if(!he)throw new Error(F);for(var Te=this.options.radius/(this.options.extent*Math.pow(2,pe-1)),ae=[],Ee=0,mt=ee.within(he.x,he.y,Te);Ee<mt.length;Ee+=1){var Sr=ee.points[mt[Ee]];Sr.parentId===X&&ae.push(Sr.numPoints?me(Sr):this.points[Sr.index])}if(ae.length===0)throw new Error(F);return ae},on.prototype.getLeaves=function(X,ue,pe){var F=[];return this._appendLeaves(F,X,ue=ue||10,pe=pe||0,0),F},on.prototype.getTile=function(X,ue,pe){var F=this.trees[this._limitZoom(X)],ee=Math.pow(2,X),he=this.options,Te=he.radius/he.extent,ae=(pe-Te)/ee,Ee=(pe+1+Te)/ee,mt={features:[]};return this._addTileFeatures(F.range((ue-Te)/ee,ae,(ue+1+Te)/ee,Ee),F.points,ue,pe,ee,mt),ue===0&&this._addTileFeatures(F.range(1-Te/ee,ae,1,Ee),F.points,ee,pe,ee,mt),ue===ee-1&&this._addTileFeatures(F.range(0,ae,Te/ee,Ee),F.points,-1,pe,ee,mt),mt.features.length?mt:null},on.prototype.getClusterExpansionZoom=function(X){for(var ue=this._getOriginZoom(X)-1;ue<=this.options.maxZoom;){var pe=this.getChildren(X);if(ue++,pe.length!==1)break;X=pe[0].properties.cluster_id}return ue},on.prototype._appendLeaves=function(X,ue,pe,F,ee){for(var he=0,Te=this.getChildren(ue);he<Te.length;he+=1){var ae=Te[he],Ee=ae.properties;if(Ee&&Ee.cluster?ee+Ee.point_count<=F?ee+=Ee.point_count:ee=this._appendLeaves(X,Ee.cluster_id,pe,F,ee):ee<F?ee++:X.push(ae),X.length===pe)break}return ee},on.prototype._addTileFeatures=function(X,ue,pe,F,ee,he){for(var Te=0,ae=X;Te<ae.length;Te+=1){var Ee=ue[ae[Te]],mt=Ee.numPoints,Sr={type:1,geometry:[[Math.round(this.options.extent*(Ee.x*ee-pe)),Math.round(this.options.extent*(Ee.y*ee-F))]],tags:mt?Ae(Ee):this.points[Ee.index].properties},Wt=void 0;mt?Wt=Ee.id:this.options.generateId?Wt=Ee.index:this.points[Ee.index].id&&(Wt=this.points[Ee.index].id),Wt!==void 0&&(Sr.id=Wt),he.features.push(Sr)}},on.prototype._limitZoom=function(X){return Math.max(this.options.minZoom,Math.min(+X,this.options.maxZoom+1))},on.prototype._cluster=function(X,ue){for(var pe=[],F=this.options,ee=F.reduce,he=F.minPoints,Te=F.radius/(F.extent*Math.pow(2,ue)),ae=0;ae<X.length;ae++){var Ee=X[ae];if(!(Ee.zoom<=ue)){Ee.zoom=ue;for(var mt=this.trees[ue+1],Sr=mt.within(Ee.x,Ee.y,Te),Wt=Ee.numPoints||1,Ke=Wt,Zr=0,kn=Sr;Zr<kn.length;Zr+=1){var Rn=mt.points[kn[Zr]];Rn.zoom>ue&&(Ke+=Rn.numPoints||1)}if(Ke>=he){for(var ft=Ee.x*Wt,vr=Ee.y*Wt,et=ee&&Wt>1?this._map(Ee,!0):null,Dr=(ae<<5)+(ue+1)+this.points.length,In=0,tr=Sr;In<tr.length;In+=1){var Ni=mt.points[tr[In]];if(!(Ni.zoom<=ue)){Ni.zoom=ue;var ia=Ni.numPoints||1;ft+=Ni.x*ia,vr+=Ni.y*ia,Ni.parentId=Dr,ee&&(et||(et=this._map(Ee,!0)),ee(et,this._map(Ni)))}}Ee.parentId=Dr,pe.push($i(ft/Ke,vr/Ke,Dr,Ke,et))}else if(pe.push(Ee),Ke>1)for(var hi=0,Fi=Sr;hi<Fi.length;hi+=1){var Wi=mt.points[Fi[hi]];Wi.zoom<=ue||(Wi.zoom=ue,pe.push(Wi))}}}return pe},on.prototype._getOriginId=function(X){return X-this.points.length>>5},on.prototype._getOriginZoom=function(X){return(X-this.points.length)%32},on.prototype._map=function(X,ue){if(X.numPoints)return ue?kt({},X.properties):X.properties;var pe=this.points[X.index].properties,F=this.options.map(pe);return ue&&F===pe?kt({},F):F},ei.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ei.prototype.splitTile=function(X,ue,pe,F,ee,he,Te){for(var ae=[X,ue,pe,F],Ee=this.options,mt=Ee.debug;ae.length;){F=ae.pop(),pe=ae.pop(),ue=ae.pop(),X=ae.pop();var Sr=1<<ue,Wt=si(ue,pe,F),Ke=this.tiles[Wt];if(!Ke&&(mt>1&&console.time("creation"),Ke=this.tiles[Wt]=Yr(X,ue,pe,F,Ee),this.tileCoords.push({z:ue,x:pe,y:F}),mt)){mt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ue,pe,F,Ke.numFeatures,Ke.numPoints,Ke.numSimplified),console.timeEnd("creation"));var Zr="z"+ue;this.stats[Zr]=(this.stats[Zr]||0)+1,this.total++}if(Ke.source=X,ee){if(ue===Ee.maxZoom||ue===ee)continue;var kn=1<<ee-ue;if(pe!==Math.floor(he/kn)||F!==Math.floor(Te/kn))continue}else if(ue===Ee.indexMaxZoom||Ke.numPoints<=Ee.indexMaxPoints)continue;if(Ke.source=null,X.length!==0){mt>1&&console.time("clipping");var Rn,ft,vr,et,Dr,In,tr=.5*Ee.buffer/Ee.extent,Ni=.5-tr,ia=.5+tr,hi=1+tr;Rn=ft=vr=et=null,Dr=K(X,Sr,pe-tr,pe+ia,0,Ke.minX,Ke.maxX,Ee),In=K(X,Sr,pe+Ni,pe+hi,0,Ke.minX,Ke.maxX,Ee),X=null,Dr&&(Rn=K(Dr,Sr,F-tr,F+ia,1,Ke.minY,Ke.maxY,Ee),ft=K(Dr,Sr,F+Ni,F+hi,1,Ke.minY,Ke.maxY,Ee),Dr=null),In&&(vr=K(In,Sr,F-tr,F+ia,1,Ke.minY,Ke.maxY,Ee),et=K(In,Sr,F+Ni,F+hi,1,Ke.minY,Ke.maxY,Ee),In=null),mt>1&&console.timeEnd("clipping"),ae.push(Rn||[],ue+1,2*pe,2*F),ae.push(ft||[],ue+1,2*pe,2*F+1),ae.push(vr||[],ue+1,2*pe+1,2*F),ae.push(et||[],ue+1,2*pe+1,2*F+1)}}},ei.prototype.getTile=function(X,ue,pe){var F=this.options,ee=F.extent,he=F.debug;if(X<0||X>24)return null;var Te=1<<X,ae=si(X,ue=(ue%Te+Te)%Te,pe);if(this.tiles[ae])return er(this.tiles[ae],ee);he>1&&console.log("drilling down to z%d-%d-%d",X,ue,pe);for(var Ee,mt=X,Sr=ue,Wt=pe;!Ee&&mt>0;)mt--,Sr=Math.floor(Sr/2),Wt=Math.floor(Wt/2),Ee=this.tiles[si(mt,Sr,Wt)];return Ee&&Ee.source?(he>1&&console.log("found parent tile z%d-%d-%d",mt,Sr,Wt),he>1&&console.time("drilling down"),this.splitTile(Ee.source,mt,Sr,Wt,X,ue,pe),he>1&&console.timeEnd("drilling down"),this.tiles[ae]?er(this.tiles[ae],ee):null):null};var Zi=function(X){function ue(pe,F,ee,he){X.call(this,pe,F,ee,na),he&&(this.loadGeoJSON=he)}return X&&(ue.__proto__=X),(ue.prototype=Object.create(X&&X.prototype)).constructor=ue,ue.prototype.loadData=function(pe,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=F,this._pendingLoadDataParams=pe,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},ue.prototype._loadData=function(){var pe=this;if(this._pendingCallback&&this._pendingLoadDataParams){var F=this._pendingCallback,ee=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var he=!!(ee&&ee.request&&ee.request.collectResourceTiming)&&new d.RequestPerformance(ee.request);this.loadGeoJSON(ee,function(Te,ae){if(Te||!ae)return F(Te);if(typeof ae!="object")return F(new Error("Input data given to '"+ee.source+"' is not a valid GeoJSON object."));(function Ke(Zr,kn){var Rn,ft=Zr&&Zr.type;if(ft==="FeatureCollection")for(Rn=0;Rn<Zr.features.length;Rn++)Ke(Zr.features[Rn],kn);else if(ft==="GeometryCollection")for(Rn=0;Rn<Zr.geometries.length;Rn++)Ke(Zr.geometries[Rn],kn);else if(ft==="Feature")Ke(Zr.geometry,kn);else if(ft==="Polygon")Qt(Zr.coordinates,kn);else if(ft==="MultiPolygon")for(Rn=0;Rn<Zr.coordinates.length;Rn++)Qt(Zr.coordinates[Rn],kn);return Zr})(ae,!0);try{if(ee.filter){var Ee=d.createExpression(ee.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Ee.result==="error")throw new Error(Ee.value.map(function(Ke){return Ke.key+": "+Ke.message}).join(", "));var mt=ae.features.filter(function(Ke){return Ee.value.evaluate({zoom:0},Ke)});ae={type:"FeatureCollection",features:mt}}pe._geoJSONIndex=ee.cluster?new on(function(Ke){var Zr=Ke.superclusterOptions,kn=Ke.clusterProperties;if(!kn||!Zr)return Zr;for(var Rn={},ft={},vr={accumulated:null,zoom:0},et={properties:null},Dr=Object.keys(kn),In=0,tr=Dr;In<tr.length;In+=1){var Ni=tr[In],ia=kn[Ni],hi=ia[0],Fi=d.createExpression(ia[1]),Wi=d.createExpression(typeof hi=="string"?[hi,["accumulated"],["get",Ni]]:hi);Rn[Ni]=Fi.value,ft[Ni]=Wi.value}return Zr.map=function(yi){et.properties=yi;for(var ya={},La=0,_i=Dr;La<_i.length;La+=1){var Mi=_i[La];ya[Mi]=Rn[Mi].evaluate(vr,et)}return ya},Zr.reduce=function(yi,ya){et.properties=ya;for(var La=0,_i=Dr;La<_i.length;La+=1){var Mi=_i[La];vr.accumulated=yi[Mi],yi[Mi]=ft[Mi].evaluate(vr,et)}},Zr}(ee)).load(ae.features):function(Ke,Zr){return new ei(Ke,Zr)}(ae,ee.geojsonVtOptions)}catch(Ke){return F(Ke)}pe.loaded={};var Sr={};if(he){var Wt=he.finish();Wt&&(Sr.resourceTiming={},Sr.resourceTiming[ee.source]=JSON.parse(JSON.stringify(Wt)))}F(null,Sr)})}},ue.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},ue.prototype.reloadTile=function(pe,F){var ee=this.loaded;return ee&&ee[pe.uid]?X.prototype.reloadTile.call(this,pe,F):this.loadTile(pe,F)},ue.prototype.loadGeoJSON=function(pe,F){if(pe.request)d.getJSON(pe.request,F);else{if(typeof pe.data!="string")return F(new Error("Input data given to '"+pe.source+"' is not a valid GeoJSON object."));try{return F(null,JSON.parse(pe.data))}catch(ee){return F(new Error("Input data given to '"+pe.source+"' is not a valid GeoJSON object."))}}},ue.prototype.removeSource=function(pe,F){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),F()},ue.prototype.getClusterExpansionZoom=function(pe,F){try{F(null,this._geoJSONIndex.getClusterExpansionZoom(pe.clusterId))}catch(ee){F(ee)}},ue.prototype.getClusterChildren=function(pe,F){try{F(null,this._geoJSONIndex.getChildren(pe.clusterId))}catch(ee){F(ee)}},ue.prototype.getClusterLeaves=function(pe,F){try{F(null,this._geoJSONIndex.getLeaves(pe.clusterId,pe.limit,pe.offset))}catch(ee){F(ee)}},ue}(bt),Pi=function(X){var ue=this;this.self=X,this.actor=new d.Actor(X,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:bt,geojson:Zi},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(pe,F){if(ue.workerSourceTypes[pe])throw new Error('Worker source with name "'+pe+'" already registered.');ue.workerSourceTypes[pe]=F},this.self.registerRTLTextPlugin=function(pe){if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=pe.applyArabicShaping,d.plugin.processBidirectionalText=pe.processBidirectionalText,d.plugin.processStyledBidirectionalText=pe.processStyledBidirectionalText}};return Pi.prototype.setReferrer=function(X,ue){this.referrer=ue},Pi.prototype.setImages=function(X,ue,pe){for(var F in this.availableImages[X]=ue,this.workerSources[X]){var ee=this.workerSources[X][F];for(var he in ee)ee[he].availableImages=ue}pe()},Pi.prototype.setLayers=function(X,ue,pe){this.getLayerIndex(X).replace(ue),pe()},Pi.prototype.updateLayers=function(X,ue,pe){this.getLayerIndex(X).update(ue.layers,ue.removedIds),pe()},Pi.prototype.loadTile=function(X,ue,pe){this.getWorkerSource(X,ue.type,ue.source).loadTile(ue,pe)},Pi.prototype.loadDEMTile=function(X,ue,pe){this.getDEMWorkerSource(X,ue.source).loadTile(ue,pe)},Pi.prototype.reloadTile=function(X,ue,pe){this.getWorkerSource(X,ue.type,ue.source).reloadTile(ue,pe)},Pi.prototype.abortTile=function(X,ue,pe){this.getWorkerSource(X,ue.type,ue.source).abortTile(ue,pe)},Pi.prototype.removeTile=function(X,ue,pe){this.getWorkerSource(X,ue.type,ue.source).removeTile(ue,pe)},Pi.prototype.removeDEMTile=function(X,ue){this.getDEMWorkerSource(X,ue.source).removeTile(ue)},Pi.prototype.removeSource=function(X,ue,pe){if(this.workerSources[X]&&this.workerSources[X][ue.type]&&this.workerSources[X][ue.type][ue.source]){var F=this.workerSources[X][ue.type][ue.source];delete this.workerSources[X][ue.type][ue.source],F.removeSource!==void 0?F.removeSource(ue,pe):pe()}},Pi.prototype.loadWorkerSource=function(X,ue,pe){try{this.self.importScripts(ue.url),pe()}catch(F){pe(F.toString())}},Pi.prototype.syncRTLPluginState=function(X,ue,pe){try{d.plugin.setState(ue);var F=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&F!=null){this.self.importScripts(F);var ee=d.plugin.isParsed();pe(ee?void 0:new Error("RTL Text Plugin failed to import scripts from "+F),ee)}}catch(he){pe(he.toString())}},Pi.prototype.getAvailableImages=function(X){var ue=this.availableImages[X];return ue||(ue=[]),ue},Pi.prototype.getLayerIndex=function(X){var ue=this.layerIndexes[X];return ue||(ue=this.layerIndexes[X]=new ie),ue},Pi.prototype.getWorkerSource=function(X,ue,pe){var F=this;return this.workerSources[X]||(this.workerSources[X]={}),this.workerSources[X][ue]||(this.workerSources[X][ue]={}),this.workerSources[X][ue][pe]||(this.workerSources[X][ue][pe]=new this.workerSourceTypes[ue]({send:function(ee,he,Te){F.actor.send(ee,he,Te,X)}},this.getLayerIndex(X),this.getAvailableImages(X))),this.workerSources[X][ue][pe]},Pi.prototype.getDEMWorkerSource=function(X,ue){return this.demWorkerSources[X]||(this.demWorkerSources[X]={}),this.demWorkerSources[X][ue]||(this.demWorkerSources[X][ue]=new Ir),this.demWorkerSources[X][ue]},Pi.prototype.enforceCacheSizeLimit=function(X,ue){d.enforceCacheSizeLimit(ue)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new Pi(self)),Pi}),C(["./shared"],function(d){"use strict";var de=d.createCommonjsModule(function(i){function u(y){return!o(y)}function o(y){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var T,R,j=new Blob([""],{type:"text/javascript"}),ne=URL.createObjectURL(j);try{R=new Worker(ne),T=!0}catch(be){T=!1}return R&&R.terminate(),URL.revokeObjectURL(ne),T}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var T=document.createElement("canvas");T.width=T.height=1;var R=T.getContext("2d");if(!R)return!1;var j=R.getImageData(0,0,1,1);return j&&j.width===T.width}()?(h[b=y&&y.failIfMajorPerformanceCaveat]===void 0&&(h[b]=function(T){var R=function(ne){var be=document.createElement("canvas"),Ce=Object.create(u.webGLContextAttributes);return Ce.failIfMajorPerformanceCaveat=ne,be.probablySupportsContext?be.probablySupportsContext("webgl",Ce)||be.probablySupportsContext("experimental-webgl",Ce):be.supportsContext?be.supportsContext("webgl",Ce)||be.supportsContext("experimental-webgl",Ce):be.getContext("webgl",Ce)||be.getContext("experimental-webgl",Ce)}(T);if(!R)return!1;var j=R.createShader(R.VERTEX_SHADER);return!(!j||R.isContextLost())&&(R.shaderSource(j,"void main() {}"),R.compileShader(j),R.getShaderParameter(j,R.COMPILE_STATUS)===!0)}(b)),h[b]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var b}i.exports?i.exports=u:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=u,window.mapboxgl.notSupportedReason=o);var h={};u.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),re={create:function(i,u,o){var h=d.window.document.createElement(i);return u!==void 0&&(h.className=u),o&&o.appendChild(h),h},createNS:function(i,u){return d.window.document.createElementNS(i,u)}},ie=d.window.document&&d.window.document.documentElement.style;function se(i){if(!ie)return i[0];for(var u=0;u<i.length;u++)if(i[u]in ie)return i[u];return i[0]}var Be,$=se(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);re.disableDrag=function(){ie&&$&&(Be=ie[$],ie[$]="none")},re.enableDrag=function(){ie&&$&&(ie[$]=Be)};var Je=se(["transform","WebkitTransform"]);re.setTransform=function(i,u){i.style[Je]=u};var bt=!1;try{var Gt=Object.defineProperty({},"passive",{get:function(){bt=!0}});d.window.addEventListener("test",Gt,Gt),d.window.removeEventListener("test",Gt,Gt)}catch(i){bt=!1}re.addEventListener=function(i,u,o,h){h===void 0&&(h={}),i.addEventListener(u,o,"passive"in h&&bt?h:h.capture)},re.removeEventListener=function(i,u,o,h){h===void 0&&(h={}),i.removeEventListener(u,o,"passive"in h&&bt?h:h.capture)};var Ir=function(i){i.preventDefault(),i.stopPropagation(),d.window.removeEventListener("click",Ir,!0)};function Qt(i){var u=i.userImage;return!!(u&&u.render&&u.render())&&(i.data.replace(new Uint8Array(u.data.buffer)),!0)}re.suppressClick=function(){d.window.addEventListener("click",Ir,!0),d.window.setTimeout(function(){d.window.removeEventListener("click",Ir,!0)},0)},re.mousePos=function(i,u){var o=i.getBoundingClientRect();return new d.Point(u.clientX-o.left-i.clientLeft,u.clientY-o.top-i.clientTop)},re.touchPos=function(i,u){for(var o=i.getBoundingClientRect(),h=[],y=0;y<u.length;y++)h.push(new d.Point(u[y].clientX-o.left-i.clientLeft,u[y].clientY-o.top-i.clientTop));return h},re.mouseButton=function(i){return d.window.InstallTrigger!==void 0&&i.button===2&&i.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:i.button},re.remove=function(i){i.parentNode&&i.parentNode.removeChild(i)};var Yt=function(i){function u(){i.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.isLoaded=function(){return this.loaded},u.prototype.setLoaded=function(o){if(this.loaded!==o&&(this.loaded=o,o)){for(var h=0,y=this.requestors;h<y.length;h+=1){var b=y[h];this._notify(b.ids,b.callback)}this.requestors=[]}},u.prototype.getImage=function(o){return this.images[o]},u.prototype.addImage=function(o,h){this._validate(o,h)&&(this.images[o]=h)},u.prototype._validate=function(o,h){var y=!0;return this._validateStretch(h.stretchX,h.data&&h.data.width)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchX" value'))),y=!1),this._validateStretch(h.stretchY,h.data&&h.data.height)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "stretchY" value'))),y=!1),this._validateContent(h.content,h)||(this.fire(new d.ErrorEvent(new Error('Image "'+o+'" has invalid "content" value'))),y=!1),y},u.prototype._validateStretch=function(o,h){if(!o)return!0;for(var y=0,b=0,T=o;b<T.length;b+=1){var R=T[b];if(R[0]<y||R[1]<R[0]||h<R[1])return!1;y=R[1]}return!0},u.prototype._validateContent=function(o,h){return!(o&&(o.length!==4||o[0]<0||h.data.width<o[0]||o[1]<0||h.data.height<o[1]||o[2]<0||h.data.width<o[2]||o[3]<0||h.data.height<o[3]||o[2]<o[0]||o[3]<o[1]))},u.prototype.updateImage=function(o,h){h.version=this.images[o].version+1,this.images[o]=h,this.updatedImages[o]=!0},u.prototype.removeImage=function(o){var h=this.images[o];delete this.images[o],delete this.patterns[o],h.userImage&&h.userImage.onRemove&&h.userImage.onRemove()},u.prototype.listImages=function(){return Object.keys(this.images)},u.prototype.getImages=function(o,h){var y=!0;if(!this.isLoaded())for(var b=0,T=o;b<T.length;b+=1)this.images[T[b]]||(y=!1);this.isLoaded()||y?this._notify(o,h):this.requestors.push({ids:o,callback:h})},u.prototype._notify=function(o,h){for(var y={},b=0,T=o;b<T.length;b+=1){var R=T[b];this.images[R]||this.fire(new d.Event("styleimagemissing",{id:R}));var j=this.images[R];j?y[R]={data:j.data.clone(),pixelRatio:j.pixelRatio,sdf:j.sdf,version:j.version,stretchX:j.stretchX,stretchY:j.stretchY,content:j.content,hasRenderCallback:Boolean(j.userImage&&j.userImage.render)}:d.warnOnce('Image "'+R+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}h(null,y)},u.prototype.getPixelSize=function(){var o=this.atlasImage;return{width:o.width,height:o.height}},u.prototype.getPattern=function(o){var h=this.patterns[o],y=this.getImage(o);if(!y)return null;if(h&&h.position.version===y.version)return h.position;if(h)h.position.version=y.version;else{var b={w:y.data.width+2,h:y.data.height+2,x:0,y:0},T=new d.ImagePosition(b,y);this.patterns[o]={bin:b,position:T}}return this._updatePatternAtlas(),this.patterns[o].position},u.prototype.bind=function(o){var h=o.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(o,this.atlasImage,h.RGBA),this.atlasTexture.bind(h.LINEAR,h.CLAMP_TO_EDGE)},u.prototype._updatePatternAtlas=function(){var o=[];for(var h in this.patterns)o.push(this.patterns[h].bin);var y=d.potpack(o),b=y.w,T=y.h,R=this.atlasImage;for(var j in R.resize({width:b||1,height:T||1}),this.patterns){var ne=this.patterns[j].bin,be=ne.x+1,Ce=ne.y+1,Pe=this.images[j].data,He=Pe.width,je=Pe.height;d.RGBAImage.copy(Pe,R,{x:0,y:0},{x:be,y:Ce},{width:He,height:je}),d.RGBAImage.copy(Pe,R,{x:0,y:je-1},{x:be,y:Ce-1},{width:He,height:1}),d.RGBAImage.copy(Pe,R,{x:0,y:0},{x:be,y:Ce+je},{width:He,height:1}),d.RGBAImage.copy(Pe,R,{x:He-1,y:0},{x:be-1,y:Ce},{width:1,height:je}),d.RGBAImage.copy(Pe,R,{x:0,y:0},{x:be+He,y:Ce},{width:1,height:je})}this.dirty=!0},u.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},u.prototype.dispatchRenderCallbacks=function(o){for(var h=0,y=o;h<y.length;h+=1){var b=y[h];if(!this.callbackDispatchedThisFrame[b]){this.callbackDispatchedThisFrame[b]=!0;var T=this.images[b];Qt(T)&&this.updateImage(b,T)}}},u}(d.Evented),ir=Ct,jt=Ct,Tt=1e20;function Ct(i,u,o,h,y,b){this.fontSize=i||24,this.buffer=u===void 0?3:u,this.cutoff=h||.25,this.fontFamily=y||"sans-serif",this.fontWeight=b||"normal",this.radius=o||8;var T=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=T,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(T*T),this.gridInner=new Float64Array(T*T),this.f=new Float64Array(T),this.d=new Float64Array(T),this.z=new Float64Array(T+1),this.v=new Int16Array(T),this.middle=Math.round(T/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function br(i,u,o,h,y,b,T){for(var R=0;R<u;R++){for(var j=0;j<o;j++)h[j]=i[j*u+R];for(q(h,y,b,T,o),j=0;j<o;j++)i[j*u+R]=y[j]}for(j=0;j<o;j++){for(R=0;R<u;R++)h[R]=i[j*u+R];for(q(h,y,b,T,u),R=0;R<u;R++)i[j*u+R]=Math.sqrt(y[R])}}function q(i,u,o,h,y){o[0]=0,h[0]=-Tt,h[1]=+Tt;for(var b=1,T=0;b<y;b++){for(var R=(i[b]+b*b-(i[o[T]]+o[T]*o[T]))/(2*b-2*o[T]);R<=h[T];)T--,R=(i[b]+b*b-(i[o[T]]+o[T]*o[T]))/(2*b-2*o[T]);o[++T]=b,h[T]=R,h[T+1]=+Tt}for(b=0,T=0;b<y;b++){for(;h[T+1]<b;)T++;u[b]=(b-o[T])*(b-o[T])+i[o[T]]}}Ct.prototype.draw=function(i){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(i,this.buffer,this.middle);for(var u=this.ctx.getImageData(0,0,this.size,this.size),o=new Uint8ClampedArray(this.size*this.size),h=0;h<this.size*this.size;h++){var y=u.data[4*h+3]/255;this.gridOuter[h]=y===1?0:y===0?Tt:Math.pow(Math.max(0,.5-y),2),this.gridInner[h]=y===1?Tt:y===0?0:Math.pow(Math.max(0,y-.5),2)}for(br(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),br(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),h=0;h<this.size*this.size;h++)o[h]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[h]-this.gridInner[h])/this.radius+this.cutoff))));return o},ir.default=jt;var dr=function(i,u){this.requestManager=i,this.localIdeographFontFamily=u,this.entries={}};dr.prototype.setURL=function(i){this.url=i},dr.prototype.getGlyphs=function(i,u){var o=this,h=[];for(var y in i)for(var b=0,T=i[y];b<T.length;b+=1)h.push({stack:y,id:T[b]});d.asyncAll(h,function(R,j){var ne=R.stack,be=R.id,Ce=o.entries[ne];Ce||(Ce=o.entries[ne]={glyphs:{},requests:{},ranges:{}});var Pe=Ce.glyphs[be];if(Pe===void 0){if(Pe=o._tinySDF(Ce,ne,be))return Ce.glyphs[be]=Pe,void j(null,{stack:ne,id:be,glyph:Pe});var He=Math.floor(be/256);if(256*He>65535)j(new Error("glyphs > 65535 not supported"));else if(Ce.ranges[He])j(null,{stack:ne,id:be,glyph:Pe});else{var je=Ce.requests[He];je||(je=Ce.requests[He]=[],dr.loadGlyphRange(ne,He,o.url,o.requestManager,function(ot,ze){if(ze){for(var at in ze)o._doesCharSupportLocalGlyph(+at)||(Ce.glyphs[+at]=ze[+at]);Ce.ranges[He]=!0}for(var Et=0,Vt=je;Et<Vt.length;Et+=1)(0,Vt[Et])(ot,ze);delete Ce.requests[He]})),je.push(function(ot,ze){ot?j(ot):ze&&j(null,{stack:ne,id:be,glyph:ze[be]||null})})}}else j(null,{stack:ne,id:be,glyph:Pe})},function(R,j){if(R)u(R);else if(j){for(var ne={},be=0,Ce=j;be<Ce.length;be+=1){var Pe=Ce[be],He=Pe.stack,je=Pe.id,ot=Pe.glyph;(ne[He]||(ne[He]={}))[je]=ot&&{id:ot.id,bitmap:ot.bitmap.clone(),metrics:ot.metrics}}u(null,ne)}})},dr.prototype._doesCharSupportLocalGlyph=function(i){return!!this.localIdeographFontFamily&&(d.isChar["CJK Unified Ideographs"](i)||d.isChar["Hangul Syllables"](i)||d.isChar.Hiragana(i)||d.isChar.Katakana(i))},dr.prototype._tinySDF=function(i,u,o){var h=this.localIdeographFontFamily;if(h&&this._doesCharSupportLocalGlyph(o)){var y=i.tinySDF;if(!y){var b="400";/bold/i.test(u)?b="900":/medium/i.test(u)?b="500":/light/i.test(u)&&(b="200"),y=i.tinySDF=new dr.TinySDF(24,3,8,.25,h,b)}return{id:o,bitmap:new d.AlphaImage({width:30,height:30},y.draw(String.fromCharCode(o))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},dr.loadGlyphRange=function(i,u,o,h,y){var b=256*u,T=b+255,R=h.transformRequest(h.normalizeGlyphsURL(o).replace("{fontstack}",i).replace("{range}",b+"-"+T),d.ResourceType.Glyphs);d.getArrayBuffer(R,function(j,ne){if(j)y(j);else if(ne){for(var be={},Ce=0,Pe=d.parseGlyphPBF(ne);Ce<Pe.length;Ce+=1){var He=Pe[Ce];be[He.id]=He}y(null,be)}})},dr.TinySDF=ir;var Qe=function(){this.specification=d.styleSpec.light.position};Qe.prototype.possiblyEvaluate=function(i,u){return d.sphericalToCartesian(i.expression.evaluate(u))},Qe.prototype.interpolate=function(i,u,o){return{x:d.number(i.x,u.x,o),y:d.number(i.y,u.y,o),z:d.number(i.z,u.z,o)}};var $e=new d.Properties({anchor:new d.DataConstantProperty(d.styleSpec.light.anchor),position:new Qe,color:new d.DataConstantProperty(d.styleSpec.light.color),intensity:new d.DataConstantProperty(d.styleSpec.light.intensity)}),Rt=function(i){function u(o){i.call(this),this._transitionable=new d.Transitionable($e),this.setLight(o),this._transitioning=this._transitionable.untransitioned()}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getLight=function(){return this._transitionable.serialize()},u.prototype.setLight=function(o,h){if(h===void 0&&(h={}),!this._validate(d.validateLight,o,h))for(var y in o){var b=o[y];d.endsWith(y,"-transition")?this._transitionable.setTransition(y.slice(0,-"-transition".length),b):this._transitionable.setValue(y,b)}},u.prototype.updateTransitions=function(o){this._transitioning=this._transitionable.transitioned(o,this._transitioning)},u.prototype.hasTransition=function(){return this._transitioning.hasTransition()},u.prototype.recalculate=function(o){this.properties=this._transitioning.possiblyEvaluate(o)},u.prototype._validate=function(o,h,y){return(!y||y.validate!==!1)&&d.emitValidationErrors(this,o.call(d.validateStyle,d.extend({value:h,style:{glyphs:!0,sprite:!0},styleSpec:d.styleSpec})))},u}(d.Evented),Xe=function(i,u){this.width=i,this.height=u,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Xe.prototype.getDash=function(i,u){var o=i.join(",")+String(u);return this.dashEntry[o]||(this.dashEntry[o]=this.addDash(i,u)),this.dashEntry[o]},Xe.prototype.getDashRanges=function(i,u,o){var h=[],y=i.length%2==1?-i[i.length-1]*o:0,b=i[0]*o,T=!0;h.push({left:y,right:b,isDash:T,zeroLength:i[0]===0});for(var R=i[0],j=1;j<i.length;j++){var ne=i[j];h.push({left:y=R*o,right:b=(R+=ne)*o,isDash:T=!T,zeroLength:ne===0})}return h},Xe.prototype.addRoundDash=function(i,u,o){for(var h=u/2,y=-o;y<=o;y++)for(var b=this.width*(this.nextRow+o+y),T=0,R=i[T],j=0;j<this.width;j++){j/R.right>1&&(R=i[++T]);var ne=Math.abs(j-R.left),be=Math.abs(j-R.right),Ce=Math.min(ne,be),Pe=void 0,He=y/o*(h+1);if(R.isDash){var je=h-Math.abs(He);Pe=Math.sqrt(Ce*Ce+je*je)}else Pe=h-Math.sqrt(Ce*Ce+He*He);this.data[b+j]=Math.max(0,Math.min(255,Pe+128))}},Xe.prototype.addRegularDash=function(i){for(var u=i.length-1;u>=0;--u){var o=i[u],h=i[u+1];o.zeroLength?i.splice(u,1):h&&h.isDash===o.isDash&&(h.left=o.left,i.splice(u,1))}var y=i[0],b=i[i.length-1];y.isDash===b.isDash&&(y.left=b.left-this.width,b.right=y.right+this.width);for(var T=this.width*this.nextRow,R=0,j=i[R],ne=0;ne<this.width;ne++){ne/j.right>1&&(j=i[++R]);var be=Math.abs(ne-j.left),Ce=Math.abs(ne-j.right),Pe=Math.min(be,Ce);this.data[T+ne]=Math.max(0,Math.min(255,(j.isDash?Pe:-Pe)+128))}},Xe.prototype.addDash=function(i,u){var o=u?7:0,h=2*o+1;if(this.nextRow+h>this.height)return d.warnOnce("LineAtlas out of space"),null;for(var y=0,b=0;b<i.length;b++)y+=i[b];if(y!==0){var T=this.width/y,R=this.getDashRanges(i,this.width,T);u?this.addRoundDash(R,T,o):this.addRegularDash(R)}var j={y:(this.nextRow+o+.5)/this.height,height:2*o/this.height,width:y};return this.nextRow+=h,this.dirty=!0,j},Xe.prototype.bind=function(i){var u=i.gl;this.texture?(u.bindTexture(u.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,u.texSubImage2D(u.TEXTURE_2D,0,0,0,this.width,this.height,u.ALPHA,u.UNSIGNED_BYTE,this.data))):(this.texture=u.createTexture(),u.bindTexture(u.TEXTURE_2D,this.texture),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,u.REPEAT),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,u.LINEAR),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,u.LINEAR),u.texImage2D(u.TEXTURE_2D,0,u.ALPHA,this.width,this.height,0,u.ALPHA,u.UNSIGNED_BYTE,this.data))};var Zt=function i(u,o){this.workerPool=u,this.actors=[],this.currentActor=0,this.id=d.uniqueId();for(var h=this.workerPool.acquire(this.id),y=0;y<h.length;y++){var b=new i.Actor(h[y],o,this.id);b.name="Worker "+y,this.actors.push(b)}};function xr(i,u,o){var h=function(y,b){if(y)return o(y);if(b){var T=d.pick(d.extend(b,i),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);b.vector_layers&&(T.vectorLayers=b.vector_layers,T.vectorLayerIds=T.vectorLayers.map(function(R){return R.id})),T.tiles=u.canonicalizeTileset(T,i.url),o(null,T)}};return i.url?d.getJSON(u.transformRequest(u.normalizeSourceURL(i.url),d.ResourceType.Source),h):d.browser.frame(function(){return h(null,i)})}Zt.prototype.broadcast=function(i,u,o){d.asyncAll(this.actors,function(h,y){h.send(i,u,y)},o=o||function(){})},Zt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Zt.prototype.remove=function(){this.actors.forEach(function(i){i.remove()}),this.actors=[],this.workerPool.release(this.id)},Zt.Actor=d.Actor;var qt=function(i,u,o){this.bounds=d.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=o||24};qt.prototype.validateBounds=function(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]},qt.prototype.contains=function(i){var u=Math.pow(2,i.z),o=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),h=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),y=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),b=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=o&&i.x<y&&i.y>=h&&i.y<b};var Xr=function(i){function u(o,h,y,b){if(i.call(this),this.id=o,this.dispatcher=y,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(h,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},h),this._collectResourceTiming=h.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(b)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(h,y){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new d.ErrorEvent(h)):y&&(d.extend(o,y),y.bounds&&(o.tileBounds=new qt(y.bounds,o.minzoom,o.maxzoom)),d.postTurnstileEvent(y.tiles,o.map._requestManager._customAccessToken),d.postMapLoadEvent(y.tiles,o.map._getMapId(),o.map._requestManager._skuToken,o.map._requestManager._customAccessToken),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setSourceProperty=function(o){this._tileJSONRequest&&this._tileJSONRequest.cancel(),o(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},u.prototype.setTiles=function(o){var h=this;return this.setSourceProperty(function(){h._options.tiles=o}),this},u.prototype.setUrl=function(o){var h=this;return this.setSourceProperty(function(){h.url=o,h._options.url=o}),this},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.loadTile=function(o,h){var y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme)),b={request:this.map._requestManager.transformRequest(y,d.ResourceType.Tile),uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,tileSize:this.tileSize*o.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function T(R,j){return delete o.request,o.aborted?h(null):R&&R.status!==404?h(R):(j&&j.resourceTiming&&(o.resourceTiming=j.resourceTiming),this.map._refreshExpiredTiles&&j&&o.setExpiryData(j),o.loadVectorData(j,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),h(null),void(o.reloadCallback&&(this.loadTile(o,o.reloadCallback),o.reloadCallback=null)))}b.request.collectResourceTiming=this._collectResourceTiming,o.actor&&o.state!=="expired"?o.state==="loading"?o.reloadCallback=h:o.request=o.actor.send("reloadTile",b,T.bind(this)):(o.actor=this.dispatcher.getActor(),o.request=o.actor.send("loadTile",b,T.bind(this)))},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.actor&&o.actor.send("abortTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.unloadTile=function(o){o.unloadVectorData(),o.actor&&o.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id},void 0)},u.prototype.hasTransition=function(){return!1},u}(d.Evented),ce=function(i){function u(o,h,y,b){i.call(this),this.id=o,this.dispatcher=y,this.setEventedParent(b),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},h),d.extend(this,d.pick(h,["url","scheme","tileSize"]))}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=xr(this._options,this.map._requestManager,function(h,y){o._tileJSONRequest=null,o._loaded=!0,h?o.fire(new d.ErrorEvent(h)):y&&(d.extend(o,y),y.bounds&&(o.tileBounds=new qt(y.bounds,o.minzoom,o.maxzoom)),d.postTurnstileEvent(y.tiles),d.postMapLoadEvent(y.tiles,o.map._getMapId(),o.map._requestManager._skuToken),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),o.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})},u.prototype.loaded=function(){return this._loaded},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},u.prototype.serialize=function(){return d.extend({},this._options)},u.prototype.hasTile=function(o){return!this.tileBounds||this.tileBounds.contains(o.canonical)},u.prototype.loadTile=function(o,h){var y=this,b=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);o.request=d.getImage(this.map._requestManager.transformRequest(b,d.ResourceType.Tile),function(T,R){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(R){y.map._refreshExpiredTiles&&o.setExpiryData(R),delete R.cacheControl,delete R.expires;var j=y.map.painter.context,ne=j.gl;o.texture=y.map.painter.getTileTexture(R.width),o.texture?o.texture.update(R,{useMipmap:!0}):(o.texture=new d.Texture(j,R,ne.RGBA,{useMipmap:!0}),o.texture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE,ne.LINEAR_MIPMAP_NEAREST),j.extTextureFilterAnisotropic&&ne.texParameterf(ne.TEXTURE_2D,j.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,j.extTextureFilterAnisotropicMax)),o.state="loaded",d.cacheEntryPossiblyAdded(y.dispatcher),h(null)}})},u.prototype.abortTile=function(o,h){o.request&&(o.request.cancel(),delete o.request),h()},u.prototype.unloadTile=function(o,h){o.texture&&this.map.painter.saveTileTexture(o.texture),h()},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Re=function(i){function u(o,h,y,b){i.call(this,o,h,y,b),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},h),this.encoding=h.encoding||"mapbox"}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},u.prototype.loadTile=function(o,h){var y=this.map._requestManager.normalizeTileURL(o.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function b(T,R){T&&(o.state="errored",h(T)),R&&(o.dem=R,o.needsHillshadePrepare=!0,o.state="loaded",h(null))}o.request=d.getImage(this.map._requestManager.transformRequest(y,d.ResourceType.Tile),function(T,R){if(delete o.request,o.aborted)o.state="unloaded",h(null);else if(T)o.state="errored",h(T);else if(R){this.map._refreshExpiredTiles&&o.setExpiryData(R),delete R.cacheControl,delete R.expires;var j=d.window.ImageBitmap&&R instanceof d.window.ImageBitmap&&d.offscreenCanvasSupported()?R:d.browser.getImageData(R,1),ne={uid:o.uid,coord:o.tileID,source:this.id,rawImageData:j,encoding:this.encoding};o.actor&&o.state!=="expired"||(o.actor=this.dispatcher.getActor(),o.actor.send("loadDEMTile",ne,b.bind(this)))}}.bind(this)),o.neighboringTiles=this._getNeighboringTiles(o.tileID)},u.prototype._getNeighboringTiles=function(o){var h=o.canonical,y=Math.pow(2,h.z),b=(h.x-1+y)%y,T=h.x===0?o.wrap-1:o.wrap,R=(h.x+1+y)%y,j=h.x+1===y?o.wrap+1:o.wrap,ne={};return ne[new d.OverscaledTileID(o.overscaledZ,T,h.z,b,h.y).key]={backfilled:!1},ne[new d.OverscaledTileID(o.overscaledZ,j,h.z,R,h.y).key]={backfilled:!1},h.y>0&&(ne[new d.OverscaledTileID(o.overscaledZ,T,h.z,b,h.y-1).key]={backfilled:!1},ne[new d.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y-1).key]={backfilled:!1},ne[new d.OverscaledTileID(o.overscaledZ,j,h.z,R,h.y-1).key]={backfilled:!1}),h.y+1<y&&(ne[new d.OverscaledTileID(o.overscaledZ,T,h.z,b,h.y+1).key]={backfilled:!1},ne[new d.OverscaledTileID(o.overscaledZ,o.wrap,h.z,h.x,h.y+1).key]={backfilled:!1},ne[new d.OverscaledTileID(o.overscaledZ,j,h.z,R,h.y+1).key]={backfilled:!1}),ne},u.prototype.unloadTile=function(o){o.demTexture&&this.map.painter.saveTileTexture(o.demTexture),o.fbo&&(o.fbo.destroy(),delete o.fbo),o.dem&&delete o.dem,delete o.neighboringTiles,o.state="unloaded",o.actor&&o.actor.send("removeDEMTile",{uid:o.uid,source:this.id})},u}(ce),ge=function(i){function u(o,h,y,b){i.call(this),this.id=o,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=y.getActor(),this.setEventedParent(b),this._data=h.data,this._options=d.extend({},h),this._collectResourceTiming=h.collectResourceTiming,this._resourceTiming=[],h.maxzoom!==void 0&&(this.maxzoom=h.maxzoom),h.type&&(this.type=h.type),h.attribution&&(this.attribution=h.attribution),this.promoteId=h.promoteId;var T=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:h.cluster||!1,geojsonVtOptions:{buffer:(h.buffer!==void 0?h.buffer:128)*T,tolerance:(h.tolerance!==void 0?h.tolerance:.375)*T,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:h.lineMetrics||!1,generateId:h.generateId||!1},superclusterOptions:{maxZoom:h.clusterMaxZoom!==void 0?Math.min(h.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,h.clusterMinPoints||2),extent:d.EXTENT,radius:(h.clusterRadius||50)*T,log:!1,generateId:h.generateId||!1},clusterProperties:h.clusterProperties,filter:h.filter},h.workerOptions)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(h){if(h)o.fire(new d.ErrorEvent(h));else{var y={dataType:"source",sourceDataType:"metadata"};o._collectResourceTiming&&o._resourceTiming&&o._resourceTiming.length>0&&(y.resourceTiming=o._resourceTiming,o._resourceTiming=[]),o.fire(new d.Event("data",y))}})},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setData=function(o){var h=this;return this._data=o,this.fire(new d.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(y){if(y)h.fire(new d.ErrorEvent(y));else{var b={dataType:"source",sourceDataType:"content"};h._collectResourceTiming&&h._resourceTiming&&h._resourceTiming.length>0&&(b.resourceTiming=h._resourceTiming,h._resourceTiming=[]),h.fire(new d.Event("data",b))}}),this},u.prototype.getClusterExpansionZoom=function(o,h){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:o,source:this.id},h),this},u.prototype.getClusterChildren=function(o,h){return this.actor.send("geojson.getClusterChildren",{clusterId:o,source:this.id},h),this},u.prototype.getClusterLeaves=function(o,h,y,b){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:o,limit:h,offset:y},b),this},u.prototype._updateWorkerData=function(o){var h=this;this._loaded=!1;var y=d.extend({},this.workerOptions),b=this._data;typeof b=="string"?(y.request=this.map._requestManager.transformRequest(d.browser.resolveURL(b),d.ResourceType.Source),y.request.collectResourceTiming=this._collectResourceTiming):y.data=JSON.stringify(b),this.actor.send(this.type+".loadData",y,function(T,R){h._removed||R&&R.abandoned||(h._loaded=!0,R&&R.resourceTiming&&R.resourceTiming[h.id]&&(h._resourceTiming=R.resourceTiming[h.id].slice(0)),h.actor.send(h.type+".coalesce",{source:y.source},null),o(T))})},u.prototype.loaded=function(){return this._loaded},u.prototype.loadTile=function(o,h){var y=this,b=o.actor?"reloadTile":"loadTile";o.actor=this.actor,o.request=this.actor.send(b,{type:this.type,uid:o.uid,tileID:o.tileID,zoom:o.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(T,R){return delete o.request,o.unloadVectorData(),o.aborted?h(null):T?h(T):(o.loadVectorData(R,y.map.painter,b==="reloadTile"),h(null))})},u.prototype.abortTile=function(o){o.request&&(o.request.cancel(),delete o.request),o.aborted=!0},u.prototype.unloadTile=function(o){o.unloadVectorData(),this.actor.send("removeTile",{uid:o.uid,type:this.type,source:this.id})},u.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},u.prototype.serialize=function(){return d.extend({},this._options,{type:this.type,data:this._data})},u.prototype.hasTransition=function(){return!1},u}(d.Evented),xt=d.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),vt=function(i){function u(o,h,y,b){i.call(this),this.id=o,this.dispatcher=y,this.coordinates=h.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(b),this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(o,h){var y=this;this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),function(b,T){y._loaded=!0,b?y.fire(new d.ErrorEvent(b)):T&&(y.image=T,o&&(y.coordinates=o),h&&h(),y._finishLoading())})},u.prototype.loaded=function(){return this._loaded},u.prototype.updateImage=function(o){var h=this;return this.image&&o.url?(this.options.url=o.url,this.load(o.coordinates,function(){h.texture=null}),this):this},u.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))},u.prototype.onAdd=function(o){this.map=o,this.load()},u.prototype.setCoordinates=function(o){var h=this;this.coordinates=o;var y=o.map(d.MercatorCoordinate.fromLngLat);this.tileID=function(T){for(var R=1/0,j=1/0,ne=-1/0,be=-1/0,Ce=0,Pe=T;Ce<Pe.length;Ce+=1){var He=Pe[Ce];R=Math.min(R,He.x),j=Math.min(j,He.y),ne=Math.max(ne,He.x),be=Math.max(be,He.y)}var je=Math.max(ne-R,be-j),ot=Math.max(0,Math.floor(-Math.log(je)/Math.LN2)),ze=Math.pow(2,ot);return new d.CanonicalTileID(ot,Math.floor((R+ne)/2*ze),Math.floor((j+be)/2*ze))}(y),this.minzoom=this.maxzoom=this.tileID.z;var b=y.map(function(T){return h.tileID.getTilePoint(T)._round()});return this._boundsArray=new d.StructArrayLayout4i8,this._boundsArray.emplaceBack(b[0].x,b[0].y,0,0),this._boundsArray.emplaceBack(b[1].x,b[1].y,d.EXTENT,0),this._boundsArray.emplaceBack(b[3].x,b[3].y,0,d.EXTENT),this._boundsArray.emplaceBack(b[2].x,b[2].y,d.EXTENT,d.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this},u.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var o=this.map.painter.context,h=o.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,xt.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new d.Texture(o,this.image,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.loadTile=function(o,h){this.tileID&&this.tileID.equals(o.tileID.canonical)?(this.tiles[String(o.tileID.wrap)]=o,o.buckets={},h(null)):(o.state="errored",h(null))},u.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return!1},u}(d.Evented),Nt=function(i){function u(o,h,y,b){i.call(this,o,h,y,b),this.roundZoom=!0,this.type="video",this.options=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){var o=this;this._loaded=!1;var h=this.options;this.urls=[];for(var y=0,b=h.urls;y<b.length;y+=1)this.urls.push(this.map._requestManager.transformRequest(b[y],d.ResourceType.Source).url);d.getVideo(this.urls,function(T,R){o._loaded=!0,T?o.fire(new d.ErrorEvent(T)):R&&(o.video=R,o.video.loop=!0,o.video.addEventListener("playing",function(){o.map.triggerRepaint()}),o.map&&o.video.play(),o._finishLoading())})},u.prototype.pause=function(){this.video&&this.video.pause()},u.prototype.play=function(){this.video&&this.video.play()},u.prototype.seek=function(o){if(this.video){var h=this.video.seekable;o<h.start(0)||o>h.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+h.start(0)+" and "+h.end(0)+"-second mark."))):this.video.currentTime=o}},u.prototype.getVideo=function(){return this.video},u.prototype.onAdd=function(o){this.map||(this.map=o,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},u.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var o=this.map.painter.context,h=o.gl;for(var y in this.boundsBuffer||(this.boundsBuffer=o.createVertexBuffer(this._boundsArray,xt.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),h.texSubImage2D(h.TEXTURE_2D,0,0,0,h.RGBA,h.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(o,this.video,h.RGBA),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE)),this.tiles){var b=this.tiles[y];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this.video&&!this.video.paused},u}(vt),Dt=function(i){function u(o,h,y,b){i.call(this,o,h,y,b),h.coordinates?Array.isArray(h.coordinates)&&h.coordinates.length===4&&!h.coordinates.some(function(T){return!Array.isArray(T)||T.length!==2||T.some(function(R){return typeof R!="number"})})||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'missing required property "coordinates"'))),h.animate&&typeof h.animate!="boolean"&&this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'optional "animate" property must be a boolean value'))),h.canvas?typeof h.canvas=="string"||h.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError("sources."+o,null,'missing required property "canvas"'))),this.options=h,this.animate=h.animate===void 0||h.animate}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},u.prototype.getCanvas=function(){return this.canvas},u.prototype.onAdd=function(o){this.map=o,this.load(),this.canvas&&this.animate&&this.play()},u.prototype.onRemove=function(){this.pause()},u.prototype.prepare=function(){var o=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,o=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,o=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var h=this.map.painter.context,y=h.gl;for(var b in this.boundsBuffer||(this.boundsBuffer=h.createVertexBuffer(this._boundsArray,xt.members)),this.boundsSegments||(this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(o||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(h,this.canvas,y.RGBA,{premultiply:!0}),this.tiles){var T=this.tiles[b];T.state!=="loaded"&&(T.state="loaded",T.texture=this.texture)}}},u.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},u.prototype.hasTransition=function(){return this._playing},u.prototype._hasInvalidDimensions=function(){for(var o=0,h=[this.canvas.width,this.canvas.height];o<h.length;o+=1){var y=h[o];if(isNaN(y)||y<=0)return!0}return!1},u}(vt),Ur={vector:Xr,raster:ce,"raster-dem":Re,geojson:ge,video:Nt,image:vt,canvas:Dt};function dn(i,u){var o=d.identity([]);return d.translate(o,o,[1,1,0]),d.scale(o,o,[.5*i.width,.5*i.height,1]),d.multiply(o,o,i.calculatePosMatrix(u.toUnwrapped()))}function on(i,u,o,h,y,b){var T=function(ot,ze,at){if(ot)for(var Et=0,Vt=ot;Et<Vt.length;Et+=1){var mr=ze[Vt[Et]];if(mr&&mr.source===at&&mr.type==="fill-extrusion")return!0}else for(var ur in ze){var Er=ze[ur];if(Er.source===at&&Er.type==="fill-extrusion")return!0}return!1}(y&&y.layers,u,i.id),R=b.maxPitchScaleFactor(),j=i.tilesIn(h,R,T);j.sort($i);for(var ne=[],be=0,Ce=j;be<Ce.length;be+=1){var Pe=Ce[be];ne.push({wrappedTileID:Pe.tileID.wrapped().key,queryResults:Pe.tile.queryRenderedFeatures(u,o,i._state,Pe.queryGeometry,Pe.cameraQueryGeometry,Pe.scale,y,b,R,dn(i.transform,Pe.tileID))})}var He=function(ot){for(var ze={},at={},Et=0,Vt=ot;Et<Vt.length;Et+=1){var mr=Vt[Et],ur=mr.queryResults,Er=mr.wrappedTileID,jr=at[Er]=at[Er]||{};for(var hn in ur)for(var nn=ur[hn],Nn=jr[hn]=jr[hn]||{},oi=ze[hn]=ze[hn]||[],ui=0,ai=nn;ui<ai.length;ui+=1){var Qi=ai[ui];Nn[Qi.featureIndex]||(Nn[Qi.featureIndex]=!0,oi.push(Qi))}}return ze}(ne);for(var je in He)He[je].forEach(function(ot){var ze=ot.feature,at=i.getFeatureState(ze.layer["source-layer"],ze.id);ze.source=ze.layer.source,ze.layer["source-layer"]&&(ze.sourceLayer=ze.layer["source-layer"]),ze.state=at});return He}function $i(i,u){var o=i.tileID,h=u.tileID;return o.overscaledZ-h.overscaledZ||o.canonical.y-h.canonical.y||o.wrap-h.wrap||o.canonical.x-h.canonical.x}var or=function(i,u){this.max=i,this.onRemove=u,this.reset()};or.prototype.reset=function(){for(var i in this.data)for(var u=0,o=this.data[i];u<o.length;u+=1){var h=o[u];h.timeout&&clearTimeout(h.timeout),this.onRemove(h.value)}return this.data={},this.order=[],this},or.prototype.add=function(i,u,o){var h=this,y=i.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);var b={value:u,timeout:void 0};if(o!==void 0&&(b.timeout=setTimeout(function(){h.remove(i,b)},o)),this.data[y].push(b),this.order.push(y),this.order.length>this.max){var T=this._getAndRemoveByKey(this.order[0]);T&&this.onRemove(T)}return this},or.prototype.has=function(i){return i.wrapped().key in this.data},or.prototype.getAndRemove=function(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null},or.prototype._getAndRemoveByKey=function(i){var u=this.data[i].shift();return u.timeout&&clearTimeout(u.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),u.value},or.prototype.getByKey=function(i){var u=this.data[i];return u?u[0].value:null},or.prototype.get=function(i){return this.has(i)?this.data[i.wrapped().key][0].value:null},or.prototype.remove=function(i,u){if(!this.has(i))return this;var o=i.wrapped().key,h=u===void 0?0:this.data[o].indexOf(u),y=this.data[o][h];return this.data[o].splice(h,1),y.timeout&&clearTimeout(y.timeout),this.data[o].length===0&&delete this.data[o],this.onRemove(y.value),this.order.splice(this.order.indexOf(o),1),this},or.prototype.setMaxSize=function(i){for(this.max=i;this.order.length>this.max;){var u=this._getAndRemoveByKey(this.order[0]);u&&this.onRemove(u)}return this},or.prototype.filter=function(i){var u=[];for(var o in this.data)for(var h=0,y=this.data[o];h<y.length;h+=1){var b=y[h];i(b.value)||u.push(b)}for(var T=0,R=u;T<R.length;T+=1){var j=R[T];this.remove(j.value.tileID,j)}};var me=function(i,u,o){this.context=i;var h=i.gl;this.buffer=h.createBuffer(),this.dynamicDraw=Boolean(o),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),h.bufferData(h.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?h.DYNAMIC_DRAW:h.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};me.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},me.prototype.updateData=function(i){var u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)},me.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Ae={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Ue=function(i,u,o,h){this.length=u.length,this.attributes=o,this.itemSize=u.bytesPerElement,this.dynamicDraw=h,this.context=i;var y=i.gl;this.buffer=y.createBuffer(),i.bindVertexBuffer.set(this.buffer),y.bufferData(y.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||delete u.arrayBuffer};Ue.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Ue.prototype.updateData=function(i){var u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)},Ue.prototype.enableAttributes=function(i,u){for(var o=0;o<this.attributes.length;o++){var h=u.attributes[this.attributes[o].name];h!==void 0&&i.enableVertexAttribArray(h)}},Ue.prototype.setVertexAttribPointers=function(i,u,o){for(var h=0;h<this.attributes.length;h++){var y=this.attributes[h],b=u.attributes[y.name];b!==void 0&&i.vertexAttribPointer(b,y.components,i[Ae[y.type]],!1,this.itemSize,y.offset+this.itemSize*(o||0))}},Ue.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Le=function(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Le.prototype.get=function(){return this.current},Le.prototype.set=function(i){},Le.prototype.getDefault=function(){return this.default},Le.prototype.setDefault=function(){this.set(this.default)};var kt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.clearColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Le),nr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 1},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearDepth(o),this.current=o,this.dirty=!1)},u}(Le),_r=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.clearStencil(o),this.current=o,this.dirty=!1)},u}(Le),Lr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[!0,!0,!0,!0]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.colorMask(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Le),fr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthMask(o),this.current=o,this.dirty=!1)},u}(Le),H=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 255},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.stencilMask(o),this.current=o,this.dirty=!1)},u}(Le),E=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},u.prototype.set=function(o){var h=this.current;(o.func!==h.func||o.ref!==h.ref||o.mask!==h.mask||this.dirty)&&(this.gl.stencilFunc(o.func,o.ref,o.mask),this.current=o,this.dirty=!1)},u}(Le),V=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.KEEP,o.KEEP,o.KEEP]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||this.dirty)&&(this.gl.stencilOp(o[0],o[1],o[2]),this.current=o,this.dirty=!1)},u}(Le),Ze=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.STENCIL_TEST):h.disable(h.STENCIL_TEST),this.current=o,this.dirty=!1}},u}(Le),tt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return[0,1]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.depthRange(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Le),ut=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.DEPTH_TEST):h.disable(h.DEPTH_TEST),this.current=o,this.dirty=!1}},u}(Le),wt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.LESS},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.depthFunc(o),this.current=o,this.dirty=!1)},u}(Le),K=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.BLEND):h.disable(h.BLEND),this.current=o,this.dirty=!1}},u}(Le),Ht=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[o.ONE,o.ZERO]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||this.dirty)&&(this.gl.blendFunc(o[0],o[1]),this.current=o,this.dirty=!1)},u}(Le),Tr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return d.Color.transparent},u.prototype.set=function(o){var h=this.current;(o.r!==h.r||o.g!==h.g||o.b!==h.b||o.a!==h.a||this.dirty)&&(this.gl.blendColor(o.r,o.g,o.b,o.a),this.current=o,this.dirty=!1)},u}(Le),Or=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.FUNC_ADD},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.blendEquation(o),this.current=o,this.dirty=!1)},u}(Le),Ye=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;o?h.enable(h.CULL_FACE):h.disable(h.CULL_FACE),this.current=o,this.dirty=!1}},u}(Le),lt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.BACK},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.cullFace(o),this.current=o,this.dirty=!1)},u}(Le),At=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.CCW},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.frontFace(o),this.current=o,this.dirty=!1)},u}(Le),zt=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.useProgram(o),this.current=o,this.dirty=!1)},u}(Le),wr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return this.gl.TEXTURE0},u.prototype.set=function(o){(o!==this.current||this.dirty)&&(this.gl.activeTexture(o),this.current=o,this.dirty=!1)},u}(Le),Pr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){var o=this.gl;return[0,0,o.drawingBufferWidth,o.drawingBufferHeight]},u.prototype.set=function(o){var h=this.current;(o[0]!==h[0]||o[1]!==h[1]||o[2]!==h[2]||o[3]!==h[3]||this.dirty)&&(this.gl.viewport(o[0],o[1],o[2],o[3]),this.current=o,this.dirty=!1)},u}(Le),er=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindFramebuffer(h.FRAMEBUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Jr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindRenderbuffer(h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Le),Yr=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindTexture(h.TEXTURE_2D,o),this.current=o,this.dirty=!1}},u}(Le),En=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.bindBuffer(h.ARRAY_BUFFER,o),this.current=o,this.dirty=!1}},u}(Le),_n=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){var h=this.gl;h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,o),this.current=o,this.dirty=!1},u}(Le),ei=function(i){function u(o){i.call(this,o),this.vao=o.extVertexArrayObject}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u.prototype.set=function(o){this.vao&&(o!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(o),this.current=o,this.dirty=!1)},u}(Le),si=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return 4},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_ALIGNMENT,o),this.current=o,this.dirty=!1}},u}(Le),na=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_PREMULTIPLY_ALPHA_WEBGL,o),this.current=o,this.dirty=!1}},u}(Le),Zi=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return!1},u.prototype.set=function(o){if(o!==this.current||this.dirty){var h=this.gl;h.pixelStorei(h.UNPACK_FLIP_Y_WEBGL,o),this.current=o,this.dirty=!1}},u}(Le),Pi=function(i){function u(o,h){i.call(this,o),this.context=o,this.parent=h}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getDefault=function(){return null},u}(Le),X=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.setDirty=function(){this.dirty=!0},u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferTexture2D(h.FRAMEBUFFER,h.COLOR_ATTACHMENT0,h.TEXTURE_2D,o,0),this.current=o,this.dirty=!1}},u}(Pi),ue=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.set=function(o){if(o!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var h=this.gl;h.framebufferRenderbuffer(h.FRAMEBUFFER,h.DEPTH_ATTACHMENT,h.RENDERBUFFER,o),this.current=o,this.dirty=!1}},u}(Pi),pe=function(i,u,o,h){this.context=i,this.width=u,this.height=o;var y=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new X(i,y),h&&(this.depthAttachment=new ue(i,y))};pe.prototype.destroy=function(){var i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){var o=this.depthAttachment.get();o&&i.deleteRenderbuffer(o)}i.deleteFramebuffer(this.framebuffer)};var F=function(i,u,o){this.func=i,this.mask=u,this.range=o};F.ReadOnly=!1,F.ReadWrite=!0,F.disabled=new F(519,F.ReadOnly,[0,1]);var ee=function(i,u,o,h,y,b){this.test=i,this.ref=u,this.mask=o,this.fail=h,this.depthFail=y,this.pass=b};ee.disabled=new ee({func:519,mask:0},0,0,7680,7680,7680);var he=function(i,u,o){this.blendFunction=i,this.blendColor=u,this.mask=o};he.disabled=new he(he.Replace=[1,0],d.Color.transparent,[!1,!1,!1,!1]),he.unblended=new he(he.Replace,d.Color.transparent,[!0,!0,!0,!0]),he.alphaBlended=new he([1,771],d.Color.transparent,[!0,!0,!0,!0]);var Te=function(i,u,o){this.enable=i,this.mode=u,this.frontFace=o};Te.disabled=new Te(!1,1029,2305),Te.backCCW=new Te(!0,1029,2305);var ae=function(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new kt(this),this.clearDepth=new nr(this),this.clearStencil=new _r(this),this.colorMask=new Lr(this),this.depthMask=new fr(this),this.stencilMask=new H(this),this.stencilFunc=new E(this),this.stencilOp=new V(this),this.stencilTest=new Ze(this),this.depthRange=new tt(this),this.depthTest=new ut(this),this.depthFunc=new wt(this),this.blend=new K(this),this.blendFunc=new Ht(this),this.blendColor=new Tr(this),this.blendEquation=new Or(this),this.cullFace=new Ye(this),this.cullFaceSide=new lt(this),this.frontFace=new At(this),this.program=new zt(this),this.activeTexture=new wr(this),this.viewport=new Pr(this),this.bindFramebuffer=new er(this),this.bindRenderbuffer=new Jr(this),this.bindTexture=new Yr(this),this.bindVertexBuffer=new En(this),this.bindElementBuffer=new _n(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ei(this),this.pixelStoreUnpack=new si(this),this.pixelStoreUnpackPremultiplyAlpha=new na(this),this.pixelStoreUnpackFlipY=new Zi(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)};ae.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},ae.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},ae.prototype.createIndexBuffer=function(i,u){return new me(this,i,u)},ae.prototype.createVertexBuffer=function(i,u,o){return new Ue(this,i,u,o)},ae.prototype.createRenderbuffer=function(i,u,o){var h=this.gl,y=h.createRenderbuffer();return this.bindRenderbuffer.set(y),h.renderbufferStorage(h.RENDERBUFFER,i,u,o),this.bindRenderbuffer.set(null),y},ae.prototype.createFramebuffer=function(i,u,o){return new pe(this,i,u,o)},ae.prototype.clear=function(i){var u=i.color,o=i.depth,h=this.gl,y=0;u&&(y|=h.COLOR_BUFFER_BIT,this.clearColor.set(u),this.colorMask.set([!0,!0,!0,!0])),o!==void 0&&(y|=h.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(o),this.depthMask.set(!0)),h.clear(y)},ae.prototype.setCullFace=function(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))},ae.prototype.setDepthMode=function(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)},ae.prototype.setStencilMode=function(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)},ae.prototype.setColorMode=function(i){d.deepEqual(i.blendFunction,he.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)},ae.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Ee=function(i){function u(o,h,y){var b=this;i.call(this),this.id=o,this.dispatcher=y,this.on("data",function(T){T.dataType==="source"&&T.sourceDataType==="metadata"&&(b._sourceLoaded=!0),b._sourceLoaded&&!b._paused&&T.dataType==="source"&&T.sourceDataType==="content"&&(b.reload(),b.transform&&b.update(b.transform))}),this.on("error",function(){b._sourceErrored=!0}),this._source=function(T,R,j,ne){var be=new Ur[R.type](T,R,j,ne);if(be.id!==T)throw new Error("Expected Source id to be "+T+" instead of "+be.id);return d.bindAll(["load","abort","unload","serialize","prepare"],be),be}(o,h,y,this),this._tiles={},this._cache=new or(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new d.SourceFeatureState}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){this.map=o,this._maxTileCacheSize=o?o._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(o)},u.prototype.onRemove=function(o){this._source&&this._source.onRemove&&this._source.onRemove(o)},u.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var o in this._tiles){var h=this._tiles[o];if(h.state!=="loaded"&&h.state!=="errored")return!1}return!0},u.prototype.getSource=function(){return this._source},u.prototype.pause=function(){this._paused=!0},u.prototype.resume=function(){if(this._paused){var o=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,o&&this.reload(),this.transform&&this.update(this.transform)}},u.prototype._loadTile=function(o,h){return this._source.loadTile(o,h)},u.prototype._unloadTile=function(o){if(this._source.unloadTile)return this._source.unloadTile(o,function(){})},u.prototype._abortTile=function(o){if(this._source.abortTile)return this._source.abortTile(o,function(){})},u.prototype.serialize=function(){return this._source.serialize()},u.prototype.prepare=function(o){for(var h in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var y=this._tiles[h];y.upload(o),y.prepare(this.map.style.imageManager)}},u.prototype.getIds=function(){return d.values(this._tiles).map(function(o){return o.tileID}).sort(mt).map(function(o){return o.key})},u.prototype.getRenderableIds=function(o){var h=this,y=[];for(var b in this._tiles)this._isIdRenderable(b,o)&&y.push(this._tiles[b]);return o?y.sort(function(T,R){var j=T.tileID,ne=R.tileID,be=new d.Point(j.canonical.x,j.canonical.y)._rotate(h.transform.angle),Ce=new d.Point(ne.canonical.x,ne.canonical.y)._rotate(h.transform.angle);return j.overscaledZ-ne.overscaledZ||Ce.y-be.y||Ce.x-be.x}).map(function(T){return T.tileID.key}):y.map(function(T){return T.tileID}).sort(mt).map(function(T){return T.key})},u.prototype.hasRenderableParent=function(o){var h=this.findLoadedParent(o,0);return!!h&&this._isIdRenderable(h.tileID.key)},u.prototype._isIdRenderable=function(o,h){return this._tiles[o]&&this._tiles[o].hasData()&&!this._coveredTiles[o]&&(h||!this._tiles[o].holdingForFade())},u.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var o in this._cache.reset(),this._tiles)this._tiles[o].state!=="errored"&&this._reloadTile(o,"reloading")},u.prototype._reloadTile=function(o,h){var y=this._tiles[o];y&&(y.state!=="loading"&&(y.state=h),this._loadTile(y,this._tileLoaded.bind(this,y,o,h)))},u.prototype._tileLoaded=function(o,h,y,b){if(b)return o.state="errored",void(b.status!==404?this._source.fire(new d.ErrorEvent(b,{tile:o})):this.update(this.transform));o.timeAdded=d.browser.now(),y==="expired"&&(o.refreshedUponExpiration=!0),this._setTileReloadTimer(h,o),this.getSource().type==="raster-dem"&&o.dem&&this._backfillDEM(o),this._state.initializeTileState(o,this.map?this.map.painter:null),this._source.fire(new d.Event("data",{dataType:"source",tile:o,coord:o.tileID}))},u.prototype._backfillDEM=function(o){for(var h=this.getRenderableIds(),y=0;y<h.length;y++){var b=h[y];if(o.neighboringTiles&&o.neighboringTiles[b]){var T=this.getTileByID(b);R(o,T),R(T,o)}}function R(j,ne){j.needsHillshadePrepare=!0;var be=ne.tileID.canonical.x-j.tileID.canonical.x,Ce=ne.tileID.canonical.y-j.tileID.canonical.y,Pe=Math.pow(2,j.tileID.canonical.z),He=ne.tileID.key;be===0&&Ce===0||Math.abs(Ce)>1||(Math.abs(be)>1&&(Math.abs(be+Pe)===1?be+=Pe:Math.abs(be-Pe)===1&&(be-=Pe)),ne.dem&&j.dem&&(j.dem.backfillBorder(ne.dem,be,Ce),j.neighboringTiles&&j.neighboringTiles[He]&&(j.neighboringTiles[He].backfilled=!0)))}},u.prototype.getTile=function(o){return this.getTileByID(o.key)},u.prototype.getTileByID=function(o){return this._tiles[o]},u.prototype._retainLoadedChildren=function(o,h,y,b){for(var T in this._tiles){var R=this._tiles[T];if(!(b[T]||!R.hasData()||R.tileID.overscaledZ<=h||R.tileID.overscaledZ>y)){for(var j=R.tileID;R&&R.tileID.overscaledZ>h+1;){var ne=R.tileID.scaledTo(R.tileID.overscaledZ-1);(R=this._tiles[ne.key])&&R.hasData()&&(j=ne)}for(var be=j;be.overscaledZ>h;)if(o[(be=be.scaledTo(be.overscaledZ-1)).key]){b[j.key]=j;break}}}},u.prototype.findLoadedParent=function(o,h){if(o.key in this._loadedParentTiles){var y=this._loadedParentTiles[o.key];return y&&y.tileID.overscaledZ>=h?y:null}for(var b=o.overscaledZ-1;b>=h;b--){var T=o.scaledTo(b),R=this._getLoadedTile(T);if(R)return R}},u.prototype._getLoadedTile=function(o){var h=this._tiles[o.key];return h&&h.hasData()?h:this._cache.getByKey(o.wrapped().key)},u.prototype.updateCacheSize=function(o){var h=Math.ceil(o.width/this._source.tileSize)+1,y=Math.ceil(o.height/this._source.tileSize)+1,b=Math.floor(h*y*5),T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,b):b;this._cache.setMaxSize(T)},u.prototype.handleWrapJump=function(o){var h=Math.round((o-(this._prevLng===void 0?o:this._prevLng))/360);if(this._prevLng=o,h){var y={};for(var b in this._tiles){var T=this._tiles[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+h),y[T.tileID.key]=T}for(var R in this._tiles=y,this._timers)clearTimeout(this._timers[R]),delete this._timers[R];for(var j in this._tiles)this._setTileReloadTimer(j,this._tiles[j])}},u.prototype.update=function(o){var h=this;if(this.transform=o,this._sourceLoaded&&!this._paused){var y;this.updateCacheSize(o),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?y=o.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(jr){return new d.OverscaledTileID(jr.canonical.z,jr.wrap,jr.canonical.z,jr.canonical.x,jr.canonical.y)}):(y=o.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(y=y.filter(function(jr){return h._source.hasTile(jr)}))):y=[];var b=o.coveringZoomLevel(this._source),T=Math.max(b-u.maxOverzooming,this._source.minzoom),R=Math.max(b+u.maxUnderzooming,this._source.minzoom),j=this._updateRetainedTiles(y,b);if(Sr(this._source.type)){for(var ne={},be={},Ce=0,Pe=Object.keys(j);Ce<Pe.length;Ce+=1){var He=Pe[Ce],je=j[He],ot=this._tiles[He];if(ot&&!(ot.fadeEndTime&&ot.fadeEndTime<=d.browser.now())){var ze=this.findLoadedParent(je,T);ze&&(this._addTile(ze.tileID),ne[ze.tileID.key]=ze.tileID),be[He]=je}}for(var at in this._retainLoadedChildren(be,b,R,j),ne)j[at]||(this._coveredTiles[at]=!0,j[at]=ne[at])}for(var Et in j)this._tiles[Et].clearFadeHold();for(var Vt=0,mr=d.keysDifference(this._tiles,j);Vt<mr.length;Vt+=1){var ur=mr[Vt],Er=this._tiles[ur];Er.hasSymbolBuckets&&!Er.holdingForFade()?Er.setHoldDuration(this.map._fadeDuration):Er.hasSymbolBuckets&&!Er.symbolFadeFinished()||this._removeTile(ur)}this._updateLoadedParentTileCache()}},u.prototype.releaseSymbolFadeTiles=function(){for(var o in this._tiles)this._tiles[o].holdingForFade()&&this._removeTile(o)},u.prototype._updateRetainedTiles=function(o,h){for(var y={},b={},T=Math.max(h-u.maxOverzooming,this._source.minzoom),R=Math.max(h+u.maxUnderzooming,this._source.minzoom),j={},ne=0,be=o;ne<be.length;ne+=1){var Ce=be[ne],Pe=this._addTile(Ce);y[Ce.key]=Ce,Pe.hasData()||h<this._source.maxzoom&&(j[Ce.key]=Ce)}this._retainLoadedChildren(j,h,R,y);for(var He=0,je=o;He<je.length;He+=1){var ot=je[He],ze=this._tiles[ot.key];if(!ze.hasData()){if(h+1>this._source.maxzoom){var at=ot.children(this._source.maxzoom)[0],Et=this.getTile(at);if(Et&&Et.hasData()){y[at.key]=at;continue}}else{var Vt=ot.children(this._source.maxzoom);if(y[Vt[0].key]&&y[Vt[1].key]&&y[Vt[2].key]&&y[Vt[3].key])continue}for(var mr=ze.wasRequested(),ur=ot.overscaledZ-1;ur>=T;--ur){var Er=ot.scaledTo(ur);if(b[Er.key]||(b[Er.key]=!0,!(ze=this.getTile(Er))&&mr&&(ze=this._addTile(Er)),ze&&(y[Er.key]=Er,mr=ze.wasRequested(),ze.hasData())))break}}}return y},u.prototype._updateLoadedParentTileCache=function(){for(var o in this._loadedParentTiles={},this._tiles){for(var h=[],y=void 0,b=this._tiles[o].tileID;b.overscaledZ>0;){if(b.key in this._loadedParentTiles){y=this._loadedParentTiles[b.key];break}h.push(b.key);var T=b.scaledTo(b.overscaledZ-1);if(y=this._getLoadedTile(T))break;b=T}for(var R=0,j=h;R<j.length;R+=1)this._loadedParentTiles[j[R]]=y}},u.prototype._addTile=function(o){var h=this._tiles[o.key];if(h)return h;(h=this._cache.getAndRemove(o))&&(this._setTileReloadTimer(o.key,h),h.tileID=o,this._state.initializeTileState(h,this.map?this.map.painter:null),this._cacheTimers[o.key]&&(clearTimeout(this._cacheTimers[o.key]),delete this._cacheTimers[o.key],this._setTileReloadTimer(o.key,h)));var y=Boolean(h);return y||(h=new d.Tile(o,this._source.tileSize*o.overscaleFactor()),this._loadTile(h,this._tileLoaded.bind(this,h,o.key,h.state))),h?(h.uses++,this._tiles[o.key]=h,y||this._source.fire(new d.Event("dataloading",{tile:h,coord:h.tileID,dataType:"source"})),h):null},u.prototype._setTileReloadTimer=function(o,h){var y=this;o in this._timers&&(clearTimeout(this._timers[o]),delete this._timers[o]);var b=h.getExpiryTimeout();b&&(this._timers[o]=setTimeout(function(){y._reloadTile(o,"expired"),delete y._timers[o]},b))},u.prototype._removeTile=function(o){var h=this._tiles[o];h&&(h.uses--,delete this._tiles[o],this._timers[o]&&(clearTimeout(this._timers[o]),delete this._timers[o]),h.uses>0||(h.hasData()&&h.state!=="reloading"?this._cache.add(h.tileID,h,h.getExpiryTimeout()):(h.aborted=!0,this._abortTile(h),this._unloadTile(h))))},u.prototype.clearTiles=function(){for(var o in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(o);this._cache.reset()},u.prototype.tilesIn=function(o,h,y){var b=this,T=[],R=this.transform;if(!R)return T;for(var j=y?R.getCameraQueryGeometry(o):o,ne=o.map(function(ur){return R.pointCoordinate(ur)}),be=j.map(function(ur){return R.pointCoordinate(ur)}),Ce=this.getIds(),Pe=1/0,He=1/0,je=-1/0,ot=-1/0,ze=0,at=be;ze<at.length;ze+=1){var Et=at[ze];Pe=Math.min(Pe,Et.x),He=Math.min(He,Et.y),je=Math.max(je,Et.x),ot=Math.max(ot,Et.y)}for(var Vt=function(ur){var Er=b._tiles[Ce[ur]];if(!Er.holdingForFade()){var jr=Er.tileID,hn=Math.pow(2,R.zoom-Er.tileID.overscaledZ),nn=h*Er.queryPadding*d.EXTENT/Er.tileSize/hn,Nn=[jr.getTilePoint(new d.MercatorCoordinate(Pe,He)),jr.getTilePoint(new d.MercatorCoordinate(je,ot))];if(Nn[0].x-nn<d.EXTENT&&Nn[0].y-nn<d.EXTENT&&Nn[1].x+nn>=0&&Nn[1].y+nn>=0){var oi=ne.map(function(ai){return jr.getTilePoint(ai)}),ui=be.map(function(ai){return jr.getTilePoint(ai)});T.push({tile:Er,tileID:jr,queryGeometry:oi,cameraQueryGeometry:ui,scale:hn})}}},mr=0;mr<Ce.length;mr++)Vt(mr);return T},u.prototype.getVisibleCoordinates=function(o){for(var h=this,y=this.getRenderableIds(o).map(function(j){return h._tiles[j].tileID}),b=0,T=y;b<T.length;b+=1){var R=T[b];R.posMatrix=this.transform.calculatePosMatrix(R.toUnwrapped())}return y},u.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Sr(this._source.type))for(var o in this._tiles){var h=this._tiles[o];if(h.fadeEndTime!==void 0&&h.fadeEndTime>=d.browser.now())return!0}return!1},u.prototype.setFeatureState=function(o,h,y){this._state.updateState(o=o||"_geojsonTileLayer",h,y)},u.prototype.removeFeatureState=function(o,h,y){this._state.removeFeatureState(o=o||"_geojsonTileLayer",h,y)},u.prototype.getFeatureState=function(o,h){return this._state.getState(o=o||"_geojsonTileLayer",h)},u.prototype.setDependencies=function(o,h,y){var b=this._tiles[o];b&&b.setDependencies(h,y)},u.prototype.reloadTilesForDependencies=function(o,h){for(var y in this._tiles)this._tiles[y].hasDependency(o,h)&&this._reloadTile(y,"reloading");this._cache.filter(function(b){return!b.hasDependency(o,h)})},u}(d.Evented);function mt(i,u){var o=Math.abs(2*i.wrap)-+(i.wrap<0),h=Math.abs(2*u.wrap)-+(u.wrap<0);return i.overscaledZ-u.overscaledZ||h-o||u.canonical.y-i.canonical.y||u.canonical.x-i.canonical.x}function Sr(i){return i==="raster"||i==="image"||i==="video"}function Wt(){return new d.window.Worker(Tl.workerUrl)}Ee.maxOverzooming=10,Ee.maxUnderzooming=3;var Ke="mapboxgl_preloaded_worker_pool",Zr=function(){this.active={}};Zr.prototype.acquire=function(i){if(!this.workers)for(this.workers=[];this.workers.length<Zr.workerCount;)this.workers.push(new Wt);return this.active[i]=!0,this.workers.slice()},Zr.prototype.release=function(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(function(u){u.terminate()}),this.workers=null)},Zr.prototype.isPreloaded=function(){return!!this.active[Ke]},Zr.prototype.numActive=function(){return Object.keys(this.active).length};var kn,Rn=Math.floor(d.browser.hardwareConcurrency/2);function ft(){return kn||(kn=new Zr),kn}function vr(i,u){var o={};for(var h in i)h!=="ref"&&(o[h]=i[h]);return d.refProperties.forEach(function(y){y in u&&(o[y]=u[y])}),o}function et(i){i=i.slice();for(var u=Object.create(null),o=0;o<i.length;o++)u[i[o].id]=i[o];for(var h=0;h<i.length;h++)"ref"in i[h]&&(i[h]=vr(i[h],u[i[h].ref]));return i}Zr.workerCount=Math.max(Math.min(Rn,6),1);var Dr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function In(i,u,o){o.push({command:Dr.addSource,args:[i,u[i]]})}function tr(i,u,o){u.push({command:Dr.removeSource,args:[i]}),o[i]=!0}function Ni(i,u,o,h){tr(i,o,h),In(i,u,o)}function ia(i,u,o){var h;for(h in i[o])if(i[o].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[o][h],u[o][h]))return!1;for(h in u[o])if(u[o].hasOwnProperty(h)&&h!=="data"&&!d.deepEqual(i[o][h],u[o][h]))return!1;return!0}function hi(i,u,o,h,y,b){var T;for(T in u=u||{},i=i||{})i.hasOwnProperty(T)&&(d.deepEqual(i[T],u[T])||o.push({command:b,args:[h,T,u[T],y]}));for(T in u)u.hasOwnProperty(T)&&!i.hasOwnProperty(T)&&(d.deepEqual(i[T],u[T])||o.push({command:b,args:[h,T,u[T],y]}))}function Fi(i){return i.id}function Wi(i,u){return i[u.id]=u,i}var yi=function(i,u){this.reset(i,u)};yi.prototype.reset=function(i,u){this.points=i||[],this._distances=[0];for(var o=1;o<this.points.length;o++)this._distances[o]=this._distances[o-1]+this.points[o].dist(this.points[o-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding},yi.prototype.lerp=function(i){if(this.points.length===1)return this.points[0];i=d.clamp(i,0,1);for(var u=1,o=this._distances[u],h=i*this.paddedLength+this.padding;o<h&&u<this._distances.length;)o=this._distances[++u];var y=u-1,b=this._distances[y],T=o-b,R=T>0?(h-b)/T:0;return this.points[y].mult(1-R).add(this.points[u].mult(R))};var ya=function(i,u,o){var h=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(i/o),this.yCellCount=Math.ceil(u/o);for(var b=0;b<this.xCellCount*this.yCellCount;b++)h.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0};function La(i,u,o,h,y){var b=d.create();return u?(d.scale(b,b,[1/y,1/y,1]),o||d.rotateZ(b,b,h.angle)):d.multiply(b,h.labelPlaneMatrix,i),b}function _i(i,u,o,h,y){if(u){var b=d.clone(i);return d.scale(b,b,[y,y,1]),o||d.rotateZ(b,b,-h.angle),b}return h.glCoordMatrix}function Mi(i,u){var o=[i.x,i.y,0,1];ro(o,o,u);var h=o[3];return{point:new d.Point(o[0]/h,o[1]/h),signedDistanceFromCamera:h}}function Ji(i,u){return .5+i/u*.5}function to(i,u){var o=i[0]/i[3],h=i[1]/i[3];return o>=-u[0]&&o<=u[0]&&h>=-u[1]&&h<=u[1]}function jo(i,u,o,h,y,b,T,R){var j=h?i.textSizeData:i.iconSizeData,ne=d.evaluateSizeForZoom(j,o.transform.zoom),be=[256/o.width*2+1,256/o.height*2+1],Ce=h?i.text.dynamicLayoutVertexArray:i.icon.dynamicLayoutVertexArray;Ce.clear();for(var Pe=i.lineVertexArray,He=h?i.text.placedSymbolArray:i.icon.placedSymbolArray,je=o.transform.width/o.transform.height,ot=!1,ze=0;ze<He.length;ze++){var at=He.get(ze);if(at.hidden||at.writingMode===d.WritingMode.vertical&&!ot)Yi(at.numGlyphs,Ce);else{ot=!1;var Et=[at.anchorX,at.anchorY,0,1];if(d.transformMat4(Et,Et,u),to(Et,be)){var Vt=Ji(o.transform.cameraToCenterDistance,Et[3]),mr=d.evaluateSizeForFeature(j,ne,at),ur=T?mr/Vt:mr*Vt,Er=new d.Point(at.anchorX,at.anchorY),jr=Mi(Er,y).point,hn={},nn=du(at,ur,!1,R,u,y,b,i.glyphOffsetArray,Pe,Ce,jr,Er,hn,je);ot=nn.useVertical,(nn.notEnoughRoom||ot||nn.needsFlipping&&du(at,ur,!0,R,u,y,b,i.glyphOffsetArray,Pe,Ce,jr,Er,hn,je).notEnoughRoom)&&Yi(at.numGlyphs,Ce)}else Yi(at.numGlyphs,Ce)}}h?i.text.dynamicLayoutVertexBuffer.updateData(Ce):i.icon.dynamicLayoutVertexBuffer.updateData(Ce)}function ja(i,u,o,h,y,b,T,R,j,ne,be){var Ce=R.glyphStartIndex+R.numGlyphs,Pe=R.lineStartIndex,He=R.lineStartIndex+R.lineLength,je=u.getoffsetX(R.glyphStartIndex),ot=u.getoffsetX(Ce-1),ze=Ba(i*je,o,h,y,b,T,R.segment,Pe,He,j,ne,be);if(!ze)return null;var at=Ba(i*ot,o,h,y,b,T,R.segment,Pe,He,j,ne,be);return at?{first:ze,last:at}:null}function Xi(i,u,o,h){return i===d.WritingMode.horizontal&&Math.abs(o.y-u.y)>Math.abs(o.x-u.x)*h?{useVertical:!0}:(i===d.WritingMode.vertical?u.y<o.y:u.x>o.x)?{needsFlipping:!0}:null}function du(i,u,o,h,y,b,T,R,j,ne,be,Ce,Pe,He){var je,ot=u/24,ze=i.lineOffsetX*ot,at=i.lineOffsetY*ot;if(i.numGlyphs>1){var Et=i.glyphStartIndex+i.numGlyphs,Vt=i.lineStartIndex,mr=i.lineStartIndex+i.lineLength,ur=ja(ot,R,ze,at,o,be,Ce,i,j,b,Pe);if(!ur)return{notEnoughRoom:!0};var Er=Mi(ur.first.point,T).point,jr=Mi(ur.last.point,T).point;if(h&&!o){var hn=Xi(i.writingMode,Er,jr,He);if(hn)return hn}je=[ur.first];for(var nn=i.glyphStartIndex+1;nn<Et-1;nn++)je.push(Ba(ot*R.getoffsetX(nn),ze,at,o,be,Ce,i.segment,Vt,mr,j,b,Pe));je.push(ur.last)}else{if(h&&!o){var Nn=Mi(Ce,y).point,oi=i.lineStartIndex+i.segment+1,ui=new d.Point(j.getx(oi),j.gety(oi)),ai=Mi(ui,y),Qi=ai.signedDistanceFromCamera>0?ai.point:ku(Ce,ui,Nn,1,y),Wn=Xi(i.writingMode,Nn,Qi,He);if(Wn)return Wn}var Ei=Ba(ot*R.getoffsetX(i.glyphStartIndex),ze,at,o,be,Ce,i.segment,i.lineStartIndex,i.lineStartIndex+i.lineLength,j,b,Pe);if(!Ei)return{notEnoughRoom:!0};je=[Ei]}for(var Gi=0,xi=je;Gi<xi.length;Gi+=1){var Ci=xi[Gi];d.addDynamicAttributes(ne,Ci.point,Ci.angle)}return{}}function ku(i,u,o,h,y){var b=Mi(i.add(i.sub(u)._unit()),y).point,T=o.sub(b);return o.add(T._mult(h/T.mag()))}function Ba(i,u,o,h,y,b,T,R,j,ne,be,Ce){var Pe=h?i-u:i+u,He=Pe>0?1:-1,je=0;h&&(He*=-1,je=Math.PI),He<0&&(je+=Math.PI);for(var ot=He>0?R+T:R+T+1,ze=y,at=y,Et=0,Vt=0,mr=Math.abs(Pe),ur=[];Et+Vt<=mr;){if((ot+=He)<R||ot>=j)return null;if(at=ze,ur.push(ze),(ze=Ce[ot])===void 0){var Er=new d.Point(ne.getx(ot),ne.gety(ot)),jr=Mi(Er,be);if(jr.signedDistanceFromCamera>0)ze=Ce[ot]=jr.point;else{var hn=ot-He;ze=ku(Et===0?b:new d.Point(ne.getx(hn),ne.gety(hn)),Er,at,mr-Et+1,be)}}Et+=Vt,Vt=at.dist(ze)}var nn=(mr-Et)/Vt,Nn=ze.sub(at),oi=Nn.mult(nn)._add(at);oi._add(Nn._unit()._perp()._mult(o*He));var ui=je+Math.atan2(ze.y-at.y,ze.x-at.x);return ur.push(oi),{point:oi,angle:ui,path:ur}}ya.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},ya.prototype.insert=function(i,u,o,h,y){this._forEachCell(u,o,h,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(y)},ya.prototype.insertCircle=function(i,u,o,h){this._forEachCell(u-h,o-h,u+h,o+h,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(o),this.circles.push(h)},ya.prototype._insertBoxCell=function(i,u,o,h,y,b){this.boxCells[y].push(b)},ya.prototype._insertCircleCell=function(i,u,o,h,y,b){this.circleCells[y].push(b)},ya.prototype._query=function(i,u,o,h,y,b){if(o<0||i>this.width||h<0||u>this.height)return!y&&[];var T=[];if(i<=0&&u<=0&&this.width<=o&&this.height<=h){if(y)return!0;for(var R=0;R<this.boxKeys.length;R++)T.push({key:this.boxKeys[R],x1:this.bboxes[4*R],y1:this.bboxes[4*R+1],x2:this.bboxes[4*R+2],y2:this.bboxes[4*R+3]});for(var j=0;j<this.circleKeys.length;j++){var ne=this.circles[3*j],be=this.circles[3*j+1],Ce=this.circles[3*j+2];T.push({key:this.circleKeys[j],x1:ne-Ce,y1:be-Ce,x2:ne+Ce,y2:be+Ce})}return b?T.filter(b):T}return this._forEachCell(i,u,o,h,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},b),y?T.length>0:T},ya.prototype._queryCircle=function(i,u,o,h,y){var b=i-o,T=i+o,R=u-o,j=u+o;if(T<0||b>this.width||j<0||R>this.height)return!h&&[];var ne=[];return this._forEachCell(b,R,T,j,this._queryCellCircle,ne,{hitTest:h,circle:{x:i,y:u,radius:o},seenUids:{box:{},circle:{}}},y),h?ne.length>0:ne},ya.prototype.query=function(i,u,o,h,y){return this._query(i,u,o,h,!1,y)},ya.prototype.hitTest=function(i,u,o,h,y){return this._query(i,u,o,h,!0,y)},ya.prototype.hitTestCircle=function(i,u,o,h){return this._queryCircle(i,u,o,!0,h)},ya.prototype._queryCell=function(i,u,o,h,y,b,T,R){var j=T.seenUids,ne=this.boxCells[y];if(ne!==null)for(var be=this.bboxes,Ce=0,Pe=ne;Ce<Pe.length;Ce+=1){var He=Pe[Ce];if(!j.box[He]){j.box[He]=!0;var je=4*He;if(i<=be[je+2]&&u<=be[je+3]&&o>=be[je+0]&&h>=be[je+1]&&(!R||R(this.boxKeys[He]))){if(T.hitTest)return b.push(!0),!0;b.push({key:this.boxKeys[He],x1:be[je],y1:be[je+1],x2:be[je+2],y2:be[je+3]})}}}var ot=this.circleCells[y];if(ot!==null)for(var ze=this.circles,at=0,Et=ot;at<Et.length;at+=1){var Vt=Et[at];if(!j.circle[Vt]){j.circle[Vt]=!0;var mr=3*Vt;if(this._circleAndRectCollide(ze[mr],ze[mr+1],ze[mr+2],i,u,o,h)&&(!R||R(this.circleKeys[Vt]))){if(T.hitTest)return b.push(!0),!0;var ur=ze[mr],Er=ze[mr+1],jr=ze[mr+2];b.push({key:this.circleKeys[Vt],x1:ur-jr,y1:Er-jr,x2:ur+jr,y2:Er+jr})}}}},ya.prototype._queryCellCircle=function(i,u,o,h,y,b,T,R){var j=T.circle,ne=T.seenUids,be=this.boxCells[y];if(be!==null)for(var Ce=this.bboxes,Pe=0,He=be;Pe<He.length;Pe+=1){var je=He[Pe];if(!ne.box[je]){ne.box[je]=!0;var ot=4*je;if(this._circleAndRectCollide(j.x,j.y,j.radius,Ce[ot+0],Ce[ot+1],Ce[ot+2],Ce[ot+3])&&(!R||R(this.boxKeys[je])))return b.push(!0),!0}}var ze=this.circleCells[y];if(ze!==null)for(var at=this.circles,Et=0,Vt=ze;Et<Vt.length;Et+=1){var mr=Vt[Et];if(!ne.circle[mr]){ne.circle[mr]=!0;var ur=3*mr;if(this._circlesCollide(at[ur],at[ur+1],at[ur+2],j.x,j.y,j.radius)&&(!R||R(this.circleKeys[mr])))return b.push(!0),!0}}},ya.prototype._forEachCell=function(i,u,o,h,y,b,T,R){for(var j=this._convertToXCellCoord(i),ne=this._convertToYCellCoord(u),be=this._convertToXCellCoord(o),Ce=this._convertToYCellCoord(h),Pe=j;Pe<=be;Pe++)for(var He=ne;He<=Ce;He++)if(y.call(this,i,u,o,h,this.xCellCount*He+Pe,b,T,R))return},ya.prototype._convertToXCellCoord=function(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))},ya.prototype._convertToYCellCoord=function(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))},ya.prototype._circlesCollide=function(i,u,o,h,y,b){var T=h-i,R=y-u,j=o+b;return j*j>T*T+R*R},ya.prototype._circleAndRectCollide=function(i,u,o,h,y,b,T){var R=(b-h)/2,j=Math.abs(i-(h+R));if(j>R+o)return!1;var ne=(T-y)/2,be=Math.abs(u-(y+ne));if(be>ne+o)return!1;if(j<=R||be<=ne)return!0;var Ce=j-R,Pe=be-ne;return Ce*Ce+Pe*Pe<=o*o};var Vo=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Yi(i,u){for(var o=0;o<i;o++){var h=u.length;u.resize(h+4),u.float32.set(Vo,3*h)}}function ro(i,u,o){var h=u[0],y=u[1];return i[0]=o[0]*h+o[4]*y+o[12],i[1]=o[1]*h+o[5]*y+o[13],i[3]=o[3]*h+o[7]*y+o[15],i}var Jo=function(i,u,o){u===void 0&&(u=new ya(i.width+200,i.height+200,25)),o===void 0&&(o=new ya(i.width+200,i.height+200,25)),this.transform=i,this.grid=u,this.ignoredGrid=o,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+100,this.screenBottomBoundary=i.height+100,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200};function xa(i,u,o){return u*(d.EXTENT/(i.tileSize*Math.pow(2,o-i.tileID.overscaledZ)))}Jo.prototype.placeCollisionBox=function(i,u,o,h,y){var b=this.projectAndGetPerspectiveRatio(h,i.anchorPointX,i.anchorPointY),T=o*b.perspectiveRatio,R=i.x1*T+b.point.x,j=i.y1*T+b.point.y,ne=i.x2*T+b.point.x,be=i.y2*T+b.point.y;return!this.isInsideGrid(R,j,ne,be)||!u&&this.grid.hitTest(R,j,ne,be,y)?{box:[],offscreen:!1}:{box:[R,j,ne,be],offscreen:this.isOffscreen(R,j,ne,be)}},Jo.prototype.placeCollisionCircles=function(i,u,o,h,y,b,T,R,j,ne,be,Ce,Pe){var He=[],je=new d.Point(u.anchorX,u.anchorY),ot=Mi(je,b),ze=Ji(this.transform.cameraToCenterDistance,ot.signedDistanceFromCamera),at=(ne?y/ze:y*ze)/d.ONE_EM,Et=Mi(je,T).point,Vt=ja(at,h,u.lineOffsetX*at,u.lineOffsetY*at,!1,Et,je,u,o,T,{}),mr=!1,ur=!1,Er=!0;if(Vt){for(var jr=.5*Ce*ze+Pe,hn=new d.Point(-100,-100),nn=new d.Point(this.screenRightBoundary,this.screenBottomBoundary),Nn=new yi,oi=Vt.first,ui=Vt.last,ai=[],Qi=oi.path.length-1;Qi>=1;Qi--)ai.push(oi.path[Qi]);for(var Wn=1;Wn<ui.path.length;Wn++)ai.push(ui.path[Wn]);var Ei=2.5*jr;if(R){var Gi=ai.map(function(vi){return Mi(vi,R)});ai=Gi.some(function(vi){return vi.signedDistanceFromCamera<=0})?[]:Gi.map(function(vi){return vi.point})}var xi=[];if(ai.length>0){for(var Ci=ai[0].clone(),Q=ai[0].clone(),J=1;J<ai.length;J++)Ci.x=Math.min(Ci.x,ai[J].x),Ci.y=Math.min(Ci.y,ai[J].y),Q.x=Math.max(Q.x,ai[J].x),Q.y=Math.max(Q.y,ai[J].y);xi=Ci.x>=hn.x&&Q.x<=nn.x&&Ci.y>=hn.y&&Q.y<=nn.y?[ai]:Q.x<hn.x||Ci.x>nn.x||Q.y<hn.y||Ci.y>nn.y?[]:d.clipLine([ai],hn.x,hn.y,nn.x,nn.y)}for(var O=0,k=xi;O<k.length;O+=1){var oe;Nn.reset(k[O],.25*jr),oe=Nn.length<=.5*jr?1:Math.ceil(Nn.paddedLength/Ei)+1;for(var we=0;we<oe;we++){var gt=we/Math.max(oe-1,1),Mt=Nn.lerp(gt),St=Mt.x+100,lr=Mt.y+100;He.push(St,lr,jr,0);var Wr=St-jr,Xn=lr-jr,Un=St+jr,ci=lr+jr;if(Er=Er&&this.isOffscreen(Wr,Xn,Un,ci),ur=ur||this.isInsideGrid(Wr,Xn,Un,ci),!i&&this.grid.hitTestCircle(St,lr,jr,be)&&(mr=!0,!j))return{circles:[],offscreen:!1,collisionDetected:mr}}}}return{circles:!j&&mr||!ur?[]:He,offscreen:Er,collisionDetected:mr}},Jo.prototype.queryRenderedSymbols=function(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var u=[],o=1/0,h=1/0,y=-1/0,b=-1/0,T=0,R=i;T<R.length;T+=1){var j=R[T],ne=new d.Point(j.x+100,j.y+100);o=Math.min(o,ne.x),h=Math.min(h,ne.y),y=Math.max(y,ne.x),b=Math.max(b,ne.y),u.push(ne)}for(var be={},Ce={},Pe=0,He=this.grid.query(o,h,y,b).concat(this.ignoredGrid.query(o,h,y,b));Pe<He.length;Pe+=1){var je=He[Pe],ot=je.key;if(be[ot.bucketInstanceId]===void 0&&(be[ot.bucketInstanceId]={}),!be[ot.bucketInstanceId][ot.featureIndex]){var ze=[new d.Point(je.x1,je.y1),new d.Point(je.x2,je.y1),new d.Point(je.x2,je.y2),new d.Point(je.x1,je.y2)];d.polygonIntersectsPolygon(u,ze)&&(be[ot.bucketInstanceId][ot.featureIndex]=!0,Ce[ot.bucketInstanceId]===void 0&&(Ce[ot.bucketInstanceId]=[]),Ce[ot.bucketInstanceId].push(ot.featureIndex))}}return Ce},Jo.prototype.insertCollisionBox=function(i,u,o,h,y){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:o,featureIndex:h,collisionGroupID:y},i[0],i[1],i[2],i[3])},Jo.prototype.insertCollisionCircles=function(i,u,o,h,y){for(var b=u?this.ignoredGrid:this.grid,T={bucketInstanceId:o,featureIndex:h,collisionGroupID:y},R=0;R<i.length;R+=4)b.insertCircle(T,i[R],i[R+1],i[R+2])},Jo.prototype.projectAndGetPerspectiveRatio=function(i,u,o){var h=[u,o,0,1];return ro(h,h,i),{point:new d.Point((h[0]/h[3]+1)/2*this.transform.width+100,(-h[1]/h[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/h[3]*.5}},Jo.prototype.isOffscreen=function(i,u,o,h){return o<100||i>=this.screenRightBoundary||h<100||u>this.screenBottomBoundary},Jo.prototype.isInsideGrid=function(i,u,o,h){return o>=0&&i<this.gridRightBoundary&&h>=0&&u<this.gridBottomBoundary},Jo.prototype.getViewportMatrix=function(){var i=d.identity([]);return d.translate(i,i,[-100,-100,0]),i};var Lo=function(i,u,o,h){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):h&&o?1:0,this.placed=o};Lo.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var No=function(i,u,o,h,y){this.text=new Lo(i?i.text:null,u,o,y),this.icon=new Lo(i?i.icon:null,u,h,y)};No.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Us=function(i,u,o){this.text=i,this.icon=u,this.skipFade=o},_o=function(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]},Qo=function(i,u,o,h,y){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=o,this.bucketIndex=h,this.tileID=y},Va=function(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}};function uo(i,u,o,h,y){var b=d.getAnchorAlignment(i),T=-(b.horizontalAlign-.5)*u,R=-(b.verticalAlign-.5)*o,j=d.evaluateVariableOffset(i,h);return new d.Point(T+j[0]*y,R+j[1]*y)}function ss(i,u,o,h,y,b){var T=i.x1,R=i.x2,j=i.y1,ne=i.y2,be=i.anchorPointX,Ce=i.anchorPointY,Pe=new d.Point(u,o);return h&&Pe._rotate(y?b:-b),{x1:T+Pe.x,y1:j+Pe.y,x2:R+Pe.x,y2:ne+Pe.y,anchorPointX:be,anchorPointY:Ce}}Va.prototype.get=function(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){var u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:function(o){return o.collisionGroupID===u}}}return this.collisionGroups[i]};var Co=function(i,u,o,h){this.transform=i.clone(),this.collisionIndex=new Jo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new Va(o),this.collisionCircleArrays={},this.prevPlacement=h,h&&(h.prevPlacement=void 0),this.placedOrientations={}};function _e(i,u,o,h,y){i.emplaceBack(u?1:0,o?1:0,h||0,y||0),i.emplaceBack(u?1:0,o?1:0,h||0,y||0),i.emplaceBack(u?1:0,o?1:0,h||0,y||0),i.emplaceBack(u?1:0,o?1:0,h||0,y||0)}Co.prototype.getBucketParts=function(i,u,o,h){var y=o.getBucket(u),b=o.latestFeatureIndex;if(y&&b&&u.id===y.layerIds[0]){var T=o.collisionBoxArray,R=y.layers[0].layout,j=Math.pow(2,this.transform.zoom-o.tileID.overscaledZ),ne=o.tileSize/d.EXTENT,be=this.transform.calculatePosMatrix(o.tileID.toUnwrapped()),Ce=R.get("text-pitch-alignment")==="map",Pe=R.get("text-rotation-alignment")==="map",He=xa(o,1,this.transform.zoom),je=La(be,Ce,Pe,this.transform,He),ot=null;if(Ce){var ze=_i(be,Ce,Pe,this.transform,He);ot=d.multiply([],this.transform.labelPlaneMatrix,ze)}this.retainedQueryData[y.bucketInstanceId]=new Qo(y.bucketInstanceId,b,y.sourceLayerIndex,y.index,o.tileID);var at={bucket:y,layout:R,posMatrix:be,textLabelPlaneMatrix:je,labelToScreenMatrix:ot,scale:j,textPixelRatio:ne,holdingForFade:o.holdingForFade(),collisionBoxArray:T,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(y.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(y.sourceID)};if(h)for(var Et=0,Vt=y.sortKeyRanges;Et<Vt.length;Et+=1){var mr=Vt[Et];i.push({sortKey:mr.sortKey,symbolInstanceStart:mr.symbolInstanceStart,symbolInstanceEnd:mr.symbolInstanceEnd,parameters:at})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:y.symbolInstances.length,parameters:at})}},Co.prototype.attemptAnchorPlacement=function(i,u,o,h,y,b,T,R,j,ne,be,Ce,Pe,He,je){var ot,ze=[Ce.textOffset0,Ce.textOffset1],at=uo(i,o,h,ze,y),Et=this.collisionIndex.placeCollisionBox(ss(u,at.x,at.y,b,T,this.transform.angle),be,R,j,ne.predicate);if(!je||this.collisionIndex.placeCollisionBox(ss(je,at.x,at.y,b,T,this.transform.angle),be,R,j,ne.predicate).box.length!==0)return Et.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[Ce.crossTileID]&&this.prevPlacement.placements[Ce.crossTileID]&&this.prevPlacement.placements[Ce.crossTileID].text&&(ot=this.prevPlacement.variableOffsets[Ce.crossTileID].anchor),this.variableOffsets[Ce.crossTileID]={textOffset:ze,width:o,height:h,anchor:i,textBoxScale:y,prevAnchor:ot},this.markUsedJustification(Pe,i,Ce,He),Pe.allowVerticalPlacement&&(this.markUsedOrientation(Pe,He,Ce),this.placedOrientations[Ce.crossTileID]=He),{shift:at,placedGlyphBoxes:Et}):void 0},Co.prototype.placeLayerBucketPart=function(i,u,o){var h=this,y=i.parameters,b=y.bucket,T=y.layout,R=y.posMatrix,j=y.textLabelPlaneMatrix,ne=y.labelToScreenMatrix,be=y.textPixelRatio,Ce=y.holdingForFade,Pe=y.collisionBoxArray,He=y.partiallyEvaluatedTextSize,je=y.collisionGroup,ot=T.get("text-optional"),ze=T.get("icon-optional"),at=T.get("text-allow-overlap"),Et=T.get("icon-allow-overlap"),Vt=T.get("text-rotation-alignment")==="map",mr=T.get("text-pitch-alignment")==="map",ur=T.get("icon-text-fit")!=="none",Er=T.get("symbol-z-order")==="viewport-y",jr=at&&(Et||!b.hasIconData()||ze),hn=Et&&(at||!b.hasTextData()||ot);!b.collisionArrays&&Pe&&b.deserializeCollisionBoxes(Pe);var nn=function(Wn,Ei){if(!u[Wn.crossTileID])if(Ce)h.placements[Wn.crossTileID]=new Us(!1,!1,!1);else{var Gi,xi=!1,Ci=!1,Q=!0,J=null,O={box:null,offscreen:null},k={box:null,offscreen:null},oe=null,we=null,gt=0,Mt=0,St=0;Ei.textFeatureIndex?gt=Ei.textFeatureIndex:Wn.useRuntimeCollisionCircles&&(gt=Wn.featureIndex),Ei.verticalTextFeatureIndex&&(Mt=Ei.verticalTextFeatureIndex);var lr=Ei.textBox;if(lr){var Wr=function(Oi){var co=d.WritingMode.horizontal;if(b.allowVerticalPlacement&&!Oi&&h.prevPlacement){var Ka=h.prevPlacement.placedOrientations[Wn.crossTileID];Ka&&(h.placedOrientations[Wn.crossTileID]=Ka,h.markUsedOrientation(b,co=Ka,Wn))}return co},Xn=function(Oi,co){if(b.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Ei.verticalTextBox)for(var Ka=0,Js=b.writingModes;Ka<Js.length&&(Js[Ka]===d.WritingMode.vertical?(O=co(),k=O):O=Oi(),!(O&&O.box&&O.box.length));Ka+=1);else O=Oi()};if(T.get("text-variable-anchor")){var Un=T.get("text-variable-anchor");if(h.prevPlacement&&h.prevPlacement.variableOffsets[Wn.crossTileID]){var ci=h.prevPlacement.variableOffsets[Wn.crossTileID];Un.indexOf(ci.anchor)>0&&(Un=Un.filter(function(Oi){return Oi!==ci.anchor})).unshift(ci.anchor)}var vi=function(Oi,co,Ka){for(var Js=Oi.x2-Oi.x1,Vl=Oi.y2-Oi.y1,Hs=Wn.textBoxScale,ju=ur&&!Et?co:null,Vu={box:[],offscreen:!1},Gl=at?2*Un.length:Un.length,pl=0;pl<Gl;++pl){var Hl=h.attemptAnchorPlacement(Un[pl%Un.length],Oi,Js,Vl,Hs,Vt,mr,be,R,je,pl>=Un.length,Wn,b,Ka,ju);if(Hl&&(Vu=Hl.placedGlyphBoxes)&&Vu.box&&Vu.box.length){xi=!0,J=Hl.shift;break}}return Vu};Xn(function(){return vi(lr,Ei.iconBox,d.WritingMode.horizontal)},function(){var Oi=Ei.verticalTextBox;return b.allowVerticalPlacement&&!(O&&O.box&&O.box.length)&&Wn.numVerticalGlyphVertices>0&&Oi?vi(Oi,Ei.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null}}),O&&(xi=O.box,Q=O.offscreen);var jn=Wr(O&&O.box);if(!xi&&h.prevPlacement){var aa=h.prevPlacement.variableOffsets[Wn.crossTileID];aa&&(h.variableOffsets[Wn.crossTileID]=aa,h.markUsedJustification(b,aa.anchor,Wn,jn))}}else{var da=function(Oi,co){var Ka=h.collisionIndex.placeCollisionBox(Oi,at,be,R,je.predicate);return Ka&&Ka.box&&Ka.box.length&&(h.markUsedOrientation(b,co,Wn),h.placedOrientations[Wn.crossTileID]=co),Ka};Xn(function(){return da(lr,d.WritingMode.horizontal)},function(){var Oi=Ei.verticalTextBox;return b.allowVerticalPlacement&&Wn.numVerticalGlyphVertices>0&&Oi?da(Oi,d.WritingMode.vertical):{box:null,offscreen:null}}),Wr(O&&O.box&&O.box.length)}}if(xi=(Gi=O)&&Gi.box&&Gi.box.length>0,Q=Gi&&Gi.offscreen,Wn.useRuntimeCollisionCircles){var Sa=b.text.placedSymbolArray.get(Wn.centerJustifiedTextSymbolIndex),vo=d.evaluateSizeForFeature(b.textSizeData,He,Sa),Ca=T.get("text-padding");oe=h.collisionIndex.placeCollisionCircles(at,Sa,b.lineVertexArray,b.glyphOffsetArray,vo,R,j,ne,o,mr,je.predicate,Wn.collisionCircleDiameter,Ca),xi=at||oe.circles.length>0&&!oe.collisionDetected,Q=Q&&oe.offscreen}if(Ei.iconFeatureIndex&&(St=Ei.iconFeatureIndex),Ei.iconBox){var Bo=function(Oi){var co=ur&&J?ss(Oi,J.x,J.y,Vt,mr,h.transform.angle):Oi;return h.collisionIndex.placeCollisionBox(co,Et,be,R,je.predicate)};Ci=k&&k.box&&k.box.length&&Ei.verticalIconBox?(we=Bo(Ei.verticalIconBox)).box.length>0:(we=Bo(Ei.iconBox)).box.length>0,Q=Q&&we.offscreen}var Za=ot||Wn.numHorizontalGlyphVertices===0&&Wn.numVerticalGlyphVertices===0,Ui=ze||Wn.numIconVertices===0;if(Za||Ui?Ui?Za||(Ci=Ci&&xi):xi=Ci&&xi:Ci=xi=Ci&&xi,xi&&Gi&&Gi.box&&h.collisionIndex.insertCollisionBox(Gi.box,T.get("text-ignore-placement"),b.bucketInstanceId,k&&k.box&&Mt?Mt:gt,je.ID),Ci&&we&&h.collisionIndex.insertCollisionBox(we.box,T.get("icon-ignore-placement"),b.bucketInstanceId,St,je.ID),oe&&(xi&&h.collisionIndex.insertCollisionCircles(oe.circles,T.get("text-ignore-placement"),b.bucketInstanceId,gt,je.ID),o)){var ga=b.bucketInstanceId,io=h.collisionCircleArrays[ga];io===void 0&&(io=h.collisionCircleArrays[ga]=new _o);for(var So=0;So<oe.circles.length;So+=4)io.circles.push(oe.circles[So+0]),io.circles.push(oe.circles[So+1]),io.circles.push(oe.circles[So+2]),io.circles.push(oe.collisionDetected?1:0)}h.placements[Wn.crossTileID]=new Us(xi||jr,Ci||hn,Q||b.justReloaded),u[Wn.crossTileID]=!0}};if(Er)for(var Nn=b.getSortedSymbolIndexes(this.transform.angle),oi=Nn.length-1;oi>=0;--oi){var ui=Nn[oi];nn(b.symbolInstances.get(ui),b.collisionArrays[ui])}else for(var ai=i.symbolInstanceStart;ai<i.symbolInstanceEnd;ai++)nn(b.symbolInstances.get(ai),b.collisionArrays[ai]);if(o&&b.bucketInstanceId in this.collisionCircleArrays){var Qi=this.collisionCircleArrays[b.bucketInstanceId];d.invert(Qi.invProjMatrix,R),Qi.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1},Co.prototype.markUsedJustification=function(i,u,o,h){var y;y=h===d.WritingMode.vertical?o.verticalPlacedTextSymbolIndex:{left:o.leftJustifiedTextSymbolIndex,center:o.centerJustifiedTextSymbolIndex,right:o.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];for(var b=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex,o.verticalPlacedTextSymbolIndex];b<T.length;b+=1){var R=T[b];R>=0&&(i.text.placedSymbolArray.get(R).crossTileID=y>=0&&R!==y?0:o.crossTileID)}},Co.prototype.markUsedOrientation=function(i,u,o){for(var h=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,y=u===d.WritingMode.vertical?u:0,b=0,T=[o.leftJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.rightJustifiedTextSymbolIndex];b<T.length;b+=1)i.text.placedSymbolArray.get(T[b]).placedOrientation=h;o.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).placedOrientation=y)},Co.prototype.commit=function(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;var u=this.prevPlacement,o=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;var h=u?u.symbolFadeChange(i):1,y=u?u.opacities:{},b=u?u.variableOffsets:{},T=u?u.placedOrientations:{};for(var R in this.placements){var j=this.placements[R],ne=y[R];ne?(this.opacities[R]=new No(ne,h,j.text,j.icon),o=o||j.text!==ne.text.placed||j.icon!==ne.icon.placed):(this.opacities[R]=new No(null,h,j.text,j.icon,j.skipFade),o=o||j.text||j.icon)}for(var be in y){var Ce=y[be];if(!this.opacities[be]){var Pe=new No(Ce,h,!1,!1);Pe.isHidden()||(this.opacities[be]=Pe,o=o||Ce.text.placed||Ce.icon.placed)}}for(var He in b)this.variableOffsets[He]||!this.opacities[He]||this.opacities[He].isHidden()||(this.variableOffsets[He]=b[He]);for(var je in T)this.placedOrientations[je]||!this.opacities[je]||this.opacities[je].isHidden()||(this.placedOrientations[je]=T[je]);o?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)},Co.prototype.updateLayerOpacities=function(i,u){for(var o={},h=0,y=u;h<y.length;h+=1){var b=y[h],T=b.getBucket(i);T&&b.latestFeatureIndex&&i.id===T.layerIds[0]&&this.updateBucketOpacities(T,o,b.collisionBoxArray)}},Co.prototype.updateBucketOpacities=function(i,u,o){var h=this;i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();var y=i.layers[0].layout,b=new No(null,0,!1,!1,!0),T=y.get("text-allow-overlap"),R=y.get("icon-allow-overlap"),j=y.get("text-variable-anchor"),ne=y.get("text-rotation-alignment")==="map",be=y.get("text-pitch-alignment")==="map",Ce=y.get("icon-text-fit")!=="none",Pe=new No(null,0,T&&(R||!i.hasIconData()||y.get("icon-optional")),R&&(T||!i.hasTextData()||y.get("text-optional")),!0);!i.collisionArrays&&o&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(o);for(var He=function(at,Et,Vt){for(var mr=0;mr<Et/4;mr++)at.opacityVertexArray.emplaceBack(Vt)},je=function(at){var Et=i.symbolInstances.get(at),Vt=Et.numHorizontalGlyphVertices,mr=Et.numVerticalGlyphVertices,ur=Et.crossTileID,Er=h.opacities[ur];u[ur]?Er=b:Er||(h.opacities[ur]=Er=Pe),u[ur]=!0;var jr=Et.numIconVertices>0,hn=h.placedOrientations[Et.crossTileID],nn=hn===d.WritingMode.vertical,Nn=hn===d.WritingMode.horizontal||hn===d.WritingMode.horizontalOnly;if(Vt>0||mr>0){var oi=Na(Er.text);He(i.text,Vt,nn?po:oi),He(i.text,mr,Nn?po:oi);var ui=Er.text.isHidden();[Et.rightJustifiedTextSymbolIndex,Et.centerJustifiedTextSymbolIndex,Et.leftJustifiedTextSymbolIndex].forEach(function(O){O>=0&&(i.text.placedSymbolArray.get(O).hidden=ui||nn?1:0)}),Et.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Et.verticalPlacedTextSymbolIndex).hidden=ui||Nn?1:0);var ai=h.variableOffsets[Et.crossTileID];ai&&h.markUsedJustification(i,ai.anchor,Et,hn);var Qi=h.placedOrientations[Et.crossTileID];Qi&&(h.markUsedJustification(i,"left",Et,Qi),h.markUsedOrientation(i,Qi,Et))}if(jr){var Wn=Na(Er.icon),Ei=!(Ce&&Et.verticalPlacedIconSymbolIndex&&nn);Et.placedIconSymbolIndex>=0&&(He(i.icon,Et.numIconVertices,Ei?Wn:po),i.icon.placedSymbolArray.get(Et.placedIconSymbolIndex).hidden=Er.icon.isHidden()),Et.verticalPlacedIconSymbolIndex>=0&&(He(i.icon,Et.numVerticalIconVertices,Ei?po:Wn),i.icon.placedSymbolArray.get(Et.verticalPlacedIconSymbolIndex).hidden=Er.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){var Gi=i.collisionArrays[at];if(Gi){var xi=new d.Point(0,0);if(Gi.textBox||Gi.verticalTextBox){var Ci=!0;if(j){var Q=h.variableOffsets[ur];Q?(xi=uo(Q.anchor,Q.width,Q.height,Q.textOffset,Q.textBoxScale),ne&&xi._rotate(be?h.transform.angle:-h.transform.angle)):Ci=!1}Gi.textBox&&_e(i.textCollisionBox.collisionVertexArray,Er.text.placed,!Ci||nn,xi.x,xi.y),Gi.verticalTextBox&&_e(i.textCollisionBox.collisionVertexArray,Er.text.placed,!Ci||Nn,xi.x,xi.y)}var J=Boolean(!Nn&&Gi.verticalIconBox);Gi.iconBox&&_e(i.iconCollisionBox.collisionVertexArray,Er.icon.placed,J,Ce?xi.x:0,Ce?xi.y:0),Gi.verticalIconBox&&_e(i.iconCollisionBox.collisionVertexArray,Er.icon.placed,!J,Ce?xi.x:0,Ce?xi.y:0)}}},ot=0;ot<i.symbolInstances.length;ot++)je(ot);if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){var ze=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ze.invProjMatrix,i.placementViewportMatrix=ze.viewportMatrix,i.collisionCircleArray=ze.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}},Co.prototype.symbolFadeChange=function(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},Co.prototype.zoomAdjustment=function(i){return Math.max(0,(this.transform.zoom-i)/1.5)},Co.prototype.hasTransitions=function(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration},Co.prototype.stillRecent=function(i,u){var o=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*o>i},Co.prototype.setStale=function(){this.stale=!0};var De=Math.pow(2,25),pt=Math.pow(2,24),$t=Math.pow(2,17),en=Math.pow(2,16),ti=Math.pow(2,9),Ai=Math.pow(2,8),ha=Math.pow(2,1);function Na(i){if(i.opacity===0&&!i.placed)return 0;if(i.opacity===1&&i.placed)return 4294967295;var u=i.placed?1:0,o=Math.floor(127*i.opacity);return o*De+u*pt+o*$t+u*en+o*ti+u*Ai+o*ha+u}var po=0,us=function(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};us.prototype.continuePlacement=function(i,u,o,h,y){for(var b=this._bucketParts;this._currentTileIndex<i.length;)if(u.getBucketParts(b,h,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort(function(T,R){return T.sortKey-R.sortKey}));this._currentPartIndex<b.length;)if(u.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,o),this._currentPartIndex++,y())return!0;return!1};var vu=function(i,u,o,h,y,b,T){this.placement=new Co(i,y,b,T),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=o,this._showCollisionBoxes=h,this._done=!1};vu.prototype.isDone=function(){return this._done},vu.prototype.continuePlacement=function(i,u,o){for(var h=this,y=d.browser.now(),b=function(){var j=d.browser.now()-y;return!h._forceFullPlacement&&j>2};this._currentPlacementIndex>=0;){var T=u[i[this._currentPlacementIndex]],R=this.placement.collisionIndex.transform.zoom;if(T.type==="symbol"&&(!T.minzoom||T.minzoom<=R)&&(!T.maxzoom||T.maxzoom>R)){if(this._inProgressLayer||(this._inProgressLayer=new us(T)),this._inProgressLayer.continuePlacement(o[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},vu.prototype.commit=function(i){return this.placement.commit(i),this.placement};var Au=512/d.EXTENT/2,Xu=function(i,u,o){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=o;for(var h=0;h<u.length;h++){var y=u.get(h),b=y.key;this.indexedSymbolInstances[b]||(this.indexedSymbolInstances[b]=[]),this.indexedSymbolInstances[b].push({crossTileID:y.crossTileID,coord:this.getScaledCoordinates(y,i)})}};Xu.prototype.getScaledCoordinates=function(i,u){var o=Au/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+i.anchorX)*o),y:Math.floor((u.canonical.y*d.EXTENT+i.anchorY)*o)}},Xu.prototype.findMatches=function(i,u,o){for(var h=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z),y=0;y<i.length;y++){var b=i.get(y);if(!b.crossTileID){var T=this.indexedSymbolInstances[b.key];if(T)for(var R=this.getScaledCoordinates(b,u),j=0,ne=T;j<ne.length;j+=1){var be=ne[j];if(Math.abs(be.coord.x-R.x)<=h&&Math.abs(be.coord.y-R.y)<=h&&!o[be.crossTileID]){o[be.crossTileID]=!0,b.crossTileID=be.crossTileID;break}}}}};var Go=function(){this.maxCrossTileID=0};Go.prototype.generate=function(){return++this.maxCrossTileID};var qo=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};qo.prototype.handleWrapJump=function(i){var u=Math.round((i-this.lng)/360);if(u!==0)for(var o in this.indexes){var h=this.indexes[o],y={};for(var b in h){var T=h[b];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+u),y[T.tileID.key]=T}this.indexes[o]=y}this.lng=i},qo.prototype.addBucket=function(i,u,o){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(var h=0;h<u.symbolInstances.length;h++)u.symbolInstances.get(h).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});var y=this.usedCrossTileIDs[i.overscaledZ];for(var b in this.indexes){var T=this.indexes[b];if(Number(b)>i.overscaledZ)for(var R in T){var j=T[R];j.tileID.isChildOf(i)&&j.findMatches(u.symbolInstances,i,y)}else{var ne=T[i.scaledTo(Number(b)).key];ne&&ne.findMatches(u.symbolInstances,i,y)}}for(var be=0;be<u.symbolInstances.length;be++){var Ce=u.symbolInstances.get(be);Ce.crossTileID||(Ce.crossTileID=o.generate(),y[Ce.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Xu(i,u.symbolInstances,u.bucketInstanceId),!0},qo.prototype.removeBucketCrossTileIDs=function(i,u){for(var o in u.indexedSymbolInstances)for(var h=0,y=u.indexedSymbolInstances[o];h<y.length;h+=1)delete this.usedCrossTileIDs[i][y[h].crossTileID]},qo.prototype.removeStaleBuckets=function(i){var u=!1;for(var o in this.indexes){var h=this.indexes[o];for(var y in h)i[h[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(o,h[y]),delete h[y],u=!0)}return u};var ls=function(){this.layerIndexes={},this.crossTileIDs=new Go,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};ls.prototype.addLayer=function(i,u,o){var h=this.layerIndexes[i.id];h===void 0&&(h=this.layerIndexes[i.id]=new qo);var y=!1,b={};h.handleWrapJump(o);for(var T=0,R=u;T<R.length;T+=1){var j=R[T],ne=j.getBucket(i);ne&&i.id===ne.layerIds[0]&&(ne.bucketInstanceId||(ne.bucketInstanceId=++this.maxBucketInstanceId),h.addBucket(j.tileID,ne,this.crossTileIDs)&&(y=!0),b[ne.bucketInstanceId]=!0)}return h.removeStaleBuckets(b)&&(y=!0),y},ls.prototype.pruneUnusedLayers=function(i){var u={};for(var o in i.forEach(function(h){u[h]=!0}),this.layerIndexes)u[o]||delete this.layerIndexes[o]};var ys=function(i,u){return d.emitValidationErrors(i,u&&u.filter(function(o){return o.identifier!=="source.canvas"}))},Ho=d.pick(Dr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ws=d.pick(Dr,["setCenter","setZoom","setBearing","setPitch"]),ru=function(){var i={},u=d.styleSpec.$version;for(var o in d.styleSpec.$root){var h,y=d.styleSpec.$root[o];y.required&&(h=o==="version"?u:y.type==="array"?[]:{})!=null&&(i[o]=h)}return i}(),Is=function(i){function u(o,h){var y=this;h===void 0&&(h={}),i.call(this),this.map=o,this.dispatcher=new Zt(ft(),this),this.imageManager=new Yt,this.imageManager.setEventedParent(this),this.glyphManager=new dr(o._requestManager,h.localIdeographFontFamily),this.lineAtlas=new Xe(256,512),this.crossTileSymbolIndex=new ls,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());var b=this;this._rtlTextPluginCallback=u.registerForPluginStateChange(function(T){b.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:T.pluginStatus,pluginURL:T.pluginURL},function(R,j){if(d.triggerPluginCompletionEvent(R),j&&j.every(function(be){return be}))for(var ne in b.sourceCaches)b.sourceCaches[ne].reload()})}),this.on("data",function(T){if(T.dataType==="source"&&T.sourceDataType==="metadata"){var R=y.sourceCaches[T.sourceId];if(R){var j=R.getSource();if(j&&j.vectorLayerIds)for(var ne in y._layers){var be=y._layers[ne];be.source===j.id&&y._validateLayer(be)}}}})}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.loadURL=function(o,h){var y=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"}));var b=typeof h.validate=="boolean"?h.validate:!d.isMapboxURL(o);o=this.map._requestManager.normalizeStyleURL(o,h.accessToken);var T=this.map._requestManager.transformRequest(o,d.ResourceType.Style);this._request=d.getJSON(T,function(R,j){y._request=null,R?y.fire(new d.ErrorEvent(R)):j&&y._load(j,b)})},u.prototype.loadJSON=function(o,h){var y=this;h===void 0&&(h={}),this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.browser.frame(function(){y._request=null,y._load(o,h.validate!==!1)})},u.prototype.loadEmpty=function(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(ru,!1)},u.prototype._load=function(o,h){if(!h||!ys(this,d.validateStyle(o))){for(var y in this._loaded=!0,this.stylesheet=o,o.sources)this.addSource(y,o.sources[y],{validate:!1});o.sprite?this._loadSprite(o.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(o.glyphs);var b=et(this.stylesheet.layers);this._order=b.map(function(ne){return ne.id}),this._layers={},this._serializedLayers={};for(var T=0,R=b;T<R.length;T+=1){var j=R[T];(j=d.createStyleLayer(j)).setEventedParent(this,{layer:{id:j.id}}),this._layers[j.id]=j,this._serializedLayers[j.id]=j.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Rt(this.stylesheet.light),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}},u.prototype._loadSprite=function(o){var h=this;this._spriteRequest=function(y,b,T){var R,j,ne,be=d.browser.devicePixelRatio>1?"@2x":"",Ce=d.getJSON(b.transformRequest(b.normalizeSpriteURL(y,be,".json"),d.ResourceType.SpriteJSON),function(je,ot){Ce=null,ne||(ne=je,R=ot,He())}),Pe=d.getImage(b.transformRequest(b.normalizeSpriteURL(y,be,".png"),d.ResourceType.SpriteImage),function(je,ot){Pe=null,ne||(ne=je,j=ot,He())});function He(){if(ne)T(ne);else if(R&&j){var je=d.browser.getImageData(j),ot={};for(var ze in R){var at=R[ze],Et=at.width,Vt=at.height,mr=at.x,ur=at.y,Er=at.sdf,jr=at.pixelRatio,hn=at.stretchX,nn=at.stretchY,Nn=at.content,oi=new d.RGBAImage({width:Et,height:Vt});d.RGBAImage.copy(je,oi,{x:mr,y:ur},{x:0,y:0},{width:Et,height:Vt}),ot[ze]={data:oi,pixelRatio:jr,sdf:Er,stretchX:hn,stretchY:nn,content:Nn}}T(null,ot)}}return{cancel:function(){Ce&&(Ce.cancel(),Ce=null),Pe&&(Pe.cancel(),Pe=null)}}}(o,this.map._requestManager,function(y,b){if(h._spriteRequest=null,y)h.fire(new d.ErrorEvent(y));else if(b)for(var T in b)h.imageManager.addImage(T,b[T]);h.imageManager.setLoaded(!0),h._availableImages=h.imageManager.listImages(),h.dispatcher.broadcast("setImages",h._availableImages),h.fire(new d.Event("data",{dataType:"style"}))})},u.prototype._validateLayer=function(o){var h=this.sourceCaches[o.source];if(h){var y=o.sourceLayer;if(y){var b=h.getSource();(b.type==="geojson"||b.vectorLayerIds&&b.vectorLayerIds.indexOf(y)===-1)&&this.fire(new d.ErrorEvent(new Error('Source layer "'+y+'" does not exist on source "'+b.id+'" as specified by style layer "'+o.id+'"')))}}},u.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var o in this.sourceCaches)if(!this.sourceCaches[o].loaded())return!1;return!!this.imageManager.isLoaded()},u.prototype._serializeLayers=function(o){for(var h=[],y=0,b=o;y<b.length;y+=1){var T=this._layers[b[y]];T.type!=="custom"&&h.push(T.serialize())}return h},u.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var o in this.sourceCaches)if(this.sourceCaches[o].hasTransition())return!0;for(var h in this._layers)if(this._layers[h].hasTransition())return!0;return!1},u.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},u.prototype.update=function(o){if(this._loaded){var h=this._changed;if(this._changed){var y=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);for(var T in(y.length||b.length)&&this._updateWorkerLayers(y,b),this._updatedSources){var R=this._updatedSources[T];R==="reload"?this._reloadSource(T):R==="clear"&&this._clearSource(T)}for(var j in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[j].updateTransitions(o);this.light.updateTransitions(o),this._resetUpdates()}var ne={};for(var be in this.sourceCaches){var Ce=this.sourceCaches[be];ne[be]=Ce.used,Ce.used=!1}for(var Pe=0,He=this._order;Pe<He.length;Pe+=1){var je=this._layers[He[Pe]];je.recalculate(o,this._availableImages),!je.isHidden(o.zoom)&&je.source&&(this.sourceCaches[je.source].used=!0)}for(var ot in ne){var ze=this.sourceCaches[ot];ne[ot]!==ze.used&&ze.fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:ot}))}this.light.recalculate(o),this.z=o.zoom,h&&this.fire(new d.Event("data",{dataType:"style"}))}},u.prototype._updateTilesForChangedImages=function(){var o=Object.keys(this._changedImages);if(o.length){for(var h in this.sourceCaches)this.sourceCaches[h].reloadTilesForDependencies(["icons","patterns"],o);this._changedImages={}}},u.prototype._updateWorkerLayers=function(o,h){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(o),removedIds:h})},u.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},u.prototype.setState=function(o){var h=this;if(this._checkLoaded(),ys(this,d.validateStyle(o)))return!1;(o=d.clone$1(o)).layers=et(o.layers);var y=function(T,R){if(!T)return[{command:Dr.setStyle,args:[R]}];var j=[];try{if(!d.deepEqual(T.version,R.version))return[{command:Dr.setStyle,args:[R]}];d.deepEqual(T.center,R.center)||j.push({command:Dr.setCenter,args:[R.center]}),d.deepEqual(T.zoom,R.zoom)||j.push({command:Dr.setZoom,args:[R.zoom]}),d.deepEqual(T.bearing,R.bearing)||j.push({command:Dr.setBearing,args:[R.bearing]}),d.deepEqual(T.pitch,R.pitch)||j.push({command:Dr.setPitch,args:[R.pitch]}),d.deepEqual(T.sprite,R.sprite)||j.push({command:Dr.setSprite,args:[R.sprite]}),d.deepEqual(T.glyphs,R.glyphs)||j.push({command:Dr.setGlyphs,args:[R.glyphs]}),d.deepEqual(T.transition,R.transition)||j.push({command:Dr.setTransition,args:[R.transition]}),d.deepEqual(T.light,R.light)||j.push({command:Dr.setLight,args:[R.light]});var ne={},be=[];(function(Pe,He,je,ot){var ze;for(ze in He=He||{},Pe=Pe||{})Pe.hasOwnProperty(ze)&&(He.hasOwnProperty(ze)||tr(ze,je,ot));for(ze in He)He.hasOwnProperty(ze)&&(Pe.hasOwnProperty(ze)?d.deepEqual(Pe[ze],He[ze])||(Pe[ze].type==="geojson"&&He[ze].type==="geojson"&&ia(Pe,He,ze)?je.push({command:Dr.setGeoJSONSourceData,args:[ze,He[ze].data]}):Ni(ze,He,je,ot)):In(ze,He,je))})(T.sources,R.sources,be,ne);var Ce=[];T.layers&&T.layers.forEach(function(Pe){ne[Pe.source]?j.push({command:Dr.removeLayer,args:[Pe.id]}):Ce.push(Pe)}),j=j.concat(be),function(Pe,He,je){He=He||[];var ot,ze,at,Et,Vt,mr,ur,Er=(Pe=Pe||[]).map(Fi),jr=He.map(Fi),hn=Pe.reduce(Wi,{}),nn=He.reduce(Wi,{}),Nn=Er.slice(),oi=Object.create(null);for(ot=0,ze=0;ot<Er.length;ot++)nn.hasOwnProperty(at=Er[ot])?ze++:(je.push({command:Dr.removeLayer,args:[at]}),Nn.splice(Nn.indexOf(at,ze),1));for(ot=0,ze=0;ot<jr.length;ot++)Nn[Nn.length-1-ot]!==(at=jr[jr.length-1-ot])&&(hn.hasOwnProperty(at)?(je.push({command:Dr.removeLayer,args:[at]}),Nn.splice(Nn.lastIndexOf(at,Nn.length-ze),1)):ze++,je.push({command:Dr.addLayer,args:[nn[at],mr=Nn[Nn.length-ot]]}),Nn.splice(Nn.length-ot,0,at),oi[at]=!0);for(ot=0;ot<jr.length;ot++)if(Et=hn[at=jr[ot]],Vt=nn[at],!oi[at]&&!d.deepEqual(Et,Vt))if(d.deepEqual(Et.source,Vt.source)&&d.deepEqual(Et["source-layer"],Vt["source-layer"])&&d.deepEqual(Et.type,Vt.type)){for(ur in hi(Et.layout,Vt.layout,je,at,null,Dr.setLayoutProperty),hi(Et.paint,Vt.paint,je,at,null,Dr.setPaintProperty),d.deepEqual(Et.filter,Vt.filter)||je.push({command:Dr.setFilter,args:[at,Vt.filter]}),d.deepEqual(Et.minzoom,Vt.minzoom)&&d.deepEqual(Et.maxzoom,Vt.maxzoom)||je.push({command:Dr.setLayerZoomRange,args:[at,Vt.minzoom,Vt.maxzoom]}),Et)Et.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?hi(Et[ur],Vt[ur],je,at,ur.slice(6),Dr.setPaintProperty):d.deepEqual(Et[ur],Vt[ur])||je.push({command:Dr.setLayerProperty,args:[at,ur,Vt[ur]]}));for(ur in Vt)Vt.hasOwnProperty(ur)&&!Et.hasOwnProperty(ur)&&ur!=="layout"&&ur!=="paint"&&ur!=="filter"&&ur!=="metadata"&&ur!=="minzoom"&&ur!=="maxzoom"&&(ur.indexOf("paint.")===0?hi(Et[ur],Vt[ur],je,at,ur.slice(6),Dr.setPaintProperty):d.deepEqual(Et[ur],Vt[ur])||je.push({command:Dr.setLayerProperty,args:[at,ur,Vt[ur]]}))}else je.push({command:Dr.removeLayer,args:[at]}),mr=Nn[Nn.lastIndexOf(at)+1],je.push({command:Dr.addLayer,args:[Vt,mr]})}(Ce,R.layers,j)}catch(Pe){console.warn("Unable to compute style diff:",Pe),j=[{command:Dr.setStyle,args:[R]}]}return j}(this.serialize(),o).filter(function(T){return!(T.command in Ws)});if(y.length===0)return!1;var b=y.filter(function(T){return!(T.command in Ho)});if(b.length>0)throw new Error("Unimplemented: "+b.map(function(T){return T.command}).join(", ")+".");return y.forEach(function(T){T.command!=="setTransition"&&h[T.command].apply(h,T.args)}),this.stylesheet=o,!0},u.prototype.addImage=function(o,h){if(this.getImage(o))return this.fire(new d.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(o,h),this._afterImageUpdated(o)},u.prototype.updateImage=function(o,h){this.imageManager.updateImage(o,h)},u.prototype.getImage=function(o){return this.imageManager.getImage(o)},u.prototype.removeImage=function(o){if(!this.getImage(o))return this.fire(new d.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(o),this._afterImageUpdated(o)},u.prototype._afterImageUpdated=function(o){this._availableImages=this.imageManager.listImages(),this._changedImages[o]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))},u.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},u.prototype.addSource=function(o,h,y){var b=this;if(y===void 0&&(y={}),this._checkLoaded(),this.sourceCaches[o]!==void 0)throw new Error("There is already a source with this ID");if(!h.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(h).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(h.type)>=0&&this._validate(d.validateStyle.source,"sources."+o,h,null,y))){this.map&&this.map._collectResourceTiming&&(h.collectResourceTiming=!0);var T=this.sourceCaches[o]=new Ee(o,h,this.dispatcher);T.style=this,T.setEventedParent(this,function(){return{isSourceLoaded:b.loaded(),source:T.serialize(),sourceId:o}}),T.onAdd(this.map),this._changed=!0}},u.prototype.removeSource=function(o){if(this._checkLoaded(),this.sourceCaches[o]===void 0)throw new Error("There is no source with this ID");for(var h in this._layers)if(this._layers[h].source===o)return this.fire(new d.ErrorEvent(new Error('Source "'+o+'" cannot be removed while layer "'+h+'" is using it.')));var y=this.sourceCaches[o];delete this.sourceCaches[o],delete this._updatedSources[o],y.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:o})),y.setEventedParent(null),y.clearTiles(),y.onRemove&&y.onRemove(this.map),this._changed=!0},u.prototype.setGeoJSONSourceData=function(o,h){this._checkLoaded(),this.sourceCaches[o].getSource().setData(h),this._changed=!0},u.prototype.getSource=function(o){return this.sourceCaches[o]&&this.sourceCaches[o].getSource()},u.prototype.addLayer=function(o,h,y){y===void 0&&(y={}),this._checkLoaded();var b=o.id;if(this.getLayer(b))this.fire(new d.ErrorEvent(new Error('Layer with id "'+b+'" already exists on this map')));else{var T;if(o.type==="custom"){if(ys(this,d.validateCustomStyleLayer(o)))return;T=d.createStyleLayer(o)}else{if(typeof o.source=="object"&&(this.addSource(b,o.source),o=d.clone$1(o),o=d.extend(o,{source:b})),this._validate(d.validateStyle.layer,"layers."+b,o,{arrayIndex:-1},y))return;T=d.createStyleLayer(o),this._validateLayer(T),T.setEventedParent(this,{layer:{id:b}}),this._serializedLayers[T.id]=T.serialize()}var R=h?this._order.indexOf(h):this._order.length;if(h&&R===-1)this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.')));else{if(this._order.splice(R,0,b),this._layerOrderChanged=!0,this._layers[b]=T,this._removedLayers[b]&&T.source&&T.type!=="custom"){var j=this._removedLayers[b];delete this._removedLayers[b],j.type!==T.type?this._updatedSources[T.source]="clear":(this._updatedSources[T.source]="reload",this.sourceCaches[T.source].pause())}this._updateLayer(T),T.onAdd&&T.onAdd(this.map)}}},u.prototype.moveLayer=function(o,h){if(this._checkLoaded(),this._changed=!0,this._layers[o]){if(o!==h){var y=this._order.indexOf(o);this._order.splice(y,1);var b=h?this._order.indexOf(h):this._order.length;h&&b===-1?this.fire(new d.ErrorEvent(new Error('Layer with id "'+h+'" does not exist on this map.'))):(this._order.splice(b,0,o),this._layerOrderChanged=!0)}}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be moved.")))},u.prototype.removeLayer=function(o){this._checkLoaded();var h=this._layers[o];if(h){h.setEventedParent(null);var y=this._order.indexOf(o);this._order.splice(y,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[o]=h,delete this._layers[o],delete this._serializedLayers[o],delete this._updatedLayers[o],delete this._updatedPaintProps[o],h.onRemove&&h.onRemove(this.map)}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be removed.")))},u.prototype.getLayer=function(o){return this._layers[o]},u.prototype.hasLayer=function(o){return o in this._layers},u.prototype.setLayerZoomRange=function(o,h,y){this._checkLoaded();var b=this.getLayer(o);b?b.minzoom===h&&b.maxzoom===y||(h!=null&&(b.minzoom=h),y!=null&&(b.maxzoom=y),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot have zoom extent.")))},u.prototype.setFilter=function(o,h,y){y===void 0&&(y={}),this._checkLoaded();var b=this.getLayer(o);if(b){if(!d.deepEqual(b.filter,h))return h==null?(b.filter=void 0,void this._updateLayer(b)):void(this._validate(d.validateStyle.filter,"layers."+b.id+".filter",h,null,y)||(b.filter=d.clone$1(h),this._updateLayer(b)))}else this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be filtered.")))},u.prototype.getFilter=function(o){return d.clone$1(this.getLayer(o).filter)},u.prototype.setLayoutProperty=function(o,h,y,b){b===void 0&&(b={}),this._checkLoaded();var T=this.getLayer(o);T?d.deepEqual(T.getLayoutProperty(h),y)||(T.setLayoutProperty(h,y,b),this._updateLayer(T)):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getLayoutProperty=function(o,h){var y=this.getLayer(o);if(y)return y.getLayoutProperty(h);this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style.")))},u.prototype.setPaintProperty=function(o,h,y,b){b===void 0&&(b={}),this._checkLoaded();var T=this.getLayer(o);T?d.deepEqual(T.getPaintProperty(h),y)||(T.setPaintProperty(h,y,b)&&this._updateLayer(T),this._changed=!0,this._updatedPaintProps[o]=!0):this.fire(new d.ErrorEvent(new Error("The layer '"+o+"' does not exist in the map's style and cannot be styled.")))},u.prototype.getPaintProperty=function(o,h){return this.getLayer(o).getPaintProperty(h)},u.prototype.setFeatureState=function(o,h){this._checkLoaded();var y=o.source,b=o.sourceLayer,T=this.sourceCaches[y];if(T!==void 0){var R=T.getSource().type;R==="geojson"&&b?this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):R!=="vector"||b?(o.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),T.setFeatureState(b,o.id,h)):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.removeFeatureState=function(o,h){this._checkLoaded();var y=o.source,b=this.sourceCaches[y];if(b!==void 0){var T=b.getSource().type,R=T==="vector"?o.sourceLayer:void 0;T!=="vector"||R?h&&typeof o.id!="string"&&typeof o.id!="number"?this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):b.removeFeatureState(R,o.id,h):this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+y+"' does not exist in the map's style.")))},u.prototype.getFeatureState=function(o){this._checkLoaded();var h=o.source,y=o.sourceLayer,b=this.sourceCaches[h];if(b!==void 0){if(b.getSource().type!=="vector"||y)return o.id===void 0&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),b.getFeatureState(y,o.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error("The source '"+h+"' does not exist in the map's style.")))},u.prototype.getTransition=function(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},u.prototype.serialize=function(){return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:d.mapObject(this.sourceCaches,function(o){return o.serialize()}),layers:this._serializeLayers(this._order)},function(o){return o!==void 0})},u.prototype._updateLayer=function(o){this._updatedLayers[o.id]=!0,o.source&&!this._updatedSources[o.source]&&this.sourceCaches[o.source].getSource().type!=="raster"&&(this._updatedSources[o.source]="reload",this.sourceCaches[o.source].pause()),this._changed=!0},u.prototype._flattenAndSortRenderedFeatures=function(o){for(var h=this,y=function(hn){return h._layers[hn].type==="fill-extrusion"},b={},T=[],R=this._order.length-1;R>=0;R--){var j=this._order[R];if(y(j)){b[j]=R;for(var ne=0,be=o;ne<be.length;ne+=1){var Ce=be[ne][j];if(Ce)for(var Pe=0,He=Ce;Pe<He.length;Pe+=1)T.push(He[Pe])}}}T.sort(function(hn,nn){return nn.intersectionZ-hn.intersectionZ});for(var je=[],ot=this._order.length-1;ot>=0;ot--){var ze=this._order[ot];if(y(ze))for(var at=T.length-1;at>=0;at--){var Et=T[at].feature;if(b[Et.layer.id]<ot)break;je.push(Et),T.pop()}else for(var Vt=0,mr=o;Vt<mr.length;Vt+=1){var ur=mr[Vt][ze];if(ur)for(var Er=0,jr=ur;Er<jr.length;Er+=1)je.push(jr[Er].feature)}}return je},u.prototype.queryRenderedFeatures=function(o,h,y){h&&h.filter&&this._validate(d.validateStyle.filter,"queryRenderedFeatures.filter",h.filter,null,h);var b={};if(h&&h.layers){if(!Array.isArray(h.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var T=0,R=h.layers;T<R.length;T+=1){var j=R[T],ne=this._layers[j];if(!ne)return this.fire(new d.ErrorEvent(new Error("The layer '"+j+"' does not exist in the map's style and cannot be queried for features."))),[];b[ne.source]=!0}}var be=[];for(var Ce in h.availableImages=this._availableImages,this.sourceCaches)h.layers&&!b[Ce]||be.push(on(this.sourceCaches[Ce],this._layers,this._serializedLayers,o,h,y));return this.placement&&be.push(function(Pe,He,je,ot,ze,at,Et){for(var Vt={},mr=at.queryRenderedSymbols(ot),ur=[],Er=0,jr=Object.keys(mr).map(Number);Er<jr.length;Er+=1)ur.push(Et[jr[Er]]);ur.sort($i);for(var hn=function(){var ai=Nn[nn],Qi=ai.featureIndex.lookupSymbolFeatures(mr[ai.bucketInstanceId],He,ai.bucketIndex,ai.sourceLayerIndex,ze.filter,ze.layers,ze.availableImages,Pe);for(var Wn in Qi){var Ei=Vt[Wn]=Vt[Wn]||[],Gi=Qi[Wn];Gi.sort(function(Q,J){var O=ai.featureSortOrder;if(O){var k=O.indexOf(Q.featureIndex);return O.indexOf(J.featureIndex)-k}return J.featureIndex-Q.featureIndex});for(var xi=0,Ci=Gi;xi<Ci.length;xi+=1)Ei.push(Ci[xi])}},nn=0,Nn=ur;nn<Nn.length;nn+=1)hn();var oi=function(ai){Vt[ai].forEach(function(Qi){var Wn=Qi.feature,Ei=je[Pe[ai].source].getFeatureState(Wn.layer["source-layer"],Wn.id);Wn.source=Wn.layer.source,Wn.layer["source-layer"]&&(Wn.sourceLayer=Wn.layer["source-layer"]),Wn.state=Ei})};for(var ui in Vt)oi(ui);return Vt}(this._layers,this._serializedLayers,this.sourceCaches,o,h,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(be)},u.prototype.querySourceFeatures=function(o,h){h&&h.filter&&this._validate(d.validateStyle.filter,"querySourceFeatures.filter",h.filter,null,h);var y=this.sourceCaches[o];return y?function(b,T){for(var R=b.getRenderableIds().map(function(He){return b.getTileByID(He)}),j=[],ne={},be=0;be<R.length;be++){var Ce=R[be],Pe=Ce.tileID.canonical.key;ne[Pe]||(ne[Pe]=!0,Ce.querySourceFeatures(j,T))}return j}(y,h):[]},u.prototype.addSourceType=function(o,h,y){return u.getSourceType(o)?y(new Error('A source type called "'+o+'" already exists.')):(u.setSourceType(o,h),h.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:o,url:h.workerSourceURL},y):y(null,null))},u.prototype.getLight=function(){return this.light.getLight()},u.prototype.setLight=function(o,h){h===void 0&&(h={}),this._checkLoaded();var y=this.light.getLight(),b=!1;for(var T in o)if(!d.deepEqual(o[T],y[T])){b=!0;break}if(b){var R={now:d.browser.now(),transition:d.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(o,h),this.light.updateTransitions(R)}},u.prototype._validate=function(o,h,y,b,T){return T===void 0&&(T={}),(!T||T.validate!==!1)&&ys(this,o.call(d.validateStyle,d.extend({key:h,style:this.serialize(),value:y,styleSpec:d.styleSpec},b)))},u.prototype._remove=function(){for(var o in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[o].setEventedParent(null);for(var h in this.sourceCaches)this.sourceCaches[h].clearTiles(),this.sourceCaches[h].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},u.prototype._clearSource=function(o){this.sourceCaches[o].clearTiles()},u.prototype._reloadSource=function(o){this.sourceCaches[o].resume(),this.sourceCaches[o].reload()},u.prototype._updateSources=function(o){for(var h in this.sourceCaches)this.sourceCaches[h].update(o)},u.prototype._generateCollisionBoxes=function(){for(var o in this.sourceCaches)this._reloadSource(o)},u.prototype._updatePlacement=function(o,h,y,b,T){T===void 0&&(T=!1);for(var R=!1,j=!1,ne={},be=0,Ce=this._order;be<Ce.length;be+=1){var Pe=this._layers[Ce[be]];if(Pe.type==="symbol"){if(!ne[Pe.source]){var He=this.sourceCaches[Pe.source];ne[Pe.source]=He.getRenderableIds(!0).map(function(Et){return He.getTileByID(Et)}).sort(function(Et,Vt){return Vt.tileID.overscaledZ-Et.tileID.overscaledZ||(Et.tileID.isLessThan(Vt.tileID)?-1:1)})}var je=this.crossTileSymbolIndex.addLayer(Pe,ne[Pe.source],o.center.lng);R=R||je}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((T=T||this._layerOrderChanged||y===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.browser.now(),o.zoom))&&(this.pauseablePlacement=new vu(o,this._order,T,h,y,b,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,ne),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.browser.now()),j=!0),R&&this.pauseablePlacement.placement.setStale()),j||R)for(var ot=0,ze=this._order;ot<ze.length;ot+=1){var at=this._layers[ze[ot]];at.type==="symbol"&&this.placement.updateLayerOpacities(at,ne[at.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.browser.now())},u.prototype._releaseSymbolFadeTiles=function(){for(var o in this.sourceCaches)this.sourceCaches[o].releaseSymbolFadeTiles()},u.prototype.getImages=function(o,h,y){this.imageManager.getImages(h.icons,y),this._updateTilesForChangedImages();var b=this.sourceCaches[h.source];b&&b.setDependencies(h.tileID.key,h.type,h.icons)},u.prototype.getGlyphs=function(o,h,y){this.glyphManager.getGlyphs(h.stacks,y)},u.prototype.getResource=function(o,h,y){return d.makeRequest(h,y)},u}(d.Evented);Is.getSourceType=function(i){return Ur[i]},Is.setSourceType=function(i,u){Ur[i]=u},Is.registerForPluginStateChange=d.registerForPluginStateChange;var Ta=d.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ro=Ti(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),gl=Ti(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),U=Ti(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),nl=Ti(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),Rl=Ti("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),yl=Ti(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),il=Ti(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),nu=Ti("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),Fu=Ti("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),m=Ti("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),w=Ti(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),N=Ti(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),I=Ti(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),le=Ti(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),Oe=Ti(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),ct=Ti(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Ft=Ti(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ut=Ti(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),Fr=Ti(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),Kr=Ti(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ni=Ti(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Ii=Ti(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),bi=Ti(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),pa=Ti(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),Pa=Ti(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),za=Ti(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ti(i,u){var o=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,h=u.match(/attribute ([\w]+) ([\w]+)/g),y=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=u.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),T=b?b.concat(y):y,R={};return{fragmentSource:i=i.replace(o,function(j,ne,be,Ce,Pe){return R[Pe]=!0,ne==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
varying `+be+" "+Ce+" "+Pe+`;
#else
uniform `+be+" "+Ce+" u_"+Pe+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Pe+`
    `+be+" "+Ce+" "+Pe+" = u_"+Pe+`;
#endif
`}),vertexSource:u=u.replace(o,function(j,ne,be,Ce,Pe){var He=Ce==="float"?"vec2":"vec4",je=Pe.match(/color/)?"color":He;return R[Pe]?ne==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+be+" "+He+" a_"+Pe+`;
varying `+be+" "+Ce+" "+Pe+`;
#else
uniform `+be+" "+Ce+" u_"+Pe+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = a_"+Pe+`;
#else
    `+be+" "+Ce+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+Pe+" = unpack_mix_"+je+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+be+" "+Ce+" "+Pe+" = u_"+Pe+`;
#endif
`:ne==="define"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
uniform lowp float u_`+Pe+`_t;
attribute `+be+" "+He+" a_"+Pe+`;
#else
uniform `+be+" "+Ce+" u_"+Pe+`;
#endif
`:je==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+be+" "+Ce+" "+Pe+" = a_"+Pe+`;
#else
    `+be+" "+Ce+" "+Pe+" = u_"+Pe+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Pe+`
    `+be+" "+Ce+" "+Pe+" = unpack_mix_"+je+"(a_"+Pe+", u_"+Pe+`_t);
#else
    `+be+" "+Ce+" "+Pe+" = u_"+Pe+`;
#endif
`}),staticAttributes:h,staticUniforms:T}}var _s=Object.freeze({__proto__:null,prelude:Ro,background:gl,backgroundPattern:U,circle:nl,clippingMask:Rl,heatmap:yl,heatmapTexture:il,collisionBox:nu,collisionCircle:Fu,debug:m,fill:w,fillOutline:N,fillOutlinePattern:I,fillPattern:le,fillExtrusion:Oe,fillExtrusionPattern:ct,hillshadePrepare:Ft,hillshade:Ut,line:Fr,lineGradient:Kr,linePattern:ni,lineSDF:Ii,raster:bi,symbolIcon:pa,symbolSDF:Pa,symbolTextAndIcon:za}),iu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Bu(i){for(var u=[],o=0;o<i.length;o++)if(i[o]!==null){var h=i[o].split(" ");u.push(h.pop())}return u}iu.prototype.bind=function(i,u,o,h,y,b,T,R){this.context=i;for(var j=this.boundPaintVertexBuffers.length!==h.length,ne=0;!j&&ne<h.length;ne++)this.boundPaintVertexBuffers[ne]!==h[ne]&&(j=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===o&&!j&&this.boundIndexBuffer===y&&this.boundVertexOffset===b&&this.boundDynamicVertexBuffer===T&&this.boundDynamicVertexBuffer2===R?(i.bindVertexArrayOES.set(this.vao),T&&T.bind(),y&&y.dynamicDraw&&y.bind(),R&&R.bind()):this.freshBind(u,o,h,y,b,T,R)},iu.prototype.freshBind=function(i,u,o,h,y,b,T){var R,j=i.numAttributes,ne=this.context,be=ne.gl;if(ne.extVertexArrayObject)this.vao&&this.destroy(),this.vao=ne.extVertexArrayObject.createVertexArrayOES(),ne.bindVertexArrayOES.set(this.vao),R=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=o,this.boundIndexBuffer=h,this.boundVertexOffset=y,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=T;else{R=ne.currentNumAttributes||0;for(var Ce=j;Ce<R;Ce++)be.disableVertexAttribArray(Ce)}u.enableAttributes(be,i);for(var Pe=0,He=o;Pe<He.length;Pe+=1)He[Pe].enableAttributes(be,i);b&&b.enableAttributes(be,i),T&&T.enableAttributes(be,i),u.bind(),u.setVertexAttribPointers(be,i,y);for(var je=0,ot=o;je<ot.length;je+=1){var ze=ot[je];ze.bind(),ze.setVertexAttribPointers(be,i,y)}b&&(b.bind(),b.setVertexAttribPointers(be,i,y)),h&&h.bind(),T&&(T.bind(),T.setVertexAttribPointers(be,i,y)),ne.currentNumAttributes=j},iu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var tc=function(i,u,o,h,y,b){var T=i.gl;this.program=T.createProgram();for(var R=Bu(o.staticAttributes),j=h?h.getBinderAttributes():[],ne=R.concat(j),be=o.staticUniforms?Bu(o.staticUniforms):[],Ce=h?h.getBinderUniforms():[],Pe=[],He=0,je=be.concat(Ce);He<je.length;He+=1){var ot=je[He];Pe.indexOf(ot)<0&&Pe.push(ot)}var ze=h?h.defines():[];b&&ze.push("#define OVERDRAW_INSPECTOR;");var at=ze.concat(Ro.fragmentSource,o.fragmentSource).join(`
`),Et=ze.concat(Ro.vertexSource,o.vertexSource).join(`
`),Vt=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(Vt,at),T.compileShader(Vt),T.attachShader(this.program,Vt);var mr=T.createShader(T.VERTEX_SHADER);if(T.isContextLost())this.failedToCreate=!0;else{T.shaderSource(mr,Et),T.compileShader(mr),T.attachShader(this.program,mr),this.attributes={};var ur={};this.numAttributes=ne.length;for(var Er=0;Er<this.numAttributes;Er++)ne[Er]&&(T.bindAttribLocation(this.program,Er,ne[Er]),this.attributes[ne[Er]]=Er);T.linkProgram(this.program),T.deleteShader(mr),T.deleteShader(Vt);for(var jr=0;jr<Pe.length;jr++){var hn=Pe[jr];if(hn&&!ur[hn]){var nn=T.getUniformLocation(this.program,hn);nn&&(ur[hn]=nn)}}this.fixedUniforms=y(i,ur),this.binderUniforms=h?h.getUniforms(i,ur):[]}}};function Yu(i,u,o){var h=1/xa(o,1,u.transform.tileZoom),y=Math.pow(2,o.tileID.overscaledZ),b=o.tileSize*Math.pow(2,u.transform.tileZoom)/y,T=b*(o.tileID.canonical.x+o.tileID.wrap*y),R=b*o.tileID.canonical.y;return{u_image:0,u_texsize:o.imageAtlasTexture.size,u_scale:[h,i.fromScale,i.toScale],u_fade:i.t,u_pixel_coord_upper:[T>>16,R>>16],u_pixel_coord_lower:[65535&T,65535&R]}}tc.prototype.draw=function(i,u,o,h,y,b,T,R,j,ne,be,Ce,Pe,He,je,ot){var ze,at=i.gl;if(!this.failedToCreate){for(var Et in i.program.set(this.program),i.setDepthMode(o),i.setStencilMode(h),i.setColorMode(y),i.setCullFace(b),this.fixedUniforms)this.fixedUniforms[Et].set(T[Et]);He&&He.setUniforms(i,this.binderUniforms,Ce,{zoom:Pe});for(var Vt=(ze={},ze[at.LINES]=2,ze[at.TRIANGLES]=3,ze[at.LINE_STRIP]=1,ze)[u],mr=0,ur=be.get();mr<ur.length;mr+=1){var Er=ur[mr],jr=Er.vaos||(Er.vaos={});(jr[R]||(jr[R]=new iu)).bind(i,this,j,He?He.getPaintVertexBuffers():[],ne,Er.vertexOffset,je,ot),at.drawElements(u,Er.primitiveLength*Vt,at.UNSIGNED_SHORT,Er.primitiveOffset*Vt*2)}}};var rc=function(i,u,o,h){var y=u.style.light,b=y.properties.get("position"),T=[b.x,b.y,b.z],R=d.create$1();y.properties.get("anchor")==="viewport"&&d.fromRotation(R,-u.transform.angle),d.transformMat3(T,T,R);var j=y.properties.get("color");return{u_matrix:i,u_lightpos:T,u_lightintensity:y.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+o,u_opacity:h}},mu=function(i,u,o,h,y,b,T){return d.extend(rc(i,u,o,h),Yu(b,u,T),{u_height_factor:-Math.pow(2,y.overscaledZ)/T.tileSize/8})},gu=function(i){return{u_matrix:i}},Tu=function(i,u,o,h){return d.extend(gu(i),Yu(o,u,h))},xo=function(i,u){return{u_matrix:i,u_world:u}},nc=function(i,u,o,h,y){return d.extend(Tu(i,u,o,h),{u_world:y})},yc=function(i,u,o,h){var y,b,T=i.transform;if(h.paint.get("circle-pitch-alignment")==="map"){var R=xa(o,1,T.zoom);y=!0,b=[R,R]}else y=!1,b=T.pixelsToGLUnits;return{u_camera_to_center_distance:T.cameraToCenterDistance,u_scale_with_map:+(h.paint.get("circle-pitch-scale")==="map"),u_matrix:i.translatePosMatrix(u.posMatrix,o,h.paint.get("circle-translate"),h.paint.get("circle-translate-anchor")),u_pitch_with_map:+y,u_device_pixel_ratio:d.browser.devicePixelRatio,u_extrude_scale:b}},cs=function(i,u,o){var h=xa(o,1,u.zoom),y=Math.pow(2,u.zoom-o.tileID.overscaledZ),b=o.tileID.overscaleFactor();return{u_matrix:i,u_camera_to_center_distance:u.cameraToCenterDistance,u_pixels_to_tile_units:h,u_extrude_scale:[u.pixelsToGLUnits[0]/(h*y),u.pixelsToGLUnits[1]/(h*y)],u_overscale_factor:b}},ic=function(i,u,o){return{u_matrix:i,u_inv_matrix:u,u_camera_to_center_distance:o.cameraToCenterDistance,u_viewport_size:[o.width,o.height]}},Xs=function(i,u,o){return o===void 0&&(o=1),{u_matrix:i,u_color:u,u_overlay:0,u_overlay_scale:o}},sa=function(i){return{u_matrix:i}},_c=function(i,u,o,h){return{u_matrix:i,u_extrude_scale:xa(u,1,o),u_intensity:h}},al=function(i,u,o){var h=i.transform;return{u_matrix:_u(i,u,o),u_ratio:1/xa(u,1,h.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_units_to_pixels:[1/h.pixelsToGLUnits[0],1/h.pixelsToGLUnits[1]]}},Ga=function(i,u,o,h){return d.extend(al(i,u,o),{u_image:0,u_image_height:h})},_l=function(i,u,o,h){var y=i.transform,b=yu(u,y);return{u_matrix:_u(i,u,o),u_texsize:u.imageAtlasTexture.size,u_ratio:1/xa(u,1,y.zoom),u_device_pixel_ratio:d.browser.devicePixelRatio,u_image:0,u_scale:[b,h.fromScale,h.toScale],u_fade:h.t,u_units_to_pixels:[1/y.pixelsToGLUnits[0],1/y.pixelsToGLUnits[1]]}},Nu=function(i,u,o,h,y){var b=i.lineAtlas,T=yu(u,i.transform),R=o.layout.get("line-cap")==="round",j=b.getDash(h.from,R),ne=b.getDash(h.to,R),be=j.width*y.fromScale,Ce=ne.width*y.toScale;return d.extend(al(i,u,o),{u_patternscale_a:[T/be,-j.height/2],u_patternscale_b:[T/Ce,-ne.height/2],u_sdfgamma:b.width/(256*Math.min(be,Ce)*d.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:j.y,u_tex_y_b:ne.y,u_mix:y.t})};function yu(i,u){return 1/xa(i,1,u.tileZoom)}function _u(i,u,o){return i.translatePosMatrix(u.tileID.posMatrix,u,o.paint.get("line-translate"),o.paint.get("line-translate-anchor"))}var au=function(i,u,o,h,y){return{u_matrix:i,u_tl_parent:u,u_scale_parent:o,u_buffer_scale:1,u_fade_t:h.mix,u_opacity:h.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(T=y.paint.get("raster-saturation"),T>0?1-1/(1.001-T):-T),u_contrast_factor:(b=y.paint.get("raster-contrast"),b>0?1/(1-b):1+b),u_spin_weights:xl(y.paint.get("raster-hue-rotate"))};var b,T};function xl(i){i*=Math.PI/180;var u=Math.sin(i),o=Math.cos(i);return[(2*o+1)/3,(-Math.sqrt(3)*u-o+1)/3,(Math.sqrt(3)*u-o+1)/3]}var xu,Ys=function(i,u,o,h,y,b,T,R,j,ne){var be=y.transform;return{u_is_size_zoom_constant:+(i==="constant"||i==="source"),u_is_size_feature_constant:+(i==="constant"||i==="camera"),u_size_t:u?u.uSizeT:0,u_size:u?u.uSize:0,u_camera_to_center_distance:be.cameraToCenterDistance,u_pitch:be.pitch/360*2*Math.PI,u_rotate_symbol:+o,u_aspect_ratio:be.width/be.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:R,u_is_text:+j,u_pitch_with_map:+h,u_texsize:ne,u_texture:0}},Pu=function(i,u,o,h,y,b,T,R,j,ne,be){var Ce=y.transform;return d.extend(Ys(i,u,o,h,y,b,T,R,j,ne),{u_gamma_scale:h?Math.cos(Ce._pitch)*Ce.cameraToCenterDistance:1,u_device_pixel_ratio:d.browser.devicePixelRatio,u_is_halo:+be})},Os=function(i,u,o,h,y,b,T,R,j,ne){return d.extend(Pu(i,u,o,h,y,b,T,R,!0,j,!0),{u_texsize_icon:ne,u_texture_icon:1})},ou=function(i,u,o){return{u_matrix:i,u_opacity:u,u_color:o}},wo=function(i,u,o,h,y,b){return d.extend(function(T,R,j,ne){var be=j.imageManager.getPattern(T.from.toString()),Ce=j.imageManager.getPattern(T.to.toString()),Pe=j.imageManager.getPixelSize(),He=Pe.width,je=Pe.height,ot=Math.pow(2,ne.tileID.overscaledZ),ze=ne.tileSize*Math.pow(2,j.transform.tileZoom)/ot,at=ze*(ne.tileID.canonical.x+ne.tileID.wrap*ot),Et=ze*ne.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:be.tl,u_pattern_br_a:be.br,u_pattern_tl_b:Ce.tl,u_pattern_br_b:Ce.br,u_texsize:[He,je],u_mix:R.t,u_pattern_size_a:be.displaySize,u_pattern_size_b:Ce.displaySize,u_scale_a:R.fromScale,u_scale_b:R.toScale,u_tile_units_to_pixels:1/xa(ne,1,j.transform.tileZoom),u_pixel_coord_upper:[at>>16,Et>>16],u_pixel_coord_lower:[65535&at,65535&Et]}}(h,b,o,y),{u_matrix:i,u_opacity:u})},Ls={fillExtrusion:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fillExtrusionPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_lightpos:new d.Uniform3f(i,u.u_lightpos),u_lightintensity:new d.Uniform1f(i,u.u_lightintensity),u_lightcolor:new d.Uniform3f(i,u.u_lightcolor),u_vertical_gradient:new d.Uniform1f(i,u.u_vertical_gradient),u_height_factor:new d.Uniform1f(i,u.u_height_factor),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade),u_opacity:new d.Uniform1f(i,u.u_opacity)}},fill:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},fillPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},fillOutline:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world)}},fillOutlinePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_texsize:new d.Uniform2f(i,u.u_texsize),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},circle:function(i,u){return{u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_scale_with_map:new d.Uniform1i(i,u.u_scale_with_map),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},collisionBox:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pixels_to_tile_units:new d.Uniform1f(i,u.u_pixels_to_tile_units),u_extrude_scale:new d.Uniform2f(i,u.u_extrude_scale),u_overscale_factor:new d.Uniform1f(i,u.u_overscale_factor)}},collisionCircle:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_inv_matrix:new d.UniformMatrix4f(i,u.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(i,u.u_viewport_size)}},debug:function(i,u){return{u_color:new d.UniformColor(i,u.u_color),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_overlay:new d.Uniform1i(i,u.u_overlay),u_overlay_scale:new d.Uniform1f(i,u.u_overlay_scale)}},clippingMask:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmap:function(i,u){return{u_extrude_scale:new d.Uniform1f(i,u.u_extrude_scale),u_intensity:new d.Uniform1f(i,u.u_intensity),u_matrix:new d.UniformMatrix4f(i,u.u_matrix)}},heatmapTexture:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_world:new d.Uniform2f(i,u.u_world),u_image:new d.Uniform1i(i,u.u_image),u_color_ramp:new d.Uniform1i(i,u.u_color_ramp),u_opacity:new d.Uniform1f(i,u.u_opacity)}},hillshade:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_latrange:new d.Uniform2f(i,u.u_latrange),u_light:new d.Uniform2f(i,u.u_light),u_shadow:new d.UniformColor(i,u.u_shadow),u_highlight:new d.UniformColor(i,u.u_highlight),u_accent:new d.UniformColor(i,u.u_accent)}},hillshadePrepare:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_image:new d.Uniform1i(i,u.u_image),u_dimension:new d.Uniform2f(i,u.u_dimension),u_zoom:new d.Uniform1f(i,u.u_zoom),u_unpack:new d.Uniform4f(i,u.u_unpack)}},line:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels)}},lineGradient:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_image:new d.Uniform1i(i,u.u_image),u_image_height:new d.Uniform1f(i,u.u_image_height)}},linePattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_texsize:new d.Uniform2f(i,u.u_texsize),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_image:new d.Uniform1i(i,u.u_image),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_scale:new d.Uniform3f(i,u.u_scale),u_fade:new d.Uniform1f(i,u.u_fade)}},lineSDF:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_ratio:new d.Uniform1f(i,u.u_ratio),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(i,u.u_units_to_pixels),u_patternscale_a:new d.Uniform2f(i,u.u_patternscale_a),u_patternscale_b:new d.Uniform2f(i,u.u_patternscale_b),u_sdfgamma:new d.Uniform1f(i,u.u_sdfgamma),u_image:new d.Uniform1i(i,u.u_image),u_tex_y_a:new d.Uniform1f(i,u.u_tex_y_a),u_tex_y_b:new d.Uniform1f(i,u.u_tex_y_b),u_mix:new d.Uniform1f(i,u.u_mix)}},raster:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_tl_parent:new d.Uniform2f(i,u.u_tl_parent),u_scale_parent:new d.Uniform1f(i,u.u_scale_parent),u_buffer_scale:new d.Uniform1f(i,u.u_buffer_scale),u_fade_t:new d.Uniform1f(i,u.u_fade_t),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image0:new d.Uniform1i(i,u.u_image0),u_image1:new d.Uniform1i(i,u.u_image1),u_brightness_low:new d.Uniform1f(i,u.u_brightness_low),u_brightness_high:new d.Uniform1f(i,u.u_brightness_high),u_saturation_factor:new d.Uniform1f(i,u.u_saturation_factor),u_contrast_factor:new d.Uniform1f(i,u.u_contrast_factor),u_spin_weights:new d.Uniform3f(i,u.u_spin_weights)}},symbolIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture)}},symbolSDF:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texture:new d.Uniform1i(i,u.u_texture),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},symbolTextAndIcon:function(i,u){return{u_is_size_zoom_constant:new d.Uniform1i(i,u.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(i,u.u_is_size_feature_constant),u_size_t:new d.Uniform1f(i,u.u_size_t),u_size:new d.Uniform1f(i,u.u_size),u_camera_to_center_distance:new d.Uniform1f(i,u.u_camera_to_center_distance),u_pitch:new d.Uniform1f(i,u.u_pitch),u_rotate_symbol:new d.Uniform1i(i,u.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(i,u.u_aspect_ratio),u_fade_change:new d.Uniform1f(i,u.u_fade_change),u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(i,u.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(i,u.u_coord_matrix),u_is_text:new d.Uniform1i(i,u.u_is_text),u_pitch_with_map:new d.Uniform1i(i,u.u_pitch_with_map),u_texsize:new d.Uniform2f(i,u.u_texsize),u_texsize_icon:new d.Uniform2f(i,u.u_texsize_icon),u_texture:new d.Uniform1i(i,u.u_texture),u_texture_icon:new d.Uniform1i(i,u.u_texture_icon),u_gamma_scale:new d.Uniform1f(i,u.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(i,u.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(i,u.u_is_halo)}},background:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_color:new d.UniformColor(i,u.u_color)}},backgroundPattern:function(i,u){return{u_matrix:new d.UniformMatrix4f(i,u.u_matrix),u_opacity:new d.Uniform1f(i,u.u_opacity),u_image:new d.Uniform1i(i,u.u_image),u_pattern_tl_a:new d.Uniform2f(i,u.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(i,u.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(i,u.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(i,u.u_pattern_br_b),u_texsize:new d.Uniform2f(i,u.u_texsize),u_mix:new d.Uniform1f(i,u.u_mix),u_pattern_size_a:new d.Uniform2f(i,u.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(i,u.u_pattern_size_b),u_scale_a:new d.Uniform1f(i,u.u_scale_a),u_scale_b:new d.Uniform1f(i,u.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(i,u.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(i,u.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(i,u.u_tile_units_to_pixels)}}};function xs(i,u,o,h,y,b,T){for(var R=i.context,j=R.gl,ne=i.useProgram("collisionBox"),be=[],Ce=0,Pe=0,He=0;He<h.length;He++){var je=h[He],ot=u.getTile(je),ze=ot.getBucket(o);if(ze){var at=je.posMatrix;y[0]===0&&y[1]===0||(at=i.translatePosMatrix(je.posMatrix,ot,y,b));var Et=T?ze.textCollisionBox:ze.iconCollisionBox,Vt=ze.collisionCircleArray;if(Vt.length>0){var mr=d.create(),ur=at;d.mul(mr,ze.placementInvProjMatrix,i.transform.glCoordMatrix),d.mul(mr,mr,ze.placementViewportMatrix),be.push({circleArray:Vt,circleOffset:Pe,transform:ur,invTransform:mr}),Pe=Ce+=Vt.length/4}Et&&ne.draw(R,j.LINES,F.disabled,ee.disabled,i.colorModeForRenderPass(),Te.disabled,cs(at,i.transform,ot),o.id,Et.layoutVertexBuffer,Et.indexBuffer,Et.segments,null,i.transform.zoom,null,null,Et.collisionVertexBuffer)}}if(T&&be.length){var Er=i.useProgram("collisionCircle"),jr=new d.StructArrayLayout2f1f2i16;jr.resize(4*Ce),jr._trim();for(var hn=0,nn=0,Nn=be;nn<Nn.length;nn+=1)for(var oi=Nn[nn],ui=0;ui<oi.circleArray.length/4;ui++){var ai=4*ui,Qi=oi.circleArray[ai+0],Wn=oi.circleArray[ai+1],Ei=oi.circleArray[ai+2],Gi=oi.circleArray[ai+3];jr.emplace(hn++,Qi,Wn,Ei,Gi,0),jr.emplace(hn++,Qi,Wn,Ei,Gi,1),jr.emplace(hn++,Qi,Wn,Ei,Gi,2),jr.emplace(hn++,Qi,Wn,Ei,Gi,3)}(!xu||xu.length<2*Ce)&&(xu=function(oe){var we=2*oe,gt=new d.StructArrayLayout3ui6;gt.resize(we),gt._trim();for(var Mt=0;Mt<we;Mt++){var St=6*Mt;gt.uint16[St+0]=4*Mt+0,gt.uint16[St+1]=4*Mt+1,gt.uint16[St+2]=4*Mt+2,gt.uint16[St+3]=4*Mt+2,gt.uint16[St+4]=4*Mt+3,gt.uint16[St+5]=4*Mt+0}return gt}(Ce));for(var xi=R.createIndexBuffer(xu,!0),Ci=R.createVertexBuffer(jr,d.collisionCircleLayout.members,!0),Q=0,J=be;Q<J.length;Q+=1){var O=J[Q],k=ic(O.transform,O.invTransform,i.transform);Er.draw(R,j.TRIANGLES,F.disabled,ee.disabled,i.colorModeForRenderPass(),Te.disabled,k,o.id,Ci,xi,d.SegmentVector.simpleSegment(0,2*O.circleOffset,O.circleArray.length,O.circleArray.length/2),null,i.transform.zoom,null,null,null)}Ci.destroy(),xi.destroy()}}var Rs=d.identity(new Float32Array(16));function xc(i,u,o,h,y,b){var T=d.getAnchorAlignment(i),R=-(T.horizontalAlign-.5)*u,j=-(T.verticalAlign-.5)*o,ne=d.evaluateVariableOffset(i,h);return new d.Point((R/y+ne[0])*b,(j/y+ne[1])*b)}function ac(i,u,o,h,y,b,T,R,j,ne,be){var Ce=i.text.placedSymbolArray,Pe=i.text.dynamicLayoutVertexArray,He=i.icon.dynamicLayoutVertexArray,je={};Pe.clear();for(var ot=0;ot<Ce.length;ot++){var ze=Ce.get(ot),at=ze.hidden||!ze.crossTileID||i.allowVerticalPlacement&&!ze.placedOrientation?null:h[ze.crossTileID];if(at){var Et=new d.Point(ze.anchorX,ze.anchorY),Vt=Mi(Et,o?R:T),mr=Ji(b.cameraToCenterDistance,Vt.signedDistanceFromCamera),ur=y.evaluateSizeForFeature(i.textSizeData,ne,ze)*mr/d.ONE_EM;o&&(ur*=i.tilePixelRatio/j);for(var Er=xc(at.anchor,at.width,at.height,at.textOffset,at.textBoxScale,ur),jr=o?Mi(Et.add(Er),T).point:Vt.point.add(u?Er.rotate(-b.angle):Er),hn=i.allowVerticalPlacement&&ze.placedOrientation===d.WritingMode.vertical?Math.PI/2:0,nn=0;nn<ze.numGlyphs;nn++)d.addDynamicAttributes(Pe,jr,hn);be&&ze.associatedIconIndex>=0&&(je[ze.associatedIconIndex]={shiftedAnchor:jr,angle:hn})}else Yi(ze.numGlyphs,Pe)}if(be){He.clear();for(var Nn=i.icon.placedSymbolArray,oi=0;oi<Nn.length;oi++){var ui=Nn.get(oi);if(ui.hidden)Yi(ui.numGlyphs,He);else{var ai=je[oi];if(ai)for(var Qi=0;Qi<ui.numGlyphs;Qi++)d.addDynamicAttributes(He,ai.shiftedAnchor,ai.angle);else Yi(ui.numGlyphs,He)}}i.icon.dynamicLayoutVertexBuffer.updateData(He)}i.text.dynamicLayoutVertexBuffer.updateData(Pe)}function oc(i,u,o){return o.iconsInText&&u?"symbolTextAndIcon":i?"symbolSDF":"symbolIcon"}function ol(i,u,o,h,y,b,T,R,j,ne,be,Ce){for(var Pe=i.context,He=Pe.gl,je=i.transform,ot=R==="map",ze=j==="map",at=ot&&o.layout.get("symbol-placement")!=="point",Et=ot&&!ze&&!at,Vt=o.layout.get("symbol-sort-key").constantOr(1)!==void 0,mr=!1,ur=i.depthModeForSublayer(0,F.ReadOnly),Er=o.layout.get("text-variable-anchor"),jr=[],hn=0,nn=h;hn<nn.length;hn+=1){var Nn=nn[hn],oi=u.getTile(Nn),ui=oi.getBucket(o);if(ui){var ai=y?ui.text:ui.icon;if(ai&&ai.segments.get().length){var Qi=ai.programConfigurations.get(o.id),Wn=y||ui.sdfIcons,Ei=y?ui.textSizeData:ui.iconSizeData,Gi=ze||je.pitch!==0,xi=i.useProgram(oc(Wn,y,ui),Qi),Ci=d.evaluateSizeForZoom(Ei,je.zoom),Q=void 0,J=[0,0],O=void 0,k=void 0,oe=null,we=void 0;if(y)O=oi.glyphAtlasTexture,k=He.LINEAR,Q=oi.glyphAtlasTexture.size,ui.iconsInText&&(J=oi.imageAtlasTexture.size,oe=oi.imageAtlasTexture,we=Gi||i.options.rotating||i.options.zooming||Ei.kind==="composite"||Ei.kind==="camera"?He.LINEAR:He.NEAREST);else{var gt=o.layout.get("icon-size").constantOr(0)!==1||ui.iconsNeedLinear;O=oi.imageAtlasTexture,k=Wn||i.options.rotating||i.options.zooming||gt||Gi?He.LINEAR:He.NEAREST,Q=oi.imageAtlasTexture.size}var Mt=xa(oi,1,i.transform.zoom),St=La(Nn.posMatrix,ze,ot,i.transform,Mt),lr=_i(Nn.posMatrix,ze,ot,i.transform,Mt),Wr=Er&&ui.hasTextData(),Xn=o.layout.get("icon-text-fit")!=="none"&&Wr&&ui.hasIconData();at&&jo(ui,Nn.posMatrix,i,y,St,lr,ze,ne);var Un=i.translatePosMatrix(Nn.posMatrix,oi,b,T),ci=at||y&&Er||Xn?Rs:St,vi=i.translatePosMatrix(lr,oi,b,T,!0),jn=Wn&&o.paint.get(y?"text-halo-width":"icon-halo-width").constantOr(1)!==0,aa={program:xi,buffers:ai,uniformValues:Wn?ui.iconsInText?Os(Ei.kind,Ci,Et,ze,i,Un,ci,vi,Q,J):Pu(Ei.kind,Ci,Et,ze,i,Un,ci,vi,y,Q,!0):Ys(Ei.kind,Ci,Et,ze,i,Un,ci,vi,y,Q),atlasTexture:O,atlasTextureIcon:oe,atlasInterpolation:k,atlasInterpolationIcon:we,isSDF:Wn,hasHalo:jn};if(Vt&&ui.canOverlap){mr=!0;for(var da=0,Sa=ai.segments.get();da<Sa.length;da+=1){var vo=Sa[da];jr.push({segments:new d.SegmentVector([vo]),sortKey:vo.sortKey,state:aa})}}else jr.push({segments:ai.segments,sortKey:0,state:aa})}}}mr&&jr.sort(function(io,So){return io.sortKey-So.sortKey});for(var Ca=0,Bo=jr;Ca<Bo.length;Ca+=1){var Za=Bo[Ca],Ui=Za.state;if(Pe.activeTexture.set(He.TEXTURE0),Ui.atlasTexture.bind(Ui.atlasInterpolation,He.CLAMP_TO_EDGE),Ui.atlasTextureIcon&&(Pe.activeTexture.set(He.TEXTURE1),Ui.atlasTextureIcon&&Ui.atlasTextureIcon.bind(Ui.atlasInterpolationIcon,He.CLAMP_TO_EDGE)),Ui.isSDF){var ga=Ui.uniformValues;Ui.hasHalo&&(ga.u_is_halo=1,Dl(Ui.buffers,Za.segments,o,i,Ui.program,ur,be,Ce,ga)),ga.u_is_halo=0}Dl(Ui.buffers,Za.segments,o,i,Ui.program,ur,be,Ce,Ui.uniformValues)}}function Dl(i,u,o,h,y,b,T,R,j){var ne=h.context;y.draw(ne,ne.gl.TRIANGLES,b,T,R,Te.disabled,j,o.id,i.layoutVertexBuffer,i.indexBuffer,u,o.paint,h.transform.zoom,i.programConfigurations.get(o.id),i.dynamicLayoutVertexBuffer,i.opacityVertexBuffer)}function kl(i,u,o,h,y,b,T){var R,j,ne,be,Ce,Pe=i.context.gl,He=o.paint.get("fill-pattern"),je=He&&He.constantOr(1),ot=o.getCrossfadeParameters();T?(j=je&&!o.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",R=Pe.LINES):(j=je?"fillPattern":"fill",R=Pe.TRIANGLES);for(var ze=0,at=h;ze<at.length;ze+=1){var Et=at[ze],Vt=u.getTile(Et);if(!je||Vt.patternsLoaded()){var mr=Vt.getBucket(o);if(mr){var ur=mr.programConfigurations.get(o.id),Er=i.useProgram(j,ur);je&&(i.context.activeTexture.set(Pe.TEXTURE0),Vt.imageAtlasTexture.bind(Pe.LINEAR,Pe.CLAMP_TO_EDGE),ur.updatePaintBuffers(ot));var jr=He.constantOr(null);if(jr&&Vt.imageAtlas){var hn=Vt.imageAtlas,nn=hn.patternPositions[jr.to.toString()],Nn=hn.patternPositions[jr.from.toString()];nn&&Nn&&ur.setConstantPatternPositions(nn,Nn)}var oi=i.translatePosMatrix(Et.posMatrix,Vt,o.paint.get("fill-translate"),o.paint.get("fill-translate-anchor"));if(T){be=mr.indexBuffer2,Ce=mr.segments2;var ui=[Pe.drawingBufferWidth,Pe.drawingBufferHeight];ne=j==="fillOutlinePattern"&&je?nc(oi,i,ot,Vt,ui):xo(oi,ui)}else be=mr.indexBuffer,Ce=mr.segments,ne=je?Tu(oi,i,ot,Vt):gu(oi);Er.draw(i.context,R,y,i.stencilModeForClipping(Et),b,Te.disabled,ne,o.id,mr.layoutVertexBuffer,be,Ce,o.paint,i.transform.zoom,ur)}}}}function sc(i,u,o,h,y,b,T){for(var R=i.context,j=R.gl,ne=o.paint.get("fill-extrusion-pattern"),be=ne.constantOr(1),Ce=o.getCrossfadeParameters(),Pe=o.paint.get("fill-extrusion-opacity"),He=0,je=h;He<je.length;He+=1){var ot=je[He],ze=u.getTile(ot),at=ze.getBucket(o);if(at){var Et=at.programConfigurations.get(o.id),Vt=i.useProgram(be?"fillExtrusionPattern":"fillExtrusion",Et);be&&(i.context.activeTexture.set(j.TEXTURE0),ze.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),Et.updatePaintBuffers(Ce));var mr=ne.constantOr(null);if(mr&&ze.imageAtlas){var ur=ze.imageAtlas,Er=ur.patternPositions[mr.to.toString()],jr=ur.patternPositions[mr.from.toString()];Er&&jr&&Et.setConstantPatternPositions(Er,jr)}var hn=i.translatePosMatrix(ot.posMatrix,ze,o.paint.get("fill-extrusion-translate"),o.paint.get("fill-extrusion-translate-anchor")),nn=o.paint.get("fill-extrusion-vertical-gradient"),Nn=be?mu(hn,i,nn,Pe,ot,Ce,ze):rc(hn,i,nn,Pe);Vt.draw(R,R.gl.TRIANGLES,y,b,T,Te.backCCW,Nn,o.id,at.layoutVertexBuffer,at.indexBuffer,at.segments,o.paint,i.transform.zoom,Et)}}}function uc(i,u,o,h,y,b){var T=i.context,R=T.gl,j=u.fbo;if(j){var ne=i.useProgram("hillshade");T.activeTexture.set(R.TEXTURE0),R.bindTexture(R.TEXTURE_2D,j.colorAttachment.get());var be=function(Ce,Pe,He){var je=He.paint.get("hillshade-shadow-color"),ot=He.paint.get("hillshade-highlight-color"),ze=He.paint.get("hillshade-accent-color"),at=He.paint.get("hillshade-illumination-direction")*(Math.PI/180);He.paint.get("hillshade-illumination-anchor")==="viewport"&&(at-=Ce.transform.angle);var Et,Vt,mr,ur=!Ce.options.moving;return{u_matrix:Ce.transform.calculatePosMatrix(Pe.tileID.toUnwrapped(),ur),u_image:0,u_latrange:(Et=Pe.tileID,Vt=Math.pow(2,Et.canonical.z),mr=Et.canonical.y,[new d.MercatorCoordinate(0,mr/Vt).toLngLat().lat,new d.MercatorCoordinate(0,(mr+1)/Vt).toLngLat().lat]),u_light:[He.paint.get("hillshade-exaggeration"),at],u_shadow:je,u_highlight:ot,u_accent:ze}}(i,u,o);ne.draw(T,R.TRIANGLES,h,y,b,Te.disabled,be,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}}function Qc(i,u,o,h,y,b){var T=i.context,R=T.gl,j=u.dem;if(j&&j.data){var ne=j.dim,be=j.stride,Ce=j.getPixels();if(T.activeTexture.set(R.TEXTURE1),T.pixelStoreUnpackPremultiplyAlpha.set(!1),u.demTexture=u.demTexture||i.getTileTexture(be),u.demTexture){var Pe=u.demTexture;Pe.update(Ce,{premultiply:!1}),Pe.bind(R.NEAREST,R.CLAMP_TO_EDGE)}else u.demTexture=new d.Texture(T,Ce,R.RGBA,{premultiply:!1}),u.demTexture.bind(R.NEAREST,R.CLAMP_TO_EDGE);T.activeTexture.set(R.TEXTURE0);var He=u.fbo;if(!He){var je=new d.Texture(T,{width:ne,height:ne,data:null},R.RGBA);je.bind(R.LINEAR,R.CLAMP_TO_EDGE),(He=u.fbo=T.createFramebuffer(ne,ne,!0)).colorAttachment.set(je.texture)}T.bindFramebuffer.set(He.framebuffer),T.viewport.set([0,0,ne,ne]),i.useProgram("hillshadePrepare").draw(T,R.TRIANGLES,h,y,b,Te.disabled,function(ot,ze){var at=ze.stride,Et=d.create();return d.ortho(Et,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(Et,Et,[0,-d.EXTENT,0]),{u_matrix:Et,u_image:1,u_dimension:[at,at],u_zoom:ot.overscaledZ,u_unpack:ze.getUnpackVector()}}(u.tileID,j),o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments),u.needsHillshadePrepare=!1}}function Fl(i,u,o,h,y){var b=h.paint.get("raster-fade-duration");if(b>0){var T=d.browser.now(),R=(T-i.timeAdded)/b,j=u?(T-u.timeAdded)/b:-1,ne=o.getSource(),be=y.coveringZoomLevel({tileSize:ne.tileSize,roundZoom:ne.roundZoom}),Ce=!u||Math.abs(u.tileID.overscaledZ-be)>Math.abs(i.tileID.overscaledZ-be),Pe=Ce&&i.refreshedUponExpiration?1:d.clamp(Ce?R:1-j,0,1);return i.refreshedUponExpiration&&R>=1&&(i.refreshedUponExpiration=!1),u?{opacity:1,mix:1-Pe}:{opacity:Pe,mix:0}}return{opacity:1,mix:0}}var Ks=new d.Color(1,0,0,1),sl=new d.Color(0,1,0,1),zu=new d.Color(0,0,1,1),Ku=new d.Color(1,0,1,1),bc=new d.Color(0,1,1,1);function lc(i,u,o,h){Zu(i,0,u+o/2,i.transform.width,o,h)}function Sc(i,u,o,h){Zu(i,u-o/2,0,o,i.transform.height,h)}function Zu(i,u,o,h,y,b){var T=i.context,R=T.gl;R.enable(R.SCISSOR_TEST),R.scissor(u*d.browser.devicePixelRatio,o*d.browser.devicePixelRatio,h*d.browser.devicePixelRatio,y*d.browser.devicePixelRatio),T.clear({color:b}),R.disable(R.SCISSOR_TEST)}function kc(i,u,o){var h=i.context,y=h.gl,b=o.posMatrix,T=i.useProgram("debug"),R=F.disabled,j=ee.disabled,ne=i.colorModeForRenderPass();h.activeTexture.set(y.TEXTURE0),i.emptyTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),T.draw(h,y.LINE_STRIP,R,j,ne,Te.disabled,Xs(b,d.Color.red),"$debug",i.debugBuffer,i.tileBorderIndexBuffer,i.debugSegments);var be=u.getTileByID(o.key).latestRawTileData,Ce=Math.floor((be&&be.byteLength||0)/1024),Pe=u.getTile(o).tileSize,He=512/Math.min(Pe,512)*(o.overscaledZ/i.transform.zoom)*.5,je=o.canonical.toString();o.overscaledZ!==o.canonical.z&&(je+=" => "+o.overscaledZ),function(ot,ze){ot.initDebugOverlayCanvas();var at=ot.debugOverlayCanvas,Et=ot.context.gl,Vt=ot.debugOverlayCanvas.getContext("2d");Vt.clearRect(0,0,at.width,at.height),Vt.shadowColor="white",Vt.shadowBlur=2,Vt.lineWidth=1.5,Vt.strokeStyle="white",Vt.textBaseline="top",Vt.font="bold 36px Open Sans, sans-serif",Vt.fillText(ze,5,5),Vt.strokeText(ze,5,5),ot.debugOverlayTexture.update(at),ot.debugOverlayTexture.bind(Et.LINEAR,Et.CLAMP_TO_EDGE)}(i,je+" "+Ce+"kb"),T.draw(h,y.TRIANGLES,R,j,he.alphaBlended,Te.disabled,Xs(b,d.Color.transparent,He),"$debug",i.debugBuffer,i.quadTriangleIndexBuffer,i.debugSegments)}var ul={symbol:function(i,u,o,h,y){if(i.renderPass==="translucent"){var b=ee.disabled,T=i.colorModeForRenderPass();o.layout.get("text-variable-anchor")&&function(R,j,ne,be,Ce,Pe,He){for(var je=j.transform,ot=Ce==="map",ze=Pe==="map",at=0,Et=R;at<Et.length;at+=1){var Vt=Et[at],mr=be.getTile(Vt),ur=mr.getBucket(ne);if(ur&&ur.text&&ur.text.segments.get().length){var Er=d.evaluateSizeForZoom(ur.textSizeData,je.zoom),jr=xa(mr,1,j.transform.zoom),hn=La(Vt.posMatrix,ze,ot,j.transform,jr),nn=ne.layout.get("icon-text-fit")!=="none"&&ur.hasIconData();if(Er){var Nn=Math.pow(2,je.zoom-mr.tileID.overscaledZ);ac(ur,ot,ze,He,d.symbolSize,je,hn,Vt.posMatrix,Nn,Er,nn)}}}}(h,i,o,u,o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),y),o.paint.get("icon-opacity").constantOr(1)!==0&&ol(i,u,o,h,!1,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),o.layout.get("icon-rotation-alignment"),o.layout.get("icon-pitch-alignment"),o.layout.get("icon-keep-upright"),b,T),o.paint.get("text-opacity").constantOr(1)!==0&&ol(i,u,o,h,!0,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),o.layout.get("text-rotation-alignment"),o.layout.get("text-pitch-alignment"),o.layout.get("text-keep-upright"),b,T),u.map.showCollisionBoxes&&(xs(i,u,o,h,o.paint.get("text-translate"),o.paint.get("text-translate-anchor"),!0),xs(i,u,o,h,o.paint.get("icon-translate"),o.paint.get("icon-translate-anchor"),!1))}},circle:function(i,u,o,h){if(i.renderPass==="translucent"){var y=o.paint.get("circle-opacity"),b=o.paint.get("circle-stroke-width"),T=o.paint.get("circle-stroke-opacity"),R=o.layout.get("circle-sort-key").constantOr(1)!==void 0;if(y.constantOr(1)!==0||b.constantOr(1)!==0&&T.constantOr(1)!==0){for(var j=i.context,ne=j.gl,be=i.depthModeForSublayer(0,F.ReadOnly),Ce=ee.disabled,Pe=i.colorModeForRenderPass(),He=[],je=0;je<h.length;je++){var ot=h[je],ze=u.getTile(ot),at=ze.getBucket(o);if(at){var Et=at.programConfigurations.get(o.id),Vt={programConfiguration:Et,program:i.useProgram("circle",Et),layoutVertexBuffer:at.layoutVertexBuffer,indexBuffer:at.indexBuffer,uniformValues:yc(i,ot,ze,o)};if(R)for(var mr=0,ur=at.segments.get();mr<ur.length;mr+=1){var Er=ur[mr];He.push({segments:new d.SegmentVector([Er]),sortKey:Er.sortKey,state:Vt})}else He.push({segments:at.segments,sortKey:0,state:Vt})}}R&&He.sort(function(oi,ui){return oi.sortKey-ui.sortKey});for(var jr=0,hn=He;jr<hn.length;jr+=1){var nn=hn[jr],Nn=nn.state;Nn.program.draw(j,ne.TRIANGLES,be,Ce,Pe,Te.disabled,Nn.uniformValues,o.id,Nn.layoutVertexBuffer,Nn.indexBuffer,nn.segments,o.paint,i.transform.zoom,Nn.programConfiguration)}}}},heatmap:function(i,u,o,h){if(o.paint.get("heatmap-opacity")!==0)if(i.renderPass==="offscreen"){var y=i.context,b=y.gl,T=ee.disabled,R=new he([b.ONE,b.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(He,je,ot){var ze=He.gl;He.activeTexture.set(ze.TEXTURE1),He.viewport.set([0,0,je.width/4,je.height/4]);var at=ot.heatmapFbo;if(at)ze.bindTexture(ze.TEXTURE_2D,at.colorAttachment.get()),He.bindFramebuffer.set(at.framebuffer);else{var Et=ze.createTexture();ze.bindTexture(ze.TEXTURE_2D,Et),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_S,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_WRAP_T,ze.CLAMP_TO_EDGE),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MIN_FILTER,ze.LINEAR),ze.texParameteri(ze.TEXTURE_2D,ze.TEXTURE_MAG_FILTER,ze.LINEAR),at=ot.heatmapFbo=He.createFramebuffer(je.width/4,je.height/4,!1),function(Vt,mr,ur,Er){var jr=Vt.gl;jr.texImage2D(jr.TEXTURE_2D,0,jr.RGBA,mr.width/4,mr.height/4,0,jr.RGBA,Vt.extRenderToTextureHalfFloat?Vt.extTextureHalfFloat.HALF_FLOAT_OES:jr.UNSIGNED_BYTE,null),Er.colorAttachment.set(ur)}(He,je,Et,at)}})(y,i,o),y.clear({color:d.Color.transparent});for(var j=0;j<h.length;j++){var ne=h[j];if(!u.hasRenderableParent(ne)){var be=u.getTile(ne),Ce=be.getBucket(o);if(Ce){var Pe=Ce.programConfigurations.get(o.id);i.useProgram("heatmap",Pe).draw(y,b.TRIANGLES,F.disabled,T,R,Te.disabled,_c(ne.posMatrix,be,i.transform.zoom,o.paint.get("heatmap-intensity")),o.id,Ce.layoutVertexBuffer,Ce.indexBuffer,Ce.segments,o.paint,i.transform.zoom,Pe)}}}y.viewport.set([0,0,i.width,i.height])}else i.renderPass==="translucent"&&(i.context.setColorMode(i.colorModeForRenderPass()),function(He,je){var ot=He.context,ze=ot.gl,at=je.heatmapFbo;if(at){ot.activeTexture.set(ze.TEXTURE0),ze.bindTexture(ze.TEXTURE_2D,at.colorAttachment.get()),ot.activeTexture.set(ze.TEXTURE1);var Et=je.colorRampTexture;Et||(Et=je.colorRampTexture=new d.Texture(ot,je.colorRamp,ze.RGBA)),Et.bind(ze.LINEAR,ze.CLAMP_TO_EDGE),He.useProgram("heatmapTexture").draw(ot,ze.TRIANGLES,F.disabled,ee.disabled,He.colorModeForRenderPass(),Te.disabled,function(Vt,mr,ur,Er){var jr=d.create();d.ortho(jr,0,Vt.width,Vt.height,0,0,1);var hn=Vt.context.gl;return{u_matrix:jr,u_world:[hn.drawingBufferWidth,hn.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:mr.paint.get("heatmap-opacity")}}(He,je),je.id,He.viewportBuffer,He.quadTriangleIndexBuffer,He.viewportSegments,je.paint,He.transform.zoom)}}(i,o))},line:function(i,u,o,h){if(i.renderPass==="translucent"){var y=o.paint.get("line-opacity"),b=o.paint.get("line-width");if(y.constantOr(1)!==0&&b.constantOr(1)!==0)for(var T=i.depthModeForSublayer(0,F.ReadOnly),R=i.colorModeForRenderPass(),j=o.paint.get("line-dasharray"),ne=o.paint.get("line-pattern"),be=ne.constantOr(1),Ce=o.paint.get("line-gradient"),Pe=o.getCrossfadeParameters(),He=be?"linePattern":j?"lineSDF":Ce?"lineGradient":"line",je=i.context,ot=je.gl,ze=!0,at=0,Et=h;at<Et.length;at+=1){var Vt=Et[at],mr=u.getTile(Vt);if(!be||mr.patternsLoaded()){var ur=mr.getBucket(o);if(ur){var Er=ur.programConfigurations.get(o.id),jr=i.context.program.get(),hn=i.useProgram(He,Er),nn=ze||hn.program!==jr,Nn=ne.constantOr(null);if(Nn&&mr.imageAtlas){var oi=mr.imageAtlas,ui=oi.patternPositions[Nn.to.toString()],ai=oi.patternPositions[Nn.from.toString()];ui&&ai&&Er.setConstantPatternPositions(ui,ai)}var Qi=be?_l(i,mr,o,Pe):j?Nu(i,mr,o,j,Pe):Ce?Ga(i,mr,o,ur.lineClipsArray.length):al(i,mr,o);if(be)je.activeTexture.set(ot.TEXTURE0),mr.imageAtlasTexture.bind(ot.LINEAR,ot.CLAMP_TO_EDGE),Er.updatePaintBuffers(Pe);else if(j&&(nn||i.lineAtlas.dirty))je.activeTexture.set(ot.TEXTURE0),i.lineAtlas.bind(je);else if(Ce){var Wn=ur.gradients[o.id],Ei=Wn.texture;if(o.gradientVersion!==Wn.version){var Gi=256;if(o.stepInterpolant){var xi=u.getSource().maxzoom,Ci=Vt.canonical.z===xi?Math.ceil(1<<i.transform.maxZoom-Vt.canonical.z):1;Gi=d.clamp(d.nextPowerOfTwo(ur.maxLineLength/d.EXTENT*1024*Ci),256,je.maxTextureSize)}Wn.gradient=d.renderColorRamp({expression:o.gradientExpression(),evaluationKey:"lineProgress",resolution:Gi,image:Wn.gradient||void 0,clips:ur.lineClipsArray}),Wn.texture?Wn.texture.update(Wn.gradient):Wn.texture=new d.Texture(je,Wn.gradient,ot.RGBA),Wn.version=o.gradientVersion,Ei=Wn.texture}je.activeTexture.set(ot.TEXTURE0),Ei.bind(o.stepInterpolant?ot.NEAREST:ot.LINEAR,ot.CLAMP_TO_EDGE)}hn.draw(je,ot.TRIANGLES,T,i.stencilModeForClipping(Vt),R,Te.disabled,Qi,o.id,ur.layoutVertexBuffer,ur.indexBuffer,ur.segments,o.paint,i.transform.zoom,Er,ur.layoutVertexBuffer2),ze=!1}}}}},fill:function(i,u,o,h){var y=o.paint.get("fill-color"),b=o.paint.get("fill-opacity");if(b.constantOr(1)!==0){var T=i.colorModeForRenderPass(),R=o.paint.get("fill-pattern"),j=i.opaquePassEnabledForLayer()&&!R.constantOr(1)&&y.constantOr(d.Color.transparent).a===1&&b.constantOr(0)===1?"opaque":"translucent";if(i.renderPass===j){var ne=i.depthModeForSublayer(1,i.renderPass==="opaque"?F.ReadWrite:F.ReadOnly);kl(i,u,o,h,ne,T,!1)}if(i.renderPass==="translucent"&&o.paint.get("fill-antialias")){var be=i.depthModeForSublayer(o.getPaintProperty("fill-outline-color")?2:0,F.ReadOnly);kl(i,u,o,h,be,T,!0)}}},"fill-extrusion":function(i,u,o,h){var y=o.paint.get("fill-extrusion-opacity");if(y!==0&&i.renderPass==="translucent"){var b=new F(i.context.gl.LEQUAL,F.ReadWrite,i.depthRangeFor3D);if(y!==1||o.paint.get("fill-extrusion-pattern").constantOr(1))sc(i,u,o,h,b,ee.disabled,he.disabled),sc(i,u,o,h,b,i.stencilModeFor3D(),i.colorModeForRenderPass());else{var T=i.colorModeForRenderPass();sc(i,u,o,h,b,ee.disabled,T)}}},hillshade:function(i,u,o,h){if(i.renderPass==="offscreen"||i.renderPass==="translucent"){for(var y=i.context,b=i.depthModeForSublayer(0,F.ReadOnly),T=i.colorModeForRenderPass(),R=i.renderPass==="translucent"?i.stencilConfigForOverlap(h):[{},h],j=R[0],ne=0,be=R[1];ne<be.length;ne+=1){var Ce=be[ne],Pe=u.getTile(Ce);Pe.needsHillshadePrepare&&i.renderPass==="offscreen"?Qc(i,Pe,o,b,ee.disabled,T):i.renderPass==="translucent"&&uc(i,Pe,o,b,j[Ce.overscaledZ],T)}y.viewport.set([0,0,i.width,i.height])}},raster:function(i,u,o,h){if(i.renderPass==="translucent"&&o.paint.get("raster-opacity")!==0&&h.length)for(var y=i.context,b=y.gl,T=u.getSource(),R=i.useProgram("raster"),j=i.colorModeForRenderPass(),ne=T instanceof vt?[{},h]:i.stencilConfigForOverlap(h),be=ne[0],Ce=ne[1],Pe=Ce[Ce.length-1].overscaledZ,He=!i.options.moving,je=0,ot=Ce;je<ot.length;je+=1){var ze=ot[je],at=i.depthModeForSublayer(ze.overscaledZ-Pe,o.paint.get("raster-opacity")===1?F.ReadWrite:F.ReadOnly,b.LESS),Et=u.getTile(ze),Vt=i.transform.calculatePosMatrix(ze.toUnwrapped(),He);Et.registerFadeDuration(o.paint.get("raster-fade-duration"));var mr=u.findLoadedParent(ze,0),ur=Fl(Et,mr,u,o,i.transform),Er=void 0,jr=void 0,hn=o.paint.get("raster-resampling")==="nearest"?b.NEAREST:b.LINEAR;y.activeTexture.set(b.TEXTURE0),Et.texture.bind(hn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),y.activeTexture.set(b.TEXTURE1),mr?(mr.texture.bind(hn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST),Er=Math.pow(2,mr.tileID.overscaledZ-Et.tileID.overscaledZ),jr=[Et.tileID.canonical.x*Er%1,Et.tileID.canonical.y*Er%1]):Et.texture.bind(hn,b.CLAMP_TO_EDGE,b.LINEAR_MIPMAP_NEAREST);var nn=au(Vt,jr||[0,0],Er||1,ur,o);T instanceof vt?R.draw(y,b.TRIANGLES,at,ee.disabled,j,Te.disabled,nn,o.id,T.boundsBuffer,i.quadTriangleIndexBuffer,T.boundsSegments):R.draw(y,b.TRIANGLES,at,be[ze.overscaledZ],j,Te.disabled,nn,o.id,i.rasterBoundsBuffer,i.quadTriangleIndexBuffer,i.rasterBoundsSegments)}},background:function(i,u,o){var h=o.paint.get("background-color"),y=o.paint.get("background-opacity");if(y!==0){var b=i.context,T=b.gl,R=i.transform,j=R.tileSize,ne=o.paint.get("background-pattern");if(!i.isPatternMissing(ne)){var be=!ne&&h.a===1&&y===1&&i.opaquePassEnabledForLayer()?"opaque":"translucent";if(i.renderPass===be){var Ce=ee.disabled,Pe=i.depthModeForSublayer(0,be==="opaque"?F.ReadWrite:F.ReadOnly),He=i.colorModeForRenderPass(),je=i.useProgram(ne?"backgroundPattern":"background"),ot=R.coveringTiles({tileSize:j});ne&&(b.activeTexture.set(T.TEXTURE0),i.imageManager.bind(i.context));for(var ze=o.getCrossfadeParameters(),at=0,Et=ot;at<Et.length;at+=1){var Vt=Et[at],mr=i.transform.calculatePosMatrix(Vt.toUnwrapped()),ur=ne?wo(mr,y,i,ne,{tileID:Vt,tileSize:j},ze):ou(mr,y,h);je.draw(b,T.TRIANGLES,Pe,Ce,He,Te.disabled,ur,o.id,i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}}}},debug:function(i,u,o){for(var h=0;h<o.length;h++)kc(i,u,o[h])},custom:function(i,u,o){var h=i.context,y=o.implementation;if(i.renderPass==="offscreen"){var b=y.prerender;b&&(i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),b.call(y,h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState())}else if(i.renderPass==="translucent"){i.setCustomLayerDefaults(),h.setColorMode(i.colorModeForRenderPass()),h.setStencilMode(ee.disabled);var T=y.renderingMode==="3d"?new F(i.context.gl.LEQUAL,F.ReadWrite,i.depthRangeFor3D):i.depthModeForSublayer(0,F.ReadOnly);h.setDepthMode(T),y.render(h.gl,i.transform.customLayerMatrix()),h.setDirty(),i.setBaseState(),h.bindFramebuffer.set(null)}}},lo=function(i,u){this.context=new ae(i),this.transform=u,this._tileTextures={},this.setup(),this.numSublayers=Ee.maxUnderzooming+Ee.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ls,this.gpuTimers={}};lo.prototype.resize=function(i,u){if(this.width=i*d.browser.devicePixelRatio,this.height=u*d.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var o=0,h=this.style._order;o<h.length;o+=1)this.style._layers[h[o]].resize()},lo.prototype.setup=function(){var i=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,Ta.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);var o=new d.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(d.EXTENT,0),o.emplaceBack(0,d.EXTENT),o.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=i.createVertexBuffer(o,Ta.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);var h=new d.StructArrayLayout4i8;h.emplaceBack(0,0,0,0),h.emplaceBack(d.EXTENT,0,d.EXTENT,0),h.emplaceBack(0,d.EXTENT,0,d.EXTENT),h.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(h,xt.members),this.rasterBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);var y=new d.StructArrayLayout2i4;y.emplaceBack(0,0),y.emplaceBack(1,0),y.emplaceBack(0,1),y.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(y,Ta.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);var b=new d.StructArrayLayout1ui2;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(b);var T=new d.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T),this.emptyTexture=new d.Texture(i,{width:1,height:1,data:new Uint8Array([0,0,0,0])},i.gl.RGBA);var R=this.context.gl;this.stencilClearMode=new ee({func:R.ALWAYS,mask:0},0,255,R.ZERO,R.ZERO,R.ZERO)},lo.prototype.clearStencil=function(){var i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var o=d.create();d.ortho(o,0,this.width,this.height,0,0,1),d.scale(o,o,[u.drawingBufferWidth,u.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,u.TRIANGLES,F.disabled,this.stencilClearMode,he.disabled,Te.disabled,sa(o),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},lo.prototype._renderTileClippingMasks=function(i,u){if(this.currentStencilSource!==i.source&&i.isTileClipped()&&u&&u.length){this.currentStencilSource=i.source;var o=this.context,h=o.gl;this.nextStencilID+u.length>256&&this.clearStencil(),o.setColorMode(he.disabled),o.setDepthMode(F.disabled);var y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var b=0,T=u;b<T.length;b+=1){var R=T[b],j=this._tileClippingMaskIDs[R.key]=this.nextStencilID++;y.draw(o,h.TRIANGLES,F.disabled,new ee({func:h.ALWAYS,mask:0},j,255,h.KEEP,h.KEEP,h.REPLACE),he.disabled,Te.disabled,sa(R.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},lo.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var i=this.nextStencilID++,u=this.context.gl;return new ee({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)},lo.prototype.stencilModeForClipping=function(i){var u=this.context.gl;return new ee({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)},lo.prototype.stencilConfigForOverlap=function(i){var u,o=this.context.gl,h=i.sort(function(j,ne){return ne.overscaledZ-j.overscaledZ}),y=h[h.length-1].overscaledZ,b=h[0].overscaledZ-y+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();for(var T={},R=0;R<b;R++)T[R+y]=new ee({func:o.GEQUAL,mask:255},R+this.nextStencilID,255,o.KEEP,o.KEEP,o.REPLACE);return this.nextStencilID+=b,[T,h]}return[(u={},u[y]=ee.disabled,u),h]},lo.prototype.colorModeForRenderPass=function(){var i=this.context.gl;return this._showOverdrawInspector?new he([i.CONSTANT_COLOR,i.ONE],new d.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?he.unblended:he.alphaBlended},lo.prototype.depthModeForSublayer=function(i,u,o){if(!this.opaquePassEnabledForLayer())return F.disabled;var h=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new F(o||this.context.gl.LEQUAL,u,[h,h])},lo.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},lo.prototype.render=function(i,u){var o=this;this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(d.browser.now()),this.imageManager.beginFrame();var h=this.style._order,y=this.style.sourceCaches;for(var b in y){var T=y[b];T.used&&T.prepare(this.context)}var R,j,ne={},be={},Ce={};for(var Pe in y){var He=y[Pe];ne[Pe]=He.getVisibleCoordinates(),be[Pe]=ne[Pe].slice().reverse(),Ce[Pe]=He.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var je=0;je<h.length;je++)if(this.style._layers[h[je]].is3D()){this.opaquePassCutoff=je;break}this.renderPass="offscreen";for(var ot=0,ze=h;ot<ze.length;ot+=1){var at=this.style._layers[ze[ot]];if(at.hasOffscreenPass()&&!at.isHidden(this.transform.zoom)){var Et=be[at.source];(at.type==="custom"||Et.length)&&this.renderLayer(this,y[at.source],at,Et)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=h.length-1;this.currentLayer>=0;this.currentLayer--){var Vt=this.style._layers[h[this.currentLayer]],mr=y[Vt.source],ur=ne[Vt.source];this._renderTileClippingMasks(Vt,ur),this.renderLayer(this,mr,Vt,ur)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<h.length;this.currentLayer++){var Er=this.style._layers[h[this.currentLayer]],jr=y[Er.source],hn=(Er.type==="symbol"?Ce:be)[Er.source];this._renderTileClippingMasks(Er,ne[Er.source]),this.renderLayer(this,jr,Er,hn)}this.options.showTileBoundaries&&(d.values(this.style._layers).forEach(function(nn){nn.source&&!nn.isHidden(o.transform.zoom)&&(nn.source!==(j&&j.id)&&(j=o.style.sourceCaches[nn.source]),(!R||R.getSource().maxzoom<j.getSource().maxzoom)&&(R=j))}),R&&ul.debug(this,R,R.getVisibleCoordinates())),this.options.showPadding&&function(nn){var Nn=nn.transform.padding;lc(nn,nn.transform.height-(Nn.top||0),3,Ks),lc(nn,Nn.bottom||0,3,sl),Sc(nn,Nn.left||0,3,zu),Sc(nn,nn.transform.width-(Nn.right||0),3,Ku);var oi=nn.transform.centerPoint;(function(ui,ai,Qi,Wn){Zu(ui,ai-1,Qi-10,2,20,Wn),Zu(ui,ai-10,Qi-1,20,2,Wn)})(nn,oi.x,nn.transform.height-oi.y,bc)}(this),this.context.setDefault()},lo.prototype.renderLayer=function(i,u,o,h){o.isHidden(this.transform.zoom)||(o.type==="background"||o.type==="custom"||h.length)&&(this.id=o.id,this.gpuTimingStart(o),ul[o.type](i,u,o,h,this.style.placement.variableOffsets),this.gpuTimingEnd())},lo.prototype.gpuTimingStart=function(i){if(this.options.gpuTiming){var u=this.context.extTimerQuery,o=this.gpuTimers[i.id];o||(o=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),o.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,o.query)}},lo.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}},lo.prototype.collectGpuTimers=function(){var i=this.gpuTimers;return this.gpuTimers={},i},lo.prototype.queryGpuTimers=function(i){var u={};for(var o in i){var h=i[o],y=this.context.extTimerQuery,b=y.getQueryObjectEXT(h.query,y.QUERY_RESULT_EXT)/1e6;y.deleteQueryEXT(h.query),u[o]=b}return u},lo.prototype.translatePosMatrix=function(i,u,o,h,y){if(!o[0]&&!o[1])return i;var b=y?h==="map"?this.transform.angle:0:h==="viewport"?-this.transform.angle:0;if(b){var T=Math.sin(b),R=Math.cos(b);o=[o[0]*R-o[1]*T,o[0]*T+o[1]*R]}var j=[y?o[0]:xa(u,o[0],this.transform.zoom),y?o[1]:xa(u,o[1],this.transform.zoom),0],ne=new Float32Array(16);return d.translate(ne,i,j),ne},lo.prototype.saveTileTexture=function(i){var u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]},lo.prototype.getTileTexture=function(i){var u=this._tileTextures[i];return u&&u.length>0?u.pop():null},lo.prototype.isPatternMissing=function(i){if(!i)return!1;if(!i.from||!i.to)return!0;var u=this.imageManager.getPattern(i.from.toString()),o=this.imageManager.getPattern(i.to.toString());return!u||!o},lo.prototype.useProgram=function(i,u){this.cache=this.cache||{};var o=""+i+(u?u.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[o]||(this.cache[o]=new tc(this.context,i,_s[i],u,Ls[i],this._showOverdrawInspector)),this.cache[o]},lo.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},lo.prototype.setBaseState=function(){var i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)},lo.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},lo.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Bl=function(i,u){this.points=i,this.planes=u};Bl.fromInvProjectionMatrix=function(i,u,o){var h=Math.pow(2,o),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(T){return d.transformMat4([],T,i)}).map(function(T){return d.scale$1([],T,1/T[3]/u*h)}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(T){var R=d.sub([],y[T[0]],y[T[1]]),j=d.sub([],y[T[2]],y[T[1]]),ne=d.normalize([],d.cross([],R,j)),be=-d.dot(ne,y[T[1]]);return ne.concat(be)});return new Bl(y,b)};var ll=function(i,u){this.min=i,this.max=u,this.center=d.scale$2([],d.add([],this.min,this.max),.5)};ll.prototype.quadrant=function(i){for(var u=[i%2==0,i<2],o=d.clone$2(this.min),h=d.clone$2(this.max),y=0;y<u.length;y++)o[y]=u[y]?this.min[y]:this.center[y],h[y]=u[y]?this.center[y]:this.max[y];return h[2]=this.max[2],new ll(o,h)},ll.prototype.distanceX=function(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]},ll.prototype.distanceY=function(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]},ll.prototype.intersects=function(i){for(var u=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],o=!0,h=0;h<i.planes.length;h++){for(var y=i.planes[h],b=0,T=0;T<u.length;T++)b+=d.dot$1(y,u[T])>=0;if(b===0)return 0;b!==u.length&&(o=!1)}if(o)return 2;for(var R=0;R<3;R++){for(var j=Number.MAX_VALUE,ne=-Number.MAX_VALUE,be=0;be<i.points.length;be++){var Ce=i.points[be][R]-this.min[R];j=Math.min(j,Ce),ne=Math.max(ne,Ce)}if(ne<0||j>this.max[R]-this.min[R])return 0}return 1};var Ds=function(i,u,o,h){if(i===void 0&&(i=0),u===void 0&&(u=0),o===void 0&&(o=0),h===void 0&&(h=0),isNaN(i)||i<0||isNaN(u)||u<0||isNaN(o)||o<0||isNaN(h)||h<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=o,this.right=h};Ds.prototype.interpolate=function(i,u,o){return u.top!=null&&i.top!=null&&(this.top=d.number(i.top,u.top,o)),u.bottom!=null&&i.bottom!=null&&(this.bottom=d.number(i.bottom,u.bottom,o)),u.left!=null&&i.left!=null&&(this.left=d.number(i.left,u.left,o)),u.right!=null&&i.right!=null&&(this.right=d.number(i.right,u.right,o)),this},Ds.prototype.getCenter=function(i,u){var o=d.clamp((this.left+i-this.right)/2,0,i),h=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.Point(o,h)},Ds.prototype.equals=function(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right},Ds.prototype.clone=function(){return new Ds(this.top,this.bottom,this.left,this.right)},Ds.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var ua=function(i,u,o,h,y){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=y===void 0||y,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=o==null?0:o,this._maxPitch=h==null?60:h,this.setMaxBounds(),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Ds,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ha={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};ua.prototype.clone=function(){var i=new ua(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.tileSize=this.tileSize,i.latRange=this.latRange,i.width=this.width,i.height=this.height,i._center=this._center,i.zoom=this.zoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._calcMatrices(),i},Ha.minZoom.get=function(){return this._minZoom},Ha.minZoom.set=function(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))},Ha.maxZoom.get=function(){return this._maxZoom},Ha.maxZoom.set=function(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))},Ha.minPitch.get=function(){return this._minPitch},Ha.minPitch.set=function(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))},Ha.maxPitch.get=function(){return this._maxPitch},Ha.maxPitch.set=function(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))},Ha.renderWorldCopies.get=function(){return this._renderWorldCopies},Ha.renderWorldCopies.set=function(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i},Ha.worldSize.get=function(){return this.tileSize*this.scale},Ha.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ha.size.get=function(){return new d.Point(this.width,this.height)},Ha.bearing.get=function(){return-this.angle/Math.PI*180},Ha.bearing.set=function(i){var u=-d.wrap(i,-180,180)*Math.PI/180;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=d.create$2(),d.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ha.pitch.get=function(){return this._pitch/Math.PI*180},Ha.pitch.set=function(i){var u=d.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())},Ha.fov.get=function(){return this._fov/Math.PI*180},Ha.fov.set=function(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())},Ha.zoom.get=function(){return this._zoom},Ha.zoom.set=function(i){var u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._zoom=u,this.scale=this.zoomScale(u),this.tileZoom=Math.floor(u),this.zoomFraction=u-this.tileZoom,this._constrain(),this._calcMatrices())},Ha.center.get=function(){return this._center},Ha.center.set=function(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())},Ha.padding.get=function(){return this._edgeInsets.toJSON()},Ha.padding.set=function(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())},Ha.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},ua.prototype.isPaddingEqual=function(i){return this._edgeInsets.equals(i)},ua.prototype.interpolatePadding=function(i,u,o){this._unmodified=!1,this._edgeInsets.interpolate(i,u,o),this._constrain(),this._calcMatrices()},ua.prototype.coveringZoomLevel=function(i){var u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)},ua.prototype.getVisibleUnwrappedCoordinates=function(i){var u=[new d.UnwrappedTileID(0,i)];if(this._renderWorldCopies)for(var o=this.pointCoordinate(new d.Point(0,0)),h=this.pointCoordinate(new d.Point(this.width,0)),y=this.pointCoordinate(new d.Point(this.width,this.height)),b=this.pointCoordinate(new d.Point(0,this.height)),T=Math.floor(Math.min(o.x,h.x,y.x,b.x)),R=Math.floor(Math.max(o.x,h.x,y.x,b.x)),j=T-1;j<=R+1;j++)j!==0&&u.push(new d.UnwrappedTileID(j,i));return u},ua.prototype.coveringTiles=function(i){var u=this.coveringZoomLevel(i),o=u;if(i.minzoom!==void 0&&u<i.minzoom)return[];i.maxzoom!==void 0&&u>i.maxzoom&&(u=i.maxzoom);var h=d.MercatorCoordinate.fromLngLat(this.center),y=Math.pow(2,u),b=[y*h.x,y*h.y,0],T=Bl.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u),R=i.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(R=u);var j=function(nn){return{aabb:new ll([nn*y,0,0],[(nn+1)*y,y,0]),zoom:0,x:0,y:0,wrap:nn,fullyVisible:!1}},ne=[],be=[],Ce=u,Pe=i.reparseOverscaled?o:u;if(this._renderWorldCopies)for(var He=1;He<=3;He++)ne.push(j(-He)),ne.push(j(He));for(ne.push(j(0));ne.length>0;){var je=ne.pop(),ot=je.x,ze=je.y,at=je.fullyVisible;if(!at){var Et=je.aabb.intersects(T);if(Et===0)continue;at=Et===2}var Vt=je.aabb.distanceX(b),mr=je.aabb.distanceY(b),ur=Math.max(Math.abs(Vt),Math.abs(mr));if(je.zoom===Ce||ur>3+(1<<Ce-je.zoom)-2&&je.zoom>=R)be.push({tileID:new d.OverscaledTileID(je.zoom===Ce?Pe:je.zoom,je.wrap,je.zoom,ot,ze),distanceSq:d.sqrLen([b[0]-.5-ot,b[1]-.5-ze])});else for(var Er=0;Er<4;Er++){var jr=(ot<<1)+Er%2,hn=(ze<<1)+(Er>>1);ne.push({aabb:je.aabb.quadrant(Er),zoom:je.zoom+1,x:jr,y:hn,wrap:je.wrap,fullyVisible:at})}}return be.sort(function(nn,Nn){return nn.distanceSq-Nn.distanceSq}).map(function(nn){return nn.tileID})},ua.prototype.resize=function(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()},Ha.unmodified.get=function(){return this._unmodified},ua.prototype.zoomScale=function(i){return Math.pow(2,i)},ua.prototype.scaleZoom=function(i){return Math.log(i)/Math.LN2},ua.prototype.project=function(i){var u=d.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new d.Point(d.mercatorXfromLng(i.lng)*this.worldSize,d.mercatorYfromLat(u)*this.worldSize)},ua.prototype.unproject=function(i){return new d.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()},Ha.point.get=function(){return this.project(this.center)},ua.prototype.setLocationAtPoint=function(i,u){var o=this.pointCoordinate(u),h=this.pointCoordinate(this.centerPoint),y=this.locationCoordinate(i),b=new d.MercatorCoordinate(y.x-(o.x-h.x),y.y-(o.y-h.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())},ua.prototype.locationPoint=function(i){return this.coordinatePoint(this.locationCoordinate(i))},ua.prototype.pointLocation=function(i){return this.coordinateLocation(this.pointCoordinate(i))},ua.prototype.locationCoordinate=function(i){return d.MercatorCoordinate.fromLngLat(i)},ua.prototype.coordinateLocation=function(i){return i.toLngLat()},ua.prototype.pointCoordinate=function(i){var u=[i.x,i.y,0,1],o=[i.x,i.y,1,1];d.transformMat4(u,u,this.pixelMatrixInverse),d.transformMat4(o,o,this.pixelMatrixInverse);var h=u[3],y=o[3],b=u[1]/h,T=o[1]/y,R=u[2]/h,j=o[2]/y,ne=R===j?0:(0-R)/(j-R);return new d.MercatorCoordinate(d.number(u[0]/h,o[0]/y,ne)/this.worldSize,d.number(b,T,ne)/this.worldSize)},ua.prototype.coordinatePoint=function(i){var u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix),new d.Point(u[0]/u[3],u[1]/u[3])},ua.prototype.getBounds=function(){return new d.LngLatBounds().extend(this.pointLocation(new d.Point(0,0))).extend(this.pointLocation(new d.Point(this.width,0))).extend(this.pointLocation(new d.Point(this.width,this.height))).extend(this.pointLocation(new d.Point(0,this.height)))},ua.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new d.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},ua.prototype.setMaxBounds=function(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},ua.prototype.calculatePosMatrix=function(i,u){u===void 0&&(u=!1);var o=i.key,h=u?this._alignedPosMatrixCache:this._posMatrixCache;if(h[o])return h[o];var y=i.canonical,b=this.worldSize/this.zoomScale(y.z),T=y.x+Math.pow(2,y.z)*i.wrap,R=d.identity(new Float64Array(16));return d.translate(R,R,[T*b,y.y*b,0]),d.scale(R,R,[b/d.EXTENT,b/d.EXTENT,1]),d.multiply(R,u?this.alignedProjMatrix:this.projMatrix,R),h[o]=new Float32Array(R),h[o]},ua.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},ua.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var i,u,o,h,y=-90,b=90,T=-180,R=180,j=this.size,ne=this._unmodified;if(this.latRange){var be=this.latRange;y=d.mercatorYfromLat(be[1])*this.worldSize,i=(b=d.mercatorYfromLat(be[0])*this.worldSize)-y<j.y?j.y/(b-y):0}if(this.lngRange){var Ce=this.lngRange;T=d.mercatorXfromLng(Ce[0])*this.worldSize,u=(R=d.mercatorXfromLng(Ce[1])*this.worldSize)-T<j.x?j.x/(R-T):0}var Pe=this.point,He=Math.max(u||0,i||0);if(He)return this.center=this.unproject(new d.Point(u?(R+T)/2:Pe.x,i?(b+y)/2:Pe.y)),this.zoom+=this.scaleZoom(He),this._unmodified=ne,void(this._constraining=!1);if(this.latRange){var je=Pe.y,ot=j.y/2;je-ot<y&&(h=y+ot),je+ot>b&&(h=b-ot)}if(this.lngRange){var ze=Pe.x,at=j.x/2;ze-at<T&&(o=T+at),ze+at>R&&(o=R-at)}o===void 0&&h===void 0||(this.center=this.unproject(new d.Point(o!==void 0?o:Pe.x,h!==void 0?h:Pe.y))),this._unmodified=ne,this._constraining=!1}},ua.prototype._calcMatrices=function(){if(this.height){var i=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var u=Math.PI/2+this._pitch,o=this._fov*(.5+i.y/this.height),h=Math.sin(o)*this.cameraToCenterDistance/Math.sin(d.clamp(Math.PI-u-o,.01,Math.PI-.01)),y=this.point,b=y.x,T=y.y,R=1.01*(Math.cos(Math.PI/2-this._pitch)*h+this.cameraToCenterDistance),j=this.height/50,ne=new Float64Array(16);d.perspective(ne,this._fov,this.width/this.height,j,R),ne[8]=2*-i.x/this.width,ne[9]=2*i.y/this.height,d.scale(ne,ne,[1,-1,1]),d.translate(ne,ne,[0,0,-this.cameraToCenterDistance]),d.rotateX(ne,ne,this._pitch),d.rotateZ(ne,ne,this.angle),d.translate(ne,ne,[-b,-T,0]),this.mercatorMatrix=d.scale([],ne,[this.worldSize,this.worldSize,this.worldSize]),d.scale(ne,ne,[1,1,d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=ne,this.invProjMatrix=d.invert([],this.projMatrix);var be=this.width%2/2,Ce=this.height%2/2,Pe=Math.cos(this.angle),He=Math.sin(this.angle),je=b-Math.round(b)+Pe*be+He*Ce,ot=T-Math.round(T)+Pe*Ce+He*be,ze=new Float64Array(ne);if(d.translate(ze,ze,[je>.5?je-1:je,ot>.5?ot-1:ot,0]),this.alignedProjMatrix=ze,ne=d.create(),d.scale(ne,ne,[this.width/2,-this.height/2,1]),d.translate(ne,ne,[1,-1,0]),this.labelPlaneMatrix=ne,ne=d.create(),d.scale(ne,ne,[1,-1,1]),d.translate(ne,ne,[-1,-1,0]),d.scale(ne,ne,[2/this.width,2/this.height,1]),this.glCoordMatrix=ne,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(ne=d.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=ne,this._posMatrixCache={},this._alignedPosMatrixCache={}}},ua.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var i=this.pointCoordinate(new d.Point(0,0)),u=[i.x*this.worldSize,i.y*this.worldSize,0,1];return d.transformMat4(u,u,this.pixelMatrix)[3]/this.cameraToCenterDistance},ua.prototype.getCameraPoint=function(){var i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.Point(0,i))},ua.prototype.getCameraQueryGeometry=function(i){var u=this.getCameraPoint();if(i.length===1)return[i[0],u];for(var o=u.x,h=u.y,y=u.x,b=u.y,T=0,R=i;T<R.length;T+=1){var j=R[T];o=Math.min(o,j.x),h=Math.min(h,j.y),y=Math.max(y,j.x),b=Math.max(b,j.y)}return[new d.Point(o,h),new d.Point(y,h),new d.Point(y,b),new d.Point(o,b),new d.Point(o,h)]},Object.defineProperties(ua.prototype,Ha);var fs=function(i){var u,o,h,y;this._hashName=i&&encodeURIComponent(i),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(u=this._updateHashUnthrottled.bind(this),o=!1,h=null,y=function(){h=null,o&&(u(),h=setTimeout(y,300),o=!1)},function(){return o=!0,h||y(),h})};fs.prototype.addTo=function(i){return this._map=i,d.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},fs.prototype.remove=function(){return d.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},fs.prototype.getHashString=function(i){var u=this._map.getCenter(),o=Math.round(100*this._map.getZoom())/100,h=Math.ceil((o*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,h),b=Math.round(u.lng*y)/y,T=Math.round(u.lat*y)/y,R=this._map.getBearing(),j=this._map.getPitch(),ne="";if(ne+=i?"/"+b+"/"+T+"/"+o:o+"/"+T+"/"+b,(R||j)&&(ne+="/"+Math.round(10*R)/10),j&&(ne+="/"+Math.round(j)),this._hashName){var be=this._hashName,Ce=!1,Pe=d.window.location.hash.slice(1).split("&").map(function(He){var je=He.split("=")[0];return je===be?(Ce=!0,je+"="+ne):He}).filter(function(He){return He});return Ce||Pe.push(be+"="+ne),"#"+Pe.join("&")}return"#"+ne},fs.prototype._getCurrentHash=function(){var i,u=this,o=d.window.location.hash.replace("#","");return this._hashName?(o.split("&").map(function(h){return h.split("=")}).forEach(function(h){h[0]===u._hashName&&(i=h)}),(i&&i[1]||"").split("/")):o.split("/")},fs.prototype._onHashChange=function(){var i=this._getCurrentHash();if(i.length>=3&&!i.some(function(o){return isNaN(o)})){var u=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:u,pitch:+(i[4]||0)}),!0}return!1},fs.prototype._updateHashUnthrottled=function(){var i=d.window.location.href.replace(/(#.+)?$/,this.getHashString());try{d.window.history.replaceState(d.window.history.state,null,i)}catch(u){}};var bl={linearity:.3,easing:d.bezier(0,0,.3,1)},$u=d.extend({deceleration:2500,maxSpeed:1400},bl),Nl=d.extend({deceleration:20,maxSpeed:1400},bl),Fc=d.extend({deceleration:1e3,maxSpeed:360},bl),gf=d.extend({deceleration:1e3,maxSpeed:90},bl),Ju=function(i){this._map=i,this.clear()};function bo(i,u){(!i.duration||i.duration<u.duration)&&(i.duration=u.duration,i.easing=u.easing)}function Qa(i,u,o){var h=o.maxSpeed,y=o.linearity,b=o.deceleration,T=d.clamp(i*y/(u/1e3),-h,h),R=Math.abs(T)/(b*y);return{easing:o.easing,duration:1e3*R,amount:T*(R/2)}}Ju.prototype.clear=function(){this._inertiaBuffer=[]},Ju.prototype.record=function(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.browser.now(),settings:i})},Ju.prototype._drainInertiaBuffer=function(){for(var i=this._inertiaBuffer,u=d.browser.now();i.length>0&&u-i[0].time>160;)i.shift()},Ju.prototype._onMoveEnd=function(i){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var u={zoom:0,bearing:0,pitch:0,pan:new d.Point(0,0),pinchAround:void 0,around:void 0},o=0,h=this._inertiaBuffer;o<h.length;o+=1){var y=h[o].settings;u.zoom+=y.zoomDelta||0,u.bearing+=y.bearingDelta||0,u.pitch+=y.pitchDelta||0,y.panDelta&&u.pan._add(y.panDelta),y.around&&(u.around=y.around),y.pinchAround&&(u.pinchAround=y.pinchAround)}var b=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,T={};if(u.pan.mag()){var R=Qa(u.pan.mag(),b,d.extend({},$u,i||{}));T.offset=u.pan.mult(R.amount/u.pan.mag()),T.center=this._map.transform.center,bo(T,R)}if(u.zoom){var j=Qa(u.zoom,b,Nl);T.zoom=this._map.transform.zoom+j.amount,bo(T,j)}if(u.bearing){var ne=Qa(u.bearing,b,Fc);T.bearing=this._map.transform.bearing+d.clamp(ne.amount,-179,179),bo(T,ne)}if(u.pitch){var be=Qa(u.pitch,b,gf);T.pitch=this._map.transform.pitch+be.amount,bo(T,be)}if(T.zoom||T.bearing){var Ce=u.pinchAround===void 0?u.around:u.pinchAround;T.around=Ce?this._map.unproject(Ce):this._map.getCenter()}return this.clear(),d.extend(T,{noMoveStart:!0})}};var Do=function(i){function u(h,y,b,T){T===void 0&&(T={});var R=re.mousePos(y.getCanvasContainer(),b),j=y.unproject(R);i.call(this,h,d.extend({point:R,lngLat:j,originalEvent:b},T)),this._defaultPrevented=!1,this.target=y}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),bs=function(i){function u(h,y,b){var T=h==="touchend"?b.changedTouches:b.touches,R=re.touchPos(y.getCanvasContainer(),T),j=R.map(function(Ce){return y.unproject(Ce)}),ne=R.reduce(function(Ce,Pe,He,je){return Ce.add(Pe.div(je.length))},new d.Point(0,0)),be=y.unproject(ne);i.call(this,h,{points:R,point:ne,lngLats:j,lngLat:be,originalEvent:b}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),Sl=function(i){function u(h,y,b){i.call(this,h,{originalEvent:b}),this._defaultPrevented=!1}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={defaultPrevented:{configurable:!0}};return u.prototype.preventDefault=function(){this._defaultPrevented=!0},o.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(u.prototype,o),u}(d.Event),To=function(i,u){this._map=i,this._clickTolerance=u.clickTolerance};To.prototype.reset=function(){delete this._mousedownPos},To.prototype.wheel=function(i){return this._firePreventable(new Sl(i.type,this._map,i))},To.prototype.mousedown=function(i,u){return this._mousedownPos=u,this._firePreventable(new Do(i.type,this._map,i))},To.prototype.mouseup=function(i){this._map.fire(new Do(i.type,this._map,i))},To.prototype.click=function(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||this._map.fire(new Do(i.type,this._map,i))},To.prototype.dblclick=function(i){return this._firePreventable(new Do(i.type,this._map,i))},To.prototype.mouseover=function(i){this._map.fire(new Do(i.type,this._map,i))},To.prototype.mouseout=function(i){this._map.fire(new Do(i.type,this._map,i))},To.prototype.touchstart=function(i){return this._firePreventable(new bs(i.type,this._map,i))},To.prototype.touchmove=function(i){this._map.fire(new bs(i.type,this._map,i))},To.prototype.touchend=function(i){this._map.fire(new bs(i.type,this._map,i))},To.prototype.touchcancel=function(i){this._map.fire(new bs(i.type,this._map,i))},To.prototype._firePreventable=function(i){if(this._map.fire(i),i.defaultPrevented)return{}},To.prototype.isEnabled=function(){return!0},To.prototype.isActive=function(){return!1},To.prototype.enable=function(){},To.prototype.disable=function(){};var Cn=function(i){this._map=i};Cn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Cn.prototype.mousemove=function(i){this._map.fire(new Do(i.type,this._map,i))},Cn.prototype.mousedown=function(){this._delayContextMenu=!0},Cn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Do("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Cn.prototype.contextmenu=function(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Do(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()},Cn.prototype.isEnabled=function(){return!0},Cn.prototype.isActive=function(){return!1},Cn.prototype.enable=function(){},Cn.prototype.disable=function(){};var no=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1};function Mu(i,u){for(var o={},h=0;h<i.length;h++)o[i[h].identifier]=u[h];return o}no.prototype.isEnabled=function(){return!!this._enabled},no.prototype.isActive=function(){return!!this._active},no.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},no.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},no.prototype.mousedown=function(i,u){this.isEnabled()&&i.shiftKey&&i.button===0&&(re.disableDrag(),this._startPos=this._lastPos=u,this._active=!0)},no.prototype.mousemoveWindow=function(i,u){if(this._active){var o=u;if(!(this._lastPos.equals(o)||!this._box&&o.dist(this._startPos)<this._clickTolerance)){var h=this._startPos;this._lastPos=o,this._box||(this._box=re.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));var y=Math.min(h.x,o.x),b=Math.max(h.x,o.x),T=Math.min(h.y,o.y),R=Math.max(h.y,o.y);re.setTransform(this._box,"translate("+y+"px,"+T+"px)"),this._box.style.width=b-y+"px",this._box.style.height=R-T+"px"}}},no.prototype.mouseupWindow=function(i,u){var o=this;if(this._active&&i.button===0){var h=this._startPos,y=u;if(this.reset(),re.suppressClick(),h.x!==y.x||h.y!==y.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:function(b){return b.fitScreenCoordinates(h,y,o._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",i)}},no.prototype.keydown=function(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))},no.prototype.blur=function(){this.reset()},no.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(re.remove(this._box),this._box=null),re.enableDrag(),delete this._startPos,delete this._lastPos},no.prototype._fireEvent=function(i,u){return this._map.fire(new d.Event(i,{originalEvent:u}))};var cl=function(i){this.reset(),this.numTouches=i.numTouches};cl.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},cl.prototype.touchstart=function(i,u,o){(this.centroid||o.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),o.length===this.numTouches&&(this.centroid=function(h){for(var y=new d.Point(0,0),b=0,T=h;b<T.length;b+=1)y._add(T[b]);return y.div(h.length)}(u),this.touches=Mu(o,u)))},cl.prototype.touchmove=function(i,u,o){if(!this.aborted&&this.centroid){var h=Mu(o,u);for(var y in this.touches){var b=h[y];(!b||b.dist(this.touches[y])>30)&&(this.aborted=!0)}}},cl.prototype.touchend=function(i,u,o){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),o.length===0){var h=!this.aborted&&this.centroid;if(this.reset(),h)return h}};var su=function(i){this.singleTap=new cl(i),this.numTaps=i.numTaps,this.reset()};su.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},su.prototype.touchstart=function(i,u,o){this.singleTap.touchstart(i,u,o)},su.prototype.touchmove=function(i,u,o){this.singleTap.touchmove(i,u,o)},su.prototype.touchend=function(i,u,o){var h=this.singleTap.touchend(i,u,o);if(h){var y=i.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(h)<30;if(y&&b||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=h,this.count===this.numTaps)return this.reset(),h}};var ko=function(){this._zoomIn=new su({numTouches:1,numTaps:2}),this._zoomOut=new su({numTouches:2,numTaps:1}),this.reset()};ko.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ko.prototype.touchstart=function(i,u,o){this._zoomIn.touchstart(i,u,o),this._zoomOut.touchstart(i,u,o)},ko.prototype.touchmove=function(i,u,o){this._zoomIn.touchmove(i,u,o),this._zoomOut.touchmove(i,u,o)},ko.prototype.touchend=function(i,u,o){var h=this,y=this._zoomIn.touchend(i,u,o),b=this._zoomOut.touchend(i,u,o);return y?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(y)},{originalEvent:i})}}):b?(this._active=!0,i.preventDefault(),setTimeout(function(){return h.reset()},0),{cameraAnimation:function(T){return T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}}):void 0},ko.prototype.touchcancel=function(){this.reset()},ko.prototype.enable=function(){this._enabled=!0},ko.prototype.disable=function(){this._enabled=!1,this.reset()},ko.prototype.isEnabled=function(){return this._enabled},ko.prototype.isActive=function(){return this._active};var cc={0:1,2:2},xn=function(i){this.reset(),this._clickTolerance=i.clickTolerance||1};xn.prototype.blur=function(){this.reset()},xn.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},xn.prototype._correctButton=function(i,u){return!1},xn.prototype._move=function(i,u){return{}},xn.prototype.mousedown=function(i,u){if(!this._lastPoint){var o=re.mouseButton(i);this._correctButton(i,o)&&(this._lastPoint=u,this._eventButton=o)}},xn.prototype.mousemoveWindow=function(i,u){var o=this._lastPoint;if(o){if(i.preventDefault(),function(h,y){var b=cc[y];return h.buttons===void 0||(h.buttons&b)!==b}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(o)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(o,u)}},xn.prototype.mouseupWindow=function(i){this._lastPoint&&re.mouseButton(i)===this._eventButton&&(this._moved&&re.suppressClick(),this.reset())},xn.prototype.enable=function(){this._enabled=!0},xn.prototype.disable=function(){this._enabled=!1,this.reset()},xn.prototype.isEnabled=function(){return this._enabled},xn.prototype.isActive=function(){return this._active};var Wa=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.mousedown=function(o,h){i.prototype.mousedown.call(this,o,h),this._lastPoint&&(this._active=!0)},u.prototype._correctButton=function(o,h){return h===0&&!o.ctrlKey},u.prototype._move=function(o,h){return{around:h,panDelta:h.sub(o)}},u}(xn),Ec=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var y=.8*(h.x-o.x);if(y)return this._active=!0,{bearingDelta:y}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(xn),js=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype._correctButton=function(o,h){return h===0&&o.ctrlKey||h===2},u.prototype._move=function(o,h){var y=-.5*(h.y-o.y);if(y)return this._active=!0,{pitchDelta:y}},u.prototype.contextmenu=function(o){o.preventDefault()},u}(xn),qa=function(i){this._minTouches=1,this._clickTolerance=i.clickTolerance||1,this.reset()};qa.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new d.Point(0,0)},qa.prototype.touchstart=function(i,u,o){return this._calculateTransform(i,u,o)},qa.prototype.touchmove=function(i,u,o){if(this._active&&!(o.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,u,o)},qa.prototype.touchend=function(i,u,o){this._calculateTransform(i,u,o),this._active&&o.length<this._minTouches&&this.reset()},qa.prototype.touchcancel=function(){this.reset()},qa.prototype._calculateTransform=function(i,u,o){o.length>0&&(this._active=!0);var h=Mu(o,u),y=new d.Point(0,0),b=new d.Point(0,0),T=0;for(var R in h){var j=h[R],ne=this._touches[R];ne&&(y._add(j),b._add(j.sub(ne)),T++,h[R]=j)}if(this._touches=h,!(T<this._minTouches)&&b.mag()){var be=b.div(T);if(this._sum._add(be),!(this._sum.mag()<this._clickTolerance))return{around:y.div(T),panDelta:be}}},qa.prototype.enable=function(){this._enabled=!0},qa.prototype.disable=function(){this._enabled=!1,this.reset()},qa.prototype.isEnabled=function(){return this._enabled},qa.prototype.isActive=function(){return this._active};var Ya=function(){this.reset()};function zl(i,u,o){for(var h=0;h<i.length;h++)if(i[h].identifier===o)return u[h]}function bu(i,u){return Math.log(i/u)/Math.LN2}Ya.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Ya.prototype._start=function(i){},Ya.prototype._move=function(i,u,o){return{}},Ya.prototype.touchstart=function(i,u,o){this._firstTwoTouches||o.length<2||(this._firstTwoTouches=[o[0].identifier,o[1].identifier],this._start([u[0],u[1]]))},Ya.prototype.touchmove=function(i,u,o){if(this._firstTwoTouches){i.preventDefault();var h=this._firstTwoTouches,y=h[1],b=zl(o,u,h[0]),T=zl(o,u,y);if(b&&T){var R=this._aroundCenter?null:b.add(T).div(2);return this._move([b,T],R,i)}}},Ya.prototype.touchend=function(i,u,o){if(this._firstTwoTouches){var h=this._firstTwoTouches,y=h[1],b=zl(o,u,h[0]),T=zl(o,u,y);b&&T||(this._active&&re.suppressClick(),this.reset())}},Ya.prototype.touchcancel=function(){this.reset()},Ya.prototype.enable=function(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"},Ya.prototype.disable=function(){this._enabled=!1,this.reset()},Ya.prototype.isEnabled=function(){return this._enabled},Ya.prototype.isActive=function(){return this._active};var ks=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._distance,delete this._startDistance},u.prototype._start=function(o){this._startDistance=this._distance=o[0].dist(o[1])},u.prototype._move=function(o,h){var y=this._distance;if(this._distance=o[0].dist(o[1]),this._active||!(Math.abs(bu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:bu(this._distance,y),pinchAround:h}},u}(Ya);function Uu(i,u){return 180*i.angleWith(u)/Math.PI}var Bc=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},u.prototype._start=function(o){this._startVector=this._vector=o[0].sub(o[1]),this._minDiameter=o[0].dist(o[1])},u.prototype._move=function(o,h){var y=this._vector;if(this._vector=o[0].sub(o[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Uu(this._vector,y),pinchAround:h}},u.prototype._isBelowThreshold=function(o){this._minDiameter=Math.min(this._minDiameter,o.mag());var h=25/(Math.PI*this._minDiameter)*360,y=Uu(o,this._startVector);return Math.abs(y)<h},u}(Ya);function Zl(i){return Math.abs(i.y)>Math.abs(i.x)}var El=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.reset=function(){i.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},u.prototype._start=function(o){this._lastPoints=o,Zl(o[0].sub(o[1]))&&(this._valid=!1)},u.prototype._move=function(o,h,y){var b=o[0].sub(this._lastPoints[0]),T=o[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(b,T,y.timeStamp),this._valid)return this._lastPoints=o,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5}},u.prototype.gestureBeginsVertically=function(o,h,y){if(this._valid!==void 0)return this._valid;var b=o.mag()>=2,T=h.mag()>=2;if(b||T){if(!b||!T)return this._firstMove===void 0&&(this._firstMove=y),y-this._firstMove<100&&void 0;var R=o.y>0==h.y>0;return Zl(o)&&Zl(h)&&R}},u}(Ya),fc={panStep:100,bearingStep:15,pitchStep:10},Vs=function(){var i=fc;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1};function Fs(i){return i*(2-i)}Vs.prototype.blur=function(){this.reset()},Vs.prototype.reset=function(){this._active=!1},Vs.prototype.keydown=function(i){var u=this;if(!(i.altKey||i.ctrlKey||i.metaKey)){var o=0,h=0,y=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:o=1;break;case 189:case 109:case 173:o=-1;break;case 37:i.shiftKey?h=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?h=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?y=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?y=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(h=0,y=0),{cameraAnimation:function(R){var j=R.getZoom();R.easeTo({duration:300,easeId:"keyboardHandler",easing:Fs,zoom:o?Math.round(j)+o*(i.shiftKey?2:1):j,bearing:R.getBearing()+h*u._bearingStep,pitch:R.getPitch()+y*u._pitchStep,offset:[-b*u._panStep,-T*u._panStep],center:R.getCenter()},{originalEvent:i})}}}},Vs.prototype.enable=function(){this._enabled=!0},Vs.prototype.disable=function(){this._enabled=!1,this.reset()},Vs.prototype.isEnabled=function(){return this._enabled},Vs.prototype.isActive=function(){return this._active},Vs.prototype.disableRotation=function(){this._rotationDisabled=!0},Vs.prototype.enableRotation=function(){this._rotationDisabled=!1};var ea=function(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,d.bindAll(["_onTimeout"],this)};ea.prototype.setZoomRate=function(i){this._defaultZoomRate=i},ea.prototype.setWheelZoomRate=function(i){this._wheelZoomRate=i},ea.prototype.isEnabled=function(){return!!this._enabled},ea.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},ea.prototype.isZooming=function(){return!!this._zooming},ea.prototype.enable=function(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")},ea.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ea.prototype.wheel=function(i){if(this.isEnabled()){var u=i.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY,o=d.browser.now(),h=o-(this._lastWheelEventTime||0);this._lastWheelEventTime=o,u!==0&&u%4.000244140625==0?this._type="wheel":u!==0&&Math.abs(u)<4?this._type="trackpad":h>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(h*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}},ea.prototype._onTimeout=function(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)},ea.prototype._start=function(i){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var u=re.mousePos(this._el,i);this._around=d.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(u)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ea.prototype.renderFrame=function(){var i=this;if(this._frameId&&(this._frameId=null,this.isActive())){var u=this._map.transform;if(this._delta!==0){var o=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,h=2/(1+Math.exp(-Math.abs(this._delta*o)));this._delta<0&&h!==0&&(h=1/h);var y=typeof this._targetZoom=="number"?u.zoomScale(this._targetZoom):u.scale;this._targetZoom=Math.min(u.maxZoom,Math.max(u.minZoom,u.scaleZoom(y*h))),this._type==="wheel"&&(this._startZoom=u.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var b,T=typeof this._targetZoom=="number"?this._targetZoom:u.zoom,R=this._startZoom,j=this._easing,ne=!1;if(this._type==="wheel"&&R&&j){var be=Math.min((d.browser.now()-this._lastWheelEventTime)/200,1),Ce=j(be);b=d.number(R,T,Ce),be<1?this._frameId||(this._frameId=!0):ne=!0}else b=T,ne=!0;return this._active=!0,ne&&(this._active=!1,this._finishTimeout=setTimeout(function(){i._zooming=!1,i._handler._triggerRenderFrame(),delete i._targetZoom,delete i._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!ne,zoomDelta:b-u.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ea.prototype._smoothOutEasing=function(i){var u=d.ease;if(this._prevEase){var o=this._prevEase,h=(d.browser.now()-o.start)/o.duration,y=o.easing(h+.01)-o.easing(h),b=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-b*b);u=d.bezier(b,T,.25,1)}return this._prevEase={start:d.browser.now(),duration:i,easing:u},u},ea.prototype.blur=function(){this.reset()},ea.prototype.reset=function(){this._active=!1};var Iu=function(i,u){this._clickZoom=i,this._tapZoom=u};Iu.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},Iu.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},Iu.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},Iu.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var $s=function(){this.reset()};$s.prototype.reset=function(){this._active=!1},$s.prototype.blur=function(){this.reset()},$s.prototype.dblclick=function(i,u){return i.preventDefault(),{cameraAnimation:function(o){o.easeTo({duration:300,zoom:o.getZoom()+(i.shiftKey?-1:1),around:o.unproject(u)},{originalEvent:i})}}},$s.prototype.enable=function(){this._enabled=!0},$s.prototype.disable=function(){this._enabled=!1,this.reset()},$s.prototype.isEnabled=function(){return this._enabled},$s.prototype.isActive=function(){return this._active};var Ra=function(){this._tap=new su({numTouches:1,numTaps:1}),this.reset()};Ra.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},Ra.prototype.touchstart=function(i,u,o){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?o.length>0&&(this._swipePoint=u[0],this._swipeTouch=o[0].identifier):this._tap.touchstart(i,u,o))},Ra.prototype.touchmove=function(i,u,o){if(this._tapTime){if(this._swipePoint){if(o[0].identifier!==this._swipeTouch)return;var h=u[0],y=h.y-this._swipePoint.y;return this._swipePoint=h,i.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(i,u,o)},Ra.prototype.touchend=function(i,u,o){this._tapTime?this._swipePoint&&o.length===0&&this.reset():this._tap.touchend(i,u,o)&&(this._tapTime=i.timeStamp)},Ra.prototype.touchcancel=function(){this.reset()},Ra.prototype.enable=function(){this._enabled=!0},Ra.prototype.disable=function(){this._enabled=!1,this.reset()},Ra.prototype.isEnabled=function(){return this._enabled},Ra.prototype.isActive=function(){return this._active};var Cl=function(i,u,o){this._el=i,this._mousePan=u,this._touchPan=o};Cl.prototype.enable=function(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Cl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Cl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Cl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var Su=function(i,u,o){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=o};Su.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},Su.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},Su.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},Su.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var uu=function(i,u,o,h){this._el=i,this._touchZoom=u,this._touchRotate=o,this._tapDragZoom=h,this._rotationDisabled=!1,this._enabled=!0};uu.prototype.enable=function(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},uu.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},uu.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},uu.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},uu.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},uu.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var eo=function(i){return i.zoom||i.drag||i.pitch||i.rotate},fl=function(i){function u(){i.apply(this,arguments)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u}(d.Event);function ii(i){return i.panDelta&&i.panDelta.mag()||i.zoomDelta||i.bearingDelta||i.pitchDelta}var qn=function(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ju(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);var o=this._el;this._listeners=[[o,"touchstart",{passive:!0}],[o,"touchmove",{passive:!1}],[o,"touchend",void 0],[o,"touchcancel",void 0],[o,"mousedown",void 0],[o,"mousemove",void 0],[o,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[o,"mouseover",void 0],[o,"mouseout",void 0],[o,"dblclick",void 0],[o,"click",void 0],[o,"keydown",{capture:!1}],[o,"keyup",void 0],[o,"wheel",{passive:!1}],[o,"contextmenu",void 0],[d.window,"blur",void 0]];for(var h=0,y=this._listeners;h<y.length;h+=1){var b=y[h],T=b[0];re.addEventListener(T,b[1],T===d.window.document?this.handleWindowEvent:this.handleEvent,b[2])}};qn.prototype.destroy=function(){for(var i=0,u=this._listeners;i<u.length;i+=1){var o=u[i],h=o[0];re.removeEventListener(h,o[1],h===d.window.document?this.handleWindowEvent:this.handleEvent,o[2])}},qn.prototype._addDefaultHandlers=function(i){var u=this._map,o=u.getCanvasContainer();this._add("mapEvent",new To(u,i));var h=u.boxZoom=new no(u,i);this._add("boxZoom",h);var y=new ko,b=new $s;u.doubleClickZoom=new Iu(b,y),this._add("tapZoom",y),this._add("clickZoom",b);var T=new Ra;this._add("tapDragZoom",T);var R=u.touchPitch=new El;this._add("touchPitch",R);var j=new Ec(i),ne=new js(i);u.dragRotate=new Su(i,j,ne),this._add("mouseRotate",j,["mousePitch"]),this._add("mousePitch",ne,["mouseRotate"]);var be=new Wa(i),Ce=new qa(i);u.dragPan=new Cl(o,be,Ce),this._add("mousePan",be),this._add("touchPan",Ce,["touchZoom","touchRotate"]);var Pe=new Bc,He=new ks;u.touchZoomRotate=new uu(o,He,Pe,T),this._add("touchRotate",Pe,["touchPan","touchZoom"]),this._add("touchZoom",He,["touchPan","touchRotate"]);var je=u.scrollZoom=new ea(u,this);this._add("scrollZoom",je,["mousePan"]);var ot=u.keyboard=new Vs;this._add("keyboard",ot),this._add("blockableMapEvent",new Cn(u));for(var ze=0,at=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];ze<at.length;ze+=1){var Et=at[ze];i.interactive&&i[Et]&&u[Et].enable(i[Et])}},qn.prototype._add=function(i,u,o){this._handlers.push({handlerName:i,handler:u,allowed:o}),this._handlersById[i]=u},qn.prototype.stop=function(i){if(!this._updatingCamera){for(var u=0,o=this._handlers;u<o.length;u+=1)o[u].handler.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}},qn.prototype.isActive=function(){for(var i=0,u=this._handlers;i<u.length;i+=1)if(u[i].handler.isActive())return!0;return!1},qn.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},qn.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},qn.prototype.isMoving=function(){return Boolean(eo(this._eventsInProgress))||this.isZooming()},qn.prototype._blockedByActive=function(i,u,o){for(var h in i)if(h!==o&&(!u||u.indexOf(h)<0))return!0;return!1},qn.prototype.handleWindowEvent=function(i){this.handleEvent(i,i.type+"Window")},qn.prototype._getMapTouches=function(i){for(var u=[],o=0,h=i;o<h.length;o+=1){var y=h[o];this._el.contains(y.target)&&u.push(y)}return u},qn.prototype.handleEvent=function(i,u){this._updatingCamera=!0;for(var o=i.type==="renderFrame"?void 0:i,h={needsRenderFrame:!1},y={},b={},T=i.touches?this._getMapTouches(i.touches):void 0,R=T?re.touchPos(this._el,T):re.mousePos(this._el,i),j=0,ne=this._handlers;j<ne.length;j+=1){var be=ne[j],Ce=be.handlerName,Pe=be.handler,He=be.allowed;if(Pe.isEnabled()){var je=void 0;this._blockedByActive(b,He,Ce)?Pe.reset():Pe[u||i.type]&&(je=Pe[u||i.type](i,R,T),this.mergeHandlerResult(h,y,je,Ce,o),je&&je.needsRenderFrame&&this._triggerRenderFrame()),(je||Pe.isActive())&&(b[Ce]=Pe)}}var ot={};for(var ze in this._previousActiveHandlers)b[ze]||(ot[ze]=o);this._previousActiveHandlers=b,(Object.keys(ot).length||ii(h))&&(this._changes.push([h,y,ot]),this._triggerRenderFrame()),(Object.keys(b).length||ii(h))&&this._map._stop(!0),this._updatingCamera=!1;var at=h.cameraAnimation;at&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],at(this._map))},qn.prototype.mergeHandlerResult=function(i,u,o,h,y){if(o){d.extend(i,o);var b={handlerName:h,originalEvent:o.originalEvent||y};o.zoomDelta!==void 0&&(u.zoom=b),o.panDelta!==void 0&&(u.drag=b),o.pitchDelta!==void 0&&(u.pitch=b),o.bearingDelta!==void 0&&(u.rotate=b)}},qn.prototype._applyChanges=function(){for(var i={},u={},o={},h=0,y=this._changes;h<y.length;h+=1){var b=y[h],T=b[0],R=b[1],j=b[2];T.panDelta&&(i.panDelta=(i.panDelta||new d.Point(0,0))._add(T.panDelta)),T.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+T.zoomDelta),T.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+T.bearingDelta),T.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+T.pitchDelta),T.around!==void 0&&(i.around=T.around),T.pinchAround!==void 0&&(i.pinchAround=T.pinchAround),T.noInertia&&(i.noInertia=T.noInertia),d.extend(u,R),d.extend(o,j)}this._updateMapTransform(i,u,o),this._changes=[]},qn.prototype._updateMapTransform=function(i,u,o){var h=this._map,y=h.transform;if(!ii(i))return this._fireEvents(u,o,!0);var b=i.panDelta,T=i.zoomDelta,R=i.bearingDelta,j=i.pitchDelta,ne=i.around,be=i.pinchAround;be!==void 0&&(ne=be),h._stop(!0),ne=ne||h.transform.centerPoint;var Ce=y.pointLocation(b?ne.sub(b):ne);R&&(y.bearing+=R),j&&(y.pitch+=j),T&&(y.zoom+=T),y.setLocationAtPoint(Ce,ne),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,o,!0)},qn.prototype._fireEvents=function(i,u,o){var h=this,y=eo(this._eventsInProgress),b=eo(i),T={};for(var R in i)this._eventsInProgress[R]||(T[R+"start"]=i[R].originalEvent),this._eventsInProgress[R]=i[R];for(var j in!y&&b&&this._fireEvent("movestart",b.originalEvent),T)this._fireEvent(j,T[j]);for(var ne in b&&this._fireEvent("move",b.originalEvent),i)this._fireEvent(ne,i[ne].originalEvent);var be,Ce={};for(var Pe in this._eventsInProgress){var He=this._eventsInProgress[Pe],je=He.handlerName,ot=He.originalEvent;this._handlersById[je].isActive()||(delete this._eventsInProgress[Pe],Ce[Pe+"end"]=be=u[je]||ot)}for(var ze in Ce)this._fireEvent(ze,Ce[ze]);var at=eo(this._eventsInProgress);if(o&&(y||b)&&!at){this._updatingCamera=!0;var Et=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Vt=function(mr){return mr!==0&&-h._bearingSnap<mr&&mr<h._bearingSnap};Et?(Vt(Et.bearing||this._map.getBearing())&&(Et.bearing=0),this._map.easeTo(Et,{originalEvent:be})):(this._map.fire(new d.Event("moveend",{originalEvent:be})),Vt(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},qn.prototype._fireEvent=function(i,u){this._map.fire(new d.Event(i,u?{originalEvent:u}:{}))},qn.prototype._requestFrame=function(){var i=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(u){delete i._frameId,i.handleEvent(new fl("renderFrame",{timeStamp:u})),i._applyChanges()})},qn.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var Ul=function(i){function u(o,h){i.call(this),this._moving=!1,this._zooming=!1,this.transform=o,this._bearingSnap=h.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.getCenter=function(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)},u.prototype.setCenter=function(o,h){return this.jumpTo({center:o},h)},u.prototype.panBy=function(o,h,y){return o=d.Point.convert(o).mult(-1),this.panTo(this.transform.center,d.extend({offset:o},h),y)},u.prototype.panTo=function(o,h,y){return this.easeTo(d.extend({center:o},h),y)},u.prototype.getZoom=function(){return this.transform.zoom},u.prototype.setZoom=function(o,h){return this.jumpTo({zoom:o},h),this},u.prototype.zoomTo=function(o,h,y){return this.easeTo(d.extend({zoom:o},h),y)},u.prototype.zoomIn=function(o,h){return this.zoomTo(this.getZoom()+1,o,h),this},u.prototype.zoomOut=function(o,h){return this.zoomTo(this.getZoom()-1,o,h),this},u.prototype.getBearing=function(){return this.transform.bearing},u.prototype.setBearing=function(o,h){return this.jumpTo({bearing:o},h),this},u.prototype.getPadding=function(){return this.transform.padding},u.prototype.setPadding=function(o,h){return this.jumpTo({padding:o},h),this},u.prototype.rotateTo=function(o,h,y){return this.easeTo(d.extend({bearing:o},h),y)},u.prototype.resetNorth=function(o,h){return this.rotateTo(0,d.extend({duration:1e3},o),h),this},u.prototype.resetNorthPitch=function(o,h){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},o),h),this},u.prototype.snapToNorth=function(o,h){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(o,h):this},u.prototype.getPitch=function(){return this.transform.pitch},u.prototype.setPitch=function(o,h){return this.jumpTo({pitch:o},h),this},u.prototype.cameraForBounds=function(o,h){o=d.LngLatBounds.convert(o);var y=h&&h.bearing||0;return this._cameraForBoxAndBearing(o.getNorthWest(),o.getSouthEast(),y,h)},u.prototype._cameraForBoxAndBearing=function(o,h,y,b){var T={top:0,bottom:0,right:0,left:0};if(typeof(b=d.extend({padding:T,offset:[0,0],maxZoom:this.transform.maxZoom},b)).padding=="number"){var R=b.padding;b.padding={top:R,bottom:R,right:R,left:R}}b.padding=d.extend(T,b.padding);var j=this.transform,ne=j.padding,be=j.project(d.LngLat.convert(o)),Ce=j.project(d.LngLat.convert(h)),Pe=be.rotate(-y*Math.PI/180),He=Ce.rotate(-y*Math.PI/180),je=new d.Point(Math.max(Pe.x,He.x),Math.max(Pe.y,He.y)),ot=new d.Point(Math.min(Pe.x,He.x),Math.min(Pe.y,He.y)),ze=je.sub(ot),at=(j.width-(ne.left+ne.right+b.padding.left+b.padding.right))/ze.x,Et=(j.height-(ne.top+ne.bottom+b.padding.top+b.padding.bottom))/ze.y;if(!(Et<0||at<0)){var Vt=Math.min(j.scaleZoom(j.scale*Math.min(at,Et)),b.maxZoom),mr=typeof b.offset.x=="number"?new d.Point(b.offset.x,b.offset.y):d.Point.convert(b.offset),ur=new d.Point((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(y*Math.PI/180),Er=mr.add(ur).mult(j.scale/j.zoomScale(Vt));return{center:j.unproject(be.add(Ce).div(2).sub(Er)),zoom:Vt,bearing:y}}d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},u.prototype.fitBounds=function(o,h,y){return this._fitInternal(this.cameraForBounds(o,h),h,y)},u.prototype.fitScreenCoordinates=function(o,h,y,b,T){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(d.Point.convert(o)),this.transform.pointLocation(d.Point.convert(h)),y,b),b,T)},u.prototype._fitInternal=function(o,h,y){return o?(delete(h=d.extend(o,h)).padding,h.linear?this.easeTo(h,y):this.flyTo(h,y)):this},u.prototype.jumpTo=function(o,h){this.stop();var y=this.transform,b=!1,T=!1,R=!1;return"zoom"in o&&y.zoom!==+o.zoom&&(b=!0,y.zoom=+o.zoom),o.center!==void 0&&(y.center=d.LngLat.convert(o.center)),"bearing"in o&&y.bearing!==+o.bearing&&(T=!0,y.bearing=+o.bearing),"pitch"in o&&y.pitch!==+o.pitch&&(R=!0,y.pitch=+o.pitch),o.padding==null||y.isPaddingEqual(o.padding)||(y.padding=o.padding),this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),b&&this.fire(new d.Event("zoomstart",h)).fire(new d.Event("zoom",h)).fire(new d.Event("zoomend",h)),T&&this.fire(new d.Event("rotatestart",h)).fire(new d.Event("rotate",h)).fire(new d.Event("rotateend",h)),R&&this.fire(new d.Event("pitchstart",h)).fire(new d.Event("pitch",h)).fire(new d.Event("pitchend",h)),this.fire(new d.Event("moveend",h))},u.prototype.easeTo=function(o,h){var y=this;this._stop(!1,o.easeId),((o=d.extend({offset:[0,0],duration:500,easing:d.ease},o)).animate===!1||!o.essential&&d.browser.prefersReducedMotion)&&(o.duration=0);var b=this.transform,T=this.getZoom(),R=this.getBearing(),j=this.getPitch(),ne=this.getPadding(),be="zoom"in o?+o.zoom:T,Ce="bearing"in o?this._normalizeBearing(o.bearing,R):R,Pe="pitch"in o?+o.pitch:j,He="padding"in o?o.padding:b.padding,je=d.Point.convert(o.offset),ot=b.centerPoint.add(je),ze=b.pointLocation(ot),at=d.LngLat.convert(o.center||ze);this._normalizeCenter(at);var Et,Vt,mr=b.project(ze),ur=b.project(at).sub(mr),Er=b.zoomScale(be-T);o.around&&(Et=d.LngLat.convert(o.around),Vt=b.locationPoint(Et));var jr={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||be!==T,this._rotating=this._rotating||R!==Ce,this._pitching=this._pitching||Pe!==j,this._padding=!b.isPaddingEqual(He),this._easeId=o.easeId,this._prepareEase(h,o.noMoveStart,jr),this._ease(function(hn){if(y._zooming&&(b.zoom=d.number(T,be,hn)),y._rotating&&(b.bearing=d.number(R,Ce,hn)),y._pitching&&(b.pitch=d.number(j,Pe,hn)),y._padding&&(b.interpolatePadding(ne,He,hn),ot=b.centerPoint.add(je)),Et)b.setLocationAtPoint(Et,Vt);else{var nn=b.zoomScale(b.zoom-T),Nn=be>T?Math.min(2,Er):Math.max(.5,Er),oi=Math.pow(Nn,1-hn),ui=b.unproject(mr.add(ur.mult(hn*oi)).mult(nn));b.setLocationAtPoint(b.renderWorldCopies?ui.wrap():ui,ot)}y._fireMoveEvents(h)},function(hn){y._afterEase(h,hn)},o),this},u.prototype._prepareEase=function(o,h,y){y===void 0&&(y={}),this._moving=!0,h||y.moving||this.fire(new d.Event("movestart",o)),this._zooming&&!y.zooming&&this.fire(new d.Event("zoomstart",o)),this._rotating&&!y.rotating&&this.fire(new d.Event("rotatestart",o)),this._pitching&&!y.pitching&&this.fire(new d.Event("pitchstart",o))},u.prototype._fireMoveEvents=function(o){this.fire(new d.Event("move",o)),this._zooming&&this.fire(new d.Event("zoom",o)),this._rotating&&this.fire(new d.Event("rotate",o)),this._pitching&&this.fire(new d.Event("pitch",o))},u.prototype._afterEase=function(o,h){if(!this._easeId||!h||this._easeId!==h){delete this._easeId;var y=this._zooming,b=this._rotating,T=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,y&&this.fire(new d.Event("zoomend",o)),b&&this.fire(new d.Event("rotateend",o)),T&&this.fire(new d.Event("pitchend",o)),this.fire(new d.Event("moveend",o))}},u.prototype.flyTo=function(o,h){var y=this;if(!o.essential&&d.browser.prefersReducedMotion){var b=d.pick(o,["center","zoom","bearing","pitch","around"]);return this.jumpTo(b,h)}this.stop(),o=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},o);var T=this.transform,R=this.getZoom(),j=this.getBearing(),ne=this.getPitch(),be=this.getPadding(),Ce="zoom"in o?d.clamp(+o.zoom,T.minZoom,T.maxZoom):R,Pe="bearing"in o?this._normalizeBearing(o.bearing,j):j,He="pitch"in o?+o.pitch:ne,je="padding"in o?o.padding:T.padding,ot=T.zoomScale(Ce-R),ze=d.Point.convert(o.offset),at=T.centerPoint.add(ze),Et=T.pointLocation(at),Vt=d.LngLat.convert(o.center||Et);this._normalizeCenter(Vt);var mr=T.project(Et),ur=T.project(Vt).sub(mr),Er=o.curve,jr=Math.max(T.width,T.height),hn=jr/ot,nn=ur.mag();if("minZoom"in o){var Nn=d.clamp(Math.min(o.minZoom,R,Ce),T.minZoom,T.maxZoom),oi=jr/T.zoomScale(Nn-R);Er=Math.sqrt(oi/nn*2)}var ui=Er*Er;function ai(J){var O=(hn*hn-jr*jr+(J?-1:1)*ui*ui*nn*nn)/(2*(J?hn:jr)*ui*nn);return Math.log(Math.sqrt(O*O+1)-O)}function Qi(J){return(Math.exp(J)-Math.exp(-J))/2}function Wn(J){return(Math.exp(J)+Math.exp(-J))/2}var Ei=ai(0),Gi=function(J){return Wn(Ei)/Wn(Ei+Er*J)},xi=function(J){return jr*((Wn(Ei)*(Qi(O=Ei+Er*J)/Wn(O))-Qi(Ei))/ui)/nn;var O},Ci=(ai(1)-Ei)/Er;if(Math.abs(nn)<1e-6||!isFinite(Ci)){if(Math.abs(jr-hn)<1e-6)return this.easeTo(o,h);var Q=hn<jr?-1:1;Ci=Math.abs(Math.log(hn/jr))/Er,xi=function(){return 0},Gi=function(J){return Math.exp(Q*Er*J)}}return o.duration="duration"in o?+o.duration:1e3*Ci/("screenSpeed"in o?+o.screenSpeed/Er:+o.speed),o.maxDuration&&o.duration>o.maxDuration&&(o.duration=0),this._zooming=!0,this._rotating=j!==Pe,this._pitching=He!==ne,this._padding=!T.isPaddingEqual(je),this._prepareEase(h,!1),this._ease(function(J){var O=J*Ci,k=1/Gi(O);T.zoom=J===1?Ce:R+T.scaleZoom(k),y._rotating&&(T.bearing=d.number(j,Pe,J)),y._pitching&&(T.pitch=d.number(ne,He,J)),y._padding&&(T.interpolatePadding(be,je,J),at=T.centerPoint.add(ze));var oe=J===1?Vt:T.unproject(mr.add(ur.mult(xi(O))).mult(k));T.setLocationAtPoint(T.renderWorldCopies?oe.wrap():oe,at),y._fireMoveEvents(h)},function(){return y._afterEase(h)},o),this},u.prototype.isEasing=function(){return!!this._easeFrameId},u.prototype.stop=function(){return this._stop()},u.prototype._stop=function(o,h){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var y=this._onEaseEnd;delete this._onEaseEnd,y.call(this,h)}if(!o){var b=this.handlers;b&&b.stop(!1)}return this},u.prototype._ease=function(o,h,y){y.animate===!1||y.duration===0?(o(1),h()):(this._easeStart=d.browser.now(),this._easeOptions=y,this._onEaseFrame=o,this._onEaseEnd=h,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},u.prototype._renderFrameCallback=function(){var o=Math.min((d.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(o)),o<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},u.prototype._normalizeBearing=function(o,h){o=d.wrap(o,-180,180);var y=Math.abs(o-h);return Math.abs(o-360-h)<y&&(o-=360),Math.abs(o+360-h)<y&&(o+=360),o},u.prototype._normalizeCenter=function(o){var h=this.transform;if(h.renderWorldCopies&&!h.lngRange){var y=o.lng-h.center.lng;o.lng+=y>180?-360:y<-180?360:0}},u}(d.Evented),es=function(i){i===void 0&&(i={}),this.options=i,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};es.prototype.getDefaultPosition=function(){return"bottom-right"},es.prototype.onAdd=function(i){var u=this.options&&this.options.compact;return this._map=i,this._container=re.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=re.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=re.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),u===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},es.prototype.onRemove=function(){re.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},es.prototype._setElementTitle=function(i,u){var o=this._map._getUIString("AttributionControl."+u);i.title=o,i.setAttribute("aria-label",o)},es.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},es.prototype._updateEditLink=function(){var i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));var u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(i){var o=u.reduce(function(h,y,b){return y.value&&(h+=y.key+"="+y.value+(b<u.length-1?"&":"")),h},"?");i.href=d.config.FEEDBACK_URL+"/"+o+(this._map._hash?this._map._hash.getHashString(!0):""),i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}},es.prototype._updateData=function(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},es.prototype._updateAttributions=function(){if(this._map.style){var i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(function(R){return typeof R!="string"?"":R})):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){var u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}var o=this._map.style.sourceCaches;for(var h in o){var y=o[h];if(y.used){var b=y.getSource();b.attribution&&i.indexOf(b.attribution)<0&&i.push(b.attribution)}}i.sort(function(R,j){return R.length-j.length});var T=(i=i.filter(function(R,j){for(var ne=j+1;ne<i.length;ne++)if(i[ne].indexOf(R)>=0)return!1;return!0})).join(" | ");T!==this._attribHTML&&(this._attribHTML=T,i.length?(this._innerContainer.innerHTML=T,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},es.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var Bs=function(){d.bindAll(["_updateLogo"],this),d.bindAll(["_updateCompact"],this)};Bs.prototype.onAdd=function(i){this._map=i,this._container=re.create("div","mapboxgl-ctrl");var u=re.create("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},Bs.prototype.onRemove=function(){re.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},Bs.prototype.getDefaultPosition=function(){return"bottom-left"},Bs.prototype._updateLogo=function(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},Bs.prototype._logoRequired=function(){if(this._map.style){var i=this._map.style.sourceCaches;for(var u in i)if(i[u].getSource().mapbox_logo)return!0;return!1}},Bs.prototype._updateCompact=function(){var i=this._container.children;if(i.length){var u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}};var zo=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};zo.prototype.add=function(i){var u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u},zo.prototype.remove=function(i){for(var u=this._currentlyRunning,o=0,h=u?this._queue.concat(u):this._queue;o<h.length;o+=1){var y=h[o];if(y.id===i)return void(y.cancelled=!0)}},zo.prototype.run=function(i){i===void 0&&(i=0);var u=this._currentlyRunning=this._queue;this._queue=[];for(var o=0,h=u;o<h.length;o+=1){var y=h[o];if(!y.cancelled&&(y.callback(i),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},zo.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var lu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Cc=d.window.HTMLImageElement,hc=d.window.HTMLElement,ta=d.window.ImageBitmap,ba={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},qc=function(i){function u(h){var y=this;if((h=d.extend({},ba,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var b=new ua(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies);if(i.call(this,b,h),this._interactive=h.interactive,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new zo,this._controls=[],this._mapId=d.uniqueId(),this._locale=d.extend({},lu,h.locale),this._clickTolerance=h.clickTolerance,this._requestManager=new d.RequestManager(h.transformRequest,h.accessToken),typeof h.container=="string"){if(this._container=d.window.document.getElementById(h.container),!this._container)throw new Error("Container '"+h.container+"' not found.")}else{if(!(h.container instanceof hc))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return y._update(!1)}),this.on("moveend",function(){return y._update(!1)}),this.on("zoom",function(){return y._update(!0)}),d.window!==void 0&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new qn(this,h),this._hash=h.hash&&new fs(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,d.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new es({customAttribution:h.customAttribution})),this.addControl(new Bs,h.logoPosition),this.on("style.load",function(){y.transform.unmodified&&y.jumpTo(y.style.stylesheet)}),this.on("data",function(T){y._update(T.dataType==="style"),y.fire(new d.Event(T.dataType+"data",T))}),this.on("dataloading",function(T){y.fire(new d.Event(T.dataType+"dataloading",T))})}i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u;var o={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return u.prototype._getMapId=function(){return this._mapId},u.prototype.addControl=function(h,y){if(y===void 0&&(y=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var b=h.onAdd(this);this._controls.push(h);var T=this._controlPositions[y];return y.indexOf("bottom")!==-1?T.insertBefore(b,T.firstChild):T.appendChild(b),this},u.prototype.removeControl=function(h){if(!h||!h.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var y=this._controls.indexOf(h);return y>-1&&this._controls.splice(y,1),h.onRemove(this),this},u.prototype.hasControl=function(h){return this._controls.indexOf(h)>-1},u.prototype.resize=function(h){var y=this._containerDimensions(),b=y[0],T=y[1];if(b===this.transform.width&&T===this.transform.height)return this;this._resizeCanvas(b,T),this.transform.resize(b,T),this.painter.resize(b,T);var R=!this._moving;return R&&this.fire(new d.Event("movestart",h)).fire(new d.Event("move",h)),this.fire(new d.Event("resize",h)),R&&this.fire(new d.Event("moveend",h)),this},u.prototype.getBounds=function(){return this.transform.getBounds()},u.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},u.prototype.setMaxBounds=function(h){return this.transform.setMaxBounds(d.LngLatBounds.convert(h)),this._update()},u.prototype.setMinZoom=function(h){if((h=h==null?-2:h)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},u.prototype.getMinZoom=function(){return this.transform.minZoom},u.prototype.setMaxZoom=function(h){if((h=h==null?22:h)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")},u.prototype.getMaxZoom=function(){return this.transform.maxZoom},u.prototype.setMinPitch=function(h){if((h=h==null?0:h)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},u.prototype.getMinPitch=function(){return this.transform.minPitch},u.prototype.setMaxPitch=function(h){if((h=h==null?60:h)>60)throw new Error("maxPitch must be less than or equal to 60");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")},u.prototype.getMaxPitch=function(){return this.transform.maxPitch},u.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},u.prototype.setRenderWorldCopies=function(h){return this.transform.renderWorldCopies=h,this._update()},u.prototype.project=function(h){return this.transform.locationPoint(d.LngLat.convert(h))},u.prototype.unproject=function(h){return this.transform.pointLocation(d.Point.convert(h))},u.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},u.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},u.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},u.prototype._createDelegatedListener=function(h,y,b){var T,R=this;if(h==="mouseenter"||h==="mouseover"){var j=!1;return{layer:y,listener:b,delegates:{mousemove:function(be){var Ce=R.getLayer(y)?R.queryRenderedFeatures(be.point,{layers:[y]}):[];Ce.length?j||(j=!0,b.call(R,new Do(h,R,be.originalEvent,{features:Ce}))):j=!1},mouseout:function(){j=!1}}}}if(h==="mouseleave"||h==="mouseout"){var ne=!1;return{layer:y,listener:b,delegates:{mousemove:function(be){(R.getLayer(y)?R.queryRenderedFeatures(be.point,{layers:[y]}):[]).length?ne=!0:ne&&(ne=!1,b.call(R,new Do(h,R,be.originalEvent)))},mouseout:function(be){ne&&(ne=!1,b.call(R,new Do(h,R,be.originalEvent)))}}}}return{layer:y,listener:b,delegates:(T={},T[h]=function(be){var Ce=R.getLayer(y)?R.queryRenderedFeatures(be.point,{layers:[y]}):[];Ce.length&&(be.features=Ce,b.call(R,be),delete be.features)},T)}},u.prototype.on=function(h,y,b){if(b===void 0)return i.prototype.on.call(this,h,y);var T=this._createDelegatedListener(h,y,b);for(var R in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(T),T.delegates)this.on(R,T.delegates[R]);return this},u.prototype.once=function(h,y,b){if(b===void 0)return i.prototype.once.call(this,h,y);var T=this._createDelegatedListener(h,y,b);for(var R in T.delegates)this.once(R,T.delegates[R]);return this},u.prototype.off=function(h,y,b){var T=this;return b===void 0?i.prototype.off.call(this,h,y):(this._delegatedListeners&&this._delegatedListeners[h]&&function(R){for(var j=R[h],ne=0;ne<j.length;ne++){var be=j[ne];if(be.layer===y&&be.listener===b){for(var Ce in be.delegates)T.off(Ce,be.delegates[Ce]);return j.splice(ne,1),T}}}(this._delegatedListeners),this)},u.prototype.queryRenderedFeatures=function(h,y){if(!this.style)return[];var b;if(y!==void 0||h===void 0||h instanceof d.Point||Array.isArray(h)||(y=h,h=void 0),y=y||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof d.Point||typeof h[0]=="number")b=[d.Point.convert(h)];else{var T=d.Point.convert(h[0]),R=d.Point.convert(h[1]);b=[T,new d.Point(R.x,T.y),R,new d.Point(T.x,R.y),T]}return this.style.queryRenderedFeatures(b,y,this.transform)},u.prototype.querySourceFeatures=function(h,y){return this.style.querySourceFeatures(h,y)},u.prototype.setStyle=function(h,y){return(y=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},y)).diff!==!1&&y.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,y),this):(this._localIdeographFontFamily=y.localIdeographFontFamily,this._updateStyle(h,y))},u.prototype._getUIString=function(h){var y=this._locale[h];if(y==null)throw new Error("Missing UI string '"+h+"'");return y},u.prototype._updateStyle=function(h,y){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Is(this,y||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)},u.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Is(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},u.prototype._diffStyle=function(h,y){var b=this;if(typeof h=="string"){var T=this._requestManager.normalizeStyleURL(h),R=this._requestManager.transformRequest(T,d.ResourceType.Style);d.getJSON(R,function(j,ne){j?b.fire(new d.ErrorEvent(j)):ne&&b._updateDiff(ne,y)})}else typeof h=="object"&&this._updateDiff(h,y)},u.prototype._updateDiff=function(h,y){try{this.style.setState(h)&&this._update(!0)}catch(b){d.warnOnce("Unable to perform style diff: "+(b.message||b.error||b)+".  Rebuilding the style from scratch."),this._updateStyle(h,y)}},u.prototype.getStyle=function(){if(this.style)return this.style.serialize()},u.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():d.warnOnce("There is no style added to the map.")},u.prototype.addSource=function(h,y){return this._lazyInitEmptyStyle(),this.style.addSource(h,y),this._update(!0)},u.prototype.isSourceLoaded=function(h){var y=this.style&&this.style.sourceCaches[h];if(y!==void 0)return y.loaded();this.fire(new d.ErrorEvent(new Error("There is no source with ID '"+h+"'")))},u.prototype.areTilesLoaded=function(){var h=this.style&&this.style.sourceCaches;for(var y in h){var b=h[y]._tiles;for(var T in b){var R=b[T];if(R.state!=="loaded"&&R.state!=="errored")return!1}}return!0},u.prototype.addSourceType=function(h,y,b){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,y,b)},u.prototype.removeSource=function(h){return this.style.removeSource(h),this._update(!0)},u.prototype.getSource=function(h){return this.style.getSource(h)},u.prototype.addImage=function(h,y,b){b===void 0&&(b={});var T=b.pixelRatio;T===void 0&&(T=1);var R=b.sdf;R===void 0&&(R=!1);var j=b.stretchX,ne=b.stretchY,be=b.content;if(this._lazyInitEmptyStyle(),y instanceof Cc||ta&&y instanceof ta){var Ce=d.browser.getImageData(y);this.style.addImage(h,{data:new d.RGBAImage({width:Ce.width,height:Ce.height},Ce.data),pixelRatio:T,stretchX:j,stretchY:ne,content:be,sdf:R,version:0})}else{if(y.width===void 0||y.height===void 0)return this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Pe=y;this.style.addImage(h,{data:new d.RGBAImage({width:y.width,height:y.height},new Uint8Array(y.data)),pixelRatio:T,stretchX:j,stretchY:ne,content:be,sdf:R,version:0,userImage:Pe}),Pe.onAdd&&Pe.onAdd(this,h)}},u.prototype.updateImage=function(h,y){var b=this.style.getImage(h);if(!b)return this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var T=y instanceof Cc||ta&&y instanceof ta?d.browser.getImageData(y):y,R=T.width,j=T.height,ne=T.data;return R===void 0||j===void 0?this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):R!==b.data.width||j!==b.data.height?this.fire(new d.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(b.data.replace(ne,!(y instanceof Cc||ta&&y instanceof ta)),void this.style.updateImage(h,b))},u.prototype.hasImage=function(h){return h?!!this.style.getImage(h):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)},u.prototype.removeImage=function(h){this.style.removeImage(h)},u.prototype.loadImage=function(h,y){d.getImage(this._requestManager.transformRequest(h,d.ResourceType.Image),y)},u.prototype.listImages=function(){return this.style.listImages()},u.prototype.addLayer=function(h,y){return this._lazyInitEmptyStyle(),this.style.addLayer(h,y),this._update(!0)},u.prototype.moveLayer=function(h,y){return this.style.moveLayer(h,y),this._update(!0)},u.prototype.removeLayer=function(h){return this.style.removeLayer(h),this._update(!0)},u.prototype.getLayer=function(h){return this.style.getLayer(h)},u.prototype.setLayerZoomRange=function(h,y,b){return this.style.setLayerZoomRange(h,y,b),this._update(!0)},u.prototype.setFilter=function(h,y,b){return b===void 0&&(b={}),this.style.setFilter(h,y,b),this._update(!0)},u.prototype.getFilter=function(h){return this.style.getFilter(h)},u.prototype.setPaintProperty=function(h,y,b,T){return T===void 0&&(T={}),this.style.setPaintProperty(h,y,b,T),this._update(!0)},u.prototype.getPaintProperty=function(h,y){return this.style.getPaintProperty(h,y)},u.prototype.setLayoutProperty=function(h,y,b,T){return T===void 0&&(T={}),this.style.setLayoutProperty(h,y,b,T),this._update(!0)},u.prototype.getLayoutProperty=function(h,y){return this.style.getLayoutProperty(h,y)},u.prototype.setLight=function(h,y){return y===void 0&&(y={}),this._lazyInitEmptyStyle(),this.style.setLight(h,y),this._update(!0)},u.prototype.getLight=function(){return this.style.getLight()},u.prototype.setFeatureState=function(h,y){return this.style.setFeatureState(h,y),this._update()},u.prototype.removeFeatureState=function(h,y){return this.style.removeFeatureState(h,y),this._update()},u.prototype.getFeatureState=function(h){return this.style.getFeatureState(h)},u.prototype.getContainer=function(){return this._container},u.prototype.getCanvasContainer=function(){return this._canvasContainer},u.prototype.getCanvas=function(){return this._canvas},u.prototype._containerDimensions=function(){var h=0,y=0;return this._container&&(h=this._container.clientWidth||400,y=this._container.clientHeight||300),[h,y]},u.prototype._detectMissingCSS=function(){d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},u.prototype._setupContainer=function(){var h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=re.create("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();var y=this._canvasContainer=re.create("div","mapboxgl-canvas-container",h);this._interactive&&y.classList.add("mapboxgl-interactive"),this._canvas=re.create("canvas","mapboxgl-canvas",y),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var b=this._containerDimensions();this._resizeCanvas(b[0],b[1]);var T=this._controlContainer=re.create("div","mapboxgl-control-container",h),R=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(j){R[j]=re.create("div","mapboxgl-ctrl-"+j,T)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},u.prototype._resizeCanvas=function(h,y){var b=d.browser.devicePixelRatio||1;this._canvas.width=b*h,this._canvas.height=b*y,this._canvas.style.width=h+"px",this._canvas.style.height=y+"px"},u.prototype._setupPainter=function(){var h=d.extend({},de.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),y=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);y?(this.painter=new lo(y,this.transform),d.webpSupported.testSupport(y)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))},u.prototype._contextLost=function(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:h}))},u.prototype._contextRestored=function(h){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:h}))},u.prototype._onMapScroll=function(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},u.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},u.prototype._update=function(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this},u.prototype._requestRenderFrame=function(h){return this._update(),this._renderTaskQueue.add(h)},u.prototype._cancelRenderFrame=function(h){this._renderTaskQueue.remove(h)},u.prototype._render=function(h){var y,b=this,T=0,R=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(y=R.createQueryEXT(),R.beginQueryEXT(R.TIME_ELAPSED_EXT,y),T=d.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),!this._removed){var j=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var ne=this.transform.zoom,be=d.browser.now();this.style.zoomHistory.update(ne,be);var Ce=new d.EvaluationParameters(ne,{now:be,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Pe=Ce.crossFadingFactor();Pe===1&&Pe===this._crossFadingFactor||(j=!0,this._crossFadingFactor=Pe),this.style.update(Ce)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||j)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var He=d.browser.now()-T;R.endQueryEXT(R.TIME_ELAPSED_EXT,y),setTimeout(function(){var ze=R.getQueryObjectEXT(y,R.QUERY_RESULT_EXT)/1e6;R.deleteQueryEXT(y),b.fire(new d.Event("gpu-timing-frame",{cpuTime:He,gpuTime:ze}))},50)}if(this.listens("gpu-timing-layer")){var je=this.painter.collectGpuTimers();setTimeout(function(){var ze=b.painter.queryGpuTimers(je);b.fire(new d.Event("gpu-timing-layer",{layerTimes:ze}))},50)}var ot=this._sourcesDirty||this._styleDirty||this._placementDirty;return ot||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new d.Event("idle")),!this._loaded||this._fullyLoaded||ot||(this._fullyLoaded=!0),this}},u.prototype.remove=function(){this._hash&&this._hash.remove();for(var h=0,y=this._controls;h<y.length;h+=1)y[h].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),d.window!==void 0&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));var b=this.painter.context.gl.getExtension("WEBGL_lose_context");b&&b.loseContext(),Po(this._canvasContainer),Po(this._controlContainer),Po(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new d.Event("remove"))},u.prototype.triggerRepaint=function(){var h=this;this.style&&!this._frame&&(this._frame=d.browser.frame(function(y){h._frame=null,h._render(y)}))},u.prototype._onWindowOnline=function(){this._update()},u.prototype._onWindowResize=function(h){this._trackResize&&this.resize({originalEvent:h})._update()},o.showTileBoundaries.get=function(){return!!this._showTileBoundaries},o.showTileBoundaries.set=function(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())},o.showPadding.get=function(){return!!this._showPadding},o.showPadding.set=function(h){this._showPadding!==h&&(this._showPadding=h,this._update())},o.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},o.showCollisionBoxes.set=function(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())},o.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},o.showOverdrawInspector.set=function(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())},o.repaint.get=function(){return!!this._repaint},o.repaint.set=function(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())},o.vertices.get=function(){return!!this._vertices},o.vertices.set=function(h){this._vertices=h,this._update()},u.prototype._setCacheLimits=function(h,y){d.setCacheLimits(h,y)},o.version.get=function(){return d.version},Object.defineProperties(u.prototype,o),u}(Ul);function Po(i){i.parentNode&&i.parentNode.removeChild(i)}var wl={showCompass:!0,showZoom:!0,visualizePitch:!1},Gs=function(i){var u=this;this.options=d.extend({},wl,i),this._container=re.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(o){return o.preventDefault()}),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(o){return u._map.zoomIn({},{originalEvent:o})}),re.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(o){return u._map.zoomOut({},{originalEvent:o})}),re.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(o){u.options.visualizePitch?u._map.resetNorthPitch({},{originalEvent:o}):u._map.resetNorth({},{originalEvent:o})}),this._compassIcon=re.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Gs.prototype._updateZoomButtons=function(){var i=this._map.getZoom(),u=i===this._map.getMaxZoom(),o=i===this._map.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=o,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",o.toString())},Gs.prototype._rotateCompassArrow=function(){var i=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=i},Gs.prototype.onAdd=function(i){return this._map=i,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ss(this._map,this._compass,this.options.visualizePitch)),this._container},Gs.prototype.onRemove=function(){re.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Gs.prototype._createButton=function(i,u){var o=re.create("button",i,this._container);return o.type="button",o.addEventListener("click",u),o},Gs.prototype._setButtonTitle=function(i,u){var o=this._map._getUIString("NavigationControl."+u);i.title=o,i.setAttribute("aria-label",o)};var Ss=function(i,u,o){o===void 0&&(o=!1),this._clickTolerance=10,this.element=u,this.mouseRotate=new Ec({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,o&&(this.mousePitch=new js({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),re.addEventListener(u,"mousedown",this.mousedown),re.addEventListener(u,"touchstart",this.touchstart,{passive:!1}),re.addEventListener(u,"touchmove",this.touchmove),re.addEventListener(u,"touchend",this.touchend),re.addEventListener(u,"touchcancel",this.reset)};function hl(i,u,o){if(i=new d.LngLat(i.lng,i.lat),u){var h=new d.LngLat(i.lng-360,i.lat),y=new d.LngLat(i.lng+360,i.lat),b=o.locationPoint(i).distSqr(u);o.locationPoint(h).distSqr(u)<b?i=h:o.locationPoint(y).distSqr(u)<b&&(i=y)}for(;Math.abs(i.lng-o.center.lng)>180;){var T=o.locationPoint(i);if(T.x>=0&&T.y>=0&&T.x<=o.width&&T.y<=o.height)break;i.lng>o.center.lng?i.lng-=360:i.lng+=360}return i}Ss.prototype.down=function(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),re.disableDrag()},Ss.prototype.move=function(i,u){var o=this.map,h=this.mouseRotate.mousemoveWindow(i,u);if(h&&h.bearingDelta&&o.setBearing(o.getBearing()+h.bearingDelta),this.mousePitch){var y=this.mousePitch.mousemoveWindow(i,u);y&&y.pitchDelta&&o.setPitch(o.getPitch()+y.pitchDelta)}},Ss.prototype.off=function(){var i=this.element;re.removeEventListener(i,"mousedown",this.mousedown),re.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),re.removeEventListener(i,"touchmove",this.touchmove),re.removeEventListener(i,"touchend",this.touchend),re.removeEventListener(i,"touchcancel",this.reset),this.offTemp()},Ss.prototype.offTemp=function(){re.enableDrag(),re.removeEventListener(d.window,"mousemove",this.mousemove),re.removeEventListener(d.window,"mouseup",this.mouseup)},Ss.prototype.mousedown=function(i){this.down(d.extend({},i,{ctrlKey:!0,preventDefault:function(){return i.preventDefault()}}),re.mousePos(this.element,i)),re.addEventListener(d.window,"mousemove",this.mousemove),re.addEventListener(d.window,"mouseup",this.mouseup)},Ss.prototype.mousemove=function(i){this.move(i,re.mousePos(this.element,i))},Ss.prototype.mouseup=function(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()},Ss.prototype.touchstart=function(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=re.touchPos(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return i.preventDefault()}},this._startPos))},Ss.prototype.touchmove=function(i){i.targetTouches.length!==1?this.reset():(this._lastPos=re.touchPos(this.element,i.targetTouches)[0],this.move({preventDefault:function(){return i.preventDefault()}},this._lastPos))},Ss.prototype.touchend=function(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ss.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Eu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function wc(i,u,o){var h=i.classList;for(var y in Eu)h.remove("mapboxgl-"+o+"-anchor-"+y);h.add("mapboxgl-"+o+"-anchor-"+u)}var Ri,Qu=function(i){function u(o,h){if(i.call(this),(o instanceof d.window.HTMLElement||h)&&(o=d.extend({element:o},h)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=o&&o.anchor||"center",this._color=o&&o.color||"#3FB1CE",this._scale=o&&o.scale||1,this._draggable=o&&o.draggable||!1,this._clickTolerance=o&&o.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=o&&o.rotation||0,this._rotationAlignment=o&&o.rotationAlignment||"auto",this._pitchAlignment=o&&o.pitchAlignment&&o.pitchAlignment!=="auto"?o.pitchAlignment:this._rotationAlignment,o&&o.element)this._element=o.element,this._offset=d.Point.convert(o&&o.offset||[0,0]);else{this._defaultMarker=!0,this._element=re.create("div"),this._element.setAttribute("aria-label","Map marker");var y=re.createNS("http://www.w3.org/2000/svg","svg");y.setAttributeNS(null,"display","block"),y.setAttributeNS(null,"height","41px"),y.setAttributeNS(null,"width","27px"),y.setAttributeNS(null,"viewBox","0 0 27 41");var b=re.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"stroke","none"),b.setAttributeNS(null,"stroke-width","1"),b.setAttributeNS(null,"fill","none"),b.setAttributeNS(null,"fill-rule","evenodd");var T=re.createNS("http://www.w3.org/2000/svg","g");T.setAttributeNS(null,"fill-rule","nonzero");var R=re.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"transform","translate(3.0, 29.0)"),R.setAttributeNS(null,"fill","#000000");for(var j=0,ne=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];j<ne.length;j+=1){var be=ne[j],Ce=re.createNS("http://www.w3.org/2000/svg","ellipse");Ce.setAttributeNS(null,"opacity","0.04"),Ce.setAttributeNS(null,"cx","10.5"),Ce.setAttributeNS(null,"cy","5.80029008"),Ce.setAttributeNS(null,"rx",be.rx),Ce.setAttributeNS(null,"ry",be.ry),R.appendChild(Ce)}var Pe=re.createNS("http://www.w3.org/2000/svg","g");Pe.setAttributeNS(null,"fill",this._color);var He=re.createNS("http://www.w3.org/2000/svg","path");He.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Pe.appendChild(He);var je=re.createNS("http://www.w3.org/2000/svg","g");je.setAttributeNS(null,"opacity","0.25"),je.setAttributeNS(null,"fill","#000000");var ot=re.createNS("http://www.w3.org/2000/svg","path");ot.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),je.appendChild(ot);var ze=re.createNS("http://www.w3.org/2000/svg","g");ze.setAttributeNS(null,"transform","translate(6.0, 7.0)"),ze.setAttributeNS(null,"fill","#FFFFFF");var at=re.createNS("http://www.w3.org/2000/svg","g");at.setAttributeNS(null,"transform","translate(8.0, 8.0)");var Et=re.createNS("http://www.w3.org/2000/svg","circle");Et.setAttributeNS(null,"fill","#000000"),Et.setAttributeNS(null,"opacity","0.25"),Et.setAttributeNS(null,"cx","5.5"),Et.setAttributeNS(null,"cy","5.5"),Et.setAttributeNS(null,"r","5.4999962");var Vt=re.createNS("http://www.w3.org/2000/svg","circle");Vt.setAttributeNS(null,"fill","#FFFFFF"),Vt.setAttributeNS(null,"cx","5.5"),Vt.setAttributeNS(null,"cy","5.5"),Vt.setAttributeNS(null,"r","5.4999962"),at.appendChild(Et),at.appendChild(Vt),T.appendChild(R),T.appendChild(Pe),T.appendChild(je),T.appendChild(ze),T.appendChild(at),y.appendChild(T),y.setAttributeNS(null,"height",41*this._scale+"px"),y.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(y),this._offset=d.Point.convert(o&&o.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(mr){mr.preventDefault()}),this._element.addEventListener("mousedown",function(mr){mr.preventDefault()}),wc(this._element,this._anchor,"marker"),this._popup=null}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this.remove(),this._map=o,o.getCanvasContainer().appendChild(this._element),o.on("move",this._update),o.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},u.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),re.remove(this._element),this._popup&&this._popup.remove(),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},u.prototype.getElement=function(){return this._element},u.prototype.setPopup=function(o){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),o){if(!("offset"in o.options)){var h=Math.sqrt(Math.pow(13.5,2)/2);o.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[h,-1*(24.6+h)],"bottom-right":[-h,-1*(24.6+h)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=o,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},u.prototype._onKeyPress=function(o){var h=o.code,y=o.charCode||o.keyCode;h!=="Space"&&h!=="Enter"&&y!==32&&y!==13||this.togglePopup()},u.prototype._onMapClick=function(o){var h=o.originalEvent.target,y=this._element;this._popup&&(h===y||y.contains(h))&&this.togglePopup()},u.prototype.getPopup=function(){return this._popup},u.prototype.togglePopup=function(){var o=this._popup;return o?(o.isOpen()?o.remove():o.addTo(this._map),this):this},u.prototype._update=function(o){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var h="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?h="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(h="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var y="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?y="rotateX(0deg)":this._pitchAlignment==="map"&&(y="rotateX("+this._map.getPitch()+"deg)"),o&&o.type!=="moveend"||(this._pos=this._pos.round()),re.setTransform(this._element,Eu[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+y+" "+h)}},u.prototype.getOffset=function(){return this._offset},u.prototype.setOffset=function(o){return this._offset=d.Point.convert(o),this._update(),this},u.prototype._onMove=function(o){if(!this._isDragging){var h=this._clickTolerance||this._map._clickTolerance;this._isDragging=o.point.dist(this._pointerdownPos)>=h}this._isDragging&&(this._pos=o.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))},u.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new d.Event("dragend")),this._state="inactive"},u.prototype._addDragHandler=function(o){this._element.contains(o.originalEvent.target)&&(o.preventDefault(),this._positionDelta=o.point.sub(this._pos).add(this._offset),this._pointerdownPos=o.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},u.prototype.setDraggable=function(o){return this._draggable=!!o,this._map&&(o?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},u.prototype.isDraggable=function(){return this._draggable},u.prototype.setRotation=function(o){return this._rotation=o||0,this._update(),this},u.prototype.getRotation=function(){return this._rotation},u.prototype.setRotationAlignment=function(o){return this._rotationAlignment=o||"auto",this._update(),this},u.prototype.getRotationAlignment=function(){return this._rotationAlignment},u.prototype.setPitchAlignment=function(o){return this._pitchAlignment=o&&o!=="auto"?o:this._rotationAlignment,this._update(),this},u.prototype.getPitchAlignment=function(){return this._pitchAlignment},u}(d.Evented),Nc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Fo=0,Cu=!1,jl=function(i){function u(o){i.call(this),this.options=d.extend({},Nc,o),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.onAdd=function(o){var h;return this._map=o,this._container=re.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),h=this._setupUI,Ri!==void 0?h(Ri):d.window.navigator.permissions!==void 0?d.window.navigator.permissions.query({name:"geolocation"}).then(function(y){h(Ri=y.state!=="denied")}):h(Ri=!!d.window.navigator.geolocation),this._container},u.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),re.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Fo=0,Cu=!1},u.prototype._isOutOfMapMaxBounds=function(o){var h=this._map.getMaxBounds(),y=o.coords;return h&&(y.longitude<h.getWest()||y.longitude>h.getEast()||y.latitude<h.getSouth()||y.latitude>h.getNorth())},u.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},u.prototype._onSuccess=function(o){if(this._map){if(this._isOutOfMapMaxBounds(o))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",o)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=o,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(o),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(o),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",o)),this._finish()}},u.prototype._updateCamera=function(o){var h=new d.LngLat(o.coords.longitude,o.coords.latitude),y=o.coords.accuracy,b=this._map.getBearing(),T=d.extend({bearing:b},this.options.fitBoundsOptions);this._map.fitBounds(h.toBounds(y),T,{geolocateSource:!0})},u.prototype._updateMarker=function(o){if(o){var h=new d.LngLat(o.coords.longitude,o.coords.latitude);this._accuracyCircleMarker.setLngLat(h).addTo(this._map),this._userLocationDotMarker.setLngLat(h).addTo(this._map),this._accuracy=o.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},u.prototype._updateCircleRadius=function(){var o=this._map._container.clientHeight/2,h=this._map.unproject([0,o]),y=this._map.unproject([1,o]),b=h.distanceTo(y),T=Math.ceil(2*this._accuracy/b);this._circleElement.style.width=T+"px",this._circleElement.style.height=T+"px"},u.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},u.prototype._onError=function(o){if(this._map){if(this.options.trackUserLocation)if(o.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var h=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=h,this._geolocateButton.setAttribute("aria-label",h),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(o.code===3&&Cu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",o)),this._finish()}},u.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},u.prototype._setupUI=function(o){var h=this;if(this._container.addEventListener("contextmenu",function(T){return T.preventDefault()}),this._geolocateButton=re.create("button","mapboxgl-ctrl-geolocate",this._container),re.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",o===!1){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var y=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=y,this._geolocateButton.setAttribute("aria-label",y)}else{var b=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=b,this._geolocateButton.setAttribute("aria-label",b)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=re.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new Qu(this._dotElement),this._circleElement=re.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Qu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(T){T.geolocateSource||h._watchState!=="ACTIVE_LOCK"||T.originalEvent&&T.originalEvent.type==="resize"||(h._watchState="BACKGROUND",h._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),h._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),h.fire(new d.Event("trackuserlocationend")))})},u.prototype.trigger=function(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Fo--,Cu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var o;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Fo>1?(o={maximumAge:6e5,timeout:0},Cu=!0):(o=this.options.positionOptions,Cu=!1),this._geolocationWatchID=d.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,o)}}else d.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},u.prototype._clearWatch=function(){d.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},u}(d.Evented),qu={maxWidth:100,unit:"metric"},cu=function(i){this.options=d.extend({},qu,i),d.bindAll(["_onMove","setUnit"],this)};function Al(i,u,o){var h=o&&o.maxWidth||100,y=i._container.clientHeight/2,b=i.unproject([0,y]),T=i.unproject([h,y]),R=b.distanceTo(T);if(o&&o.unit==="imperial"){var j=3.2808*R;j>5280?Ou(u,h,j/5280,i._getUIString("ScaleControl.Miles")):Ou(u,h,j,i._getUIString("ScaleControl.Feet"))}else o&&o.unit==="nautical"?Ou(u,h,R/1852,i._getUIString("ScaleControl.NauticalMiles")):R>=1e3?Ou(u,h,R/1e3,i._getUIString("ScaleControl.Kilometers")):Ou(u,h,R,i._getUIString("ScaleControl.Meters"))}function Ou(i,u,o,h){var y,b,T,R=(y=o,(b=Math.pow(10,(""+Math.floor(y)).length-1))*(T=(T=y/b)>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(j){var ne=Math.pow(10,Math.ceil(-Math.log(j)/Math.LN10));return Math.round(j*ne)/ne}(T)));i.style.width=u*(R/o)+"px",i.innerHTML=R+"&nbsp;"+h}cu.prototype.getDefaultPosition=function(){return"bottom-left"},cu.prototype._onMove=function(){Al(this._map,this._container,this.options)},cu.prototype.onAdd=function(i){return this._map=i,this._container=re.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",i.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},cu.prototype.onRemove=function(){re.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},cu.prototype.setUnit=function(i){this.options.unit=i,Al(this._map,this._container,this.options)};var fu=function(i){this._fullscreen=!1,i&&i.container&&(i.container instanceof d.window.HTMLElement?this._container=i.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in d.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in d.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in d.window.document&&(this._fullscreenchange="MSFullscreenChange")};fu.prototype.onAdd=function(i){return this._map=i,this._container||(this._container=this._map.getContainer()),this._controlContainer=re.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},fu.prototype.onRemove=function(){re.remove(this._controlContainer),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},fu.prototype._checkFullscreenSupport=function(){return!!(d.window.document.fullscreenEnabled||d.window.document.mozFullScreenEnabled||d.window.document.msFullscreenEnabled||d.window.document.webkitFullscreenEnabled)},fu.prototype._setupUI=function(){var i=this._fullscreenButton=re.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);re.create("span","mapboxgl-ctrl-icon",i).setAttribute("aria-hidden",!0),i.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},fu.prototype._updateTitle=function(){var i=this._getTitle();this._fullscreenButton.setAttribute("aria-label",i),this._fullscreenButton.title=i},fu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},fu.prototype._isFullscreen=function(){return this._fullscreen},fu.prototype._changeIcon=function(){(d.window.document.fullscreenElement||d.window.document.mozFullScreenElement||d.window.document.webkitFullscreenElement||d.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},fu.prototype._onClickFullscreen=function(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.mozCancelFullScreen?d.window.document.mozCancelFullScreen():d.window.document.msExitFullscreen?d.window.document.msExitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var zc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Lu=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Ea=function(i){function u(o){i.call(this),this.options=d.extend(Object.create(zc),o),d.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return i&&(u.__proto__=i),(u.prototype=Object.create(i&&i.prototype)).constructor=u,u.prototype.addTo=function(o){return this._map&&this.remove(),this._map=o,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new d.Event("open")),this},u.prototype.isOpen=function(){return!!this._map},u.prototype.remove=function(){return this._content&&re.remove(this._content),this._container&&(re.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new d.Event("close")),this},u.prototype.getLngLat=function(){return this._lngLat},u.prototype.setLngLat=function(o){return this._lngLat=d.LngLat.convert(o),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},u.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},u.prototype.getElement=function(){return this._container},u.prototype.setText=function(o){return this.setDOMContent(d.window.document.createTextNode(o))},u.prototype.setHTML=function(o){var h,y=d.window.document.createDocumentFragment(),b=d.window.document.createElement("body");for(b.innerHTML=o;h=b.firstChild;)y.appendChild(h);return this.setDOMContent(y)},u.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},u.prototype.setMaxWidth=function(o){return this.options.maxWidth=o,this._update(),this},u.prototype.setDOMContent=function(o){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=re.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(o),this._createCloseButton(),this._update(),this._focusFirstElement(),this},u.prototype.addClassName=function(o){this._container&&this._container.classList.add(o)},u.prototype.removeClassName=function(o){this._container&&this._container.classList.remove(o)},u.prototype.setOffset=function(o){return this.options.offset=o,this._update(),this},u.prototype.toggleClassName=function(o){if(this._container)return this._container.classList.toggle(o)},u.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=re.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},u.prototype._onMouseUp=function(o){this._update(o.point)},u.prototype._onMouseMove=function(o){this._update(o.point)},u.prototype._onDrag=function(o){this._update(o.point)},u.prototype._update=function(o){var h=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=re.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=re.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(Ce){return h._container.classList.add(Ce)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=hl(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||o)){var y=this._pos=this._trackPointer&&o?o:this._map.project(this._lngLat),b=this.options.anchor,T=function Ce(Pe){if(Pe){if(typeof Pe=="number"){var He=Math.round(Math.sqrt(.5*Math.pow(Pe,2)));return{center:new d.Point(0,0),top:new d.Point(0,Pe),"top-left":new d.Point(He,He),"top-right":new d.Point(-He,He),bottom:new d.Point(0,-Pe),"bottom-left":new d.Point(He,-He),"bottom-right":new d.Point(-He,-He),left:new d.Point(Pe,0),right:new d.Point(-Pe,0)}}if(Pe instanceof d.Point||Array.isArray(Pe)){var je=d.Point.convert(Pe);return{center:je,top:je,"top-left":je,"top-right":je,bottom:je,"bottom-left":je,"bottom-right":je,left:je,right:je}}return{center:d.Point.convert(Pe.center||[0,0]),top:d.Point.convert(Pe.top||[0,0]),"top-left":d.Point.convert(Pe["top-left"]||[0,0]),"top-right":d.Point.convert(Pe["top-right"]||[0,0]),bottom:d.Point.convert(Pe.bottom||[0,0]),"bottom-left":d.Point.convert(Pe["bottom-left"]||[0,0]),"bottom-right":d.Point.convert(Pe["bottom-right"]||[0,0]),left:d.Point.convert(Pe.left||[0,0]),right:d.Point.convert(Pe.right||[0,0])}}return Ce(new d.Point(0,0))}(this.options.offset);if(!b){var R,j=this._container.offsetWidth,ne=this._container.offsetHeight;R=y.y+T.bottom.y<ne?["top"]:y.y>this._map.transform.height-ne?["bottom"]:[],y.x<j/2?R.push("left"):y.x>this._map.transform.width-j/2&&R.push("right"),b=R.length===0?"bottom":R.join("-")}var be=y.add(T[b]).round();re.setTransform(this._container,Eu[b]+" translate("+be.x+"px,"+be.y+"px)"),wc(this._container,b,"popup")}},u.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var o=this._container.querySelector(Lu);o&&o.focus()}},u.prototype._onClose=function(){this.remove()},u}(d.Evented),Tl={version:d.version,supported:de,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:qc,NavigationControl:Gs,GeolocateControl:jl,AttributionControl:es,ScaleControl:cu,FullscreenControl:fu,Popup:Ea,Marker:Qu,Style:Is,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.Point,MercatorCoordinate:d.MercatorCoordinate,Evented:d.Evented,config:d.config,prewarm:function(){ft().acquire(Ke)},clearPrewarmedResources:function(){var i=kn;i&&(i.isPreloaded()&&i.numActive()===1?(i.release(Ke),kn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(i){d.config.ACCESS_TOKEN=i},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(i){d.config.API_URL=i},get workerCount(){return Zr.workerCount},set workerCount(i){Zr.workerCount=i},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(i){d.config.MAX_PARALLEL_IMAGE_REQUESTS=i},clearStorage:function(i){d.clearTileCache(i)},workerUrl:""};return Tl}),ye})},28660:function(zr,B,S){var ye=S(34155);/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var C;(function(d){(function(de){var re=typeof S.g=="object"?S.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),ie=se(d);typeof re.Reflect=="undefined"?re.Reflect=d:ie=se(re.Reflect,ie),de(ie);function se(Be,$){return function(Je,bt){typeof Be[Je]!="function"&&Object.defineProperty(Be,Je,{configurable:!0,writable:!0,value:bt}),$&&$(Je,bt)}}})(function(de){var re=Object.prototype.hasOwnProperty,ie=typeof Symbol=="function",se=ie&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Be=ie&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",$=typeof Object.create=="function",Je={__proto__:[]}instanceof Array,bt=!$&&!Je,Gt={create:$?function(){return Or(Object.create(null))}:Je?function(){return Or({__proto__:null})}:function(){return Or({})},has:bt?function(Ye,lt){return re.call(Ye,lt)}:function(Ye,lt){return lt in Ye},get:bt?function(Ye,lt){return re.call(Ye,lt)?Ye[lt]:void 0}:function(Ye,lt){return Ye[lt]}},Ir=Object.getPrototypeOf(Function),Qt=typeof ye=="object"&&{NODE_ENV:"production"}&&{NODE_ENV:"production"}.REFLECT_METADATA_USE_MAP_POLYFILL==="true",Yt=!Qt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:K(),ir=!Qt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:Ht(),jt=!Qt&&typeof WeakMap=="function"?WeakMap:Tr(),Tt=new jt;function Ct(Ye,lt,At,zt){if(on(At)){if(!_r(Ye))throw new TypeError;if(!fr(lt))throw new TypeError;return qt(Ye,lt)}else{if(!_r(Ye))throw new TypeError;if(!me(lt))throw new TypeError;if(!me(zt)&&!on(zt)&&!$i(zt))throw new TypeError;return $i(zt)&&(zt=void 0),At=nr(At),Xr(Ye,lt,At,zt)}}de("decorate",Ct);function br(Ye,lt){function At(zt,wr){if(!me(zt))throw new TypeError;if(!on(wr)&&!H(wr))throw new TypeError;Nt(Ye,lt,zt,wr)}return At}de("metadata",br);function q(Ye,lt,At,zt){if(!me(At))throw new TypeError;return on(zt)||(zt=nr(zt)),Nt(Ye,lt,At,zt)}de("defineMetadata",q);function dr(Ye,lt,At){if(!me(lt))throw new TypeError;return on(At)||(At=nr(At)),Re(Ye,lt,At)}de("hasMetadata",dr);function Qe(Ye,lt,At){if(!me(lt))throw new TypeError;return on(At)||(At=nr(At)),ge(Ye,lt,At)}de("hasOwnMetadata",Qe);function $e(Ye,lt,At){if(!me(lt))throw new TypeError;return on(At)||(At=nr(At)),xt(Ye,lt,At)}de("getMetadata",$e);function Rt(Ye,lt,At){if(!me(lt))throw new TypeError;return on(At)||(At=nr(At)),vt(Ye,lt,At)}de("getOwnMetadata",Rt);function Xe(Ye,lt){if(!me(Ye))throw new TypeError;return on(lt)||(lt=nr(lt)),Dt(Ye,lt)}de("getMetadataKeys",Xe);function Zt(Ye,lt){if(!me(Ye))throw new TypeError;return on(lt)||(lt=nr(lt)),Ur(Ye,lt)}de("getOwnMetadataKeys",Zt);function xr(Ye,lt,At){if(!me(lt))throw new TypeError;on(At)||(At=nr(At));var zt=ce(lt,At,!1);if(on(zt)||!zt.delete(Ye))return!1;if(zt.size>0)return!0;var wr=Tt.get(lt);return wr.delete(At),wr.size>0||Tt.delete(lt),!0}de("deleteMetadata",xr);function qt(Ye,lt){for(var At=Ye.length-1;At>=0;--At){var zt=Ye[At],wr=zt(lt);if(!on(wr)&&!$i(wr)){if(!fr(wr))throw new TypeError;lt=wr}}return lt}function Xr(Ye,lt,At,zt){for(var wr=Ye.length-1;wr>=0;--wr){var Pr=Ye[wr],er=Pr(lt,At,zt);if(!on(er)&&!$i(er)){if(!me(er))throw new TypeError;zt=er}}return zt}function ce(Ye,lt,At){var zt=Tt.get(Ye);if(on(zt)){if(!At)return;zt=new Yt,Tt.set(Ye,zt)}var wr=zt.get(lt);if(on(wr)){if(!At)return;wr=new Yt,zt.set(lt,wr)}return wr}function Re(Ye,lt,At){var zt=ge(Ye,lt,At);if(zt)return!0;var wr=wt(lt);return $i(wr)?!1:Re(Ye,wr,At)}function ge(Ye,lt,At){var zt=ce(lt,At,!1);return on(zt)?!1:Le(zt.has(Ye))}function xt(Ye,lt,At){var zt=ge(Ye,lt,At);if(zt)return vt(Ye,lt,At);var wr=wt(lt);if(!$i(wr))return xt(Ye,wr,At)}function vt(Ye,lt,At){var zt=ce(lt,At,!1);if(!on(zt))return zt.get(Ye)}function Nt(Ye,lt,At,zt){var wr=ce(At,zt,!0);wr.set(Ye,lt)}function Dt(Ye,lt){var At=Ur(Ye,lt),zt=wt(Ye);if(zt===null)return At;var wr=Dt(zt,lt);if(wr.length<=0)return At;if(At.length<=0)return wr;for(var Pr=new ir,er=[],Jr=0,Yr=At;Jr<Yr.length;Jr++){var En=Yr[Jr],_n=Pr.has(En);_n||(Pr.add(En),er.push(En))}for(var ei=0,si=wr;ei<si.length;ei++){var En=si[ei],_n=Pr.has(En);_n||(Pr.add(En),er.push(En))}return er}function Ur(Ye,lt){var At=[],zt=ce(Ye,lt,!1);if(on(zt))return At;for(var wr=zt.keys(),Pr=V(wr),er=0;;){var Jr=tt(Pr);if(!Jr)return At.length=er,At;var Yr=Ze(Jr);try{At[er]=Yr}catch(En){try{ut(Pr)}finally{throw En}}er++}}function dn(Ye){if(Ye===null)return 1;switch(typeof Ye){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Ye===null?1:6;default:return 6}}function on(Ye){return Ye===void 0}function $i(Ye){return Ye===null}function or(Ye){return typeof Ye=="symbol"}function me(Ye){return typeof Ye=="object"?Ye!==null:typeof Ye=="function"}function Ae(Ye,lt){switch(dn(Ye)){case 0:return Ye;case 1:return Ye;case 2:return Ye;case 3:return Ye;case 4:return Ye;case 5:return Ye}var At=lt===3?"string":lt===5?"number":"default",zt=E(Ye,se);if(zt!==void 0){var wr=zt.call(Ye,At);if(me(wr))throw new TypeError;return wr}return Ue(Ye,At==="default"?"number":At)}function Ue(Ye,lt){if(lt==="string"){var At=Ye.toString;if(Lr(At)){var zt=At.call(Ye);if(!me(zt))return zt}var wr=Ye.valueOf;if(Lr(wr)){var zt=wr.call(Ye);if(!me(zt))return zt}}else{var wr=Ye.valueOf;if(Lr(wr)){var zt=wr.call(Ye);if(!me(zt))return zt}var Pr=Ye.toString;if(Lr(Pr)){var zt=Pr.call(Ye);if(!me(zt))return zt}}throw new TypeError}function Le(Ye){return!!Ye}function kt(Ye){return""+Ye}function nr(Ye){var lt=Ae(Ye,3);return or(lt)?lt:kt(lt)}function _r(Ye){return Array.isArray?Array.isArray(Ye):Ye instanceof Object?Ye instanceof Array:Object.prototype.toString.call(Ye)==="[object Array]"}function Lr(Ye){return typeof Ye=="function"}function fr(Ye){return typeof Ye=="function"}function H(Ye){switch(dn(Ye)){case 3:return!0;case 4:return!0;default:return!1}}function E(Ye,lt){var At=Ye[lt];if(At!=null){if(!Lr(At))throw new TypeError;return At}}function V(Ye){var lt=E(Ye,Be);if(!Lr(lt))throw new TypeError;var At=lt.call(Ye);if(!me(At))throw new TypeError;return At}function Ze(Ye){return Ye.value}function tt(Ye){var lt=Ye.next();return lt.done?!1:lt}function ut(Ye){var lt=Ye.return;lt&&lt.call(Ye)}function wt(Ye){var lt=Object.getPrototypeOf(Ye);if(typeof Ye!="function"||Ye===Ir||lt!==Ir)return lt;var At=Ye.prototype,zt=At&&Object.getPrototypeOf(At);if(zt==null||zt===Object.prototype)return lt;var wr=zt.constructor;return typeof wr!="function"||wr===Ye?lt:wr}function K(){var Ye={},lt=[],At=function(){function er(Jr,Yr,En){this._index=0,this._keys=Jr,this._values=Yr,this._selector=En}return er.prototype["@@iterator"]=function(){return this},er.prototype[Be]=function(){return this},er.prototype.next=function(){var Jr=this._index;if(Jr>=0&&Jr<this._keys.length){var Yr=this._selector(this._keys[Jr],this._values[Jr]);return Jr+1>=this._keys.length?(this._index=-1,this._keys=lt,this._values=lt):this._index++,{value:Yr,done:!1}}return{value:void 0,done:!0}},er.prototype.throw=function(Jr){throw this._index>=0&&(this._index=-1,this._keys=lt,this._values=lt),Jr},er.prototype.return=function(Jr){return this._index>=0&&(this._index=-1,this._keys=lt,this._values=lt),{value:Jr,done:!0}},er}();return function(){function er(){this._keys=[],this._values=[],this._cacheKey=Ye,this._cacheIndex=-2}return Object.defineProperty(er.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),er.prototype.has=function(Jr){return this._find(Jr,!1)>=0},er.prototype.get=function(Jr){var Yr=this._find(Jr,!1);return Yr>=0?this._values[Yr]:void 0},er.prototype.set=function(Jr,Yr){var En=this._find(Jr,!0);return this._values[En]=Yr,this},er.prototype.delete=function(Jr){var Yr=this._find(Jr,!1);if(Yr>=0){for(var En=this._keys.length,_n=Yr+1;_n<En;_n++)this._keys[_n-1]=this._keys[_n],this._values[_n-1]=this._values[_n];return this._keys.length--,this._values.length--,Jr===this._cacheKey&&(this._cacheKey=Ye,this._cacheIndex=-2),!0}return!1},er.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Ye,this._cacheIndex=-2},er.prototype.keys=function(){return new At(this._keys,this._values,zt)},er.prototype.values=function(){return new At(this._keys,this._values,wr)},er.prototype.entries=function(){return new At(this._keys,this._values,Pr)},er.prototype["@@iterator"]=function(){return this.entries()},er.prototype[Be]=function(){return this.entries()},er.prototype._find=function(Jr,Yr){return this._cacheKey!==Jr&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=Jr)),this._cacheIndex<0&&Yr&&(this._cacheIndex=this._keys.length,this._keys.push(Jr),this._values.push(void 0)),this._cacheIndex},er}();function zt(er,Jr){return er}function wr(er,Jr){return Jr}function Pr(er,Jr){return[er,Jr]}}function Ht(){return function(){function Ye(){this._map=new Yt}return Object.defineProperty(Ye.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Ye.prototype.has=function(lt){return this._map.has(lt)},Ye.prototype.add=function(lt){return this._map.set(lt,lt),this},Ye.prototype.delete=function(lt){return this._map.delete(lt)},Ye.prototype.clear=function(){this._map.clear()},Ye.prototype.keys=function(){return this._map.keys()},Ye.prototype.values=function(){return this._map.values()},Ye.prototype.entries=function(){return this._map.entries()},Ye.prototype["@@iterator"]=function(){return this.keys()},Ye.prototype[Be]=function(){return this.keys()},Ye}()}function Tr(){var Ye=16,lt=Gt.create(),At=zt();return function(){function Yr(){this._key=zt()}return Yr.prototype.has=function(En){var _n=wr(En,!1);return _n!==void 0?Gt.has(_n,this._key):!1},Yr.prototype.get=function(En){var _n=wr(En,!1);return _n!==void 0?Gt.get(_n,this._key):void 0},Yr.prototype.set=function(En,_n){var ei=wr(En,!0);return ei[this._key]=_n,this},Yr.prototype.delete=function(En){var _n=wr(En,!1);return _n!==void 0?delete _n[this._key]:!1},Yr.prototype.clear=function(){this._key=zt()},Yr}();function zt(){var Yr;do Yr="@@WeakMap@@"+Jr();while(Gt.has(lt,Yr));return lt[Yr]=!0,Yr}function wr(Yr,En){if(!re.call(Yr,At)){if(!En)return;Object.defineProperty(Yr,At,{value:Gt.create()})}return Yr[At]}function Pr(Yr,En){for(var _n=0;_n<En;++_n)Yr[_n]=Math.random()*255|0;return Yr}function er(Yr){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Yr)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Yr)):Pr(new Uint8Array(Yr),Yr):Pr(new Array(Yr),Yr)}function Jr(){var Yr=er(Ye);Yr[6]=Yr[6]&79|64,Yr[8]=Yr[8]&191|128;for(var En="",_n=0;_n<Ye;++_n){var ei=Yr[_n];(_n===4||_n===6||_n===8)&&(En+="-"),ei<16&&(En+="0"),En+=ei.toString(16).toLowerCase()}return En}}function Or(Ye){return Ye.__=void 0,delete Ye.__,Ye}})})(C||(C={}))},69848:function(zr){(function(B,S){zr.exports=S()})(this,function(){"use strict";function B(Qe,$e,Rt,Xe,Zt,xr){if(!(Zt-Xe<=Rt)){var qt=Xe+Zt>>1;S(Qe,$e,qt,Xe,Zt,xr%2),B(Qe,$e,Rt,Xe,qt-1,xr+1),B(Qe,$e,Rt,qt+1,Zt,xr+1)}}function S(Qe,$e,Rt,Xe,Zt,xr){for(;Zt>Xe;){if(Zt-Xe>600){var qt=Zt-Xe+1,Xr=Rt-Xe+1,ce=Math.log(qt),Re=.5*Math.exp(2*ce/3),ge=.5*Math.sqrt(ce*Re*(qt-Re)/qt)*(Xr-qt/2<0?-1:1),xt=Math.max(Xe,Math.floor(Rt-Xr*Re/qt+ge)),vt=Math.min(Zt,Math.floor(Rt+(qt-Xr)*Re/qt+ge));S(Qe,$e,Rt,xt,vt,xr)}var Nt=$e[2*Rt+xr],Dt=Xe,Ur=Zt;for(ye(Qe,$e,Xe,Rt),$e[2*Zt+xr]>Nt&&ye(Qe,$e,Xe,Zt);Dt<Ur;){for(ye(Qe,$e,Dt,Ur),Dt++,Ur--;$e[2*Dt+xr]<Nt;)Dt++;for(;$e[2*Ur+xr]>Nt;)Ur--}$e[2*Xe+xr]===Nt?ye(Qe,$e,Xe,Ur):(Ur++,ye(Qe,$e,Ur,Zt)),Ur<=Rt&&(Xe=Ur+1),Rt<=Ur&&(Zt=Ur-1)}}function ye(Qe,$e,Rt,Xe){C(Qe,Rt,Xe),C($e,2*Rt,2*Xe),C($e,2*Rt+1,2*Xe+1)}function C(Qe,$e,Rt){var Xe=Qe[$e];Qe[$e]=Qe[Rt],Qe[Rt]=Xe}function d(Qe,$e,Rt,Xe,Zt,xr,qt){for(var Xr=[0,Qe.length-1,0],ce=[],Re,ge;Xr.length;){var xt=Xr.pop(),vt=Xr.pop(),Nt=Xr.pop();if(vt-Nt<=qt){for(var Dt=Nt;Dt<=vt;Dt++)Re=$e[2*Dt],ge=$e[2*Dt+1],Re>=Rt&&Re<=Zt&&ge>=Xe&&ge<=xr&&ce.push(Qe[Dt]);continue}var Ur=Math.floor((Nt+vt)/2);Re=$e[2*Ur],ge=$e[2*Ur+1],Re>=Rt&&Re<=Zt&&ge>=Xe&&ge<=xr&&ce.push(Qe[Ur]);var dn=(xt+1)%2;(xt===0?Rt<=Re:Xe<=ge)&&(Xr.push(Nt),Xr.push(Ur-1),Xr.push(dn)),(xt===0?Zt>=Re:xr>=ge)&&(Xr.push(Ur+1),Xr.push(vt),Xr.push(dn))}return ce}function de(Qe,$e,Rt,Xe,Zt,xr){for(var qt=[0,Qe.length-1,0],Xr=[],ce=Zt*Zt;qt.length;){var Re=qt.pop(),ge=qt.pop(),xt=qt.pop();if(ge-xt<=xr){for(var vt=xt;vt<=ge;vt++)re($e[2*vt],$e[2*vt+1],Rt,Xe)<=ce&&Xr.push(Qe[vt]);continue}var Nt=Math.floor((xt+ge)/2),Dt=$e[2*Nt],Ur=$e[2*Nt+1];re(Dt,Ur,Rt,Xe)<=ce&&Xr.push(Qe[Nt]);var dn=(Re+1)%2;(Re===0?Rt-Zt<=Dt:Xe-Zt<=Ur)&&(qt.push(xt),qt.push(Nt-1),qt.push(dn)),(Re===0?Rt+Zt>=Dt:Xe+Zt>=Ur)&&(qt.push(Nt+1),qt.push(ge),qt.push(dn))}return Xr}function re(Qe,$e,Rt,Xe){var Zt=Qe-Rt,xr=$e-Xe;return Zt*Zt+xr*xr}var ie=function(Qe){return Qe[0]},se=function(Qe){return Qe[1]},Be=function($e,Rt,Xe,Zt,xr){Rt===void 0&&(Rt=ie),Xe===void 0&&(Xe=se),Zt===void 0&&(Zt=64),xr===void 0&&(xr=Float64Array),this.nodeSize=Zt,this.points=$e;for(var qt=$e.length<65536?Uint16Array:Uint32Array,Xr=this.ids=new qt($e.length),ce=this.coords=new xr($e.length*2),Re=0;Re<$e.length;Re++)Xr[Re]=Re,ce[2*Re]=Rt($e[Re]),ce[2*Re+1]=Xe($e[Re]);B(Xr,ce,Zt,0,Xr.length-1,0)};Be.prototype.range=function($e,Rt,Xe,Zt){return d(this.ids,this.coords,$e,Rt,Xe,Zt,this.nodeSize)},Be.prototype.within=function($e,Rt,Xe){return de(this.ids,this.coords,$e,Rt,Xe,this.nodeSize)};var $={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Qe){return Qe}},Je=Math.fround||function(Qe){return function($e){return Qe[0]=+$e,Qe[0]}}(new Float32Array(1)),bt=function($e){this.options=br(Object.create($),$e),this.trees=new Array(this.options.maxZoom+1)};bt.prototype.load=function($e){var Rt=this.options,Xe=Rt.log,Zt=Rt.minZoom,xr=Rt.maxZoom,qt=Rt.nodeSize;Xe&&console.time("total time");var Xr="prepare "+$e.length+" points";Xe&&console.time(Xr),this.points=$e;for(var ce=[],Re=0;Re<$e.length;Re++)!$e[Re].geometry||ce.push(Ir($e[Re],Re));this.trees[xr+1]=new Be(ce,q,dr,qt,Float32Array),Xe&&console.timeEnd(Xr);for(var ge=xr;ge>=Zt;ge--){var xt=+Date.now();ce=this._cluster(ce,ge),this.trees[ge]=new Be(ce,q,dr,qt,Float32Array),Xe&&console.log("z%d: %d clusters in %dms",ge,ce.length,+Date.now()-xt)}return Xe&&console.timeEnd("total time"),this},bt.prototype.getClusters=function($e,Rt){var Xe=(($e[0]+180)%360+360)%360-180,Zt=Math.max(-90,Math.min(90,$e[1])),xr=$e[2]===180?180:(($e[2]+180)%360+360)%360-180,qt=Math.max(-90,Math.min(90,$e[3]));if($e[2]-$e[0]>=360)Xe=-180,xr=180;else if(Xe>xr){var Xr=this.getClusters([Xe,Zt,180,qt],Rt),ce=this.getClusters([-180,Zt,xr,qt],Rt);return Xr.concat(ce)}for(var Re=this.trees[this._limitZoom(Rt)],ge=Re.range(ir(Xe),jt(qt),ir(xr),jt(Zt)),xt=[],vt=0,Nt=ge;vt<Nt.length;vt+=1){var Dt=Nt[vt],Ur=Re.points[Dt];xt.push(Ur.numPoints?Qt(Ur):this.points[Ur.index])}return xt},bt.prototype.getChildren=function($e){var Rt=this._getOriginId($e),Xe=this._getOriginZoom($e),Zt="No cluster with the specified id.",xr=this.trees[Xe];if(!xr)throw new Error(Zt);var qt=xr.points[Rt];if(!qt)throw new Error(Zt);for(var Xr=this.options.radius/(this.options.extent*Math.pow(2,Xe-1)),ce=xr.within(qt.x,qt.y,Xr),Re=[],ge=0,xt=ce;ge<xt.length;ge+=1){var vt=xt[ge],Nt=xr.points[vt];Nt.parentId===$e&&Re.push(Nt.numPoints?Qt(Nt):this.points[Nt.index])}if(Re.length===0)throw new Error(Zt);return Re},bt.prototype.getLeaves=function($e,Rt,Xe){Rt=Rt||10,Xe=Xe||0;var Zt=[];return this._appendLeaves(Zt,$e,Rt,Xe,0),Zt},bt.prototype.getTile=function($e,Rt,Xe){var Zt=this.trees[this._limitZoom($e)],xr=Math.pow(2,$e),qt=this.options,Xr=qt.extent,ce=qt.radius,Re=ce/Xr,ge=(Xe-Re)/xr,xt=(Xe+1+Re)/xr,vt={features:[]};return this._addTileFeatures(Zt.range((Rt-Re)/xr,ge,(Rt+1+Re)/xr,xt),Zt.points,Rt,Xe,xr,vt),Rt===0&&this._addTileFeatures(Zt.range(1-Re/xr,ge,1,xt),Zt.points,xr,Xe,xr,vt),Rt===xr-1&&this._addTileFeatures(Zt.range(0,ge,Re/xr,xt),Zt.points,-1,Xe,xr,vt),vt.features.length?vt:null},bt.prototype.getClusterExpansionZoom=function($e){for(var Rt=this._getOriginZoom($e)-1;Rt<=this.options.maxZoom;){var Xe=this.getChildren($e);if(Rt++,Xe.length!==1)break;$e=Xe[0].properties.cluster_id}return Rt},bt.prototype._appendLeaves=function($e,Rt,Xe,Zt,xr){for(var qt=this.getChildren(Rt),Xr=0,ce=qt;Xr<ce.length;Xr+=1){var Re=ce[Xr],ge=Re.properties;if(ge&&ge.cluster?xr+ge.point_count<=Zt?xr+=ge.point_count:xr=this._appendLeaves($e,ge.cluster_id,Xe,Zt,xr):xr<Zt?xr++:$e.push(Re),$e.length===Xe)break}return xr},bt.prototype._addTileFeatures=function($e,Rt,Xe,Zt,xr,qt){for(var Xr=0,ce=$e;Xr<ce.length;Xr+=1){var Re=ce[Xr],ge=Rt[Re],xt=ge.numPoints,vt=void 0,Nt=void 0,Dt=void 0;if(xt)vt=Yt(ge),Nt=ge.x,Dt=ge.y;else{var Ur=this.points[ge.index];vt=Ur.properties,Nt=ir(Ur.geometry.coordinates[0]),Dt=jt(Ur.geometry.coordinates[1])}var dn={type:1,geometry:[[Math.round(this.options.extent*(Nt*xr-Xe)),Math.round(this.options.extent*(Dt*xr-Zt))]],tags:vt},on=void 0;xt?on=ge.id:this.options.generateId?on=ge.index:this.points[ge.index].id&&(on=this.points[ge.index].id),on!==void 0&&(dn.id=on),qt.features.push(dn)}},bt.prototype._limitZoom=function($e){return Math.max(this.options.minZoom,Math.min(+$e,this.options.maxZoom+1))},bt.prototype._cluster=function($e,Rt){for(var Xe=[],Zt=this.options,xr=Zt.radius,qt=Zt.extent,Xr=Zt.reduce,ce=Zt.minPoints,Re=xr/(qt*Math.pow(2,Rt)),ge=0;ge<$e.length;ge++){var xt=$e[ge];if(!(xt.zoom<=Rt)){xt.zoom=Rt;for(var vt=this.trees[Rt+1],Nt=vt.within(xt.x,xt.y,Re),Dt=xt.numPoints||1,Ur=Dt,dn=0,on=Nt;dn<on.length;dn+=1){var $i=on[dn],or=vt.points[$i];or.zoom>Rt&&(Ur+=or.numPoints||1)}if(Ur>Dt&&Ur>=ce){for(var me=xt.x*Dt,Ae=xt.y*Dt,Ue=Xr&&Dt>1?this._map(xt,!0):null,Le=(ge<<5)+(Rt+1)+this.points.length,kt=0,nr=Nt;kt<nr.length;kt+=1){var _r=nr[kt],Lr=vt.points[_r];if(!(Lr.zoom<=Rt)){Lr.zoom=Rt;var fr=Lr.numPoints||1;me+=Lr.x*fr,Ae+=Lr.y*fr,Lr.parentId=Le,Xr&&(Ue||(Ue=this._map(xt,!0)),Xr(Ue,this._map(Lr)))}}xt.parentId=Le,Xe.push(Gt(me/Ur,Ae/Ur,Le,Ur,Ue))}else if(Xe.push(xt),Ur>1)for(var H=0,E=Nt;H<E.length;H+=1){var V=E[H],Ze=vt.points[V];Ze.zoom<=Rt||(Ze.zoom=Rt,Xe.push(Ze))}}}return Xe},bt.prototype._getOriginId=function($e){return $e-this.points.length>>5},bt.prototype._getOriginZoom=function($e){return($e-this.points.length)%32},bt.prototype._map=function($e,Rt){if($e.numPoints)return Rt?br({},$e.properties):$e.properties;var Xe=this.points[$e.index].properties,Zt=this.options.map(Xe);return Rt&&Zt===Xe?br({},Zt):Zt};function Gt(Qe,$e,Rt,Xe,Zt){return{x:Je(Qe),y:Je($e),zoom:Infinity,id:Rt,parentId:-1,numPoints:Xe,properties:Zt}}function Ir(Qe,$e){var Rt=Qe.geometry.coordinates,Xe=Rt[0],Zt=Rt[1];return{x:Je(ir(Xe)),y:Je(jt(Zt)),zoom:Infinity,index:$e,parentId:-1}}function Qt(Qe){return{type:"Feature",id:Qe.id,properties:Yt(Qe),geometry:{type:"Point",coordinates:[Tt(Qe.x),Ct(Qe.y)]}}}function Yt(Qe){var $e=Qe.numPoints,Rt=$e>=1e4?Math.round($e/1e3)+"k":$e>=1e3?Math.round($e/100)/10+"k":$e;return br(br({},Qe.properties),{cluster:!0,cluster_id:Qe.id,point_count:$e,point_count_abbreviated:Rt})}function ir(Qe){return Qe/360+.5}function jt(Qe){var $e=Math.sin(Qe*Math.PI/180),Rt=.5-.25*Math.log((1+$e)/(1-$e))/Math.PI;return Rt<0?0:Rt>1?1:Rt}function Tt(Qe){return(Qe-.5)*360}function Ct(Qe){var $e=(180-Qe*360)*Math.PI/180;return 360*Math.atan(Math.exp($e))/Math.PI-90}function br(Qe,$e){for(var Rt in $e)Qe[Rt]=$e[Rt];return Qe}function q(Qe){return Qe.x}function dr(Qe){return Qe.y}return bt})},75752:function(zr){zr.exports.RADIUS=6378137,zr.exports.FLATTENING=1/298.257223563,zr.exports.POLAR_RADIUS=63567523142e-4}}]);
